
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>mathviz_hopper.src.bottle &#8212; Mathviz 0.1 documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for mathviz_hopper.src.bottle</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Bottle is a fast and simple micro-framework for small web applications. It</span>
<span class="sd">offers request dispatching (Routes) with URL parameter support, templates,</span>
<span class="sd">a built-in HTTP Server and adapters for many third party WSGI/HTTP-server and</span>
<span class="sd">template engines - all in a single file and with no dependencies other than the</span>
<span class="sd">Python Standard Library.</span>

<span class="sd">Homepage and documentation: http://bottlepy.org/</span>

<span class="sd">Copyright (c) 2017, Marcel Hellkamp.</span>
<span class="sd">License: MIT (see LICENSE for details)</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;Marcel Hellkamp&#39;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s1">&#39;0.13-dev&#39;</span>
<span class="n">__license__</span> <span class="o">=</span> <span class="s1">&#39;MIT&#39;</span>

<span class="c1">###############################################################################</span>
<span class="c1"># Command-line interface ######################################################</span>
<span class="c1">###############################################################################</span>
<span class="c1"># INFO: Some server adapters need to monkey-patch std-lib modules before they</span>
<span class="c1"># are imported. This is why some of the command-line handling is done here, but</span>
<span class="c1"># the actual call to _main() is at the end of the file.</span>


<span class="k">def</span> <span class="nf">_cli_parse</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>  <span class="c1"># pragma: no coverage</span>
    <span class="kn">from</span> <span class="nn">argparse</span> <span class="k">import</span> <span class="n">ArgumentParser</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">ArgumentParser</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">usage</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(prog)s</span><span class="s2"> [options] package.module:app&quot;</span><span class="p">)</span>
    <span class="n">opt</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span>
    <span class="n">opt</span><span class="p">(</span><span class="s2">&quot;--version&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;show version number.&quot;</span><span class="p">)</span>
    <span class="n">opt</span><span class="p">(</span><span class="s2">&quot;-b&quot;</span><span class="p">,</span> <span class="s2">&quot;--bind&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;ADDRESS&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;bind socket to ADDRESS.&quot;</span><span class="p">)</span>
    <span class="n">opt</span><span class="p">(</span><span class="s2">&quot;-s&quot;</span><span class="p">,</span> <span class="s2">&quot;--server&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;wsgiref&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;use SERVER as backend.&quot;</span><span class="p">)</span>
    <span class="n">opt</span><span class="p">(</span><span class="s2">&quot;-p&quot;</span><span class="p">,</span> <span class="s2">&quot;--plugin&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;install additional plugin/s.&quot;</span><span class="p">)</span>
    <span class="n">opt</span><span class="p">(</span><span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="s2">&quot;--conf&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;FILE&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;load config values from FILE.&quot;</span><span class="p">)</span>
    <span class="n">opt</span><span class="p">(</span><span class="s2">&quot;-C&quot;</span><span class="p">,</span> <span class="s2">&quot;--param&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;NAME=VALUE&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;override config values.&quot;</span><span class="p">)</span>
    <span class="n">opt</span><span class="p">(</span><span class="s2">&quot;--debug&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;start server in debug mode.&quot;</span><span class="p">)</span>
    <span class="n">opt</span><span class="p">(</span><span class="s2">&quot;--reload&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;auto-reload on file changes.&quot;</span><span class="p">)</span>
    <span class="n">opt</span><span class="p">(</span><span class="s1">&#39;app&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;WSGI app entry point.&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">)</span>

    <span class="n">cli_args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

    <span class="k">return</span> <span class="n">cli_args</span><span class="p">,</span> <span class="n">parser</span>


<span class="k">def</span> <span class="nf">_cli_patch</span><span class="p">(</span><span class="n">cli_args</span><span class="p">):</span>  <span class="c1"># pragma: no coverage</span>
    <span class="n">parsed_args</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_cli_parse</span><span class="p">(</span><span class="n">cli_args</span><span class="p">)</span>
    <span class="n">opts</span> <span class="o">=</span> <span class="n">parsed_args</span>
    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">server</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;gevent&#39;</span><span class="p">):</span>
            <span class="kn">import</span> <span class="nn">gevent.monkey</span>
            <span class="n">gevent</span><span class="o">.</span><span class="n">monkey</span><span class="o">.</span><span class="n">patch_all</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">opts</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;eventlet&#39;</span><span class="p">):</span>
            <span class="kn">import</span> <span class="nn">eventlet</span>
            <span class="n">eventlet</span><span class="o">.</span><span class="n">monkey_patch</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">_cli_patch</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>

<span class="c1">###############################################################################</span>
<span class="c1"># Imports and Python 2/3 unification ##########################################</span>
<span class="c1">###############################################################################</span>


<span class="kn">import</span> <span class="nn">base64</span><span class="o">,</span> <span class="nn">cgi</span><span class="o">,</span> <span class="nn">email.utils</span><span class="o">,</span> <span class="nn">functools</span><span class="o">,</span> <span class="nn">hmac</span><span class="o">,</span> <span class="nn">imp</span><span class="o">,</span> <span class="nn">itertools</span><span class="o">,</span> <span class="nn">mimetypes</span><span class="o">,</span>\
        <span class="n">os</span><span class="p">,</span> <span class="n">re</span><span class="p">,</span> <span class="n">tempfile</span><span class="p">,</span> <span class="n">threading</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">warnings</span><span class="p">,</span> <span class="n">weakref</span><span class="p">,</span> <span class="n">hashlib</span>

<span class="kn">from</span> <span class="nn">types</span> <span class="k">import</span> <span class="n">FunctionType</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">date</span> <span class="k">as</span> <span class="n">datedate</span><span class="p">,</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">tempfile</span> <span class="k">import</span> <span class="n">TemporaryFile</span>
<span class="kn">from</span> <span class="nn">traceback</span> <span class="k">import</span> <span class="n">format_exc</span><span class="p">,</span> <span class="n">print_exc</span>
<span class="kn">from</span> <span class="nn">unicodedata</span> <span class="k">import</span> <span class="n">normalize</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">ujson</span> <span class="k">import</span> <span class="n">dumps</span> <span class="k">as</span> <span class="n">json_dumps</span><span class="p">,</span> <span class="n">loads</span> <span class="k">as</span> <span class="n">json_lds</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">json</span> <span class="k">import</span> <span class="n">dumps</span> <span class="k">as</span> <span class="n">json_dumps</span><span class="p">,</span> <span class="n">loads</span> <span class="k">as</span> <span class="n">json_lds</span>

<span class="c1"># inspect.getargspec was removed in Python 3.6, use</span>
<span class="c1"># Signature-based version where we can (Python 3.3+)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">inspect</span> <span class="k">import</span> <span class="n">signature</span>
    <span class="k">def</span> <span class="nf">getargspec</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">signature</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">args</span><span class="p">,</span> <span class="n">varargs</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">defaults</span> <span class="o">=</span> <span class="p">[],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">param</span><span class="o">.</span><span class="n">VAR_POSITIONAL</span><span class="p">:</span>
                <span class="n">varargs</span> <span class="o">=</span> <span class="n">name</span>
            <span class="k">elif</span> <span class="n">param</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">param</span><span class="o">.</span><span class="n">VAR_KEYWORD</span><span class="p">:</span>
                <span class="n">keywords</span> <span class="o">=</span> <span class="n">name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">param</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="n">defaults</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">varargs</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">defaults</span><span class="p">)</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">inspect</span> <span class="k">import</span> <span class="n">getfullargspec</span>
        <span class="k">def</span> <span class="nf">getargspec</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
            <span class="n">spec</span> <span class="o">=</span> <span class="n">getfullargspec</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="n">makelist</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">makelist</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">kwonlyargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">spec</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">spec</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">spec</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">inspect</span> <span class="k">import</span> <span class="n">getargspec</span>

<span class="n">py3k</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">major</span> <span class="o">&gt;</span> <span class="mi">2</span>


<span class="c1"># Workaround for the &quot;print is a keyword/function&quot; Python 2/3 dilemma</span>
<span class="c1"># and a fallback for mod_wsgi (resticts stdout/err attribute access)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">_stdout</span><span class="p">,</span> <span class="n">_stderr</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span>
<span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
    <span class="n">_stdout</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">_stderr</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># Lots of stdlib and builtin differences.</span>
<span class="k">if</span> <span class="n">py3k</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">http.client</span> <span class="k">as</span> <span class="nn">httplib</span>
    <span class="kn">import</span> <span class="nn">_thread</span> <span class="k">as</span> <span class="nn">thread</span>
    <span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="k">import</span> <span class="n">urljoin</span><span class="p">,</span> <span class="n">SplitResult</span> <span class="k">as</span> <span class="n">UrlSplitResult</span>
    <span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="k">import</span> <span class="n">urlencode</span><span class="p">,</span> <span class="n">quote</span> <span class="k">as</span> <span class="n">urlquote</span><span class="p">,</span> <span class="n">unquote</span> <span class="k">as</span> <span class="n">urlunquote</span>
    <span class="n">urlunquote</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">urlunquote</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;latin1&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">http.cookies</span> <span class="k">import</span> <span class="n">SimpleCookie</span><span class="p">,</span> <span class="n">Morsel</span><span class="p">,</span> <span class="n">CookieError</span>
    <span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">MutableMapping</span> <span class="k">as</span> <span class="n">DictMixin</span>
    <span class="kn">import</span> <span class="nn">pickle</span>
    <span class="kn">from</span> <span class="nn">io</span> <span class="k">import</span> <span class="n">BytesIO</span>
    <span class="kn">import</span> <span class="nn">configparser</span>

    <span class="n">basestring</span> <span class="o">=</span> <span class="nb">str</span>
    <span class="n">unicode</span> <span class="o">=</span> <span class="nb">str</span>
    <span class="n">json_loads</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">json_lds</span><span class="p">(</span><span class="n">touni</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
    <span class="n">callable</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">)</span>
    <span class="n">imap</span> <span class="o">=</span> <span class="nb">map</span>

    <span class="k">def</span> <span class="nf">_raise</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">with_traceback</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="k">else</span><span class="p">:</span>  <span class="c1"># 2.x</span>
    <span class="kn">import</span> <span class="nn">httplib</span>
    <span class="kn">import</span> <span class="nn">thread</span>
    <span class="kn">from</span> <span class="nn">urlparse</span> <span class="k">import</span> <span class="n">urljoin</span><span class="p">,</span> <span class="n">SplitResult</span> <span class="k">as</span> <span class="n">UrlSplitResult</span>
    <span class="kn">from</span> <span class="nn">urllib</span> <span class="k">import</span> <span class="n">urlencode</span><span class="p">,</span> <span class="n">quote</span> <span class="k">as</span> <span class="n">urlquote</span><span class="p">,</span> <span class="n">unquote</span> <span class="k">as</span> <span class="n">urlunquote</span>
    <span class="kn">from</span> <span class="nn">Cookie</span> <span class="k">import</span> <span class="n">SimpleCookie</span><span class="p">,</span> <span class="n">Morsel</span><span class="p">,</span> <span class="n">CookieError</span>
    <span class="kn">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">imap</span>
    <span class="kn">import</span> <span class="nn">cPickle</span> <span class="k">as</span> <span class="nn">pickle</span>
    <span class="kn">from</span> <span class="nn">StringIO</span> <span class="k">import</span> <span class="n">StringIO</span> <span class="k">as</span> <span class="n">BytesIO</span>
    <span class="kn">import</span> <span class="nn">ConfigParser</span> <span class="k">as</span> <span class="nn">configparser</span>
    <span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">MutableMapping</span> <span class="k">as</span> <span class="n">DictMixin</span>
    <span class="n">unicode</span> <span class="o">=</span> <span class="n">unicode</span>
    <span class="n">json_loads</span> <span class="o">=</span> <span class="n">json_lds</span>
    <span class="n">exec</span><span class="p">(</span><span class="nb">compile</span><span class="p">(</span><span class="s1">&#39;def _raise(*a): raise a[0], a[1], a[2]&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;py3fix&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;exec&#39;</span><span class="p">))</span>

<span class="c1"># Some helpers for string/byte handling</span>
<div class="viewcode-block" id="tob"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.tob">[docs]</a><span class="k">def</span> <span class="nf">tob</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">enc</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">unicode</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">enc</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">bytes</span><span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">s</span><span class="p">)</span></div>


<div class="viewcode-block" id="touni"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.touni">[docs]</a><span class="k">def</span> <span class="nf">touni</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">enc</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">,</span> <span class="n">err</span><span class="o">=</span><span class="s1">&#39;strict&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">enc</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">unicode</span><span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">s</span><span class="p">)</span></div>


<span class="n">tonat</span> <span class="o">=</span> <span class="n">touni</span> <span class="k">if</span> <span class="n">py3k</span> <span class="k">else</span> <span class="n">tob</span>

<span class="c1"># 3.2 fixes cgi.FieldStorage to accept bytes (which makes a lot of sense).</span>


<span class="c1"># A bug in functools causes it to break if the wrapper is an instance method</span>
<div class="viewcode-block" id="update_wrapper"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.update_wrapper">[docs]</a><span class="k">def</span> <span class="nf">update_wrapper</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="n">wrapped</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">functools</span><span class="o">.</span><span class="n">update_wrapper</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="n">wrapped</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">pass</span></div>

<span class="c1"># These helpers are used at module level and need to be defined first.</span>
<span class="c1"># And yes, I know PEP-8, but sometimes a lower-case classname makes more sense.</span>


<div class="viewcode-block" id="depr"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.depr">[docs]</a><span class="k">def</span> <span class="nf">depr</span><span class="p">(</span><span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">,</span> <span class="n">cause</span><span class="p">,</span> <span class="n">fix</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Warning: Use of deprecated feature or API. (Deprecated in Bottle-</span><span class="si">%d</span><span class="s2">.</span><span class="si">%d</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>\
           <span class="s2">&quot;Cause: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span>\
           <span class="s2">&quot;Fix: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">,</span> <span class="n">cause</span><span class="p">,</span> <span class="n">fix</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">DEBUG</span> <span class="o">==</span> <span class="s1">&#39;strict&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">return</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></div>


<div class="viewcode-block" id="makelist"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.makelist">[docs]</a><span class="k">def</span> <span class="nf">makelist</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>  <span class="c1"># This is just too handy</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">set</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">data</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="DictProperty"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.DictProperty">[docs]</a><span class="k">class</span> <span class="nc">DictProperty</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Property that maps to a key in a local dict-like attribute. &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_only</span> <span class="o">=</span> <span class="n">attr</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">read_only</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="n">functools</span><span class="o">.</span><span class="n">update_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">updated</span><span class="o">=</span><span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getter</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">func</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="ow">or</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span>
        <span class="n">key</span><span class="p">,</span> <span class="n">storage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">storage</span><span class="p">:</span> <span class="n">storage</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getter</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">storage</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_only</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Read-Only property.&quot;</span><span class="p">)</span>
        <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attr</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__delete__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_only</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Read-Only property.&quot;</span><span class="p">)</span>
        <span class="k">del</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attr</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span></div>


<div class="viewcode-block" id="cached_property"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.cached_property">[docs]</a><span class="k">class</span> <span class="nc">cached_property</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A property that is only computed once per instance and then replaces</span>
<span class="sd">        itself with an ordinary attribute. Deleting the attribute resets the</span>
<span class="sd">        property. &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="n">update_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">func</span>

    <span class="k">def</span> <span class="nf">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span></div>


<div class="viewcode-block" id="lazy_attribute"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.lazy_attribute">[docs]</a><span class="k">class</span> <span class="nc">lazy_attribute</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A property that caches itself to the class object. &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="n">functools</span><span class="o">.</span><span class="n">update_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">updated</span><span class="o">=</span><span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getter</span> <span class="o">=</span> <span class="n">func</span>

    <span class="k">def</span> <span class="nf">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getter</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span></div>

<span class="c1">###############################################################################</span>
<span class="c1"># Exceptions and Events #######################################################</span>
<span class="c1">###############################################################################</span>


<div class="viewcode-block" id="BottleException"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BottleException">[docs]</a><span class="k">class</span> <span class="nc">BottleException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A base class for exceptions used by bottle. &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>

<span class="c1">###############################################################################</span>
<span class="c1"># Routing ######################################################################</span>
<span class="c1">###############################################################################</span>


<div class="viewcode-block" id="RouteError"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.RouteError">[docs]</a><span class="k">class</span> <span class="nc">RouteError</span><span class="p">(</span><span class="n">BottleException</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This is a base class for all routing related exceptions &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="RouteReset"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.RouteReset">[docs]</a><span class="k">class</span> <span class="nc">RouteReset</span><span class="p">(</span><span class="n">BottleException</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; If raised by a plugin or request handler, the route is reset and all</span>
<span class="sd">        plugins are re-applied. &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="RouterUnknownModeError"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.RouterUnknownModeError">[docs]</a><span class="k">class</span> <span class="nc">RouterUnknownModeError</span><span class="p">(</span><span class="n">RouteError</span><span class="p">):</span>

    <span class="k">pass</span></div>


<div class="viewcode-block" id="RouteSyntaxError"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.RouteSyntaxError">[docs]</a><span class="k">class</span> <span class="nc">RouteSyntaxError</span><span class="p">(</span><span class="n">RouteError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; The route parser found something not supported by this router. &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="RouteBuildError"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.RouteBuildError">[docs]</a><span class="k">class</span> <span class="nc">RouteBuildError</span><span class="p">(</span><span class="n">RouteError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; The route could not be built. &quot;&quot;&quot;</span></div>


<span class="k">def</span> <span class="nf">_re_flatten</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Turn all capturing groups in a regular expression pattern into</span>
<span class="sd">        non-capturing groups. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;(&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">p</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(</span><span class="se">\\</span><span class="s1">*)(\(\?P&lt;[^&gt;]+&gt;|\((?!\?))&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span>
                  <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">%</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;(?:&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>


<div class="viewcode-block" id="Router"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Router">[docs]</a><span class="k">class</span> <span class="nc">Router</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A Router is an ordered collection of route-&gt;target pairs. It is used to</span>
<span class="sd">        efficiently match WSGI requests against a number of routes and return</span>
<span class="sd">        the first target that satisfies the request. The target may be anything,</span>
<span class="sd">        usually a string, ID or callable object. A route consists of a path-rule</span>
<span class="sd">        and a HTTP method.</span>

<span class="sd">        The path-rule is either a static path (e.g. `/contact`) or a dynamic</span>
<span class="sd">        path that contains wildcards (e.g. `/wiki/&lt;page&gt;`). The wildcard syntax</span>
<span class="sd">        and details on the matching order are described in docs:`routing`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">default_pattern</span> <span class="o">=</span> <span class="s1">&#39;[^/]+&#39;</span>
    <span class="n">default_filter</span> <span class="o">=</span> <span class="s1">&#39;re&#39;</span>

    <span class="c1">#: The current CPython regexp implementation does not allow more</span>
    <span class="c1">#: than 99 matching groups per regular expression.</span>
    <span class="n">_MAX_GROUPS_PER_PATTERN</span> <span class="o">=</span> <span class="mi">99</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rules</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># All rules in order</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># index of regexes to find them in dyna_routes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">builder</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Data structure for the url builder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">static</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Search structure for static routes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dyna_routes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dyna_regexes</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Search structure for dynamic routes</span>
        <span class="c1">#: If true, static routes are no longer checked first.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strict_order</span> <span class="o">=</span> <span class="n">strict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;re&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">conf</span><span class="p">:</span> <span class="p">(</span><span class="n">_re_flatten</span><span class="p">(</span><span class="n">conf</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_pattern</span><span class="p">),</span>
                                <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="s1">&#39;int&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">conf</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;-?\d+&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">))),</span>
            <span class="s1">&#39;float&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">conf</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;-?[\d.]+&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">))),</span>
            <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">conf</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;.+?&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="p">}</span>

<div class="viewcode-block" id="Router.add_filter"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Router.add_filter">[docs]</a>    <span class="k">def</span> <span class="nf">add_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add a filter. The provided function is called with the configuration</span>
<span class="sd">        string as parameter and must return a (regexp, to_python, to_url) tuple.</span>
<span class="sd">        The first element is a string, the last two are callables or None. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span></div>

    <span class="n">rule_syntax</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;(</span><span class="se">\\\\</span><span class="s1">*)&#39;</span>
        <span class="s1">&#39;(?:(?::([a-zA-Z_][a-zA-Z_0-9]*)?()(?:#(.*?)#)?)&#39;</span>
          <span class="s1">&#39;|(?:&lt;([a-zA-Z_][a-zA-Z_0-9]*)?(?::([a-zA-Z_]*)&#39;</span>
            <span class="s1">&#39;(?::((?:</span><span class="se">\\\\</span><span class="s1">.|[^</span><span class="se">\\\\</span><span class="s1">&gt;]+)+)?)?)?&gt;))&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_itertokens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule</span><span class="p">):</span>
        <span class="n">offset</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule_syntax</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">rule</span><span class="p">):</span>
            <span class="n">prefix</span> <span class="o">+=</span> <span class="n">rule</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">match</span><span class="o">.</span><span class="n">start</span><span class="p">()]</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">depr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="s2">&quot;Use of old route syntax.&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;Use &lt;name&gt; instead of :name in routes.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># Escaped wildcard</span>
                <span class="n">prefix</span> <span class="o">+=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">]):]</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">prefix</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">prefix</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">filtr</span><span class="p">,</span> <span class="n">conf</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="k">if</span> <span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
            <span class="k">yield</span> <span class="n">name</span><span class="p">,</span> <span class="n">filtr</span> <span class="ow">or</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">conf</span> <span class="ow">or</span> <span class="kc">None</span>
            <span class="n">offset</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">(),</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span> <span class="ow">or</span> <span class="n">prefix</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">rule</span><span class="p">[</span><span class="n">offset</span><span class="p">:],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

<div class="viewcode-block" id="Router.add"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Router.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add a new rule or replace the target for an existing rule. &quot;&quot;&quot;</span>
        <span class="n">anons</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Number of anonymous wildcards found</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Names of keys</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>  <span class="c1"># Regular expression pattern with named groups</span>
        <span class="n">filters</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Lists of wildcard input filters</span>
        <span class="n">builder</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Data structure for the URL builder</span>
        <span class="n">is_static</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">conf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_itertokens</span><span class="p">(</span><span class="n">rule</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">mode</span><span class="p">:</span>
                <span class="n">is_static</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_filter</span>
                <span class="n">mask</span><span class="p">,</span> <span class="n">in_filter</span><span class="p">,</span> <span class="n">out_filter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="n">mode</span><span class="p">](</span><span class="n">conf</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="p">:</span>
                    <span class="n">pattern</span> <span class="o">+=</span> <span class="s1">&#39;(?:</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">mask</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;anon</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">anons</span>
                    <span class="n">anons</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pattern</span> <span class="o">+=</span> <span class="s1">&#39;(?P&lt;</span><span class="si">%s</span><span class="s1">&gt;</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
                    <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">in_filter</span><span class="p">:</span> <span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">in_filter</span><span class="p">))</span>
                <span class="n">builder</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">out_filter</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">key</span><span class="p">:</span>
                <span class="n">pattern</span> <span class="o">+=</span> <span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="n">builder</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="kc">None</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">builder</span><span class="p">[</span><span class="n">rule</span><span class="p">]</span> <span class="o">=</span> <span class="n">builder</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">builder</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">builder</span>

        <span class="k">if</span> <span class="n">is_static</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">strict_order</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">static</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="p">{})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">static</span><span class="p">[</span><span class="n">method</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">rule</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">re_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;^(</span><span class="si">%s</span><span class="s1">)$&#39;</span> <span class="o">%</span> <span class="n">pattern</span><span class="p">)</span>
            <span class="n">re_match</span> <span class="o">=</span> <span class="n">re_pattern</span><span class="o">.</span><span class="n">match</span>
        <span class="k">except</span> <span class="n">re</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RouteSyntaxError</span><span class="p">(</span><span class="s2">&quot;Could not add Route: </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">filters</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">getargs</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">url_args</span> <span class="o">=</span> <span class="n">re_match</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">wildcard_filter</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">url_args</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">wildcard_filter</span><span class="p">(</span><span class="n">url_args</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">HTTPError</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="s1">&#39;Path has wrong format.&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">url_args</span>
        <span class="k">elif</span> <span class="n">re_pattern</span><span class="o">.</span><span class="n">groupindex</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">getargs</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">re_match</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">getargs</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">flatpat</span> <span class="o">=</span> <span class="n">_re_flatten</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
        <span class="n">whole_rule</span> <span class="o">=</span> <span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">flatpat</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">getargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">flatpat</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Route &lt;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&gt; overwrites a previously defined route&#39;</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">rule</span><span class="p">),</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dyna_routes</span><span class="p">[</span><span class="n">method</span><span class="p">][</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span><span class="p">[</span><span class="n">flatpat</span><span class="p">,</span> <span class="n">method</span><span class="p">]]</span> <span class="o">=</span> <span class="n">whole_rule</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dyna_routes</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">whole_rule</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span><span class="p">[</span><span class="n">flatpat</span><span class="p">,</span> <span class="n">method</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dyna_routes</span><span class="p">[</span><span class="n">method</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_compile</span><span class="p">(</span><span class="n">method</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
        <span class="n">all_rules</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dyna_routes</span><span class="p">[</span><span class="n">method</span><span class="p">]</span>
        <span class="n">comborules</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dyna_regexes</span><span class="p">[</span><span class="n">method</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">maxgroups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MAX_GROUPS_PER_PATTERN</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_rules</span><span class="p">),</span> <span class="n">maxgroups</span><span class="p">):</span>
            <span class="n">some</span> <span class="o">=</span> <span class="n">all_rules</span><span class="p">[</span><span class="n">x</span><span class="p">:</span><span class="n">x</span> <span class="o">+</span> <span class="n">maxgroups</span><span class="p">]</span>
            <span class="n">combined</span> <span class="o">=</span> <span class="p">(</span><span class="n">flatpat</span> <span class="k">for</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">flatpat</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="n">some</span><span class="p">)</span>
            <span class="n">combined</span> <span class="o">=</span> <span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;(^</span><span class="si">%s</span><span class="s1">$)&#39;</span> <span class="o">%</span> <span class="n">flatpat</span> <span class="k">for</span> <span class="n">flatpat</span> <span class="ow">in</span> <span class="n">combined</span><span class="p">)</span>
            <span class="n">combined</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">combined</span><span class="p">)</span><span class="o">.</span><span class="n">match</span>
            <span class="n">rules</span> <span class="o">=</span> <span class="p">[(</span><span class="n">target</span><span class="p">,</span> <span class="n">getargs</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">getargs</span><span class="p">)</span> <span class="ow">in</span> <span class="n">some</span><span class="p">]</span>
            <span class="n">comborules</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">combined</span><span class="p">,</span> <span class="n">rules</span><span class="p">))</span>

<div class="viewcode-block" id="Router.build"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Router.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_name</span><span class="p">,</span> <span class="o">*</span><span class="n">anons</span><span class="p">,</span> <span class="o">**</span><span class="n">query</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Build an URL by filling the wildcards in a rule. &quot;&quot;&quot;</span>
        <span class="n">builder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">builder</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RouteBuildError</span><span class="p">(</span><span class="s2">&quot;No route with that name.&quot;</span><span class="p">,</span> <span class="n">_name</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">anons</span><span class="p">):</span>
                <span class="n">query</span><span class="p">[</span><span class="s1">&#39;anon</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> <span class="k">if</span> <span class="n">n</span> <span class="k">else</span> <span class="n">f</span> <span class="k">for</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="ow">in</span> <span class="n">builder</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">url</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span> <span class="k">else</span> <span class="n">url</span> <span class="o">+</span> <span class="s1">&#39;?&#39;</span> <span class="o">+</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">E</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RouteBuildError</span><span class="p">(</span><span class="s1">&#39;Missing URL argument: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">E</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="Router.match"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Router.match">[docs]</a>    <span class="k">def</span> <span class="nf">match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return a (target, url_args) tuple or raise HTTPError(400/404/405). &quot;&quot;&quot;</span>
        <span class="n">verb</span> <span class="o">=</span> <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;REQUEST_METHOD&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PATH_INFO&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="s1">&#39;/&#39;</span>

        <span class="k">if</span> <span class="n">verb</span> <span class="o">==</span> <span class="s1">&#39;HEAD&#39;</span><span class="p">:</span>
            <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PROXY&#39;</span><span class="p">,</span> <span class="n">verb</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;ANY&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PROXY&#39;</span><span class="p">,</span> <span class="n">verb</span><span class="p">,</span> <span class="s1">&#39;ANY&#39;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">static</span> <span class="ow">and</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">static</span><span class="p">[</span><span class="n">method</span><span class="p">]:</span>
                <span class="n">target</span><span class="p">,</span> <span class="n">getargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">static</span><span class="p">[</span><span class="n">method</span><span class="p">][</span><span class="n">path</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">target</span><span class="p">,</span> <span class="n">getargs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">if</span> <span class="n">getargs</span> <span class="k">else</span> <span class="p">{}</span>
            <span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dyna_regexes</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">combined</span><span class="p">,</span> <span class="n">rules</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dyna_regexes</span><span class="p">[</span><span class="n">method</span><span class="p">]:</span>
                    <span class="n">match</span> <span class="o">=</span> <span class="n">combined</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                        <span class="n">target</span><span class="p">,</span> <span class="n">getargs</span> <span class="o">=</span> <span class="n">rules</span><span class="p">[</span><span class="n">match</span><span class="o">.</span><span class="n">lastindex</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="k">return</span> <span class="n">target</span><span class="p">,</span> <span class="n">getargs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">if</span> <span class="n">getargs</span> <span class="k">else</span> <span class="p">{}</span>

        <span class="c1"># No matching route found. Collect alternative methods for 405 response</span>
        <span class="n">allowed</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="n">nocheck</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">methods</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">static</span><span class="p">)</span> <span class="o">-</span> <span class="n">nocheck</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">static</span><span class="p">[</span><span class="n">method</span><span class="p">]:</span>
                <span class="n">allowed</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dyna_regexes</span><span class="p">)</span> <span class="o">-</span> <span class="n">allowed</span> <span class="o">-</span> <span class="n">nocheck</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">combined</span><span class="p">,</span> <span class="n">rules</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dyna_regexes</span><span class="p">[</span><span class="n">method</span><span class="p">]:</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">combined</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                    <span class="n">allowed</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">allowed</span><span class="p">:</span>
            <span class="n">allow_header</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">allowed</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">HTTPError</span><span class="p">(</span><span class="mi">405</span><span class="p">,</span> <span class="s2">&quot;Method not allowed.&quot;</span><span class="p">,</span> <span class="n">Allow</span><span class="o">=</span><span class="n">allow_header</span><span class="p">)</span>

        <span class="c1"># No matching route and no alternative method found. We give up</span>
        <span class="k">raise</span> <span class="n">HTTPError</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="s2">&quot;Not found: &quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">path</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="Route"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Route">[docs]</a><span class="k">class</span> <span class="nc">Route</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This class wraps a route callback along with route specific metadata and</span>
<span class="sd">        configuration and applies Plugins on demand. It is also responsible for</span>
<span class="sd">        turing an URL path rule into a regular expression usable by the Router.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span>
                 <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">plugins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">skiplist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">):</span>
        <span class="c1">#: The application this route is installed to.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">app</span>
        <span class="c1">#: The path-rule string (e.g. ``/wiki/&lt;page&gt;``).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rule</span> <span class="o">=</span> <span class="n">rule</span>
        <span class="c1">#: The HTTP method as a string (e.g. ``GET``).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span>
        <span class="c1">#: The original callback with no plugins applied. Useful for introspection.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">callback</span>
        <span class="c1">#: The name of the route (if specified) or ``None``.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="kc">None</span>
        <span class="c1">#: A list of route-specific plugins (see :meth:`Bottle.route`).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span> <span class="o">=</span> <span class="n">plugins</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="c1">#: A list of plugins to not apply to this route (see :meth:`Bottle.route`).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skiplist</span> <span class="o">=</span> <span class="n">skiplist</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="c1">#: Additional keyword arguments passed to the :meth:`Bottle.route`</span>
        <span class="c1">#: decorator are stored in this dictionary. Used for route-specific</span>
        <span class="c1">#: plugin configuration and meta-data.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">_make_overlay</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">load_dict</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

<div class="viewcode-block" id="Route.call"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Route.call">[docs]</a>    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The route callback with all plugins applied. This property is</span>
<span class="sd">            created on demand and then cached to speed up subsequent requests.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_callback</span><span class="p">()</span></div>

<div class="viewcode-block" id="Route.reset"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Route.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Forget any cached values. The next time :attr:`call` is accessed,</span>
<span class="sd">            all plugins are re-applied. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;call&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="Route.prepare"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Route.prepare">[docs]</a>    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Do all on-demand work immediately (useful for debugging).&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call</span></div>

<div class="viewcode-block" id="Route.all_plugins"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Route.all_plugins">[docs]</a>    <span class="k">def</span> <span class="nf">all_plugins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Yield all Plugins affecting this route. &quot;&quot;&quot;</span>
        <span class="n">unique</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">plugins</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="p">):</span>
            <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skiplist</span><span class="p">:</span> <span class="k">break</span>
            <span class="n">name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">and</span> <span class="p">(</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skiplist</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">unique</span><span class="p">):</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skiplist</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skiplist</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="n">name</span><span class="p">:</span> <span class="n">unique</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">p</span></div>

    <span class="k">def</span> <span class="nf">_make_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">callback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span>
        <span class="k">for</span> <span class="n">plugin</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_plugins</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="s1">&#39;apply&#39;</span><span class="p">):</span>
                    <span class="n">callback</span> <span class="o">=</span> <span class="n">plugin</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">callback</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">callback</span> <span class="o">=</span> <span class="n">plugin</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">RouteReset</span><span class="p">:</span>  <span class="c1"># Try again with changed configuration.</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_callback</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">callback</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">:</span>
                <span class="n">update_wrapper</span><span class="p">(</span><span class="n">callback</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">callback</span>

<div class="viewcode-block" id="Route.get_undecorated_callback"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Route.get_undecorated_callback">[docs]</a>    <span class="k">def</span> <span class="nf">get_undecorated_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the callback. If the callback is a decorated function, try to</span>
<span class="sd">            recover the original function. &quot;&quot;&quot;</span>
        <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span>
        <span class="n">func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="s1">&#39;__func__&#39;</span> <span class="k">if</span> <span class="n">py3k</span> <span class="k">else</span> <span class="s1">&#39;im_func&#39;</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
        <span class="n">closure_attr</span> <span class="o">=</span> <span class="s1">&#39;__closure__&#39;</span> <span class="k">if</span> <span class="n">py3k</span> <span class="k">else</span> <span class="s1">&#39;func_closure&#39;</span>
        <span class="k">while</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">closure_attr</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">closure_attr</span><span class="p">):</span>
            <span class="n">attributes</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">closure_attr</span><span class="p">)</span>
            <span class="n">func</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cell_contents</span>

            <span class="c1"># in case of decorators with multiple arguments</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">FunctionType</span><span class="p">):</span>
                <span class="c1"># pick first FunctionType instance from multiple arguments</span>
                <span class="n">func</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">FunctionType</span><span class="p">),</span>
                              <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">cell_contents</span><span class="p">,</span> <span class="n">attributes</span><span class="p">))</span>
                <span class="n">func</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">func</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># py3 support</span>
        <span class="k">return</span> <span class="n">func</span></div>

<div class="viewcode-block" id="Route.get_callback_args"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Route.get_callback_args">[docs]</a>    <span class="k">def</span> <span class="nf">get_callback_args</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return a list of argument names the callback (most likely) accepts</span>
<span class="sd">            as keyword arguments. If the callback is a decorated function, try</span>
<span class="sd">            to recover the original function before inspection. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">getargspec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_undecorated_callback</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Route.get_config"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Route.get_config">[docs]</a>    <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Lookup a config field and return its value, first checking the</span>
<span class="sd">            route.config, then route.app.config.&quot;&quot;&quot;</span>
        <span class="n">depr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="s2">&quot;Route.get_config() is deprectated.&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;The Route.config property already includes values from the&quot;</span>
                    <span class="s2">&quot; application config for missing keys. Access it directly.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_undecorated_callback</span><span class="p">()</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%r</span><span class="s1"> </span><span class="si">%r</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="p">,</span> <span class="n">cb</span><span class="p">)</span></div>

<span class="c1">###############################################################################</span>
<span class="c1"># Application Object ###########################################################</span>
<span class="c1">###############################################################################</span>


<div class="viewcode-block" id="Bottle"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Bottle">[docs]</a><span class="k">class</span> <span class="nc">Bottle</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Each Bottle object represents a single, distinct web application and</span>
<span class="sd">        consists of routes, callbacks, plugins, resources and configuration.</span>
<span class="sd">        Instances are callable WSGI applications.</span>

<span class="sd">        :param catchall: If true (default), handle all exceptions. Turn off to</span>
<span class="sd">                         let debugging middleware handle exceptions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@lazy_attribute</span>
    <span class="k">def</span> <span class="nf">_global_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="n">cfg</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">()</span>
        <span class="n">cfg</span><span class="o">.</span><span class="n">meta_set</span><span class="p">(</span><span class="s1">&#39;catchall&#39;</span><span class="p">,</span> <span class="s1">&#39;validate&#39;</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cfg</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1">#: A :class:`ConfigDict` for app specific configuration.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_global_config</span><span class="o">.</span><span class="n">_make_overlay</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">_add_change_listener</span><span class="p">(</span>
            <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trigger_hook</span><span class="p">,</span> <span class="s1">&#39;config&#39;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s2">&quot;catchall&quot;</span><span class="p">:</span> <span class="kc">True</span>
        <span class="p">})</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;catchall&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">depr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span> <span class="s2">&quot;Bottle(catchall) keyword argument.&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;The &#39;catchall&#39; setting is now part of the app &quot;</span>
                        <span class="s2">&quot;configuration. Fix: `app.config[&#39;catchall&#39;] = False`&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;catchall&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;autojson&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">depr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="s2">&quot;Bottle(autojson) keyword argument.&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;The &#39;autojson&#39; setting is now part of the app &quot;</span>
                 <span class="s2">&quot;configuration. Fix: `app.config[&#39;json.enable&#39;] = False`&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;json.disable&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_mounts</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1">#: A :class:`ResourceManager` for application files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">ResourceManager</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">routes</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># List of installed :class:`Route` instances.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">router</span> <span class="o">=</span> <span class="n">Router</span><span class="p">()</span>  <span class="c1"># Maps requests to :class:`Route` instances.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Core plugins</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># List of installed plugins.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">install</span><span class="p">(</span><span class="n">JSONPlugin</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">install</span><span class="p">(</span><span class="n">TemplatePlugin</span><span class="p">())</span>

    <span class="c1">#: If true, most exceptions are caught and returned as :exc:`HTTPError`</span>
    <span class="n">catchall</span> <span class="o">=</span> <span class="n">DictProperty</span><span class="p">(</span><span class="s1">&#39;config&#39;</span><span class="p">,</span> <span class="s1">&#39;catchall&#39;</span><span class="p">)</span>

    <span class="n">__hook_names</span> <span class="o">=</span> <span class="s1">&#39;before_request&#39;</span><span class="p">,</span> <span class="s1">&#39;after_request&#39;</span><span class="p">,</span> <span class="s1">&#39;app_reset&#39;</span><span class="p">,</span> <span class="s1">&#39;config&#39;</span>
    <span class="n">__hook_reversed</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;after_request&#39;</span><span class="p">}</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="p">[])</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hook_names</span><span class="p">)</span>

<div class="viewcode-block" id="Bottle.add_hook"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Bottle.add_hook">[docs]</a>    <span class="k">def</span> <span class="nf">add_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Attach a callback to a hook. Three hooks are currently implemented:</span>

<span class="sd">            before_request</span>
<span class="sd">                Executed once before each request. The request context is</span>
<span class="sd">                available, but no routing has happened yet.</span>
<span class="sd">            after_request</span>
<span class="sd">                Executed once after each request regardless of its outcome.</span>
<span class="sd">            app_reset</span>
<span class="sd">                Called whenever :meth:`Bottle.reset` is called.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hook_reversed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bottle.remove_hook"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Bottle.remove_hook">[docs]</a>    <span class="k">def</span> <span class="nf">remove_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Remove a callback from a hook. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span> <span class="ow">and</span> <span class="n">func</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Bottle.trigger_hook"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Bottle.trigger_hook">[docs]</a>    <span class="k">def</span> <span class="nf">trigger_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Trigger a hook and return a list of results. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">hook</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">hook</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span><span class="p">[</span><span class="n">__name</span><span class="p">][:]]</span></div>

<div class="viewcode-block" id="Bottle.hook"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Bottle.hook">[docs]</a>    <span class="k">def</span> <span class="nf">hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return a decorator that attaches a callback to a hook. See</span>
<span class="sd">            :meth:`add_hook` for details.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_hook</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">func</span>

        <span class="k">return</span> <span class="n">decorator</span></div>

    <span class="k">def</span> <span class="nf">_mount_wsgi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="n">segments</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prefix</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">p</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">segments</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;WSGI applications cannot be mounted to &quot;/&quot;.&#39;</span><span class="p">)</span>
        <span class="n">path_depth</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">segments</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">mountpoint_wrapper</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">request</span><span class="o">.</span><span class="n">path_shift</span><span class="p">(</span><span class="n">path_depth</span><span class="p">)</span>
                <span class="n">rs</span> <span class="o">=</span> <span class="n">HTTPResponse</span><span class="p">([])</span>

                <span class="k">def</span> <span class="nf">start_response</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">headerlist</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">exc_info</span><span class="p">:</span>
                        <span class="n">_raise</span><span class="p">(</span><span class="o">*</span><span class="n">exc_info</span><span class="p">)</span>
                    <span class="n">rs</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">status</span>
                    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">headerlist</span><span class="p">:</span>
                        <span class="n">rs</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">rs</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">append</span>

                <span class="n">body</span> <span class="o">=</span> <span class="n">app</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">)</span>
                <span class="n">rs</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">rs</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span> <span class="k">if</span> <span class="n">rs</span><span class="o">.</span><span class="n">body</span> <span class="k">else</span> <span class="n">body</span>
                <span class="k">return</span> <span class="n">rs</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">request</span><span class="o">.</span><span class="n">path_shift</span><span class="p">(</span><span class="o">-</span><span class="n">path_depth</span><span class="p">)</span>

        <span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;skip&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="s1">&#39;PROXY&#39;</span><span class="p">)</span>
        <span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;mountpoint&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;prefix&#39;</span><span class="p">:</span> <span class="n">prefix</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="n">app</span><span class="p">})</span>
        <span class="n">options</span><span class="p">[</span><span class="s1">&#39;callback&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mountpoint_wrapper</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/</span><span class="si">%s</span><span class="s1">/&lt;:re:.*&gt;&#39;</span> <span class="o">%</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">segments</span><span class="p">),</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">prefix</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">segments</span><span class="p">),</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_mount_app</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">app</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mounts</span> <span class="ow">or</span> <span class="s1">&#39;_mount.app&#39;</span> <span class="ow">in</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
            <span class="n">depr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="s2">&quot;Application mounted multiple times. Falling back to WSGI mount.&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;Clone application before mounting to a different location.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mount_wsgi</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">options</span><span class="p">:</span>
            <span class="n">depr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="s2">&quot;Unsupported mount options. Falling back to WSGI mount.&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;Do not specify any route options when mounting bottle application.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mount_wsgi</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">prefix</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">):</span>
            <span class="n">depr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="s2">&quot;Prefix must end in &#39;/&#39;. Falling back to WSGI mount.&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;Consider adding an explicit redirect from &#39;/prefix&#39; to &#39;/prefix/&#39; in the parent application.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mount_wsgi</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_mounts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
        <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;_mount.prefix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prefix</span>
        <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;_mount.app&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="p">:</span>
            <span class="n">route</span><span class="o">.</span><span class="n">rule</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">route</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="n">route</span><span class="p">)</span>

<div class="viewcode-block" id="Bottle.mount"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Bottle.mount">[docs]</a>    <span class="k">def</span> <span class="nf">mount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Mount an application (:class:`Bottle` or plain WSGI) to a specific</span>
<span class="sd">            URL prefix. Example::</span>

<span class="sd">                parent_app.mount(&#39;/prefix/&#39;, child_app)</span>

<span class="sd">            :param prefix: path prefix or `mount-point`.</span>
<span class="sd">            :param app: an instance of :class:`Bottle` or a WSGI application.</span>

<span class="sd">            Plugins from the parent application are not applied to the routes</span>
<span class="sd">            of the mounted child application. If you need plugins in the child</span>
<span class="sd">            application, install them separately.</span>

<span class="sd">            While it is possible to use path wildcards within the prefix path</span>
<span class="sd">            (:class:`Bottle` childs only), it is highly discouraged.</span>

<span class="sd">            The prefix path must end with a slash. If you want to access the</span>
<span class="sd">            root of the child application via `/prefix` in addition to</span>
<span class="sd">            `/prefix/`, consider adding a route with a 307 redirect to the</span>
<span class="sd">            parent application.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">prefix</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Prefix must start with &#39;/&#39;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">Bottle</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mount_app</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mount_wsgi</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bottle.merge"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Bottle.merge">[docs]</a>    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">routes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Merge the routes of another :class:`Bottle` application or a list of</span>
<span class="sd">            :class:`Route` objects into this application. The routes keep their</span>
<span class="sd">            &#39;owner&#39;, meaning that the :data:`Route.app` attribute is not</span>
<span class="sd">            changed. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">routes</span><span class="p">,</span> <span class="n">Bottle</span><span class="p">):</span>
            <span class="n">routes</span> <span class="o">=</span> <span class="n">routes</span><span class="o">.</span><span class="n">routes</span>
        <span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">routes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="n">route</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bottle.install"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Bottle.install">[docs]</a>    <span class="k">def</span> <span class="nf">install</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plugin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add a plugin to the list of plugins and prepare it for being</span>
<span class="sd">            applied to all routes of this application. A plugin may be a simple</span>
<span class="sd">            decorator or an object that implements the :class:`Plugin` API.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="s1">&#39;setup&#39;</span><span class="p">):</span> <span class="n">plugin</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">plugin</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="s1">&#39;apply&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Plugins must be callable or implement .apply()&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plugin</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">plugin</span></div>

<div class="viewcode-block" id="Bottle.uninstall"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Bottle.uninstall">[docs]</a>    <span class="k">def</span> <span class="nf">uninstall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plugin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Uninstall plugins. Pass an instance to remove a specific plugin, a type</span>
<span class="sd">            object to remove all plugins that match that type, a string to remove</span>
<span class="sd">            all plugins with a matching ``name`` attribute or ``True`` to remove all</span>
<span class="sd">            plugins. Return the list of removed plugins. &quot;&quot;&quot;</span>
        <span class="n">removed</span><span class="p">,</span> <span class="n">remove</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">plugin</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">plugin</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">remove</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">remove</span> <span class="ow">is</span> <span class="n">plugin</span> <span class="ow">or</span> <span class="n">remove</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">(</span><span class="n">plugin</span><span class="p">)</span> \
            <span class="ow">or</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="n">remove</span><span class="p">:</span>
                <span class="n">removed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plugin</span><span class="p">)</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">):</span> <span class="n">plugin</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">removed</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">removed</span></div>

<div class="viewcode-block" id="Bottle.reset"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Bottle.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">route</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Reset all routes (force plugins to be re-applied) and clear all</span>
<span class="sd">            caches. If an ID or route object is given, only that specific route</span>
<span class="sd">            is affected. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">route</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">routes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">routes</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">route</span><span class="p">,</span> <span class="n">Route</span><span class="p">):</span> <span class="n">routes</span> <span class="o">=</span> <span class="p">[</span><span class="n">route</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">routes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="p">[</span><span class="n">route</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">routes</span><span class="p">:</span>
            <span class="n">route</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">routes</span><span class="p">:</span>
                <span class="n">route</span><span class="o">.</span><span class="n">prepare</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trigger_hook</span><span class="p">(</span><span class="s1">&#39;app_reset&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bottle.close"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Bottle.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Close the application and all installed plugins. &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">plugin</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">):</span> <span class="n">plugin</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="Bottle.run"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Bottle.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Calls :func:`run` with the same parameters. &quot;&quot;&quot;</span>
        <span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bottle.match"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Bottle.match">[docs]</a>    <span class="k">def</span> <span class="nf">match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Search for a matching route and return a (:class:`Route` , urlargs)</span>
<span class="sd">            tuple. The second value is a dictionary with parameters extracted</span>
<span class="sd">            from the URL. Raise :exc:`HTTPError` (404/405) on a non-match.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">environ</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bottle.get_url"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Bottle.get_url">[docs]</a>    <span class="k">def</span> <span class="nf">get_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">routename</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return a string that matches a named route &quot;&quot;&quot;</span>
        <span class="n">scriptname</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SCRIPT_NAME&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span>
        <span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">routename</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">urljoin</span><span class="p">(</span><span class="n">urljoin</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">scriptname</span><span class="p">),</span> <span class="n">location</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bottle.add_route"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Bottle.add_route">[docs]</a>    <span class="k">def</span> <span class="nf">add_route</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">route</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add a route object, but do not change the :data:`Route.app`</span>
<span class="sd">            attribute.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">route</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">route</span><span class="o">.</span><span class="n">rule</span><span class="p">,</span> <span class="n">route</span><span class="o">.</span><span class="n">method</span><span class="p">,</span> <span class="n">route</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">route</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="n">route</span><span class="o">.</span><span class="n">prepare</span><span class="p">()</span></div>

<div class="viewcode-block" id="Bottle.route"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Bottle.route">[docs]</a>    <span class="k">def</span> <span class="nf">route</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
              <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span>
              <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">apply</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">skip</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A decorator to bind a function to a request URL. Example::</span>

<span class="sd">                @app.route(&#39;/hello/&lt;name&gt;&#39;)</span>
<span class="sd">                def hello(name):</span>
<span class="sd">                    return &#39;Hello %s&#39; % name</span>

<span class="sd">            The ``&lt;name&gt;`` part is a wildcard. See :class:`Router` for syntax</span>
<span class="sd">            details.</span>

<span class="sd">            :param path: Request path or a list of paths to listen to. If no</span>
<span class="sd">              path is specified, it is automatically generated from the</span>
<span class="sd">              signature of the function.</span>
<span class="sd">            :param method: HTTP method (`GET`, `POST`, `PUT`, ...) or a list of</span>
<span class="sd">              methods to listen to. (default: `GET`)</span>
<span class="sd">            :param callback: An optional shortcut to avoid the decorator</span>
<span class="sd">              syntax. ``route(..., callback=func)`` equals ``route(...)(func)``</span>
<span class="sd">            :param name: The name for this route. (default: None)</span>
<span class="sd">            :param apply: A decorator or plugin or a list of plugins. These are</span>
<span class="sd">              applied to the route callback in addition to installed plugins.</span>
<span class="sd">            :param skip: A list of plugins, plugin classes or names. Matching</span>
<span class="sd">              plugins are not installed to this route. ``True`` skips all.</span>

<span class="sd">            Any additional keyword arguments are stored as route-specific</span>
<span class="sd">            configuration and passed to plugins (see :meth:`Plugin.apply`).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">path</span><span class="p">):</span> <span class="n">path</span><span class="p">,</span> <span class="n">callback</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">path</span>
        <span class="n">plugins</span> <span class="o">=</span> <span class="n">makelist</span><span class="p">(</span><span class="n">apply</span><span class="p">)</span>
        <span class="n">skiplist</span> <span class="o">=</span> <span class="n">makelist</span><span class="p">(</span><span class="n">skip</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">callback</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">callback</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span> <span class="n">callback</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">makelist</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">or</span> <span class="n">yieldroutes</span><span class="p">(</span><span class="n">callback</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">verb</span> <span class="ow">in</span> <span class="n">makelist</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
                    <span class="n">verb</span> <span class="o">=</span> <span class="n">verb</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                    <span class="n">route</span> <span class="o">=</span> <span class="n">Route</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="n">verb</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span>
                                  <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                                  <span class="n">plugins</span><span class="o">=</span><span class="n">plugins</span><span class="p">,</span>
                                  <span class="n">skiplist</span><span class="o">=</span><span class="n">skiplist</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="n">route</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">callback</span>

        <span class="k">return</span> <span class="n">decorator</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span> <span class="k">if</span> <span class="n">callback</span> <span class="k">else</span> <span class="n">decorator</span></div>

<div class="viewcode-block" id="Bottle.get"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Bottle.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Equals :meth:`route`. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bottle.post"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Bottle.post">[docs]</a>    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Equals :meth:`route` with a ``POST`` method parameter. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bottle.put"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Bottle.put">[docs]</a>    <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;PUT&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Equals :meth:`route` with a ``PUT`` method parameter. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bottle.delete"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Bottle.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;DELETE&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Equals :meth:`route` with a ``DELETE`` method parameter. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bottle.patch"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Bottle.patch">[docs]</a>    <span class="k">def</span> <span class="nf">patch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;PATCH&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Equals :meth:`route` with a ``PATCH`` method parameter. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bottle.error"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Bottle.error">[docs]</a>    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Register an output handler for a HTTP error code. Can</span>
<span class="sd">            be used as a decorator or called directly ::</span>

<span class="sd">                def error_handler_500(error):</span>
<span class="sd">                    return &#39;error_handler_500&#39;</span>

<span class="sd">                app.error(code=500, callback=error_handler_500)</span>

<span class="sd">                @app.error(404)</span>
<span class="sd">                def error_handler_404(error):</span>
<span class="sd">                    return &#39;error_handler_404&#39;</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">callback</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">callback</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span> <span class="n">callback</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">code</span><span class="p">)]</span> <span class="o">=</span> <span class="n">callback</span>
            <span class="k">return</span> <span class="n">callback</span>

        <span class="k">return</span> <span class="n">decorator</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span> <span class="k">if</span> <span class="n">callback</span> <span class="k">else</span> <span class="n">decorator</span></div>

<div class="viewcode-block" id="Bottle.default_error_handler"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Bottle.default_error_handler">[docs]</a>    <span class="k">def</span> <span class="nf">default_error_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">res</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">tob</span><span class="p">(</span><span class="n">template</span><span class="p">(</span><span class="n">ERROR_PAGE_TEMPLATE</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="n">res</span><span class="p">,</span> <span class="n">template_settings</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;__ERROR_PAGE_TEMPLATE&#39;</span><span class="p">)))</span></div>

    <span class="k">def</span> <span class="nf">_handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;bottle.raw_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PATH_INFO&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">py3k</span><span class="p">:</span>
            <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PATH_INFO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;latin1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

        <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;bottle.app&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">request</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">environ</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">bind</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span> <span class="c1"># Remove in 0.14 together with RouteReset</span>
                <span class="n">out</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">trigger_hook</span><span class="p">(</span><span class="s1">&#39;before_request&#39;</span><span class="p">)</span>
                    <span class="n">route</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">environ</span><span class="p">)</span>
                    <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;route.handle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">route</span>
                    <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;bottle.route&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">route</span>
                    <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;route.url_args&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">route</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">except</span> <span class="n">HTTPResponse</span> <span class="k">as</span> <span class="n">E</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">E</span>
                    <span class="k">break</span>
                <span class="k">except</span> <span class="n">RouteReset</span><span class="p">:</span>
                    <span class="n">depr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="s2">&quot;RouteReset exception deprecated&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;Call route.call() after route.reset() and &quot;</span>
                                <span class="s2">&quot;return the result.&quot;</span><span class="p">)</span>
                    <span class="n">route</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
                    <span class="k">continue</span>
                <span class="k">finally</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">HTTPResponse</span><span class="p">):</span>
                        <span class="n">out</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">trigger_hook</span><span class="p">(</span><span class="s1">&#39;after_request&#39;</span><span class="p">)</span>
                    <span class="k">except</span> <span class="n">HTTPResponse</span> <span class="k">as</span> <span class="n">E</span><span class="p">:</span>
                        <span class="n">out</span> <span class="o">=</span> <span class="n">E</span>
                        <span class="n">out</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyboardInterrupt</span><span class="p">,</span> <span class="ne">SystemExit</span><span class="p">,</span> <span class="ne">MemoryError</span><span class="p">):</span>
            <span class="k">raise</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">E</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">catchall</span><span class="p">:</span> <span class="k">raise</span>
            <span class="n">stacktrace</span> <span class="o">=</span> <span class="n">format_exc</span><span class="p">()</span>
            <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;wsgi.errors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">stacktrace</span><span class="p">)</span>
            <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;wsgi.errors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">HTTPError</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="s2">&quot;Internal Server Error&quot;</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">stacktrace</span><span class="p">)</span>
            <span class="n">out</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">_cast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">peek</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Try to convert the parameter into something WSGI compatible and set</span>
<span class="sd">        correct HTTP headers when possible.</span>
<span class="sd">        Support: False, str, unicode, dict, HTTPResponse, HTTPError, file-like,</span>
<span class="sd">        iterable of strings and iterable of unicodes</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Empty output is done here</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">out</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;Content-Length&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
                <span class="n">response</span><span class="p">[</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="c1"># Join lists of byte or unicode strings. Mixed lists are NOT supported</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span>\
        <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">unicode</span><span class="p">)):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>  <span class="c1"># b&#39;abc&#39;[0:0] -&gt; b&#39;&#39;</span>
        <span class="c1"># Encode unicode strings</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">unicode</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">charset</span><span class="p">)</span>
        <span class="c1"># Byte Strings are just returned</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;Content-Length&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
                <span class="n">response</span><span class="p">[</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">out</span><span class="p">]</span>
        <span class="c1"># HTTPError or HTTPException (recursive, because they may wrap anything)</span>
        <span class="c1"># TODO: Handle these explicitly in handle() or make them iterable.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">HTTPError</span><span class="p">):</span>
            <span class="n">out</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_handler</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">default_error_handler</span><span class="p">)(</span><span class="n">out</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cast</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">HTTPResponse</span><span class="p">):</span>
            <span class="n">out</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cast</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>

        <span class="c1"># File-like objects.</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="s1">&#39;read&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;wsgi.file_wrapper&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;wsgi.file_wrapper&#39;</span><span class="p">](</span><span class="n">out</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">WSGIFileWrapper</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

        <span class="c1"># Handle Iterables. We peek into them to detect their inner type.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">iout</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="n">first</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">iout</span><span class="p">)</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">first</span><span class="p">:</span>
                <span class="n">first</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">iout</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cast</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">HTTPResponse</span> <span class="k">as</span> <span class="n">E</span><span class="p">:</span>
            <span class="n">first</span> <span class="o">=</span> <span class="n">E</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyboardInterrupt</span><span class="p">,</span> <span class="ne">SystemExit</span><span class="p">,</span> <span class="ne">MemoryError</span><span class="p">):</span>
            <span class="k">raise</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">catchall</span><span class="p">:</span> <span class="k">raise</span>
            <span class="n">first</span> <span class="o">=</span> <span class="n">HTTPError</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;Unhandled exception&#39;</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">format_exc</span><span class="p">())</span>

        <span class="c1"># These are the inner types allowed in iterator or generator objects.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">HTTPResponse</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cast</span><span class="p">(</span><span class="n">first</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="n">new_iter</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">([</span><span class="n">first</span><span class="p">],</span> <span class="n">iout</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">unicode</span><span class="p">):</span>
            <span class="n">encoder</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">charset</span><span class="p">)</span>
            <span class="n">new_iter</span> <span class="o">=</span> <span class="n">imap</span><span class="p">(</span><span class="n">encoder</span><span class="p">,</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">([</span><span class="n">first</span><span class="p">],</span> <span class="n">iout</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Unsupported response type: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">first</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cast</span><span class="p">(</span><span class="n">HTTPError</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="n">msg</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">):</span>
            <span class="n">new_iter</span> <span class="o">=</span> <span class="n">_closeiter</span><span class="p">(</span><span class="n">new_iter</span><span class="p">,</span> <span class="n">out</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_iter</span>

<div class="viewcode-block" id="Bottle.wsgi"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Bottle.wsgi">[docs]</a>    <span class="k">def</span> <span class="nf">wsgi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The bottle WSGI-interface. &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cast</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="p">(</span><span class="n">environ</span><span class="p">))</span>
            <span class="c1"># rfc2616 section 4.3</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">_status_code</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">304</span><span class="p">)</span>\
            <span class="ow">or</span> <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;REQUEST_METHOD&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;HEAD&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">):</span> <span class="n">out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">start_response</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">_status_line</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">headerlist</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">out</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyboardInterrupt</span><span class="p">,</span> <span class="ne">SystemExit</span><span class="p">,</span> <span class="ne">MemoryError</span><span class="p">):</span>
            <span class="k">raise</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">E</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">catchall</span><span class="p">:</span> <span class="k">raise</span>
            <span class="n">err</span> <span class="o">=</span> <span class="s1">&#39;&lt;h1&gt;Critical error while processing request: </span><span class="si">%s</span><span class="s1">&lt;/h1&gt;&#39;</span> \
                  <span class="o">%</span> <span class="n">html_escape</span><span class="p">(</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PATH_INFO&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
                <span class="n">err</span> <span class="o">+=</span> <span class="s1">&#39;&lt;h2&gt;Error:&lt;/h2&gt;</span><span class="se">\n</span><span class="s1">&lt;pre&gt;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&lt;/pre&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> \
                       <span class="s1">&#39;&lt;h2&gt;Traceback:&lt;/h2&gt;</span><span class="se">\n</span><span class="s1">&lt;pre&gt;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&lt;/pre&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> \
                       <span class="o">%</span> <span class="p">(</span><span class="n">html_escape</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">E</span><span class="p">)),</span> <span class="n">html_escape</span><span class="p">(</span><span class="n">format_exc</span><span class="p">()))</span>
            <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;wsgi.errors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;wsgi.errors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/html; charset=UTF-8&#39;</span><span class="p">)]</span>
            <span class="n">start_response</span><span class="p">(</span><span class="s1">&#39;500 INTERNAL SERVER ERROR&#39;</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">())</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">tob</span><span class="p">(</span><span class="n">err</span><span class="p">)]</span></div>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Each instance of :class:&#39;Bottle&#39; is a WSGI application. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsgi</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Use this application as default for all module-level shortcuts. &quot;&quot;&quot;</span>
        <span class="n">default_app</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="n">default_app</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Attribute </span><span class="si">%s</span><span class="s2"> already defined. Plugin conflict?&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>


<span class="c1">###############################################################################</span>
<span class="c1"># HTTP and WSGI Tools ##########################################################</span>
<span class="c1">###############################################################################</span>


<div class="viewcode-block" id="BaseRequest"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BaseRequest">[docs]</a><span class="k">class</span> <span class="nc">BaseRequest</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A wrapper for WSGI environment dictionaries that adds a lot of</span>
<span class="sd">        convenient access methods and properties. Most of them are read-only.</span>

<span class="sd">        Adding new attributes to a request actually adds them to the environ</span>
<span class="sd">        dictionary (as &#39;bottle.request.ext.&lt;name&gt;&#39;). This is the recommended</span>
<span class="sd">        way to store and access request-specific data.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;environ&#39;</span><span class="p">,</span> <span class="p">)</span>

    <span class="c1">#: Maximum size of memory buffer for :attr:`body` in bytes.</span>
    <span class="n">MEMFILE_MAX</span> <span class="o">=</span> <span class="mi">102400</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Wrap a WSGI environ dictionary. &quot;&quot;&quot;</span>
        <span class="c1">#: The wrapped WSGI environ dictionary. This is the only real attribute.</span>
        <span class="c1">#: All other attributes actually are read-only properties.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">environ</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">environ</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">environ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;bottle.request&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>

<div class="viewcode-block" id="BaseRequest.app"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BaseRequest.app">[docs]</a>    <span class="nd">@DictProperty</span><span class="p">(</span><span class="s1">&#39;environ&#39;</span><span class="p">,</span> <span class="s1">&#39;bottle.app&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">app</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Bottle application handling this request. &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;This request is not connected to an application.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseRequest.route"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BaseRequest.route">[docs]</a>    <span class="nd">@DictProperty</span><span class="p">(</span><span class="s1">&#39;environ&#39;</span><span class="p">,</span> <span class="s1">&#39;bottle.route&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">route</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The bottle :class:`Route` object that matches this request. &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;This request is not connected to a route.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseRequest.url_args"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BaseRequest.url_args">[docs]</a>    <span class="nd">@DictProperty</span><span class="p">(</span><span class="s1">&#39;environ&#39;</span><span class="p">,</span> <span class="s1">&#39;route.url_args&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">url_args</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The arguments extracted from the URL. &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;This request is not connected to a route.&#39;</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The value of ``PATH_INFO`` with exactly one prefixed slash (to fix</span>
<span class="sd">            broken clients and avoid the &quot;empty path&quot; edge case). &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PATH_INFO&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The ``REQUEST_METHOD`` value as an uppercase string. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;REQUEST_METHOD&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

<div class="viewcode-block" id="BaseRequest.headers"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BaseRequest.headers">[docs]</a>    <span class="nd">@DictProperty</span><span class="p">(</span><span class="s1">&#39;environ&#39;</span><span class="p">,</span> <span class="s1">&#39;bottle.request.headers&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A :class:`WSGIHeaderDict` that provides case-insensitive access to</span>
<span class="sd">            HTTP request headers. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">WSGIHeaderDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseRequest.get_header"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BaseRequest.get_header">[docs]</a>    <span class="k">def</span> <span class="nf">get_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the value of a request header, or a given default value. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseRequest.cookies"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BaseRequest.cookies">[docs]</a>    <span class="nd">@DictProperty</span><span class="p">(</span><span class="s1">&#39;environ&#39;</span><span class="p">,</span> <span class="s1">&#39;bottle.request.cookies&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">cookies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Cookies parsed into a :class:`FormsDict`. Signed cookies are NOT</span>
<span class="sd">            decoded. Use :meth:`get_cookie` if you expect signed cookies. &quot;&quot;&quot;</span>
        <span class="n">cookies</span> <span class="o">=</span> <span class="n">SimpleCookie</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_COOKIE&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">FormsDict</span><span class="p">((</span><span class="n">c</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cookies</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseRequest.get_cookie"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BaseRequest.get_cookie">[docs]</a>    <span class="k">def</span> <span class="nf">get_cookie</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">secret</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">digestmod</span><span class="o">=</span><span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the content of a cookie. To read a `Signed Cookie`, the</span>
<span class="sd">            `secret` must match the one used to create the cookie (see</span>
<span class="sd">            :meth:`BaseResponse.set_cookie`). If anything goes wrong (missing</span>
<span class="sd">            cookie or wrong signature), return a default value. &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cookies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">secret</span><span class="p">:</span>
            <span class="c1"># See BaseResponse.set_cookie for details on signed cookies.</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;?&#39;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="n">sig</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">tob</span><span class="p">,</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                <span class="nb">hash</span> <span class="o">=</span> <span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">tob</span><span class="p">(</span><span class="n">secret</span><span class="p">),</span> <span class="n">msg</span><span class="p">,</span> <span class="n">digestmod</span><span class="o">=</span><span class="n">digestmod</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">_lscmp</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="nb">hash</span><span class="p">)):</span>
                    <span class="n">dst</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">dst</span> <span class="ow">and</span> <span class="n">dst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">dst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">default</span>
        <span class="k">return</span> <span class="n">value</span> <span class="ow">or</span> <span class="n">default</span></div>

<div class="viewcode-block" id="BaseRequest.query"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BaseRequest.query">[docs]</a>    <span class="nd">@DictProperty</span><span class="p">(</span><span class="s1">&#39;environ&#39;</span><span class="p">,</span> <span class="s1">&#39;bottle.request.query&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The :attr:`query_string` parsed into a :class:`FormsDict`. These</span>
<span class="sd">            values are sometimes called &quot;URL arguments&quot; or &quot;GET parameters&quot;, but</span>
<span class="sd">            not to be confused with &quot;URL wildcards&quot; as they are provided by the</span>
<span class="sd">            :class:`Router`. &quot;&quot;&quot;</span>
        <span class="n">get</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;bottle.get&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormsDict</span><span class="p">()</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="n">_parse_qsl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QUERY_STRING&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
            <span class="n">get</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">get</span></div>

<div class="viewcode-block" id="BaseRequest.forms"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BaseRequest.forms">[docs]</a>    <span class="nd">@DictProperty</span><span class="p">(</span><span class="s1">&#39;environ&#39;</span><span class="p">,</span> <span class="s1">&#39;bottle.request.forms&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">forms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Form values parsed from an `url-encoded` or `multipart/form-data`</span>
<span class="sd">            encoded POST or PUT request body. The result is returned as a</span>
<span class="sd">            :class:`FormsDict`. All keys and values are strings. File uploads</span>
<span class="sd">            are stored separately in :attr:`files`. &quot;&quot;&quot;</span>
        <span class="n">forms</span> <span class="o">=</span> <span class="n">FormsDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">allitems</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">FileUpload</span><span class="p">):</span>
                <span class="n">forms</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
        <span class="k">return</span> <span class="n">forms</span></div>

<div class="viewcode-block" id="BaseRequest.params"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BaseRequest.params">[docs]</a>    <span class="nd">@DictProperty</span><span class="p">(</span><span class="s1">&#39;environ&#39;</span><span class="p">,</span> <span class="s1">&#39;bottle.request.params&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A :class:`FormsDict` with the combined values of :attr:`query` and</span>
<span class="sd">            :attr:`forms`. File uploads are stored in :attr:`files`. &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">FormsDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">allitems</span><span class="p">():</span>
            <span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">forms</span><span class="o">.</span><span class="n">allitems</span><span class="p">():</span>
            <span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">params</span></div>

<div class="viewcode-block" id="BaseRequest.files"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BaseRequest.files">[docs]</a>    <span class="nd">@DictProperty</span><span class="p">(</span><span class="s1">&#39;environ&#39;</span><span class="p">,</span> <span class="s1">&#39;bottle.request.files&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; File uploads parsed from `multipart/form-data` encoded POST or PUT</span>
<span class="sd">            request body. The values are instances of :class:`FileUpload`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">FormsDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">allitems</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">FileUpload</span><span class="p">):</span>
                <span class="n">files</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
        <span class="k">return</span> <span class="n">files</span></div>

<div class="viewcode-block" id="BaseRequest.json"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BaseRequest.json">[docs]</a>    <span class="nd">@DictProperty</span><span class="p">(</span><span class="s1">&#39;environ&#39;</span><span class="p">,</span> <span class="s1">&#39;bottle.request.json&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">json</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; If the ``Content-Type`` header is ``application/json`` or</span>
<span class="sd">            ``application/json-rpc``, this property holds the parsed content</span>
<span class="sd">            of the request body. Only requests smaller than :attr:`MEMFILE_MAX`</span>
<span class="sd">            are processed to avoid memory exhaustion.</span>
<span class="sd">            Invalid JSON raises a 400 error response.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ctype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CONTENT_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ctype</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;application/json&#39;</span><span class="p">,</span> <span class="s1">&#39;application/json-rpc&#39;</span><span class="p">):</span>
            <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_body_string</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">b</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">json_loads</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">HTTPError</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="s1">&#39;Invalid JSON&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

    <span class="k">def</span> <span class="nf">_iter_body</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">read</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">):</span>
        <span class="n">maxread</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_length</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">maxread</span><span class="p">:</span>
            <span class="n">part</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">maxread</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">part</span><span class="p">:</span> <span class="k">break</span>
            <span class="k">yield</span> <span class="n">part</span>
            <span class="n">maxread</span> <span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_iter_chunked</span><span class="p">(</span><span class="n">read</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">):</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">HTTPError</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="s1">&#39;Error while parsing chunked transfer body.&#39;</span><span class="p">)</span>
        <span class="n">rn</span><span class="p">,</span> <span class="n">sem</span><span class="p">,</span> <span class="n">bs</span> <span class="o">=</span> <span class="n">tob</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">tob</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">),</span> <span class="n">tob</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">header</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">!=</span> <span class="n">rn</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">header</span> <span class="o">+=</span> <span class="n">c</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="p">:</span> <span class="k">raise</span> <span class="n">err</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">bufsize</span><span class="p">:</span> <span class="k">raise</span> <span class="n">err</span>
            <span class="n">size</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="n">sem</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">maxread</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tonat</span><span class="p">(</span><span class="n">size</span><span class="o">.</span><span class="n">strip</span><span class="p">()),</span> <span class="mi">16</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">err</span>
            <span class="k">if</span> <span class="n">maxread</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">break</span>
            <span class="n">buff</span> <span class="o">=</span> <span class="n">bs</span>
            <span class="k">while</span> <span class="n">maxread</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">buff</span><span class="p">:</span>
                    <span class="n">buff</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">maxread</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">))</span>
                <span class="n">part</span><span class="p">,</span> <span class="n">buff</span> <span class="o">=</span> <span class="n">buff</span><span class="p">[:</span><span class="n">maxread</span><span class="p">],</span> <span class="n">buff</span><span class="p">[</span><span class="n">maxread</span><span class="p">:]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">part</span><span class="p">:</span> <span class="k">raise</span> <span class="n">err</span>
                <span class="k">yield</span> <span class="n">part</span>
                <span class="n">maxread</span> <span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="n">rn</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">err</span>

    <span class="nd">@DictProperty</span><span class="p">(</span><span class="s1">&#39;environ&#39;</span><span class="p">,</span> <span class="s1">&#39;bottle.request.body&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_body</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">read_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;wsgi.input&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;wsgi.input&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;wsgi.input&#39;</span><span class="p">]</span>
        <span class="n">body_iter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_chunked</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunked</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_body</span>
        <span class="n">body</span><span class="p">,</span> <span class="n">body_size</span><span class="p">,</span> <span class="n">is_temp_file</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">body_iter</span><span class="p">(</span><span class="n">read_func</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">MEMFILE_MAX</span><span class="p">):</span>
            <span class="n">body</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
            <span class="n">body_size</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_temp_file</span> <span class="ow">and</span> <span class="n">body_size</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">MEMFILE_MAX</span><span class="p">:</span>
                <span class="n">body</span><span class="p">,</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">TemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+b&#39;</span><span class="p">),</span> <span class="n">body</span>
                <span class="n">body</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
                <span class="k">del</span> <span class="n">tmp</span>
                <span class="n">is_temp_file</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;wsgi.input&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">body</span>
        <span class="n">body</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">body</span>

    <span class="k">def</span> <span class="nf">_get_body_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; read body until content-length or MEMFILE_MAX into a string. Raise</span>
<span class="sd">            HTTPError(413) on requests that are to large. &quot;&quot;&quot;</span>
        <span class="n">clen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_length</span>
        <span class="k">if</span> <span class="n">clen</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">MEMFILE_MAX</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPError</span><span class="p">(</span><span class="mi">413</span><span class="p">,</span> <span class="s1">&#39;Request entity too large&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">clen</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">clen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MEMFILE_MAX</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">clen</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">MEMFILE_MAX</span><span class="p">:</span>  <span class="c1"># Fail fast</span>
            <span class="k">raise</span> <span class="n">HTTPError</span><span class="p">(</span><span class="mi">413</span><span class="p">,</span> <span class="s1">&#39;Request entity too large&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">body</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The HTTP request body as a seek-able file-like object. Depending on</span>
<span class="sd">            :attr:`MEMFILE_MAX`, this is either a temporary file or a</span>
<span class="sd">            :class:`io.BytesIO` instance. Accessing this property for the first</span>
<span class="sd">            time reads and replaces the ``wsgi.input`` environ variable.</span>
<span class="sd">            Subsequent accesses just do a `seek(0)` on the file object. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_body</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_body</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">chunked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; True if Chunked transfer encoding was. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;chunked&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s1">&#39;HTTP_TRANSFER_ENCODING&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="c1">#: An alias for :attr:`query`.</span>
    <span class="n">GET</span> <span class="o">=</span> <span class="n">query</span>

<div class="viewcode-block" id="BaseRequest.POST"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BaseRequest.POST">[docs]</a>    <span class="nd">@DictProperty</span><span class="p">(</span><span class="s1">&#39;environ&#39;</span><span class="p">,</span> <span class="s1">&#39;bottle.request.post&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">POST</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The values of :attr:`forms` and :attr:`files` combined into a single</span>
<span class="sd">            :class:`FormsDict`. Values are either strings (form values) or</span>
<span class="sd">            instances of :class:`cgi.FieldStorage` (file uploads).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">post</span> <span class="o">=</span> <span class="n">FormsDict</span><span class="p">()</span>
        <span class="c1"># We default to application/x-www-form-urlencoded for everything that</span>
        <span class="c1"># is not multipart and take the fast path (also: 3.1 workaround)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_type</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;multipart/&#39;</span><span class="p">):</span>
            <span class="n">pairs</span> <span class="o">=</span> <span class="n">_parse_qsl</span><span class="p">(</span><span class="n">tonat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_body_string</span><span class="p">(),</span> <span class="s1">&#39;latin1&#39;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
                <span class="n">post</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">return</span> <span class="n">post</span>

        <span class="n">safe_env</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;QUERY_STRING&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">}</span>  <span class="c1"># Build a safe environment for cgi</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;REQUEST_METHOD&#39;</span><span class="p">,</span> <span class="s1">&#39;CONTENT_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;CONTENT_LENGTH&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span> <span class="n">safe_env</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">fp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="n">environ</span><span class="o">=</span><span class="n">safe_env</span><span class="p">,</span> <span class="n">keep_blank_values</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">py3k</span><span class="p">:</span>
            <span class="n">args</span><span class="p">[</span><span class="s1">&#39;encoding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;utf8&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">cgi</span><span class="o">.</span><span class="n">FieldStorage</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;_cgi.FieldStorage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>  <span class="c1">#http://bugs.python.org/issue18394</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">list</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">filename</span><span class="p">:</span>
                <span class="n">post</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">FileUpload</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">file</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                             <span class="n">item</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">post</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">value</span>
        <span class="k">return</span> <span class="n">post</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The full request URI including hostname and scheme. If your app</span>
<span class="sd">            lives behind a reverse proxy or load balancer and you get confusing</span>
<span class="sd">            results, make sure that the ``X-Forwarded-Host`` header is set</span>
<span class="sd">            correctly. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlparts</span><span class="o">.</span><span class="n">geturl</span><span class="p">()</span>

<div class="viewcode-block" id="BaseRequest.urlparts"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BaseRequest.urlparts">[docs]</a>    <span class="nd">@DictProperty</span><span class="p">(</span><span class="s1">&#39;environ&#39;</span><span class="p">,</span> <span class="s1">&#39;bottle.request.urlparts&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">urlparts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The :attr:`url` string as an :class:`urlparse.SplitResult` tuple.</span>
<span class="sd">            The tuple contains (scheme, host, path, query_string and fragment),</span>
<span class="sd">            but the fragment is always empty because it is not visible to the</span>
<span class="sd">            server. &quot;&quot;&quot;</span>
        <span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span>
        <span class="n">http</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_X_FORWARDED_PROTO&#39;</span><span class="p">)</span> \
             <span class="ow">or</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wsgi.url_scheme&#39;</span><span class="p">,</span> <span class="s1">&#39;http&#39;</span><span class="p">)</span>
        <span class="n">host</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_X_FORWARDED_HOST&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_HOST&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">host</span><span class="p">:</span>
            <span class="c1"># HTTP 1.1 requires a Host-header. This is for HTTP/1.0 clients.</span>
            <span class="n">host</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SERVER_NAME&#39;</span><span class="p">,</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">)</span>
            <span class="n">port</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SERVER_PORT&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">port</span> <span class="ow">and</span> <span class="n">port</span> <span class="o">!=</span> <span class="p">(</span><span class="s1">&#39;80&#39;</span> <span class="k">if</span> <span class="n">http</span> <span class="o">==</span> <span class="s1">&#39;http&#39;</span> <span class="k">else</span> <span class="s1">&#39;443&#39;</span><span class="p">):</span>
                <span class="n">host</span> <span class="o">+=</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">port</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">urlquote</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fullpath</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">UrlSplitResult</span><span class="p">(</span><span class="n">http</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QUERY_STRING&#39;</span><span class="p">),</span> <span class="s1">&#39;&#39;</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fullpath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Request path including :attr:`script_name` (if present). &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">script_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">query_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The raw :attr:`query` part of the URL (everything in between ``?``</span>
<span class="sd">            and ``#``) as a string. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QUERY_STRING&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">script_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The initial portion of the URL&#39;s `path` that was removed by a higher</span>
<span class="sd">            level (server or routing middleware) before the application was</span>
<span class="sd">            called. This script path is returned with leading and tailing</span>
<span class="sd">            slashes. &quot;&quot;&quot;</span>
        <span class="n">script_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SCRIPT_NAME&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">script_name</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="k">if</span> <span class="n">script_name</span> <span class="k">else</span> <span class="s1">&#39;/&#39;</span>

<div class="viewcode-block" id="BaseRequest.path_shift"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BaseRequest.path_shift">[docs]</a>    <span class="k">def</span> <span class="nf">path_shift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Shift path segments from :attr:`path` to :attr:`script_name` and</span>
<span class="sd">            vice versa.</span>

<span class="sd">           :param shift: The number of path segments to shift. May be negative</span>
<span class="sd">                         to change the shift direction. (default: 1)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">script</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">path_shift</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SCRIPT_NAME&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">shift</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;SCRIPT_NAME&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;PATH_INFO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">script</span><span class="p">,</span> <span class="n">path</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">content_length</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The request body length as an integer. The client is responsible to</span>
<span class="sd">            set this header. Otherwise, the real length of the body is unknown</span>
<span class="sd">            and -1 is returned. In this case, :attr:`body` will be empty. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CONTENT_LENGTH&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">content_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The Content-Type header as a lowercase-string (default: empty). &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CONTENT_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_xhr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; True if the request was triggered by a XMLHttpRequest. This only</span>
<span class="sd">            works with JavaScript libraries that support the `X-Requested-With`</span>
<span class="sd">            header (most of the popular libraries do). &quot;&quot;&quot;</span>
        <span class="n">requested_with</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_X_REQUESTED_WITH&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">requested_with</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;xmlhttprequest&#39;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_ajax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Alias for :attr:`is_xhr`. &quot;Ajax&quot; is not the right term. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_xhr</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">auth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; HTTP authentication data as a (user, password) tuple. This</span>
<span class="sd">            implementation currently supports basic (not digest) authentication</span>
<span class="sd">            only. If the authentication happened at a higher level (e.g. in the</span>
<span class="sd">            front web-server or a middleware), the password field is None, but</span>
<span class="sd">            the user field is looked up from the ``REMOTE_USER`` environ</span>
<span class="sd">            variable. On any errors, None is returned. &quot;&quot;&quot;</span>
        <span class="n">basic</span> <span class="o">=</span> <span class="n">parse_auth</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_AUTHORIZATION&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">basic</span><span class="p">:</span> <span class="k">return</span> <span class="n">basic</span>
        <span class="n">ruser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;REMOTE_USER&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ruser</span><span class="p">:</span> <span class="k">return</span> <span class="p">(</span><span class="n">ruser</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">remote_route</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A list of all IPs that were involved in this request, starting with</span>
<span class="sd">            the client IP and followed by zero or more proxies. This does only</span>
<span class="sd">            work if all proxies support the ```X-Forwarded-For`` header. Note</span>
<span class="sd">            that this information can be forged by malicious clients. &quot;&quot;&quot;</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_X_FORWARDED_FOR&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">proxy</span><span class="p">:</span> <span class="k">return</span> <span class="p">[</span><span class="n">ip</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="n">proxy</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>
        <span class="n">remote</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;REMOTE_ADDR&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">remote</span><span class="p">]</span> <span class="k">if</span> <span class="n">remote</span> <span class="k">else</span> <span class="p">[]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">remote_addr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The client IP as a string. Note that this information can be forged</span>
<span class="sd">            by malicious clients. &quot;&quot;&quot;</span>
        <span class="n">route</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_route</span>
        <span class="k">return</span> <span class="n">route</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">route</span> <span class="k">else</span> <span class="kc">None</span>

<div class="viewcode-block" id="BaseRequest.copy"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BaseRequest.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return a new :class:`Request` with a shallow :attr:`environ` copy. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span></div>

<div class="viewcode-block" id="BaseRequest.get"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BaseRequest.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">del</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>

<div class="viewcode-block" id="BaseRequest.keys"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BaseRequest.keys">[docs]</a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Change an environ value and clear all caches that depend on it. &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bottle.request.readonly&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;The environ dictionary is read-only.&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">todelete</span> <span class="o">=</span> <span class="p">()</span>

        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;wsgi.input&#39;</span><span class="p">:</span>
            <span class="n">todelete</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">,</span> <span class="s1">&#39;forms&#39;</span><span class="p">,</span> <span class="s1">&#39;files&#39;</span><span class="p">,</span> <span class="s1">&#39;params&#39;</span><span class="p">,</span> <span class="s1">&#39;post&#39;</span><span class="p">,</span> <span class="s1">&#39;json&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;QUERY_STRING&#39;</span><span class="p">:</span>
            <span class="n">todelete</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;query&#39;</span><span class="p">,</span> <span class="s1">&#39;params&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;HTTP_&#39;</span><span class="p">):</span>
            <span class="n">todelete</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;headers&#39;</span><span class="p">,</span> <span class="s1">&#39;cookies&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">todelete</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;bottle.request.&#39;</span> <span class="o">+</span> <span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Search in self.environ for additional user defined attributes. &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;bottle.request.ext.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">var</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="s1">&#39;__get__&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">var</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Attribute </span><span class="si">%r</span><span class="s1"> not defined.&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;environ&#39;</span><span class="p">:</span> <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;bottle.request.ext.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Attribute already defined: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__delattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;bottle.request.ext.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Attribute not defined: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_hkey</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
    <span class="k">if</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">key</span> <span class="ow">or</span> <span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">key</span> <span class="ow">or</span> <span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Header names must not contain control characters: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">key</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_hval</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">tonat</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">value</span> <span class="ow">or</span> <span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">value</span> <span class="ow">or</span> <span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Header value must not contain control characters: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>

<div class="viewcode-block" id="HeaderProperty"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.HeaderProperty">[docs]</a><span class="k">class</span> <span class="nc">HeaderProperty</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">reader</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">writer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span> <span class="o">=</span> <span class="n">reader</span><span class="p">,</span> <span class="n">writer</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s1">&#39;Current value of the </span><span class="si">%r</span><span class="s1"> header.&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">get_header</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="k">else</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">obj</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span> <span class="k">else</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__delete__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">del</span> <span class="n">obj</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span></div>


<div class="viewcode-block" id="BaseResponse"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BaseResponse">[docs]</a><span class="k">class</span> <span class="nc">BaseResponse</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Storage class for a response body as well as headers and cookies.</span>

<span class="sd">        This class does support dict-like case-insensitive item-access to</span>
<span class="sd">        headers, but is NOT a dict. Most notably, iterating over a response</span>
<span class="sd">        yields parts of the body and not the headers.</span>

<span class="sd">        :param body: The response body as one of the supported types.</span>
<span class="sd">        :param status: Either an HTTP status code (e.g. 200) or a status line</span>
<span class="sd">                       including the reason phrase (e.g. &#39;200 OK&#39;).</span>
<span class="sd">        :param headers: A dictionary or a list of name-value pairs.</span>

<span class="sd">        Additional keyword arguments are added to the list of headers.</span>
<span class="sd">        Underscores in the header name are replaced with dashes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">default_status</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="n">default_content_type</span> <span class="o">=</span> <span class="s1">&#39;text/html; charset=UTF-8&#39;</span>

    <span class="c1"># Header blacklist for specific response codes</span>
    <span class="c1"># (rfc2616 section 10.2.3 and 10.3.5)</span>
    <span class="n">bad_headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mi">204</span><span class="p">:</span> <span class="nb">frozenset</span><span class="p">((</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;Content-Length&#39;</span><span class="p">)),</span>
        <span class="mi">304</span><span class="p">:</span> <span class="nb">frozenset</span><span class="p">((</span><span class="s1">&#39;Allow&#39;</span><span class="p">,</span> <span class="s1">&#39;Content-Encoding&#39;</span><span class="p">,</span> <span class="s1">&#39;Content-Language&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;Content-Length&#39;</span><span class="p">,</span> <span class="s1">&#39;Content-Range&#39;</span><span class="p">,</span> <span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;Content-Md5&#39;</span><span class="p">,</span> <span class="s1">&#39;Last-Modified&#39;</span><span class="p">))</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">more_headers</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cookies</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">body</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">status</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_status</span>
        <span class="k">if</span> <span class="n">headers</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">headers</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">more_headers</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">more_headers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

<div class="viewcode-block" id="BaseResponse.copy"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BaseResponse.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a copy of self. &quot;&quot;&quot;</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">cls</span> <span class="ow">or</span> <span class="n">BaseResponse</span>
        <span class="k">assert</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">BaseResponse</span><span class="p">)</span>
        <span class="n">copy</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">copy</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span>
        <span class="n">copy</span><span class="o">.</span><span class="n">_headers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">[:])</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cookies</span><span class="p">:</span>
            <span class="n">copy</span><span class="o">.</span><span class="n">_cookies</span> <span class="o">=</span> <span class="n">SimpleCookie</span><span class="p">()</span>
            <span class="n">copy</span><span class="o">.</span><span class="n">_cookies</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cookies</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">copy</span></div>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>

<div class="viewcode-block" id="BaseResponse.close"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BaseResponse.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">status_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The HTTP status line as a string (e.g. ``404 Not Found``).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status_line</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">status_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The HTTP status code as an integer (e.g. 404).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status_code</span>

    <span class="k">def</span> <span class="nf">_set_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">code</span><span class="p">,</span> <span class="n">status</span> <span class="o">=</span> <span class="n">status</span><span class="p">,</span> <span class="n">_HTTP_STATUS_LINES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39; &#39;</span> <span class="ow">in</span> <span class="n">status</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">code</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">status</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;String status line without a reason phrase.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="mi">100</span> <span class="o">&lt;=</span> <span class="n">code</span> <span class="o">&lt;=</span> <span class="mi">999</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Status code out of range.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status_code</span> <span class="o">=</span> <span class="n">code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status_line</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">status</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> Unknown&#39;</span> <span class="o">%</span> <span class="n">code</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_get_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status_line</span>

    <span class="n">status</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span>
        <span class="n">_get_status</span><span class="p">,</span> <span class="n">_set_status</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
        <span class="sd">&#39;&#39;&#39; A writeable property to change the HTTP response status. It accepts</span>
<span class="sd">            either a numeric code (100-999) or a string with a custom reason</span>
<span class="sd">            phrase (e.g. &quot;404 Brain not found&quot;). Both :data:`status_line` and</span>
<span class="sd">            :data:`status_code` are updated accordingly. The return value is</span>
<span class="sd">            always a status string. &#39;&#39;&#39;</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">_get_status</span><span class="p">,</span> <span class="n">_set_status</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; An instance of :class:`HeaderDict`, a case-insensitive dict-like</span>
<span class="sd">            view on the response headers. &quot;&quot;&quot;</span>
        <span class="n">hdict</span> <span class="o">=</span> <span class="n">HeaderDict</span><span class="p">()</span>
        <span class="n">hdict</span><span class="o">.</span><span class="n">dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span>
        <span class="k">return</span> <span class="n">hdict</span>

    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_hkey</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span>

    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">[</span><span class="n">_hkey</span><span class="p">(</span><span class="n">name</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">[</span><span class="n">_hkey</span><span class="p">(</span><span class="n">name</span><span class="p">)][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">[</span><span class="n">_hkey</span><span class="p">(</span><span class="n">name</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="n">_hval</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span>

<div class="viewcode-block" id="BaseResponse.get_header"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BaseResponse.get_header">[docs]</a>    <span class="k">def</span> <span class="nf">get_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the value of a previously defined header. If there is no</span>
<span class="sd">            header with that name, return a default value. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_hkey</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="p">[</span><span class="n">default</span><span class="p">])[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="BaseResponse.set_header"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BaseResponse.set_header">[docs]</a>    <span class="k">def</span> <span class="nf">set_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create a new response header, replacing any previously defined</span>
<span class="sd">            headers with the same name. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">[</span><span class="n">_hkey</span><span class="p">(</span><span class="n">name</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="n">_hval</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span></div>

<div class="viewcode-block" id="BaseResponse.add_header"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BaseResponse.add_header">[docs]</a>    <span class="k">def</span> <span class="nf">add_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add an additional response header, not removing duplicates. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">_hkey</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_hval</span><span class="p">(</span><span class="n">value</span><span class="p">))</span></div>

<div class="viewcode-block" id="BaseResponse.iter_headers"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BaseResponse.iter_headers">[docs]</a>    <span class="k">def</span> <span class="nf">iter_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Yield (header, value) tuples, skipping headers that are not</span>
<span class="sd">            allowed with the current response status code. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">headerlist</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">headerlist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; WSGI conform list of (header, value) tuples. &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="k">if</span> <span class="s1">&#39;Content-Type&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">:</span>
            <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">default_content_type</span><span class="p">]))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status_code</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bad_headers</span><span class="p">:</span>
            <span class="n">bad_headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bad_headers</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_status_code</span><span class="p">]</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="n">h</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">headers</span> <span class="k">if</span> <span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bad_headers</span><span class="p">]</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">vals</span><span class="p">)</span> <span class="ow">in</span> <span class="n">headers</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cookies</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cookies</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Set-Cookie&#39;</span><span class="p">,</span> <span class="n">_hval</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">OutputString</span><span class="p">())))</span>
        <span class="k">if</span> <span class="n">py3k</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin1&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">out</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="n">content_type</span> <span class="o">=</span> <span class="n">HeaderProperty</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">)</span>
    <span class="n">content_length</span> <span class="o">=</span> <span class="n">HeaderProperty</span><span class="p">(</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">,</span> <span class="n">reader</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">expires</span> <span class="o">=</span> <span class="n">HeaderProperty</span><span class="p">(</span>
        <span class="s1">&#39;Expires&#39;</span><span class="p">,</span>
        <span class="n">reader</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">parse_date</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span>
        <span class="n">writer</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">http_date</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">charset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the charset specified in the content-type header (default: utf8). &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;charset=&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_type</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;charset=&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">default</span>

<div class="viewcode-block" id="BaseResponse.set_cookie"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BaseResponse.set_cookie">[docs]</a>    <span class="k">def</span> <span class="nf">set_cookie</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">secret</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">digestmod</span><span class="o">=</span><span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create a new cookie or replace an old one. If the `secret` parameter is</span>
<span class="sd">            set, create a `Signed Cookie` (described below).</span>

<span class="sd">            :param name: the name of the cookie.</span>
<span class="sd">            :param value: the value of the cookie.</span>
<span class="sd">            :param secret: a signature key required for signed cookies.</span>

<span class="sd">            Additionally, this method accepts all RFC 2109 attributes that are</span>
<span class="sd">            supported by :class:`cookie.Morsel`, including:</span>

<span class="sd">            :param max_age: maximum age in seconds. (default: None)</span>
<span class="sd">            :param expires: a datetime object or UNIX timestamp. (default: None)</span>
<span class="sd">            :param domain: the domain that is allowed to read the cookie.</span>
<span class="sd">              (default: current domain)</span>
<span class="sd">            :param path: limits the cookie to a given path (default: current path)</span>
<span class="sd">            :param secure: limit the cookie to HTTPS connections (default: off).</span>
<span class="sd">            :param httponly: prevents client-side javascript to read this cookie</span>
<span class="sd">              (default: off, requires Python 2.6 or newer).</span>
<span class="sd">            :param same_site: disables third-party use for a cookie.</span>
<span class="sd">              Allowed attributes: `lax` and `strict`.</span>
<span class="sd">              In strict mode the cookie will never be sent.</span>
<span class="sd">              In lax mode the cookie is only sent with a top-level GET request.</span>

<span class="sd">            If neither `expires` nor `max_age` is set (default), the cookie will</span>
<span class="sd">            expire at the end of the browser session (as soon as the browser</span>
<span class="sd">            window is closed).</span>

<span class="sd">            Signed cookies may store any pickle-able object and are</span>
<span class="sd">            cryptographically signed to prevent manipulation. Keep in mind that</span>
<span class="sd">            cookies are limited to 4kb in most browsers.</span>

<span class="sd">            Warning: Pickle is a potentially dangerous format. If an attacker</span>
<span class="sd">            gains access to the secret key, he could forge cookies that execute</span>
<span class="sd">            code on server side if unpickeld. Using pickle is discouraged and</span>
<span class="sd">            support for it will be removed in later versions of bottle.</span>

<span class="sd">            Warning: Signed cookies are not encrypted (the client can still see</span>
<span class="sd">            the content) and not copy-protected (the client can restore an old</span>
<span class="sd">            cookie). The main intention is to make pickling and unpickling</span>
<span class="sd">            save, not to store secret information at client side.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cookies</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cookies</span> <span class="o">=</span> <span class="n">SimpleCookie</span><span class="p">()</span>

        <span class="c1"># To add &quot;SameSite&quot; cookie support.</span>
        <span class="n">Morsel</span><span class="o">.</span><span class="n">_reserved</span><span class="p">[</span><span class="s1">&#39;same-site&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;SameSite&#39;</span>

        <span class="k">if</span> <span class="n">secret</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                <span class="n">depr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="s2">&quot;Pickling of arbitrary objects into cookies is &quot;</span>
                            <span class="s2">&quot;deprecated.&quot;</span><span class="p">,</span> <span class="s2">&quot;Only store strings in cookies. &quot;</span>
                            <span class="s2">&quot;JSON strings are fine, too.&quot;</span><span class="p">)</span>
            <span class="n">encoded</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">([</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">sig</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">tob</span><span class="p">(</span><span class="n">secret</span><span class="p">),</span> <span class="n">encoded</span><span class="p">,</span>
                                            <span class="n">digestmod</span><span class="o">=</span><span class="n">digestmod</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">())</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">touni</span><span class="p">(</span><span class="n">tob</span><span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">sig</span> <span class="o">+</span> <span class="n">tob</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">encoded</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Secret key required for non-string cookies.&#39;</span><span class="p">)</span>

        <span class="c1"># Cookie size plus options must not exceed 4kb.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3800</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Content does not fit into a cookie.&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;max_age&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">timedelta</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">seconds</span> <span class="o">+</span> <span class="n">value</span><span class="o">.</span><span class="n">days</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">3600</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;expires&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="n">datedate</span><span class="p">,</span> <span class="n">datetime</span><span class="p">)):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">timetuple</span><span class="p">()</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%a, </span><span class="si">%d</span><span class="s2"> %b %Y %H:%M:%S GMT&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="c1"># check values for SameSite cookie, because it&#39;s not natively supported by http.cookies.</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;same_site&#39;</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;lax&#39;</span><span class="p">,</span> <span class="s1">&#39;strict&#39;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">CookieError</span><span class="p">(</span><span class="s2">&quot;Invalid attribute </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,))</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;secure&#39;</span><span class="p">,</span> <span class="s1">&#39;httponly&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cookies</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="BaseResponse.delete_cookie"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BaseResponse.delete_cookie">[docs]</a>    <span class="k">def</span> <span class="nf">delete_cookie</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Delete a cookie. Be sure to use the same `domain` and `path`</span>
<span class="sd">            settings as used to create the cookie. &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;max_age&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;expires&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_cookie</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">headerlist</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">out</span></div>


<span class="k">def</span> <span class="nf">_local_property</span><span class="p">():</span>
    <span class="n">ls</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">local</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">fget</span><span class="p">(</span><span class="n">_</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ls</span><span class="o">.</span><span class="n">var</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Request context not initialized.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fset</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">ls</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">fdel</span><span class="p">(</span><span class="n">_</span><span class="p">):</span>
        <span class="k">del</span> <span class="n">ls</span><span class="o">.</span><span class="n">var</span>

    <span class="k">return</span> <span class="nb">property</span><span class="p">(</span><span class="n">fget</span><span class="p">,</span> <span class="n">fset</span><span class="p">,</span> <span class="n">fdel</span><span class="p">,</span> <span class="s1">&#39;Thread-local property&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="LocalRequest"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.LocalRequest">[docs]</a><span class="k">class</span> <span class="nc">LocalRequest</span><span class="p">(</span><span class="n">BaseRequest</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A thread-local subclass of :class:`BaseRequest` with a different</span>
<span class="sd">        set of attributes for each thread. There is usually only one global</span>
<span class="sd">        instance of this class (:data:`request`). If accessed during a</span>
<span class="sd">        request/response cycle, this instance always refers to the *current*</span>
<span class="sd">        request (even on a multithreaded server). &quot;&quot;&quot;</span>
    <span class="n">bind</span> <span class="o">=</span> <span class="n">BaseRequest</span><span class="o">.</span><span class="fm">__init__</span>
    <span class="n">environ</span> <span class="o">=</span> <span class="n">_local_property</span><span class="p">()</span></div>


<div class="viewcode-block" id="LocalResponse"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.LocalResponse">[docs]</a><span class="k">class</span> <span class="nc">LocalResponse</span><span class="p">(</span><span class="n">BaseResponse</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A thread-local subclass of :class:`BaseResponse` with a different</span>
<span class="sd">        set of attributes for each thread. There is usually only one global</span>
<span class="sd">        instance of this class (:data:`response`). Its attributes are used</span>
<span class="sd">        to build the HTTP response at the end of the request/response cycle.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bind</span> <span class="o">=</span> <span class="n">BaseResponse</span><span class="o">.</span><span class="fm">__init__</span>
    <span class="n">_status_line</span> <span class="o">=</span> <span class="n">_local_property</span><span class="p">()</span>
    <span class="n">_status_code</span> <span class="o">=</span> <span class="n">_local_property</span><span class="p">()</span>
    <span class="n">_cookies</span> <span class="o">=</span> <span class="n">_local_property</span><span class="p">()</span>
    <span class="n">_headers</span> <span class="o">=</span> <span class="n">_local_property</span><span class="p">()</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">_local_property</span><span class="p">()</span></div>


<span class="n">Request</span> <span class="o">=</span> <span class="n">BaseRequest</span>
<span class="n">Response</span> <span class="o">=</span> <span class="n">BaseResponse</span>


<div class="viewcode-block" id="HTTPResponse"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.HTTPResponse">[docs]</a><span class="k">class</span> <span class="nc">HTTPResponse</span><span class="p">(</span><span class="n">Response</span><span class="p">,</span> <span class="n">BottleException</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">more_headers</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">HTTPResponse</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="o">**</span><span class="n">more_headers</span><span class="p">)</span>

<div class="viewcode-block" id="HTTPResponse.apply"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.HTTPResponse.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">other</span><span class="o">.</span><span class="n">_status_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status_code</span>
        <span class="n">other</span><span class="o">.</span><span class="n">_status_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status_line</span>
        <span class="n">other</span><span class="o">.</span><span class="n">_headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span>
        <span class="n">other</span><span class="o">.</span><span class="n">_cookies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cookies</span>
        <span class="n">other</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span></div></div>


<div class="viewcode-block" id="HTTPError"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.HTTPError">[docs]</a><span class="k">class</span> <span class="nc">HTTPError</span><span class="p">(</span><span class="n">HTTPResponse</span><span class="p">):</span>
    <span class="n">default_status</span> <span class="o">=</span> <span class="mi">500</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">status</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">body</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">exception</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">traceback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">more_headers</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exception</span> <span class="o">=</span> <span class="n">exception</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">traceback</span> <span class="o">=</span> <span class="n">traceback</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">HTTPError</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="o">**</span><span class="n">more_headers</span><span class="p">)</span></div>

<span class="c1">###############################################################################</span>
<span class="c1"># Plugins ######################################################################</span>
<span class="c1">###############################################################################</span>


<div class="viewcode-block" id="PluginError"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.PluginError">[docs]</a><span class="k">class</span> <span class="nc">PluginError</span><span class="p">(</span><span class="n">BottleException</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="JSONPlugin"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.JSONPlugin">[docs]</a><span class="k">class</span> <span class="nc">JSONPlugin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;json&#39;</span>
    <span class="n">api</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">json_dumps</span><span class="o">=</span><span class="n">json_dumps</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">json_dumps</span> <span class="o">=</span> <span class="n">json_dumps</span>

<div class="viewcode-block" id="JSONPlugin.setup"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.JSONPlugin.setup">[docs]</a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">):</span>
        <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">_define</span><span class="p">(</span><span class="s1">&#39;json.enable&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="nb">bool</span><span class="p">,</span>
                          <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Enable or disable automatic dict-&gt;json filter.&quot;</span><span class="p">)</span>
        <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">_define</span><span class="p">(</span><span class="s1">&#39;json.ascii&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="nb">bool</span><span class="p">,</span>
                          <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Use only 7-bit ASCII characters in output.&quot;</span><span class="p">)</span>
        <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">_define</span><span class="p">(</span><span class="s1">&#39;json.indent&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="nb">bool</span><span class="p">,</span>
                          <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Add whitespace to make json more readable.&quot;</span><span class="p">)</span>
        <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">_define</span><span class="p">(</span><span class="s1">&#39;json.dump_func&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">help</span><span class="o">=</span><span class="s2">&quot;If defined, use this function to transform&quot;</span>
                               <span class="s2">&quot; dict into json. The other options no longer&quot;</span>
                               <span class="s2">&quot; apply.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="JSONPlugin.apply"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.JSONPlugin.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">route</span><span class="p">):</span>
        <span class="n">dumps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_dumps</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_dumps</span><span class="p">:</span> <span class="k">return</span> <span class="n">callback</span>

        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">rv</span> <span class="o">=</span> <span class="n">callback</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">HTTPResponse</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
                <span class="n">rv</span> <span class="o">=</span> <span class="n">resp</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rv</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="c1">#Attempt to serialize, raises exception on failure</span>
                <span class="n">json_response</span> <span class="o">=</span> <span class="n">dumps</span><span class="p">(</span><span class="n">rv</span><span class="p">)</span>
                <span class="c1">#Set content type only if serialization successful</span>
                <span class="n">response</span><span class="o">.</span><span class="n">content_type</span> <span class="o">=</span> <span class="s1">&#39;application/json&#39;</span>
                <span class="k">return</span> <span class="n">json_response</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rv</span><span class="p">,</span> <span class="n">HTTPResponse</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rv</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">rv</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">dumps</span><span class="p">(</span><span class="n">rv</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
                <span class="n">rv</span><span class="o">.</span><span class="n">content_type</span> <span class="o">=</span> <span class="s1">&#39;application/json&#39;</span>
            <span class="k">return</span> <span class="n">rv</span>

        <span class="k">return</span> <span class="n">wrapper</span></div></div>


<div class="viewcode-block" id="TemplatePlugin"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.TemplatePlugin">[docs]</a><span class="k">class</span> <span class="nc">TemplatePlugin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This plugin applies the :func:`view` decorator to all routes with a</span>
<span class="sd">        `template` config parameter. If the parameter is a tuple, the second</span>
<span class="sd">        element must be a dict with additional options (e.g. `template_engine`)</span>
<span class="sd">        or default variables for the template. &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;template&#39;</span>
    <span class="n">api</span> <span class="o">=</span> <span class="mi">2</span>

<div class="viewcode-block" id="TemplatePlugin.setup"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.TemplatePlugin.setup">[docs]</a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">):</span>
        <span class="n">app</span><span class="o">.</span><span class="n">tpl</span> <span class="o">=</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="TemplatePlugin.apply"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.TemplatePlugin.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">route</span><span class="p">):</span>
        <span class="n">conf</span> <span class="o">=</span> <span class="n">route</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;template&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">view</span><span class="p">(</span><span class="n">conf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">**</span><span class="n">conf</span><span class="p">[</span><span class="mi">1</span><span class="p">])(</span><span class="n">callback</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">view</span><span class="p">(</span><span class="n">conf</span><span class="p">)(</span><span class="n">callback</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">callback</span></div></div>


<span class="c1">#: Not a plugin, but part of the plugin API. TODO: Find a better place.</span>
<span class="k">class</span> <span class="nc">_ImportRedirect</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">impmask</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create a virtual package that redirects imports (see PEP 302). &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">impmask</span> <span class="o">=</span> <span class="n">impmask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">imp</span><span class="o">.</span><span class="n">new_module</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s1">&#39;__file__&#39;</span><span class="p">:</span> <span class="vm">__file__</span><span class="p">,</span>
            <span class="s1">&#39;__path__&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;__all__&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;__loader__&#39;</span><span class="p">:</span> <span class="bp">self</span>
        <span class="p">})</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">meta_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">find_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullname</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;.&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fullname</span><span class="p">:</span> <span class="k">return</span>
        <span class="n">packname</span> <span class="o">=</span> <span class="n">fullname</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">packname</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="k">return</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">load_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullname</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">fullname</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span> <span class="k">return</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">fullname</span><span class="p">]</span>
        <span class="n">modname</span> <span class="o">=</span> <span class="n">fullname</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">realname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">impmask</span> <span class="o">%</span> <span class="n">modname</span>
        <span class="nb">__import__</span><span class="p">(</span><span class="n">realname</span><span class="p">)</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">fullname</span><span class="p">]</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">realname</span><span class="p">]</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">modname</span><span class="p">,</span> <span class="n">module</span><span class="p">)</span>
        <span class="n">module</span><span class="o">.</span><span class="n">__loader__</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="n">module</span>

<span class="c1">###############################################################################</span>
<span class="c1"># Common Utilities #############################################################</span>
<span class="c1">###############################################################################</span>


<div class="viewcode-block" id="MultiDict"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.MultiDict">[docs]</a><span class="k">class</span> <span class="nc">MultiDict</span><span class="p">(</span><span class="n">DictMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This dict stores multiple values per key, but behaves exactly like a</span>
<span class="sd">        normal dict in that it returns only the newest value for any given key.</span>
<span class="sd">        There are special methods available to access the full list of values.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="p">[</span><span class="n">v</span><span class="p">])</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span>

    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

<div class="viewcode-block" id="MultiDict.keys"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.MultiDict.keys">[docs]</a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span></div>

    <span class="k">if</span> <span class="n">py3k</span><span class="p">:</span>

        <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

        <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

        <span class="k">def</span> <span class="nf">allitems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">vl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vl</span><span class="p">)</span>

        <span class="n">iterkeys</span> <span class="o">=</span> <span class="n">keys</span>
        <span class="n">itervalues</span> <span class="o">=</span> <span class="n">values</span>
        <span class="n">iteritems</span> <span class="o">=</span> <span class="n">items</span>
        <span class="n">iterallitems</span> <span class="o">=</span> <span class="n">allitems</span>

    <span class="k">else</span><span class="p">:</span>

<div class="viewcode-block" id="MultiDict.values"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.MultiDict.values">[docs]</a>        <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span></div>

<div class="viewcode-block" id="MultiDict.items"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.MultiDict.items">[docs]</a>        <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span></div>

<div class="viewcode-block" id="MultiDict.iterkeys"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.MultiDict.iterkeys">[docs]</a>        <span class="k">def</span> <span class="nf">iterkeys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">()</span></div>

<div class="viewcode-block" id="MultiDict.itervalues"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.MultiDict.itervalues">[docs]</a>        <span class="k">def</span> <span class="nf">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">itervalues</span><span class="p">())</span></div>

<div class="viewcode-block" id="MultiDict.iteritems"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.MultiDict.iteritems">[docs]</a>        <span class="k">def</span> <span class="nf">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">())</span></div>

<div class="viewcode-block" id="MultiDict.iterallitems"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.MultiDict.iterallitems">[docs]</a>        <span class="k">def</span> <span class="nf">iterallitems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">vl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vl</span><span class="p">)</span></div>

<div class="viewcode-block" id="MultiDict.allitems"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.MultiDict.allitems">[docs]</a>        <span class="k">def</span> <span class="nf">allitems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">vl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vl</span><span class="p">]</span></div>

<div class="viewcode-block" id="MultiDict.get"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.MultiDict.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the most recent value for a key.</span>

<span class="sd">            :param default: The default value to be returned if the key is not</span>
<span class="sd">                   present or the type conversion fails.</span>
<span class="sd">            :param index: An index for the list of available values.</span>
<span class="sd">            :param type: If defined, this callable is used to cast the value</span>
<span class="sd">                    into a specific type. Exception are suppressed and result in</span>
<span class="sd">                    the default value to be returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">if</span> <span class="nb">type</span> <span class="k">else</span> <span class="n">val</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">default</span></div>

<div class="viewcode-block" id="MultiDict.append"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.MultiDict.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add a new value to the list of values for this key. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="MultiDict.replace"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.MultiDict.replace">[docs]</a>    <span class="k">def</span> <span class="nf">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Replace the list of values with a single value. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span></div>

<div class="viewcode-block" id="MultiDict.getall"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.MultiDict.getall">[docs]</a>    <span class="k">def</span> <span class="nf">getall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return a (possibly empty) list of values for a key. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]</span></div>

    <span class="c1">#: Aliases for WTForms to mimic other multi-dict APIs (Django)</span>
    <span class="n">getone</span> <span class="o">=</span> <span class="n">get</span>
    <span class="n">getlist</span> <span class="o">=</span> <span class="n">getall</span></div>


<div class="viewcode-block" id="FormsDict"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.FormsDict">[docs]</a><span class="k">class</span> <span class="nc">FormsDict</span><span class="p">(</span><span class="n">MultiDict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This :class:`MultiDict` subclass is used to store request form data.</span>
<span class="sd">        Additionally to the normal dict-like item access methods (which return</span>
<span class="sd">        unmodified data as native strings), this container also supports</span>
<span class="sd">        attribute-like access to its values. Attributes are automatically de-</span>
<span class="sd">        or recoded to match :attr:`input_encoding` (default: &#39;utf8&#39;). Missing</span>
<span class="sd">        attributes default to an empty string. &quot;&quot;&quot;</span>

    <span class="c1">#: Encoding used for attribute values.</span>
    <span class="n">input_encoding</span> <span class="o">=</span> <span class="s1">&#39;utf8&#39;</span>
    <span class="c1">#: If true (default), unicode strings are first encoded with `latin1`</span>
    <span class="c1">#: and then decoded to match :attr:`input_encoding`.</span>
    <span class="n">recode_unicode</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_fix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">unicode</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">recode_unicode</span><span class="p">:</span>  <span class="c1"># Python 3 WSGI</span>
            <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;latin1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_encoding</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>  <span class="c1"># Python 2 WSGI</span>
            <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_encoding</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span>

<div class="viewcode-block" id="FormsDict.decode"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.FormsDict.decode">[docs]</a>    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a copy with all keys and values de- or recoded to match</span>
<span class="sd">            :attr:`input_encoding`. Some libraries (e.g. WTForms) want a</span>
<span class="sd">            unicode dictionary. &quot;&quot;&quot;</span>
        <span class="n">copy</span> <span class="o">=</span> <span class="n">FormsDict</span><span class="p">()</span>
        <span class="n">enc</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">input_encoding</span> <span class="o">=</span> <span class="n">encoding</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_encoding</span>
        <span class="n">copy</span><span class="o">.</span><span class="n">recode_unicode</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">allitems</span><span class="p">():</span>
            <span class="n">copy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fix</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">enc</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">enc</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">copy</span></div>

<div class="viewcode-block" id="FormsDict.getunicode"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.FormsDict.getunicode">[docs]</a>    <span class="k">def</span> <span class="nf">getunicode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the value as a unicode string, or the default. &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">encoding</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">UnicodeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">default</span></div>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">unicode</span><span class="p">()):</span>
        <span class="c1"># Without this guard, pickle generates a cryptic TypeError:</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">FormsDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__getattr__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getunicode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">)</span></div>

<div class="viewcode-block" id="HeaderDict"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.HeaderDict">[docs]</a><span class="k">class</span> <span class="nc">HeaderDict</span><span class="p">(</span><span class="n">MultiDict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A case-insensitive version of :class:`MultiDict` that defaults to</span>
<span class="sd">        replace the old value instead of appending it. &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">a</span> <span class="ow">or</span> <span class="n">ka</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_hkey</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span>

    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">_hkey</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">_hkey</span><span class="p">(</span><span class="n">key</span><span class="p">)][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">_hkey</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="n">_hval</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span>

<div class="viewcode-block" id="HeaderDict.append"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.HeaderDict.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">_hkey</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_hval</span><span class="p">(</span><span class="n">value</span><span class="p">))</span></div>

<div class="viewcode-block" id="HeaderDict.replace"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.HeaderDict.replace">[docs]</a>    <span class="k">def</span> <span class="nf">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">_hkey</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="n">_hval</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span></div>

<div class="viewcode-block" id="HeaderDict.getall"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.HeaderDict.getall">[docs]</a>    <span class="k">def</span> <span class="nf">getall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_hkey</span><span class="p">(</span><span class="n">key</span><span class="p">))</span> <span class="ow">or</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HeaderDict.get"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.HeaderDict.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">MultiDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_hkey</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">default</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span></div>

<div class="viewcode-block" id="HeaderDict.filter"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.HeaderDict.filter">[docs]</a>    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="n">_hkey</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span></div></div>


<div class="viewcode-block" id="WSGIHeaderDict"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.WSGIHeaderDict">[docs]</a><span class="k">class</span> <span class="nc">WSGIHeaderDict</span><span class="p">(</span><span class="n">DictMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This dict-like class wraps a WSGI environ dict and provides convenient</span>
<span class="sd">        access to HTTP_* fields. Keys and values are native strings</span>
<span class="sd">        (2.x bytes or 3.x unicode) and keys are case-insensitive. If the WSGI</span>
<span class="sd">        environment contains non-native string values, these are de- or encoded</span>
<span class="sd">        using a lossless &#39;latin1&#39; character set.</span>

<span class="sd">        The API will remain stable even on changes to the relevant PEPs.</span>
<span class="sd">        Currently PEP 333, 444 and 3333 are supported. (PEP 444 is the only one</span>
<span class="sd">        that uses non-native strings.)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#: List of keys that do not have a ``HTTP_`` prefix.</span>
    <span class="n">cgikeys</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;CONTENT_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;CONTENT_LENGTH&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">environ</span> <span class="o">=</span> <span class="n">environ</span>

    <span class="k">def</span> <span class="nf">_ekey</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Translate header field name to CGI/WSGI environ key. &quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cgikeys</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">key</span>
        <span class="k">return</span> <span class="s1">&#39;HTTP_&#39;</span> <span class="o">+</span> <span class="n">key</span>

<div class="viewcode-block" id="WSGIHeaderDict.raw"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.WSGIHeaderDict.raw">[docs]</a>    <span class="k">def</span> <span class="nf">raw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the header value as is (may be bytes or unicode). &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ekey</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">default</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ekey</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">py3k</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">unicode</span><span class="p">):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;latin1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is read-only.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is read-only.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;HTTP_&#39;</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">_hkey</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">5</span><span class="p">:])</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cgikeys</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">_hkey</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

<div class="viewcode-block" id="WSGIHeaderDict.keys"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.WSGIHeaderDict.keys">[docs]</a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ekey</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span></div>

<span class="n">_UNSET</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>

<div class="viewcode-block" id="ConfigDict"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.ConfigDict">[docs]</a><span class="k">class</span> <span class="nc">ConfigDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A dict-like configuration storage with additional support for</span>
<span class="sd">        namespaces, validators, meta-data, overlays and more.</span>

<span class="sd">        This dict-like class is heavily optimized for read access. All read-only</span>
<span class="sd">        methods as well as item access should be as fast as the built-in dict.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;_meta&#39;</span><span class="p">,</span> <span class="s1">&#39;_change_listener&#39;</span><span class="p">,</span> <span class="s1">&#39;_overlays&#39;</span><span class="p">,</span> <span class="s1">&#39;_virtual_keys&#39;</span><span class="p">,</span> <span class="s1">&#39;_source&#39;</span><span class="p">,</span> <span class="s1">&#39;__weakref__&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_change_listener</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#: Weak references of overlays that need to be kept in sync.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_overlays</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#: Config that is the source for this overlay.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_source</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: Keys of values copied from the source (values we do not own)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_virtual_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

<div class="viewcode-block" id="ConfigDict.load_module"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.ConfigDict.load_module">[docs]</a>    <span class="k">def</span> <span class="nf">load_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">squash</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load values from a Python module.</span>

<span class="sd">           Example modue ``config.py``::</span>

<span class="sd">                DEBUG = True</span>
<span class="sd">                SQLITE = {</span>
<span class="sd">                    &quot;db&quot;: &quot;:memory:&quot;</span>
<span class="sd">                }</span>


<span class="sd">           &gt;&gt;&gt; c = ConfigDict()</span>
<span class="sd">           &gt;&gt;&gt; c.load_module(&#39;config&#39;)</span>
<span class="sd">           {DEBUG: True, &#39;SQLITE.DB&#39;: &#39;memory&#39;}</span>
<span class="sd">           &gt;&gt;&gt; c.load_module(&quot;config&quot;, False)</span>
<span class="sd">           {&#39;DEBUG&#39;: True, &#39;SQLITE&#39;: {&#39;DB&#39;: &#39;memory&#39;}}</span>

<span class="sd">           :param squash: If true (default), dictionary values are assumed to</span>
<span class="sd">                          represent namespaces (see :meth:`load_dict`).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">config_obj</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">config_obj</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">config_obj</span><span class="p">)</span>
               <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">isupper</span><span class="p">()}</span>

        <span class="k">if</span> <span class="n">squash</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_dict</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="ConfigDict.load_config"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.ConfigDict.load_config">[docs]</a>    <span class="k">def</span> <span class="nf">load_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Load values from an ``*.ini`` style config file.</span>

<span class="sd">            A configuration file consists of sections, each led by a</span>
<span class="sd">            ``[section]`` header, followed by key/value entries separated by</span>
<span class="sd">            either ``=`` or ``:``. Section names and keys are case-insensitive.</span>
<span class="sd">            Leading and trailing whitespace is removed from keys and values.</span>
<span class="sd">            Values can be omitted, in which case the key/value delimiter may</span>
<span class="sd">            also be left out. Values can also span multiple lines, as long as</span>
<span class="sd">            they are indented deeper than the first line of the value. Commands</span>
<span class="sd">            are prefixed by ``#`` or ``;`` and may only appear on their own on</span>
<span class="sd">            an otherwise empty line.</span>

<span class="sd">            Both section and key names may contain dots (``.``) as namespace</span>
<span class="sd">            separators. The actual configuration parameter name is constructed</span>
<span class="sd">            by joining section name and key name together and converting to</span>
<span class="sd">            lower case.</span>

<span class="sd">            The special sections ``bottle`` and ``ROOT`` refer to the root</span>
<span class="sd">            namespace and the ``DEFAULT`` section defines default values for all</span>
<span class="sd">            other sections.</span>

<span class="sd">            With Python 3, extended string interpolation is enabled.</span>

<span class="sd">            :param filename: The path of a config file, or a list of paths.</span>
<span class="sd">            :param options: All keyword parameters are passed to the underlying</span>
<span class="sd">                :class:`python:configparser.ConfigParser` constructor call.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;allow_no_value&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">py3k</span><span class="p">:</span>
            <span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;interpolation&#39;</span><span class="p">,</span>
                               <span class="n">configparser</span><span class="o">.</span><span class="n">ExtendedInterpolation</span><span class="p">())</span>
        <span class="n">conf</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">conf</span><span class="o">.</span><span class="n">sections</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">conf</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">section</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">section</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;bottle&#39;</span><span class="p">,</span> <span class="s1">&#39;ROOT&#39;</span><span class="p">]:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="n">section</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">key</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="ConfigDict.load_dict"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.ConfigDict.load_dict">[docs]</a>    <span class="k">def</span> <span class="nf">load_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Load values from a dictionary structure. Nesting can be used to</span>
<span class="sd">            represent namespaces.</span>

<span class="sd">            &gt;&gt;&gt; c = ConfigDict()</span>
<span class="sd">            &gt;&gt;&gt; c.load_dict({&#39;some&#39;: {&#39;namespace&#39;: {&#39;key&#39;: &#39;value&#39;} } })</span>
<span class="sd">            {&#39;some.namespace.key&#39;: &#39;value&#39;}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">source</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                <span class="n">nskey</span> <span class="o">=</span> <span class="p">(</span><span class="n">namespace</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">load_dict</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">nskey</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">nskey</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Key has type </span><span class="si">%r</span><span class="s1"> (not a string)&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="ConfigDict.update"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.ConfigDict.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; If the first parameter is a string, all keys are prefixed with this</span>
<span class="sd">            namespace. Apart from that it works just as the usual dict.update().</span>

<span class="sd">            &gt;&gt;&gt; c = ConfigDict()</span>
<span class="sd">            &gt;&gt;&gt; c.update(&#39;some.namespace&#39;, key=&#39;value&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">a</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="ConfigDict.setdefault"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.ConfigDict.setdefault">[docs]</a>    <span class="k">def</span> <span class="nf">setdefault</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Key has type </span><span class="si">%r</span><span class="s1"> (not a string)&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_virtual_keys</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s1">&#39;filter&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">is</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_on_change</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="nb">dict</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">overlay</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_overlays</span><span class="p">():</span>
            <span class="n">overlay</span><span class="o">.</span><span class="n">_set_virtual</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_virtual_keys</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Virtual keys cannot be deleted: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source</span><span class="p">:</span>
            <span class="c1"># Not virtual, but present in source -&gt; Restore virtual value</span>
            <span class="nb">dict</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_virtual</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># not virtual, not present in source. This is OUR value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_on_change</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="nb">dict</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">overlay</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_overlays</span><span class="p">():</span>
                <span class="n">overlay</span><span class="o">.</span><span class="n">_delete_virtual</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_virtual</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Recursively set or update virtual keys. Do nothing if non-virtual</span>
<span class="sd">            value is present. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_virtual_keys</span><span class="p">:</span>
            <span class="k">return</span>  <span class="c1"># Do nothing for non-virtual keys.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_virtual_keys</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_on_change</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="nb">dict</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">overlay</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_overlays</span><span class="p">():</span>
            <span class="n">overlay</span><span class="o">.</span><span class="n">_set_virtual</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_delete_virtual</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Recursively delete virtual entry. Do nothing if key is not virtual.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_virtual_keys</span><span class="p">:</span>
            <span class="k">return</span>  <span class="c1"># Do nothing for non-virtual keys.</span>

        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_on_change</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="nb">dict</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_virtual_keys</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">overlay</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_overlays</span><span class="p">():</span>
            <span class="n">overlay</span><span class="o">.</span><span class="n">_delete_virtual</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">cb</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_change_listener</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_add_change_listener</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_change_listener</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span>

<div class="viewcode-block" id="ConfigDict.meta_get"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.ConfigDict.meta_get">[docs]</a>    <span class="k">def</span> <span class="nf">meta_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">metafield</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the value of a meta field for a key. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">metafield</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span></div>

<div class="viewcode-block" id="ConfigDict.meta_set"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.ConfigDict.meta_set">[docs]</a>    <span class="k">def</span> <span class="nf">meta_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">metafield</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the meta field for a key to a new value. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">{})[</span><span class="n">metafield</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="ConfigDict.meta_list"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.ConfigDict.meta_list">[docs]</a>    <span class="k">def</span> <span class="nf">meta_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return an iterable of meta field names defined for a key. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_define</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">_UNSET</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="n">_UNSET</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="n">_UNSET</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; (Unstable) Shortcut for plugins to define own config parameters. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">_UNSET</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">help</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">_UNSET</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta_set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s1">&#39;help&#39;</span><span class="p">,</span> <span class="n">help</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">_UNSET</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta_set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s1">&#39;validate&#39;</span><span class="p">,</span> <span class="n">validate</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_iter_overlays</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_overlays</span><span class="p">:</span>
            <span class="n">overlay</span> <span class="o">=</span> <span class="n">ref</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">overlay</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">overlay</span>

    <span class="k">def</span> <span class="nf">_make_overlay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; (Unstable) Create a new overlay that acts like a chained map: Values</span>
<span class="sd">            missing in the overlay are copied from the source map. Both maps</span>
<span class="sd">            share the same meta entries.</span>

<span class="sd">            Entries that were copied from the source are called &#39;virtual&#39;. You</span>
<span class="sd">            can not delete virtual keys, but overwrite them, which turns them</span>
<span class="sd">            into non-virtual entries. Setting keys on an overlay never affects</span>
<span class="sd">            its source, but may affect any number of child overlays.</span>

<span class="sd">            Other than collections.ChainMap or most other implementations, this</span>
<span class="sd">            approach does not resolve missing keys on demand, but instead</span>
<span class="sd">            actively copies all values from the source to the overlay and keeps</span>
<span class="sd">            track of virtual and non-virtual keys internally. This removes any</span>
<span class="sd">            lookup-overhead. Read-access is as fast as a build-in dict for both</span>
<span class="sd">            virtual and non-virtual keys.</span>

<span class="sd">            Changes are propagated recursively and depth-first. A failing</span>
<span class="sd">            on-change handler in an overlay stops the propagation of virtual</span>
<span class="sd">            values and may result in an partly updated tree. Take extra care</span>
<span class="sd">            here and make sure that on-change handlers never fail.</span>

<span class="sd">            Used by Route.config</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Cleanup dead references</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_overlays</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ref</span> <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_overlays</span> <span class="k">if</span> <span class="n">ref</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>

        <span class="n">overlay</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">()</span>
        <span class="n">overlay</span><span class="o">.</span><span class="n">_meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span>
        <span class="n">overlay</span><span class="o">.</span><span class="n">_source</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_overlays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">overlay</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">overlay</span><span class="o">.</span><span class="n">_set_virtual</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">overlay</span></div>




<div class="viewcode-block" id="AppStack"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.AppStack">[docs]</a><span class="k">class</span> <span class="nc">AppStack</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A stack-like list. Calling it returns the head of the stack. &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the current default application. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span>

<div class="viewcode-block" id="AppStack.push"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.AppStack.push">[docs]</a>    <span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add a new :class:`Bottle` instance to the stack &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Bottle</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">Bottle</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span></div>
    <span class="n">new_app</span> <span class="o">=</span> <span class="n">push</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">()</span></div>


<div class="viewcode-block" id="WSGIFileWrapper"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.WSGIFileWrapper">[docs]</a><span class="k">class</span> <span class="nc">WSGIFileWrapper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">buffer_size</span><span class="o">=</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">64</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer_size</span> <span class="o">=</span> <span class="n">fp</span><span class="p">,</span> <span class="n">buffer_size</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;fileno&#39;</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="s1">&#39;readlines&#39;</span><span class="p">,</span> <span class="s1">&#39;tell&#39;</span><span class="p">,</span> <span class="s1">&#39;seek&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">attr</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">buff</span><span class="p">,</span> <span class="n">read</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">part</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">buff</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">part</span><span class="p">:</span> <span class="k">return</span>
            <span class="k">yield</span> <span class="n">part</span></div>


<span class="k">class</span> <span class="nc">_closeiter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This only exists to be able to attach a .close method to iterators that</span>
<span class="sd">        do not support attribute assignment (most of itertools). &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterator</span><span class="p">,</span> <span class="n">close</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iterator</span> <span class="o">=</span> <span class="n">iterator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_callbacks</span> <span class="o">=</span> <span class="n">makelist</span><span class="p">(</span><span class="n">close</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iterator</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">close_callbacks</span><span class="p">:</span>
            <span class="n">func</span><span class="p">()</span>


<div class="viewcode-block" id="ResourceManager"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.ResourceManager">[docs]</a><span class="k">class</span> <span class="nc">ResourceManager</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This class manages a list of search paths and helps to find and open</span>
<span class="sd">        application-bound resources (files).</span>

<span class="sd">        :param base: default value for :meth:`add_path` calls.</span>
<span class="sd">        :param opener: callable used to open resources.</span>
<span class="sd">        :param cachemode: controls which lookups are cached. One of &#39;all&#39;,</span>
<span class="sd">                         &#39;found&#39; or &#39;none&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="n">opener</span><span class="o">=</span><span class="nb">open</span><span class="p">,</span> <span class="n">cachemode</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opener</span> <span class="o">=</span> <span class="n">opener</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base</span> <span class="o">=</span> <span class="n">base</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cachemode</span> <span class="o">=</span> <span class="n">cachemode</span>

        <span class="c1">#: A list of search paths. See :meth:`add_path` for details.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#: A cache for resolved paths. ``res.cache.clear()`` clears the cache.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="ResourceManager.add_path"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.ResourceManager.add_path">[docs]</a>    <span class="k">def</span> <span class="nf">add_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add a new path to the list of search paths. Return False if the</span>
<span class="sd">            path does not exist.</span>

<span class="sd">            :param path: The new search path. Relative paths are turned into</span>
<span class="sd">                an absolute and normalized form. If the path looks like a file</span>
<span class="sd">                (not ending in `/`), the filename is stripped off.</span>
<span class="sd">            :param base: Path used to absolutize relative search paths.</span>
<span class="sd">                Defaults to :attr:`base` which defaults to ``os.getcwd()``.</span>
<span class="sd">            :param index: Position within the list of search paths. Defaults</span>
<span class="sd">                to last index (appends to the list).</span>

<span class="sd">            The `base` parameter makes it easy to reference files installed</span>
<span class="sd">            along with a python module or package::</span>

<span class="sd">                res.add_path(&#39;./resources/&#39;, __file__)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">base</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">))</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">)))</span>
        <span class="n">path</span> <span class="o">+=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">create</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Iterate over all existing files in all registered paths. &quot;&quot;&quot;</span>
        <span class="n">search</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">[:]</span>
        <span class="k">while</span> <span class="n">search</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">search</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span> <span class="k">continue</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">full</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">full</span><span class="p">):</span> <span class="n">search</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">full</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span> <span class="k">yield</span> <span class="n">full</span>

<div class="viewcode-block" id="ResourceManager.lookup"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.ResourceManager.lookup">[docs]</a>    <span class="k">def</span> <span class="nf">lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Search for a resource and return an absolute file path, or `None`.</span>

<span class="sd">            The :attr:`path` list is searched in order. The first match is</span>
<span class="sd">            returend. Symlinks are followed. The result is cached to speed up</span>
<span class="sd">            future lookups. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="ow">or</span> <span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
                <span class="n">fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cachemode</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;found&#39;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">fpath</span>
                    <span class="k">return</span> <span class="n">fpath</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cachemode</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">name</span><span class="p">]</span></div>

<div class="viewcode-block" id="ResourceManager.open"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.ResourceManager.open">[docs]</a>    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Find a resource and return a file object, or raise IOError. &quot;&quot;&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fname</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Resource </span><span class="si">%r</span><span class="s2"> not found.&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">opener</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="FileUpload"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.FileUpload">[docs]</a><span class="k">class</span> <span class="nc">FileUpload</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileobj</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Wrapper for file uploads. &quot;&quot;&quot;</span>
        <span class="c1">#: Open file(-like) object (BytesIO buffer or temporary file)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="n">fileobj</span>
        <span class="c1">#: Name of the upload form field</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="c1">#: Raw filename as sent by the client (may contain unsafe characters)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="c1">#: A :class:`HeaderDict` with additional headers (e.g. content-type)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="n">HeaderDict</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span> <span class="k">if</span> <span class="n">headers</span> <span class="k">else</span> <span class="n">HeaderDict</span><span class="p">()</span>

    <span class="n">content_type</span> <span class="o">=</span> <span class="n">HeaderProperty</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">)</span>
    <span class="n">content_length</span> <span class="o">=</span> <span class="n">HeaderProperty</span><span class="p">(</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">,</span> <span class="n">reader</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

<div class="viewcode-block" id="FileUpload.get_header"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.FileUpload.get_header">[docs]</a>    <span class="k">def</span> <span class="nf">get_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the value of a header within the mulripart part. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span></div>

<div class="viewcode-block" id="FileUpload.filename"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.FileUpload.filename">[docs]</a>    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Name of the file on the client file system, but normalized to ensure</span>
<span class="sd">            file system compatibility. An empty filename is returned as &#39;empty&#39;.</span>

<span class="sd">            Only ASCII letters, digits, dashes, underscores and dots are</span>
<span class="sd">            allowed in the final filename. Accents are removed, if possible.</span>
<span class="sd">            Whitespace is replaced by a single dash. Leading or tailing dots</span>
<span class="sd">            or dashes are removed. The filename is limited to 255 characters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_filename</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">unicode</span><span class="p">):</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">fname</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="s1">&#39;NFKD&#39;</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">fname</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ASCII&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ASCII&#39;</span><span class="p">)</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">))</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^a-zA-Z0-9-_.\s]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[-\s]+&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;.-&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fname</span><span class="p">[:</span><span class="mi">255</span><span class="p">]</span> <span class="ow">or</span> <span class="s1">&#39;empty&#39;</span></div>

    <span class="k">def</span> <span class="nf">_copy_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">2</span> <span class="o">**</span> <span class="mi">16</span><span class="p">):</span>
        <span class="n">read</span><span class="p">,</span> <span class="n">write</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">,</span> <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">buf</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">chunk_size</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">buf</span><span class="p">:</span> <span class="k">break</span>
            <span class="n">write</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>

<div class="viewcode-block" id="FileUpload.save"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.FileUpload.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">2</span> <span class="o">**</span> <span class="mi">16</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Save file to disk or copy its content to an open file(-like) object.</span>
<span class="sd">            If *destination* is a directory, :attr:`filename` is added to the</span>
<span class="sd">            path. Existing files are not overwritten by default (IOError).</span>

<span class="sd">            :param destination: File path, directory or file(-like) object.</span>
<span class="sd">            :param overwrite: If True, replace existing files. (default: False)</span>
<span class="sd">            :param chunk_size: Bytes to read at a time. (default: 64kb)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">destination</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>  <span class="c1"># Except file-likes here</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">destination</span><span class="p">):</span>
                <span class="n">destination</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">overwrite</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">destination</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;File exists.&#39;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">destination</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_copy_file</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_copy_file</span><span class="p">(</span><span class="n">destination</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span></div></div>

<span class="c1">###############################################################################</span>
<span class="c1"># Application Helper ###########################################################</span>
<span class="c1">###############################################################################</span>


<div class="viewcode-block" id="abort"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.abort">[docs]</a><span class="k">def</span> <span class="nf">abort</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Unknown Error.&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Aborts execution and causes a HTTP error. &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="n">HTTPError</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span></div>


<div class="viewcode-block" id="redirect"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.redirect">[docs]</a><span class="k">def</span> <span class="nf">redirect</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Aborts execution and causes a 303 or 302 redirect, depending on</span>
<span class="sd">        the HTTP protocol version. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">code</span><span class="p">:</span>
        <span class="n">code</span> <span class="o">=</span> <span class="mi">303</span> <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SERVER_PROTOCOL&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;HTTP/1.1&quot;</span> <span class="k">else</span> <span class="mi">302</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">cls</span><span class="o">=</span><span class="n">HTTPResponse</span><span class="p">)</span>
    <span class="n">res</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">code</span>
    <span class="n">res</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">res</span><span class="o">.</span><span class="n">set_header</span><span class="p">(</span><span class="s1">&#39;Location&#39;</span><span class="p">,</span> <span class="n">urljoin</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">url</span><span class="p">))</span>
    <span class="k">raise</span> <span class="n">res</span></div>


<span class="k">def</span> <span class="nf">_file_iter_range</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">maxread</span><span class="o">=</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Yield chunks from a range in a file. No chunk is bigger than maxread.&quot;&quot;&quot;</span>
    <span class="n">fp</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>
    <span class="k">while</span> <span class="nb">bytes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">part</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">maxread</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">part</span><span class="p">:</span> <span class="k">break</span>
        <span class="nb">bytes</span> <span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">part</span>


<div class="viewcode-block" id="static_file"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.static_file">[docs]</a><span class="k">def</span> <span class="nf">static_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span>
                <span class="n">mimetype</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">download</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">charset</span><span class="o">=</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">,</span>
                <span class="n">etag</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Open a file in a safe way and return an instance of :exc:`HTTPResponse`</span>
<span class="sd">        that can be sent back to the client.</span>

<span class="sd">        :param filename: Name or path of the file to send, relative to ``root``.</span>
<span class="sd">        :param root: Root path for file lookups. Should be an absolute directory</span>
<span class="sd">            path.</span>
<span class="sd">        :param mimetype: Provide the content-type header (default: guess from</span>
<span class="sd">            file extension)</span>
<span class="sd">        :param download: If True, ask the browser to open a `Save as...` dialog</span>
<span class="sd">            instead of opening the file with the associated program. You can</span>
<span class="sd">            specify a custom filename as a string. If not specified, the</span>
<span class="sd">            original filename is used (default: False).</span>
<span class="sd">        :param charset: The charset for files with a ``text/*`` mime-type.</span>
<span class="sd">            (default: UTF-8)</span>
<span class="sd">        :param etag: Provide a pre-computed ETag header. If set to ``False``,</span>
<span class="sd">            ETag handling is disabled. (default: auto-generate ETag header)</span>

<span class="sd">        While checking user input is always a good idea, this function provides</span>
<span class="sd">        additional protection against malicious ``filename`` parameters from</span>
<span class="sd">        breaking out of the ``root`` directory and leaking sensitive information</span>
<span class="sd">        to an attacker.</span>

<span class="sd">        Read-protected files or files outside of the ``root`` directory are</span>
<span class="sd">        answered with ``403 Access Denied``. Missing files result in a</span>
<span class="sd">        ``404 Not Found`` response. Conditional requests (``If-Modified-Since``,</span>
<span class="sd">        ``If-None-Match``) are answered with ``304 Not Modified`` whenever</span>
<span class="sd">        possible. ``HEAD`` and ``Range`` requests (used by download managers to</span>
<span class="sd">        check or continue partial downloads) are also handled automatically.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">root</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">root</span><span class="p">),</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">filename</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;/</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)))</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">HTTPError</span><span class="p">(</span><span class="mi">403</span><span class="p">,</span> <span class="s2">&quot;Access denied.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">HTTPError</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="s2">&quot;File does not exist.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">HTTPError</span><span class="p">(</span><span class="mi">403</span><span class="p">,</span> <span class="s2">&quot;You do not have permission to access this file.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mimetype</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">download</span> <span class="ow">and</span> <span class="n">download</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">mimetype</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">guess_type</span><span class="p">(</span><span class="n">download</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mimetype</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">guess_type</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">encoding</span><span class="p">:</span> <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Encoding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">encoding</span>

    <span class="k">if</span> <span class="n">mimetype</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">mimetype</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;text/&#39;</span> <span class="ow">or</span> <span class="n">mimetype</span> <span class="o">==</span> <span class="s1">&#39;application/javascript&#39;</span><span class="p">)</span>\
        <span class="ow">and</span> <span class="n">charset</span> <span class="ow">and</span> <span class="s1">&#39;charset&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mimetype</span><span class="p">:</span>
            <span class="n">mimetype</span> <span class="o">+=</span> <span class="s1">&#39;; charset=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">charset</span>
        <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mimetype</span>

    <span class="k">if</span> <span class="n">download</span><span class="p">:</span>
        <span class="n">download</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span> <span class="k">if</span> <span class="n">download</span> <span class="ow">is</span> <span class="kc">True</span> <span class="k">else</span> <span class="n">download</span><span class="p">)</span>
        <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Disposition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;attachment; filename=&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">download</span>

    <span class="n">stats</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clen</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">st_size</span>
    <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Last-Modified&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">formatdate</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">,</span>
                                                      <span class="n">usegmt</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">formatdate</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="n">usegmt</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">getenv</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span>

    <span class="k">if</span> <span class="n">etag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">etag</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">:</span><span class="si">%d</span><span class="s1">:</span><span class="si">%d</span><span class="s1">:</span><span class="si">%d</span><span class="s1">:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">st_dev</span><span class="p">,</span> <span class="n">stats</span><span class="o">.</span><span class="n">st_ino</span><span class="p">,</span> <span class="n">stats</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">,</span>
                                   <span class="n">clen</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="n">etag</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha1</span><span class="p">(</span><span class="n">tob</span><span class="p">(</span><span class="n">etag</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">etag</span><span class="p">:</span>
        <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;ETag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">etag</span>
        <span class="n">check</span> <span class="o">=</span> <span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;HTTP_IF_NONE_MATCH&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">check</span> <span class="ow">and</span> <span class="n">check</span> <span class="o">==</span> <span class="n">etag</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HTTPResponse</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="mi">304</span><span class="p">,</span> <span class="o">**</span><span class="n">headers</span><span class="p">)</span>

    <span class="n">ims</span> <span class="o">=</span> <span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;HTTP_IF_MODIFIED_SINCE&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ims</span><span class="p">:</span>
        <span class="n">ims</span> <span class="o">=</span> <span class="n">parse_date</span><span class="p">(</span><span class="n">ims</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">ims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ims</span> <span class="o">&gt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">HTTPResponse</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="mi">304</span><span class="p">,</span> <span class="o">**</span><span class="n">headers</span><span class="p">)</span>

    <span class="n">body</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;HEAD&#39;</span> <span class="k">else</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>

    <span class="n">headers</span><span class="p">[</span><span class="s2">&quot;Accept-Ranges&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;bytes&quot;</span>
    <span class="n">range_header</span> <span class="o">=</span> <span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;HTTP_RANGE&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">range_header</span><span class="p">:</span>
        <span class="n">ranges</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">parse_range_header</span><span class="p">(</span><span class="n">range_header</span><span class="p">,</span> <span class="n">clen</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ranges</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HTTPError</span><span class="p">(</span><span class="mi">416</span><span class="p">,</span> <span class="s2">&quot;Requested Range Not Satisfiable&quot;</span><span class="p">)</span>
        <span class="n">offset</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">headers</span><span class="p">[</span><span class="s2">&quot;Content-Range&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;bytes </span><span class="si">%d</span><span class="s2">-</span><span class="si">%d</span><span class="s2">/</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">end</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">clen</span><span class="p">)</span>
        <span class="n">headers</span><span class="p">[</span><span class="s2">&quot;Content-Length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">body</span><span class="p">:</span> <span class="n">body</span> <span class="o">=</span> <span class="n">_file_iter_range</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">end</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HTTPResponse</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">206</span><span class="p">,</span> <span class="o">**</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">HTTPResponse</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="o">**</span><span class="n">headers</span><span class="p">)</span></div>

<span class="c1">###############################################################################</span>
<span class="c1"># HTTP Utilities and MISC (TODO) ###############################################</span>
<span class="c1">###############################################################################</span>


<div class="viewcode-block" id="debug"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.debug">[docs]</a><span class="k">def</span> <span class="nf">debug</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Change the debug level.</span>
<span class="sd">    There is only one debug level supported at the moment.&quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">DEBUG</span>
    <span class="k">if</span> <span class="n">mode</span><span class="p">:</span> <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span>
    <span class="n">DEBUG</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span></div>


<div class="viewcode-block" id="http_date"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.http_date">[docs]</a><span class="k">def</span> <span class="nf">http_date</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="n">datedate</span><span class="p">,</span> <span class="n">datetime</span><span class="p">)):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">utctimetuple</span><span class="p">()</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%a, </span><span class="si">%d</span><span class="s2"> %b %Y %H:%M:%S GMT&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span></div>


<div class="viewcode-block" id="parse_date"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.parse_date">[docs]</a><span class="k">def</span> <span class="nf">parse_date</span><span class="p">(</span><span class="n">ims</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Parse rfc1123, rfc850 and asctime timestamps and return UTC epoch. &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">parsedate_tz</span><span class="p">(</span><span class="n">ims</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">ts</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">time</span><span class="o">.</span><span class="n">timezone</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">OverflowError</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="parse_auth"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.parse_auth">[docs]</a><span class="k">def</span> <span class="nf">parse_auth</span><span class="p">(</span><span class="n">header</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Parse rfc2617 HTTP authentication header string (basic) and return (user,pass) tuple or None&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">method</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;basic&#39;</span><span class="p">:</span>
            <span class="n">user</span><span class="p">,</span> <span class="n">pwd</span> <span class="o">=</span> <span class="n">touni</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">tob</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">user</span><span class="p">,</span> <span class="n">pwd</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="parse_range_header"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.parse_range_header">[docs]</a><span class="k">def</span> <span class="nf">parse_range_header</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Yield (start, end) ranges parsed from a HTTP Range header. Skip</span>
<span class="sd">        unsatisfiable ranges. The end index is non-inclusive.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">header</span> <span class="ow">or</span> <span class="n">header</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;bytes=&#39;</span><span class="p">:</span> <span class="k">return</span>
    <span class="n">ranges</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">header</span><span class="p">[</span><span class="mi">6</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;-&#39;</span> <span class="ow">in</span> <span class="n">r</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">ranges</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">start</span><span class="p">:</span>  <span class="c1"># bytes=-100    -&gt; last 100 bytes</span>
                <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxlen</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">end</span><span class="p">)),</span> <span class="n">maxlen</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">end</span><span class="p">:</span>  <span class="c1"># bytes=100-    -&gt; all but the first 99 bytes</span>
                <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">),</span> <span class="n">maxlen</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># bytes=100-200 -&gt; bytes 100-200 (inclusive)</span>
                <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">end</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">maxlen</span><span class="p">)</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="n">end</span> <span class="o">&lt;=</span> <span class="n">maxlen</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span></div>


<span class="c1">#: Header tokenizer used by _parse_http_header()</span>
<span class="n">_hsplit</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;(?:(?:&quot;((?:[^&quot;</span><span class="se">\\\\</span><span class="s1">]+|</span><span class="se">\\\\</span><span class="s1">.)*)&quot;)|([^;,=]+))([;,=]?)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">findall</span>

<span class="k">def</span> <span class="nf">_parse_http_header</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Parses a typical multi-valued and parametrised HTTP header (e.g. Accept headers) and returns a list of values</span>
<span class="sd">        and parameters. For non-standard or broken input, this implementation may return partial results.</span>
<span class="sd">    :param h: A header string (e.g. ``text/html,text/plain;q=0.9,*/*;q=0.8``)</span>
<span class="sd">    :return: List of (value, params) tuples. The second element is a (possibly empty) dict.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">h</span><span class="p">:</span>  <span class="c1"># INFO: Fast path without regexp (~2x faster)</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">h</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">):</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="p">{}))</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lop</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">attrs</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">quoted</span><span class="p">,</span> <span class="n">plain</span><span class="p">,</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">_hsplit</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">plain</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">plain</span> <span class="k">else</span> <span class="n">quoted</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lop</span> <span class="o">==</span> <span class="s1">&#39;,&#39;</span><span class="p">:</span>
                <span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">value</span><span class="p">,</span> <span class="n">attrs</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">lop</span> <span class="o">==</span> <span class="s1">&#39;;&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tok</span> <span class="o">==</span> <span class="s1">&#39;=&#39;</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">attrs</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">elif</span> <span class="n">lop</span> <span class="o">==</span> <span class="s1">&#39;=&#39;</span> <span class="ow">and</span> <span class="n">key</span><span class="p">:</span>
                <span class="n">attrs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="n">key</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">lop</span> <span class="o">=</span> <span class="n">tok</span>
    <span class="k">return</span> <span class="n">values</span>


<span class="k">def</span> <span class="nf">_parse_qsl</span><span class="p">(</span><span class="n">qs</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">qs</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pair</span><span class="p">:</span> <span class="k">continue</span>
        <span class="n">nv</span> <span class="o">=</span> <span class="n">pair</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span> <span class="n">nv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">urlunquote</span><span class="p">(</span><span class="n">nv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">))</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">urlunquote</span><span class="p">(</span><span class="n">nv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">))</span>
        <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">r</span>


<span class="k">def</span> <span class="nf">_lscmp</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Compares two strings in a cryptographically safe way:</span>
<span class="sd">        Runtime is not affected by length of common prefix. &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">0</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">y</span> <span class="k">else</span> <span class="mi">1</span>
                   <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>


<div class="viewcode-block" id="cookie_encode"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.cookie_encode">[docs]</a><span class="k">def</span> <span class="nf">cookie_encode</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">digestmod</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Encode and sign a pickle-able object. Return a (byte) string &quot;&quot;&quot;</span>
    <span class="n">depr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="s2">&quot;cookie_encode() will be removed soon.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Do not use this API directly.&quot;</span><span class="p">)</span>
    <span class="n">digestmod</span> <span class="o">=</span> <span class="n">digestmod</span> <span class="ow">or</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">sig</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">tob</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">msg</span><span class="p">,</span> <span class="n">digestmod</span><span class="o">=</span><span class="n">digestmod</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">tob</span><span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">sig</span> <span class="o">+</span> <span class="n">tob</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">msg</span></div>


<div class="viewcode-block" id="cookie_decode"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.cookie_decode">[docs]</a><span class="k">def</span> <span class="nf">cookie_decode</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">digestmod</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Verify and decode an encoded string. Return an object or None.&quot;&quot;&quot;</span>
    <span class="n">depr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="s2">&quot;cookie_decode() will be removed soon.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Do not use this API directly.&quot;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">tob</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cookie_is_encoded</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="n">sig</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">tob</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">digestmod</span> <span class="o">=</span> <span class="n">digestmod</span> <span class="ow">or</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span>
        <span class="n">hashed</span> <span class="o">=</span> <span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">tob</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">msg</span><span class="p">,</span> <span class="n">digestmod</span><span class="o">=</span><span class="n">digestmod</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">_lscmp</span><span class="p">(</span><span class="n">sig</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">hashed</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
    <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="cookie_is_encoded"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.cookie_is_encoded">[docs]</a><span class="k">def</span> <span class="nf">cookie_is_encoded</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return True if the argument looks like a encoded cookie.&quot;&quot;&quot;</span>
    <span class="n">depr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="s2">&quot;cookie_is_encoded() will be removed soon.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Do not use this API directly.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">tob</span><span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">))</span> <span class="ow">and</span> <span class="n">tob</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">data</span><span class="p">)</span></div>


<div class="viewcode-block" id="html_escape"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.html_escape">[docs]</a><span class="k">def</span> <span class="nf">html_escape</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Escape HTML special characters ``&amp;&lt;&gt;`` and quotes ``&#39;&quot;``. &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;amp;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;lt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;gt;&#39;</span><span class="p">)</span>\
                 <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s1">&#39;&amp;#039;&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="html_quote"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.html_quote">[docs]</a><span class="k">def</span> <span class="nf">html_quote</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Escape and quote a string to be used as an HTTP attribute.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s1">&#39;&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">html_escape</span><span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;#10;&#39;</span><span class="p">)</span>\
                    <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;#13;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;#9;&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="yieldroutes"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.yieldroutes">[docs]</a><span class="k">def</span> <span class="nf">yieldroutes</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return a generator for routes that match the signature (name, args)</span>
<span class="sd">    of the func parameter. This may yield more than one route if the function</span>
<span class="sd">    takes optional keyword arguments. The output is best described by example::</span>

<span class="sd">        a()         -&gt; &#39;/a&#39;</span>
<span class="sd">        b(x, y)     -&gt; &#39;/b/&lt;x&gt;/&lt;y&gt;&#39;</span>
<span class="sd">        c(x, y=5)   -&gt; &#39;/c/&lt;x&gt;&#39; and &#39;/c/&lt;x&gt;/&lt;y&gt;&#39;</span>
<span class="sd">        d(x=5, y=6) -&gt; &#39;/d&#39; and &#39;/d/&lt;x&gt;&#39; and &#39;/d/&lt;x&gt;/&lt;y&gt;&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="n">spec</span> <span class="o">=</span> <span class="n">getargspec</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="n">argc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">or</span> <span class="p">[])</span>
    <span class="n">path</span> <span class="o">+=</span> <span class="p">(</span><span class="s1">&#39;/&lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">*</span> <span class="n">argc</span><span class="p">)</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="n">argc</span><span class="p">])</span>
    <span class="k">yield</span> <span class="n">path</span>
    <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">argc</span><span class="p">:]:</span>
        <span class="n">path</span> <span class="o">+=</span> <span class="s1">&#39;/&lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="n">arg</span>
        <span class="k">yield</span> <span class="n">path</span></div>


<div class="viewcode-block" id="path_shift"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.path_shift">[docs]</a><span class="k">def</span> <span class="nf">path_shift</span><span class="p">(</span><span class="n">script_name</span><span class="p">,</span> <span class="n">path_info</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Shift path fragments from PATH_INFO to SCRIPT_NAME and vice versa.</span>

<span class="sd">        :return: The modified paths.</span>
<span class="sd">        :param script_name: The SCRIPT_NAME path.</span>
<span class="sd">        :param script_name: The PATH_INFO path.</span>
<span class="sd">        :param shift: The number of path fragments to shift. May be negative to</span>
<span class="sd">          change the shift direction. (default: 1)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">shift</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="n">script_name</span><span class="p">,</span> <span class="n">path_info</span>
    <span class="n">pathlist</span> <span class="o">=</span> <span class="n">path_info</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="n">scriptlist</span> <span class="o">=</span> <span class="n">script_name</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pathlist</span> <span class="ow">and</span> <span class="n">pathlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span> <span class="n">pathlist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">scriptlist</span> <span class="ow">and</span> <span class="n">scriptlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span> <span class="n">scriptlist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">shift</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pathlist</span><span class="p">):</span>
        <span class="n">moved</span> <span class="o">=</span> <span class="n">pathlist</span><span class="p">[:</span><span class="n">shift</span><span class="p">]</span>
        <span class="n">scriptlist</span> <span class="o">=</span> <span class="n">scriptlist</span> <span class="o">+</span> <span class="n">moved</span>
        <span class="n">pathlist</span> <span class="o">=</span> <span class="n">pathlist</span><span class="p">[</span><span class="n">shift</span><span class="p">:]</span>
    <span class="k">elif</span> <span class="mi">0</span> <span class="o">&gt;</span> <span class="n">shift</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">scriptlist</span><span class="p">):</span>
        <span class="n">moved</span> <span class="o">=</span> <span class="n">scriptlist</span><span class="p">[</span><span class="n">shift</span><span class="p">:]</span>
        <span class="n">pathlist</span> <span class="o">=</span> <span class="n">moved</span> <span class="o">+</span> <span class="n">pathlist</span>
        <span class="n">scriptlist</span> <span class="o">=</span> <span class="n">scriptlist</span><span class="p">[:</span><span class="n">shift</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">empty</span> <span class="o">=</span> <span class="s1">&#39;SCRIPT_NAME&#39;</span> <span class="k">if</span> <span class="n">shift</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;PATH_INFO&#39;</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;Cannot shift. Nothing left from </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">empty</span><span class="p">)</span>
    <span class="n">new_script_name</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">scriptlist</span><span class="p">)</span>
    <span class="n">new_path_info</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pathlist</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">path_info</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pathlist</span><span class="p">:</span> <span class="n">new_path_info</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span>
    <span class="k">return</span> <span class="n">new_script_name</span><span class="p">,</span> <span class="n">new_path_info</span></div>


<div class="viewcode-block" id="auth_basic"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.auth_basic">[docs]</a><span class="k">def</span> <span class="nf">auth_basic</span><span class="p">(</span><span class="n">check</span><span class="p">,</span> <span class="n">realm</span><span class="o">=</span><span class="s2">&quot;private&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Access denied&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Callback decorator to require HTTP auth (basic).</span>
<span class="sd">        TODO: Add route(check_auth=...) parameter. &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>

        <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">):</span>
            <span class="n">user</span><span class="p">,</span> <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">auth</span> <span class="ow">or</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">check</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
                <span class="n">err</span> <span class="o">=</span> <span class="n">HTTPError</span><span class="p">(</span><span class="mi">401</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
                <span class="n">err</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s1">&#39;WWW-Authenticate&#39;</span><span class="p">,</span> <span class="s1">&#39;Basic realm=&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">realm</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">err</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">wrapper</span>

    <span class="k">return</span> <span class="n">decorator</span></div>

<span class="c1"># Shortcuts for common Bottle methods.</span>
<span class="c1"># They all refer to the current default application.</span>


<div class="viewcode-block" id="make_default_app_wrapper"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.make_default_app_wrapper">[docs]</a><span class="k">def</span> <span class="nf">make_default_app_wrapper</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return a callable that relays calls to the current default app. &quot;&quot;&quot;</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">Bottle</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">app</span><span class="p">(),</span> <span class="n">name</span><span class="p">)(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span></div>


<span class="n">route</span>     <span class="o">=</span> <span class="n">make_default_app_wrapper</span><span class="p">(</span><span class="s1">&#39;route&#39;</span><span class="p">)</span>
<span class="n">get</span>       <span class="o">=</span> <span class="n">make_default_app_wrapper</span><span class="p">(</span><span class="s1">&#39;get&#39;</span><span class="p">)</span>
<span class="n">post</span>      <span class="o">=</span> <span class="n">make_default_app_wrapper</span><span class="p">(</span><span class="s1">&#39;post&#39;</span><span class="p">)</span>
<span class="n">put</span>       <span class="o">=</span> <span class="n">make_default_app_wrapper</span><span class="p">(</span><span class="s1">&#39;put&#39;</span><span class="p">)</span>
<span class="n">delete</span>    <span class="o">=</span> <span class="n">make_default_app_wrapper</span><span class="p">(</span><span class="s1">&#39;delete&#39;</span><span class="p">)</span>
<span class="n">patch</span>     <span class="o">=</span> <span class="n">make_default_app_wrapper</span><span class="p">(</span><span class="s1">&#39;patch&#39;</span><span class="p">)</span>
<span class="n">error</span>     <span class="o">=</span> <span class="n">make_default_app_wrapper</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
<span class="n">mount</span>     <span class="o">=</span> <span class="n">make_default_app_wrapper</span><span class="p">(</span><span class="s1">&#39;mount&#39;</span><span class="p">)</span>
<span class="n">hook</span>      <span class="o">=</span> <span class="n">make_default_app_wrapper</span><span class="p">(</span><span class="s1">&#39;hook&#39;</span><span class="p">)</span>
<span class="n">install</span>   <span class="o">=</span> <span class="n">make_default_app_wrapper</span><span class="p">(</span><span class="s1">&#39;install&#39;</span><span class="p">)</span>
<span class="n">uninstall</span> <span class="o">=</span> <span class="n">make_default_app_wrapper</span><span class="p">(</span><span class="s1">&#39;uninstall&#39;</span><span class="p">)</span>
<span class="n">url</span>       <span class="o">=</span> <span class="n">make_default_app_wrapper</span><span class="p">(</span><span class="s1">&#39;get_url&#39;</span><span class="p">)</span>

<span class="c1">###############################################################################</span>
<span class="c1"># Server Adapter ###############################################################</span>
<span class="c1">###############################################################################</span>

<span class="c1"># Before you edit or add a server adapter, please read:</span>
<span class="c1"># - https://github.com/bottlepy/bottle/pull/647#issuecomment-60152870</span>
<span class="c1"># - https://github.com/bottlepy/bottle/pull/865#issuecomment-242795341</span>

<div class="viewcode-block" id="ServerAdapter"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.ServerAdapter">[docs]</a><span class="k">class</span> <span class="nc">ServerAdapter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">quiet</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">host</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>

<div class="viewcode-block" id="ServerAdapter.run"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.ServerAdapter.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>  <span class="c1"># pragma: no cover</span>
        <span class="k">pass</span></div>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
                          <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span></div>


<div class="viewcode-block" id="CGIServer"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.CGIServer">[docs]</a><span class="k">class</span> <span class="nc">CGIServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
    <span class="n">quiet</span> <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="CGIServer.run"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.CGIServer.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>  <span class="c1"># pragma: no cover</span>
        <span class="kn">from</span> <span class="nn">wsgiref.handlers</span> <span class="k">import</span> <span class="n">CGIHandler</span>

        <span class="k">def</span> <span class="nf">fixed_environ</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
            <span class="n">environ</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;PATH_INFO&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">handler</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">)</span>

        <span class="n">CGIHandler</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">fixed_environ</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="FlupFCGIServer"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.FlupFCGIServer">[docs]</a><span class="k">class</span> <span class="nc">FlupFCGIServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
<div class="viewcode-block" id="FlupFCGIServer.run"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.FlupFCGIServer.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>  <span class="c1"># pragma: no cover</span>
        <span class="kn">import</span> <span class="nn">flup.server.fcgi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;bindAddress&#39;</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">))</span>
        <span class="n">flup</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">fcgi</span><span class="o">.</span><span class="n">WSGIServer</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="WSGIRefServer"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.WSGIRefServer">[docs]</a><span class="k">class</span> <span class="nc">WSGIRefServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
<div class="viewcode-block" id="WSGIRefServer.run"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.WSGIRefServer.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">):</span>  <span class="c1"># pragma: no cover</span>
        <span class="kn">from</span> <span class="nn">wsgiref.simple_server</span> <span class="k">import</span> <span class="n">make_server</span>
        <span class="kn">from</span> <span class="nn">wsgiref.simple_server</span> <span class="k">import</span> <span class="n">WSGIRequestHandler</span><span class="p">,</span> <span class="n">WSGIServer</span>
        <span class="kn">import</span> <span class="nn">socket</span>

        <span class="k">class</span> <span class="nc">FixedHandler</span><span class="p">(</span><span class="n">WSGIRequestHandler</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">address_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># Prevent reverse DNS lookups please.</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_address</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">def</span> <span class="nf">log_request</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">quiet</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">WSGIRequestHandler</span><span class="o">.</span><span class="n">log_request</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

        <span class="n">handler_cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;handler_class&#39;</span><span class="p">,</span> <span class="n">FixedHandler</span><span class="p">)</span>
        <span class="n">server_cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;server_class&#39;</span><span class="p">,</span> <span class="n">WSGIServer</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">:</span>  <span class="c1"># Fix wsgiref for IPv6 addresses.</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">server_cls</span><span class="p">,</span> <span class="s1">&#39;address_family&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">:</span>

                <span class="k">class</span> <span class="nc">server_cls</span><span class="p">(</span><span class="n">server_cls</span><span class="p">):</span>
                    <span class="n">address_family</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">AF_INET6</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">srv</span> <span class="o">=</span> <span class="n">make_server</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">server_cls</span><span class="p">,</span>
                               <span class="n">handler_cls</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">srv</span><span class="o">.</span><span class="n">server_port</span>  <span class="c1"># update port actual port (0 means random)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">srv</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">srv</span><span class="o">.</span><span class="n">server_close</span><span class="p">()</span>  <span class="c1"># Prevent ResourceWarning: unclosed socket</span>
            <span class="k">raise</span></div></div>


<div class="viewcode-block" id="CherryPyServer"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.CherryPyServer">[docs]</a><span class="k">class</span> <span class="nc">CherryPyServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
<div class="viewcode-block" id="CherryPyServer.run"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.CherryPyServer.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>  <span class="c1"># pragma: no cover</span>
        <span class="n">depr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="s2">&quot;The wsgi server part of cherrypy was split into a new &quot;</span>
                    <span class="s2">&quot;project called &#39;cheroot&#39;.&quot;</span><span class="p">,</span> <span class="s2">&quot;Use the &#39;cheroot&#39; server &quot;</span>
                    <span class="s2">&quot;adapter instead of cherrypy.&quot;</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">cherrypy</span> <span class="k">import</span> <span class="n">wsgiserver</span> <span class="c1"># This will fail for CherryPy &gt;= 9</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;bind_addr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;wsgi_app&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">handler</span>

        <span class="n">certfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;certfile&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">certfile</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;certfile&#39;</span><span class="p">]</span>
        <span class="n">keyfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;keyfile&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">keyfile</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;keyfile&#39;</span><span class="p">]</span>

        <span class="n">server</span> <span class="o">=</span> <span class="n">wsgiserver</span><span class="o">.</span><span class="n">CherryPyWSGIServer</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">certfile</span><span class="p">:</span>
            <span class="n">server</span><span class="o">.</span><span class="n">ssl_certificate</span> <span class="o">=</span> <span class="n">certfile</span>
        <span class="k">if</span> <span class="n">keyfile</span><span class="p">:</span>
            <span class="n">server</span><span class="o">.</span><span class="n">ssl_private_key</span> <span class="o">=</span> <span class="n">keyfile</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">server</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">server</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="CherootServer"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.CherootServer">[docs]</a><span class="k">class</span> <span class="nc">CherootServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
<div class="viewcode-block" id="CherootServer.run"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.CherootServer.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span> <span class="c1"># pragma: no cover</span>
        <span class="kn">from</span> <span class="nn">cheroot</span> <span class="k">import</span> <span class="n">wsgi</span>
        <span class="kn">from</span> <span class="nn">cheroot.ssl</span> <span class="k">import</span> <span class="n">builtin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;bind_addr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;wsgi_app&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">handler</span>
        <span class="n">certfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;certfile&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">keyfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;keyfile&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">chainfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;chainfile&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">server</span> <span class="o">=</span> <span class="n">wsgi</span><span class="o">.</span><span class="n">Server</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">certfile</span> <span class="ow">and</span> <span class="n">keyfile</span><span class="p">:</span>
            <span class="n">server</span><span class="o">.</span><span class="n">ssl_adapter</span> <span class="o">=</span> <span class="n">builtin</span><span class="o">.</span><span class="n">BuiltinSSLAdapter</span><span class="p">(</span>
                    <span class="n">certfile</span><span class="p">,</span> <span class="n">keyfile</span><span class="p">,</span> <span class="n">chainfile</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">server</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">server</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="WaitressServer"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.WaitressServer">[docs]</a><span class="k">class</span> <span class="nc">WaitressServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
<div class="viewcode-block" id="WaitressServer.run"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.WaitressServer.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">waitress</span> <span class="k">import</span> <span class="n">serve</span>
        <span class="n">serve</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">,</span> <span class="n">_quiet</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">quiet</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="PasteServer"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.PasteServer">[docs]</a><span class="k">class</span> <span class="nc">PasteServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
<div class="viewcode-block" id="PasteServer.run"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.PasteServer.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>  <span class="c1"># pragma: no cover</span>
        <span class="kn">from</span> <span class="nn">paste</span> <span class="k">import</span> <span class="n">httpserver</span>
        <span class="kn">from</span> <span class="nn">paste.translogger</span> <span class="k">import</span> <span class="n">TransLogger</span>
        <span class="n">handler</span> <span class="o">=</span> <span class="n">TransLogger</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="n">setup_console_handler</span><span class="o">=</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">quiet</span><span class="p">))</span>
        <span class="n">httpserver</span><span class="o">.</span><span class="n">serve</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span>
                         <span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span>
                         <span class="n">port</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">),</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="MeinheldServer"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.MeinheldServer">[docs]</a><span class="k">class</span> <span class="nc">MeinheldServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
<div class="viewcode-block" id="MeinheldServer.run"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.MeinheldServer.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">meinheld</span> <span class="k">import</span> <span class="n">server</span>
        <span class="n">server</span><span class="o">.</span><span class="n">listen</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">))</span>
        <span class="n">server</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="FapwsServer"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.FapwsServer">[docs]</a><span class="k">class</span> <span class="nc">FapwsServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Extremely fast webserver using libev. See http://www.fapws.org/ &quot;&quot;&quot;</span>

<div class="viewcode-block" id="FapwsServer.run"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.FapwsServer.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>  <span class="c1"># pragma: no cover</span>
        <span class="kn">import</span> <span class="nn">fapws._evwsgi</span> <span class="k">as</span> <span class="nn">evwsgi</span>
        <span class="kn">from</span> <span class="nn">fapws</span> <span class="k">import</span> <span class="n">base</span><span class="p">,</span> <span class="n">config</span>
        <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span>
        <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">SERVER_IDENT</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span> <span class="o">&gt;</span> <span class="mf">0.4</span><span class="p">:</span>
            <span class="c1"># fapws3 silently changed its API in 0.5</span>
            <span class="n">port</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
        <span class="n">evwsgi</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
        <span class="c1"># fapws3 never releases the GIL. Complain upstream. I tried. No luck.</span>
        <span class="k">if</span> <span class="s1">&#39;BOTTLE_CHILD&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">quiet</span><span class="p">:</span>
            <span class="n">_stderr</span><span class="p">(</span><span class="s2">&quot;WARNING: Auto-reloading does not work with Fapws3.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">_stderr</span><span class="p">(</span><span class="s2">&quot;         (Fapws3 breaks python thread support)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">evwsgi</span><span class="o">.</span><span class="n">set_base_module</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">app</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
            <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;wsgi.multiprocess&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="n">handler</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">)</span>

        <span class="n">evwsgi</span><span class="o">.</span><span class="n">wsgi_cb</span><span class="p">((</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">app</span><span class="p">))</span>
        <span class="n">evwsgi</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="TornadoServer"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.TornadoServer">[docs]</a><span class="k">class</span> <span class="nc">TornadoServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; The super hyped asynchronous server by facebook. Untested. &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TornadoServer.run"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.TornadoServer.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>  <span class="c1"># pragma: no cover</span>
        <span class="kn">import</span> <span class="nn">tornado.wsgi</span><span class="o">,</span> <span class="nn">tornado.httpserver</span><span class="o">,</span> <span class="nn">tornado.ioloop</span>
        <span class="n">container</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">wsgi</span><span class="o">.</span><span class="n">WSGIContainer</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
        <span class="n">server</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">httpserver</span><span class="o">.</span><span class="n">HTTPServer</span><span class="p">(</span><span class="n">container</span><span class="p">)</span>
        <span class="n">server</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">)</span>
        <span class="n">tornado</span><span class="o">.</span><span class="n">ioloop</span><span class="o">.</span><span class="n">IOLoop</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="AppEngineServer"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.AppEngineServer">[docs]</a><span class="k">class</span> <span class="nc">AppEngineServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Adapter for Google App Engine. &quot;&quot;&quot;</span>
    <span class="n">quiet</span> <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="AppEngineServer.run"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.AppEngineServer.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
        <span class="n">depr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="s2">&quot;AppEngineServer no longer required&quot;</span><span class="p">,</span>
             <span class="s2">&quot;Configure your application directly in your app.yaml&quot;</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">google.appengine.ext.webapp</span> <span class="k">import</span> <span class="n">util</span>
        <span class="c1"># A main() function in the handler script enables &#39;App Caching&#39;.</span>
        <span class="c1"># Lets makes sure it is there. This _really_ improves performance.</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;__main__&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">module</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="s1">&#39;main&#39;</span><span class="p">):</span>
            <span class="n">module</span><span class="o">.</span><span class="n">main</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">run_wsgi_app</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">run_wsgi_app</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TwistedServer"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.TwistedServer">[docs]</a><span class="k">class</span> <span class="nc">TwistedServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Untested. &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TwistedServer.run"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.TwistedServer.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">twisted.web</span> <span class="k">import</span> <span class="n">server</span><span class="p">,</span> <span class="n">wsgi</span>
        <span class="kn">from</span> <span class="nn">twisted.python.threadpool</span> <span class="k">import</span> <span class="n">ThreadPool</span>
        <span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="k">import</span> <span class="n">reactor</span>
        <span class="n">thread_pool</span> <span class="o">=</span> <span class="n">ThreadPool</span><span class="p">()</span>
        <span class="n">thread_pool</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">reactor</span><span class="o">.</span><span class="n">addSystemEventTrigger</span><span class="p">(</span><span class="s1">&#39;after&#39;</span><span class="p">,</span> <span class="s1">&#39;shutdown&#39;</span><span class="p">,</span> <span class="n">thread_pool</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span>
        <span class="n">factory</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">Site</span><span class="p">(</span><span class="n">wsgi</span><span class="o">.</span><span class="n">WSGIResource</span><span class="p">(</span><span class="n">reactor</span><span class="p">,</span> <span class="n">thread_pool</span><span class="p">,</span> <span class="n">handler</span><span class="p">))</span>
        <span class="n">reactor</span><span class="o">.</span><span class="n">listenTCP</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">,</span> <span class="n">factory</span><span class="p">,</span> <span class="n">interface</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">reactor</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
            <span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="DieselServer"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.DieselServer">[docs]</a><span class="k">class</span> <span class="nc">DieselServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Untested. &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DieselServer.run"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.DieselServer.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">diesel.protocols.wsgi</span> <span class="k">import</span> <span class="n">WSGIApplication</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">WSGIApplication</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="GeventServer"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.GeventServer">[docs]</a><span class="k">class</span> <span class="nc">GeventServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Untested. Options:</span>

<span class="sd">        * See gevent.wsgi.WSGIServer() documentation for more options.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="GeventServer.run"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.GeventServer.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">gevent</span> <span class="k">import</span> <span class="n">pywsgi</span><span class="p">,</span> <span class="n">local</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">local</span><span class="p">(),</span> <span class="n">local</span><span class="o">.</span><span class="n">local</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Bottle requires gevent.monkey.patch_all() (before import)&quot;</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">quiet</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;log&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">address</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="n">server</span> <span class="o">=</span> <span class="n">pywsgi</span><span class="o">.</span><span class="n">WSGIServer</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">handler</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;BOTTLE_CHILD&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">signal</span>
            <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="n">server</span><span class="o">.</span><span class="n">stop</span><span class="p">())</span>
        <span class="n">server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="GunicornServer"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.GunicornServer">[docs]</a><span class="k">class</span> <span class="nc">GunicornServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Untested. See http://gunicorn.org/configure.html for options. &quot;&quot;&quot;</span>

<div class="viewcode-block" id="GunicornServer.run"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.GunicornServer.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">gunicorn.app.base</span> <span class="k">import</span> <span class="n">Application</span>

        <span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bind&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">))}</span>
        <span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>

        <span class="k">class</span> <span class="nc">GunicornApplication</span><span class="p">(</span><span class="n">Application</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">config</span>

            <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">handler</span>

        <span class="n">GunicornApplication</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="EventletServer"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.EventletServer">[docs]</a><span class="k">class</span> <span class="nc">EventletServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Untested. Options:</span>

<span class="sd">        * `backlog` adjust the eventlet backlog parameter which is the maximum</span>
<span class="sd">          number of queued connections. Should be at least 1; the maximum</span>
<span class="sd">          value is system-dependent.</span>
<span class="sd">        * `family`: (default is 2) socket family, optional. See socket</span>
<span class="sd">          documentation for available families.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="EventletServer.run"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.EventletServer.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">eventlet</span> <span class="k">import</span> <span class="n">wsgi</span><span class="p">,</span> <span class="n">listen</span><span class="p">,</span> <span class="n">patcher</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">patcher</span><span class="o">.</span><span class="n">is_monkey_patched</span><span class="p">(</span><span class="n">os</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Bottle requires eventlet.monkey_patch() (before import)&quot;</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">socket_args</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;backlog&#39;</span><span class="p">,</span> <span class="s1">&#39;family&#39;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">socket_args</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="n">address</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">wsgi</span><span class="o">.</span><span class="n">server</span><span class="p">(</span><span class="n">listen</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="o">**</span><span class="n">socket_args</span><span class="p">),</span> <span class="n">handler</span><span class="p">,</span>
                        <span class="n">log_output</span><span class="o">=</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">quiet</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="c1"># Fallback, if we have old version of eventlet</span>
            <span class="n">wsgi</span><span class="o">.</span><span class="n">server</span><span class="p">(</span><span class="n">listen</span><span class="p">(</span><span class="n">address</span><span class="p">),</span> <span class="n">handler</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="RocketServer"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.RocketServer">[docs]</a><span class="k">class</span> <span class="nc">RocketServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Untested. &quot;&quot;&quot;</span>

<div class="viewcode-block" id="RocketServer.run"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.RocketServer.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">rocket</span> <span class="k">import</span> <span class="n">Rocket</span>
        <span class="n">server</span> <span class="o">=</span> <span class="n">Rocket</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">),</span> <span class="s1">&#39;wsgi&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;wsgi_app&#39;</span><span class="p">:</span> <span class="n">handler</span><span class="p">})</span>
        <span class="n">server</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="BjoernServer"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BjoernServer">[docs]</a><span class="k">class</span> <span class="nc">BjoernServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Fast server written in C: https://github.com/jonashaag/bjoern &quot;&quot;&quot;</span>

<div class="viewcode-block" id="BjoernServer.run"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BjoernServer.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">bjoern</span> <span class="k">import</span> <span class="n">run</span>
        <span class="n">run</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="AsyncioServerAdapter"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.AsyncioServerAdapter">[docs]</a><span class="k">class</span> <span class="nc">AsyncioServerAdapter</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Extend ServerAdapter for adding custom event loop &quot;&quot;&quot;</span>
<div class="viewcode-block" id="AsyncioServerAdapter.get_event_loop"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.AsyncioServerAdapter.get_event_loop">[docs]</a>    <span class="k">def</span> <span class="nf">get_event_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div></div>

<div class="viewcode-block" id="AiohttpServer"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.AiohttpServer">[docs]</a><span class="k">class</span> <span class="nc">AiohttpServer</span><span class="p">(</span><span class="n">AsyncioServerAdapter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Untested.</span>
<span class="sd">        aiohttp</span>
<span class="sd">        https://pypi.python.org/pypi/aiohttp/</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="AiohttpServer.get_event_loop"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.AiohttpServer.get_event_loop">[docs]</a>    <span class="k">def</span> <span class="nf">get_event_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">asyncio</span>
        <span class="k">return</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">new_event_loop</span><span class="p">()</span></div>

<div class="viewcode-block" id="AiohttpServer.run"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.AiohttpServer.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">asyncio</span>
        <span class="kn">from</span> <span class="nn">aiohttp.wsgi</span> <span class="k">import</span> <span class="n">WSGIServerHttpProtocol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
        <span class="n">asyncio</span><span class="o">.</span><span class="n">set_event_loop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>

        <span class="n">protocol_factory</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">WSGIServerHttpProtocol</span><span class="p">(</span>
            <span class="n">handler</span><span class="p">,</span>
            <span class="n">readpayload</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">debug</span><span class="o">=</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">quiet</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">create_server</span><span class="p">(</span><span class="n">protocol_factory</span><span class="p">,</span>
                                                             <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span>
                                                             <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">))</span>

        <span class="k">if</span> <span class="s1">&#39;BOTTLE_CHILD&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">signal</span>
            <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">stop</span><span class="p">())</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">run_forever</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span></div></div>

<div class="viewcode-block" id="AiohttpUVLoopServer"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.AiohttpUVLoopServer">[docs]</a><span class="k">class</span> <span class="nc">AiohttpUVLoopServer</span><span class="p">(</span><span class="n">AiohttpServer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;uvloop</span>
<span class="sd">       https://github.com/MagicStack/uvloop</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="AiohttpUVLoopServer.get_event_loop"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.AiohttpUVLoopServer.get_event_loop">[docs]</a>    <span class="k">def</span> <span class="nf">get_event_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">uvloop</span>
        <span class="k">return</span> <span class="n">uvloop</span><span class="o">.</span><span class="n">new_event_loop</span><span class="p">()</span></div></div>

<div class="viewcode-block" id="AutoServer"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.AutoServer">[docs]</a><span class="k">class</span> <span class="nc">AutoServer</span><span class="p">(</span><span class="n">ServerAdapter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Untested. &quot;&quot;&quot;</span>
    <span class="n">adapters</span> <span class="o">=</span> <span class="p">[</span><span class="n">WaitressServer</span><span class="p">,</span> <span class="n">PasteServer</span><span class="p">,</span> <span class="n">TwistedServer</span><span class="p">,</span> <span class="n">CherryPyServer</span><span class="p">,</span>
                <span class="n">CherootServer</span><span class="p">,</span> <span class="n">WSGIRefServer</span><span class="p">]</span>

<div class="viewcode-block" id="AutoServer.run"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.AutoServer.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">sa</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">adapters</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">sa</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                <span class="k">pass</span></div></div>


<span class="n">server_names</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;cgi&#39;</span><span class="p">:</span> <span class="n">CGIServer</span><span class="p">,</span>
    <span class="s1">&#39;flup&#39;</span><span class="p">:</span> <span class="n">FlupFCGIServer</span><span class="p">,</span>
    <span class="s1">&#39;wsgiref&#39;</span><span class="p">:</span> <span class="n">WSGIRefServer</span><span class="p">,</span>
    <span class="s1">&#39;waitress&#39;</span><span class="p">:</span> <span class="n">WaitressServer</span><span class="p">,</span>
    <span class="s1">&#39;cherrypy&#39;</span><span class="p">:</span> <span class="n">CherryPyServer</span><span class="p">,</span>
    <span class="s1">&#39;cheroot&#39;</span><span class="p">:</span> <span class="n">CherootServer</span><span class="p">,</span>
    <span class="s1">&#39;paste&#39;</span><span class="p">:</span> <span class="n">PasteServer</span><span class="p">,</span>
    <span class="s1">&#39;fapws3&#39;</span><span class="p">:</span> <span class="n">FapwsServer</span><span class="p">,</span>
    <span class="s1">&#39;tornado&#39;</span><span class="p">:</span> <span class="n">TornadoServer</span><span class="p">,</span>
    <span class="s1">&#39;gae&#39;</span><span class="p">:</span> <span class="n">AppEngineServer</span><span class="p">,</span>
    <span class="s1">&#39;twisted&#39;</span><span class="p">:</span> <span class="n">TwistedServer</span><span class="p">,</span>
    <span class="s1">&#39;diesel&#39;</span><span class="p">:</span> <span class="n">DieselServer</span><span class="p">,</span>
    <span class="s1">&#39;meinheld&#39;</span><span class="p">:</span> <span class="n">MeinheldServer</span><span class="p">,</span>
    <span class="s1">&#39;gunicorn&#39;</span><span class="p">:</span> <span class="n">GunicornServer</span><span class="p">,</span>
    <span class="s1">&#39;eventlet&#39;</span><span class="p">:</span> <span class="n">EventletServer</span><span class="p">,</span>
    <span class="s1">&#39;gevent&#39;</span><span class="p">:</span> <span class="n">GeventServer</span><span class="p">,</span>
    <span class="s1">&#39;rocket&#39;</span><span class="p">:</span> <span class="n">RocketServer</span><span class="p">,</span>
    <span class="s1">&#39;bjoern&#39;</span><span class="p">:</span> <span class="n">BjoernServer</span><span class="p">,</span>
    <span class="s1">&#39;aiohttp&#39;</span><span class="p">:</span> <span class="n">AiohttpServer</span><span class="p">,</span>
    <span class="s1">&#39;uvloop&#39;</span><span class="p">:</span> <span class="n">AiohttpUVLoopServer</span><span class="p">,</span>
    <span class="s1">&#39;auto&#39;</span><span class="p">:</span> <span class="n">AutoServer</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1">###############################################################################</span>
<span class="c1"># Application Control ##########################################################</span>
<span class="c1">###############################################################################</span>


<div class="viewcode-block" id="load"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.load">[docs]</a><span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="o">**</span><span class="n">namespace</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Import a module or fetch an object from a module.</span>

<span class="sd">        * ``package.module`` returns `module` as a module object.</span>
<span class="sd">        * ``pack.mod:name`` returns the module variable `name` from `pack.mod`.</span>
<span class="sd">        * ``pack.mod:func()`` calls `pack.mod.func()` and returns the result.</span>

<span class="sd">        The last form accepts not only function calls, but any type of</span>
<span class="sd">        expression. Keyword arguments passed to this function are available as</span>
<span class="sd">        local variables. Example: ``import_string(&#39;re:compile(x)&#39;, x=&#39;[a-z]&#39;)``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">module</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">target</span> <span class="k">else</span> <span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">module</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">target</span><span class="p">:</span> <span class="k">return</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">module</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">isalnum</span><span class="p">():</span> <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">module</span><span class="p">],</span> <span class="n">target</span><span class="p">)</span>
    <span class="n">package_name</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">namespace</span><span class="p">[</span><span class="n">package_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">package_name</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">target</span><span class="p">),</span> <span class="n">namespace</span><span class="p">)</span></div>


<div class="viewcode-block" id="load_app"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.load_app">[docs]</a><span class="k">def</span> <span class="nf">load_app</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Load a bottle application from a module and make sure that the import</span>
<span class="sd">        does not affect the current default application, but returns a separate</span>
<span class="sd">        application object. See :func:`load` for the target parameter. &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">NORUN</span>
    <span class="n">NORUN</span><span class="p">,</span> <span class="n">nr_old</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">NORUN</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">default_app</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>  <span class="c1"># Create a new &quot;default application&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">rv</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>  <span class="c1"># Import the target module</span>
        <span class="k">return</span> <span class="n">rv</span> <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">rv</span><span class="p">)</span> <span class="k">else</span> <span class="n">tmp</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">default_app</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>  <span class="c1"># Remove the temporary added default application</span>
        <span class="n">NORUN</span> <span class="o">=</span> <span class="n">nr_old</span></div>


<span class="n">_debug</span> <span class="o">=</span> <span class="n">debug</span>


<div class="viewcode-block" id="run"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.run">[docs]</a><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">app</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">server</span><span class="o">=</span><span class="s1">&#39;wsgiref&#39;</span><span class="p">,</span>
        <span class="n">host</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
        <span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">,</span>
        <span class="n">interval</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">reloader</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">plugins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">debug</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Start a server instance. This method blocks until the server terminates.</span>

<span class="sd">        :param app: WSGI application or target string supported by</span>
<span class="sd">               :func:`load_app`. (default: :func:`default_app`)</span>
<span class="sd">        :param server: Server adapter to use. See :data:`server_names` keys</span>
<span class="sd">               for valid names or pass a :class:`ServerAdapter` subclass.</span>
<span class="sd">               (default: `wsgiref`)</span>
<span class="sd">        :param host: Server address to bind to. Pass ``0.0.0.0`` to listens on</span>
<span class="sd">               all interfaces including the external one. (default: 127.0.0.1)</span>
<span class="sd">        :param port: Server port to bind to. Values below 1024 require root</span>
<span class="sd">               privileges. (default: 8080)</span>
<span class="sd">        :param reloader: Start auto-reloading server? (default: False)</span>
<span class="sd">        :param interval: Auto-reloader interval in seconds (default: 1)</span>
<span class="sd">        :param quiet: Suppress output to stdout and stderr? (default: False)</span>
<span class="sd">        :param options: Options passed to the server adapter.</span>
<span class="sd">     &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">NORUN</span><span class="p">:</span> <span class="k">return</span>
    <span class="k">if</span> <span class="n">reloader</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;BOTTLE_CHILD&#39;</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">subprocess</span>
        <span class="n">lockfile</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fd</span><span class="p">,</span> <span class="n">lockfile</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;bottle.&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.lock&#39;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>  <span class="c1"># We only need this file to exist. We never write to it</span>
            <span class="k">while</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">lockfile</span><span class="p">):</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">]</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span>
                <span class="n">environ</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;BOTTLE_CHILD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;true&#39;</span>
                <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;BOTTLE_LOCKFILE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lockfile</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="n">environ</span><span class="p">)</span>
                <span class="k">while</span> <span class="n">p</span><span class="o">.</span><span class="n">poll</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Busy wait...</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">utime</span><span class="p">(</span><span class="n">lockfile</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1"># I am alive!</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">poll</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">lockfile</span><span class="p">):</span> <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">lockfile</span><span class="p">)</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">poll</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">lockfile</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">lockfile</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">debug</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">_debug</span><span class="p">(</span><span class="n">debug</span><span class="p">)</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">app</span> <span class="ow">or</span> <span class="n">default_app</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="n">app</span> <span class="o">=</span> <span class="n">load_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Application is not callable: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">app</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">plugin</span> <span class="ow">in</span> <span class="n">plugins</span> <span class="ow">or</span> <span class="p">[]:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                <span class="n">plugin</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">plugin</span><span class="p">)</span>
            <span class="n">app</span><span class="o">.</span><span class="n">install</span><span class="p">(</span><span class="n">plugin</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">config</span><span class="p">:</span>
            <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">server</span> <span class="ow">in</span> <span class="n">server_names</span><span class="p">:</span>
            <span class="n">server</span> <span class="o">=</span> <span class="n">server_names</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">server</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="n">server</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">server</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
            <span class="n">server</span> <span class="o">=</span> <span class="n">server</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">ServerAdapter</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown or unsupported server: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">server</span><span class="p">)</span>

        <span class="n">server</span><span class="o">.</span><span class="n">quiet</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">quiet</span> <span class="ow">or</span> <span class="n">quiet</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">server</span><span class="o">.</span><span class="n">quiet</span><span class="p">:</span>
            <span class="n">_stderr</span><span class="p">(</span><span class="s2">&quot;Bottle v</span><span class="si">%s</span><span class="s2"> server starting up (using </span><span class="si">%s</span><span class="s2">)...</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span>
                    <span class="p">(</span><span class="n">__version__</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">server</span><span class="p">)))</span>
            <span class="n">_stderr</span><span class="p">(</span><span class="s2">&quot;Listening on http://</span><span class="si">%s</span><span class="s2">:</span><span class="si">%d</span><span class="s2">/</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span>
                    <span class="p">(</span><span class="n">server</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">server</span><span class="o">.</span><span class="n">port</span><span class="p">))</span>
            <span class="n">_stderr</span><span class="p">(</span><span class="s2">&quot;Hit Ctrl-C to quit.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">reloader</span><span class="p">:</span>
            <span class="n">lockfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;BOTTLE_LOCKFILE&#39;</span><span class="p">)</span>
            <span class="n">bgcheck</span> <span class="o">=</span> <span class="n">FileCheckerThread</span><span class="p">(</span><span class="n">lockfile</span><span class="p">,</span> <span class="n">interval</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">bgcheck</span><span class="p">:</span>
                <span class="n">server</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">bgcheck</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;reload&#39;</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">server</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">SystemExit</span><span class="p">,</span> <span class="ne">MemoryError</span><span class="p">):</span>
        <span class="k">raise</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">reloader</span><span class="p">:</span> <span class="k">raise</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="s1">&#39;quiet&#39;</span><span class="p">,</span> <span class="n">quiet</span><span class="p">):</span>
            <span class="n">print_exc</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span></div>


<div class="viewcode-block" id="FileCheckerThread"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.FileCheckerThread">[docs]</a><span class="k">class</span> <span class="nc">FileCheckerThread</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Interrupt main-thread as soon as a changed module file is detected,</span>
<span class="sd">        the lockfile gets deleted or gets too old. &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lockfile</span><span class="p">,</span> <span class="n">interval</span><span class="p">):</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lockfile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">=</span> <span class="n">lockfile</span><span class="p">,</span> <span class="n">interval</span>
        <span class="c1">#: Is one of &#39;reload&#39;, &#39;error&#39; or &#39;exit&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="FileCheckerThread.run"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.FileCheckerThread.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">exists</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span>
        <span class="n">mtime</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">st_mtime</span>
        <span class="n">files</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="s1">&#39;__file__&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;.pyo&#39;</span><span class="p">,</span> <span class="s1">&#39;.pyc&#39;</span><span class="p">):</span> <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">path</span> <span class="ow">and</span> <span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span> <span class="n">files</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="n">mtime</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lockfile</span><span class="p">)</span>\
            <span class="ow">or</span> <span class="n">mtime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lockfile</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">-</span> <span class="mi">5</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;error&#39;</span>
                <span class="n">thread</span><span class="o">.</span><span class="n">interrupt_main</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">lmtime</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">files</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">or</span> <span class="n">mtime</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">lmtime</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;reload&#39;</span>
                    <span class="n">thread</span><span class="o">.</span><span class="n">interrupt_main</span><span class="p">()</span>
                    <span class="k">break</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;exit&#39;</span>  <span class="c1"># silent exit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">exc_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="ne">KeyboardInterrupt</span><span class="p">)</span></div>

<span class="c1">###############################################################################</span>
<span class="c1"># Template Adapters ############################################################</span>
<span class="c1">###############################################################################</span>


<div class="viewcode-block" id="TemplateError"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.TemplateError">[docs]</a><span class="k">class</span> <span class="nc">TemplateError</span><span class="p">(</span><span class="n">BottleException</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="BaseTemplate"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BaseTemplate">[docs]</a><span class="k">class</span> <span class="nc">BaseTemplate</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Base class and minimal API for template adapters &quot;&quot;&quot;</span>
    <span class="n">extensions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;tpl&#39;</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span><span class="p">,</span> <span class="s1">&#39;thtml&#39;</span><span class="p">,</span> <span class="s1">&#39;stpl&#39;</span><span class="p">]</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1">#used in prepare()</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1">#used in render()</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">lookup</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create a new template.</span>
<span class="sd">        If the source parameter (str or buffer) is missing, the name argument</span>
<span class="sd">        is used to guess a template filename. Subclasses can assume that</span>
<span class="sd">        self.source and/or self.filename are set. Both are strings.</span>
<span class="sd">        The lookup, encoding and settings parameters are stored as instance</span>
<span class="sd">        variables.</span>
<span class="sd">        The lookup parameter stores a list containing directory paths.</span>
<span class="sd">        The encoding parameter should be used to decode byte strings or files.</span>
<span class="sd">        The settings parameter contains a dict for engine-specific settings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s1">&#39;read&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">filename</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s1">&#39;filename&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lookup</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lookup</span><span class="p">]</span> <span class="k">if</span> <span class="n">lookup</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">encoding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># Copy from class variable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>  <span class="c1"># Apply</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookup</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">TemplateError</span><span class="p">(</span><span class="s1">&#39;Template </span><span class="si">%s</span><span class="s1"> not found.&#39;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TemplateError</span><span class="p">(</span><span class="s1">&#39;No template specified.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">)</span>

<div class="viewcode-block" id="BaseTemplate.search"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BaseTemplate.search">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">lookup</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Search name in all directories specified in lookup.</span>
<span class="sd">        First without, then with common extensions. Return first hit. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">lookup</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">depr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="s2">&quot;Empty template lookup path.&quot;</span><span class="p">,</span> <span class="s2">&quot;Configure a template lookup path.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">depr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="s2">&quot;Use of absolute path for template name.&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;Refer to templates with names or paths relative to the lookup path.&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">spath</span> <span class="ow">in</span> <span class="n">lookup</span><span class="p">:</span>
            <span class="n">spath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">spath</span><span class="p">)</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">spath</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">fname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">spath</span><span class="p">):</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span> <span class="k">return</span> <span class="n">fname</span>
            <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">extensions</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">ext</span><span class="p">)):</span>
                    <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseTemplate.global_config"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BaseTemplate.global_config">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">global_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This reads or sets the global settings stored in class.settings. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># Make settings local to class</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span></div>

<div class="viewcode-block" id="BaseTemplate.prepare"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BaseTemplate.prepare">[docs]</a>    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Run preparations (parsing, caching, ...).</span>
<span class="sd">        It should be possible to call this again to refresh a template or to</span>
<span class="sd">        update settings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="BaseTemplate.render"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.BaseTemplate.render">[docs]</a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Render the template with the specified local variables and return</span>
<span class="sd">        a single byte or unicode string. If it is a byte string, the encoding</span>
<span class="sd">        must match self.encoding. This method must be thread-safe!</span>
<span class="sd">        Local variables may be provided in dictionaries (args)</span>
<span class="sd">        or directly, as keywords (kwargs).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div></div>


<div class="viewcode-block" id="MakoTemplate"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.MakoTemplate">[docs]</a><span class="k">class</span> <span class="nc">MakoTemplate</span><span class="p">(</span><span class="n">BaseTemplate</span><span class="p">):</span>
<div class="viewcode-block" id="MakoTemplate.prepare"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.MakoTemplate.prepare">[docs]</a>    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">mako.template</span> <span class="k">import</span> <span class="n">Template</span>
        <span class="kn">from</span> <span class="nn">mako.lookup</span> <span class="k">import</span> <span class="n">TemplateLookup</span>
        <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;input_encoding&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">})</span>
        <span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;format_exceptions&#39;</span><span class="p">,</span> <span class="nb">bool</span><span class="p">(</span><span class="n">DEBUG</span><span class="p">))</span>
        <span class="n">lookup</span> <span class="o">=</span> <span class="n">TemplateLookup</span><span class="p">(</span><span class="n">directories</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lookup</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tpl</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="n">lookup</span><span class="o">=</span><span class="n">lookup</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tpl</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                <span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                                <span class="n">lookup</span><span class="o">=</span><span class="n">lookup</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span></div>

<div class="viewcode-block" id="MakoTemplate.render"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.MakoTemplate.render">[docs]</a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">dictarg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dictarg</span><span class="p">)</span>
        <span class="n">_defaults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">_defaults</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tpl</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="o">**</span><span class="n">_defaults</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="CheetahTemplate"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.CheetahTemplate">[docs]</a><span class="k">class</span> <span class="nc">CheetahTemplate</span><span class="p">(</span><span class="n">BaseTemplate</span><span class="p">):</span>
<div class="viewcode-block" id="CheetahTemplate.prepare"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.CheetahTemplate.prepare">[docs]</a>    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">Cheetah.Template</span> <span class="k">import</span> <span class="n">Template</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">local</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">vars</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">options</span><span class="p">[</span><span class="s1">&#39;searchList&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">vars</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tpl</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tpl</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span></div>

<div class="viewcode-block" id="CheetahTemplate.render"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.CheetahTemplate.render">[docs]</a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">dictarg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dictarg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">vars</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">vars</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tpl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">vars</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">out</span></div></div>


<div class="viewcode-block" id="Jinja2Template"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Jinja2Template">[docs]</a><span class="k">class</span> <span class="nc">Jinja2Template</span><span class="p">(</span><span class="n">BaseTemplate</span><span class="p">):</span>
<div class="viewcode-block" id="Jinja2Template.prepare"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Jinja2Template.prepare">[docs]</a>    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tests</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="p">{},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">jinja2</span> <span class="k">import</span> <span class="n">Environment</span><span class="p">,</span> <span class="n">FunctionLoader</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="n">loader</span><span class="o">=</span><span class="n">FunctionLoader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filters</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tests</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">tests</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tests</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">globals</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">globals</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">globals</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tpl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tpl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Jinja2Template.render"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Jinja2Template.render">[docs]</a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">dictarg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dictarg</span><span class="p">)</span>
        <span class="n">_defaults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">_defaults</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tpl</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="o">**</span><span class="n">_defaults</span><span class="p">)</span></div>

<div class="viewcode-block" id="Jinja2Template.loader"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.Jinja2Template.loader">[docs]</a>    <span class="k">def</span> <span class="nf">loader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">:</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookup</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fname</span><span class="p">:</span> <span class="k">return</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">),</span> <span class="n">fname</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="kc">False</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="SimpleTemplate"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.SimpleTemplate">[docs]</a><span class="k">class</span> <span class="nc">SimpleTemplate</span><span class="p">(</span><span class="n">BaseTemplate</span><span class="p">):</span>
<div class="viewcode-block" id="SimpleTemplate.prepare"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.SimpleTemplate.prepare">[docs]</a>    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">escape_func</span><span class="o">=</span><span class="n">html_escape</span><span class="p">,</span>
                <span class="n">noescape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">syntax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">ka</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">enc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_str</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">touni</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">enc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_escape</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">escape_func</span><span class="p">(</span><span class="n">touni</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">enc</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">syntax</span> <span class="o">=</span> <span class="n">syntax</span>
        <span class="k">if</span> <span class="n">noescape</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_escape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_escape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_str</span></div>

<div class="viewcode-block" id="SimpleTemplate.co"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.SimpleTemplate.co">[docs]</a>    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">co</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">compile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="ow">or</span> <span class="s1">&#39;&lt;string&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;exec&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SimpleTemplate.code"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.SimpleTemplate.code">[docs]</a>    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">source</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">source</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">source</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="n">touni</span><span class="p">(</span><span class="n">source</span><span class="p">),</span> <span class="s1">&#39;utf8&#39;</span>
        <span class="k">except</span> <span class="ne">UnicodeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">depr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="s1">&#39;Unsupported template encodings.&#39;</span><span class="p">,</span> <span class="s1">&#39;Use utf-8 for templates.&#39;</span><span class="p">)</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">StplParser</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">syntax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">syntax</span><span class="p">)</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">translate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">encoding</span>
        <span class="k">return</span> <span class="n">code</span></div>

    <span class="k">def</span> <span class="nf">_rebase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_env</span><span class="p">,</span> <span class="n">_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">_env</span><span class="p">[</span><span class="s1">&#39;_rebase&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">_name</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_include</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_env</span><span class="p">,</span> <span class="n">_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">_env</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">env</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">_name</span><span class="p">,</span> <span class="n">lookup</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lookup</span><span class="p">,</span> <span class="n">syntax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">syntax</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">_name</span><span class="p">]</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_stdout&#39;</span><span class="p">],</span> <span class="n">env</span><span class="p">)</span>

<div class="viewcode-block" id="SimpleTemplate.execute"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.SimpleTemplate.execute">[docs]</a>    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_stdout</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">env</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">env</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s1">&#39;_stdout&#39;</span><span class="p">:</span> <span class="n">_stdout</span><span class="p">,</span>
            <span class="s1">&#39;_printlist&#39;</span><span class="p">:</span> <span class="n">_stdout</span><span class="o">.</span><span class="n">extend</span><span class="p">,</span>
            <span class="s1">&#39;include&#39;</span><span class="p">:</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_include</span><span class="p">,</span> <span class="n">env</span><span class="p">),</span>
            <span class="s1">&#39;rebase&#39;</span><span class="p">:</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rebase</span><span class="p">,</span> <span class="n">env</span><span class="p">),</span>
            <span class="s1">&#39;_rebase&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;_str&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_str</span><span class="p">,</span>
            <span class="s1">&#39;_escape&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_escape</span><span class="p">,</span>
            <span class="s1">&#39;get&#39;</span><span class="p">:</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">,</span>
            <span class="s1">&#39;setdefault&#39;</span><span class="p">:</span> <span class="n">env</span><span class="o">.</span><span class="n">setdefault</span><span class="p">,</span>
            <span class="s1">&#39;defined&#39;</span><span class="p">:</span> <span class="n">env</span><span class="o">.</span><span class="fm">__contains__</span>
        <span class="p">})</span>
        <span class="n">exec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">co</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_rebase&#39;</span><span class="p">):</span>
            <span class="n">subtpl</span><span class="p">,</span> <span class="n">rargs</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_rebase&#39;</span><span class="p">)</span>
            <span class="n">rargs</span><span class="p">[</span><span class="s1">&#39;base&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_stdout</span><span class="p">)</span>  <span class="c1">#copy stdout</span>
            <span class="k">del</span> <span class="n">_stdout</span><span class="p">[:]</span>  <span class="c1"># clear stdout</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_include</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">subtpl</span><span class="p">,</span> <span class="o">**</span><span class="n">rargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">env</span></div>

<div class="viewcode-block" id="SimpleTemplate.render"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.SimpleTemplate.render">[docs]</a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Render the template using keyword arguments as local variables. &quot;&quot;&quot;</span>
        <span class="n">env</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">stdout</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dictarg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dictarg</span><span class="p">)</span>
        <span class="n">env</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stdout</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="StplSyntaxError"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.StplSyntaxError">[docs]</a><span class="k">class</span> <span class="nc">StplSyntaxError</span><span class="p">(</span><span class="n">TemplateError</span><span class="p">):</span>

    <span class="k">pass</span></div>


<div class="viewcode-block" id="StplParser"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.StplParser">[docs]</a><span class="k">class</span> <span class="nc">StplParser</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Parser for stpl templates. &quot;&quot;&quot;</span>
    <span class="n">_re_cache</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1">#: Cache for compiled re patterns</span>

    <span class="c1"># This huge pile of voodoo magic splits python code into 8 different tokens.</span>
    <span class="c1"># We use the verbose (?x) regex mode to make this more manageable</span>

    <span class="n">_re_tok</span> <span class="o">=</span> <span class="n">_re_inl</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;(?mx)(        # verbose and dot-matches-newline mode</span>
<span class="s1">        [urbURB]*</span>
<span class="s1">        (?:  &#39;&#39;(?!&#39;)</span>
<span class="s1">            |&quot;&quot;(?!&quot;)</span>
<span class="s1">            |&#39;</span><span class="si">{6}</span><span class="s1"></span>
<span class="s1">            |&quot;</span><span class="si">{6}</span><span class="s1"></span>
<span class="s1">            |&#39;(?:[^\\&#39;]|\\.)+?&#39;</span>
<span class="s1">            |&quot;(?:[^\\&quot;]|\\.)+?&quot;</span>
<span class="s1">            |&#39;</span><span class="si">{3}</span><span class="s1">(?:[^\\]|\\.|\n)+?&#39;</span><span class="si">{3}</span><span class="s1"></span>
<span class="s1">            |&quot;</span><span class="si">{3}</span><span class="s1">(?:[^\\]|\\.|\n)+?&quot;</span><span class="si">{3}</span><span class="s1"></span>
<span class="s1">        )</span>
<span class="s1">    )&#39;&#39;&#39;</span>

    <span class="n">_re_inl</span> <span class="o">=</span> <span class="n">_re_tok</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;|\n&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># We re-use this string pattern later</span>

    <span class="n">_re_tok</span> <span class="o">+=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        # 2: Comments (until end of line, but not the newline itself)</span>
<span class="s1">        |(\#.*)</span>

<span class="s1">        # 3: Open and close (4) grouping tokens</span>
<span class="s1">        |([\[\{\(])</span>
<span class="s1">        |([\]\}\)])</span>

<span class="s1">        # 5,6: Keywords that start or continue a python block (only start of line)</span>
<span class="s1">        |^([\ \t]*(?:if|for|while|with|try|def|class)\b)</span>
<span class="s1">        |^([\ \t]*(?:elif|else|except|finally)\b)</span>

<span class="s1">        # 7: Our special &#39;end&#39; keyword (but only if it stands alone)</span>
<span class="s1">        |((?:^|;)[\ \t]*end[\ \t]*(?=(?:</span><span class="si">%(block_close)s</span><span class="s1">[\ \t]*)?\r?$|;|\#))</span>

<span class="s1">        # 8: A customizable end-of-code-block template token (only end of line)</span>
<span class="s1">        |(</span><span class="si">%(block_close)s</span><span class="s1">[\ \t]*(?=\r?$))</span>

<span class="s1">        # 9: And finally, a single newline. The 10th token is &#39;everything else&#39;</span>
<span class="s1">        |(\r?\n)</span>
<span class="s1">    &#39;&#39;&#39;</span>

    <span class="c1"># Match the start tokens of code areas in a template</span>
    <span class="n">_re_split</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;(?m)^[ \t]*(\\?)((</span><span class="si">%(line_start)s</span><span class="s1">)|(</span><span class="si">%(block_start)s</span><span class="s1">))&#39;&#39;&#39;</span>
    <span class="c1"># Match inline statements (may contain python strings)</span>
    <span class="n">_re_inl</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;</span><span class="si">%%</span><span class="s1">(inline_start)s((?:</span><span class="si">%s</span><span class="s1">|[^&#39;&quot;\n]+?)*?)</span><span class="si">%%</span><span class="s1">(inline_end)s&#39;&#39;&#39;</span> <span class="o">%</span> <span class="n">_re_inl</span>

    <span class="n">default_syntax</span> <span class="o">=</span> <span class="s1">&#39;&lt;</span><span class="si">% %</span><span class="s1">&gt; % {{ }}&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">syntax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">touni</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">encoding</span><span class="p">),</span> <span class="n">encoding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_syntax</span><span class="p">(</span><span class="n">syntax</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_syntax</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code_buffer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_buffer</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent_mod</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">paren_depth</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="StplParser.get_syntax"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.StplParser.get_syntax">[docs]</a>    <span class="k">def</span> <span class="nf">get_syntax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Tokens as a space separated string (default: &lt;% %&gt; % {{ }}) &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_syntax</span></div>

<div class="viewcode-block" id="StplParser.set_syntax"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.StplParser.set_syntax">[docs]</a>    <span class="k">def</span> <span class="nf">set_syntax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">syntax</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_syntax</span> <span class="o">=</span> <span class="n">syntax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tokens</span> <span class="o">=</span> <span class="n">syntax</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">syntax</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_re_cache</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="s1">&#39;block_start block_close line_start inline_start inline_end&#39;</span>
            <span class="n">etokens</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokens</span><span class="p">)</span>
            <span class="n">pattern_vars</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="n">etokens</span><span class="p">))</span>
            <span class="n">patterns</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_re_split</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_re_tok</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_re_inl</span><span class="p">)</span>
            <span class="n">patterns</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">p</span> <span class="o">%</span> <span class="n">pattern_vars</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">patterns</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_re_cache</span><span class="p">[</span><span class="n">syntax</span><span class="p">]</span> <span class="o">=</span> <span class="n">patterns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">re_split</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">re_tok</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">re_inl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_re_cache</span><span class="p">[</span><span class="n">syntax</span><span class="p">]</span></div>

    <span class="n">syntax</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_syntax</span><span class="p">,</span> <span class="n">set_syntax</span><span class="p">)</span>

<div class="viewcode-block" id="StplParser.translate"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.StplParser.translate">[docs]</a>    <span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Parser is a one time instance.&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">re_split</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">:</span><span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">text_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>  <span class="c1"># Escape syntax</span>
                    <span class="n">line</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">:]</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">text_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">():</span><span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span> <span class="o">+</span>
                                            <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">line</span> <span class="o">+</span> <span class="n">sep</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="n">sep</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">flush_text</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_code</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">:],</span>
                                              <span class="n">multiline</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">:])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flush_text</span><span class="p">()</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code_buffer</span><span class="p">)</span></div>

<div class="viewcode-block" id="StplParser.read_code"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.StplParser.read_code">[docs]</a>    <span class="k">def</span> <span class="nf">read_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pysource</span><span class="p">,</span> <span class="n">multiline</span><span class="p">):</span>
        <span class="n">code_line</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">re_tok</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pysource</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">code_line</span> <span class="o">+=</span> <span class="n">pysource</span><span class="p">[</span><span class="n">offset</span><span class="p">:]</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pysource</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write_code</span><span class="p">(</span><span class="n">code_line</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">comment</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="n">code_line</span> <span class="o">+=</span> <span class="n">pysource</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()]</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
            <span class="n">_str</span><span class="p">,</span> <span class="n">_com</span><span class="p">,</span> <span class="n">_po</span><span class="p">,</span> <span class="n">_pc</span><span class="p">,</span> <span class="n">_blk1</span><span class="p">,</span> <span class="n">_blk2</span><span class="p">,</span> <span class="n">_end</span><span class="p">,</span> <span class="n">_cend</span><span class="p">,</span> <span class="n">_nl</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">paren_depth</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">_blk1</span> <span class="ow">or</span> <span class="n">_blk2</span><span class="p">):</span>  <span class="c1"># a if b else c</span>
                <span class="n">code_line</span> <span class="o">+=</span> <span class="n">_blk1</span> <span class="ow">or</span> <span class="n">_blk2</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">_str</span><span class="p">:</span>  <span class="c1"># Python string</span>
                <span class="n">code_line</span> <span class="o">+=</span> <span class="n">_str</span>
            <span class="k">elif</span> <span class="n">_com</span><span class="p">:</span>  <span class="c1"># Python comment (up to EOL)</span>
                <span class="n">comment</span> <span class="o">=</span> <span class="n">_com</span>
                <span class="k">if</span> <span class="n">multiline</span> <span class="ow">and</span> <span class="n">_com</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="n">multiline</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Allow end-of-block in comments</span>
            <span class="k">elif</span> <span class="n">_po</span><span class="p">:</span>  <span class="c1"># open parenthesis</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">paren_depth</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">code_line</span> <span class="o">+=</span> <span class="n">_po</span>
            <span class="k">elif</span> <span class="n">_pc</span><span class="p">:</span>  <span class="c1"># close parenthesis</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">paren_depth</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># we could check for matching parentheses here, but it&#39;s</span>
                    <span class="c1"># easier to leave that to python - just check counts</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">paren_depth</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">code_line</span> <span class="o">+=</span> <span class="n">_pc</span>
            <span class="k">elif</span> <span class="n">_blk1</span><span class="p">:</span>  <span class="c1"># Start-block keyword (if/for/while/def/try/...)</span>
                <span class="n">code_line</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent_mod</span> <span class="o">=</span> <span class="n">_blk1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">indent</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">_blk2</span><span class="p">:</span>  <span class="c1"># Continue-block keyword (else/elif/except/...)</span>
                <span class="n">code_line</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent_mod</span> <span class="o">=</span> <span class="n">_blk2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">elif</span> <span class="n">_end</span><span class="p">:</span>  <span class="c1"># The non-standard &#39;end&#39;-keyword (ends a block)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">indent</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">_cend</span><span class="p">:</span>  <span class="c1"># The end-code-block template token (usually &#39;%&gt;&#39;)</span>
                <span class="k">if</span> <span class="n">multiline</span><span class="p">:</span> <span class="n">multiline</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span> <span class="n">code_line</span> <span class="o">+=</span> <span class="n">_cend</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># \n</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write_code</span><span class="p">(</span><span class="n">code_line</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">comment</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lineno</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">code_line</span><span class="p">,</span> <span class="n">comment</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent_mod</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">multiline</span><span class="p">:</span>
                    <span class="k">break</span>

        <span class="k">return</span> <span class="n">offset</span></div>

<div class="viewcode-block" id="StplParser.flush_text"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.StplParser.flush_text">[docs]</a>    <span class="k">def</span> <span class="nf">flush_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text_buffer</span><span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_buffer</span><span class="p">[:]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span><span class="p">:</span> <span class="k">return</span>
        <span class="n">parts</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">nl</span> <span class="o">=</span> <span class="p">[],</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;  &#39;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">re_inl</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="n">prefix</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()],</span> <span class="n">m</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">prefix</span><span class="p">:</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nl</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">repr</span><span class="p">,</span> <span class="n">prefix</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="kc">True</span><span class="p">))))</span>
            <span class="k">if</span> <span class="n">prefix</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">nl</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process_inline</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">pos</span><span class="p">:]</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">prefix</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\\n</span><span class="s1">&#39;</span><span class="p">):</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\\r\n</span><span class="s1">&#39;</span><span class="p">):</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nl</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">repr</span><span class="p">,</span> <span class="n">lines</span><span class="p">)))</span>
        <span class="n">code</span> <span class="o">=</span> <span class="s1">&#39;_printlist((</span><span class="si">%s</span><span class="s1">,))&#39;</span> <span class="o">%</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineno</span> <span class="o">+=</span> <span class="n">code</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_code</span><span class="p">(</span><span class="n">code</span><span class="p">)</span></div>

<div class="viewcode-block" id="StplParser.process_inline"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.StplParser.process_inline">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">process_inline</span><span class="p">(</span><span class="n">chunk</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">chunk</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;!&#39;</span><span class="p">:</span> <span class="k">return</span> <span class="s1">&#39;_str(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">chunk</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">return</span> <span class="s1">&#39;_escape(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">chunk</span></div>

<div class="viewcode-block" id="StplParser.write_code"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.StplParser.write_code">[docs]</a>    <span class="k">def</span> <span class="nf">write_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="n">code</span> <span class="o">=</span> <span class="s1">&#39;  &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent_mod</span><span class="p">)</span>
        <span class="n">code</span> <span class="o">+=</span> <span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span> <span class="o">+</span> <span class="n">comment</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">code</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="template"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.template">[docs]</a><span class="k">def</span> <span class="nf">template</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a rendered template as a string iterator.</span>
<span class="sd">    You can use a name, a filename or a template string as first parameter.</span>
<span class="sd">    Template rendering arguments can be passed as dictionaries</span>
<span class="sd">    or directly (as keyword arguments).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tpl</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">args</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">dictarg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dictarg</span><span class="p">)</span>
    <span class="n">adapter</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;template_adapter&#39;</span><span class="p">,</span> <span class="n">SimpleTemplate</span><span class="p">)</span>
    <span class="n">lookup</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;template_lookup&#39;</span><span class="p">,</span> <span class="n">TEMPLATE_PATH</span><span class="p">)</span>
    <span class="n">tplid</span> <span class="o">=</span> <span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">lookup</span><span class="p">),</span> <span class="n">tpl</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tplid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TEMPLATES</span> <span class="ow">or</span> <span class="n">DEBUG</span><span class="p">:</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;template_settings&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tpl</span><span class="p">,</span> <span class="n">adapter</span><span class="p">):</span>
            <span class="n">TEMPLATES</span><span class="p">[</span><span class="n">tplid</span><span class="p">]</span> <span class="o">=</span> <span class="n">tpl</span>
            <span class="k">if</span> <span class="n">settings</span><span class="p">:</span> <span class="n">TEMPLATES</span><span class="p">[</span><span class="n">tplid</span><span class="p">]</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="o">**</span><span class="n">settings</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">tpl</span> <span class="ow">or</span> <span class="s2">&quot;{&quot;</span> <span class="ow">in</span> <span class="n">tpl</span> <span class="ow">or</span> <span class="s2">&quot;%&quot;</span> <span class="ow">in</span> <span class="n">tpl</span> <span class="ow">or</span> <span class="s1">&#39;$&#39;</span> <span class="ow">in</span> <span class="n">tpl</span><span class="p">:</span>
            <span class="n">TEMPLATES</span><span class="p">[</span><span class="n">tplid</span><span class="p">]</span> <span class="o">=</span> <span class="n">adapter</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">tpl</span><span class="p">,</span> <span class="n">lookup</span><span class="o">=</span><span class="n">lookup</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">TEMPLATES</span><span class="p">[</span><span class="n">tplid</span><span class="p">]</span> <span class="o">=</span> <span class="n">adapter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">tpl</span><span class="p">,</span> <span class="n">lookup</span><span class="o">=</span><span class="n">lookup</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">TEMPLATES</span><span class="p">[</span><span class="n">tplid</span><span class="p">]:</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;Template (</span><span class="si">%s</span><span class="s1">) not found&#39;</span> <span class="o">%</span> <span class="n">tpl</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">TEMPLATES</span><span class="p">[</span><span class="n">tplid</span><span class="p">]</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span></div>


<span class="n">mako_template</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">template_adapter</span><span class="o">=</span><span class="n">MakoTemplate</span><span class="p">)</span>
<span class="n">cheetah_template</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">template</span><span class="p">,</span>
                                     <span class="n">template_adapter</span><span class="o">=</span><span class="n">CheetahTemplate</span><span class="p">)</span>
<span class="n">jinja2_template</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">template_adapter</span><span class="o">=</span><span class="n">Jinja2Template</span><span class="p">)</span>


<div class="viewcode-block" id="view"><a class="viewcode-back" href="../../../mathviz_hopper.src.html#mathviz_hopper.src.bottle.view">[docs]</a><span class="k">def</span> <span class="nf">view</span><span class="p">(</span><span class="n">tpl_name</span><span class="p">,</span> <span class="o">**</span><span class="n">defaults</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Decorator: renders a template for a handler.</span>
<span class="sd">        The handler can control its behavior like that:</span>

<span class="sd">          - return a dict of template vars to fill out the template</span>
<span class="sd">          - return something other than a dict and the view decorator will not</span>
<span class="sd">            process the template, but return the handler result as is.</span>
<span class="sd">            This includes returning a HTTPResponse(dict) to get,</span>
<span class="sd">            for instance, JSON with autojson or other castfilters.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>

        <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">DictMixin</span><span class="p">)):</span>
                <span class="n">tplvars</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">tplvars</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">template</span><span class="p">(</span><span class="n">tpl_name</span><span class="p">,</span> <span class="o">**</span><span class="n">tplvars</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">template</span><span class="p">(</span><span class="n">tpl_name</span><span class="p">,</span> <span class="n">defaults</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="k">return</span> <span class="n">wrapper</span>

    <span class="k">return</span> <span class="n">decorator</span></div>


<span class="n">mako_view</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">template_adapter</span><span class="o">=</span><span class="n">MakoTemplate</span><span class="p">)</span>
<span class="n">cheetah_view</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">template_adapter</span><span class="o">=</span><span class="n">CheetahTemplate</span><span class="p">)</span>
<span class="n">jinja2_view</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">template_adapter</span><span class="o">=</span><span class="n">Jinja2Template</span><span class="p">)</span>

<span class="c1">###############################################################################</span>
<span class="c1"># Constants and Globals ########################################################</span>
<span class="c1">###############################################################################</span>

<span class="n">TEMPLATE_PATH</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="s1">&#39;./views/&#39;</span><span class="p">]</span>
<span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">NORUN</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># If set, run() does nothing. Used by load_app()</span>

<span class="c1">#: A dict to map HTTP status codes (e.g. 404) to phrases (e.g. &#39;Not Found&#39;)</span>
<span class="n">HTTP_CODES</span> <span class="o">=</span> <span class="n">httplib</span><span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">HTTP_CODES</span><span class="p">[</span><span class="mi">418</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;I&#39;m a teapot&quot;</span>  <span class="c1"># RFC 2324</span>
<span class="n">HTTP_CODES</span><span class="p">[</span><span class="mi">428</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Precondition Required&quot;</span>
<span class="n">HTTP_CODES</span><span class="p">[</span><span class="mi">429</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Too Many Requests&quot;</span>
<span class="n">HTTP_CODES</span><span class="p">[</span><span class="mi">431</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Request Header Fields Too Large&quot;</span>
<span class="n">HTTP_CODES</span><span class="p">[</span><span class="mi">451</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Unavailable For Legal Reasons&quot;</span> <span class="c1"># RFC 7725</span>
<span class="n">HTTP_CODES</span><span class="p">[</span><span class="mi">511</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Network Authentication Required&quot;</span>
<span class="n">_HTTP_STATUS_LINES</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
                          <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">HTTP_CODES</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

<span class="c1">#: The default template used for error pages. Override with @error()</span>
<span class="n">ERROR_PAGE_TEMPLATE</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="si">%%</span><span class="s2">try:</span>
<span class="s2">    </span><span class="si">%%</span><span class="s2">from </span><span class="si">%s</span><span class="s2"> import DEBUG, request</span>
<span class="s2">    &lt;!DOCTYPE HTML PUBLIC &quot;-//IETF//DTD HTML 2.0//EN&quot;&gt;</span>
<span class="s2">    &lt;html&gt;</span>
<span class="s2">        &lt;head&gt;</span>
<span class="s2">            &lt;title&gt;Error: {{e.status}}&lt;/title&gt;</span>
<span class="s2">            &lt;style type=&quot;text/css&quot;&gt;</span>
<span class="s2">              html {background-color: #eee; font-family: sans-serif;}</span>
<span class="s2">              body {background-color: #fff; border: 1px solid #ddd;</span>
<span class="s2">                    padding: 15px; margin: 15px;}</span>
<span class="s2">              pre {background-color: #eee; border: 1px solid #ddd; padding: 5px;}</span>
<span class="s2">            &lt;/style&gt;</span>
<span class="s2">        &lt;/head&gt;</span>
<span class="s2">        &lt;body&gt;</span>
<span class="s2">            &lt;h1&gt;Error: {{e.status}}&lt;/h1&gt;</span>
<span class="s2">            &lt;p&gt;Sorry, the requested URL &lt;tt&gt;{{repr(request.url)}}&lt;/tt&gt;</span>
<span class="s2">               caused an error:&lt;/p&gt;</span>
<span class="s2">            &lt;pre&gt;{{e.body}}&lt;/pre&gt;</span>
<span class="s2">            </span><span class="si">%%</span><span class="s2">if DEBUG and e.exception:</span>
<span class="s2">              &lt;h2&gt;Exception:&lt;/h2&gt;</span>
<span class="s2">              </span><span class="si">%%</span><span class="s2">try:</span>
<span class="s2">                </span><span class="si">%%</span><span class="s2">exc = repr(e.exception)</span>
<span class="s2">              </span><span class="si">%%</span><span class="s2">except:</span>
<span class="s2">                </span><span class="si">%%</span><span class="s2">exc = &#39;&lt;unprintable </span><span class="si">%%</span><span class="s2">s object&gt;&#39; </span><span class="si">%%</span><span class="s2"> type(e.exception).__name__</span>
<span class="s2">              </span><span class="si">%%</span><span class="s2">end</span>
<span class="s2">              &lt;pre&gt;{{exc}}&lt;/pre&gt;</span>
<span class="s2">            </span><span class="si">%%</span><span class="s2">end</span>
<span class="s2">            </span><span class="si">%%</span><span class="s2">if DEBUG and e.traceback:</span>
<span class="s2">              &lt;h2&gt;Traceback:&lt;/h2&gt;</span>
<span class="s2">              &lt;pre&gt;{{e.traceback}}&lt;/pre&gt;</span>
<span class="s2">            </span><span class="si">%%</span><span class="s2">end</span>
<span class="s2">        &lt;/body&gt;</span>
<span class="s2">    &lt;/html&gt;</span>
<span class="si">%%</span><span class="s2">except ImportError:</span>
<span class="s2">    &lt;b&gt;ImportError:&lt;/b&gt; Could not generate the error page. Please add bottle to</span>
<span class="s2">    the import path.</span>
<span class="si">%%</span><span class="s2">end</span>
<span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="vm">__name__</span>

<span class="c1">#: A thread-safe instance of :class:`LocalRequest`. If accessed from within a</span>
<span class="c1">#: request callback, this instance always refers to the *current* request</span>
<span class="c1">#: (even on a multi-threaded server).</span>
<span class="n">request</span> <span class="o">=</span> <span class="n">LocalRequest</span><span class="p">()</span>

<span class="c1">#: A thread-safe instance of :class:`LocalResponse`. It is used to change the</span>
<span class="c1">#: HTTP response for the *current* request.</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">LocalResponse</span><span class="p">()</span>

<span class="c1">#: A thread-safe namespace. Not used by Bottle.</span>
<span class="n">local</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">local</span><span class="p">()</span>

<span class="c1"># Initialize app stack (create first empty Bottle app now deferred until needed)</span>
<span class="c1"># BC: 0.6.4 and needed for run()</span>
<span class="n">apps</span> <span class="o">=</span> <span class="n">app</span> <span class="o">=</span> <span class="n">default_app</span> <span class="o">=</span> <span class="n">AppStack</span><span class="p">()</span>

<span class="c1">#: A virtual package that redirects import statements.</span>
<span class="c1">#: Example: ``import bottle.ext.sqlite`` actually imports `bottle_sqlite`.</span>
<span class="n">ext</span> <span class="o">=</span> <span class="n">_ImportRedirect</span><span class="p">(</span><span class="s1">&#39;bottle.ext&#39;</span> <span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span> <span class="k">else</span>
                      <span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot;.ext&quot;</span><span class="p">,</span> <span class="s1">&#39;bottle_</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">module</span>


<span class="k">def</span> <span class="nf">_main</span><span class="p">(</span><span class="n">argv</span><span class="p">):</span>  <span class="c1"># pragma: no coverage</span>
    <span class="n">args</span><span class="p">,</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">_cli_parse</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cli_error</span><span class="p">(</span><span class="n">cli_msg</span><span class="p">):</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">print_help</span><span class="p">()</span>
        <span class="n">_stderr</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Error: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">cli_msg</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
        <span class="n">_stdout</span><span class="p">(</span><span class="s1">&#39;Bottle </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">__version__</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">app</span><span class="p">:</span>
        <span class="n">_cli_error</span><span class="p">(</span><span class="s2">&quot;No application entry point specified.&quot;</span><span class="p">)</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;bottle&#39;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;__main__&#39;</span><span class="p">])</span>

    <span class="n">host</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">bind</span> <span class="ow">or</span> <span class="s1">&#39;localhost&#39;</span><span class="p">),</span> <span class="mi">8080</span>
    <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">host</span> <span class="ow">and</span> <span class="n">host</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">host</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">):</span>
        <span class="n">host</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">host</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">host</span> <span class="o">=</span> <span class="n">host</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;[]&#39;</span><span class="p">)</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">cfile</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">conf</span> <span class="ow">or</span> <span class="p">[]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cfile</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.json&#39;</span><span class="p">):</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cfile</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                    <span class="n">config</span><span class="o">.</span><span class="n">load_dict</span><span class="p">(</span><span class="n">json_loads</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">config</span><span class="o">.</span><span class="n">load_config</span><span class="p">(</span><span class="n">cfile</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">configparser</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">parse_error</span><span class="p">:</span>
            <span class="n">_cli_error</span><span class="p">(</span><span class="n">parse_error</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="n">_cli_error</span><span class="p">(</span><span class="s2">&quot;Unable to read config file </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">cfile</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">UnicodeError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="n">_cli_error</span><span class="p">(</span><span class="s2">&quot;Unable to parse config file </span><span class="si">%r</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cfile</span><span class="p">,</span> <span class="n">error</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">cval</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">param</span> <span class="ow">or</span> <span class="p">[]:</span>
        <span class="k">if</span> <span class="s1">&#39;=&#39;</span> <span class="ow">in</span> <span class="n">cval</span><span class="p">:</span>
            <span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">cval</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">config</span><span class="p">[</span><span class="n">cval</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">run</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">app</span><span class="p">,</span>
        <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span>
        <span class="n">port</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">port</span><span class="p">),</span>
        <span class="n">server</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">server</span><span class="p">,</span>
        <span class="n">reloader</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">reload</span><span class="p">,</span>
        <span class="n">plugins</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">plugin</span><span class="p">,</span>
        <span class="n">debug</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
        <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>  <span class="c1"># pragma: no coverage</span>
    <span class="n">_main</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Samuel Helms.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>