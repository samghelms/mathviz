[{"file": "1601.04115.tex", "nexttext": "\nwhere $f_{n,i}$ is the $i$-th element of $\\bm{f}_n$, and $f_{\\mathrm{th}}$ is the threshold for mixture fractions. We further let $\\mathcal{W}_{n} = \\{\\bm{w}_{n,j}\\}_{j=1}^{W_{n}}$, where $\\bm{w}_{n,j}$ is the $j$-th FO in voxel $n$ and $W_{n}$ is the cardinality of $\\mathcal{W}_{n}$. \nFor concreteness, we assume at this stage and for the remainder of the\npaper that the neighborhood consists of the nearest 26 neighbors~\\citep{auria} and $f_{\\mathrm{th}} = 0.1$~\\citep{landman}. \nWe want to estimate the mixture fractions $\\bm{f}_{m}$ (and therefore the\nassociated FOs $\\mathcal{W}_{m}=\\{\\bm{w}_{m,j}\\}_{j=1}^{W_{m}}$ using Eq.~(\\ref{eq:neighborFOs})) at voxel $m$ given the neighborhood information.\n\nOur main goal is to use the patterns of FOs in the neighboring\nvoxels to encourage a similar pattern of FOs in voxel $m$---this is\nthe idea of FO smoothness or coherence. \nA set $\\mathcal{U}_m$ of \\textit{likely FOs} for the voxel $m$ can be computed\ngiven knowledge of the mixture fractions and FOs in its neighbors (the details will be described later).\nThe likely FO information is then used to influence the mixture fraction\nestimation in voxel $m$ using the sparse estimation framework\npreviously described (for the incorporation of prior knowledge in FO\nestimation) in the FIEBR algorithm~\\citep{CMIG}. In particular, we solve \nthe following weighted $\\ell_{1}$-norm regularized least\nsquares problem\n\\begin{eqnarray}\n\\hat{\\bm{f}}_{m} = {\\operatorname{arg\\,min}}\\limits_{\\bm{f}_{m}\\geq\n  \\bm{0}}||\\textbf{G}\\bm{f}_{m}-\\bm{y}_{m}||_{2}^{2} + \\beta\n||\\textbf{C}_{m}\\bm{f}_{m}||_{1}\\,,\n\\label{equ:obj2_single}\n\\end{eqnarray}\nwhere $\\textbf{C}_{m}$ is a diagonal matrix that weights the basis\ndirections according to their distance to the likely FOs in\n$\\mathcal{U}_m$. For example, the basis directions $\\bm{v}_{i}$ that\nare closer to the likely FOs in $\\mathcal{U}_m$ have smaller weights\nin the weighted $\\ell_{1}$-norm; therefore, they have smaller penalty in\nthe objective function and are more likely to be selected as FOs in\n$m$. \n\n\\citet{CMIG} specified the diagonal entries of $\\textbf{C}_{m}$\nas \n\\begin{eqnarray}\nC_{m,i} = 1 - \\alpha\\max\\limits_{p=1,\\ldots,U_m} |\\bm{v}_{i}\\cdot \\bm{u}_{m,p}|,\n\\quad i=1,\\ldots, N \\,, \n\\label{equ:C_BAMBI}\n\\end{eqnarray}\nwhere $\\bm{u}_{m,p} \\in \\mathcal{U}_m$, $U_m$ is the cardinality of\n$\\mathcal{U}_m$, and $\\alpha\\in[0,1)$ is a constant. Since $\\bm{v}_{i}$ and\n$\\bm{u}_{m,p}$ are unit vectors, $|\\bm{v}_{i}\\cdot\n\\bm{u}_{m,p}|\\in[0,1]$ and $C_{m,i}$ is positive for all $i$.  \nIn this work, we find it useful to normalize these diagonal entries so\nthat the weights on the most likely FOs are nearly the same as when\nthere is no neighboring FO information used at all. Accordingly, here\nwe specify the diagonal weights in $\\textbf{C}_m$ as \n\n", "itemtype": "equation", "pos": 17421, "prevtext": "\n\\begin{frontmatter}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\\title{Estimation of Fiber Orientations Using Neighborhood Information}\n\n\n\n\n\n\n\\author[label1]{Chuyang Ye\\corref{cor1}}\n\\author[label2]{Jiachen Zhuo}\n\\author[label2]{Rao P. Gullapalli}\n\\author[label3]{Jerry L. Prince}\n\n\\address[label1]{Brainnetome Center, Institute of Automation, Chinese Academy of Sciences, Beijing, China}\n\\address[label2]{Department of Radiology, University of Maryland School of Medicine,\\\\Baltimore, MD, USA}\n\\address[label3]{Department of Electrical and Computer Engineering,\\\\Johns Hopkins University, Baltimore, MD, USA}\n\n\n\\cortext[cor1]{Address: Intelligence Building 504, 95 Zhongguancun East Road, \nBeijing, China, 100190. \n\n\\\\ \\indent Email address: \\texttt{chuyang.ye@nlpr.ia.ac.cn}}\n\n\\begin{abstract}\nData from \\textit{diffusion magnetic resonance imaging} (dMRI) can\nbe used to reconstruct fiber tracts, for example, in muscle and white\nmatter. Estimation of \\textit{fiber orientations} (FOs)\nis a crucial step in the reconstruction process and these estimates can be corrupted by noise.\nIn this paper, a new method called \\textit{Fiber Orientation Reconstruction using Neighborhood Information} (FORNI)\nis described and shown to reduce the effects of noise and improve FO estimation performance\nby incorporating spatial consistency. \nFORNI uses a fixed tensor basis to model the diffusion weighted signals,\nwhich has the advantage of providing an explicit relationship between the basis\nvectors and the FOs.  FO spatial coherence is encouraged using weighted\n$\\ell_{1}$-norm regularization terms, which contain the interaction\nof directional information between neighbor voxels.  Data fidelity\nis encouraged using a squared error between the observed and reconstructed\ndiffusion weighted signals.  After appropriate weighting of these\ncompeting objectives, the resulting objective function is\nminimized using a block coordinate descent algorithm, and a\nstraightforward parallelization strategy is used to speed up\nprocessing.  Experiments were performed on a digital crossing\nphantom, \\textit{ex vivo} tongue dMRI data, and \\textit{in vivo}\nbrain dMRI data for both qualitative and quantitative evaluation. The\nresults demonstrate that FORNI improves the quality of\nFO estimation over other state of the art algorithms. \n\n\\end{abstract}\n\n\\begin{keyword}\nDiffusion MRI \\sep fiber orientation estimation \\sep neighborhood information\n\n\n\n\n\n\\end{keyword}\n\n\\end{frontmatter}\n\n\n\n\n\n\n\n\\section{Introduction}\n\\label{sec:intro}\n\nBy capturing both the magnitude and the anisotropy of water\ndiffusion, \\textit{diffusion magnetic resonance imaging} (dMRI) provides a noninvasive\nmeans to reconstruct fiber tracts, for example, in white matter and\nmuscle~\\citep{johansen}. \\textit{Diffusion tensor imaging} (DTI), \nwhich is a basic dMRI strategy, models the water diffusion using a\nsymmetric positive definite tensor~\\citep{basser}. Since DTI is known\nto be insufficient to represent crossing fiber tracts, more advanced\ndMRI techniques, such as \\textit{high angular resolution diffusion imaging}\n(HARDI)~\\citep{HARDI} and \\textit{diffusion spectrum imaging}\n(DSI)~\\citep{DSI}, have been developed. \n\nIn order to carry out tractography~\\citep{mori,basser2,qazi,reisert}\nand volumetric fiber tract segmentation~\\citep{bazin,nazem,yendiki,NEIN}, \\textit{fiber\norientations} (FOs) are computed from the dMRI data. In tractography, fiber streamlines are propagated according to the computed FOs or the distribution of FOs, and in volumetric tract segmentation the FO is a key feature upon which the voxels are labeled. Since accurate estimation\nof FOs is critical in these algorithms, it has been a major\ntopic of research. For example, spherical\ndeconvolution~\\citep{tournier,tournier2,cheng2,jeurissen}, $q$-ball\nreconstruction~\\citep{qball,hess,qbi}, multi-tensor\nmodels~\\citep{landman,peled,behrens,ramirez,zhou,liu,BAMBI}, and ensemble average propagator methods~\\citep{michailovich,rathi,wedeen2008,pickalov,ozarslan,merlet2013} have been developed so that multiple FOs can be estimated in each voxel.\n\nA large number of diffusion gradient directions may be required to accurately estimate FOs when fiber tracts cross, which takes a long acquisition time and\nlimits the use of dMRI in clinical practice~\\citep{bilgic}. Therefore,\nmethods have been developed to reduce the required number of gradient\ndirections so that the dMRI acquisition is clinically achievable.\nBecause the number of crossing FOs in a voxel is small, modeling the\ndiffusion data as having arisen from a sparse subset of basis sources\nand solving the resulting optimization problem using sparsity\nregularization is particularly effective~\\citep{ramirez, landman, \ndaducci, merlet, zhou, michailovich, rathi}. The basis has been\nselected to be prolate diffusion\ntensors~\\citep{ramirez, landman, daducci, zhou}, spherical\nridgelets~\\citep{michailovich, rathi}, and spherical polar Fourier\nbasis~\\citep{merlet}.\n\n\\begin{figure}[t]\n  \\centering\n\t\\subfigure[CFARI]{\n\t\t\\includegraphics[width=0.25\\columnwidth]{toy_cfari.png}\n\t\t\\label{fig:toy_cfari}\n\t}\n  \\subfigure[FORNI]{\n\t\t\\includegraphics[width=0.25\\columnwidth]{toy_foruni.png}\n\t\t\\label{fig:toy_foruni}\n\t}\n\\caption{A 3D toy example of FO estimation on two simulated crossing\n  tracts in the axial view (the $x$-$y$ plane): (a) voxelwise FO estimation using the CFARI\n  algorithm~\\citep{landman} and (b) FOs estimated by the proposed\n  method (FORNI) incorporating spatial coherence of FOs.} \n\\label{fig:toy}\n\\end{figure}\n\nNoise can have a deleterious effect on FO estimation, especially in areas where\nfibers cross~\\citep{cheng,aranda}.\nA 3D toy example of two crossing tracts is shown in the axial view (the $x$-$y$ plane) in Figure~\\ref{fig:toy_cfari}, where noise is added to the simulated dMRI data. Here, the CFARI\nalgorithm~\\citep{landman} estimates FOs at each voxel independently;\nit yields noisy estimates and occasionally fails to yield a second\ndirection at all (Figure~\\ref{fig:toy_cfari}). \n\nTo reduce the effect of noise, spatial coherence (or smoothness) has been used to improve FO estimation. \nIn~\\citet{becker} diffusion weighted images are smoothed\nbefore FO estimation.  In~\\citet{sigurdsson}, FOs are smoothed after\nvoxelwise estimation using the CFARI method. \nIn~\\citet{duits}, FOs are smoothed using left-invariant diffusions on the space of positions and orientations.\n\\citet{tournier2013} and~\\citet{reisert2011} incorporate the continuity of FOs as regularization terms in the estimation to enforce FO smoothness, but sparsity regularization is not used.\nThere are also methods that seek to simultaneously estimate and smooth FOs by\ncombining spatial continuity with sparsity.\nIn~\\citet{michailovich} and \\citet{rathi}, the TV-norm of diffusion\nweighted images is incorporated as a smoothness regularization term in\nthe objective function.  In~\\citet{ramirez} and \\citet{zhou}, spatial\nconsistency of FOs is encouraged by adding regularization terms that smooth the mixture fractions of each basis tensor. However, spatial coherence is preserved in an indirect way in \\citet{michailovich},\n\\citet{rathi}, \\citet{ramirez}, and~\\citet{zhou} because the\nobjective functions do not explicitly model and smooth the directional information\nin the FOs. Recently, \\citet{auria} define a spatially structured sparsity regularization term to incorporate directional information in the sparse reconstruction of FOs.\n\nIn this paper, we present the method \\textit{Fiber Orientation Reconstruction\nusing Neighborhood Information} (FORNI), which is an FO estimation\nalgorithm that incorporates spatial coherence. \nPreliminary results of this work were presented in a conference paper~\\citep{CDMRI}.\nAn example of the FORNI FO estimation on the toy example in Figure~\\ref{fig:toy_cfari} is shown in Figure~\\ref{fig:toy_foruni}.\nIn contrast to most previous works, we form an objective function that directly encodes the directional information in the neighborhood to encourage spatial coherence of FOs.\nSpecifically, a fixed tensor basis is used to represent diffusion weighted signals, which has the advantage of providing an explicit relationship between the basis and FOs.\nSpatial coherence is encouraged using weighted $\\ell_{1}$-norm regularization, where the\ninteraction of directional information in neighboring voxels is\nmodeled. In the weighted $\\ell_{1}$-norm regularization terms, basis\ndirections that are more consistent with the FOs in the neighborhood\nare encouraged.  Data fidelity is encouraged using a term that measures agreement between the observed and reconstructed diffusion signals. The resulting objective\nfunction is minimized using a block coordinate descent algorithm, and\na straightforward parallelization strategy is used to speed up processing.\n\nThe remainder of the paper is organized as\nfollows. Section~\\ref{sec:methods} describes the FORNI algorithm and Section~\\ref{sec:exp} presents the experiments on a\ndigital crossing phantom, \\textit{ex vivo} tongue dMRI data, and\n\\textit{in vivo} brain dMRI data for qualitative and quantitative\nevaluation. Section~\\ref{sec:discussion} discusses the results and\nfuture works. Finally, Section~\\ref{sec:conclusion} concludes the\npaper.\n\n\\section{Methods}\n\\label{sec:methods}\n\nIn this section, we first provide a background on diffusion signal\nmodeling using a fixed tensor basis. Then, we describe our approach to\nthe incorporation of directional information from neighboring voxels to\nimprove FO estimation. Finally, the resulting objective function and the\noptimization strategy are presented. \n\n\\subsection{A Multi-tensor Model with a Fixed Tensor Basis}\n\nUsing the unified framework presented in~\\citet{jian}, the diffusion\nweighted signal at each voxel can be modeled as  \n\\begin{eqnarray}\nS({\\bm{q}}) = S_0\\int\\limits_{\\mathcal{M}}{f(x)R(\\bm{q},x)}\\mathrm{d}x,\n\\label{eqn:dwi_unified}\n\\end{eqnarray}\nwhere $x$ is a point on a smooth manifold $\\mathcal{M}$, $S(\\bm{q})$\nis the diffusion weighted signal with the diffusion gradient $\\bm{q}$,\n$S_{0}$ is the baseline signal without diffusion weighting, $f(x)$ is\na probability density function, and $R(\\bm{q},x)$ is a kernel\nfunction. \n\nThe diffusion signals can be represented by a basis, and one commonly\nused basis is a set of fixed prolate tensors~\\citep{landman, zhou, ramirez, daducci}.  The \\textit{primary eigenvector}~(PEV) of each basis tensor represents a possible FO and is referred to as a basis direction. In this work, we use the tensor\nbasis comprising $N=289$ prolate tensors $\\textbf{D}_{i}$ whose PEVs\n$\\bm{v}_{i}$ are approximately evenly oriented over the unit sphere.\nThese basis directions were determined by tessellating an octahedron, and the number of basis directions ($N=289$) lies in the range of previously used numbers~\\citep{ramirez,landman,auria}.\nThe shape of the basis tensor is determined by its eigenvalues ($\\lambda_{1}\\geq \\lambda_{2} \\geq \\lambda_{3} > 0$). The second and third eigenvalues are set equal, and each eigenvalue is determined by\nexamining the diffusion tensors of a noncrossing fiber\ntract~\\citep{landman}.\n\nWith this tensor basis, we have $\\mathcal{M}=\\mathcal{S}^2$ (a unit\nsphere), $x=\\bm{v}$ (a unit vector),\n$f(\\bm{v})=f_{i}\\delta(\\bm{v};\\bm{v}_{i})$, and\n$R(\\bm{q},\\bm{v}_{i})=e^{-\\bm{q}^{T}\\textbf{D}_{i}\\bm{q}}$ (based on\nthe Stejskal-Tanner tensor formulation~\\citep{stejskal}). By\nnormalizing the diffusion gradient as\n$\\tilde{\\bm{q}}=\\bm{q}/|\\bm{q}|$, the gradient direction\n$\\tilde{\\bm{q}}$ is associated with a constant $b$ determined by the\nimaging sequence. Taking image noise into account,\nEq.~(\\ref{eqn:dwi_unified}) then becomes~\\citep{landman} \n\\begin{eqnarray}\nS(\\bm{q}) =\nS_0\\sum\\limits_{i=1}^{N}f_{i}e^{-b\\tilde{\\bm{q}}^{T}\\textbf{D}_{i}\\tilde{\\bm{q}}}\n+ n(\\bm{q}),  \n\\label{eqn:dwi}\n\\end{eqnarray}\nwhere $f_{i}$ is the (unknown) nonnegative mixture fraction for\n$\\textbf{D}_{i}$, $\\sum_{i=1}^{N} f_{i} = 1$, and $n(\\bm{q})$ is\nnoise. \n\nAfter defining $y(\\bm{q}) = S(\\bm{q})/S_{0}$ and $\\eta(\\bm{q}) =\nn(\\bm{q})/S_{0}$ and letting $K$ be the number of diffusion\ngradient measurements, Eq.~(\\ref{eqn:dwi}) can be written as \n\\begin{eqnarray}\n\\bm{y} = \\textbf{G}\\bm{f} + \\bm{\\eta},\n\\label{equ:linear}\n\\end{eqnarray}\nwhere $\\bm{y}=(y({\\bm{q}_1}),y({\\bm{q}_2}),...,y({\\bm{q}_K}))^{T}$,\n$\\textbf{G}$ is a $K\\times \nN$ matrix comprising the attenuation terms\n$G_{ki}=e^{-b_{k}\\tilde{\\bm{q}}_{k}^{T}\\textbf{D}_{i}\\tilde{\\bm{q}}_{k}}$,\n$\\bm{f}=(f_{1},f_{2},...,f_{N})^{T}$, and\n$\\bm{\\eta}=(\\eta({\\bm{q}_1}),\\eta({\\bm{q}_2}),...,\\eta({\\bm{q}_K}))^{T}$. \nBecause the number of FOs at each voxel is usually small with respect\nto the number of diffusion gradients, the mixture fractions can be\nestimated using the following sparse reconstruction formulation \n\\begin{eqnarray}\n\\hat{\\bm{f}} = {\\operatorname{arg\\,min}}\\limits_{\\bm{f}\\geq \\bm{0},\n  ||\\bm{f}||_{1}=1}||\\textbf{G}\\bm{f}-\\bm{y}||_{2}^{2} + \\beta\n||\\bm{f}||_{0}. \n\\label{equ:sr}\n\\end{eqnarray}\n\nTo solve Eq.~(\\ref{equ:sr}), the constraint of $\\sum_{i=1}^{N}\nf_{i}=1$ is relaxed~\\citep{landman,ramirez} and then the \n$\\ell_{0}$-norm is replaced by the $\\ell_{1}$-norm, yielding the\nfollowing simpler problem, \n\\begin{eqnarray}\n\\hat{\\bm{f}} = {\\operatorname{arg\\,min}}\\limits_{\\bm{f}\\geq\n  \\bm{0}}||\\textbf{G}\\bm{f}-\\bm{y}||_{2}^{2} + \\beta ||\\bm{f}||_{1}\\,.  \n\\label{equ:obj}\n\\end{eqnarray} \nAfter solving this, the estimated vector $\\hat{\\bm{f}}$ is normalized\nso that its elements add to one. \nNote that in this paper we interpret small mixture fractions as components of\nisotropic diffusion; therefore, FOs are given by those basis\ndirections whose mixture fractions are greater than a threshold $f_{\\mathrm{th}}$.  \nAccordingly, by focusing on the estimation of mixture fractions, we\nare also estimating the FOs. \n\n\\subsection{FO Estimation Using Neighborhood Information}\n\n\\begin{figure}[t]\n\\centering\n   \\includegraphics[width=0.9\\linewidth]{graphical_eg_v2.png}\n\\caption[]{A graphical example showing the potential difficulties when\n  the smoothness of mixture fractions is used to represent spatial\n  coherence of FOs.} \n\\label{fig:graphical_eg}\n\\end{figure}\n\nIncorporation of spatial coherence in the estimation of FOs can reduce\nthe effects of noise~\\citep{michailovich}.  Some researchers have\nincorporated neighborhood information in order to maintain smoothness\nof mixture fractions~\\citep{ramirez,zhou}.  But having smooth mixture\nfractions does not equate to having smooth FO angles. For example,\nsuppose we have three side-by-side voxels $a$, $b$, and $c$, whose mixture\nfractions are $\\bm{f}_{a}=(1,0,...,0)^{T}$,\n$\\bm{f}_{b}=(0,1,0,...,0)^{T}$, and $\\bm{f}_{c}=(0,0,1,0,...,0)^{T}$,\nrespectively. The magnitude of the difference\n$||\\bm{f}_{a}-\\bm{f}_{b}||$ between the mixture fractions of $a$ and\n$b$ is the same as the magnitude of the difference\n$||\\bm{f}_{a}-\\bm{f}_{c}||$ between $a$ and $c$, while the desired\nmeasure of difference should be related to the angles between the\nbasis directions with nonzero mixture fraction entries.\nFigure~\\ref{fig:graphical_eg} gives a graphical example of a\ncurved tract, where simply using the smoothness of mixture fractions\ncould lead to identical FOs along the tract instead of a desired\ngradually-changing FO structure. This limitation exists in the case of\ncrossing fibers as well. In this work, we encourage spatial coherence\nof FOs by explicitly incorporating the directional information in\nneighboring voxels into the FO estimation. \nThe symbols used in FORNI are listed in Table~\\ref{tab:symbols}.\n\n\n\\begin{table}[t]\n\\centering\n\\caption{Symbols used in FORNI} \n\\resizebox{0.65\\columnwidth}{!}{\n\\begin{tabular}{l l}\n\\hline\n\\hline\nSymbol & Definition\\\\\n\\hline\n$\\bm{v}_{i}$ & Basis direction\\\\\n$i,q$ & Index for basis directions\\\\\n$N$ & Number of basis directions\\\\\n$\\mathbf{G}$ & Dictionary matrix containing attenuation terms\\\\\n$m,n,m_{0},m_{1}$ & Index for voxels \\\\\n$M$ & Number of voxels\\\\\n$w_{m,n}$ & Voxel similarity between $m$ and $n$\\\\\n$\\mathcal{N}_{m}$ & Neighborhood of $m$\\\\\n$\\mathbf{D}_{m}$ & Diffusion tensor at $m$ \\\\\n$\\bm{y}_{m}$ & Diffusion signal at $m$\\\\\n$\\bm{f}_{m}$ & Mixture fraction at $m$\\\\\n$\\hat{\\bm{f}}_{m}$ & Estimated mixture fraction at $m$\\\\\n$\\tilde{\\bm{f}}_{m}$ & Normalized mixture fraction estimate at $m$\\\\\n${f}_{m,i}$ & Entry of $\\bm{f}_{m}$\\\\\n${f}_{\\mathrm{th}}$ & Mixture fraction threshold\\\\\n$\\bm{w}_{m,j}$ & FO at $m$\\\\\n$j$ & Index for FOs\\\\\n$\\mathcal{W}_{m}$ & The set of all FOs at $m$\\\\\n$\\bm{u}_{m,p}$ & Likely FO at $m$\\\\\n$p$ & Index for likely FOs\\\\\n$\\mathcal{U}_{m}$ & The set of all likely FOs at $m$\\\\\n$\\mathbf{C}_{m}$ & Weighting matrix at $m$\\\\\n$C_{m,i}$ & Diagonal entry of $\\mathbf{C}_{m}$\\\\\n$\\alpha,\\beta,\\mu$ & Parameters in FORNI\\\\\n$r_{m,n}(i)$ & Basis-neighbor similarity\\\\\n$R_{m}(i)$ & Aggregate basis-neighbor similarity\\\\\n$\\theta_{R}$ & An angle threshold\\\\\n$t$ & Index for iterations\\\\\n$N_{\\mathrm{p}}$ & Number of voxels processed in parallel\\\\\n\\hline\n\\hline\n\\end{tabular}\n}\n\\label{tab:symbols}\n\\end{table}\n\n\\subsubsection{FO Estimation with Known Neighborhood Information}\n\\label{sec:FORNI}\n\nFirst, we consider a simplified case where the mixture fractions\n$\\bm{f}_m$  are to be estimated in the voxel $m$ and the mixture\nfractions are known at all voxels in a neighborhood $\\mathcal{N}_m$ of\nvoxel $m$. Let $n$ be a \nvoxel in $\\mathcal{N}_{m}$ and let voxel $n$ have mixture\nfractions $\\bm{f}_{n}$; then the FOs at voxel $n$ are given by the set \n\n", "index": 1, "text": "\\begin{equation}\n\\mathcal{W}_n = \\{ \\bm{v}_i \\, | f_{n,i}\n> f_{\\mathrm{th}}, i=1,\\ldots,N \\} \\, , \n\\label{eq:neighborFOs}\n\\end{equation}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E1.m1\" class=\"ltx_Math\" alttext=\"\\mathcal{W}_{n}=\\{\\bm{v}_{i}\\,|f_{n,i}&gt;f_{\\mathrm{th}},i=1,\\ldots,N\\}\\,,\" display=\"block\"><mrow><mrow><msub><mi class=\"ltx_font_mathcaligraphic\">\ud835\udcb2</mi><mi>n</mi></msub><mo>=</mo><mrow><mo stretchy=\"false\">{</mo><mpadded width=\"+1.7pt\"><msub><mi>\ud835\udc97</mi><mi>i</mi></msub></mpadded><mo stretchy=\"false\">|</mo><mrow><mrow><msub><mi>f</mi><mrow><mi>n</mi><mo>,</mo><mi>i</mi></mrow></msub><mo>&gt;</mo><msub><mi>f</mi><mi>th</mi></msub></mrow><mo>,</mo><mrow><mi>i</mi><mo>=</mo><mrow><mn>1</mn><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><mi>N</mi></mrow></mrow></mrow><mo rspace=\"4.2pt\" stretchy=\"false\">}</mo></mrow></mrow><mo>,</mo></mrow></math>", "type": "latex"}, {"file": "1601.04115.tex", "nexttext": "\nWe see that the weights in Eq.~(\\ref{eq:diagonalweights}) are just the\nweights in Eq.~(\\ref{equ:C_BAMBI}) normalized by the smallest\ndiagonal entry. Note that we require $\\alpha\\in[0,1)$ in order\nto ensure that $C_{m,i}>0$, $\\forall i$.   \n\n\\citet{CMIG} developed the above framework to incorporate \nfixed prior directions at each voxel in the estimation of FOs. These prior\ndirections were either hand-drawn or determined by atlas registration.\nTo apply this framework to spatial smoothness, we replace the concept\nof prior directions with that of likely FOs. Note that our application\nof FO estimation with spatial coherence is fundamentally different\nthan~\\cite{CMIG} in two respects: 1)~likely FOs are computed based on\nneighbors and no manual intervention or anatomical atlas registration\nis needed; 2)~because computations of FOs depend on neighbors, the FOs for all voxels need to be simultaneously estimated and the independent FO computation at each voxel in Eq.~(\\ref{equ:obj2_single}) is inappropriate. The proposed approach to the computation of likely FOs and simultaneous FO estimation is presented next in Sections~\\ref{sec:likely_FO} and \\ref{sec:FO_est}, respectively. \n\n\\subsubsection{Computation of Likely FOs from Neighbors}\n\\label{sec:likely_FO}\n\nA flow chart of the likely FO computation at each voxel is shown in Figure~\\ref{fig:flow}.\nWe first consider a single neighbor\nvoxel; in particular, let voxel $n$ be the neighbor of voxel\n$m$. Let $\\textbf{D}_{m}$ and $\\textbf{D}_{n}$ be the diffusion\ntensors fit from diffusion weighted signals at voxels $m$ and $n$,\nrespectively. Based on the tensors, we define the \\textit{voxel similarity} $w_{m,n}$ \nbetween voxels $m$ and $n$ as\n\\begin{eqnarray}\nw_{m,n} = e^{-\\mu d^2(\\textbf{D}_{m},\\textbf{D}_{n})},\n\\end{eqnarray}\nwhere $\\mu$ is a constant and $d(\\cdot,\\cdot)$ is the measure of distance between tensors given\nby~\\citet{arsigny} \n\\begin{eqnarray}\nd(\\textbf{D}_{m},\\textbf{D}_{n}) =\n\\sqrt{\\mathrm{Trace}(\\{\\log(\\textbf{D}_{m})-\\log(\\textbf{D}_{n})\\}^{2})}. \n\\end{eqnarray}\n\n\n\\begin{figure}[t]\n\\centering\n   \\includegraphics[width=0.98\\linewidth]{flowchart.png}\n\\caption[]{A flow chart of the likely FO computation at a voxel.} \n\\label{fig:flow}\n\\end{figure}\n\n\nGiven the definition of voxel similarity, we now want a measure of\nthe similarity of each basis direction $\\bm{v}_{i}$ to the FOs $\\mathcal{W}_n=\\{\\bm{w}_{n,j}\\}_{j=1}^{W_{n}}$ in voxel $n$. \nAccordingly, we define the \\textit{basis-neighbor similarity} $r_{m,n}(i)$ as \n\\begin{eqnarray}\nr_{m,n}(i) = w_{m,n}\\max\\limits_{j=1,\\ldots,W_n} |\\bm{v}_{i}\\cdot \\bm{w}_{n,j}|, \n\\quad i=1,\\ldots,N \\,.\n\\label{equ:bn_sim}\n\\end{eqnarray}\nIn order for a given basis vector to be similar to a\nneighbor's computed FO, the voxels must be similar and the directions\nmust be well-aligned.\n\nNow consider all voxels that are neighbors of voxel $m$. We define an \n\\textit{aggregate basis-neighbor similarity} $R_m(i)$ at voxel $m$ for each\nbasis vector $\\bm{v}_{i}$ as   \n\n", "itemtype": "equation", "pos": 20352, "prevtext": "\nwhere $f_{n,i}$ is the $i$-th element of $\\bm{f}_n$, and $f_{\\mathrm{th}}$ is the threshold for mixture fractions. We further let $\\mathcal{W}_{n} = \\{\\bm{w}_{n,j}\\}_{j=1}^{W_{n}}$, where $\\bm{w}_{n,j}$ is the $j$-th FO in voxel $n$ and $W_{n}$ is the cardinality of $\\mathcal{W}_{n}$. \nFor concreteness, we assume at this stage and for the remainder of the\npaper that the neighborhood consists of the nearest 26 neighbors~\\citep{auria} and $f_{\\mathrm{th}} = 0.1$~\\citep{landman}. \nWe want to estimate the mixture fractions $\\bm{f}_{m}$ (and therefore the\nassociated FOs $\\mathcal{W}_{m}=\\{\\bm{w}_{m,j}\\}_{j=1}^{W_{m}}$ using Eq.~(\\ref{eq:neighborFOs})) at voxel $m$ given the neighborhood information.\n\nOur main goal is to use the patterns of FOs in the neighboring\nvoxels to encourage a similar pattern of FOs in voxel $m$---this is\nthe idea of FO smoothness or coherence. \nA set $\\mathcal{U}_m$ of \\textit{likely FOs} for the voxel $m$ can be computed\ngiven knowledge of the mixture fractions and FOs in its neighbors (the details will be described later).\nThe likely FO information is then used to influence the mixture fraction\nestimation in voxel $m$ using the sparse estimation framework\npreviously described (for the incorporation of prior knowledge in FO\nestimation) in the FIEBR algorithm~\\citep{CMIG}. In particular, we solve \nthe following weighted $\\ell_{1}$-norm regularized least\nsquares problem\n\\begin{eqnarray}\n\\hat{\\bm{f}}_{m} = {\\operatorname{arg\\,min}}\\limits_{\\bm{f}_{m}\\geq\n  \\bm{0}}||\\textbf{G}\\bm{f}_{m}-\\bm{y}_{m}||_{2}^{2} + \\beta\n||\\textbf{C}_{m}\\bm{f}_{m}||_{1}\\,,\n\\label{equ:obj2_single}\n\\end{eqnarray}\nwhere $\\textbf{C}_{m}$ is a diagonal matrix that weights the basis\ndirections according to their distance to the likely FOs in\n$\\mathcal{U}_m$. For example, the basis directions $\\bm{v}_{i}$ that\nare closer to the likely FOs in $\\mathcal{U}_m$ have smaller weights\nin the weighted $\\ell_{1}$-norm; therefore, they have smaller penalty in\nthe objective function and are more likely to be selected as FOs in\n$m$. \n\n\\citet{CMIG} specified the diagonal entries of $\\textbf{C}_{m}$\nas \n\\begin{eqnarray}\nC_{m,i} = 1 - \\alpha\\max\\limits_{p=1,\\ldots,U_m} |\\bm{v}_{i}\\cdot \\bm{u}_{m,p}|,\n\\quad i=1,\\ldots, N \\,, \n\\label{equ:C_BAMBI}\n\\end{eqnarray}\nwhere $\\bm{u}_{m,p} \\in \\mathcal{U}_m$, $U_m$ is the cardinality of\n$\\mathcal{U}_m$, and $\\alpha\\in[0,1)$ is a constant. Since $\\bm{v}_{i}$ and\n$\\bm{u}_{m,p}$ are unit vectors, $|\\bm{v}_{i}\\cdot\n\\bm{u}_{m,p}|\\in[0,1]$ and $C_{m,i}$ is positive for all $i$.  \nIn this work, we find it useful to normalize these diagonal entries so\nthat the weights on the most likely FOs are nearly the same as when\nthere is no neighboring FO information used at all. Accordingly, here\nwe specify the diagonal weights in $\\textbf{C}_m$ as \n\n", "index": 3, "text": "\\begin{equation}\nC_{m,i} = \\frac{1 - \\alpha\\max\\limits_{p=1,\\ldots,U_m} |\\bm{v}_{i}\\cdot\n  \\bm{u}_{m,p}|}{\\min\\limits_{q=1,\\ldots,N}\\left(1 -\n    \\alpha\\max\\limits_{p=1,\\ldots,U_m}|\\bm{v}_{q}\\cdot \\bm{u}_{m,p}|\\right)}, \n\\quad i=1,\\ldots, N \\,.  \n\\label{eq:diagonalweights}\n\\end{equation}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E2.m1\" class=\"ltx_Math\" alttext=\"C_{m,i}=\\frac{1-\\alpha\\max\\limits_{p=1,\\ldots,U_{m}}|\\bm{v}_{i}\\cdot\\bm{u}_{m,%&#10;p}|}{\\min\\limits_{q=1,\\ldots,N}\\left(1-\\alpha\\max\\limits_{p=1,\\ldots,U_{m}}|%&#10;\\bm{v}_{q}\\cdot\\bm{u}_{m,p}|\\right)},\\quad i=1,\\ldots,N\\,.\" display=\"block\"><mrow><mrow><mrow><msub><mi>C</mi><mrow><mi>m</mi><mo>,</mo><mi>i</mi></mrow></msub><mo>=</mo><mfrac><mrow><mn>1</mn><mo>-</mo><mrow><mi>\u03b1</mi><mo>\u2062</mo><mrow><munder><mi>max</mi><mrow><mi>p</mi><mo>=</mo><mrow><mn>1</mn><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msub><mi>U</mi><mi>m</mi></msub></mrow></mrow></munder><mo>\u2061</mo><mrow><mo stretchy=\"false\">|</mo><mrow><msub><mi>\ud835\udc97</mi><mi>i</mi></msub><mo>\u22c5</mo><msub><mi>\ud835\udc96</mi><mrow><mi>m</mi><mo>,</mo><mi>p</mi></mrow></msub></mrow><mo stretchy=\"false\">|</mo></mrow></mrow></mrow></mrow><mrow><munder><mi>min</mi><mrow><mi>q</mi><mo>=</mo><mrow><mn>1</mn><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><mi>N</mi></mrow></mrow></munder><mo>\u2061</mo><mrow><mo>(</mo><mrow><mn>1</mn><mo>-</mo><mrow><mi>\u03b1</mi><mo>\u2062</mo><mrow><munder><mi>max</mi><mrow><mi>p</mi><mo>=</mo><mrow><mn>1</mn><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msub><mi>U</mi><mi>m</mi></msub></mrow></mrow></munder><mo>\u2061</mo><mrow><mo stretchy=\"false\">|</mo><mrow><msub><mi>\ud835\udc97</mi><mi>q</mi></msub><mo>\u22c5</mo><msub><mi>\ud835\udc96</mi><mrow><mi>m</mi><mo>,</mo><mi>p</mi></mrow></msub></mrow><mo stretchy=\"false\">|</mo></mrow></mrow></mrow></mrow><mo>)</mo></mrow></mrow></mfrac></mrow><mo rspace=\"12.5pt\">,</mo><mrow><mi>i</mi><mo>=</mo><mrow><mn>1</mn><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><mpadded width=\"+1.7pt\"><mi>N</mi></mpadded></mrow></mrow></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.04115.tex", "nexttext": "\nBasis directions with larger aggregate basis-neighbor similarity\ncorrespond to directions that are close to FOs in many neighboring\nvoxels or in a few neighbors that have strong voxel\nsimilarity. These are directions that are more likely to be FOs in\nvoxel $m$ by virtue of the current FOs in neighboring voxels.  \n\nGiven $R_{m}$ we can extract a set of likely FOs for voxel $m$. \nWe could simply choose the directions with the largest $R_{m}$\nvalues or those with $R_{m}$ values greater than a threshold. \nHowever, a special circumstance should be noted. In a crossing region,\nsuch as that depicted in Figure~\\ref{fig:sim_illua},\nsome of the neighboring voxels could fail to estimate a crossing FO due to\nnoise. In particular, suppose there are two crossing FOs $\\tilde{\\bm{v}}_{1}$ and \n$\\tilde{\\bm{v}}_{2}$ in this region, and $\\tilde{\\bm{v}}_{1}$ fails to be\nreconstructed in more than one neighboring voxel while the other\nneighbors have both FOs reconstructed. \nIn this case, as is shown in Figure~\\ref{fig:sim_illub}, the basis vector $\\bm{v}_{i}$ corresponding to\n$\\tilde{\\bm{v}}_{1}$ \ncould have a smaller $R_{m}(i)$ value than a basis direction\n$\\tilde{\\bm{v}}_{3}$, for example, which is distant from both\n$\\tilde{\\bm{v}}_{1}$ and $\\tilde{\\bm{v}}_{2}$. In this case, the desired $\\tilde{\\bm{v}}_{1}$ is not included in the top two likely FOs and thus $\\tilde{\\bm{v}}_{1}$ may not be properly encouraged, while an undesired $\\tilde{\\bm{v}}_{3}$ may be encouraged and create false FOs.\n\n\\begin{figure}[t]\n  \\centering\n\t\\subfigure[FO Structure]{\n\t\t\\includegraphics[width=0.22\\columnwidth]{sim_illu_v2a.png}\n\t\t\\label{fig:sim_illua}\n\t}\n  \\subfigure[$R_{m}(i)$ Profile]{\n\t\t\\includegraphics[width=0.35\\columnwidth]{sim_illu_v2b.png}\n\t\t\\label{fig:sim_illub}\n\t}\n\\caption{An illustration of the $R_{m}(i)$ profile in the case where\n  one of the crossing FOs fails to be reconstructed in some neighboring\n  voxels.} \n\\label{fig:sim_illu}\n\\end{figure}\n\nA more robust definition of the likely FOs is as those directions\nwhich comprise the local maxima of $R_m$.  In particular, consider\nthe direction $\\bm{v}_i$ and compare its value $R_m(i)$ to\nall values of $R_m(i')$ corresponding to directions $\\bm{v}_{i'}$ within $\\theta_{R} =\n20^{\\circ}$. If $R_m(i)$ is maximum, then $\\bm{v}_i$ is included in\nthe likely FOs. Following this reasoning, the likely FOs at voxel $m$ are given by  \n\\begin{eqnarray}\n\\mathcal{U}_m =\\{\\bm{v}_{i}| \\forall\\:i' \\neq i \\mbox{ s.t. }\nR_{m}(i)\\geq R_{m}(i') \n\\mbox{ and } \\arccos(|\\bm{v}_{i}\\cdot\\bm{v}_{i'}|)\\leq\n\\frac{\\pi}{180^\\circ}\\theta_{R}\\}. \n\\label{equ:likely_FOs} \n\\end{eqnarray}\nNote that $\\theta_{R}$ is converted to have a unit of radians so that it can be compared with $\\arccos(|\\bm{v}_{i}\\cdot\\bm{v}_{i'}|)$.\n\nAn example of the $R_{m}$ values of a voxel in the crossing region in Figure~\\ref{fig:toy} is shown in Figure~\\ref{fig:Rm}, where the $R_{m}$ values are plotted on the unit sphere according to their associated basis directions. The $R_{m}$ values of the likely FOs are indicated by the larger dots and black arrows. The two likely FOs are the horizontal ($x$) and vertical~($y$) directions in Figure~\\ref{fig:toy} that correspond to the desired FOs.\n\n\\begin{figure}[t]\n\\centering\n   \\includegraphics[width=0.65\\linewidth]{Rm.png}\n\\caption[]{An example of the $R_{m}$ values of a voxel in the crossing region in Figure~\\ref{fig:toy}. Each $R_{m}(i)$ is plotted on the unit sphere according to its associated basis direction $\\bm{v}_{i}$. The $R_{m}$ values of the likely FOs are indicated by the larger dots and black arrows.} \n\\label{fig:Rm}\n\\end{figure}\n\n\n\\subsubsection{FO Estimation for All Voxels}\n\\label{sec:FO_est}\n\nAfter the likely FOs for voxel $m$ are determined, the weighting matrix\n$\\textbf{C}_{m}$ can be obtained.  Note that in\nEq.~(\\ref{equ:obj2_single}), we have assumed known neighbor\ninformation. However, the FOs in the neighboring voxels are also unknown\nand must be estimated, which means that FOs cannot be estimated\nindependently---it is a joint FO estimation problem. \n\nSuppose the total number of voxels of interest is $M$. The estimation\nof all unknown mixture fractions\n$\\bm{f}=(\\bm{f}_{1}^{T},\\bm{f}_{2}^{T},\\ldots,\\bm{f}_{M}^{T})^{T}$\n(through which the FOs are also estimated) can be written as \n\\begin{eqnarray}\n\\hat{\\bm{f}} = {\\operatorname{arg\\,min}}\\limits_{\\bm{f} \\geq \\bm{0}} E(\\bm{f}) =\n{\\operatorname{arg\\,min}}\\limits_{\\bm{f}_{1},\\bm{f}_{2},\\ldots,\\bm{f}_{M}\\geq\n  \\bm{0}}\\sum\\limits_{m=1}^{M}||\\textbf{G}\\bm{f}_{m}-\\bm{y}_{m}||_{2}^{2}\n+ \\beta ||\\textbf{C}_{m}\\bm{f}_{m}||_{1} \\,.  \n\\label{equ:obj2_all}\n\\end{eqnarray}\nHere $\\textbf{C}_{m}$ encodes the interaction between\nneighbors. \nSince $\\textbf{C}_{m}$ depends on the parameter $\\alpha$ (see  \nEq.~(\\ref{eq:diagonalweights})), $\\alpha$ and $\\beta$ are the \ntwo parameters that must be specified by the user. When $\\alpha$\nis larger there is more influence from neighboring \nvoxels, and when $\\beta$ is larger the mixture fractions tend to be\nmore sparse and therefore there are fewer estimated FOs. \n\n\\subsection{Minimization of the Objective Function and Parallelization}\n\nIn Eq.~(\\ref{equ:obj2_all}), the FOs in each voxel are coupled with\nneighbor voxels in the weighting matrix $\\textbf{C}_{m}$. We \nuse an iterative \\textit{block coordinate descent} (BCD)\nmethod~\\citep{bertsekas} to decouple the interaction and optimize the\nobjective function. At iteration~$t$, each $\\bm{f}_{m}$ is estimated\nby solving \n\\begin{eqnarray}\n\\hat{\\bm{f}}^{t}_{m} &=& {\\operatorname{arg\\,min}}\\limits_{\\bm{f}_{m} \\geq \\bm{0}} \nE(\\hat{\\bm{f}}^{t}_{1},...,\\hat{\\bm{f}}^{t}_{m-1},\\bm{f}_{m},\n\\hat{\\bm{f}}^{t-1}_{m+1},...,\\hat{\\bm{f}}^{t-1}_{M})   \n\\\\ \n&=& {\\operatorname{arg\\,min}}\\limits_{\\bm{f}_{m}\\geq\n  \\bm{0}}||\\textbf{G}\\bm{f}_{m}-\\bm{y}_{m}||_{2}^{2} + \\beta\n||\\textbf{C}_{m}^{t}\\bm{f}_{m}||_{1}, \n\\label{equ:bcd2}\n\\end{eqnarray}\nwhere $\\textbf{C}_{m}^{t}$ is the diagonal weighting matrix at iteration $t$ and it is determined by the likely FOs computed from the neighbor FOs at iteration $t$ or $t-1$ according to Eq.~(\\ref{eq:diagonalweights}).\nThe detailed update of $\\textbf{C}_{m}^{t}$ at each iteration and the optimization of Eq.~(\\ref{equ:bcd2}) are given in~\\ref{sec:appendix}.\nFinally, $\\hat{\\bm{f}}_{m}^{t}$ is normalized so\nthat entries sum to unity and the FOs $\\mathcal{W}_{m}^{t}$ at\nvoxel $m$ at time $t$ are determined using Eq.~(\\ref{eq:neighborFOs}).\n\nBecause the $\\ell_{1}$-norm regularized least squares problem in\nEq.~(\\ref{equ:bcd2}) must be solved for every voxel in each\niteration, the algorithm requires heavy computation and can be\ntime-consuming. Therefore, we modified the BCD optimization in\nEq.~(\\ref{equ:bcd2}) so that multiple voxels can be simultaneously\nsolved to speed up processing. We process $N_{\\mathrm{p}}\\geq 2$\nvoxels together (in this work $N_{\\mathrm{p}}=8$). Each voxel $m$ can\nbe represented as $m=aN_{\\mathrm{p}}+b$, where $a$ and $b$ are\nintegers ($0\\leq a < \\frac{M}{N_{\\mathrm{p}}}$ and $1\\leq b \\leq\nN_{\\mathrm{p}}$). \nFor each group $aN_{\\mathrm{p}}+1 \\leq m \\leq (a+1)N_{\\mathrm{p}}$ with fixed $a$, we have\n\\begin{eqnarray}\n\\hat{\\bm{f}}^{t}_{m}=\n{\\operatorname{arg\\,min}}\\limits_{\\bm{f}_{m} \\geq \\bm{0}}\nE\\left(\\{\\hat{\\bm{f}}^{t}_{m_{0}}\\}_{m_{0}\\leq\n    aN_{\\mathrm{p}}},\\bm{f}_{m},\\{\\hat{\\bm{f}}^{t-1}_{m_{1}}\\}_{m_{1}>aN_{\\mathrm{p}},m_{1}\\neq\n    m}\\right) \\,,\n\\label{equ:parallel}\n\\end{eqnarray}\nand these $\\bm{f}_{m}$'s can be solved in parallel.\n\nThe above iterative algorithm is initialized using\nCFARI~\\citep{landman}, which provides the mixture fractions\n$\\hat{\\bm{f}}_{m}^{0}$ at each voxel independently. \nThe algorithm terminates when the FO difference between two\nsuccessive iterations is small or when the maximum number of\niterations is reached. The complete algorithm is summarized in Algorithm~\\ref{alg:para}.\n\n\n\\algblock{ParFor}{EndParFor}\n\n\\algnewcommand\\algorithmicparfor{\\textbf{parfor}}\n\\algnewcommand\\algorithmicpardo{\\textbf{do}}\n\\algnewcommand\\algorithmicendparfor{\\textbf{end\\ parfor}}\n\\algrenewtext{ParFor}[1]{\\algorithmicparfor\\ #1\\ \\algorithmicpardo}\n\\algrenewtext{EndParFor}{\\algorithmicendparfor}\n\n\n\\begin{algorithm}\n\\caption{FORNI}\n\t\\label{alg:para}\n\t\\begin{spacing}{1.0}\n\t\\begin{algorithmic}[1]\n  \\Require  {Diffusion weighted signals\n    $\\{S_{m}(\\bm{q}_{1}),\\ldots,S_{m}(\\bm{q}_{K})\\}_{m=1}^{M}$;\n    baseline signals $\\{S_{0m}\\}_{m=1}^{M}$ without diffusion\n    weighting; diffusion gradients $\\{\\bm{q}_{1},\\ldots,\\bm{q}_{K}\\}$;\n    size of parallel processing: $N_{\\mathrm{p}}$; the tensor basis\n    $\\{\\textbf{D}_{i}\\}_{i=1}^{N}$ and their PEVs\n    $\\{\\bm{v}_{i}\\}_{i=1}^{N}$; maximum number of iterations\n    $t_{\\mathrm{max}}$; the initialization of FOs $\\{\\mathcal{W}_{m}^{0}\\}_{m=1}^{M}$ computed\n    from~\\citet{landman}; the iteration number starts from $t=1$;} \n\t\\Ensure  {Mixture fractions $\\{\\bm{f}_{m}\\}_{m=1}^{M}$ and FOs $\\{\\mathcal{W}_{m}\\}_{m=1}^{M}$}\n\t\\State{Compute the attenuation matrix $\\textbf{G}$: $G_{ki}=e^{-\\bm{q}_{k}^{T}\\textbf{D}_{i}\\bm{q}_{k}}$\n\t}\n\t\\State{Compute $\\{\\bm{y}_{m}\\}_{m=1}^{M}$: $\\bm{y}_{m}=(S_{m}(\\bm{q}_{1})/S_{0m},\\ldots,S_{m}(\\bm{q}_{K})/S_{0m})^{T}$}\n\t\\State{Initialize FOs: $\\{\\mathcal{W}_{m}\\}_{m=1}^{M} \\coloneqq \\{\\mathcal{W}_{m}^{0}\\}_{m=1}^{M}$}\n\t\\While{$t \\leq t_{\\mathrm{max}}$}\n\t\\For{$a=0:\\left\\lceil\\frac{M}{N_{\\mathrm{p}}}-1\\right\\rceil$} \n\t\\ParFor{$b=1:\\min({N_{\\mathrm{p}},M-aN_{\\mathrm{p}}})$}\n\t\\State{$m \\coloneqq aN_{\\mathrm{p}}+b$}\n\t\\ForAll{basis directions $\\bm{v}_{i}$} \n\t\\State \\parbox[t]{\\dimexpr\\linewidth-\\algorithmicindent}{\n\t$R_{m}(i) \\coloneqq \\sum\\limits_{n\\in\n          \\mathcal{N}_{m}}w_{m,n}\\max\\limits_{j=1,\\ldots,W_{n}} |\\bm{v}_{i}\\cdot \\bm{w}_{n,j}|$} \n\t\\EndFor\n\t\\State \\parbox[t]{\\dimexpr\\linewidth-\\algorithmicindent}{\n\t$\\{\\bm{u}_{m,p}\\}_{p=1}^{U_{m}} \\coloneqq \\{\\bm{v}_{i}| \\forall\\:i' \\neq i \\mbox{ s.t. }\nR_{m}(i)\\geq R_{m}(i') \\mbox{ and } \\arccos(|\\bm{v}_{i}\\cdot\\bm{v}_{i'}|)\\leq\n\\frac{\\pi}{180^\\circ}\\theta_{R} \\}$}\n\t\\For{$i=1:N$} \n\t\\State \\parbox[t]{\\dimexpr\\linewidth-\\algorithmicindent}{$C_{m,i} \\coloneqq {\\scriptstyle \\left(1 - \\alpha\\max\\limits_{p=1,\\ldots,U_{m}}|\\bm{v}_{i}\\cdot \\bm{u}_{m,p}|\\right)\\Big/\\left(\\min\\limits_{q=1,\\ldots,N}\\left(1 - \\alpha\\max\\limits_{p=1,\\ldots,U_{m}}|\\bm{v}_{q}\\cdot \\bm{u}_{m,p}|\\right)\\right)}$}\n\t\\EndFor\n\t\\State{Solve Eq.~(\\ref{equ:bcd2}) to obtain $\\hat{\\bm{f}}_{m}^{t}$}\n\t\\State{$\\bm{f}_{m} \\coloneqq \\hat{\\bm{f}}_{m}^{t}/||\\hat{\\bm{f}}_{m}^{t}||_{1}$}\n\t\\EndParFor\n\t\\For{$b=1:\\min({N_{\\mathrm{p}},M-aN_{\\mathrm{p}}})$}\n\t\\State{$m \\coloneqq aN_{\\mathrm{p}}+b$}\n\t\\State{$\\mathcal{W}_{m} \\coloneqq \\{\\bm{v}_{i}|f_{m,i} > f_{\\mathrm{th}}, i=1,\\ldots,N\\}$}\n\t\\EndFor\n\t\\EndFor\n\t\\State{$t \\coloneqq t+1$ \\textbf{until convergence}}\n\t\\EndWhile\n\t\\State{\\textbf{return} $\\{\\bm{f}_{m}\\}_{m=1}^{M}$ and $\\{\\mathcal{W}_{m}\\}_{m=1}^{M}$}\n\t\\end{algorithmic}\n\t\\end{spacing}\n\t\n\\end{algorithm}\n\n\n\\section{Experiments}\n\\label{sec:exp}\n\nFORNI was evaluated first on a digital crossing phantom, then on\n\\textit{ex vivo} tongue dMRI data from one subject, and finally on an\n\\textit{in vivo} brain dMRI dataset comprising six subjects. FORNI was\nalso compared to the SHORE algorithm~\\citep{merlet2013} which estimates the ensemble average propagator and orientation distribution function using the SHORE basis~\\citep{cheng2011}, the constrained spherical deconvolution (CSD) algorithm~\\citep{tournier2} which introduces a nonnegative constraint on the spherical harmonics framework, the CFARI algorithm that estimates the FOs using a voxelwise sparse reconstruction~\\citep{landman}, and an FO estimation algorithm (L2L0NW)~\\citep{auria} that uses structured sparsity to enforce smooth FO estimation.In the experiments on the tongue dMRI data, we have also compared our method with the FIEBR algorithm~\\citep{CMIG} that is designed for the tongue to improve FO estimation by using atlas information. In the experiments on brain dMRI, because multiple $b$-values were used to acquire the brain dMRI data, the CSD algorithm was\nreplaced by generalized $q$-sampling imaging (GQI)~\\citep{gqi} which\ncan reconstruct FOs using multi-shell dMRI. SHORE and CSD are implemented using the Dipy software~\\citep{DIPY} (\\url{http://nipy.org/dipy/documentation.html}); CFARI is implemented in the JIST software framework~\\citep{lucas}; GQI is implemented in the DSI Studio software~(\\url{http://dsistudio.labsolver.org/Manual/Reconstruction}); and L2L0NW was performed using the code provided by its authors at \\url{https://github.com/basp-group/co-dmri}.\n\n\\subsection{3D Digital Crossing Phantom}\n\n\\begin{figure}[t]\n\\centering\n   \\includegraphics[width=0.7\\linewidth]{phantom_v4.png}\n\\caption[]{A 3D rendering of the simulated tracts.} \n\\label{fig:phantom}\n\\end{figure}\n\n\\begin{figure}[!t]\n\\centering\n   \\includegraphics[width=0.95\\linewidth]{phantom_fo.png}\n\\caption[]{\nGround truth FOs overlaid on the map indicating the number of FOs at each voxel. The FOs in the $z$-direction are shown in a coronal view. The regions highlighted by the dashed boxes are later zoomed in for qualitative evaluation in Figure~\\ref{fig:phantom_fo_all}. The visualization of FOs was created in FSLView~\\citep{FSL}.} \n\\label{fig:phantom_fo}\n\\end{figure}\n\nA 3D digital crossing phantom was generated to simulate five fiber tracts (see Figure~\\ref{fig:phantom}), where one $b0$ image and 60 gradient directions ($b=1000\\,\\mathrm{s}/\\mathrm{mm}^{2}$) were used. A two-tensor/three-tensor model was used to create the simulated\ndiffusion signals for regions with two/three crossing tracts.\nRician noise with different \\textit{signal-to-noise ratio} (SNR) ($\\mathrm{SNR}=10$, $20$, and $30$) on the $b0$ image was added to the \\textit{diffusion weighted images} (DWIs).\n\nFORNI (with $\\alpha=0.8$, $\\beta=0.5$, and $\\mu=3.0$) was applied and compared\nwith SHORE~\\citep{merlet2013}, CSD~\\citep{tournier2}, CFARI~\\citep{landman}, L2L0NW~\\citep{auria}, and the ground truth. \nThe ground truth FOs are shown in Figure~\\ref{fig:phantom_fo}. Because the FOs in the $z$-direction are not visible in the axial view, the regions containing these FOs are also shown in the coronal view.\nA qualitative evaluation of FO estimation is shown in Figure~\\ref{fig:phantom_fo_all} using the results at $\\mathrm{SNR}=20$ in the highlighted regions in Figure~\\ref{fig:phantom_fo}. The FOs are color-coded by the standard DTI color scheme (red: left--right; green: front--back; and blue:\nup--down)~\\citep{pajevic} and overlaid on the map indicating the number of ground truth FOs at each voxel. \nWe can see that FORNI produces smooth FOs compared with SHORE, CSD, and CFARI which perform voxelwise FO\nestimation. \nIn the regions (highlighted by the orange box in Figures~\\ref{fig:phantom_fo} and \\ref{fig:phantom_fo_all}) containing three crossing tracts, both L2L0NW and FORNI are able to better recover the crossing patterns than SHORE, CSD, and CFARI.\nIn addition, FORNI does not produce false positive FOs (see the white boxes in Figure~\\ref{fig:phantom_fo_all}) as in the results of L2L0NW when the neighbor information is used.\n\n\\begin{figure}[!t]\n\\centering\n   \\includegraphics[width=0.85\\linewidth]{phantom_fo_all.png}\n\\caption[]{FO estimation results overlaid on the map indicating the number of ground truth FOs at each voxel at $\\mathrm{SNR}=20$ in the regions highlighted in Figure~\\ref{fig:phantom_fo}. Note the white boxes where L2L0NW produces false positive FOs. The visualization of FOs was created in FSLView~\\citep{FSL}.} \n\\label{fig:phantom_fo_all}\n\\end{figure}\n\nTo quantitatively evaluate the results, we define a voxelwise error measure of FOs in degrees:\n\n", "itemtype": "equation", "pos": 23629, "prevtext": "\nWe see that the weights in Eq.~(\\ref{eq:diagonalweights}) are just the\nweights in Eq.~(\\ref{equ:C_BAMBI}) normalized by the smallest\ndiagonal entry. Note that we require $\\alpha\\in[0,1)$ in order\nto ensure that $C_{m,i}>0$, $\\forall i$.   \n\n\\citet{CMIG} developed the above framework to incorporate \nfixed prior directions at each voxel in the estimation of FOs. These prior\ndirections were either hand-drawn or determined by atlas registration.\nTo apply this framework to spatial smoothness, we replace the concept\nof prior directions with that of likely FOs. Note that our application\nof FO estimation with spatial coherence is fundamentally different\nthan~\\cite{CMIG} in two respects: 1)~likely FOs are computed based on\nneighbors and no manual intervention or anatomical atlas registration\nis needed; 2)~because computations of FOs depend on neighbors, the FOs for all voxels need to be simultaneously estimated and the independent FO computation at each voxel in Eq.~(\\ref{equ:obj2_single}) is inappropriate. The proposed approach to the computation of likely FOs and simultaneous FO estimation is presented next in Sections~\\ref{sec:likely_FO} and \\ref{sec:FO_est}, respectively. \n\n\\subsubsection{Computation of Likely FOs from Neighbors}\n\\label{sec:likely_FO}\n\nA flow chart of the likely FO computation at each voxel is shown in Figure~\\ref{fig:flow}.\nWe first consider a single neighbor\nvoxel; in particular, let voxel $n$ be the neighbor of voxel\n$m$. Let $\\textbf{D}_{m}$ and $\\textbf{D}_{n}$ be the diffusion\ntensors fit from diffusion weighted signals at voxels $m$ and $n$,\nrespectively. Based on the tensors, we define the \\textit{voxel similarity} $w_{m,n}$ \nbetween voxels $m$ and $n$ as\n\\begin{eqnarray}\nw_{m,n} = e^{-\\mu d^2(\\textbf{D}_{m},\\textbf{D}_{n})},\n\\end{eqnarray}\nwhere $\\mu$ is a constant and $d(\\cdot,\\cdot)$ is the measure of distance between tensors given\nby~\\citet{arsigny} \n\\begin{eqnarray}\nd(\\textbf{D}_{m},\\textbf{D}_{n}) =\n\\sqrt{\\mathrm{Trace}(\\{\\log(\\textbf{D}_{m})-\\log(\\textbf{D}_{n})\\}^{2})}. \n\\end{eqnarray}\n\n\n\\begin{figure}[t]\n\\centering\n   \\includegraphics[width=0.98\\linewidth]{flowchart.png}\n\\caption[]{A flow chart of the likely FO computation at a voxel.} \n\\label{fig:flow}\n\\end{figure}\n\n\nGiven the definition of voxel similarity, we now want a measure of\nthe similarity of each basis direction $\\bm{v}_{i}$ to the FOs $\\mathcal{W}_n=\\{\\bm{w}_{n,j}\\}_{j=1}^{W_{n}}$ in voxel $n$. \nAccordingly, we define the \\textit{basis-neighbor similarity} $r_{m,n}(i)$ as \n\\begin{eqnarray}\nr_{m,n}(i) = w_{m,n}\\max\\limits_{j=1,\\ldots,W_n} |\\bm{v}_{i}\\cdot \\bm{w}_{n,j}|, \n\\quad i=1,\\ldots,N \\,.\n\\label{equ:bn_sim}\n\\end{eqnarray}\nIn order for a given basis vector to be similar to a\nneighbor's computed FO, the voxels must be similar and the directions\nmust be well-aligned.\n\nNow consider all voxels that are neighbors of voxel $m$. We define an \n\\textit{aggregate basis-neighbor similarity} $R_m(i)$ at voxel $m$ for each\nbasis vector $\\bm{v}_{i}$ as   \n\n", "index": 5, "text": "\\begin{equation}\nR_{m}(i) = \\sum_{n \\in \\mathcal{N}_{m}} r_{m,n}(i)\\,,  \n\\quad i=1,\\ldots,N \\,.\n\\label{equ:abn_sim}  \n\\end{equation}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E3.m1\" class=\"ltx_Math\" alttext=\"R_{m}(i)=\\sum_{n\\in\\mathcal{N}_{m}}r_{m,n}(i)\\,,\\quad i=1,\\ldots,N\\,.\" display=\"block\"><mrow><mrow><mrow><mrow><msub><mi>R</mi><mi>m</mi></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>i</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mrow><munder><mo largeop=\"true\" movablelimits=\"false\" symmetric=\"true\">\u2211</mo><mrow><mi>n</mi><mo>\u2208</mo><msub><mi class=\"ltx_font_mathcaligraphic\">\ud835\udca9</mi><mi>m</mi></msub></mrow></munder><mrow><msub><mi>r</mi><mrow><mi>m</mi><mo>,</mo><mi>n</mi></mrow></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>i</mi><mo rspace=\"4.2pt\" stretchy=\"false\">)</mo></mrow></mrow></mrow></mrow><mo rspace=\"12.5pt\">,</mo><mrow><mi>i</mi><mo>=</mo><mrow><mn>1</mn><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><mpadded width=\"+1.7pt\"><mi>N</mi></mpadded></mrow></mrow></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.04115.tex", "nexttext": "\nHere, $\\bm{w}_{i}$ and $\\bm{u}_{j}$ are the estimated and ground truth\nFOs, respectively, and $N_{1}$ and $N_{2}$ are the numbers of $\\bm{w}_{i}$\nand $\\bm{u}_{j}$, respectively.\nNote that $\\arccos(\\cdot)$ is in radians and it is converted to degrees by multiplying $\\frac{180^{\\circ}}{\\pi}$.\nIn the $\\max$ function of Eq.~(\\ref{eq:eFOdef}), the first term measures\nhow far away the estimated FOs are from the true FOs, and the second\nterm measures how accurate the true FOs are estimated.  \nSince both terms are expected to be small when the FO estimation is\naccurate, the worst of the two errors is reported. \n\nWe compared the FO errors of FORNI over the entire phantom with those of SHORE, CSD, CFARI, and L2L0NW using all three noise levels. The results are shown in Figure~\\ref{fig:phantom_error}, where means and standard deviations of the FO errors are plotted. It can be seen for all methods the FO errors increase as SNR decreases. FORNI produces more accurate FOs than the competing methods in all three cases.\n\n\\begin{figure}[t]\n\\centering\n\t\t\\includegraphics[width=0.6\\columnwidth]{phantom_error.png}\n\\caption{Means and standard deviations of FO errors over the entire phantom at $\\mathrm{SNR}=10$, $20$, and $30$.} \n\\label{fig:phantom_error}\n\\end{figure}\n\n\\begin{figure}[!t]\n  \\centering\n\t\t\\includegraphics[width=0.9\\columnwidth]{parameters_v2.png}\n\\caption{Average FORNI FO errors over the entire phantom at $\\mathrm{SNR}=20$ with different $\\alpha$, $\\beta$, and $\\mu$: (a)--(e) $\\mu=1.0,2.0,\\ldots,5.0$; (f) means and standard deviations of the data points in (a)--(e) at different $\\mu$.} \n\\label{fig:phantom_para}\n\\end{figure}\n\n\\begin{figure}[!t]\n  \\centering\n\t\t\\includegraphics[width=0.9\\columnwidth]{phantom_error_init_f.png}\n\\caption{Means and standard deviations of FORNI FO errors at $\\mathrm{SNR}=20$ with different (a) mixture fraction thresholds and (b) initialization methods.}\n\\label{fig:phantom_error_init_f}\n\\end{figure}\n\nNext, we studied the effect of the parameters, mixture fraction thresholds, and initialization in FORNI. Because in the tongue and brain dMRI data used in this work, the SNR is close to $20$ on the $b0$ images, we used the phantom at $\\mathrm{SNR}=20$ for the evaluation below.\n\nTo evaluate the impact of parameters, we experimented with different $\\alpha$, $\\beta$, and $\\mu$ settings: $\\alpha\\in \\{0.0,0.1,\\ldots,0.9\\}$, $\\beta\\in \\{0.1,0.3,\\ldots,0.9\\}$, and $\\mu \\in \\{1.0,2.0,\\ldots,5.0\\}$. The average FO errors for each $\\alpha$, $\\beta$, and $\\mu$ combination over the entire phantom are plotted in Figures~\\ref{fig:phantom_para}(a)--(e). \nNote that when $\\alpha=0.0$, the basis directions are uniformly weighted and no neighbor information is used, which is equivalent to the CFARI algorithm.\nAt each $\\mu$ for most $\\beta$, increasing $\\alpha$ reduces FO errors until $\\alpha$ is too large, and in most cases incorporation of neighborhood information ($\\alpha>0$) improves the estimation accuracy. \nFigure~\\ref{fig:phantom_para}(f) gives the means and standard deviations of these average FO errors using all $\\alpha$ and $\\beta$ combinations at each $\\mu$. It can be seen that the error starts to become stable when $\\mu$ reaches 3.0. In addition, the variance is smallest at $\\mu=3.0$, indicating the performance is less affected by changing $\\alpha$ and $\\beta$ values than at other $\\mu$. Therefore, for our real data application, we use $\\mu=3.0$.\nThen, at $\\mu=3.0$ we select $\\alpha$ and $\\beta$ for the real data experiments with the following rationale.\nFirst, because in many cases $\\alpha=0.9$ causes errors even larger than those without neighbor information, we only consider the choices with $\\alpha<0.9$. Second, we have found from experience that choosing $\\beta$ too large can lead to instabilities in the $\\ell_1$ solver. Therefore, we have picked $\\alpha = 0.8$ and $\\beta = 0.5$ for the remaining experiments. From Figure~\\ref{fig:phantom_para}(c), we see that at $\\mu=3.0$ this selection yields a\nperformance that is comparable to the other four top performing operating points.  \n\nUsing the selected $\\alpha$, $\\beta$, and $\\mu$, we computed the FO errors with different mixture fraction thresholds ($f_\\mathrm{th}\\in\\{0.0,0.1,0.2\\}$) and different initialization methods including SHORE, CSD, and CFARI, which are the voxelwise FO estimation algorithms evaluated in this work. The results are shown in Figure~\\ref{fig:phantom_error_init_f}. In Figure~\\ref{fig:phantom_error_init_f}(a), we can see that $f_\\mathrm{th}=0.1$ (as selected in Section~\\ref{sec:FORNI}) achieves the smallest error. In Figure~\\ref{fig:phantom_error_init_f}(b), different initialization methods achieve very close FO errors in FORNI, which indicates the robustness of FORNI to initialization.\n\n\\subsection{\\textit{Ex Vivo} Tongue dMRI}\n\n\\begin{figure}[t]\n  \\centering\n  \\includegraphics[width=0.9\\columnwidth]{tongue_v3.png}\n\\caption{FO estimation on the \\textit{ex vivo} tongue in the coronal\n  view, which is focused on the crossing (highlighted by the white dashed box in (a)) of the GG and T muscle. A high resolution structural image (left) with a schematic of the anatomy of GG and T is shown for location reference.}\n\\label{fig:tongue}\n\\end{figure}\n\nNext, FORNI (with $\\alpha=0.8$, $\\beta=0.5$ and $\\mu=3.0$) was applied to the\n\\textit{ex vivo} tongue dMRI data. Nine $b0$ images and 64 DWIs\n($b=2000~\\mathrm{s}/\\mathrm{mm}^{2}$) were acquired on a 3T MRI\nscanner (Magnetom Trio, Siemens, Erlangen, Germany). The resolution is\n2~mm isotropic (matrix size: $100\\times 100$) and the number of slices\nis 30. \nThe SNR on the $b0$ image is approximately $20.31$, which was estimated by placing bounding boxes in the background and tract regions~\\citep{CMIG}.\nEddy current correction and diffusion tensor estimation were\nperformed by CATNAP~\\citep{CATNAP} implemented in the JIST\nsoftware~\\citep{lucas}. According to the tensors in noncrossing regions, the eigenvalues of the basis tensors\nused in FORNI were $\\lambda_{1}=7.0\\times\n10^{-4}~\\mathrm{mm}^{2}/\\mathrm{s}$ and $\\lambda_{2}=\\lambda_{3}=3.0\n\\times 10^{-4}~\\mathrm{mm}^{2}/\\mathrm{s}$. The FORNI processing took\naround seven minutes for the data. \nSHORE~\\citep{merlet2013}, CSD~\\citep{tournier2},\nCFARI~\\citep{landman}, L2L0NW~\\citep{auria}, and FIEBR~\\citep{CMIG} were\nalso applied on these data.\n\nFigure~\\ref{fig:tongue} shows results in the coronal view with the\nfocus on the crossing region of the genioglossus (GG) and\nthe transverse (T) muscle in the tongue. \nA high resolution structural image with a schematic of the anatomy of GG and T is shown in Figure~\\ref{fig:tongue}(a) for location reference.\nIt can be seen that FORNI not only produces smoother FOs but also\nbetter reconstructs the crossing FOs of GG and T. \n\n\\subsection{\\textit{In Vivo} Brain dMRI}\n\n\\begin{figure}[!t]\n\t\t\\centering\n\t\t\\includegraphics[width=0.8\\columnwidth]{SLF_v5.png}\n\\caption{FO estimation on brain dMRI (overlaid on the FA map) for all\n  six subjects, which is focused on the crossing of SLF and the lateral CC\n  (axial view). The FA image and the focused region are shown in the\n  left column.}\n\\label{fig:slf}\n\\end{figure}\n\n\\begin{figure}[!t]\n\t\t\\centering\n\t\t\\includegraphics[width=0.99\\columnwidth]{CC_v4.png}\n\\caption{FO estimation on brain dMRI (overlaid on the FA map) for all\n  six subjects, which is focused on the crossing of the lateral CC and CST\n  (coronal view). The FA image and the focused region are shown in the\n  left column. Note the region highlighted by the green box where L2L0NW does not produces FOs that correspond to the geometry of the superior CC.}\n\\label{fig:cc}\n\\end{figure}\n\nFORNI was applied to the six subjects in an \\textit{in vivo}\nbrain dMRI dataset. The images were acquired on a 3T MRI scanner\n(Magnetom Trio, Siemens, Erlangen, Germany). Two $b$-values were used\n($b=1000~\\mathrm{s}/\\mathrm{mm}^{2}$ and\n$2000~\\mathrm{s}/\\mathrm{mm}^{2}$). Each $b$-value is associated with\n30 gradient directions and each DWI has two repeated scans. Twelve\n$b0$ images were also acquired.   \nThe resolution is 2.7~mm isotropic (matrix size: $84\\times 84$) and\nthe number of slices is 48. \nThe SNR on the $b0$ image is close to 20 in the dMRI dataset.\nMotion correction and diffusion tensor estimation were performed by\nCATNAP~\\citep{CATNAP}. \n\nFORNI (with $\\alpha=0.8$, $\\beta=0.5$, and $\\mu=3.0$) was compared with GQI~\\citep{gqi}, \nSHORE~\\citep{merlet2013}, CFARI~\\citep{landman}, and L2L0NW~\\citep{auria}.\nThe eigenvalues of the basis tensors were $\\lambda_{1}=2.0\\times\n10^{-3}~\\mathrm{mm}^{2}/\\mathrm{s}$ and\n$\\lambda_{2}=\\lambda_{3}=5.0\\times\n10^{-4}~\\mathrm{mm}^{2}/\\mathrm{s}$ as suggested by~\\citet{landman}. The FORNI processing took around\none hour for each dMRI data. \n\nWe highlight two regions for evaluation of the results on the six\nsubjects: the crossing region of the superior longitudinal fasciculus\n(SLF) and the lateral corpus callosum (CC) in the axial view\n(Figure~\\ref{fig:slf}) and the crossing region of the lateral CC and the\ncorticospinal tract (CST) in the coronal view (Figure~\\ref{fig:cc}).\nThe results are shown with \\textit{fractional anisotropy} (FA) images in the left column. \nCompared to the voxelwise FO estimation methods of GQI, SHORE, and CFARI, both L2L0NW and FORNI\nproduces smooth FO estimation results and better identifies the crossing patterns\nin all cases. However, we note that in the region containing highly curved parts of the superior CC, for example, the one highlighted by the green box on Subject 1 in Figure~\\ref{fig:cc}, L2L0NW does not generate the FOs that correspond the pathway of the superior CC. The effects of these kinds of errors are better illustrated below in the fiber tracking results of Figures~\\ref{fig:infact} and \\ref{fig:infact_cc}.\n\nTo further validate FORNI and compare it with the competing methods we used the INFACT algorithm~\\citep{landman}\nto carry out fiber tracking on the results of each algorithm. INFACT\nis a deterministic streamlining algorithm which extends the FACT\nalgorithm~\\citep{mori} to our case where there are multiple FOs per\nvoxel. We used an FA threshold of 0.15 and a turning angle threshold of $40^{\\circ}$,\nwhich are common settings for tractography~\\citep{wahl,glasser,kaplan}. The\nseeds were placed in the noncrossing region of CC. \nA representative case (Subject 1) is shown in\nFigure~\\ref{fig:infact}, where the FORNI result can be \ncompared to the results of GQI, SHORE, CFARI, and L2L0NW.\nHere each segment of the fiber streamlines is \ncolor-coded by the standard DTI color scheme (red: left--right; green:\nfront--back; and blue: up--down)~\\citep{pajevic}. \nIt can be seen that the lateral CC fiber streamlines are\ntracked better using FOs estimated by FORNI than GQI, SHORE, and CFARI. In L2L0NW results, although the lateral CC is also well tracked, the superior CC is mostly missing, which is consistent with the FO estimation highlighted by the green box in Figure~\\ref{fig:cc}. This missing of the superior CC also exists in the other subjects, which is shown in Figure~\\ref{fig:infact_cc}. Here, we applied fiber tracking using FORNI and L2L0NW FOs on the other five subjects with seeds placed in CC. We can see that FORNI is able to produce both superior and lateral CC but L2L0NW misses the superior CC.\n\n\\begin{figure}[t]\n\t\t\\centering\n\t\t\\includegraphics[width=0.99\\columnwidth]{infact_v2.png}\n\\caption{A representative result (Subject 1) of fiber tracking using the INFACT\n  tracking~\\citep{landman} overlaid on the FA map in the coronal\n  view. The seeding region is represented as the yellow volume. Note\n  the highlighted region where more lateral CC fiber streamlines were\n  tracked using FOs computed by FORNI than GQI, SHORE, and CFARI. The visualization was created in\n  TrackVis~\\citep{trackvis}.}\n\\label{fig:infact}\n\\end{figure}\n\n\\begin{figure}[t]\n\t\t\\centering\n\t\t\\includegraphics[width=0.99\\columnwidth]{infact_cc.png}\n\\caption{Fiber tracking results seeded in CC on Subjects 2--6 using L2L0NW and FORNI FOs. The seeding ROIs are indicated by the yellow volumes. The visualization was created in TrackVis~\\citep{trackvis}.}\n\\label{fig:infact_cc}\n\\end{figure}\n\n\\section{Discussion}\n\\label{sec:discussion}\n\nFORNI uses weighted $\\ell_{1}$-norm regularization as\nin the FIEBR algorithm~\\citep{CMIG}, but the key ideas are very different between the two\nalgorithms. \nFirst, the prior directions/likely FOs at each voxel are determined very\ndifferently. In~\\citet{CMIG}, the prior directions are calculated based on\nthe anatomical information of known tracts and it is aimed at\nresolving crossing fibers with a very limited number of gradient\ndirections (around~12). \nIts performance could be affected by prior direction inaccuracies, for example, caused by inaccurate localization of tracts using registration. In the results in Figure~\\ref{fig:tongue} we can see that FIEBR can miss the crossing patterns due to the inaccurate specification of anatomical priors.\nIn the proposed method no anatomical\ninformation is required, and the purpose is to improve FO estimation\nby incorporating spatial coherence of FOs. Second, the FOs are\nestimated at each voxel independently in~\\citet{CMIG} and no\ninteraction between voxels is encoded while the proposed method\njointly estimates the FOs in all voxels due to the interaction.\n\nThe L2L0NW algorithm~\\citep{auria} also uses weighted $\\ell_{1}$-norm to model the interaction between neighbors to enforce spatial regularization in its objective function. However, the motivation and the actual determination of the weighting are quite different between L2L0NW and FORNI. First, our method was motivated by the framework developed in~\\citet{CMIG}, where the weighted $\\ell_{1}$-norm is derived in a \\textit{maximum a posteriori} framework and is a consequence of modeling the prior density with a Laplace distribution and a term that encourages basis directions close to certain prior directions. The L2L0NW algorithm is motivated by the iterative reweighting scheme that seeks to better solve the $\\ell_{0}$-norm minimization problem. \nSecond, the weighting is determined differently. L2L0NW directly uses all the neighbor information in the weighting, and a neighbor FO has no influence on directions farther than $15^{\\circ}$ and uniform influence on directions within $15^{\\circ}$. For a region with a highly curved tract, for example, the turning of the superior CC in~Figure~\\ref{fig:cc}, it is possible that the desired FO is more than $15^{\\circ}$ away from its neighbor FOs and is not sufficiently encouraged. In FORNI, we process the information in the neighbors and extract likely FOs, and the weight decreases as the directions are closer to likely FOs. This strategy avoids the cutoff effect when a threshold of $15^{\\circ}$ is used in~\\citet{auria}. In addition, we have used a voxel similarity term to avoid leakage of FOs.\nThe voxel similarity puts higher weights on more similar neighbors and ensures anisotropic FO spatial consistency. This is especially important at tract boundaries and highly curved regions of tracts to suppress the influence of undesired FOs. As seen in the phantom experiment (Figure~\\ref{fig:phantom_fo_all}) and the brain dMRI results (Figure~\\ref{fig:cc}), L2L0NW can have leaking FOs at tract boundaries and miss the FOs of the curved superior CC, respectively, but this is avoided in FORNI.\n\nA possible limitation of using the tensor distance in the voxel similarity is that at the boundary of the noncrossing part of a tract and its crossing part, the information in the noncrossing neighbors does not influence the current voxel as much as the crossing neighbors. It may be interesting to allow greater influence of noncrossing voxels on the crossing voxels that belong to the same tract while maintaining the avoidance of leaking of the FOs belonging to a different tract from the crossing voxels to noncrossing voxels.\n\nIn FORNI, the interaction between neighbors are decoupled using a BCD\nstrategy. If a different update order of the voxels were used, the\nresults of each iteration could be different. However, because\nmultiple iterations are applied, the final results are expected to be\nvery similar even if the update order is changed. But it would be\ninteresting to explore adaptive sweeping patterns, such as~\\citet{li},\nso that the optimization is less dependent on the voxel order.\n\nInstead of enforcing pairwise similarity between neighbor voxels,\nFORNI explicitly models neighbor FO information in the FO estimation\nby placing different penalties on the basis. Yet it is possible to\ncombine the pairwise similarity with FORNI. For example, a\nstraightforward improvement could be adding post-smoothing of FOs,\nsuch as~\\citet{sigurdsson}, to the FORNI results.  Indeed, the FORNI\nprocessing and the post-smoothing could be performed alternately with\nmany iterations. These alternating iterative steps could actually\ncorrespond to the optimization of some unknown form of objective\nfunctions, which can be explored by future work to develop more\npowerful FO estimation algorithms.\n\nBesides the directional information of FOs, the microstructural property has also been a quantity of interest computed from dMRI~\\citep{zhang,daducci2015,alexander,auria2015}, which quantifies the tissue structure at mesoscale~\\citep{reisert2014}, and recent work has further explored joint estimation of the microstructural characteristics and FOs~\\citep{girard}. \nAmong these works, \\citet{daducci2015} and \\citet{auria2015} reformulate the estimation of microstructural properties by using a dictionary. Using this reformulation, it is possible to extend our framework to incorporate the estimation of the tissue organization, which could be improved by the incorporation of spatial smoothness. \n\nAt higher $b$-values, the diffusion is not Gaussian due to the restriction effects~\\citep{cohen}. Thus, there can be model inaccuracies caused by using the tensor basis. The sparsity and spatial regularization enforced by weighted $\\ell_{1}$-norm terms could alleviate the issue. And it is possible to use the extension where microstructural properties are jointly estimated with FOs to account for the slow diffusing components. \n\n\\section{Summary and Conclusion}\n\\label{sec:conclusion}\n\nIn this work, we have proposed FORNI, an FO estimation algorithm that uses\nneighborhood information.  A fixed tensor basis is used to\nrepresent the diffusion signals.  To ensure spatial coherence, the\ndirectional information in the neighbors is explicitly modeled in\nweighted $\\ell_{1}$-norm regularization terms.  The resulting\nobjective function is optimized using a BCD strategy and a\nparallelization approach to speeding up processing is presented.  The\nproposed method was applied to a digital crossing phantom, \\textit{ex\n  vivo} tongue dMRI data, and \\textit{in vivo} brain dMRI data. The\nresults demonstrate that the proposed method is able to use\nneighborhood information to improve FO estimation. \n\n\\section*{Acknowledgement}\n\nThis work is supported by NIH\\slash NINDS 5R01NS056307 and NIH\\slash\nNINDS 1R21NS082891. \n\n\\appendix\n\\section{Optimization of the Weighted $\\ell_{1}$-norm Regularized Least Squares Problem}\n\\label{sec:appendix}\n\nIn Eq.~(\\ref{equ:bcd2}) the diagonal entries of (diagonal matrix) $\\textbf{C}_{m}^{t}$\nare given by (see Eq.~(\\ref{eq:diagonalweights}))\n\\begin{eqnarray}\nC_{m,i}^{t} = \\frac{1 - \\alpha\\max\\limits_{p=1,\\ldots,U_m^{t}}|\\bm{v}_{i}\\cdot\n  \\bm{u}_{m,p}^{t}|}{\\min\\limits_{q=1,\\ldots,N}\\left(1 -\n    \\alpha\\max\\limits_{p=1,\\ldots,U_m^{t}} |\\bm{v}_{q}\\cdot \\bm{u}_{m,p}^{t}|\\right)}\\,,\n\\quad i=1,\\ldots,N \\,. \n\\end{eqnarray}\nHere, $\\bm{u}_{m,p}^{t}$ represents the $p$-th likely FO for voxel $m$ at iteration $t$ and is to be specified, and $U_m^{t}$ is the number of likely FOs for voxel $m$ at iteration $t$.\nEq.~(\\ref{equ:bcd2}) explicitly acknowledges the fact that at time\n$t$, the estimate of $\\bm{f}_{m}$ uses information from voxels\nthat have already been updated at time $t$ as well as information from\nvoxels that were updated at the previous time $t-1$. (This is a\nGauss-Seidel rather than a Jacobi update strategy.) Using this fact, the computed aggregate basis-neighbor similarity function for voxel $m$ at time $t$ is \n\\begin{eqnarray}\nR_{m}^{t}(i) = \\sum\\limits_{n\\in\n  \\mathcal{N}_{m}}w_{m,n}\\max\\limits_{j=1,\\ldots,W_{n}^{t-\\mathds{1}_{n > m}}}|\\bm{v}_{i}\\cdot\n\\bm{w}_{n,j}^{t-\\mathds{1}_{n > m}}|, \n\\end{eqnarray}\nwhere $\\mathds{1}$ is an indicator\nfunction providing a shorthand notation to specify whether FOs at time\n$t$ or $t-1$ are being used.  \nThe likely FOs $\\mathcal{U}_{m}^{t}$ at time~$t$ are then computed according to Eq.~(\\ref{equ:likely_FOs}). \nWith these definitions, Eq.~(\\ref{equ:bcd2}) is fully specified.\n\nEq.~(\\ref{equ:bcd2}) is a weighted $\\ell_{1}$-norm\nregularized least squares problem which can be converted to an\n$\\ell_{1}$-norm regularized least squares problem. First, we define a\nnew variable \n$\\bm{g}_{m}^{t}=\\textbf{C}_{m}^{t}\\bm{f}_{m}$. Since\n$\\textbf{C}_{m}^{t}$ is a diagonal matrix and $C_{m,i}^{t}>0$,\n$\\textbf{C}_{m}^{t}$ is invertible and $\\bm{f}_{m} =\n(\\textbf{C}_{m}^{t})^{-1}\\bm{g}_{m}^{t}$. Then, by defining\n$\\tilde{\\textbf{G}}_{m}^{t}=\\textbf{G}(\\textbf{C}_{m}^{t})^{-1}$, we\nhave \n\\begin{eqnarray}\n\\hat{\\bm{g}}_{m}^{t} = {\\operatorname{arg\\,min}}\\limits_{\\bm{g}_{m}^{t}\\geq\n  \\bm{0}}||\\tilde{\\textbf{G}}_{m}^{t}\\bm{g}_{m}^{t}-\\bm{y}_{m}||_{2}^{2}\n+ \\beta ||\\bm{g}_{m}^{t}||_{1}, \n\\label{equ:obj2}\n\\end{eqnarray}\nwhich we solve using the efficient optimization method for compressed\nsensing reported in~\\citet{kim}. The mixture fractions can be\nestimated as  \n\\begin{eqnarray}\n\\hat{\\bm{f}}_{m}^{t}=(\\textbf{C}_{m}^{t})^{-1}\\hat{\\bm{g}}_{m}^{t}.\n\\label{equ:fm}\n\\end{eqnarray}\n\n\n\n\\bibliographystyle{model2-names}\n\\bibliography{CFARI_smooth}\n\n\n", "itemtype": "equation", "pos": 39322, "prevtext": "\nBasis directions with larger aggregate basis-neighbor similarity\ncorrespond to directions that are close to FOs in many neighboring\nvoxels or in a few neighbors that have strong voxel\nsimilarity. These are directions that are more likely to be FOs in\nvoxel $m$ by virtue of the current FOs in neighboring voxels.  \n\nGiven $R_{m}$ we can extract a set of likely FOs for voxel $m$. \nWe could simply choose the directions with the largest $R_{m}$\nvalues or those with $R_{m}$ values greater than a threshold. \nHowever, a special circumstance should be noted. In a crossing region,\nsuch as that depicted in Figure~\\ref{fig:sim_illua},\nsome of the neighboring voxels could fail to estimate a crossing FO due to\nnoise. In particular, suppose there are two crossing FOs $\\tilde{\\bm{v}}_{1}$ and \n$\\tilde{\\bm{v}}_{2}$ in this region, and $\\tilde{\\bm{v}}_{1}$ fails to be\nreconstructed in more than one neighboring voxel while the other\nneighbors have both FOs reconstructed. \nIn this case, as is shown in Figure~\\ref{fig:sim_illub}, the basis vector $\\bm{v}_{i}$ corresponding to\n$\\tilde{\\bm{v}}_{1}$ \ncould have a smaller $R_{m}(i)$ value than a basis direction\n$\\tilde{\\bm{v}}_{3}$, for example, which is distant from both\n$\\tilde{\\bm{v}}_{1}$ and $\\tilde{\\bm{v}}_{2}$. In this case, the desired $\\tilde{\\bm{v}}_{1}$ is not included in the top two likely FOs and thus $\\tilde{\\bm{v}}_{1}$ may not be properly encouraged, while an undesired $\\tilde{\\bm{v}}_{3}$ may be encouraged and create false FOs.\n\n\\begin{figure}[t]\n  \\centering\n\t\\subfigure[FO Structure]{\n\t\t\\includegraphics[width=0.22\\columnwidth]{sim_illu_v2a.png}\n\t\t\\label{fig:sim_illua}\n\t}\n  \\subfigure[$R_{m}(i)$ Profile]{\n\t\t\\includegraphics[width=0.35\\columnwidth]{sim_illu_v2b.png}\n\t\t\\label{fig:sim_illub}\n\t}\n\\caption{An illustration of the $R_{m}(i)$ profile in the case where\n  one of the crossing FOs fails to be reconstructed in some neighboring\n  voxels.} \n\\label{fig:sim_illu}\n\\end{figure}\n\nA more robust definition of the likely FOs is as those directions\nwhich comprise the local maxima of $R_m$.  In particular, consider\nthe direction $\\bm{v}_i$ and compare its value $R_m(i)$ to\nall values of $R_m(i')$ corresponding to directions $\\bm{v}_{i'}$ within $\\theta_{R} =\n20^{\\circ}$. If $R_m(i)$ is maximum, then $\\bm{v}_i$ is included in\nthe likely FOs. Following this reasoning, the likely FOs at voxel $m$ are given by  \n\\begin{eqnarray}\n\\mathcal{U}_m =\\{\\bm{v}_{i}| \\forall\\:i' \\neq i \\mbox{ s.t. }\nR_{m}(i)\\geq R_{m}(i') \n\\mbox{ and } \\arccos(|\\bm{v}_{i}\\cdot\\bm{v}_{i'}|)\\leq\n\\frac{\\pi}{180^\\circ}\\theta_{R}\\}. \n\\label{equ:likely_FOs} \n\\end{eqnarray}\nNote that $\\theta_{R}$ is converted to have a unit of radians so that it can be compared with $\\arccos(|\\bm{v}_{i}\\cdot\\bm{v}_{i'}|)$.\n\nAn example of the $R_{m}$ values of a voxel in the crossing region in Figure~\\ref{fig:toy} is shown in Figure~\\ref{fig:Rm}, where the $R_{m}$ values are plotted on the unit sphere according to their associated basis directions. The $R_{m}$ values of the likely FOs are indicated by the larger dots and black arrows. The two likely FOs are the horizontal ($x$) and vertical~($y$) directions in Figure~\\ref{fig:toy} that correspond to the desired FOs.\n\n\\begin{figure}[t]\n\\centering\n   \\includegraphics[width=0.65\\linewidth]{Rm.png}\n\\caption[]{An example of the $R_{m}$ values of a voxel in the crossing region in Figure~\\ref{fig:toy}. Each $R_{m}(i)$ is plotted on the unit sphere according to its associated basis direction $\\bm{v}_{i}$. The $R_{m}$ values of the likely FOs are indicated by the larger dots and black arrows.} \n\\label{fig:Rm}\n\\end{figure}\n\n\n\\subsubsection{FO Estimation for All Voxels}\n\\label{sec:FO_est}\n\nAfter the likely FOs for voxel $m$ are determined, the weighting matrix\n$\\textbf{C}_{m}$ can be obtained.  Note that in\nEq.~(\\ref{equ:obj2_single}), we have assumed known neighbor\ninformation. However, the FOs in the neighboring voxels are also unknown\nand must be estimated, which means that FOs cannot be estimated\nindependently---it is a joint FO estimation problem. \n\nSuppose the total number of voxels of interest is $M$. The estimation\nof all unknown mixture fractions\n$\\bm{f}=(\\bm{f}_{1}^{T},\\bm{f}_{2}^{T},\\ldots,\\bm{f}_{M}^{T})^{T}$\n(through which the FOs are also estimated) can be written as \n\\begin{eqnarray}\n\\hat{\\bm{f}} = {\\operatorname{arg\\,min}}\\limits_{\\bm{f} \\geq \\bm{0}} E(\\bm{f}) =\n{\\operatorname{arg\\,min}}\\limits_{\\bm{f}_{1},\\bm{f}_{2},\\ldots,\\bm{f}_{M}\\geq\n  \\bm{0}}\\sum\\limits_{m=1}^{M}||\\textbf{G}\\bm{f}_{m}-\\bm{y}_{m}||_{2}^{2}\n+ \\beta ||\\textbf{C}_{m}\\bm{f}_{m}||_{1} \\,.  \n\\label{equ:obj2_all}\n\\end{eqnarray}\nHere $\\textbf{C}_{m}$ encodes the interaction between\nneighbors. \nSince $\\textbf{C}_{m}$ depends on the parameter $\\alpha$ (see  \nEq.~(\\ref{eq:diagonalweights})), $\\alpha$ and $\\beta$ are the \ntwo parameters that must be specified by the user. When $\\alpha$\nis larger there is more influence from neighboring \nvoxels, and when $\\beta$ is larger the mixture fractions tend to be\nmore sparse and therefore there are fewer estimated FOs. \n\n\\subsection{Minimization of the Objective Function and Parallelization}\n\nIn Eq.~(\\ref{equ:obj2_all}), the FOs in each voxel are coupled with\nneighbor voxels in the weighting matrix $\\textbf{C}_{m}$. We \nuse an iterative \\textit{block coordinate descent} (BCD)\nmethod~\\citep{bertsekas} to decouple the interaction and optimize the\nobjective function. At iteration~$t$, each $\\bm{f}_{m}$ is estimated\nby solving \n\\begin{eqnarray}\n\\hat{\\bm{f}}^{t}_{m} &=& {\\operatorname{arg\\,min}}\\limits_{\\bm{f}_{m} \\geq \\bm{0}} \nE(\\hat{\\bm{f}}^{t}_{1},...,\\hat{\\bm{f}}^{t}_{m-1},\\bm{f}_{m},\n\\hat{\\bm{f}}^{t-1}_{m+1},...,\\hat{\\bm{f}}^{t-1}_{M})   \n\\\\ \n&=& {\\operatorname{arg\\,min}}\\limits_{\\bm{f}_{m}\\geq\n  \\bm{0}}||\\textbf{G}\\bm{f}_{m}-\\bm{y}_{m}||_{2}^{2} + \\beta\n||\\textbf{C}_{m}^{t}\\bm{f}_{m}||_{1}, \n\\label{equ:bcd2}\n\\end{eqnarray}\nwhere $\\textbf{C}_{m}^{t}$ is the diagonal weighting matrix at iteration $t$ and it is determined by the likely FOs computed from the neighbor FOs at iteration $t$ or $t-1$ according to Eq.~(\\ref{eq:diagonalweights}).\nThe detailed update of $\\textbf{C}_{m}^{t}$ at each iteration and the optimization of Eq.~(\\ref{equ:bcd2}) are given in~\\ref{sec:appendix}.\nFinally, $\\hat{\\bm{f}}_{m}^{t}$ is normalized so\nthat entries sum to unity and the FOs $\\mathcal{W}_{m}^{t}$ at\nvoxel $m$ at time $t$ are determined using Eq.~(\\ref{eq:neighborFOs}).\n\nBecause the $\\ell_{1}$-norm regularized least squares problem in\nEq.~(\\ref{equ:bcd2}) must be solved for every voxel in each\niteration, the algorithm requires heavy computation and can be\ntime-consuming. Therefore, we modified the BCD optimization in\nEq.~(\\ref{equ:bcd2}) so that multiple voxels can be simultaneously\nsolved to speed up processing. We process $N_{\\mathrm{p}}\\geq 2$\nvoxels together (in this work $N_{\\mathrm{p}}=8$). Each voxel $m$ can\nbe represented as $m=aN_{\\mathrm{p}}+b$, where $a$ and $b$ are\nintegers ($0\\leq a < \\frac{M}{N_{\\mathrm{p}}}$ and $1\\leq b \\leq\nN_{\\mathrm{p}}$). \nFor each group $aN_{\\mathrm{p}}+1 \\leq m \\leq (a+1)N_{\\mathrm{p}}$ with fixed $a$, we have\n\\begin{eqnarray}\n\\hat{\\bm{f}}^{t}_{m}=\n{\\operatorname{arg\\,min}}\\limits_{\\bm{f}_{m} \\geq \\bm{0}}\nE\\left(\\{\\hat{\\bm{f}}^{t}_{m_{0}}\\}_{m_{0}\\leq\n    aN_{\\mathrm{p}}},\\bm{f}_{m},\\{\\hat{\\bm{f}}^{t-1}_{m_{1}}\\}_{m_{1}>aN_{\\mathrm{p}},m_{1}\\neq\n    m}\\right) \\,,\n\\label{equ:parallel}\n\\end{eqnarray}\nand these $\\bm{f}_{m}$'s can be solved in parallel.\n\nThe above iterative algorithm is initialized using\nCFARI~\\citep{landman}, which provides the mixture fractions\n$\\hat{\\bm{f}}_{m}^{0}$ at each voxel independently. \nThe algorithm terminates when the FO difference between two\nsuccessive iterations is small or when the maximum number of\niterations is reached. The complete algorithm is summarized in Algorithm~\\ref{alg:para}.\n\n\n\\algblock{ParFor}{EndParFor}\n\n\\algnewcommand\\algorithmicparfor{\\textbf{parfor}}\n\\algnewcommand\\algorithmicpardo{\\textbf{do}}\n\\algnewcommand\\algorithmicendparfor{\\textbf{end\\ parfor}}\n\\algrenewtext{ParFor}[1]{\\algorithmicparfor\\ #1\\ \\algorithmicpardo}\n\\algrenewtext{EndParFor}{\\algorithmicendparfor}\n\n\n\\begin{algorithm}\n\\caption{FORNI}\n\t\\label{alg:para}\n\t\\begin{spacing}{1.0}\n\t\\begin{algorithmic}[1]\n  \\Require  {Diffusion weighted signals\n    $\\{S_{m}(\\bm{q}_{1}),\\ldots,S_{m}(\\bm{q}_{K})\\}_{m=1}^{M}$;\n    baseline signals $\\{S_{0m}\\}_{m=1}^{M}$ without diffusion\n    weighting; diffusion gradients $\\{\\bm{q}_{1},\\ldots,\\bm{q}_{K}\\}$;\n    size of parallel processing: $N_{\\mathrm{p}}$; the tensor basis\n    $\\{\\textbf{D}_{i}\\}_{i=1}^{N}$ and their PEVs\n    $\\{\\bm{v}_{i}\\}_{i=1}^{N}$; maximum number of iterations\n    $t_{\\mathrm{max}}$; the initialization of FOs $\\{\\mathcal{W}_{m}^{0}\\}_{m=1}^{M}$ computed\n    from~\\citet{landman}; the iteration number starts from $t=1$;} \n\t\\Ensure  {Mixture fractions $\\{\\bm{f}_{m}\\}_{m=1}^{M}$ and FOs $\\{\\mathcal{W}_{m}\\}_{m=1}^{M}$}\n\t\\State{Compute the attenuation matrix $\\textbf{G}$: $G_{ki}=e^{-\\bm{q}_{k}^{T}\\textbf{D}_{i}\\bm{q}_{k}}$\n\t}\n\t\\State{Compute $\\{\\bm{y}_{m}\\}_{m=1}^{M}$: $\\bm{y}_{m}=(S_{m}(\\bm{q}_{1})/S_{0m},\\ldots,S_{m}(\\bm{q}_{K})/S_{0m})^{T}$}\n\t\\State{Initialize FOs: $\\{\\mathcal{W}_{m}\\}_{m=1}^{M} \\coloneqq \\{\\mathcal{W}_{m}^{0}\\}_{m=1}^{M}$}\n\t\\While{$t \\leq t_{\\mathrm{max}}$}\n\t\\For{$a=0:\\left\\lceil\\frac{M}{N_{\\mathrm{p}}}-1\\right\\rceil$} \n\t\\ParFor{$b=1:\\min({N_{\\mathrm{p}},M-aN_{\\mathrm{p}}})$}\n\t\\State{$m \\coloneqq aN_{\\mathrm{p}}+b$}\n\t\\ForAll{basis directions $\\bm{v}_{i}$} \n\t\\State \\parbox[t]{\\dimexpr\\linewidth-\\algorithmicindent}{\n\t$R_{m}(i) \\coloneqq \\sum\\limits_{n\\in\n          \\mathcal{N}_{m}}w_{m,n}\\max\\limits_{j=1,\\ldots,W_{n}} |\\bm{v}_{i}\\cdot \\bm{w}_{n,j}|$} \n\t\\EndFor\n\t\\State \\parbox[t]{\\dimexpr\\linewidth-\\algorithmicindent}{\n\t$\\{\\bm{u}_{m,p}\\}_{p=1}^{U_{m}} \\coloneqq \\{\\bm{v}_{i}| \\forall\\:i' \\neq i \\mbox{ s.t. }\nR_{m}(i)\\geq R_{m}(i') \\mbox{ and } \\arccos(|\\bm{v}_{i}\\cdot\\bm{v}_{i'}|)\\leq\n\\frac{\\pi}{180^\\circ}\\theta_{R} \\}$}\n\t\\For{$i=1:N$} \n\t\\State \\parbox[t]{\\dimexpr\\linewidth-\\algorithmicindent}{$C_{m,i} \\coloneqq {\\scriptstyle \\left(1 - \\alpha\\max\\limits_{p=1,\\ldots,U_{m}}|\\bm{v}_{i}\\cdot \\bm{u}_{m,p}|\\right)\\Big/\\left(\\min\\limits_{q=1,\\ldots,N}\\left(1 - \\alpha\\max\\limits_{p=1,\\ldots,U_{m}}|\\bm{v}_{q}\\cdot \\bm{u}_{m,p}|\\right)\\right)}$}\n\t\\EndFor\n\t\\State{Solve Eq.~(\\ref{equ:bcd2}) to obtain $\\hat{\\bm{f}}_{m}^{t}$}\n\t\\State{$\\bm{f}_{m} \\coloneqq \\hat{\\bm{f}}_{m}^{t}/||\\hat{\\bm{f}}_{m}^{t}||_{1}$}\n\t\\EndParFor\n\t\\For{$b=1:\\min({N_{\\mathrm{p}},M-aN_{\\mathrm{p}}})$}\n\t\\State{$m \\coloneqq aN_{\\mathrm{p}}+b$}\n\t\\State{$\\mathcal{W}_{m} \\coloneqq \\{\\bm{v}_{i}|f_{m,i} > f_{\\mathrm{th}}, i=1,\\ldots,N\\}$}\n\t\\EndFor\n\t\\EndFor\n\t\\State{$t \\coloneqq t+1$ \\textbf{until convergence}}\n\t\\EndWhile\n\t\\State{\\textbf{return} $\\{\\bm{f}_{m}\\}_{m=1}^{M}$ and $\\{\\mathcal{W}_{m}\\}_{m=1}^{M}$}\n\t\\end{algorithmic}\n\t\\end{spacing}\n\t\n\\end{algorithm}\n\n\n\\section{Experiments}\n\\label{sec:exp}\n\nFORNI was evaluated first on a digital crossing phantom, then on\n\\textit{ex vivo} tongue dMRI data from one subject, and finally on an\n\\textit{in vivo} brain dMRI dataset comprising six subjects. FORNI was\nalso compared to the SHORE algorithm~\\citep{merlet2013} which estimates the ensemble average propagator and orientation distribution function using the SHORE basis~\\citep{cheng2011}, the constrained spherical deconvolution (CSD) algorithm~\\citep{tournier2} which introduces a nonnegative constraint on the spherical harmonics framework, the CFARI algorithm that estimates the FOs using a voxelwise sparse reconstruction~\\citep{landman}, and an FO estimation algorithm (L2L0NW)~\\citep{auria} that uses structured sparsity to enforce smooth FO estimation.In the experiments on the tongue dMRI data, we have also compared our method with the FIEBR algorithm~\\citep{CMIG} that is designed for the tongue to improve FO estimation by using atlas information. In the experiments on brain dMRI, because multiple $b$-values were used to acquire the brain dMRI data, the CSD algorithm was\nreplaced by generalized $q$-sampling imaging (GQI)~\\citep{gqi} which\ncan reconstruct FOs using multi-shell dMRI. SHORE and CSD are implemented using the Dipy software~\\citep{DIPY} (\\url{http://nipy.org/dipy/documentation.html}); CFARI is implemented in the JIST software framework~\\citep{lucas}; GQI is implemented in the DSI Studio software~(\\url{http://dsistudio.labsolver.org/Manual/Reconstruction}); and L2L0NW was performed using the code provided by its authors at \\url{https://github.com/basp-group/co-dmri}.\n\n\\subsection{3D Digital Crossing Phantom}\n\n\\begin{figure}[t]\n\\centering\n   \\includegraphics[width=0.7\\linewidth]{phantom_v4.png}\n\\caption[]{A 3D rendering of the simulated tracts.} \n\\label{fig:phantom}\n\\end{figure}\n\n\\begin{figure}[!t]\n\\centering\n   \\includegraphics[width=0.95\\linewidth]{phantom_fo.png}\n\\caption[]{\nGround truth FOs overlaid on the map indicating the number of FOs at each voxel. The FOs in the $z$-direction are shown in a coronal view. The regions highlighted by the dashed boxes are later zoomed in for qualitative evaluation in Figure~\\ref{fig:phantom_fo_all}. The visualization of FOs was created in FSLView~\\citep{FSL}.} \n\\label{fig:phantom_fo}\n\\end{figure}\n\nA 3D digital crossing phantom was generated to simulate five fiber tracts (see Figure~\\ref{fig:phantom}), where one $b0$ image and 60 gradient directions ($b=1000\\,\\mathrm{s}/\\mathrm{mm}^{2}$) were used. A two-tensor/three-tensor model was used to create the simulated\ndiffusion signals for regions with two/three crossing tracts.\nRician noise with different \\textit{signal-to-noise ratio} (SNR) ($\\mathrm{SNR}=10$, $20$, and $30$) on the $b0$ image was added to the \\textit{diffusion weighted images} (DWIs).\n\nFORNI (with $\\alpha=0.8$, $\\beta=0.5$, and $\\mu=3.0$) was applied and compared\nwith SHORE~\\citep{merlet2013}, CSD~\\citep{tournier2}, CFARI~\\citep{landman}, L2L0NW~\\citep{auria}, and the ground truth. \nThe ground truth FOs are shown in Figure~\\ref{fig:phantom_fo}. Because the FOs in the $z$-direction are not visible in the axial view, the regions containing these FOs are also shown in the coronal view.\nA qualitative evaluation of FO estimation is shown in Figure~\\ref{fig:phantom_fo_all} using the results at $\\mathrm{SNR}=20$ in the highlighted regions in Figure~\\ref{fig:phantom_fo}. The FOs are color-coded by the standard DTI color scheme (red: left--right; green: front--back; and blue:\nup--down)~\\citep{pajevic} and overlaid on the map indicating the number of ground truth FOs at each voxel. \nWe can see that FORNI produces smooth FOs compared with SHORE, CSD, and CFARI which perform voxelwise FO\nestimation. \nIn the regions (highlighted by the orange box in Figures~\\ref{fig:phantom_fo} and \\ref{fig:phantom_fo_all}) containing three crossing tracts, both L2L0NW and FORNI are able to better recover the crossing patterns than SHORE, CSD, and CFARI.\nIn addition, FORNI does not produce false positive FOs (see the white boxes in Figure~\\ref{fig:phantom_fo_all}) as in the results of L2L0NW when the neighbor information is used.\n\n\\begin{figure}[!t]\n\\centering\n   \\includegraphics[width=0.85\\linewidth]{phantom_fo_all.png}\n\\caption[]{FO estimation results overlaid on the map indicating the number of ground truth FOs at each voxel at $\\mathrm{SNR}=20$ in the regions highlighted in Figure~\\ref{fig:phantom_fo}. Note the white boxes where L2L0NW produces false positive FOs. The visualization of FOs was created in FSLView~\\citep{FSL}.} \n\\label{fig:phantom_fo_all}\n\\end{figure}\n\nTo quantitatively evaluate the results, we define a voxelwise error measure of FOs in degrees:\n\n", "index": 7, "text": "\\begin{equation}\ne_{\\mathrm{FO}} = \\max\\left(\\frac{1}{N_{1}}\\sum_{i=1}^{N_{1}}\n\\min\\limits_{j} \n\\arccos (|\\bm{w}_{i}\\cdot \\bm{u}_{j}|),\n\\frac{1}{N_2} \\sum\\limits_{j=1}^{N_{2}} \n\\min\\limits_{i} \n\\arccos (|\\bm{w}_{i}\\cdot \\bm{u}_{j}|)\\right) \n\\cdot \\frac{180^{\\circ}}{\\pi}.\n\\label{eq:eFOdef}\n\\end{equation}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E4.m1\" class=\"ltx_Math\" alttext=\"e_{\\mathrm{FO}}=\\max\\left(\\frac{1}{N_{1}}\\sum_{i=1}^{N_{1}}\\min\\limits_{j}%&#10;\\arccos(|\\bm{w}_{i}\\cdot\\bm{u}_{j}|),\\frac{1}{N_{2}}\\sum\\limits_{j=1}^{N_{2}}%&#10;\\min\\limits_{i}\\arccos(|\\bm{w}_{i}\\cdot\\bm{u}_{j}|)\\right)\\cdot\\frac{180^{%&#10;\\circ}}{\\pi}.\" display=\"block\"><mrow><mrow><msub><mi>e</mi><mi>FO</mi></msub><mo>=</mo><mrow><mrow><mi>max</mi><mo>\u2061</mo><mrow><mo>(</mo><mrow><mfrac><mn>1</mn><msub><mi>N</mi><mn>1</mn></msub></mfrac><mo>\u2062</mo><mrow><munderover><mo largeop=\"true\" movablelimits=\"false\" symmetric=\"true\">\u2211</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>N</mi><mn>1</mn></msub></munderover><mrow><munder><mi>min</mi><mi>j</mi></munder><mo>\u2061</mo><mrow><mi>arccos</mi><mo>\u2061</mo><mrow><mo stretchy=\"false\">(</mo><mrow><mo stretchy=\"false\">|</mo><mrow><msub><mi>\ud835\udc98</mi><mi>i</mi></msub><mo>\u22c5</mo><msub><mi>\ud835\udc96</mi><mi>j</mi></msub></mrow><mo stretchy=\"false\">|</mo></mrow><mo stretchy=\"false\">)</mo></mrow></mrow></mrow></mrow></mrow><mo>,</mo><mrow><mfrac><mn>1</mn><msub><mi>N</mi><mn>2</mn></msub></mfrac><mo>\u2062</mo><mrow><munderover><mo largeop=\"true\" movablelimits=\"false\" symmetric=\"true\">\u2211</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>N</mi><mn>2</mn></msub></munderover><mrow><munder><mi>min</mi><mi>i</mi></munder><mo>\u2061</mo><mrow><mi>arccos</mi><mo>\u2061</mo><mrow><mo stretchy=\"false\">(</mo><mrow><mo stretchy=\"false\">|</mo><mrow><msub><mi>\ud835\udc98</mi><mi>i</mi></msub><mo>\u22c5</mo><msub><mi>\ud835\udc96</mi><mi>j</mi></msub></mrow><mo stretchy=\"false\">|</mo></mrow><mo stretchy=\"false\">)</mo></mrow></mrow></mrow></mrow></mrow><mo>)</mo></mrow></mrow><mo>\u22c5</mo><mfrac><msup><mn>180</mn><mo>\u2218</mo></msup><mi>\u03c0</mi></mfrac></mrow></mrow><mo>.</mo></mrow></math>", "type": "latex"}]