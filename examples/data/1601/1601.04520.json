[{"file": "1601.04520.tex", "nexttext": " \n\\item there are $e_1,e_2,f \\in {\\mathscr C}$ and $m \\in {\\mathbb N}$ such that\n\n", "itemtype": "equation", "pos": -1, "prevtext": "\n\n\\maketitle\n\\begin{abstract}\nMany natural decision problems can be formulated as constraint satisfaction problems\nfor reducts of finitely bounded homogeneous structures.\nThis class of problems is a large generalisation of the class of CSPs over finite domains.\nOur first result is a general polynomial-time reduction\nfrom such infinite-domain CSPs to finite-domain CSPs. \nWe use this reduction to obtain new powerful polynomial-time tractability conditions\nthat can be expressed in terms of topological polymorphism clones. \nMoreover, we study the \nsubclass $\\mathcal C$ of CSPs for structures that are first-order\ndefinable over equality with parameters. Also this class $\\mathcal C$ properly\nextends the class of all finite-domain CSPs. We formulate\na tractability conjecture for $\\mathcal C$ and show that it is equivalent\nto the finite-domain tractability conjecture. In our proof we develop\nnew algebraic techniques that help to prove continuity\nfor certain clone homomorphisms needed for showing hardness. \n\\end{abstract}\n\n\\section{Introduction}\nMany computational problems in various areas of theoretical computer science can be formulated as \\emph{constraint satisfaction problems (CSPs)}. Constraint satisfaction problems where the variables take values from a finite domain are reasonably well understood with respect to their computational complexity. \nThe Feder-Vardi dichotomy conjecture for finite domain CSPs, which states that every finite-domain CSP is either in P or NP-complete, is still open, but there is a stronger \\emph{tractability conjecture}~\\cite{JBK}\nwhich provides an effective characterisation of those finite-domain CSPs that are NP-complete, and those that are conjectured to be in P. The tractability conjecture has been confirmed in many special cases: \n\\begin{itemize}\n\\item for finite structures on domains of size two~\\cite{Schaefer} and three~\\cite{Bulatov},\n\\item for finite undirected graphs~\\cite{HellNesetril} and finite directed graphs without sources and sinks~\\cite{BartoKozikNiven}. \n\\end{itemize}\nThe strongest complexity classification results\nhave been obtained using concepts and results from universal algebra. The universal-algebraic approach can also be applied to classify the complexity of some classes of CSPs over infinite domains. \nThis approach works particularly well if  \nthe constraints can be defined over a homogeneous structure with finite relational signature. The class of CSPs that can be formulated in this way is a considerable extension of the class of CSPs over finite domains, and captures many computational problems that have been studied in various research areas. For example, almost all CSPs studied in qualitative temporal and spatial reasoning belong to this class. \n\nThe class of CSPs where the\nconstraints can be defined over \n$({\\mathbb Q};<)$ has been classified~\\cite{tcsps-journal}.\nAlso constraint\nlanguages definable over \nthe random graph~\\cite{BodPin-Schaefer-both} or over  homogeneous tree-like structures~\\cite{Phylo-Complexity}\nhave been classified. These results were\nobtained by using a generalisation of the universal-algebraic approach from finite-domain CSPs, and structural Ramsey theory. \nHowever, it would be desirable to go further and to \nreduce complexity\nclassification tasks for CSPs over infinite domains \nto the rather more advanced classification results that\nare known (or have been conjectured) for finite-domain CSPs. \n\nIn this paper, we present a first result in this direction. \nWe study structures that \nhave been called \\emph{first-order definable structures with atoms}~\\cite{locally-finite}\n\nwhich recently attracted attention in automata theory\nas a natural class of infinite structures with finite descriptions; see \\cite{DBLP:conf/lics/BojanczykKLT13,KlinLOT14-short,DBLP:journals/corr/BojanczykKL14}, and references therein. In the\ncontext of constraint satisfaction problems they were first studied in~\\cite{locally-finite}, where the authors focussed on structures that are additionally \\emph{locally finite}, a very strong\nrestriction that is not needed for our approach. \n\n\n\\vspace{.2cm}\n\nWe now state our results in more detail. \nLet $\\mathbb A$ be a structure with a finite relational signature. Then \nthe constraint satisfaction problem for $\\mathbb A$, denoted by ${\\operatorname{CSP}}(\\mathbb A)$, is the following computational problem: \\\\\n{\\bf Input.} A conjunction $\\phi = \\phi_1 \\wedge \\cdots \\wedge \\phi_m$ of atomic formulas over the signature of ${\\mathbb A}$. \\\\\n{\\bf Question.} Is $\\phi$ satisfiable in ${\\mathbb A}$?\n\n\\vspace{.2cm}\n\nAn example of a problem that can be formulated\nin this way is the three-colouring problem, \nwhich can be formulated as ${\\operatorname{CSP}}({\\mathbb A})$\nwhere the domain $A$ of ${\\mathbb A}$ has size three\nand the signature contains a single binary relation \nthat denotes the inequality relation $\\neq$ on $A$. \nIn order to answer whether a given finite graph $G$ is 3-colourable, each edge $\\{u,v\\}$ of $G$\nwill be represented by a constraint of the form $u \\neq v$. \nThe graph is 3-colourable if and only if the corresponding system of constraints has a solution. \n\nAnother example is the problem to decide whether a given set of constraints of the form $x=y$ or of the form $x \\neq y$ has a solution\n(over any domain). This can be formulated as \n${\\operatorname{CSP}}({\\mathbb A})$ where\n\nthe domain of ${\\mathbb A}$ \nis any countably infinite set $A$, \nand $=$ and $\\neq$ denote the usual equality and inequality relation on $A$. Clearly, this problem\ncannot be formulated as ${\\operatorname{CSP}}({\\mathbb B})$ for a \nstructure ${\\mathbb B}$ over a finite domain. \n\nWe study the computational complexity \nof ${\\operatorname{CSP}}({\\mathbb A})$\nfor the class of structures ${\\mathbb A}$ that have a countably infinite domain $A$ and a finite relational signature such that all relations\nin ${\\mathbb A}$ have a first-order definition using\nequality and constants from $A$. \n\n\n This class (properly) generalises the class of constraint satisfaction problems over finite domains. \nOne of our main results is the following.\n\n\\begin{thm}\\label{thm:main}\nIf the tractability conjecture for finite-domain CSPs is true, then every CSP for a structure that is\nfirst-order definable over a countable set using equality and constants is in P or NP-complete. \n\n\n\\end{thm}\n\nIn fact, we prove a stronger result: \nwe provide a tractability conjecture for \nour class of CSPs, and prove that our conjecture \nis equivalent to the tractability conjecture\nfor finite domains. \nIn contrast to the three classification results for infinite-domain CSPs mentioned above~\\cite{tcsps-journal,BodPin-Schaefer-both,Phylo-Complexity}, which involve many case distinctions, we reduce all the combinatorial work to the situation in the finite via purely conceptual arguments, building on various recent general results about topological clones~\\cite{BPT-decidability-of-definability,BPP-projective-homomorphisms,wonderland}. \n\n\n\\vspace{.2cm}\n\n\n\n\nThe class of CSPs studied here \n\nis a subclass of \n\nalmost any more ambitious classification project for infinite-domain CSPs.\nWe give some examples. \n\n\\begin{enumerate}\n\\item We have already mentioned that our structures \nare \\emph{structures definable with atoms} in the sense of~\\cite{locally-finite}; this class of structures \nappeared under various different names in various different contexts (Fraenkel-Mostowski models, nominal sets, permutation models) and has not yet been studied systematically from the CSP viewpoint. \n\\item An important class of infinite structures \nthat have finite representations and \nwhere the universal-algebraic approach can be applied\nis the class of \n\\emph{finitely bounded homogeneous structures},\nand more generally structures that can be defined over finitely bounded homogeneous structures. For details we have to refer to Section~\\ref{sect:csps}; there, we also show that our class is a subclass. In fact,\nsome of our results (e.g., Theorem~\\ref{thm:types-tractable-implies-structure-tractable} and Theorem~\\ref{thm:canonical-datalog}) hold in this general setting. \n\n\\item Many CSPs that are of special interest in computer science and mathematics are formulated over classical structures such as the integers, the rationals, or the reals. \nSome first partial classifications are available also for such CSPs~\\cite{BodMarMot,Essentially-convex,HornOrFull,JonssonThapper15}. The natural question here is whether we can \nclassify the CSP for all structures that are definable\nover $({\\mathbb Z};+,1,\\leq)$, that is, for fragments of Presburger arithmetic, or for all structures that are definable\nover $({\\mathbb Q};+,1,\\leq)$ or even $({\\mathbb R};+,\\times,1)$. Note that infinitely many constants are \ndefinable in these structures, and that trivially \nour class will appear as a subclass of these large classes of problems. \n\n\n\\item It is natural to ask for the classification of the\nCSP for all structures that are\n\\emph{first-order interpretable} (in the model theoretic sense) over a fixed infinite structure (for example, over $({\\mathbb N},=)$ or over $({\\mathbb Q};<)$). \nEven if the interpretation is without parameters, such a class necessarily allows to formulate all the CSPs that will be considered in this paper (the reason is that with respect to the CSP, constants in first-order definitions can be simulated with interpretations of appropriately chosen dimension).\n\n\\end{enumerate}\n\nTheorem~\\ref{thm:main} is based \non a universal-algebraic result \nof independent interest that generalises the cyclic term theorem\nof Barto and Kozik~\\cite{Cyclic} and can be stated \nwithout reference to the CSP and to computational\ncomplexity (Section~\\ref{sect:mashups}). We write $\\pi_i^m$ \nfor the $m$-ary projection\nto the $i$-th argument. \n\n\\begin{thm}\\label{thm:ua-result}\n\nLet ${{\\mathscr C}}$ be a closed function clone on a countably\ninfinite domain $A$ such that the unary operations\n in ${{\\mathscr C}}$ are precisely the injective functions\n that preserve $a_1,\\dots,a_n \\in A$, for some $n \\in {\\mathbb N}$. \nThen exactly one of the following holds:\n\\begin{itemize}\n\\item there is a continuous map $\\xi$ from ${{\\mathscr C}}$ to\nthe clone of projections on a two-element set such that\nfor all $e,f \\in {{\\mathscr C}}$, $m \\in {\\mathbb N}$, and $i_1,\\dots,i_k \\in \\{1,\\dots,m\\}$ \n\n", "index": 1, "text": "$$\\xi \\big(e \\circ f \\circ (\\pi_{i_1}^m,\\dots,\\pi_{i_k}^m) \\big) = \\xi(f)\\circ(\\pi_{i_1}^m,\\dots,\\pi_{i_k}^m) \\, ;$$\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex1.m1\" class=\"ltx_Math\" alttext=\"\\xi\\big{(}e\\circ f\\circ(\\pi_{i_{1}}^{m},\\dots,\\pi_{i_{k}}^{m})\\big{)}=\\xi(f)%&#10;\\circ(\\pi_{i_{1}}^{m},\\dots,\\pi_{i_{k}}^{m})\\,;\" display=\"block\"><mrow><mrow><mrow><mi>\u03be</mi><mo>\u2062</mo><mrow><mo maxsize=\"120%\" minsize=\"120%\">(</mo><mrow><mi>e</mi><mo>\u2218</mo><mi>f</mi><mo>\u2218</mo><mrow><mo stretchy=\"false\">(</mo><msubsup><mi>\u03c0</mi><msub><mi>i</mi><mn>1</mn></msub><mi>m</mi></msubsup><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msubsup><mi>\u03c0</mi><msub><mi>i</mi><mi>k</mi></msub><mi>m</mi></msubsup><mo stretchy=\"false\">)</mo></mrow></mrow><mo maxsize=\"120%\" minsize=\"120%\">)</mo></mrow></mrow><mo>=</mo><mrow><mrow><mi>\u03be</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>f</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2218</mo><mrow><mo stretchy=\"false\">(</mo><msubsup><mi>\u03c0</mi><msub><mi>i</mi><mn>1</mn></msub><mi>m</mi></msubsup><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msubsup><mi>\u03c0</mi><msub><mi>i</mi><mi>k</mi></msub><mi>m</mi></msubsup><mo rspace=\"4.2pt\" stretchy=\"false\">)</mo></mrow></mrow></mrow><mo>;</mo></mrow></math>", "type": "latex"}, {"file": "1601.04520.tex", "nexttext": "\n\\end{itemize} \n\\end{thm}\n\nOur strategy to prove Theorem~\\ref{thm:main} is then as follows: we first reduce the task to the situation \nthat the polymorphism clone of the structure ${\\mathbb A}$ under consideration satisfies the assumptions of Theorem~\\ref{thm:ua-result} (in Section~\\ref{sect:lift}).\nIf the first case of this theorem applies, hardness of the CSP follows from general principles~\\cite{wonderland}. \nIf the second case applies, we associate to ${\\mathbb A}$ a structure over a finite domain, show that if the tractability conjecture is true then this structure\nhas a polynomial-time tractable CSP, and finally\nprove that ${\\operatorname{CSP}}({\\mathbb A})$ reduces to this finite-domain CSP. \n\nOur reduction from infinite-domain CSPs to finite-domains CSPs is very general, and another main contribution of this paper (Section~\\ref{sect:csps}). All that is needed here is that ${\\mathbb A}$ is finitely bounded. For structures ${\\mathbb A}$ that can be defined over finitely bounded homogeneous structures, the same reduction also yields new powerful tractability conditions, formulated in terms of the topological polymorphism clone of ${\\mathbb A}$, using\nknown (unconditional) tractability conditions known for finite-domain constraint satisfaction (in Section~\\ref{sect:tractability-conditions}).\n\n\\section{Notation}\n\\label{sect:notation}\nWe denote the set $\\{1,\\dots,n\\}$ by $[n]$.\nA \\emph{signature} $\\tau$ is a set of function symbols and\nrelation symbols, \nwhere each symbol symbol is associated with a natural number, called its \\emph{arity}.\nA \\emph{$\\tau$-structure} ${\\mathbb A}$ is a tuple\n$(A; (Z^{\\mathbb A})_{Z\\in\\tau})$ such that:\n\\begin{itemize}\n    \\item $Z^{\\mathbb A}\\subseteq A^k$ if $Z$ is a relation symbol of arity $k$, and\n    \\item $Z^{\\mathbb A}\\colon A^k\\to A$ if $Z$ is a function symbol of arity $k$. Function symbols of arity $0$ are called \\emph{constant symbols}.\n\\end{itemize}\nLet ${\\mathbb A},{\\mathbb B}$ be $\\tau$-structures with $B\\subseteq A$. ${\\mathbb B}$ is a \\emph{substructure} of ${\\mathbb A}$\nif:\n\\begin{itemize}\n    \\item for every $R_i\\in\\tau$ of arity $k$, $R_i^{\\mathbb B} = R_i^{\\mathbb A}\\cap B^k$, and\n    \\item for every function symbol $f_i\\in\\tau$ of arity $k$, $f_i^{\\mathbb B}={{f_i^{\\mathbb A}}|_{{B}}}$.\n\\end{itemize}\n\nA \\emph{homomorphism} between two structures ${\\mathbb A},{\\mathbb B}$ with the same signature $\\tau$ is a function $h\\colon A\\to B$\nsuch that $(a_1,\\dots,a_k)\\in R^{\\mathbb A}\\Rightarrow (h(a_1),\\dots,h(a_k))\\in R^{\\mathbb B}$ for every relation symbol $R\\in\\tau$, and such that $h(f^{\\mathbb A}(a_1,\\dots,a_k)) = f^{\\mathbb B}(h(a_1),\\dots,h(a_k))$ if $f\\in\\tau$ is a function symbol.\nWhen $h\\colon A\\to A$ is a homomorphism from ${\\mathbb A}$ to itself we say that $h$ is an \\emph{endomorphism}.\nAn injection function $h\\colon A\\to B$ is an \\emph{embedding} if we have $(a_1,\\dots,a_k)\\in R^{\\mathbb A}\\Leftrightarrow (h(a_1),\\dots,h(a_k))\\in R^{\\mathbb B}$.\nA surjective embedding is called an \\emph{isomorphism}, and an \\emph{automorphism} when ${\\mathbb A}$ equals ${\\mathbb B}$.\nLet ${\\mathbb A}$ be a relational $\\tau$-structure (that is, $\\tau$ only contains relation symbols).\nA function $h\\colon A^k\\to A$ is a \\emph{polymorphism} of ${\\mathbb A}$\nif for every $n\\in{\\mathbb N}$, every symbol $R\\in\\tau$ of arity $n$,\nand for all $n$-tuples ${\\mathbf a}^1,\\dots,{\\mathbf a}^n$ in $R$,\nwe have that $h({\\mathbf a}^1,\\dots,{\\mathbf a}^n)$ is in $R$,\nwhere $h$ is applied componentwise.\nWe write ${\\operatorname{Aut}}({\\mathbb A}),{\\operatorname{End}}({\\mathbb A}),{\\operatorname{Pol}}({\\mathbb A})$ for the sets of automorphisms,\nendomorphisms, and polymorphisms of ${\\mathbb A}$. \n\nLet ${\\mathbb A},{\\mathbb B}$ be two structures over the same domain, and suppose that ${\\mathbb A}$ has a relational signature.\n${\\mathbb A}$ is called a \\emph{reduct} of ${\\mathbb B}$ if all the relations of ${\\mathbb A}$ are definable by first-order formulas in ${\\mathbb B}$.\n\n\\section{Finitely Bounded Homogeneous Structures}\n\\label{sect:csps}\n    The \\emph{age} of a structure ${\\mathbb A}$, denoted by ${\\operatorname{Age}}({\\mathbb A})$, is the class of all the finitely\n    generated structures that embed into ${\\mathbb A}$.\nA \\emph{bound} of a class $\\mathcal C$ of structures \nover a fixed finite signature $\\tau$ is a finite\nstructure that does not embed into a structure\nfrom $\\mathcal C$, and that is minimal with this property (with respect to embeddability). \nA class of structures is called \\emph{finitely bounded} \nif it has finitely many bounds up to isomorphism. \nNote that an age is finitely bounded if and only if\nit has a \\emph{finite universal axiomatisation}, that is,\nthere exists a universal first-order sentence $\\phi$\nsuch that ${\\mathbb B} \\in \\mathcal C$ iff ${\\mathbb B} \\models \\phi$. \nA structure is called \n\\emph{finitely bounded} if its age is. \nThe constraint satisfaction problem of a structure might be undecidable in general. \nBut the CSP of a finitely bounded relational structure is in NP. \n\nA structure ${\\mathbb A}$ is said to be \\emph{homogeneous} if every isomorphism between\nfinitely generated substructures of ${\\mathbb A}$ can be extended to an automorphism of ${\\mathbb A}$.\nExamples of homogeneous structures are $({\\mathbb N};=)$ and $({\\mathbb Q}; <)$.\nObserve that expansions of homogeneous structures by constants are again homogeneous. \nReducts of homogeneous structures with finite relational signature, possibly also with finitely many constants,\nare examples of \\emph{$\\omega$-categorical} structures: a structure ${\\mathbb A}$ is $\\omega$-categorical\nif for every positive integer $m$, the natural action of ${\\operatorname{Aut}}({\\mathbb A})$ on $A^m$ has finitely many orbits.\n\n\\begin{proposition}\\label{prop:fin-bound}\nSuppose that ${\\mathbb A}$ is a finitely \nbounded homogeneous structure.\nAny expansion $({\\mathbb A};c^{{\\mathbb A}})$ of ${\\mathbb A}$ by a constant is homogeneous and finitely bounded, too. \n\\end{proposition}\n\\begin{proof}\nLet $\\tau$ be the signature of ${\\mathbb A}$.\nThe structure $({\\mathbb A};c^{{\\mathbb A}})$ is clearly\nhomogeneous. \nLet ${\\mathcal G}$ be the finite set of bounds\nof ${\\mathbb A}$, and \nlet $n$ be the maximal size of the structures in $\\mathcal G$. Define ${\\mathcal F}'$ to be the set of $(\\tau\\cup\\{c\\})$-structures on $n+1$ elements\nwhose $\\tau$-reduct embeds some structure in $\\mathcal G$. Let ${\\mathbb A}_c$ be the structure generated by $c^{{\\mathbb A}}$ \nin ${\\mathbb A}$; note that ${\\mathbb A}_c$ is finite. \nWe write $\\mathcal F$ for the union of $\\mathcal F'$ \nwith the set of \n$(\\tau\\cup\\{c\\})$-structures of size $|{\\mathbb A}_c|$\nthat are not isomorphic to ${\\mathbb A}_c$. Clearly, \n$\\mathcal F$ contains only finitely many structures up to isomorphism. To show that $({\\mathbb A};c^{{\\mathbb A}})$ is finitely bounded, it therefore suffices to show that \n$\\mathcal F$ contains the bounds of $({\\mathbb A};c^{{\\mathbb A}})$.\n\nWe first show that no structure in $\\mathcal F$ embeds\ninto $({\\mathbb A};c^{{\\mathbb A}})$. This is obvious for \nthe $(\\tau \\cup \\{c\\})$-structures in $\\mathcal F$\nof size $|{\\mathbb A}|_c$ that are not isomorphic to ${\\mathbb A}_c$. \nNow suppose for contradiction that \nthere is an embedding $e$ of  \n$({\\mathbb F},c^{\\mathbb F}) \\in \\mathcal F'$ into $({\\mathbb A},c^{{\\mathbb A}})$. By definition of $\\mathcal F'$,  \nthe structure $\\mathbb F$ embeds some $\\mathbb G\\in\\mathcal G$. By composing the embeddings, we obtain an embedding of $\\mathbb G$ into ${\\mathbb A}$, a contradiction\nto the choice of $\\mathcal G$.\n\n\nLet $({\\mathbb B},c^{{\\mathbb B}})$ \nbe a $(\\tau\\cup\\{c\\})$-structure such that \nno structure from $\\mathcal F$\nembeds into \n$({\\mathbb B},c^{{\\mathbb B}})$. We have to show that $({\\mathbb B},c^{{\\mathbb B}})$ embeds into $({\\mathbb A},c^{{\\mathbb A}})$. \nSince no structure from $\\mathcal F'$\nembeds into $({\\mathbb B},c^{{\\mathbb B}})$, no $\\mathbb G\\in \\mathcal G$ embeds into ${\\mathbb B}$. \nHence, by the definition of $\\mathcal G$, there exists an embedding $e$ of ${\\mathbb B}$ into ${\\mathbb A}$.\nMoreover, the structure generated by $c^{\\mathbb B}$ in ${\\mathbb B}$ must be isomorphic to the structure generated by $c^{{\\mathbb A}}$ in ${\\mathbb A}$.\nBy the homogeneity of ${\\mathbb A}$ there exists an automorphism $\\alpha$ of ${\\mathbb A}$ that maps $e(c^{\\mathbb B})$ to $c^{{\\mathbb A}}$.\nIt follows that $\\alpha \\circ e$ is a embedding of \n${\\mathbb B}$ into ${\\mathbb A}$ that maps $c^{\\mathbb B}$ to $c^{{\\mathbb A}}$,\ni.e., $\\alpha\\circ e$ is an embedding of $({\\mathbb B},c^{{\\mathbb B}})$\ninto $({\\mathbb A};c^{{\\mathbb A}})$.\n\\end{proof}\n\n    The \\emph{type of a tuple $(b_1,\\dots,b_m)$}, also called an \\emph{$m$-type}\\footnote{All types considered here are complete types in the sense of model theory, so we write `type' instead of `complete type'.} in ${\\mathbb B}$, is \n    the set of all first-order formulas\n    $\\phi(z_1,\\dots,z_m)$ such that\n    ${\\mathbb B} \\models \\phi(b_1,\\dots,b_m)$. \n   If ${\\mathbb B}$ is $\\omega$-categorical, then \n    there are only finitely many $m$-types in ${\\mathbb B}$\n    (they correspond to the orbits of ${\\operatorname{Aut}}({\\mathbb B})$ on $A^m$; see, e.g., ~\\cite{Hodges}). \n\n    Let $m$ be a positive integer.\n    We define $T_{{\\mathbb B},m}({\\mathbb A})$ to be the structure whose domain is the \n    set of $m$-types of ${\\mathbb B}$\n    and whose relations are as follows. \n    \\begin{itemize}\n        \\item for each symbol $R$ of ${\\mathbb A}$ of arity $r$, \n        let $\\chi(z_1,\\dots,z_r)$ \n        be a definition of $R$ in ${\\mathbb B}$. For\n        $i \\colon [r] \\to [m]$ \n        we write $\\langle \\chi(z_{i(1)},\\dots,z_{i(r)})\\rangle$ \n        for the unary relation that consists of all the types \n        that contain $\\chi(z_{i(1)},\\dots,z_{i(r)})$,\n        and add all such relations to ${T_{\\mB,m}}({\\mathbb A})$. \n\n        \\item for each $r \\in [m]$ and \n        $i,j \\colon [r] \\to [m]$, \n        define ${\\operatorname{Comp}}_{i,j}$ to be the binary relation that contains\n        the pairs $(p,q)$ of $m$-types such that \n        for every first-order formula $\\chi(z_1,\\dots,z_s)$ of ${\\mathbb B}$ with $s$ free variables,\n        and $t \\colon [s] \\to [r]$, \n        the formula $\\chi(z_{it(1)},\\dots,z_{it(s)})$ is in $p$ iff $\\chi(z_{jt(1)},\\dots,z_{jt(s)})$ is in $q$.\n    \\end{itemize}\n    Note that if $(a_1,\\dots,a_m)$ is of type $p$ and $(b_1,\\dots,b_m)$ of type $q$,\n\tthen ${\\operatorname{Comp}}_{i,j}(p,q)$ holds if and only if\n    $(a_{i(1)},\\dots,a_{i(r)})$ and\n    $(b_{j(1)},\\dots,b_{j(r)})$ have the same type\n    in ${\\mathbb B}$.\n\n\n The next theorem holds for arbitrary finitely bounded homogeneous structures ${\\mathbb B}$ (which might also have functions);\n if ${\\mathbb B}$ is additionally $\\omega$-categorical,\n then the theorem provides a reduction from the CSPs \n of reducts of ${\\mathbb B}$ to finite-domain CSPs. \n \n\\begin{thm}\\label{thm:types-tractable-implies-structure-tractable}\n\t\tLet ${\\mathbb A}$ be a finite-signature \n\t\treduct of a finitely bounded homogeneous structure \n\t\t${\\mathbb B}$. \n        Let $m_a$ be the maximal arity of a relation in ${\\mathbb A}$ or ${\\mathbb B}$,\n        and $m_b$ be the maximal size of a bound for ${\\mathbb B}$.\n        Let $m$ be at least $\\max(m_a,m_b,3)$.\n        Then there is a polynomial-time reduction\n        from ${\\operatorname{CSP}}({\\mathbb A})$ to ${\\operatorname{CSP}}({T_{\\mB,m}}({\\mathbb A}))$. \n\\end{thm}\n\\begin{proof}\n\t\tWe show that ${\\operatorname{CSP}}({\\mathbb A})$ reduces \n\t\tin polynomial-time to ${\\operatorname{CSP}}({T_{\\mB,m}}({\\mathbb A}))$.\n\t\tLet \n\t\t$\\Psi$ be an instance of ${\\operatorname{CSP}}({\\mathbb A})$\n\t\twith variables $x_1,\\dots,x_n$. \n\t\tAssume without loss of generality that\n\t\t$n \\geq m$. \n\t\tWe build an instance $\\Phi$ of ${\\operatorname{CSP}}({T_{\\mB,m}}({\\mathbb A}))$ as follows.\n\t\t\\begin{itemize}\n\t\t\t\\item The variable set of $\\Phi$ is the set\n\t\t\t$I$ of order-preserving injections from $[m]$ to $[n]$. \n            The idea of the reduction is that \n            the variable $v \\in I$ \n            of $\\Phi$ represents the type of $(h(x_{v(1)}),\\dots,h(x_{v(m)}))$\n            in a satisfying assignment $h$ for $\\Psi$. \n            \n\t\t\t\\item For each conjunct $\\psi$ of $\\Psi$ \n\t\t\twe add unary constraints to $\\Phi$ as follows. The formula $\\psi$ must be of the form $R(x_{j(1)},\\dots,x_{j(r)})$\n\t\t\twhere $R$ is a relation of ${\\mathbb A}$ and \n\t\t\t$j \\colon [r] \\to [n]$. By assumption, $R$ has a first-order definition $\\chi(z_1,\\dots,z_r)$ over ${\\mathbb B}$.\n\t\t\tLet $v \\in I$ be such that ${\\operatorname{Im}}(j) \\subseteq {\\operatorname{Im}}(v)$.  \n             Let $U$ be the relation symbol\n            of ${T_{\\mB,m}}({\\mathbb A})$ that denotes\n            the unary relation\n            $\\langle \\chi(z_{v^{-1}j(1)},\\dots,z_{v^{-1}j(r)})\\rangle$. We then add $U(v)$ to $\\Phi$. \n \n            \\item Finally, for all $u,v \\in I$ \n            let $k \\colon [r]  \\to {\\operatorname{Im}}(u) \\cap {\\operatorname{Im}}(v)$ be a bijection.  \n\t\tWe then add the constraint ${\\operatorname{Comp}}_{u^{-1}k,v^{-1}k}(u,v)$.\n\t\t\\end{itemize}\n\n        Let $a_1,\\dots,a_n$ be elements of ${\\mathbb B}$, let $\\chi(z_1,\\dots,z_r)$ be a formula\n        in the language of ${\\mathbb B}$, let $j\\colon[r]\\to[n]$,\n        and let $v$ in $I$ be such that ${\\operatorname{Im}}(j)\\subseteq{\\operatorname{Im}}(v)$.\n        We first note the following property:\n        \n        \\vspace{.2cm}\n            \\begin{tabular}{cp{0.8\\linewidth}} $(\\ddag)$ &\n                ${\\mathbb B} \\models \\chi(a_{j(1)},\\dots,a_{j(r)})$ iff $(a_{v(1)},\\dots,a_{v(m)})$ \n                satisfies $\\chi(z_{v^{-1}j(1)},\\dots,z_{v^{-1}j(r)})$\n                in ${\\mathbb B}$.\n            \\end{tabular}\n            \n        \\vspace{.2cm}\n        The property $(\\ddag)$ holds since the variable $z_i$ in the type of the tuple $(a_{v(1)},\\dots,a_{v(m)})$\n        represents the element $a_{v(i)}$, and therefore $z_{v^{-1}j(i)}$ represents $a_{j(i)}$. \n\n\t\tSuppose that $(a_1,\\dots,a_n)$ \n\t\tsatisfies \n\t\t$\\Psi$ in ${\\mathbb A}$. To show that \n\t\t$\\Phi$ is satisfiable in ${T_{\\mB,m}}({\\mathbb A})$, \n\t\tdefine $g \\colon I \\to {T_{\\mB,m}}({\\mathbb A})$ \n\t\tby setting $g(v)$ to be the type of $(a_{v(1)},\\dots,a_{v(m)})$ in ${\\mathbb B}$, for every $v \\in I$. \n\t\tTo see that all the constraints of $\\Phi$\n\t\t are satisfied\n\t\tby $g$, let \n\t\t$U(v)$ be a constraint in $\\Phi$\n\t\tthat has been introduced\n\t\tfor a conjunct \n\t\tof the form $R(x_{j(1)},\\dots,x_{j(r)})$ in $\\Psi$. \n\t\tLet $\\chi(z_1,\\dots,z_r)$ be the first-order \n\t\tformula that defines $R$ in ${\\mathbb B}$. Then\n\t\t\n", "itemtype": "equation", "pos": 10531, "prevtext": " \n\\item there are $e_1,e_2,f \\in {\\mathscr C}$ and $m \\in {\\mathbb N}$ such that\n\n", "index": 3, "text": "$$e_1 \\circ f \\circ (\\pi^m_{1},\\dots,\\pi^m_m) = e_2 \\circ f \\circ (\\pi^m_{2},\\dots,\\pi^m_{m},\\pi^m_1) \\, .$$\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex2.m1\" class=\"ltx_Math\" alttext=\"e_{1}\\circ f\\circ(\\pi^{m}_{1},\\dots,\\pi^{m}_{m})=e_{2}\\circ f\\circ(\\pi^{m}_{2}%&#10;,\\dots,\\pi^{m}_{m},\\pi^{m}_{1})\\,.\" display=\"block\"><mrow><mrow><mrow><msub><mi>e</mi><mn>1</mn></msub><mo>\u2218</mo><mi>f</mi><mo>\u2218</mo><mrow><mo stretchy=\"false\">(</mo><msubsup><mi>\u03c0</mi><mn>1</mn><mi>m</mi></msubsup><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msubsup><mi>\u03c0</mi><mi>m</mi><mi>m</mi></msubsup><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mrow><msub><mi>e</mi><mn>2</mn></msub><mo>\u2218</mo><mi>f</mi><mo>\u2218</mo><mrow><mo stretchy=\"false\">(</mo><msubsup><mi>\u03c0</mi><mn>2</mn><mi>m</mi></msubsup><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msubsup><mi>\u03c0</mi><mi>m</mi><mi>m</mi></msubsup><mo>,</mo><msubsup><mi>\u03c0</mi><mn>1</mn><mi>m</mi></msubsup><mo rspace=\"4.2pt\" stretchy=\"false\">)</mo></mrow></mrow></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.04520.tex", "nexttext": "\n        where the second implication holds because of $(\\ddag)$.\n\t\t\n\t\tNext, consider a \n\t\tconstraint of the form\n\t\t${\\operatorname{Comp}}_{u^{-1}k,v^{-1}k}(u,v)$ \n\t\tin $\\Phi$, and let $r := |\\!{\\operatorname{Im}}(k)|$.  \n\t\tLet $\\chi(z_1,\\dots,z_s)$ be a first-order formula in the language of ${\\mathbb B}$\n        and let $t\\colon[s]\\to[r]$.\n        Suppose that $\\chi(z_{u^{-1}kt(1)},\\dots,z_{u^{-1}kt(s)})$ is in $g(u)$.\n        From $(\\ddag)$ we obtain that ${\\mathbb B} \\models \\chi(a_{kt(1)},\\dots,a_{kt(s)})$.\n        Again by $(\\ddag)$ we get that $\\chi(z_{v^{-1}kt(1)}, \\dots, z_{v^{-1}kt(s)})$\n        is in $g(v)$.\n\t\tHence, it is true that\t\t\n\t\t${T_{\\mB,m}}({\\mathbb A}) \\models\n\t\t{\\operatorname{Comp}}_{u^{-1}k,v^{-1}k}(g(u),g(v))$. \n\t\t\n\n\t\tConversely, suppose that $\\Phi$ is satisfiable \n\t\tin ${T_{\\mB,m}}({\\mathbb A})$. That is, there exists\n\t\ta map $h$ from $I$ to the  \n\t\t$m$-types in ${\\mathbb B}$ that satisfies\n\t\tall conjuncts of $\\Phi$. \t\n        We show how to obtain an assignment of \n        $\\{x_1,\\dots,x_n\\}$ that satisfies $\\Psi$ in ${\\mathbb A}$.\n        For each $v_i\\in I$, let ${\\mathbb C}_i$ be a substructure of ${\\mathbb B}$\n        generated by (not necessarily distinct) elements\n        $g^i_1,\\dots,g^i_m \\in B$\n        such that the type of $(g^i_1,\\dots,g^i_m)$ in ${\\mathbb B}$ is $h(v_i)$.\n        Define an equivalence relation $\\sim$ on the disjoint union\n        of $\\{g^i_p\\}$ as follows.\n        Given $g^i_p\\in{\\mathbb C}_i$ and $g^j_q\\in{\\mathbb C}_j$,\n        let $k$ be such that the image of $v_k\\in I$ contains $v_i(p)$ and $v_j(q)$.\n        Finally, let $g^i_p\\sim g^j_q$ iff $g^k_{v_k^{-1}v_i(p)}=g^k_{v_k^{-1}v_j(q)}$.\n        This is indeed an equivalence relation. Reflexivity and\n        symmetry are easy to check.\n        Assume that $g^i_p\\sim g^j_q$\n        and $g^j_q\\sim g^k_r$.\n        Let $(i|j)$ be such that $v_{i\\mid j}$ contains $v_i(p)$\n        and $v_j(q)$ and such that $g^{i|j}_{v_{i|j}^{-1}v_i(p)} = g^{i|j}_{v_{i|j}^{-1}v_j(q)}$, and $(j|k)$ is defined similarly. \n        Let now $v_\\ell\\in I$ be a map whose image contains\n        $v_i(p),v_j(q)$, and $v_k(r)$,\n        which is possible since $m\\geq 3$.\n        We have that $(h(v_{i|j}),h(v_\\ell))$ satisfies the necessary compatibility\n        conditions and so does $(h(v_{j|k}),h(v_\\ell))$,\n        so that we must have $g^\\ell_{v_\\ell^{-1}v_i(p)} = g^\\ell_{v_\\ell^{-1}v_j(q)}$\n        and $g^\\ell_{v_\\ell^{-1}v_j(q)} = g^\\ell_{v_\\ell^{-1}v_k(r)}$. In particular,\n        $g^\\ell_{v_\\ell^{-1}v_i(p)} = g^\\ell_{v_\\ell^{-1}v_k(r)}$ and $g^i_p\\sim g^k_r$.\n        Close $\\sim$ under the application of $\\tau$-terms: we obtain\n        an equivalence relation $\\sim$ on the disjoint union of\n        $C_1,\\dots,C_s$.\n        Consider the structure ${\\mathbb C}$ defined on the set of $\\sim$-equivalence classes\n        and where $R(a_1/{\\sim},\\dots,a_r/{\\sim})$ is true in ${\\mathbb C}$\n        iff there is $b_1,\\dots,b_r$ in some $C_p$\n        such that $a_i\\sim b_i$ for all $i$ and such that\n        $R(b_1,\\dots,b_r)$ is true in ${\\mathbb C}_p$.\n        This structure embeds into ${\\mathbb B}$. Indeed, it suffices to prove that if ${\\mathbb D}$\n        is a bound for ${\\mathbb B}$, then ${\\mathbb D}$ does not embed into ${\\mathbb C}$.\n        Suppose for contradiction that it does: since ${\\mathbb D}$ has size at most $m_b\\leq m$,\n        we would have that ${\\mathbb D}$ embeds into ${\\mathbb C}_p$ for some $p$.\n        Since ${\\mathbb C}_p$ is a substructure of ${\\mathbb B}$, we would obtain an embedding\n        of ${\\mathbb D}$ into ${\\mathbb B}$, a contradiction.\n        Therefore, ${\\mathbb C}$ embeds into ${\\mathbb B}$ via $e$, and we let $f\\colon[n]\\to{\\mathbb B}$\n        be the map defined as follows. For $p\\in[n]$, let $v_i\\in I$\n        be any map whose range contains $p$.\n        There is a structure ${\\mathbb C}_i$ associated with $v_i$,\n        and an element $g^i_{v_i^{-1}(p)}$ in ${\\mathbb C}_i$.\n        Let $f(p) := e(g^i_{v_i^{-1}(p)}/{\\sim})$.\n        Note that by the construction of $\\sim$,\n        if ${\\mathbb C}_i$ and ${\\mathbb C}_j$ both have $p$ in their image,\n        then $g^i_{v_i^{-1}(p)} \\sim g^j_{v_j^{-1}(p)}$, so the particular choice of $i$\n        does not matter.\n        Note also that if $g^i_{v^{-1}(p)} \\neq g^i_{v^{-1}(q)}$, then $g^i_{v^{-1}(p)}\\not\\sim g^i_{v^{-1}(q)}$,\n        and therefore $f(p)\\neq f(q)$.\n        \n        We finally prove that $(f(1),\\dots,f(n))$\n        satisfies $\\Psi$ in ${\\mathbb A}$. Let $j \\colon [r] \\to [n]$\n        and $R(x_{j(1)},\\dots,x_{j(r)})$ \n        be a conjunct from $\\Psi$, and let $\\chi(z_1,\\dots,z_r)$\n        be the formula that defines $R$ in ${\\mathbb B}$. \n        Let $v_i \\in I$ \n        be such that ${\\operatorname{Im}}(j) \\subseteq {\\operatorname{Im}}(v_i)$.\n        The tuple $(g^i_1,\\dots,g^i_m)$ has type $h(v_i)$ in\n        ${\\mathbb B}$. Let $U$ be the unary relation symbol of ${T_{{\\mathbb B},m}}({\\mathbb A})$ that denotes  \n        $\\langle \\chi(z_{v_i^{-1}j(1)},\\dots,z_{v_i^{-1}j(r)}) \\rangle$.\n        By construction, the formula $\\Phi$ contains\n        the conjunct $U(v_i)$. \n    \tSince $h$ satisfies $\\Phi$,\n    \t$h(v_i)$ must contain \n    \t$\\chi(z_{v_i^{-1}j(1)},\\dots,z_{v_i^{-1}j(r)})$. \n    \tWe obtain that ${\\mathbb B} \\models\\chi(g^i_{v_i^{-1}j(1)},\\dots,g^i_{v_i^{-1}j(r)})$.\n        The function that maps $(g^i_{v_i^{-1}j(1)},\\dots,g^i_{v_i^{-1}j(r)})$ to $(f(j(1)),\\dots,f(j(r)))$\n        is a partial isomorphism of ${\\mathbb B}$, so by homogeneity of ${\\mathbb B}$\n        we have that $\\chi(f(j(1)),\\dots,f(j(r)))$ holds in ${\\mathbb B}$, i.e.,\n        the constraint $R(x_{j(1)},\\dots,x_{j(r)})$ is satisfied by $f$.\n\n\t\tThe given reduction can be\n\t\tperformed in polynomial time:\n\t\tthe number of variables in the new instance is \n\t\tin $O(n^m)$, \n\t\tand if $c$ is the number\n\t\tof constraints in $\\Psi$, then the number of constraints in $\\Phi$ is in $O(cn^m+n^{2m})$.\n        Each of the new constraints can be constructed in constant time. \n\t\\end{proof}\nWe mention that the reduction is in fact a  \\emph{first-order reduction}\n(see~\\cite{AtseriasBulatovDawar} for a definition).\n\n\\begin{example}\nLet ${\\mathbb A}$ be $({\\mathbb N};=,\\neq)$. We illustrate the reduction in the proof of \n\tTheorem~\\ref{thm:types-tractable-implies-structure-tractable} with the concrete instance\n\t\n", "itemtype": "equation", "pos": 25230, "prevtext": "\n\\end{itemize} \n\\end{thm}\n\nOur strategy to prove Theorem~\\ref{thm:main} is then as follows: we first reduce the task to the situation \nthat the polymorphism clone of the structure ${\\mathbb A}$ under consideration satisfies the assumptions of Theorem~\\ref{thm:ua-result} (in Section~\\ref{sect:lift}).\nIf the first case of this theorem applies, hardness of the CSP follows from general principles~\\cite{wonderland}. \nIf the second case applies, we associate to ${\\mathbb A}$ a structure over a finite domain, show that if the tractability conjecture is true then this structure\nhas a polynomial-time tractable CSP, and finally\nprove that ${\\operatorname{CSP}}({\\mathbb A})$ reduces to this finite-domain CSP. \n\nOur reduction from infinite-domain CSPs to finite-domains CSPs is very general, and another main contribution of this paper (Section~\\ref{sect:csps}). All that is needed here is that ${\\mathbb A}$ is finitely bounded. For structures ${\\mathbb A}$ that can be defined over finitely bounded homogeneous structures, the same reduction also yields new powerful tractability conditions, formulated in terms of the topological polymorphism clone of ${\\mathbb A}$, using\nknown (unconditional) tractability conditions known for finite-domain constraint satisfaction (in Section~\\ref{sect:tractability-conditions}).\n\n\\section{Notation}\n\\label{sect:notation}\nWe denote the set $\\{1,\\dots,n\\}$ by $[n]$.\nA \\emph{signature} $\\tau$ is a set of function symbols and\nrelation symbols, \nwhere each symbol symbol is associated with a natural number, called its \\emph{arity}.\nA \\emph{$\\tau$-structure} ${\\mathbb A}$ is a tuple\n$(A; (Z^{\\mathbb A})_{Z\\in\\tau})$ such that:\n\\begin{itemize}\n    \\item $Z^{\\mathbb A}\\subseteq A^k$ if $Z$ is a relation symbol of arity $k$, and\n    \\item $Z^{\\mathbb A}\\colon A^k\\to A$ if $Z$ is a function symbol of arity $k$. Function symbols of arity $0$ are called \\emph{constant symbols}.\n\\end{itemize}\nLet ${\\mathbb A},{\\mathbb B}$ be $\\tau$-structures with $B\\subseteq A$. ${\\mathbb B}$ is a \\emph{substructure} of ${\\mathbb A}$\nif:\n\\begin{itemize}\n    \\item for every $R_i\\in\\tau$ of arity $k$, $R_i^{\\mathbb B} = R_i^{\\mathbb A}\\cap B^k$, and\n    \\item for every function symbol $f_i\\in\\tau$ of arity $k$, $f_i^{\\mathbb B}={{f_i^{\\mathbb A}}|_{{B}}}$.\n\\end{itemize}\n\nA \\emph{homomorphism} between two structures ${\\mathbb A},{\\mathbb B}$ with the same signature $\\tau$ is a function $h\\colon A\\to B$\nsuch that $(a_1,\\dots,a_k)\\in R^{\\mathbb A}\\Rightarrow (h(a_1),\\dots,h(a_k))\\in R^{\\mathbb B}$ for every relation symbol $R\\in\\tau$, and such that $h(f^{\\mathbb A}(a_1,\\dots,a_k)) = f^{\\mathbb B}(h(a_1),\\dots,h(a_k))$ if $f\\in\\tau$ is a function symbol.\nWhen $h\\colon A\\to A$ is a homomorphism from ${\\mathbb A}$ to itself we say that $h$ is an \\emph{endomorphism}.\nAn injection function $h\\colon A\\to B$ is an \\emph{embedding} if we have $(a_1,\\dots,a_k)\\in R^{\\mathbb A}\\Leftrightarrow (h(a_1),\\dots,h(a_k))\\in R^{\\mathbb B}$.\nA surjective embedding is called an \\emph{isomorphism}, and an \\emph{automorphism} when ${\\mathbb A}$ equals ${\\mathbb B}$.\nLet ${\\mathbb A}$ be a relational $\\tau$-structure (that is, $\\tau$ only contains relation symbols).\nA function $h\\colon A^k\\to A$ is a \\emph{polymorphism} of ${\\mathbb A}$\nif for every $n\\in{\\mathbb N}$, every symbol $R\\in\\tau$ of arity $n$,\nand for all $n$-tuples ${\\mathbf a}^1,\\dots,{\\mathbf a}^n$ in $R$,\nwe have that $h({\\mathbf a}^1,\\dots,{\\mathbf a}^n)$ is in $R$,\nwhere $h$ is applied componentwise.\nWe write ${\\operatorname{Aut}}({\\mathbb A}),{\\operatorname{End}}({\\mathbb A}),{\\operatorname{Pol}}({\\mathbb A})$ for the sets of automorphisms,\nendomorphisms, and polymorphisms of ${\\mathbb A}$. \n\nLet ${\\mathbb A},{\\mathbb B}$ be two structures over the same domain, and suppose that ${\\mathbb A}$ has a relational signature.\n${\\mathbb A}$ is called a \\emph{reduct} of ${\\mathbb B}$ if all the relations of ${\\mathbb A}$ are definable by first-order formulas in ${\\mathbb B}$.\n\n\\section{Finitely Bounded Homogeneous Structures}\n\\label{sect:csps}\n    The \\emph{age} of a structure ${\\mathbb A}$, denoted by ${\\operatorname{Age}}({\\mathbb A})$, is the class of all the finitely\n    generated structures that embed into ${\\mathbb A}$.\nA \\emph{bound} of a class $\\mathcal C$ of structures \nover a fixed finite signature $\\tau$ is a finite\nstructure that does not embed into a structure\nfrom $\\mathcal C$, and that is minimal with this property (with respect to embeddability). \nA class of structures is called \\emph{finitely bounded} \nif it has finitely many bounds up to isomorphism. \nNote that an age is finitely bounded if and only if\nit has a \\emph{finite universal axiomatisation}, that is,\nthere exists a universal first-order sentence $\\phi$\nsuch that ${\\mathbb B} \\in \\mathcal C$ iff ${\\mathbb B} \\models \\phi$. \nA structure is called \n\\emph{finitely bounded} if its age is. \nThe constraint satisfaction problem of a structure might be undecidable in general. \nBut the CSP of a finitely bounded relational structure is in NP. \n\nA structure ${\\mathbb A}$ is said to be \\emph{homogeneous} if every isomorphism between\nfinitely generated substructures of ${\\mathbb A}$ can be extended to an automorphism of ${\\mathbb A}$.\nExamples of homogeneous structures are $({\\mathbb N};=)$ and $({\\mathbb Q}; <)$.\nObserve that expansions of homogeneous structures by constants are again homogeneous. \nReducts of homogeneous structures with finite relational signature, possibly also with finitely many constants,\nare examples of \\emph{$\\omega$-categorical} structures: a structure ${\\mathbb A}$ is $\\omega$-categorical\nif for every positive integer $m$, the natural action of ${\\operatorname{Aut}}({\\mathbb A})$ on $A^m$ has finitely many orbits.\n\n\\begin{proposition}\\label{prop:fin-bound}\nSuppose that ${\\mathbb A}$ is a finitely \nbounded homogeneous structure.\nAny expansion $({\\mathbb A};c^{{\\mathbb A}})$ of ${\\mathbb A}$ by a constant is homogeneous and finitely bounded, too. \n\\end{proposition}\n\\begin{proof}\nLet $\\tau$ be the signature of ${\\mathbb A}$.\nThe structure $({\\mathbb A};c^{{\\mathbb A}})$ is clearly\nhomogeneous. \nLet ${\\mathcal G}$ be the finite set of bounds\nof ${\\mathbb A}$, and \nlet $n$ be the maximal size of the structures in $\\mathcal G$. Define ${\\mathcal F}'$ to be the set of $(\\tau\\cup\\{c\\})$-structures on $n+1$ elements\nwhose $\\tau$-reduct embeds some structure in $\\mathcal G$. Let ${\\mathbb A}_c$ be the structure generated by $c^{{\\mathbb A}}$ \nin ${\\mathbb A}$; note that ${\\mathbb A}_c$ is finite. \nWe write $\\mathcal F$ for the union of $\\mathcal F'$ \nwith the set of \n$(\\tau\\cup\\{c\\})$-structures of size $|{\\mathbb A}_c|$\nthat are not isomorphic to ${\\mathbb A}_c$. Clearly, \n$\\mathcal F$ contains only finitely many structures up to isomorphism. To show that $({\\mathbb A};c^{{\\mathbb A}})$ is finitely bounded, it therefore suffices to show that \n$\\mathcal F$ contains the bounds of $({\\mathbb A};c^{{\\mathbb A}})$.\n\nWe first show that no structure in $\\mathcal F$ embeds\ninto $({\\mathbb A};c^{{\\mathbb A}})$. This is obvious for \nthe $(\\tau \\cup \\{c\\})$-structures in $\\mathcal F$\nof size $|{\\mathbb A}|_c$ that are not isomorphic to ${\\mathbb A}_c$. \nNow suppose for contradiction that \nthere is an embedding $e$ of  \n$({\\mathbb F},c^{\\mathbb F}) \\in \\mathcal F'$ into $({\\mathbb A},c^{{\\mathbb A}})$. By definition of $\\mathcal F'$,  \nthe structure $\\mathbb F$ embeds some $\\mathbb G\\in\\mathcal G$. By composing the embeddings, we obtain an embedding of $\\mathbb G$ into ${\\mathbb A}$, a contradiction\nto the choice of $\\mathcal G$.\n\n\nLet $({\\mathbb B},c^{{\\mathbb B}})$ \nbe a $(\\tau\\cup\\{c\\})$-structure such that \nno structure from $\\mathcal F$\nembeds into \n$({\\mathbb B},c^{{\\mathbb B}})$. We have to show that $({\\mathbb B},c^{{\\mathbb B}})$ embeds into $({\\mathbb A},c^{{\\mathbb A}})$. \nSince no structure from $\\mathcal F'$\nembeds into $({\\mathbb B},c^{{\\mathbb B}})$, no $\\mathbb G\\in \\mathcal G$ embeds into ${\\mathbb B}$. \nHence, by the definition of $\\mathcal G$, there exists an embedding $e$ of ${\\mathbb B}$ into ${\\mathbb A}$.\nMoreover, the structure generated by $c^{\\mathbb B}$ in ${\\mathbb B}$ must be isomorphic to the structure generated by $c^{{\\mathbb A}}$ in ${\\mathbb A}$.\nBy the homogeneity of ${\\mathbb A}$ there exists an automorphism $\\alpha$ of ${\\mathbb A}$ that maps $e(c^{\\mathbb B})$ to $c^{{\\mathbb A}}$.\nIt follows that $\\alpha \\circ e$ is a embedding of \n${\\mathbb B}$ into ${\\mathbb A}$ that maps $c^{\\mathbb B}$ to $c^{{\\mathbb A}}$,\ni.e., $\\alpha\\circ e$ is an embedding of $({\\mathbb B},c^{{\\mathbb B}})$\ninto $({\\mathbb A};c^{{\\mathbb A}})$.\n\\end{proof}\n\n    The \\emph{type of a tuple $(b_1,\\dots,b_m)$}, also called an \\emph{$m$-type}\\footnote{All types considered here are complete types in the sense of model theory, so we write `type' instead of `complete type'.} in ${\\mathbb B}$, is \n    the set of all first-order formulas\n    $\\phi(z_1,\\dots,z_m)$ such that\n    ${\\mathbb B} \\models \\phi(b_1,\\dots,b_m)$. \n   If ${\\mathbb B}$ is $\\omega$-categorical, then \n    there are only finitely many $m$-types in ${\\mathbb B}$\n    (they correspond to the orbits of ${\\operatorname{Aut}}({\\mathbb B})$ on $A^m$; see, e.g., ~\\cite{Hodges}). \n\n    Let $m$ be a positive integer.\n    We define $T_{{\\mathbb B},m}({\\mathbb A})$ to be the structure whose domain is the \n    set of $m$-types of ${\\mathbb B}$\n    and whose relations are as follows. \n    \\begin{itemize}\n        \\item for each symbol $R$ of ${\\mathbb A}$ of arity $r$, \n        let $\\chi(z_1,\\dots,z_r)$ \n        be a definition of $R$ in ${\\mathbb B}$. For\n        $i \\colon [r] \\to [m]$ \n        we write $\\langle \\chi(z_{i(1)},\\dots,z_{i(r)})\\rangle$ \n        for the unary relation that consists of all the types \n        that contain $\\chi(z_{i(1)},\\dots,z_{i(r)})$,\n        and add all such relations to ${T_{\\mB,m}}({\\mathbb A})$. \n\n        \\item for each $r \\in [m]$ and \n        $i,j \\colon [r] \\to [m]$, \n        define ${\\operatorname{Comp}}_{i,j}$ to be the binary relation that contains\n        the pairs $(p,q)$ of $m$-types such that \n        for every first-order formula $\\chi(z_1,\\dots,z_s)$ of ${\\mathbb B}$ with $s$ free variables,\n        and $t \\colon [s] \\to [r]$, \n        the formula $\\chi(z_{it(1)},\\dots,z_{it(s)})$ is in $p$ iff $\\chi(z_{jt(1)},\\dots,z_{jt(s)})$ is in $q$.\n    \\end{itemize}\n    Note that if $(a_1,\\dots,a_m)$ is of type $p$ and $(b_1,\\dots,b_m)$ of type $q$,\n\tthen ${\\operatorname{Comp}}_{i,j}(p,q)$ holds if and only if\n    $(a_{i(1)},\\dots,a_{i(r)})$ and\n    $(b_{j(1)},\\dots,b_{j(r)})$ have the same type\n    in ${\\mathbb B}$.\n\n\n The next theorem holds for arbitrary finitely bounded homogeneous structures ${\\mathbb B}$ (which might also have functions);\n if ${\\mathbb B}$ is additionally $\\omega$-categorical,\n then the theorem provides a reduction from the CSPs \n of reducts of ${\\mathbb B}$ to finite-domain CSPs. \n \n\\begin{thm}\\label{thm:types-tractable-implies-structure-tractable}\n\t\tLet ${\\mathbb A}$ be a finite-signature \n\t\treduct of a finitely bounded homogeneous structure \n\t\t${\\mathbb B}$. \n        Let $m_a$ be the maximal arity of a relation in ${\\mathbb A}$ or ${\\mathbb B}$,\n        and $m_b$ be the maximal size of a bound for ${\\mathbb B}$.\n        Let $m$ be at least $\\max(m_a,m_b,3)$.\n        Then there is a polynomial-time reduction\n        from ${\\operatorname{CSP}}({\\mathbb A})$ to ${\\operatorname{CSP}}({T_{\\mB,m}}({\\mathbb A}))$. \n\\end{thm}\n\\begin{proof}\n\t\tWe show that ${\\operatorname{CSP}}({\\mathbb A})$ reduces \n\t\tin polynomial-time to ${\\operatorname{CSP}}({T_{\\mB,m}}({\\mathbb A}))$.\n\t\tLet \n\t\t$\\Psi$ be an instance of ${\\operatorname{CSP}}({\\mathbb A})$\n\t\twith variables $x_1,\\dots,x_n$. \n\t\tAssume without loss of generality that\n\t\t$n \\geq m$. \n\t\tWe build an instance $\\Phi$ of ${\\operatorname{CSP}}({T_{\\mB,m}}({\\mathbb A}))$ as follows.\n\t\t\\begin{itemize}\n\t\t\t\\item The variable set of $\\Phi$ is the set\n\t\t\t$I$ of order-preserving injections from $[m]$ to $[n]$. \n            The idea of the reduction is that \n            the variable $v \\in I$ \n            of $\\Phi$ represents the type of $(h(x_{v(1)}),\\dots,h(x_{v(m)}))$\n            in a satisfying assignment $h$ for $\\Psi$. \n            \n\t\t\t\\item For each conjunct $\\psi$ of $\\Psi$ \n\t\t\twe add unary constraints to $\\Phi$ as follows. The formula $\\psi$ must be of the form $R(x_{j(1)},\\dots,x_{j(r)})$\n\t\t\twhere $R$ is a relation of ${\\mathbb A}$ and \n\t\t\t$j \\colon [r] \\to [n]$. By assumption, $R$ has a first-order definition $\\chi(z_1,\\dots,z_r)$ over ${\\mathbb B}$.\n\t\t\tLet $v \\in I$ be such that ${\\operatorname{Im}}(j) \\subseteq {\\operatorname{Im}}(v)$.  \n             Let $U$ be the relation symbol\n            of ${T_{\\mB,m}}({\\mathbb A})$ that denotes\n            the unary relation\n            $\\langle \\chi(z_{v^{-1}j(1)},\\dots,z_{v^{-1}j(r)})\\rangle$. We then add $U(v)$ to $\\Phi$. \n \n            \\item Finally, for all $u,v \\in I$ \n            let $k \\colon [r]  \\to {\\operatorname{Im}}(u) \\cap {\\operatorname{Im}}(v)$ be a bijection.  \n\t\tWe then add the constraint ${\\operatorname{Comp}}_{u^{-1}k,v^{-1}k}(u,v)$.\n\t\t\\end{itemize}\n\n        Let $a_1,\\dots,a_n$ be elements of ${\\mathbb B}$, let $\\chi(z_1,\\dots,z_r)$ be a formula\n        in the language of ${\\mathbb B}$, let $j\\colon[r]\\to[n]$,\n        and let $v$ in $I$ be such that ${\\operatorname{Im}}(j)\\subseteq{\\operatorname{Im}}(v)$.\n        We first note the following property:\n        \n        \\vspace{.2cm}\n            \\begin{tabular}{cp{0.8\\linewidth}} $(\\ddag)$ &\n                ${\\mathbb B} \\models \\chi(a_{j(1)},\\dots,a_{j(r)})$ iff $(a_{v(1)},\\dots,a_{v(m)})$ \n                satisfies $\\chi(z_{v^{-1}j(1)},\\dots,z_{v^{-1}j(r)})$\n                in ${\\mathbb B}$.\n            \\end{tabular}\n            \n        \\vspace{.2cm}\n        The property $(\\ddag)$ holds since the variable $z_i$ in the type of the tuple $(a_{v(1)},\\dots,a_{v(m)})$\n        represents the element $a_{v(i)}$, and therefore $z_{v^{-1}j(i)}$ represents $a_{j(i)}$. \n\n\t\tSuppose that $(a_1,\\dots,a_n)$ \n\t\tsatisfies \n\t\t$\\Psi$ in ${\\mathbb A}$. To show that \n\t\t$\\Phi$ is satisfiable in ${T_{\\mB,m}}({\\mathbb A})$, \n\t\tdefine $g \\colon I \\to {T_{\\mB,m}}({\\mathbb A})$ \n\t\tby setting $g(v)$ to be the type of $(a_{v(1)},\\dots,a_{v(m)})$ in ${\\mathbb B}$, for every $v \\in I$. \n\t\tTo see that all the constraints of $\\Phi$\n\t\t are satisfied\n\t\tby $g$, let \n\t\t$U(v)$ be a constraint in $\\Phi$\n\t\tthat has been introduced\n\t\tfor a conjunct \n\t\tof the form $R(x_{j(1)},\\dots,x_{j(r)})$ in $\\Psi$. \n\t\tLet $\\chi(z_1,\\dots,z_r)$ be the first-order \n\t\tformula that defines $R$ in ${\\mathbb B}$. Then\n\t\t\n", "index": 5, "text": "\\begin{align*}\n\t\t& \\quad {\\mathbb A} \\models R(a_{j(1)},\\dots,a_{j(r)}) \\\\\n\t\t\\Rightarrow & \\quad {\\mathbb B} \\models \\chi(a_{j(1)},\\dots,a_{j(r)}) \\\\\n\t\t\\Rightarrow & \\quad \\chi(z_{v^{-1}j(1)},\\dots,z_{v^{-1}j(m)}) \\in g(v) \\\\\n\t\t\n\t\t\\Rightarrow & \\quad \n\t\t{T_{\\mB,m}}({\\mathbb A}) \\models U(g(v)),\n\t\t\\end{align*}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex3.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle\\quad{\\mathbb{A}}\\models R(a_{j(1)},\\dots,a_{j(r)})\" display=\"inline\"><mrow><mrow><mi mathvariant=\"normal\">\u2003</mi><mo>\u2062</mo><mi>\ud835\udd38</mi></mrow><mo>\u22a7</mo><mrow><mi>R</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>a</mi><mrow><mi>j</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow></mrow></msub><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msub><mi>a</mi><mrow><mi>j</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>r</mi><mo stretchy=\"false\">)</mo></mrow></mrow></msub><mo stretchy=\"false\">)</mo></mrow></mrow></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex4.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle\\Rightarrow\" display=\"inline\"><mo>\u21d2</mo></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex4.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle\\quad{\\mathbb{B}}\\models\\chi(a_{j(1)},\\dots,a_{j(r)})\" display=\"inline\"><mrow><mrow><mi mathvariant=\"normal\">\u2003</mi><mo>\u2062</mo><mi>\ud835\udd39</mi></mrow><mo>\u22a7</mo><mrow><mi>\u03c7</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>a</mi><mrow><mi>j</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow></mrow></msub><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msub><mi>a</mi><mrow><mi>j</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>r</mi><mo stretchy=\"false\">)</mo></mrow></mrow></msub><mo stretchy=\"false\">)</mo></mrow></mrow></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex5.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle\\Rightarrow\" display=\"inline\"><mo>\u21d2</mo></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex5.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle\\quad\\chi(z_{v^{-1}j(1)},\\dots,z_{v^{-1}j(m)})\\in g(v)\" display=\"inline\"><mrow><mrow><mi mathvariant=\"normal\">\u2003</mi><mo>\u2062</mo><mi>\u03c7</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>z</mi><mrow><msup><mi>v</mi><mrow><mo>-</mo><mn>1</mn></mrow></msup><mo>\u2062</mo><mi>j</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow></mrow></msub><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msub><mi>z</mi><mrow><msup><mi>v</mi><mrow><mo>-</mo><mn>1</mn></mrow></msup><mo>\u2062</mo><mi>j</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>m</mi><mo stretchy=\"false\">)</mo></mrow></mrow></msub><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2208</mo><mrow><mi>g</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>v</mi><mo stretchy=\"false\">)</mo></mrow></mrow></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex6.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle\\par&#10;\\Rightarrow\" display=\"inline\"><mo>\u21d2</mo></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex6.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle\\quad{T_{\\mB,m}}({\\mathbb{A}})\\models U(g(v)),\" display=\"inline\"><mrow><mrow><mrow><mi mathvariant=\"normal\">\u2003</mi><mo>\u2062</mo><msub><mi>T</mi><mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\mB</mtext></merror><mo>,</mo><mi>m</mi></mrow></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>\ud835\udd38</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u22a7</mo><mrow><mi>U</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mrow><mi>g</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>v</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo stretchy=\"false\">)</mo></mrow></mrow></mrow><mo>,</mo></mrow></math>", "type": "latex"}, {"file": "1601.04520.tex", "nexttext": "\n\tof ${\\operatorname{CSP}}({\\mathbb A})$. \n\tThe structure $({\\mathbb N};=,\\neq)$ is a reduct of \n\tthe homogeneous structure with domain\n\t${\\mathbb N}$ and the empty signature, which has\n\tno bounds. \n    We have in this example $m=3$.\n\n\tThe structure ${T_{\\mB,3}}({\\mathbb A})$ has a domain \n\tof size five, the unary relation $U_1$ for \n\t$\\langle z_2 = z_3 \\rangle$, $U_2$ for $\\langle z_1 = z_3 \\rangle$, $U_3$ for $\\langle z_1 = z_2 \\rangle$,\n\t$V_1$ for $\\langle z_2 \\neq z_3 \\rangle$, $V_2$ for $\\langle z_1 \\neq z_3 \\rangle$, and $V_3$ for $\\langle z_1 \\neq z_2 \\rangle$. \n\tThe instance $\\Phi$ of ${\\operatorname{CSP}}({T_{\\mB,3}}({\\mathbb A}))$ \n\tthat our reduction creates has four variables,\n\tfor the four order-preserving injections from\n\t$[3] \\to [4]$, called $v_1,v_2,v_3,v_4$, where \n\t${\\operatorname{Im}}(v_j) = [4] \\setminus \\{j\\}$. \n\tWe then have the following constraints in $\\Phi$:\n\t\\begin{itemize}\n\t\\item $U_3(v_3)$ and $U_3(v_4)$ for the constraint $x_1 = x_2$ in $\\Psi$;\n\t\\item $U_1(v_4)$ and $U_3(v_1)$ for the constraint\n\t$x_2 = x_3$ in $\\Psi$;\n\t\\item $U_1(v_2)$ and $U_1(v_1)$ for the constraint $x_3 = x_4$ in $\\Psi$; \n\t\\item $V_2(v_2)$ and $V_2(v_3)$ for the constraint $x_1 \\neq x_4$ in $\\Psi$. \n\t\\end{itemize}\n\tFor the compatibility constraints we only give an example. Let $k,k' \\colon [2] \\to [4]$ be such that $k(1,2)=(1,3)$ and $k'(1,2)=(1,2)$. Then\n\t${\\operatorname{Comp}}_{k,k'}(v_4,v_2)$\n\tand ${\\operatorname{Comp}}_{k',k'}(v_4,v_3)$ are in $\\Phi$.  \\qed\n\\end{example}\n\nTheorem~\\ref{thm:types-tractable-implies-structure-tractable}\nhas a variant that yields reductions to finite-domain CSPs even if the base\nstructure ${\\mathbb B}$ is not\n$\\omega$-categorical, but purely relational. For this, \nwe replace first-order types in the definition of ${T_{\\mB,m}}({\\mathbb A})$ by quantifier-free types, but additionally\nrequire that all relations of\n${\\mathbb A}$ have quantifier-free definitions\nover ${\\mathbb B}$. In this way, it can be shown that\nthe reduction works for all CSPs that can be\ndescribed in SNP (for SNP in connection to CSPs see, e.g.,~\\cite{FederVardi}). This result is incomparable to\nTheorem~\\ref{thm:types-tractable-implies-structure-tractable} since there\nare finitely bounded $\\omega$-categorical\nstructures ${\\mathbb B}$ with reducts whose CSP is not in SNP, \ne.g., the atomless Boolean algebra~\\cite{Bodirsky-HDR}.\n\n\\section{New abstract tractability conditions}\n\\label{sect:tractability-conditions}\nWe first recall basics from universal\nalgebra that are needed to formulate\nthe algebraic facts for finite-domain constraint satisfaction that are relevant for the purposes of this paper, collected in Theorem~\\ref{thm:finite}. We then briefly introduce fundamental concepts \nfor infinite-domain constraint satisfaction, and can finally\nstate and prove our new tractability conditions. \n\n\\subsection*{Universal Algebra}\nAn \\emph{algebra} is a structure whose signature contains only function symbols,\nwhose interpretations are then called the \\emph{operations} of the algebra.\nA substructure of an algebra is referred to as a \\emph{subalgebra}. \nAn \\emph{idempotent algebra} is an algebra whose operations satisfy the law $f^{\\mathbf A}(x,\\dots,x)=x$ for all $x\\in A$.\nIf ${\\mathbf A}$ is an algebra and $n$ is a positive integer, ${\\mathbf A}^n$\nis defined as the algebra on $A^n$ where for each $k$-ary function $f$\nin the signature of ${\\mathbf A}$, $f^{{\\mathbf A}^n}$ is the function\n$(A^n)^k\\to A^n$ obtained by applying $f^{\\mathbf A}$ on tuples componentwise.\nGiven an algebra ${\\mathbf A}$, we write ${\\operatorname{\\mathsf{HSP}_{fin}}}({\\mathbf A})$ for the class of algebras \nthat contains an algebra $\\mathbf T$ iff\nthere is a positive integer $n$, a subalgebra ${\\mathbf S}$ of ${\\mathbf A}^n$,\nand a surjective homomorphism ${\\mathbf S}\\to\\mathbf T$.\nThe class ${\\operatorname{\\mathsf{HS}}}({\\mathbf A})$ is defined similarly, where we only allow $n=1$.\n\n\n\\subsection*{Clones} A set ${\\mathscr C}$ of functions over a set $D$ is called a \\emph{function clone} if for all $k\\geq 1$\nand all $1\\leq i\\leq k$ it contains the \\emph{projections} $\\pi_i^k\\colon(x_1,\\dots,x_k)\\to x_i$,\nand if ${\\mathscr C}$ is closed under composition of functions.\nThe smallest function clone on $\\{0,1\\}$ is denoted by ${\\mathbf 2}$.\n A typical function clone is the set ${\\operatorname{Clo}}({\\mathbf A})$ of \\emph{term operations}\nof an algebra ${\\mathbf A}$, and indeed for every function clone ${\\mathscr C}$ there exists an algebra ${\\mathbf A}$ such that ${\\mathscr C} = {\\operatorname{Clo}}({\\mathbf A})$.\n A \\emph{clone homomorphism} between two clones\n${\\mathscr C}$ and ${\\mathscr D}$ is a function $\\xi\\colon{\\mathscr C}\\to{\\mathscr D}$ such that $\\xi(\\pi_i^k) = \\pi_i^k$ and \n\n", "itemtype": "equation", "pos": 31893, "prevtext": "\n        where the second implication holds because of $(\\ddag)$.\n\t\t\n\t\tNext, consider a \n\t\tconstraint of the form\n\t\t${\\operatorname{Comp}}_{u^{-1}k,v^{-1}k}(u,v)$ \n\t\tin $\\Phi$, and let $r := |\\!{\\operatorname{Im}}(k)|$.  \n\t\tLet $\\chi(z_1,\\dots,z_s)$ be a first-order formula in the language of ${\\mathbb B}$\n        and let $t\\colon[s]\\to[r]$.\n        Suppose that $\\chi(z_{u^{-1}kt(1)},\\dots,z_{u^{-1}kt(s)})$ is in $g(u)$.\n        From $(\\ddag)$ we obtain that ${\\mathbb B} \\models \\chi(a_{kt(1)},\\dots,a_{kt(s)})$.\n        Again by $(\\ddag)$ we get that $\\chi(z_{v^{-1}kt(1)}, \\dots, z_{v^{-1}kt(s)})$\n        is in $g(v)$.\n\t\tHence, it is true that\t\t\n\t\t${T_{\\mB,m}}({\\mathbb A}) \\models\n\t\t{\\operatorname{Comp}}_{u^{-1}k,v^{-1}k}(g(u),g(v))$. \n\t\t\n\n\t\tConversely, suppose that $\\Phi$ is satisfiable \n\t\tin ${T_{\\mB,m}}({\\mathbb A})$. That is, there exists\n\t\ta map $h$ from $I$ to the  \n\t\t$m$-types in ${\\mathbb B}$ that satisfies\n\t\tall conjuncts of $\\Phi$. \t\n        We show how to obtain an assignment of \n        $\\{x_1,\\dots,x_n\\}$ that satisfies $\\Psi$ in ${\\mathbb A}$.\n        For each $v_i\\in I$, let ${\\mathbb C}_i$ be a substructure of ${\\mathbb B}$\n        generated by (not necessarily distinct) elements\n        $g^i_1,\\dots,g^i_m \\in B$\n        such that the type of $(g^i_1,\\dots,g^i_m)$ in ${\\mathbb B}$ is $h(v_i)$.\n        Define an equivalence relation $\\sim$ on the disjoint union\n        of $\\{g^i_p\\}$ as follows.\n        Given $g^i_p\\in{\\mathbb C}_i$ and $g^j_q\\in{\\mathbb C}_j$,\n        let $k$ be such that the image of $v_k\\in I$ contains $v_i(p)$ and $v_j(q)$.\n        Finally, let $g^i_p\\sim g^j_q$ iff $g^k_{v_k^{-1}v_i(p)}=g^k_{v_k^{-1}v_j(q)}$.\n        This is indeed an equivalence relation. Reflexivity and\n        symmetry are easy to check.\n        Assume that $g^i_p\\sim g^j_q$\n        and $g^j_q\\sim g^k_r$.\n        Let $(i|j)$ be such that $v_{i\\mid j}$ contains $v_i(p)$\n        and $v_j(q)$ and such that $g^{i|j}_{v_{i|j}^{-1}v_i(p)} = g^{i|j}_{v_{i|j}^{-1}v_j(q)}$, and $(j|k)$ is defined similarly. \n        Let now $v_\\ell\\in I$ be a map whose image contains\n        $v_i(p),v_j(q)$, and $v_k(r)$,\n        which is possible since $m\\geq 3$.\n        We have that $(h(v_{i|j}),h(v_\\ell))$ satisfies the necessary compatibility\n        conditions and so does $(h(v_{j|k}),h(v_\\ell))$,\n        so that we must have $g^\\ell_{v_\\ell^{-1}v_i(p)} = g^\\ell_{v_\\ell^{-1}v_j(q)}$\n        and $g^\\ell_{v_\\ell^{-1}v_j(q)} = g^\\ell_{v_\\ell^{-1}v_k(r)}$. In particular,\n        $g^\\ell_{v_\\ell^{-1}v_i(p)} = g^\\ell_{v_\\ell^{-1}v_k(r)}$ and $g^i_p\\sim g^k_r$.\n        Close $\\sim$ under the application of $\\tau$-terms: we obtain\n        an equivalence relation $\\sim$ on the disjoint union of\n        $C_1,\\dots,C_s$.\n        Consider the structure ${\\mathbb C}$ defined on the set of $\\sim$-equivalence classes\n        and where $R(a_1/{\\sim},\\dots,a_r/{\\sim})$ is true in ${\\mathbb C}$\n        iff there is $b_1,\\dots,b_r$ in some $C_p$\n        such that $a_i\\sim b_i$ for all $i$ and such that\n        $R(b_1,\\dots,b_r)$ is true in ${\\mathbb C}_p$.\n        This structure embeds into ${\\mathbb B}$. Indeed, it suffices to prove that if ${\\mathbb D}$\n        is a bound for ${\\mathbb B}$, then ${\\mathbb D}$ does not embed into ${\\mathbb C}$.\n        Suppose for contradiction that it does: since ${\\mathbb D}$ has size at most $m_b\\leq m$,\n        we would have that ${\\mathbb D}$ embeds into ${\\mathbb C}_p$ for some $p$.\n        Since ${\\mathbb C}_p$ is a substructure of ${\\mathbb B}$, we would obtain an embedding\n        of ${\\mathbb D}$ into ${\\mathbb B}$, a contradiction.\n        Therefore, ${\\mathbb C}$ embeds into ${\\mathbb B}$ via $e$, and we let $f\\colon[n]\\to{\\mathbb B}$\n        be the map defined as follows. For $p\\in[n]$, let $v_i\\in I$\n        be any map whose range contains $p$.\n        There is a structure ${\\mathbb C}_i$ associated with $v_i$,\n        and an element $g^i_{v_i^{-1}(p)}$ in ${\\mathbb C}_i$.\n        Let $f(p) := e(g^i_{v_i^{-1}(p)}/{\\sim})$.\n        Note that by the construction of $\\sim$,\n        if ${\\mathbb C}_i$ and ${\\mathbb C}_j$ both have $p$ in their image,\n        then $g^i_{v_i^{-1}(p)} \\sim g^j_{v_j^{-1}(p)}$, so the particular choice of $i$\n        does not matter.\n        Note also that if $g^i_{v^{-1}(p)} \\neq g^i_{v^{-1}(q)}$, then $g^i_{v^{-1}(p)}\\not\\sim g^i_{v^{-1}(q)}$,\n        and therefore $f(p)\\neq f(q)$.\n        \n        We finally prove that $(f(1),\\dots,f(n))$\n        satisfies $\\Psi$ in ${\\mathbb A}$. Let $j \\colon [r] \\to [n]$\n        and $R(x_{j(1)},\\dots,x_{j(r)})$ \n        be a conjunct from $\\Psi$, and let $\\chi(z_1,\\dots,z_r)$\n        be the formula that defines $R$ in ${\\mathbb B}$. \n        Let $v_i \\in I$ \n        be such that ${\\operatorname{Im}}(j) \\subseteq {\\operatorname{Im}}(v_i)$.\n        The tuple $(g^i_1,\\dots,g^i_m)$ has type $h(v_i)$ in\n        ${\\mathbb B}$. Let $U$ be the unary relation symbol of ${T_{{\\mathbb B},m}}({\\mathbb A})$ that denotes  \n        $\\langle \\chi(z_{v_i^{-1}j(1)},\\dots,z_{v_i^{-1}j(r)}) \\rangle$.\n        By construction, the formula $\\Phi$ contains\n        the conjunct $U(v_i)$. \n    \tSince $h$ satisfies $\\Phi$,\n    \t$h(v_i)$ must contain \n    \t$\\chi(z_{v_i^{-1}j(1)},\\dots,z_{v_i^{-1}j(r)})$. \n    \tWe obtain that ${\\mathbb B} \\models\\chi(g^i_{v_i^{-1}j(1)},\\dots,g^i_{v_i^{-1}j(r)})$.\n        The function that maps $(g^i_{v_i^{-1}j(1)},\\dots,g^i_{v_i^{-1}j(r)})$ to $(f(j(1)),\\dots,f(j(r)))$\n        is a partial isomorphism of ${\\mathbb B}$, so by homogeneity of ${\\mathbb B}$\n        we have that $\\chi(f(j(1)),\\dots,f(j(r)))$ holds in ${\\mathbb B}$, i.e.,\n        the constraint $R(x_{j(1)},\\dots,x_{j(r)})$ is satisfied by $f$.\n\n\t\tThe given reduction can be\n\t\tperformed in polynomial time:\n\t\tthe number of variables in the new instance is \n\t\tin $O(n^m)$, \n\t\tand if $c$ is the number\n\t\tof constraints in $\\Psi$, then the number of constraints in $\\Phi$ is in $O(cn^m+n^{2m})$.\n        Each of the new constraints can be constructed in constant time. \n\t\\end{proof}\nWe mention that the reduction is in fact a  \\emph{first-order reduction}\n(see~\\cite{AtseriasBulatovDawar} for a definition).\n\n\\begin{example}\nLet ${\\mathbb A}$ be $({\\mathbb N};=,\\neq)$. We illustrate the reduction in the proof of \n\tTheorem~\\ref{thm:types-tractable-implies-structure-tractable} with the concrete instance\n\t\n", "index": 7, "text": "$$x_1=x_2 \\wedge x_2=x_3 \\wedge x_{3}=x_4 \\wedge x_1\\neq x_4 \\, .$$\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex7.m1\" class=\"ltx_Math\" alttext=\"x_{1}=x_{2}\\wedge x_{2}=x_{3}\\wedge x_{3}=x_{4}\\wedge x_{1}\\neq x_{4}\\,.\" display=\"block\"><mrow><mrow><msub><mi>x</mi><mn>1</mn></msub><mo>=</mo><mrow><msub><mi>x</mi><mn>2</mn></msub><mo>\u2227</mo><msub><mi>x</mi><mn>2</mn></msub></mrow><mo>=</mo><mrow><msub><mi>x</mi><mn>3</mn></msub><mo>\u2227</mo><msub><mi>x</mi><mn>3</mn></msub></mrow><mo>=</mo><mrow><msub><mi>x</mi><mn>4</mn></msub><mo>\u2227</mo><msub><mi>x</mi><mn>1</mn></msub></mrow><mo>\u2260</mo><mpadded width=\"+1.7pt\"><msub><mi>x</mi><mn>4</mn></msub></mpadded></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.04520.tex", "nexttext": "\nholds for all $f,g_1,\\dots,g_k\\in{\\mathscr C}$.\nA weaker notion of homomorphism between clones has recently been defined in~\\cite{wonderland}.\nA function $\\xi\\colon{\\mathscr C}\\to{\\mathscr D}$ is an \\emph{h1 clone homomorphism}\nif it satisfies\n\n", "itemtype": "equation", "pos": 36693, "prevtext": "\n\tof ${\\operatorname{CSP}}({\\mathbb A})$. \n\tThe structure $({\\mathbb N};=,\\neq)$ is a reduct of \n\tthe homogeneous structure with domain\n\t${\\mathbb N}$ and the empty signature, which has\n\tno bounds. \n    We have in this example $m=3$.\n\n\tThe structure ${T_{\\mB,3}}({\\mathbb A})$ has a domain \n\tof size five, the unary relation $U_1$ for \n\t$\\langle z_2 = z_3 \\rangle$, $U_2$ for $\\langle z_1 = z_3 \\rangle$, $U_3$ for $\\langle z_1 = z_2 \\rangle$,\n\t$V_1$ for $\\langle z_2 \\neq z_3 \\rangle$, $V_2$ for $\\langle z_1 \\neq z_3 \\rangle$, and $V_3$ for $\\langle z_1 \\neq z_2 \\rangle$. \n\tThe instance $\\Phi$ of ${\\operatorname{CSP}}({T_{\\mB,3}}({\\mathbb A}))$ \n\tthat our reduction creates has four variables,\n\tfor the four order-preserving injections from\n\t$[3] \\to [4]$, called $v_1,v_2,v_3,v_4$, where \n\t${\\operatorname{Im}}(v_j) = [4] \\setminus \\{j\\}$. \n\tWe then have the following constraints in $\\Phi$:\n\t\\begin{itemize}\n\t\\item $U_3(v_3)$ and $U_3(v_4)$ for the constraint $x_1 = x_2$ in $\\Psi$;\n\t\\item $U_1(v_4)$ and $U_3(v_1)$ for the constraint\n\t$x_2 = x_3$ in $\\Psi$;\n\t\\item $U_1(v_2)$ and $U_1(v_1)$ for the constraint $x_3 = x_4$ in $\\Psi$; \n\t\\item $V_2(v_2)$ and $V_2(v_3)$ for the constraint $x_1 \\neq x_4$ in $\\Psi$. \n\t\\end{itemize}\n\tFor the compatibility constraints we only give an example. Let $k,k' \\colon [2] \\to [4]$ be such that $k(1,2)=(1,3)$ and $k'(1,2)=(1,2)$. Then\n\t${\\operatorname{Comp}}_{k,k'}(v_4,v_2)$\n\tand ${\\operatorname{Comp}}_{k',k'}(v_4,v_3)$ are in $\\Phi$.  \\qed\n\\end{example}\n\nTheorem~\\ref{thm:types-tractable-implies-structure-tractable}\nhas a variant that yields reductions to finite-domain CSPs even if the base\nstructure ${\\mathbb B}$ is not\n$\\omega$-categorical, but purely relational. For this, \nwe replace first-order types in the definition of ${T_{\\mB,m}}({\\mathbb A})$ by quantifier-free types, but additionally\nrequire that all relations of\n${\\mathbb A}$ have quantifier-free definitions\nover ${\\mathbb B}$. In this way, it can be shown that\nthe reduction works for all CSPs that can be\ndescribed in SNP (for SNP in connection to CSPs see, e.g.,~\\cite{FederVardi}). This result is incomparable to\nTheorem~\\ref{thm:types-tractable-implies-structure-tractable} since there\nare finitely bounded $\\omega$-categorical\nstructures ${\\mathbb B}$ with reducts whose CSP is not in SNP, \ne.g., the atomless Boolean algebra~\\cite{Bodirsky-HDR}.\n\n\\section{New abstract tractability conditions}\n\\label{sect:tractability-conditions}\nWe first recall basics from universal\nalgebra that are needed to formulate\nthe algebraic facts for finite-domain constraint satisfaction that are relevant for the purposes of this paper, collected in Theorem~\\ref{thm:finite}. We then briefly introduce fundamental concepts \nfor infinite-domain constraint satisfaction, and can finally\nstate and prove our new tractability conditions. \n\n\\subsection*{Universal Algebra}\nAn \\emph{algebra} is a structure whose signature contains only function symbols,\nwhose interpretations are then called the \\emph{operations} of the algebra.\nA substructure of an algebra is referred to as a \\emph{subalgebra}. \nAn \\emph{idempotent algebra} is an algebra whose operations satisfy the law $f^{\\mathbf A}(x,\\dots,x)=x$ for all $x\\in A$.\nIf ${\\mathbf A}$ is an algebra and $n$ is a positive integer, ${\\mathbf A}^n$\nis defined as the algebra on $A^n$ where for each $k$-ary function $f$\nin the signature of ${\\mathbf A}$, $f^{{\\mathbf A}^n}$ is the function\n$(A^n)^k\\to A^n$ obtained by applying $f^{\\mathbf A}$ on tuples componentwise.\nGiven an algebra ${\\mathbf A}$, we write ${\\operatorname{\\mathsf{HSP}_{fin}}}({\\mathbf A})$ for the class of algebras \nthat contains an algebra $\\mathbf T$ iff\nthere is a positive integer $n$, a subalgebra ${\\mathbf S}$ of ${\\mathbf A}^n$,\nand a surjective homomorphism ${\\mathbf S}\\to\\mathbf T$.\nThe class ${\\operatorname{\\mathsf{HS}}}({\\mathbf A})$ is defined similarly, where we only allow $n=1$.\n\n\n\\subsection*{Clones} A set ${\\mathscr C}$ of functions over a set $D$ is called a \\emph{function clone} if for all $k\\geq 1$\nand all $1\\leq i\\leq k$ it contains the \\emph{projections} $\\pi_i^k\\colon(x_1,\\dots,x_k)\\to x_i$,\nand if ${\\mathscr C}$ is closed under composition of functions.\nThe smallest function clone on $\\{0,1\\}$ is denoted by ${\\mathbf 2}$.\n A typical function clone is the set ${\\operatorname{Clo}}({\\mathbf A})$ of \\emph{term operations}\nof an algebra ${\\mathbf A}$, and indeed for every function clone ${\\mathscr C}$ there exists an algebra ${\\mathbf A}$ such that ${\\mathscr C} = {\\operatorname{Clo}}({\\mathbf A})$.\n A \\emph{clone homomorphism} between two clones\n${\\mathscr C}$ and ${\\mathscr D}$ is a function $\\xi\\colon{\\mathscr C}\\to{\\mathscr D}$ such that $\\xi(\\pi_i^k) = \\pi_i^k$ and \n\n", "index": 9, "text": "$$\\xi(f\\circ(g_1,\\dots,g_k)) = \\xi(f)\\circ(\\xi(g_1),\\dots,\\xi(g_k))$$\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex8.m1\" class=\"ltx_Math\" alttext=\"\\xi(f\\circ(g_{1},\\dots,g_{k}))=\\xi(f)\\circ(\\xi(g_{1}),\\dots,\\xi(g_{k}))\" display=\"block\"><mrow><mrow><mi>\u03be</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mrow><mi>f</mi><mo>\u2218</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>g</mi><mn>1</mn></msub><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msub><mi>g</mi><mi>k</mi></msub><mo stretchy=\"false\">)</mo></mrow></mrow><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mrow><mrow><mi>\u03be</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>f</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2218</mo><mrow><mo stretchy=\"false\">(</mo><mrow><mi>\u03be</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>g</mi><mn>1</mn></msub><mo stretchy=\"false\">)</mo></mrow></mrow><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><mrow><mi>\u03be</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>g</mi><mi>k</mi></msub><mo stretchy=\"false\">)</mo></mrow></mrow><mo stretchy=\"false\">)</mo></mrow></mrow></mrow></math>", "type": "latex"}, {"file": "1601.04520.tex", "nexttext": "\n for all $k$-ary $f\\in{\\mathscr C}$\nand projections $\\pi_{i_1}^m,\\dots,\\pi_{i_k}^m$.\nLet $U$ be a set of unary operations. We say that $\\xi$\n\\emph{preserves left-composition with operations in $U$} if for every $f\\in{\\mathscr C}$\nand every $e\\in U$, we have $\\xi(e\\circ f)=\\xi(e)\\circ\\xi(f)$.\n\nA function of arity $k \\geq 2$ is a \\emph{weak near-unanimity}~\\cite{MarotiMcKenzie}\nif it satisfies the equations\n\n", "itemtype": "equation", "pos": 37007, "prevtext": "\nholds for all $f,g_1,\\dots,g_k\\in{\\mathscr C}$.\nA weaker notion of homomorphism between clones has recently been defined in~\\cite{wonderland}.\nA function $\\xi\\colon{\\mathscr C}\\to{\\mathscr D}$ is an \\emph{h1 clone homomorphism}\nif it satisfies\n\n", "index": 11, "text": "$$\\xi(f\\circ(\\pi_{i_1}^m,\\dots,\\pi_{i_k}^m)) = \\xi(f)\\circ(\\pi_{i_1}^m,\\dots,\\pi_{i_k}^m)$$\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex9.m1\" class=\"ltx_Math\" alttext=\"\\xi(f\\circ(\\pi_{i_{1}}^{m},\\dots,\\pi_{i_{k}}^{m}))=\\xi(f)\\circ(\\pi_{i_{1}}^{m}%&#10;,\\dots,\\pi_{i_{k}}^{m})\" display=\"block\"><mrow><mrow><mi>\u03be</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mrow><mi>f</mi><mo>\u2218</mo><mrow><mo stretchy=\"false\">(</mo><msubsup><mi>\u03c0</mi><msub><mi>i</mi><mn>1</mn></msub><mi>m</mi></msubsup><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msubsup><mi>\u03c0</mi><msub><mi>i</mi><mi>k</mi></msub><mi>m</mi></msubsup><mo stretchy=\"false\">)</mo></mrow></mrow><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mrow><mrow><mi>\u03be</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>f</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2218</mo><mrow><mo stretchy=\"false\">(</mo><msubsup><mi>\u03c0</mi><msub><mi>i</mi><mn>1</mn></msub><mi>m</mi></msubsup><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msubsup><mi>\u03c0</mi><msub><mi>i</mi><mi>k</mi></msub><mi>m</mi></msubsup><mo stretchy=\"false\">)</mo></mrow></mrow></mrow></math>", "type": "latex"}, {"file": "1601.04520.tex", "nexttext": "\nfor all $x,y\\in A$.\nAn operation $f$ of arity $k \\geq 2$ is said to be \\emph{cyclic} (see~\\cite{Cyclic})\nif it satisfies $f({\\mathbf x}) = f(\\sigma{\\mathbf x})$ for every ${\\mathbf x}=(x_1,\\dots,x_k)$,\nwhere $\\sigma$ maps $(x_1,\\dots,x_k)$ to $(x_2,\\dots,x_k,x_1)$.\nA 6-ary function $f\\colon A^6\\to A$ is \\emph{Siggers} (see~\\cite{Siggers})\nif it satisfies $f(x,y,x,z,y,z) = f(y,x,z,x,z,y)$\nfor all $x,y,z \\in A$. \nThe following is a combination of several results, old and new. \n\n\\begin{thm}\\label{thm:finite}\nFor finite idempotent algebras ${\\bf A}$, 1.-7. are equivalent. \n\\begin{enumerate}\n\\item There is no clone homomorphism from\n${\\operatorname{Clo}}({\\bf A})$ \nto $\\bf 2$;\n\\item There is no h1 clone homomorphism from \n${\\operatorname{Clo}}({\\bf A})$ to ${\\bf 2}$~\\cite{wonderland};\n\\item ${\\operatorname{\\mathsf{HSP}_{fin}}}({\\bf A})$ does not contain a $2$-element algebra all of whose operations are projections~\\cite{Bir-On-the-structure};\n\\item ${\\operatorname{\\mathsf{HS}}}({\\bf A})$ does not contain a $2$-element algebra all of whose operations are projections (Proposition 4.14 from~\\cite{BulatovJeavons});\n\\item ${\\operatorname{Clo}}({\\bf A})$ contains a weak near-unanimity operation~\\cite{MarotiMcKenzie};\n\\item ${\\operatorname{Clo}}({\\bf A})$ contains a cyclic operation~\\cite{Cyclic};\n\\item ${\\operatorname{Clo}}({\\bf A})$ contains a Siggers operation~\\cite{Siggers}. \n\\end{enumerate}\n\\end{thm}\nFor not necessarily idempotent finite algebras, this theorem fails in general, but items 2, 5, 6, 7 are still equivalent (see~\\cite{wonderland}). \nLet ${{\\mathbb A}}$ be a relational structure with finite domain and finite signature, and let ${\\bf A}$ be an algebra such that ${\\operatorname{Clo}}({\\bf A})={\\operatorname{Pol}}({\\mathbb A})$. Then the \\emph{tractability conjecture} for finite-domain CSPs\nstates that CSP$({\\mathbb A})$ is polynomial-time tractable if and only if $\\bf A$ satisfies item 2, 5, 6, or 7 in Theorem~\\ref{thm:finite}. \n\n\\subsection*{The Topology of Pointwise Convergence}\nTo study potential analogs of Theorem~\\ref{thm:finite} for algebras on infinite domains,\ntopological concepts become important. A function clone comes naturally equipped with a topology, namely the topology of pointwise convergence where $D$ is a discrete space. This topology\nis characterised by the fact that a sequence $(f_i)_{i\\in\\omega}$ converges to $f$ if, and only if, for every finite subset $S$ of $D$ there exists\nan $i_0\\in\\omega$ such that for all $i\\geq i_0$, we have that $f_i$ and $f$ coincide on $S$.\nGiven a relational structure ${\\mathbb A}$, the set ${\\operatorname{Pol}}({\\mathbb A})$ is a function clone\nover $A$ which is topologically closed in the full clone over $A$ (the clone\nconsisting of all the functions of finite arity over $A$).\n\n\nLet $f,g$ be operations over $D$ and let $U$ be a subset of $\\mathrm{Sym}(D)$.\nWhen the topological closure of\n$\\{\\alpha\\circ f\\circ(\\beta_1,\\dots,\\beta_k) \\mid \\alpha,\\beta_i\\in U\\}$ contains $g$,\nwe say that $g$ is \\emph{interpolated by $f$ modulo $U$}.\n\n  \n\\subsection*{Siggers operations modulo unary operations}\nAnother important question when generalising Theorem~\\ref{thm:finite} to infinite domains is how to replace the last three items involving weak near-unanimity operations, cyclic operations, and Siggers operations. \n  Given two unary operations $e_1,e_2$,\nwe say that a function is \\emph{Siggers modulo $e_1,e_2$}\nif for all $x,y,z$ in $A$, we have $e_1(f(x,y,x,z,y,z))=e_2 (f(y,x,z,x,z,y))$.\nWe define similarly \\emph{weak near-unanimity operations modulo $e_1,\\dots,e_k$} and\n\\emph{cyclic operations modulo $e_1,e_2$}. \n\n\n\n\\subsection*{Canonical Functions}\nLet $f\\colon A^k\\to A$, and let ${\\mathbb A}$ be a relational structure on $A$. We say that $f$ is \\emph{canonical with respect to ${\\mathbb A}$}\n   if for all $m\\in{\\mathbb N},\\alpha_1,\\dots,\\alpha_k\\in{\\operatorname{Aut}}({\\mathbb A})$ and all $m$-tuples ${\\mathbf a}_1,\\dots,{\\mathbf a}_k$, there exists\n$\\beta\\in{\\operatorname{Aut}}({\\mathbb A})$ such that $\\beta f(\\alpha_1{\\mathbf a}_1,\\dots,\\alpha_k{\\mathbf a}_k) = f({\\mathbf a}_1,\\dots,{\\mathbf a}_k)$.\nEquivalently, this means that $f$ induces a function $\\xi^{\\mathrm{typ}}_m(f)$ on orbits of $m$-tuples under ${\\operatorname{Aut}}({\\mathbb A})$,\nby defining $\\xi^{\\mathrm{typ}}_m(f)(O_1,\\dots,O_k)$ as the orbit of $f({\\mathbf a}_1,\\dots,{\\mathbf a}_k)$,\nwhere ${\\mathbf a}_i$ is any $m$-tuple in $O_i$.\nAutomorphisms of ${\\mathbb A}$ are canonical functions with respect to ${\\mathbb A}$, and so are the projections.\nWe can also check that the composition of canonical functions is again canonical.\nTherefore, if ${\\mathscr C}$ is a function clone that contains ${\\operatorname{Aut}}({\\mathbb A})$, the set ${\\mathscr D}$ of operations of ${\\mathscr C}$ that are canonical with respect to ${\\mathbb A}$\nis again a function clone that contains ${\\operatorname{Aut}}({\\mathbb A})$. We call this clone ${\\mathscr D}$ the \\emph{canonical subclone} of ${\\mathscr C}$.\nFor all $m\\in{\\mathbb N}$, the set that consists of the functions $\\xi^{\\mathrm{typ}}_m(f)$ for $f\\in{\\mathscr C}$ is a function clone\n${\\mathscr D}^{\\mathrm{typ}}_m$ on the set of orbits of $m$-tuples. The application $\\xi^{\\mathrm{typ}}_m\\colon{\\mathscr D}\\to{\\mathscr D}^{\\mathrm{typ}}_m$\nis easily seen to be a continuous clone homomorphism.\nFor a more detailed exposition of these functions, we refer the reader to the section 6 of~\\cite{BPP-projective-homomorphisms}.\n\n\\subsection*{Abstract Tractability Conditions}\nIt is known that the complexity of ${\\operatorname{CSP}}({\\mathbb A})$\nfor $\\omega$-categorical structures ${\\mathbb A}$ only\ndepends on the polymorphism clone of ${\\mathbb A}$\nviewed as a \\emph{topological clone}~\\cite{Topo-Birk}.\nHowever, most of the known conditions that\nimply that ${\\operatorname{CSP}}({\\mathbb A})$ is in P are not formulated\nin terms of the topological polymorphism clone of ${\\mathbb A}$, but in terms of the \\emph{concrete} polymorphism clone of ${\\mathbb A}$ (that is, we have to know the polymorphisms as functions from ${\\mathbb A}^k$ to ${\\mathbb A}$, \nnot just the topology on the set of all polymorphisms and the way polymorphisms compose). \nOne notable exception is tractability from \\emph{quasi near unanimity polymorphisms},\nthat is, polymorphisms that satisfy the identity\n\n", "itemtype": "equation", "pos": 37508, "prevtext": "\n for all $k$-ary $f\\in{\\mathscr C}$\nand projections $\\pi_{i_1}^m,\\dots,\\pi_{i_k}^m$.\nLet $U$ be a set of unary operations. We say that $\\xi$\n\\emph{preserves left-composition with operations in $U$} if for every $f\\in{\\mathscr C}$\nand every $e\\in U$, we have $\\xi(e\\circ f)=\\xi(e)\\circ\\xi(f)$.\n\nA function of arity $k \\geq 2$ is a \\emph{weak near-unanimity}~\\cite{MarotiMcKenzie}\nif it satisfies the equations\n\n", "index": 13, "text": "$$f(y,x,\\dots,x)=f(x,y,x,\\dots,x)=\\dots=f(x,\\dots,x,y)$$\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex10.m1\" class=\"ltx_Math\" alttext=\"f(y,x,\\dots,x)=f(x,y,x,\\dots,x)=\\dots=f(x,\\dots,x,y)\" display=\"block\"><mrow><mrow><mi>f</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>y</mi><mo>,</mo><mi>x</mi><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mrow><mi>f</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>x</mi><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mi mathvariant=\"normal\">\u2026</mi><mo>=</mo><mrow><mi>f</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy=\"false\">)</mo></mrow></mrow></mrow></math>", "type": "latex"}, {"file": "1601.04520.tex", "nexttext": "\nIf ${\\mathbb A}$ has a quasi near unanimity polymorphism\nthen ${\\operatorname{CSP}}({\\mathbb A})$ is in P \nby a result from~\\cite{BodDalJournal}. In fact, this tractability condition is formulated in terms of the \\emph{abstract clone}, that is, we do not refer to topological concepts to formulate it. We call such a condition an\n\\emph{abstract tractability condition}. \n\n\nThe following lemma connects the polymorphism clone of a structure ${\\mathbb A}$ with the polymorphism\nclone of its associated type structure ${T_{\\mB,m}}({\\mathbb A})$.\n\\begin{lemma}\\label{lem:polymorphisms-type-algebra}\n    Let ${\\mathbb A}$ be a reduct of ${\\mathbb B}$, where ${\\mathbb B}$ is a finitely bounded structure.\n    Let $m\\in{\\mathbb N}$.\n    If $f$ is a polymorphism of ${\\mathbb A}$ which is canonical with respect to ${\\mathbb B}$,\n    then $\\xi^{\\mathrm{typ}}_m(f)$ is a polymorphism of $T_{{\\mathbb B},m}({\\mathbb A})$.\n\\end{lemma}\n\\begin{proof}\n    Let $k$ be the arity of $f$, let $i \\colon [r] \\to [m]$, \n    and let $p_1,\\dots,p_k$ be types in $\\langle\\chi(z_{i(1)},\\dots,z_{i(r)})\\rangle$.\n    Let ${\\mathbf a}^1,\\dots,{\\mathbf a}^k$ be $m$-tuples whose types are $p_1,\\dots,p_k$ respectively.\n    By definition, we have that $\\xi^{\\mathrm{typ}}_m(f)(p_1,\\dots,p_k)$ is the type of $f({\\mathbf a}^1,\\dots,{\\mathbf a}^k)$ in ${\\mathbb B}$.\n    Since $f$ preserves the relation defined by $\\chi(z_{i(1)},\\dots,z_{i(r)})$,\n    it follows that $f({\\mathbf a}^1,\\dots,{\\mathbf a}^k)$ satisfies $\\chi(z_{i(1)},\\dots,z_{i(r)})$,\n    which means that the type of this tuple contains $\\chi(z_{i(1)},\\dots,z_{i(r)})$, and therefore $\\xi^{\\mathrm{typ}}_m(f)$\n    preserves the relations of the first type.\n   \n    We now prove that the relations of the second type in $T_{{\\mathbb B},m}({\\mathbb A})$\n    are preserved by $\\xi^{\\mathrm{typ}}_m(f)$ for any function $f$ which is canonical with respect to ${\\mathbb B}$.\n    Indeed, let $(p_1,q_1),\\dots,(p_k,q_k)$ be pairs of types in $\\mathrm{Comp}_{i,j}$.\n    \n    Let $({\\mathbf a}^1,{\\mathbf b}^1)$,\\dots,\n    $({\\mathbf a}^k,{\\mathbf b}^k)$ be pairs of $m$-tuples such that ${\\mathrm{tp}}({\\mathbf a}^l)=p_l$ and ${\\mathrm{tp}}({\\mathbf b}^l)=q_l$ for all $l \\in [k]$. \n    \n    As noted above, the definition of $\\mathrm{Comp}_{i,j}$\n    implies that the tuples $(a^l_{i(1)},\\dots,a^l_{i(r)})$\n    and $(b^l_{j(1)},\\dots,b^l_{j(r)})$ have the same type in ${\\mathbb B}$ for all $l\\in[k]$.\n    Since $f$ is canonical, we have that $(f(a^1_{i(1)},\\dots,a^k_{i(1)}),\\dots,f(a^1_{i(r)},\\dots,a^k_{i(r)}))$\n    has the same type as $(f(b^1_{j(1)},\\dots,b^k_{j(1)}),\\dots,f(b^1_{j(r)},\\dots,b^k_{j(r)}))$ in ${\\mathbb B}$. \n    This implies that \n", "itemtype": "equation", "pos": 43879, "prevtext": "\nfor all $x,y\\in A$.\nAn operation $f$ of arity $k \\geq 2$ is said to be \\emph{cyclic} (see~\\cite{Cyclic})\nif it satisfies $f({\\mathbf x}) = f(\\sigma{\\mathbf x})$ for every ${\\mathbf x}=(x_1,\\dots,x_k)$,\nwhere $\\sigma$ maps $(x_1,\\dots,x_k)$ to $(x_2,\\dots,x_k,x_1)$.\nA 6-ary function $f\\colon A^6\\to A$ is \\emph{Siggers} (see~\\cite{Siggers})\nif it satisfies $f(x,y,x,z,y,z) = f(y,x,z,x,z,y)$\nfor all $x,y,z \\in A$. \nThe following is a combination of several results, old and new. \n\n\\begin{thm}\\label{thm:finite}\nFor finite idempotent algebras ${\\bf A}$, 1.-7. are equivalent. \n\\begin{enumerate}\n\\item There is no clone homomorphism from\n${\\operatorname{Clo}}({\\bf A})$ \nto $\\bf 2$;\n\\item There is no h1 clone homomorphism from \n${\\operatorname{Clo}}({\\bf A})$ to ${\\bf 2}$~\\cite{wonderland};\n\\item ${\\operatorname{\\mathsf{HSP}_{fin}}}({\\bf A})$ does not contain a $2$-element algebra all of whose operations are projections~\\cite{Bir-On-the-structure};\n\\item ${\\operatorname{\\mathsf{HS}}}({\\bf A})$ does not contain a $2$-element algebra all of whose operations are projections (Proposition 4.14 from~\\cite{BulatovJeavons});\n\\item ${\\operatorname{Clo}}({\\bf A})$ contains a weak near-unanimity operation~\\cite{MarotiMcKenzie};\n\\item ${\\operatorname{Clo}}({\\bf A})$ contains a cyclic operation~\\cite{Cyclic};\n\\item ${\\operatorname{Clo}}({\\bf A})$ contains a Siggers operation~\\cite{Siggers}. \n\\end{enumerate}\n\\end{thm}\nFor not necessarily idempotent finite algebras, this theorem fails in general, but items 2, 5, 6, 7 are still equivalent (see~\\cite{wonderland}). \nLet ${{\\mathbb A}}$ be a relational structure with finite domain and finite signature, and let ${\\bf A}$ be an algebra such that ${\\operatorname{Clo}}({\\bf A})={\\operatorname{Pol}}({\\mathbb A})$. Then the \\emph{tractability conjecture} for finite-domain CSPs\nstates that CSP$({\\mathbb A})$ is polynomial-time tractable if and only if $\\bf A$ satisfies item 2, 5, 6, or 7 in Theorem~\\ref{thm:finite}. \n\n\\subsection*{The Topology of Pointwise Convergence}\nTo study potential analogs of Theorem~\\ref{thm:finite} for algebras on infinite domains,\ntopological concepts become important. A function clone comes naturally equipped with a topology, namely the topology of pointwise convergence where $D$ is a discrete space. This topology\nis characterised by the fact that a sequence $(f_i)_{i\\in\\omega}$ converges to $f$ if, and only if, for every finite subset $S$ of $D$ there exists\nan $i_0\\in\\omega$ such that for all $i\\geq i_0$, we have that $f_i$ and $f$ coincide on $S$.\nGiven a relational structure ${\\mathbb A}$, the set ${\\operatorname{Pol}}({\\mathbb A})$ is a function clone\nover $A$ which is topologically closed in the full clone over $A$ (the clone\nconsisting of all the functions of finite arity over $A$).\n\n\nLet $f,g$ be operations over $D$ and let $U$ be a subset of $\\mathrm{Sym}(D)$.\nWhen the topological closure of\n$\\{\\alpha\\circ f\\circ(\\beta_1,\\dots,\\beta_k) \\mid \\alpha,\\beta_i\\in U\\}$ contains $g$,\nwe say that $g$ is \\emph{interpolated by $f$ modulo $U$}.\n\n  \n\\subsection*{Siggers operations modulo unary operations}\nAnother important question when generalising Theorem~\\ref{thm:finite} to infinite domains is how to replace the last three items involving weak near-unanimity operations, cyclic operations, and Siggers operations. \n  Given two unary operations $e_1,e_2$,\nwe say that a function is \\emph{Siggers modulo $e_1,e_2$}\nif for all $x,y,z$ in $A$, we have $e_1(f(x,y,x,z,y,z))=e_2 (f(y,x,z,x,z,y))$.\nWe define similarly \\emph{weak near-unanimity operations modulo $e_1,\\dots,e_k$} and\n\\emph{cyclic operations modulo $e_1,e_2$}. \n\n\n\n\\subsection*{Canonical Functions}\nLet $f\\colon A^k\\to A$, and let ${\\mathbb A}$ be a relational structure on $A$. We say that $f$ is \\emph{canonical with respect to ${\\mathbb A}$}\n   if for all $m\\in{\\mathbb N},\\alpha_1,\\dots,\\alpha_k\\in{\\operatorname{Aut}}({\\mathbb A})$ and all $m$-tuples ${\\mathbf a}_1,\\dots,{\\mathbf a}_k$, there exists\n$\\beta\\in{\\operatorname{Aut}}({\\mathbb A})$ such that $\\beta f(\\alpha_1{\\mathbf a}_1,\\dots,\\alpha_k{\\mathbf a}_k) = f({\\mathbf a}_1,\\dots,{\\mathbf a}_k)$.\nEquivalently, this means that $f$ induces a function $\\xi^{\\mathrm{typ}}_m(f)$ on orbits of $m$-tuples under ${\\operatorname{Aut}}({\\mathbb A})$,\nby defining $\\xi^{\\mathrm{typ}}_m(f)(O_1,\\dots,O_k)$ as the orbit of $f({\\mathbf a}_1,\\dots,{\\mathbf a}_k)$,\nwhere ${\\mathbf a}_i$ is any $m$-tuple in $O_i$.\nAutomorphisms of ${\\mathbb A}$ are canonical functions with respect to ${\\mathbb A}$, and so are the projections.\nWe can also check that the composition of canonical functions is again canonical.\nTherefore, if ${\\mathscr C}$ is a function clone that contains ${\\operatorname{Aut}}({\\mathbb A})$, the set ${\\mathscr D}$ of operations of ${\\mathscr C}$ that are canonical with respect to ${\\mathbb A}$\nis again a function clone that contains ${\\operatorname{Aut}}({\\mathbb A})$. We call this clone ${\\mathscr D}$ the \\emph{canonical subclone} of ${\\mathscr C}$.\nFor all $m\\in{\\mathbb N}$, the set that consists of the functions $\\xi^{\\mathrm{typ}}_m(f)$ for $f\\in{\\mathscr C}$ is a function clone\n${\\mathscr D}^{\\mathrm{typ}}_m$ on the set of orbits of $m$-tuples. The application $\\xi^{\\mathrm{typ}}_m\\colon{\\mathscr D}\\to{\\mathscr D}^{\\mathrm{typ}}_m$\nis easily seen to be a continuous clone homomorphism.\nFor a more detailed exposition of these functions, we refer the reader to the section 6 of~\\cite{BPP-projective-homomorphisms}.\n\n\\subsection*{Abstract Tractability Conditions}\nIt is known that the complexity of ${\\operatorname{CSP}}({\\mathbb A})$\nfor $\\omega$-categorical structures ${\\mathbb A}$ only\ndepends on the polymorphism clone of ${\\mathbb A}$\nviewed as a \\emph{topological clone}~\\cite{Topo-Birk}.\nHowever, most of the known conditions that\nimply that ${\\operatorname{CSP}}({\\mathbb A})$ is in P are not formulated\nin terms of the topological polymorphism clone of ${\\mathbb A}$, but in terms of the \\emph{concrete} polymorphism clone of ${\\mathbb A}$ (that is, we have to know the polymorphisms as functions from ${\\mathbb A}^k$ to ${\\mathbb A}$, \nnot just the topology on the set of all polymorphisms and the way polymorphisms compose). \nOne notable exception is tractability from \\emph{quasi near unanimity polymorphisms},\nthat is, polymorphisms that satisfy the identity\n\n", "index": 15, "text": "\\begin{align*}\n    f(y,x,\\dots,x) &= f(x,y,x,\\dots,x) = \\cdots \\\\&= f(x,\\dots,x,y) = f(x,\\dots,x).\n\\end{align*}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex11.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle f(y,x,\\dots,x)\" display=\"inline\"><mrow><mi>f</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>y</mi><mo>,</mo><mi>x</mi><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex11.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle=f(x,y,x,\\dots,x)=\\cdots\" display=\"inline\"><mrow><mi/><mo>=</mo><mrow><mi>f</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>x</mi><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mi mathvariant=\"normal\">\u22ef</mi></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex12.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle=f(x,\\dots,x,y)=f(x,\\dots,x).\" display=\"inline\"><mrow><mrow><mi/><mo>=</mo><mrow><mi>f</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mrow><mi>f</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow></mrow></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.04520.tex", "nexttext": "\n    holds, which concludes the proof. \n\\end{proof}\n\nOne of the main results of this paper, Theorem~\\ref{thm:types-tractable-implies-structure-tractable},\nyields a series of new abstract tractability conditions:\nfor every known abstract tractability condition for finite domain CSPs, we obtain an abstract\ntractability condition for \nreducts of finitely bounded homogeneous structures ${\\mathbb B}$. \nTo demonstrate this, we first observe that\n the polymorphisms of ${\\mathbb A}$ that are canonical with respect to ${\\mathbb A}$ can be characterised algebraically. \n\n\n\\begin{proposition}\\label{prop:can-alg}\nLet ${\\mathbb B}$ be a homogeneous structure with a finite relational language, and assume that\n${\\operatorname{Aut}}({\\mathbb B})$ is dense in ${\\operatorname{End}}({\\mathbb B})$. \nLet $f \\in {\\operatorname{Pol}}({\\mathbb B})$ \n\nbe $n$-ary. \nThen $f$ is canonical with\nrespect to ${\\mathbb B}$ if and only if \nfor all \n$a_1,\\dots,a_n \\in {\\operatorname{End}}({\\mathbb B})$ \nthere exist \n$e_1,e_2 \\in {\\operatorname{End}}({\\mathbb B})$ \n such that \n\n", "itemtype": "equation", "pos": 46673, "prevtext": "\nIf ${\\mathbb A}$ has a quasi near unanimity polymorphism\nthen ${\\operatorname{CSP}}({\\mathbb A})$ is in P \nby a result from~\\cite{BodDalJournal}. In fact, this tractability condition is formulated in terms of the \\emph{abstract clone}, that is, we do not refer to topological concepts to formulate it. We call such a condition an\n\\emph{abstract tractability condition}. \n\n\nThe following lemma connects the polymorphism clone of a structure ${\\mathbb A}$ with the polymorphism\nclone of its associated type structure ${T_{\\mB,m}}({\\mathbb A})$.\n\\begin{lemma}\\label{lem:polymorphisms-type-algebra}\n    Let ${\\mathbb A}$ be a reduct of ${\\mathbb B}$, where ${\\mathbb B}$ is a finitely bounded structure.\n    Let $m\\in{\\mathbb N}$.\n    If $f$ is a polymorphism of ${\\mathbb A}$ which is canonical with respect to ${\\mathbb B}$,\n    then $\\xi^{\\mathrm{typ}}_m(f)$ is a polymorphism of $T_{{\\mathbb B},m}({\\mathbb A})$.\n\\end{lemma}\n\\begin{proof}\n    Let $k$ be the arity of $f$, let $i \\colon [r] \\to [m]$, \n    and let $p_1,\\dots,p_k$ be types in $\\langle\\chi(z_{i(1)},\\dots,z_{i(r)})\\rangle$.\n    Let ${\\mathbf a}^1,\\dots,{\\mathbf a}^k$ be $m$-tuples whose types are $p_1,\\dots,p_k$ respectively.\n    By definition, we have that $\\xi^{\\mathrm{typ}}_m(f)(p_1,\\dots,p_k)$ is the type of $f({\\mathbf a}^1,\\dots,{\\mathbf a}^k)$ in ${\\mathbb B}$.\n    Since $f$ preserves the relation defined by $\\chi(z_{i(1)},\\dots,z_{i(r)})$,\n    it follows that $f({\\mathbf a}^1,\\dots,{\\mathbf a}^k)$ satisfies $\\chi(z_{i(1)},\\dots,z_{i(r)})$,\n    which means that the type of this tuple contains $\\chi(z_{i(1)},\\dots,z_{i(r)})$, and therefore $\\xi^{\\mathrm{typ}}_m(f)$\n    preserves the relations of the first type.\n   \n    We now prove that the relations of the second type in $T_{{\\mathbb B},m}({\\mathbb A})$\n    are preserved by $\\xi^{\\mathrm{typ}}_m(f)$ for any function $f$ which is canonical with respect to ${\\mathbb B}$.\n    Indeed, let $(p_1,q_1),\\dots,(p_k,q_k)$ be pairs of types in $\\mathrm{Comp}_{i,j}$.\n    \n    Let $({\\mathbf a}^1,{\\mathbf b}^1)$,\\dots,\n    $({\\mathbf a}^k,{\\mathbf b}^k)$ be pairs of $m$-tuples such that ${\\mathrm{tp}}({\\mathbf a}^l)=p_l$ and ${\\mathrm{tp}}({\\mathbf b}^l)=q_l$ for all $l \\in [k]$. \n    \n    As noted above, the definition of $\\mathrm{Comp}_{i,j}$\n    implies that the tuples $(a^l_{i(1)},\\dots,a^l_{i(r)})$\n    and $(b^l_{j(1)},\\dots,b^l_{j(r)})$ have the same type in ${\\mathbb B}$ for all $l\\in[k]$.\n    Since $f$ is canonical, we have that $(f(a^1_{i(1)},\\dots,a^k_{i(1)}),\\dots,f(a^1_{i(r)},\\dots,a^k_{i(r)}))$\n    has the same type as $(f(b^1_{j(1)},\\dots,b^k_{j(1)}),\\dots,f(b^1_{j(r)},\\dots,b^k_{j(r)}))$ in ${\\mathbb B}$. \n    This implies that \n", "index": 17, "text": "$$\\mathrm{Comp}_{i,j} \\big (\\xi^{\\mathrm{typ}}_m(f)(p_1,\\dots,p_k),\\xi^{\\mathrm{typ}}_m(f)(q_1,\\dots,q_k) \\big )$$\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex13.m1\" class=\"ltx_Math\" alttext=\"\\mathrm{Comp}_{i,j}\\big{(}\\xi^{\\mathrm{typ}}_{m}(f)(p_{1},\\dots,p_{k}),\\xi^{%&#10;\\mathrm{typ}}_{m}(f)(q_{1},\\dots,q_{k})\\big{)}\" display=\"block\"><mrow><msub><mi>Comp</mi><mrow><mi>i</mi><mo>,</mo><mi>j</mi></mrow></msub><mo>\u2062</mo><mrow><mo maxsize=\"120%\" minsize=\"120%\">(</mo><mrow><msubsup><mi>\u03be</mi><mi>m</mi><mi>typ</mi></msubsup><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>f</mi><mo stretchy=\"false\">)</mo></mrow><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>p</mi><mn>1</mn></msub><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msub><mi>p</mi><mi>k</mi></msub><mo stretchy=\"false\">)</mo></mrow></mrow><mo>,</mo><mrow><msubsup><mi>\u03be</mi><mi>m</mi><mi>typ</mi></msubsup><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>f</mi><mo stretchy=\"false\">)</mo></mrow><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>q</mi><mn>1</mn></msub><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msub><mi>q</mi><mi>k</mi></msub><mo stretchy=\"false\">)</mo></mrow></mrow><mo maxsize=\"120%\" minsize=\"120%\">)</mo></mrow></mrow></math>", "type": "latex"}, {"file": "1601.04520.tex", "nexttext": "\n\\end{proposition}\n\\begin{proof}\nFirst suppose that $f$ is canonical with respect to \n${\\mathbb A}$, and let $a_1,\\dots,a_n \\in \n {\\operatorname{End}}({\\mathbb B})$. \n \n\nNote that $\\xi^{\\mathrm{typ}}_{\\infty}(a_i) = \\pi_1^1$, and hence\n$\\xi_\\infty^{\\mathrm{typ}}(f \\circ (a_1,\\dots,a_n)) = \\xi_\\infty^{\\mathrm{typ}}(f)$. \n\nProposition 6.6 from~\\cite{BPP-projective-homomorphisms} implies that there exist $e_1,e_2 \\in \\overline{{\\operatorname{Aut}}({\\mathbb B})} = {\\operatorname{End}}({\\mathbb B})$ \n\nsuch that $e_1 \\circ f \\circ (a_1,\\dots,a_n)) = e_2 \\circ f$. \nThe converse direction of the statement is straightforward to prove. \n\n\n\\end{proof}\n\nProposition~\\ref{prop:can-alg} implies that the following \nis essentially an abstract tractability condition (the assumption that $\\overline{{\\operatorname{Aut}}({\\mathbb B})} = {\\operatorname{End}}({\\mathbb B})$ is not a severe restriction, and will be discussed in Section~\\ref{sect:lift}). \n\n\\begin{thm}\\label{thm:canonical-datalog}\nLet ${\\mathbb A}$ be a finite-signature reduct of\na finitely bounded homogeneous structure ${\\mathbb B}$\nsuch that ${\\operatorname{Aut}}({\\mathbb B})$ is dense in ${\\operatorname{End}}({\\mathbb B})$. \nSuppose that ${\\mathbb A}$ has a four-ary polymorphism $f$\nand a ternary polymorphism $g$ that are \ncanonical with respect to ${\\mathbb B}$, that are \nweak near-unanimity operations modulo ${\\operatorname{End}}({\\mathbb B})$, and such that there are \noperations $e_1,e_2$ in ${\\operatorname{End}}({\\mathbb B})$ with \n$e_1(f(y,x,x,x)) = e_2(g(y,x,x))$ for all $x,y$. \nThen ${\\operatorname{CSP}}({\\mathbb A})$ is in P. \n\\end{thm}\n\\begin{proof}\nLet $m$ be as in Section~\\ref{sect:csps}. \nBy Lemma~\\ref{lem:polymorphisms-type-algebra}, \n$f' := \\xi_m^{\\mathrm{typ}}(f)$ and $g' := \\xi_m^{\\mathrm{typ}}(g)$ are polymorphisms of $T_{{\\mathbb B},m}({\\mathbb A})$. Moreover,\n$f'$ and $g'$ must be weak near-unanimity operations,\nand they satisfy $f'(y,x,x,x) = g'(y,x,x)$. \nIt follows from~\\cite{Maltsev-Cond} in combination with~\\cite{BoundedWidth} that \n$T_{{\\mathbb B},m}({\\mathbb A})$ is in P (it can be solved by a Datalog program). Theorem~\\ref{thm:types-tractable-implies-structure-tractable}\nthen implies that ${\\operatorname{CSP}}({\\mathbb A})$ is in P, too. \n\\end{proof}\nNote that since the reduction from ${\\operatorname{CSP}}({\\mathbb A})$ to ${\\operatorname{CSP}}({T_{\\mB,m}}(A))$ presented in Section~\\ref{sect:csps} is a first-order reduction,\nit is computable in Datalog. In particular, the hypotheses of Theorem~\\ref{thm:canonical-datalog} imply that ${\\operatorname{CSP}}({\\mathbb A})$ is in Datalog.\n\nThis result generalises many algorithmic results from the literature, for instance \n\\begin{itemize}\n\\item the polynomial-time tractable fragments of RCC-5~\\cite{RCC5JD}; \n\\item the two polynomial-time algorithms for\npartially-ordered time from~\\cite{BroxvallJonsson};\n\\item polynomial-time equality constraints~\\cite{ecsps}; \n\\item all polynomial-time tractable equivalence CSPs~\\cite{equiv-csps}.\n\\end{itemize}\nIn all three cases, the respective structures ${\\mathbb A}$ have a polymorphism $f$ such that $\\xi^{\\mathrm{typ}}_2(f)$ is a semilattice operation, and consequently ${\\mathbb A}$ satisfies the assumptions of Theorem~\\ref{thm:canonical-datalog}. \n\n\nIn the same way \nas in Theorem~\\ref{thm:canonical-datalog} \nevery abstract \ntractability result for finite-domain CSPs \n\ncan be lifted to an abstract tractability condition\nfor $\\omega$-categorical CSPs.\n\n\nNote that the polynomial-time tractable cases in the recent classification for Graph-SAT problems~\\cite{BodPin-Schaefer-both} can also be explained with the help \nof Corollary~\\ref{cor:tract} below, assuming the finite-domain tractability conjecture. \nFinally, we mention that the non-trivial polynomial-time tractable cases \nfor reducts of $({\\mathbb Q};<)$ provide\nexamples that cannot be lifted from finite-domain tractability results in this way, since the respective languages do not have non-trivial \\emph{canonical} polymorphisms. \n\n\n\n\\begin{cor}\\label{cor:tract}\nLet ${\\mathbb A}$ be a finite-signature reduct of a finitely bounded \n$\\omega$-categorical structure ${\\mathbb B}$, and suppose that \n${\\mathbb A}$ has a Siggers (or weak nu) polymorphism $f$ modulo operations from $\\overline{{\\operatorname{Aut}}({\\mathbb B})}$ \nsuch that $f$ is canonical with respect to\n${\\mathbb B}$. Then ${\\operatorname{CSP}}({\\mathbb A})$ is in P, unless the\nfinite-domain tractability conjecture is false. \n\\end{cor}\n\\begin{proof}\nBy Lemma~\\ref{lem:polymorphisms-type-algebra},\n$\\xi^{\\mathrm{typ}}_m(f)$ is a polymorphism of $T_{{\\mathbb B},m}({\\mathbb A})$.\nSince $\\xi^{\\mathrm{typ}}_m(f)$ is a Siggers operation,\nthe tractability conjecture implies that ${\\operatorname{CSP}}(T_{{\\mathbb B},m}({\\mathbb A}))$\nis in P. Then \nTheorem~\\ref{thm:types-tractable-implies-structure-tractable} implies that ${\\operatorname{CSP}}({\\mathbb A})$ is in P. \n\\end{proof}\n\n\n\\section{Mashups}\n\\label{sect:mashups}\nThe final part of this paper is devoted to the study of finite-signature reducts \nof $({\\mathbb N};0,1,2,\\dots)$, and to prove that the tractability conjecture for finite-domain CSPs\nis equivalent to a similar tractability conjecture for this class of problems.\nThe ingredients of the proof of this fact are on the one hand Theorem~\\ref{thm:types-tractable-implies-structure-tractable} from Section~\\ref{sect:csps},\nand on the other hand new clone-theoretic methods of independent interest that we develop in this section. \nIn particular, we will prove Theorem~\\ref{thm:ua-result} \nstated in the introduction. \n\n\nFrom now on, $n$ is a fixed natural number. \nWe write $G_n$ for the group ${\\operatorname{Aut}}({\\mathbb N};0,\\dots,n-1)$\nof permutations that pointwise fix the integers $0,\\dots,n-1$.\nIf $F\\subset{\\mathbb N}^{{\\mathbb N}^k}$ we write $G_nF$\nfor the set\n$\\{\\alpha\\circ f \\mid \\alpha\\in G_n\\}$\nand $FG_n$ for $\\{f\\circ(\\beta_1,\\dots,\\beta_k)\\mid \\beta_1,\\dots,\\beta_k\\in G_n\\}$.\n\n\\begin{definition}\n\tLet $k$ be a positive integer, and let $g$ and $h$ be two $k$-ary operations over $\\{0,\\dots,n\\}$. \n\tSuppose that ${{g}|_{{\\{0,\\dots,n-1\\}}}} = {{h}|_{{\\{0,\\dots,n-1\\}}}}$.\n\tFor $\\ell\\in[k]$, a function $\\omega$ is an \\emph{$\\ell$-mashup of $g$ and $h$} if it is such that:\n\n", "itemtype": "equation", "pos": 47844, "prevtext": "\n    holds, which concludes the proof. \n\\end{proof}\n\nOne of the main results of this paper, Theorem~\\ref{thm:types-tractable-implies-structure-tractable},\nyields a series of new abstract tractability conditions:\nfor every known abstract tractability condition for finite domain CSPs, we obtain an abstract\ntractability condition for \nreducts of finitely bounded homogeneous structures ${\\mathbb B}$. \nTo demonstrate this, we first observe that\n the polymorphisms of ${\\mathbb A}$ that are canonical with respect to ${\\mathbb A}$ can be characterised algebraically. \n\n\n\\begin{proposition}\\label{prop:can-alg}\nLet ${\\mathbb B}$ be a homogeneous structure with a finite relational language, and assume that\n${\\operatorname{Aut}}({\\mathbb B})$ is dense in ${\\operatorname{End}}({\\mathbb B})$. \nLet $f \\in {\\operatorname{Pol}}({\\mathbb B})$ \n\nbe $n$-ary. \nThen $f$ is canonical with\nrespect to ${\\mathbb B}$ if and only if \nfor all \n$a_1,\\dots,a_n \\in {\\operatorname{End}}({\\mathbb B})$ \nthere exist \n$e_1,e_2 \\in {\\operatorname{End}}({\\mathbb B})$ \n such that \n\n", "index": 19, "text": "$$e_1 \\circ f \\circ (a_1,\\dots,a_n) = e_1 \\circ f \\, .$$\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex14.m1\" class=\"ltx_Math\" alttext=\"e_{1}\\circ f\\circ(a_{1},\\dots,a_{n})=e_{1}\\circ f\\,.\" display=\"block\"><mrow><mrow><mrow><msub><mi>e</mi><mn>1</mn></msub><mo>\u2218</mo><mi>f</mi><mo>\u2218</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>a</mi><mn>1</mn></msub><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msub><mi>a</mi><mi>n</mi></msub><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mrow><msub><mi>e</mi><mn>1</mn></msub><mo>\u2218</mo><mpadded width=\"+1.7pt\"><mi>f</mi></mpadded></mrow></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.04520.tex", "nexttext": "\n\n\\end{definition}\n\n\\begin{lemma}\\label{lem:mashup-implies-same-image}\n\tLet ${\\mathbf A}$ be an idempotent algebra over $\\{0,\\dots,n\\}$.\n\tSuppose that there is a $2$-element algebra in ${\\operatorname{\\mathsf{HS}}}({\\mathbf A})$\n\tall of whose operations are projections.\n\tLet ${\\mathbf S}$ be a subalgebra of ${\\mathbf A}$ and $f\\colon{\\mathbf S}\\to\\mathbf T$\n\tbe a surjective homomorphism\n\tsuch that $\\mathbf T$ contains only projections.\n\tLet $g^{{\\mathbf A}},h^{{\\mathbf A}}$ be fundamental operations of ${\\mathbf A}$ of arity $k$.\n\tIf for all $\\ell\\in [k]$, an $\\ell$-mashup of $g^{\\mathbf A}$ and $h^{\\mathbf A}$\n\tis a fundamental operation of ${\\mathbf A}$,\n\tthen $g^{\\mathbf T} = h^{\\mathbf T}$.\n\\end{lemma}\n\\begin{proof}\n    The algebra $\\mathbf T$ has two elements $a,b$.\t\n    Without loss of generality, we can assume that $f^{-1}(a)=m\\neq n$.\n    Let $m'$ be $f^{-1}(b)$.\n\tLet $\\ell$ be such that $g^{\\mathbf T}$ is the $\\ell$-th projection.\n\tLet $\\omega^{\\mathbf A}$ be an $\\ell$-mashup of $g^{\\mathbf A}$ and $h^{\\mathbf A}$.\n\tLet ${\\mathbf t}_j$\n\tbe the tuple whose entries are $a$, except for the $j$-th one which is $b$.\n\tThen we have for $j\\neq\\ell$:\n\t\n", "itemtype": "equation", "pos": 54146, "prevtext": "\n\\end{proposition}\n\\begin{proof}\nFirst suppose that $f$ is canonical with respect to \n${\\mathbb A}$, and let $a_1,\\dots,a_n \\in \n {\\operatorname{End}}({\\mathbb B})$. \n \n\nNote that $\\xi^{\\mathrm{typ}}_{\\infty}(a_i) = \\pi_1^1$, and hence\n$\\xi_\\infty^{\\mathrm{typ}}(f \\circ (a_1,\\dots,a_n)) = \\xi_\\infty^{\\mathrm{typ}}(f)$. \n\nProposition 6.6 from~\\cite{BPP-projective-homomorphisms} implies that there exist $e_1,e_2 \\in \\overline{{\\operatorname{Aut}}({\\mathbb B})} = {\\operatorname{End}}({\\mathbb B})$ \n\nsuch that $e_1 \\circ f \\circ (a_1,\\dots,a_n)) = e_2 \\circ f$. \nThe converse direction of the statement is straightforward to prove. \n\n\n\\end{proof}\n\nProposition~\\ref{prop:can-alg} implies that the following \nis essentially an abstract tractability condition (the assumption that $\\overline{{\\operatorname{Aut}}({\\mathbb B})} = {\\operatorname{End}}({\\mathbb B})$ is not a severe restriction, and will be discussed in Section~\\ref{sect:lift}). \n\n\\begin{thm}\\label{thm:canonical-datalog}\nLet ${\\mathbb A}$ be a finite-signature reduct of\na finitely bounded homogeneous structure ${\\mathbb B}$\nsuch that ${\\operatorname{Aut}}({\\mathbb B})$ is dense in ${\\operatorname{End}}({\\mathbb B})$. \nSuppose that ${\\mathbb A}$ has a four-ary polymorphism $f$\nand a ternary polymorphism $g$ that are \ncanonical with respect to ${\\mathbb B}$, that are \nweak near-unanimity operations modulo ${\\operatorname{End}}({\\mathbb B})$, and such that there are \noperations $e_1,e_2$ in ${\\operatorname{End}}({\\mathbb B})$ with \n$e_1(f(y,x,x,x)) = e_2(g(y,x,x))$ for all $x,y$. \nThen ${\\operatorname{CSP}}({\\mathbb A})$ is in P. \n\\end{thm}\n\\begin{proof}\nLet $m$ be as in Section~\\ref{sect:csps}. \nBy Lemma~\\ref{lem:polymorphisms-type-algebra}, \n$f' := \\xi_m^{\\mathrm{typ}}(f)$ and $g' := \\xi_m^{\\mathrm{typ}}(g)$ are polymorphisms of $T_{{\\mathbb B},m}({\\mathbb A})$. Moreover,\n$f'$ and $g'$ must be weak near-unanimity operations,\nand they satisfy $f'(y,x,x,x) = g'(y,x,x)$. \nIt follows from~\\cite{Maltsev-Cond} in combination with~\\cite{BoundedWidth} that \n$T_{{\\mathbb B},m}({\\mathbb A})$ is in P (it can be solved by a Datalog program). Theorem~\\ref{thm:types-tractable-implies-structure-tractable}\nthen implies that ${\\operatorname{CSP}}({\\mathbb A})$ is in P, too. \n\\end{proof}\nNote that since the reduction from ${\\operatorname{CSP}}({\\mathbb A})$ to ${\\operatorname{CSP}}({T_{\\mB,m}}(A))$ presented in Section~\\ref{sect:csps} is a first-order reduction,\nit is computable in Datalog. In particular, the hypotheses of Theorem~\\ref{thm:canonical-datalog} imply that ${\\operatorname{CSP}}({\\mathbb A})$ is in Datalog.\n\nThis result generalises many algorithmic results from the literature, for instance \n\\begin{itemize}\n\\item the polynomial-time tractable fragments of RCC-5~\\cite{RCC5JD}; \n\\item the two polynomial-time algorithms for\npartially-ordered time from~\\cite{BroxvallJonsson};\n\\item polynomial-time equality constraints~\\cite{ecsps}; \n\\item all polynomial-time tractable equivalence CSPs~\\cite{equiv-csps}.\n\\end{itemize}\nIn all three cases, the respective structures ${\\mathbb A}$ have a polymorphism $f$ such that $\\xi^{\\mathrm{typ}}_2(f)$ is a semilattice operation, and consequently ${\\mathbb A}$ satisfies the assumptions of Theorem~\\ref{thm:canonical-datalog}. \n\n\nIn the same way \nas in Theorem~\\ref{thm:canonical-datalog} \nevery abstract \ntractability result for finite-domain CSPs \n\ncan be lifted to an abstract tractability condition\nfor $\\omega$-categorical CSPs.\n\n\nNote that the polynomial-time tractable cases in the recent classification for Graph-SAT problems~\\cite{BodPin-Schaefer-both} can also be explained with the help \nof Corollary~\\ref{cor:tract} below, assuming the finite-domain tractability conjecture. \nFinally, we mention that the non-trivial polynomial-time tractable cases \nfor reducts of $({\\mathbb Q};<)$ provide\nexamples that cannot be lifted from finite-domain tractability results in this way, since the respective languages do not have non-trivial \\emph{canonical} polymorphisms. \n\n\n\n\\begin{cor}\\label{cor:tract}\nLet ${\\mathbb A}$ be a finite-signature reduct of a finitely bounded \n$\\omega$-categorical structure ${\\mathbb B}$, and suppose that \n${\\mathbb A}$ has a Siggers (or weak nu) polymorphism $f$ modulo operations from $\\overline{{\\operatorname{Aut}}({\\mathbb B})}$ \nsuch that $f$ is canonical with respect to\n${\\mathbb B}$. Then ${\\operatorname{CSP}}({\\mathbb A})$ is in P, unless the\nfinite-domain tractability conjecture is false. \n\\end{cor}\n\\begin{proof}\nBy Lemma~\\ref{lem:polymorphisms-type-algebra},\n$\\xi^{\\mathrm{typ}}_m(f)$ is a polymorphism of $T_{{\\mathbb B},m}({\\mathbb A})$.\nSince $\\xi^{\\mathrm{typ}}_m(f)$ is a Siggers operation,\nthe tractability conjecture implies that ${\\operatorname{CSP}}(T_{{\\mathbb B},m}({\\mathbb A}))$\nis in P. Then \nTheorem~\\ref{thm:types-tractable-implies-structure-tractable} implies that ${\\operatorname{CSP}}({\\mathbb A})$ is in P. \n\\end{proof}\n\n\n\\section{Mashups}\n\\label{sect:mashups}\nThe final part of this paper is devoted to the study of finite-signature reducts \nof $({\\mathbb N};0,1,2,\\dots)$, and to prove that the tractability conjecture for finite-domain CSPs\nis equivalent to a similar tractability conjecture for this class of problems.\nThe ingredients of the proof of this fact are on the one hand Theorem~\\ref{thm:types-tractable-implies-structure-tractable} from Section~\\ref{sect:csps},\nand on the other hand new clone-theoretic methods of independent interest that we develop in this section. \nIn particular, we will prove Theorem~\\ref{thm:ua-result} \nstated in the introduction. \n\n\nFrom now on, $n$ is a fixed natural number. \nWe write $G_n$ for the group ${\\operatorname{Aut}}({\\mathbb N};0,\\dots,n-1)$\nof permutations that pointwise fix the integers $0,\\dots,n-1$.\nIf $F\\subset{\\mathbb N}^{{\\mathbb N}^k}$ we write $G_nF$\nfor the set\n$\\{\\alpha\\circ f \\mid \\alpha\\in G_n\\}$\nand $FG_n$ for $\\{f\\circ(\\beta_1,\\dots,\\beta_k)\\mid \\beta_1,\\dots,\\beta_k\\in G_n\\}$.\n\n\\begin{definition}\n\tLet $k$ be a positive integer, and let $g$ and $h$ be two $k$-ary operations over $\\{0,\\dots,n\\}$. \n\tSuppose that ${{g}|_{{\\{0,\\dots,n-1\\}}}} = {{h}|_{{\\{0,\\dots,n-1\\}}}}$.\n\tFor $\\ell\\in[k]$, a function $\\omega$ is an \\emph{$\\ell$-mashup of $g$ and $h$} if it is such that:\n\n", "index": 21, "text": "\\[\n    \\omega(x_1,\\dots,x_k) =\n    \\begin{cases}\n        g(x_1,\\dots,x_k)   & \\text{if } x_\\ell\\in \\{0,\\dots,n-1\\}\\\\\n\t\th(x_1,\\dots,x_k)   & \\text{if for all } \\ell'\\neq \\ell, x_{\\ell'}\\in\\{0,\\dots,n-1\\}.\n\t\\end{cases}\n    \\]\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex15.m1\" class=\"ltx_Math\" alttext=\"\\omega(x_{1},\\dots,x_{k})=\\begin{cases}g(x_{1},\\dots,x_{k})&amp;\\text{if }x_{\\ell}%&#10;\\in\\{0,\\dots,n-1\\}\\\\&#10;h(x_{1},\\dots,x_{k})&amp;\\text{if for all }\\ell^{\\prime}\\neq\\ell,x_{\\ell^{\\prime}}%&#10;\\in\\{0,\\dots,n-1\\}.\\end{cases}\" display=\"block\"><mrow><mrow><mi>\u03c9</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msub><mi>x</mi><mi>k</mi></msub><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mrow><mo>{</mo><mtable columnspacing=\"5pt\" displaystyle=\"true\" rowspacing=\"0pt\"><mtr><mtd columnalign=\"left\"><mrow><mi>g</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msub><mi>x</mi><mi>k</mi></msub><mo stretchy=\"false\">)</mo></mrow></mrow></mtd><mtd columnalign=\"left\"><mrow><mrow><mtext>if\u00a0</mtext><mo>\u2062</mo><msub><mi>x</mi><mi mathvariant=\"normal\">\u2113</mi></msub></mrow><mo>\u2208</mo><mrow><mo stretchy=\"false\">{</mo><mn>0</mn><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><mrow><mi>n</mi><mo>-</mo><mn>1</mn></mrow><mo stretchy=\"false\">}</mo></mrow></mrow></mtd></mtr><mtr><mtd columnalign=\"left\"><mrow><mi>h</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msub><mi>x</mi><mi>k</mi></msub><mo stretchy=\"false\">)</mo></mrow></mrow></mtd><mtd columnalign=\"left\"><mrow><mrow><mrow><mrow><mtext>if for all\u00a0</mtext><mo>\u2062</mo><msup><mi mathvariant=\"normal\">\u2113</mi><mo>\u2032</mo></msup></mrow><mo>\u2260</mo><mi mathvariant=\"normal\">\u2113</mi></mrow><mo>,</mo><mrow><msub><mi>x</mi><msup><mi mathvariant=\"normal\">\u2113</mi><mo>\u2032</mo></msup></msub><mo>\u2208</mo><mrow><mo stretchy=\"false\">{</mo><mn>0</mn><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><mrow><mi>n</mi><mo>-</mo><mn>1</mn></mrow><mo stretchy=\"false\">}</mo></mrow></mrow></mrow><mo>.</mo></mrow></mtd></mtr></mtable></mrow></mrow></math>", "type": "latex"}, {"file": "1601.04520.tex", "nexttext": "\n\twhere (\\ref{eq:mashup-lemma-1}) holds because ${\\mathbf t}_j$ is the image\n\tunder $f$ of the tuple whose entries are $m$ except for the $j$-th one\n\twhich is $m'$.\n\tSince $j\\neq\\ell$, the $\\ell$-th entry of this tuple is $m\\in\\{0,\\dots,n-1\\}$,\n\tso that $\\omega^{\\mathbf A}(m,\\dots,m,m',m,\\dots,m)=g^{\\mathbf A}(m,\\dots,m,m',m,\\dots,m)$\n\twhich gives the equation~(\\ref{eq:mashup-lemma-2}).\n\tBy assumption, $g^{\\mathbf T}$ is the $\\ell$-th projection,\n\twhich gives the last equality. Thus, $\\omega^{\\mathbf T}$ is\n\tnot the $j$-th projection, for any $j\\neq\\ell$, and it is therefore\n\tthe $\\ell$-th projection.\n\t\n\tWe now apply the same reasoning with $j=\\ell$. This time,\n\twe obtain that $\\omega^{\\mathbf T}({\\mathbf t}_\\ell)=h^{\\mathbf T}({\\mathbf t}_\\ell)$,\n\tand since we know that $\\omega^{\\mathbf T}$ is the $\\ell$-th projection,\n\twe obtain that $h^{\\mathbf T}({\\mathbf t}_\\ell)=b$.\n\tThis finally implies that $h^{\\mathbf T}$ is the $\\ell$-th projection,\n\tso that $g^{\\mathbf T}=h^{\\mathbf T}$.\n\\end{proof}\n\n\\begin{cor}\\label{cor:mashup-homomorphism-version}\n\tLet ${\\mathbf A}$ be an idempotent algebra over $\\{0,\\dots,n\\}$,\n\tand suppose that there exists a clone homomorphism ${\\operatorname{Clo}}({\\mathbf A})\\to{\\mathbf 2}$.\n\tThen there exists a clone homomorphism $\\xi\\colon{\\operatorname{Clo}}({\\mathbf A})\\to{\\mathbf 2}$\n\tsuch that\n\tfor every $g$ and $h$ in ${\\operatorname{Clo}}({\\mathbf A})$,\n\tif all the mashups of $g$ and $h$ are in ${\\operatorname{Clo}}({\\mathbf A})$,\n\twe have $\\xi(g) = \\xi(h)$.\n\\end{cor}\n\\begin{proof}\n\tBy the hypothesis and Theorem~\\ref{thm:finite}, \n\tthere exists an algebra in ${\\operatorname{\\mathsf{HS}}}({\\mathbf A})$ whose operations are projections. \n\tLet ${\\mathbf S}$ be a subalgebra of ${\\mathbf A}$ and $f\\colon{\\mathbf S}\\to\\mathbf T$ be a\n\thomomorphism onto an algebra whose operations are projections.\n\tDefine $\\xi$ to be the map that takes a term operation $t^{\\mathbf A}$ in ${\\operatorname{Clo}}({\\mathbf A})$\n\tto $t^{\\mathbf T}$.\n\tLemma~\\ref{lem:mashup-implies-same-image} then implies that $\\xi$ satisfies the required property.\n\\end{proof}\n\nWhen using Corollary~\\ref{cor:mashup-homomorphism-version}, the finite algebra\nwe consider is the algebra whose domain\nis the set of orbits of ${\\mathbb N}$ under $G_n$, and whose operations are induced\nby the functions that are canonical with respect to $({\\mathbb N};0,\\dots,n-1)$.\nIn order to prove that the mashup of two functions exists in this algebra,\nwe therefore need to prove that there exists a canonical function\nwhich induces this mashup. This motivates the following definition\nand propositions.\n\n\\begin{definition}\n\tLet $g,h,\\omega\\colon{\\mathbb N}^k\\to{\\mathbb N}$, let $\\ell\\in[k]$, and let $S\\subseteq{\\mathbb N}$.\n\tWe say that $\\omega$ is an $(\\ell,S)$-mashup of $g$ and $h$\n   \tiff the following holds: there exist $\\alpha,\\beta\\in G_n$ such that\n\tfor all $x_1,\\dots,x_k\\in S$, we have\n\n", "itemtype": "equation", "pos": 55539, "prevtext": "\n\n\\end{definition}\n\n\\begin{lemma}\\label{lem:mashup-implies-same-image}\n\tLet ${\\mathbf A}$ be an idempotent algebra over $\\{0,\\dots,n\\}$.\n\tSuppose that there is a $2$-element algebra in ${\\operatorname{\\mathsf{HS}}}({\\mathbf A})$\n\tall of whose operations are projections.\n\tLet ${\\mathbf S}$ be a subalgebra of ${\\mathbf A}$ and $f\\colon{\\mathbf S}\\to\\mathbf T$\n\tbe a surjective homomorphism\n\tsuch that $\\mathbf T$ contains only projections.\n\tLet $g^{{\\mathbf A}},h^{{\\mathbf A}}$ be fundamental operations of ${\\mathbf A}$ of arity $k$.\n\tIf for all $\\ell\\in [k]$, an $\\ell$-mashup of $g^{\\mathbf A}$ and $h^{\\mathbf A}$\n\tis a fundamental operation of ${\\mathbf A}$,\n\tthen $g^{\\mathbf T} = h^{\\mathbf T}$.\n\\end{lemma}\n\\begin{proof}\n    The algebra $\\mathbf T$ has two elements $a,b$.\t\n    Without loss of generality, we can assume that $f^{-1}(a)=m\\neq n$.\n    Let $m'$ be $f^{-1}(b)$.\n\tLet $\\ell$ be such that $g^{\\mathbf T}$ is the $\\ell$-th projection.\n\tLet $\\omega^{\\mathbf A}$ be an $\\ell$-mashup of $g^{\\mathbf A}$ and $h^{\\mathbf A}$.\n\tLet ${\\mathbf t}_j$\n\tbe the tuple whose entries are $a$, except for the $j$-th one which is $b$.\n\tThen we have for $j\\neq\\ell$:\n\t\n", "index": 23, "text": "\\begin{align}\n\t\t\\label{eq:mashup-lemma-1}\n\t\t\\omega^{\\mathbf T}({\\mathbf t}_j) &= f(\\omega^{\\mathbf A}(m,\\dots,m,m',m,\\dots,m))\\\\\n\t\t\\label{eq:mashup-lemma-2}&= f(g^{\\mathbf A}(m,\\dots,m,m',m,\\dots,m))\\\\\n\t\t&= g^{\\mathbf T}({\\mathbf t}_j) = a.\n\t\\end{align}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E1.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle\\omega^{\\mathbf{T}}({\\mathbf{t}}_{j})\" display=\"inline\"><mrow><msup><mi>\u03c9</mi><mi>\ud835\udc13</mi></msup><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>\ud835\udc2d</mi><mi>j</mi></msub><mo stretchy=\"false\">)</mo></mrow></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E1.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle=f(\\omega^{\\mathbf{A}}(m,\\dots,m,m^{\\prime},m,\\dots,m))\" display=\"inline\"><mrow><mi/><mo>=</mo><mrow><mi>f</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mrow><msup><mi>\u03c9</mi><mi>\ud835\udc00</mi></msup><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>m</mi><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><mi>m</mi><mo>,</mo><msup><mi>m</mi><mo>\u2032</mo></msup><mo>,</mo><mi>m</mi><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><mi>m</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo stretchy=\"false\">)</mo></mrow></mrow></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E2.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle=f(g^{\\mathbf{A}}(m,\\dots,m,m^{\\prime},m,\\dots,m))\" display=\"inline\"><mrow><mi/><mo>=</mo><mrow><mi>f</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mrow><msup><mi>g</mi><mi>\ud835\udc00</mi></msup><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>m</mi><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><mi>m</mi><mo>,</mo><msup><mi>m</mi><mo>\u2032</mo></msup><mo>,</mo><mi>m</mi><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><mi>m</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo stretchy=\"false\">)</mo></mrow></mrow></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E3.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle=g^{\\mathbf{T}}({\\mathbf{t}}_{j})=a.\" display=\"inline\"><mrow><mrow><mi/><mo>=</mo><mrow><msup><mi>g</mi><mi>\ud835\udc13</mi></msup><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>\ud835\udc2d</mi><mi>j</mi></msub><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mi>a</mi></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.04520.tex", "nexttext": "\n\\end{definition}\n\n\n\\begin{lemma}[Canonisation lemma]\\label{lem:canonization}\n\tEvery $f\\colon{\\mathbb N}^k\\to{\\mathbb N}$ interpolates modulo $G_n$ a function $g\\colon{\\mathbb N}^k\\to{\\mathbb N}$\n\tthat is canonical with respect to $({\\mathbb N};0,\\dots,n-1)$.\n\\end{lemma}\n\nFor the rest of this section, ``$f$ is canonical'' means \n``$f$ is canonical with respect to $({\\mathbb N};0,\\dots,n-1)$''.\n\n\\begin{proposition}\\label{prop:building-mashups}\n    Let $(f_i)_{i\\in\\omega}$ be a sequence of functions ${\\mathbb N}^k\\to{\\mathbb N}$ converging to a function $f$.\n\tLet $g$ be canonical and in $\\overline{G_n\\{f\\}G_n}$ and $h$ be canonical and in $\\bigcap_i \\overline{G_n\\{f_i\\}G_n}$.\n\tLet $\\ell\\in[k]$.\n    Then there exists a canonical function $\\zeta$ in $\\overline{G_n\\{f_i\\colon i\\in{\\mathbb N}\\}G_n}$\n    which is for every finite set $S\\subset{\\mathbb N}$ an $(\\ell,S)$-mashup of $g$ and $h$.\n\\end{proposition}\n\\begin{proof}\n    \n    We first prove that for every finite subset $S$ of ${\\mathbb N}$, there exists in $G_n\\{f_i\\colon i\\in{\\mathbb N}\\}G_n$\n    a function $\\omega_S$ which is an $(\\ell,S)$-mashup of $g$ and $h$.\n    Let $S\\subset {\\mathbb N}$ be finite.\n    Since $g$ is in $\\overline{G_n\\{f\\}G_n}$, there exist functions\n    $\\gamma,\\delta_1,\\dots,\\delta_k$ in $G_n$ such that\n   \n", "itemtype": "equation", "pos": 58693, "prevtext": "\n\twhere (\\ref{eq:mashup-lemma-1}) holds because ${\\mathbf t}_j$ is the image\n\tunder $f$ of the tuple whose entries are $m$ except for the $j$-th one\n\twhich is $m'$.\n\tSince $j\\neq\\ell$, the $\\ell$-th entry of this tuple is $m\\in\\{0,\\dots,n-1\\}$,\n\tso that $\\omega^{\\mathbf A}(m,\\dots,m,m',m,\\dots,m)=g^{\\mathbf A}(m,\\dots,m,m',m,\\dots,m)$\n\twhich gives the equation~(\\ref{eq:mashup-lemma-2}).\n\tBy assumption, $g^{\\mathbf T}$ is the $\\ell$-th projection,\n\twhich gives the last equality. Thus, $\\omega^{\\mathbf T}$ is\n\tnot the $j$-th projection, for any $j\\neq\\ell$, and it is therefore\n\tthe $\\ell$-th projection.\n\t\n\tWe now apply the same reasoning with $j=\\ell$. This time,\n\twe obtain that $\\omega^{\\mathbf T}({\\mathbf t}_\\ell)=h^{\\mathbf T}({\\mathbf t}_\\ell)$,\n\tand since we know that $\\omega^{\\mathbf T}$ is the $\\ell$-th projection,\n\twe obtain that $h^{\\mathbf T}({\\mathbf t}_\\ell)=b$.\n\tThis finally implies that $h^{\\mathbf T}$ is the $\\ell$-th projection,\n\tso that $g^{\\mathbf T}=h^{\\mathbf T}$.\n\\end{proof}\n\n\\begin{cor}\\label{cor:mashup-homomorphism-version}\n\tLet ${\\mathbf A}$ be an idempotent algebra over $\\{0,\\dots,n\\}$,\n\tand suppose that there exists a clone homomorphism ${\\operatorname{Clo}}({\\mathbf A})\\to{\\mathbf 2}$.\n\tThen there exists a clone homomorphism $\\xi\\colon{\\operatorname{Clo}}({\\mathbf A})\\to{\\mathbf 2}$\n\tsuch that\n\tfor every $g$ and $h$ in ${\\operatorname{Clo}}({\\mathbf A})$,\n\tif all the mashups of $g$ and $h$ are in ${\\operatorname{Clo}}({\\mathbf A})$,\n\twe have $\\xi(g) = \\xi(h)$.\n\\end{cor}\n\\begin{proof}\n\tBy the hypothesis and Theorem~\\ref{thm:finite}, \n\tthere exists an algebra in ${\\operatorname{\\mathsf{HS}}}({\\mathbf A})$ whose operations are projections. \n\tLet ${\\mathbf S}$ be a subalgebra of ${\\mathbf A}$ and $f\\colon{\\mathbf S}\\to\\mathbf T$ be a\n\thomomorphism onto an algebra whose operations are projections.\n\tDefine $\\xi$ to be the map that takes a term operation $t^{\\mathbf A}$ in ${\\operatorname{Clo}}({\\mathbf A})$\n\tto $t^{\\mathbf T}$.\n\tLemma~\\ref{lem:mashup-implies-same-image} then implies that $\\xi$ satisfies the required property.\n\\end{proof}\n\nWhen using Corollary~\\ref{cor:mashup-homomorphism-version}, the finite algebra\nwe consider is the algebra whose domain\nis the set of orbits of ${\\mathbb N}$ under $G_n$, and whose operations are induced\nby the functions that are canonical with respect to $({\\mathbb N};0,\\dots,n-1)$.\nIn order to prove that the mashup of two functions exists in this algebra,\nwe therefore need to prove that there exists a canonical function\nwhich induces this mashup. This motivates the following definition\nand propositions.\n\n\\begin{definition}\n\tLet $g,h,\\omega\\colon{\\mathbb N}^k\\to{\\mathbb N}$, let $\\ell\\in[k]$, and let $S\\subseteq{\\mathbb N}$.\n\tWe say that $\\omega$ is an $(\\ell,S)$-mashup of $g$ and $h$\n   \tiff the following holds: there exist $\\alpha,\\beta\\in G_n$ such that\n\tfor all $x_1,\\dots,x_k\\in S$, we have\n\n", "index": 25, "text": "\\[\n    \\omega(x_1,\\dots,x_k) =\n    \\begin{cases}\n\t\t\\alpha g(x_1,\\dots,x_k)   & \\text{if } x_\\ell\\in\\{0,\\dots,n-1\\}\\\\\n\t\t\\beta h(x_1,\\dots,x_k)    & \\text{if for all } \\ell'\\neq\\ell, x_{\\ell'}\\in\\{0,\\dots,n-1\\}.\n\t\\end{cases}\n    \\]\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex16.m1\" class=\"ltx_Math\" alttext=\"\\omega(x_{1},\\dots,x_{k})=\\begin{cases}\\alpha g(x_{1},\\dots,x_{k})&amp;\\text{if }x%&#10;_{\\ell}\\in\\{0,\\dots,n-1\\}\\\\&#10;\\beta h(x_{1},\\dots,x_{k})&amp;\\text{if for all }\\ell^{\\prime}\\neq\\ell,x_{\\ell^{%&#10;\\prime}}\\in\\{0,\\dots,n-1\\}.\\end{cases}\" display=\"block\"><mrow><mrow><mi>\u03c9</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msub><mi>x</mi><mi>k</mi></msub><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mrow><mo>{</mo><mtable columnspacing=\"5pt\" displaystyle=\"true\" rowspacing=\"0pt\"><mtr><mtd columnalign=\"left\"><mrow><mi>\u03b1</mi><mo>\u2062</mo><mi>g</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msub><mi>x</mi><mi>k</mi></msub><mo stretchy=\"false\">)</mo></mrow></mrow></mtd><mtd columnalign=\"left\"><mrow><mrow><mtext>if\u00a0</mtext><mo>\u2062</mo><msub><mi>x</mi><mi mathvariant=\"normal\">\u2113</mi></msub></mrow><mo>\u2208</mo><mrow><mo stretchy=\"false\">{</mo><mn>0</mn><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><mrow><mi>n</mi><mo>-</mo><mn>1</mn></mrow><mo stretchy=\"false\">}</mo></mrow></mrow></mtd></mtr><mtr><mtd columnalign=\"left\"><mrow><mi>\u03b2</mi><mo>\u2062</mo><mi>h</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msub><mi>x</mi><mi>k</mi></msub><mo stretchy=\"false\">)</mo></mrow></mrow></mtd><mtd columnalign=\"left\"><mrow><mrow><mrow><mrow><mtext>if for all\u00a0</mtext><mo>\u2062</mo><msup><mi mathvariant=\"normal\">\u2113</mi><mo>\u2032</mo></msup></mrow><mo>\u2260</mo><mi mathvariant=\"normal\">\u2113</mi></mrow><mo>,</mo><mrow><msub><mi>x</mi><msup><mi mathvariant=\"normal\">\u2113</mi><mo>\u2032</mo></msup></msub><mo>\u2208</mo><mrow><mo stretchy=\"false\">{</mo><mn>0</mn><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><mrow><mi>n</mi><mo>-</mo><mn>1</mn></mrow><mo stretchy=\"false\">}</mo></mrow></mrow></mrow><mo>.</mo></mrow></mtd></mtr></mtable></mrow></mrow></math>", "type": "latex"}, {"file": "1601.04520.tex", "nexttext": "\n    Since $(f_i)_{i\\in{\\mathbb N}}$ converges to $f$,\n    and $\\bigcup_{i=1}^k\\delta_i(S)$ is finite, there exists an $i\\in{\\mathbb N}$\n    such that $f(\\delta_1x_1,\\dots,\\delta_kx_k)=f_i(\\delta_1x_1,\\dots,\\delta_kx_k)$ for all $x_1,\\dots,x_k\\in S$.\n    The function $h$ is by assumption in $\\overline{G_n\\{f_i\\}G_n}$,\n    and therefore there exist functions $\\alpha,\\beta_1,\\dots,\\beta_k$ in $G_n$\n    such that\n   \n", "itemtype": "equation", "pos": 60223, "prevtext": "\n\\end{definition}\n\n\n\\begin{lemma}[Canonisation lemma]\\label{lem:canonization}\n\tEvery $f\\colon{\\mathbb N}^k\\to{\\mathbb N}$ interpolates modulo $G_n$ a function $g\\colon{\\mathbb N}^k\\to{\\mathbb N}$\n\tthat is canonical with respect to $({\\mathbb N};0,\\dots,n-1)$.\n\\end{lemma}\n\nFor the rest of this section, ``$f$ is canonical'' means \n``$f$ is canonical with respect to $({\\mathbb N};0,\\dots,n-1)$''.\n\n\\begin{proposition}\\label{prop:building-mashups}\n    Let $(f_i)_{i\\in\\omega}$ be a sequence of functions ${\\mathbb N}^k\\to{\\mathbb N}$ converging to a function $f$.\n\tLet $g$ be canonical and in $\\overline{G_n\\{f\\}G_n}$ and $h$ be canonical and in $\\bigcap_i \\overline{G_n\\{f_i\\}G_n}$.\n\tLet $\\ell\\in[k]$.\n    Then there exists a canonical function $\\zeta$ in $\\overline{G_n\\{f_i\\colon i\\in{\\mathbb N}\\}G_n}$\n    which is for every finite set $S\\subset{\\mathbb N}$ an $(\\ell,S)$-mashup of $g$ and $h$.\n\\end{proposition}\n\\begin{proof}\n    \n    We first prove that for every finite subset $S$ of ${\\mathbb N}$, there exists in $G_n\\{f_i\\colon i\\in{\\mathbb N}\\}G_n$\n    a function $\\omega_S$ which is an $(\\ell,S)$-mashup of $g$ and $h$.\n    Let $S\\subset {\\mathbb N}$ be finite.\n    Since $g$ is in $\\overline{G_n\\{f\\}G_n}$, there exist functions\n    $\\gamma,\\delta_1,\\dots,\\delta_k$ in $G_n$ such that\n   \n", "index": 27, "text": "\\[\\forall x_1,\\dots,x_k\\in S,\\; g(x_1,\\dots,x_n) = \\gamma f(\\delta_1x_1,\\dots,\\delta_kx_k).\\]\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex17.m1\" class=\"ltx_Math\" alttext=\"\\forall x_{1},\\dots,x_{k}\\in S,\\;g(x_{1},\\dots,x_{n})=\\gamma f(\\delta_{1}x_{1}%&#10;,\\dots,\\delta_{k}x_{k}).\" display=\"block\"><mrow><mrow><mrow><mrow><mrow><mo>\u2200</mo><msub><mi>x</mi><mn>1</mn></msub></mrow><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msub><mi>x</mi><mi>k</mi></msub></mrow><mo>\u2208</mo><mi>S</mi></mrow><mo rspace=\"5.3pt\">,</mo><mrow><mrow><mi>g</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mrow><mi>\u03b3</mi><mo>\u2062</mo><mi>f</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mrow><msub><mi>\u03b4</mi><mn>1</mn></msub><mo>\u2062</mo><msub><mi>x</mi><mn>1</mn></msub></mrow><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><mrow><msub><mi>\u03b4</mi><mi>k</mi></msub><mo>\u2062</mo><msub><mi>x</mi><mi>k</mi></msub></mrow><mo stretchy=\"false\">)</mo></mrow></mrow></mrow></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.04520.tex", "nexttext": "\n\tDefine $\\omega_S\\colon{\\mathbb N}^2\\to{\\mathbb N}$ as \n   \n", "itemtype": "equation", "pos": 60734, "prevtext": "\n    Since $(f_i)_{i\\in{\\mathbb N}}$ converges to $f$,\n    and $\\bigcup_{i=1}^k\\delta_i(S)$ is finite, there exists an $i\\in{\\mathbb N}$\n    such that $f(\\delta_1x_1,\\dots,\\delta_kx_k)=f_i(\\delta_1x_1,\\dots,\\delta_kx_k)$ for all $x_1,\\dots,x_k\\in S$.\n    The function $h$ is by assumption in $\\overline{G_n\\{f_i\\}G_n}$,\n    and therefore there exist functions $\\alpha,\\beta_1,\\dots,\\beta_k$ in $G_n$\n    such that\n   \n", "index": 29, "text": "\\[\\forall x_1,\\dots,x_k\\in S,\\; h(x_1,\\dots,x_k)=\\alpha f_i(\\beta_1x_1,\\dots,\\beta_kx_k).\\]\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex18.m1\" class=\"ltx_Math\" alttext=\"\\forall x_{1},\\dots,x_{k}\\in S,\\;h(x_{1},\\dots,x_{k})=\\alpha f_{i}(\\beta_{1}x_%&#10;{1},\\dots,\\beta_{k}x_{k}).\" display=\"block\"><mrow><mrow><mrow><mrow><mrow><mo>\u2200</mo><msub><mi>x</mi><mn>1</mn></msub></mrow><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msub><mi>x</mi><mi>k</mi></msub></mrow><mo>\u2208</mo><mi>S</mi></mrow><mo rspace=\"5.3pt\">,</mo><mrow><mrow><mi>h</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msub><mi>x</mi><mi>k</mi></msub><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mrow><mi>\u03b1</mi><mo>\u2062</mo><msub><mi>f</mi><mi>i</mi></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mrow><msub><mi>\u03b2</mi><mn>1</mn></msub><mo>\u2062</mo><msub><mi>x</mi><mn>1</mn></msub></mrow><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><mrow><msub><mi>\u03b2</mi><mi>k</mi></msub><mo>\u2062</mo><msub><mi>x</mi><mi>k</mi></msub></mrow><mo stretchy=\"false\">)</mo></mrow></mrow></mrow></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.04520.tex", "nexttext": "\n\twhere $\\epsilon_\\ell=\\beta_\\ell$, and $\\epsilon_{\\ell'}=\\delta_{\\ell'}$\n\tif $\\ell'\\neq\\ell$.\n\tNote that when $x\\in\\{0,\\dots,n-1\\}$, we have\n\t$\\delta_{\\ell'}(x)=\\beta_{\\ell'}(x)=x$\n\tfor every $\\ell'\\in[k]$.\n    This immediately gives\n   \n", "itemtype": "equation", "pos": 60886, "prevtext": "\n\tDefine $\\omega_S\\colon{\\mathbb N}^2\\to{\\mathbb N}$ as \n   \n", "index": 31, "text": "\\[\\omega_S(x_1,\\dots,x_k) = f_i(\\epsilon_1(x_1),\\dots,\\epsilon_k(x_k)),\\]\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex19.m1\" class=\"ltx_Math\" alttext=\"\\omega_{S}(x_{1},\\dots,x_{k})=f_{i}(\\epsilon_{1}(x_{1}),\\dots,\\epsilon_{k}(x_{%&#10;k})),\" display=\"block\"><mrow><mrow><mrow><msub><mi>\u03c9</mi><mi>S</mi></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msub><mi>x</mi><mi>k</mi></msub><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mrow><msub><mi>f</mi><mi>i</mi></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mrow><msub><mi>\u03f5</mi><mn>1</mn></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo stretchy=\"false\">)</mo></mrow></mrow><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><mrow><msub><mi>\u03f5</mi><mi>k</mi></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mi>k</mi></msub><mo stretchy=\"false\">)</mo></mrow></mrow><mo stretchy=\"false\">)</mo></mrow></mrow></mrow><mo>,</mo></mrow></math>", "type": "latex"}, {"file": "1601.04520.tex", "nexttext": "\n\tThus, \n\t$\\omega_S \\in G_n\\{f_i\\colon i\\in{\\mathbb N}\\}G_n$ is an $(\\ell,S)$-mashup of $g$ and $h$.\n\n\n    \n    We now prove that there exists a single function\n    which is an $(\\ell,S)$-mashup for all finite $S\\subset{\\mathbb N}$.\n    For each positive integer $m\\geq n-1$,\n\tconsider the equivalence relation on functions $\\{0,\\dots,m\\}^k\\to{\\mathbb N}$\n\tdefined by $r\\sim_m s$ iff there exists $\\alpha\\in G_n$\n\tsuch that $r = \\alpha \\circ s$.\n\tNote that if $r$ is an $(\\ell,S)$-mashup of $g,h$ and if $r\\sim_m s$,\n\tthen $s$ is also an $(\\ell,S)$-mashup of $g,h$.\n\tFor each $m\\geq n-1$, this relation has finite index because the action of\n\t$G_n$ on ${\\mathbb N}$ is oligomorphic (that is,\n\tthere are only finitely many orbits of $k$-tuples for every positive integer $k$).\n\tConsider the following forest $\\mathcal F$.\n\tFor each $m\\geq n-1$\n\tand each function $\\omega$ which is an\n\t$(\\ell,\\{0,\\dots,m\\})$-mashup of $g$ and $h$ in $G_n\\{f_i\\colon i\\in{\\mathbb N}\\}G_n$,\n\tthe forest $\\mathcal F$ contains the vertex \n\t${{({{\\omega}|_{{\\{0,\\dots,m\\}}}})}/\\kern-4pt\\sim_{{m}}}$.\n\tFor each $m\\geq n$, if ${{r}/\\kern-4pt\\sim_{{m}}}$ is a vertex of $\\mathcal F$,\n\tthen there is an edge $\\{{{s}/\\kern-4pt\\sim_{{m-1}}}, {{r}/\\kern-4pt\\sim_{{m}}}\\}$\n\twhere $s={{r}|_{{\\{0,\\dots,m-1\\}}}}$.\n\tBy the first paragraph, there are infinitely many vertices in $\\mathcal F$.\n\tSince $\\sim_m$ has finite index for all $m\\geq n-1$,\n\tthe forest is finitely branching, and has finitely many roots.\n\tBy K\\\"onig's lemma, there exists an infinite branch in $\\mathcal F$,\n\twhich we denote by $({{\\omega_m}/\\kern-4pt\\sim_{{m}}})_{m\\geq n-1}$.\n\t\n\tWe now construct a chain of functions $\\zeta_m\\colon\\{0,\\dots,m\\}^k\\to{\\mathbb N}$\n\tsuch that $\\zeta_m\\subset \\zeta_{m+1}$ for all $m\\geq n-1$,\n\tand such that $\\zeta_m$ is $\\sim_m$-equivalent to $\\omega_m$.\n\tFor $m=n-1$, simply put $\\zeta_m = \\omega_m$.\n\tSuppose that $m>n-1$ and that $\\zeta_{m-1}$ is defined.\n\tThere is an edge between $\\omega_{m-1}$ and $\\omega_m$ by hypothesis\n\tand $\\zeta_{m-1}\\sim_{m-1}\\omega_{m-1}$,\n\twhich means that there is $\\alpha$ in $G_n$\n\tsuch that $\\alpha{{\\omega_m}|_{{\\{0,\\dots,m-1\\}}}} = \\zeta_{m-1}$.\n\tDefine $\\zeta_m$ to be $\\alpha\\omega_m$.\n\tWe have $\\zeta_{m-1} = {{\\zeta_m}|_{{\\{0,\\dots,m-1\\}}}}$\n\tand $\\zeta_m\\sim_m\\omega_m$, as required.\n\tLet now $\\zeta = \\bigcup_{m\\geq n-1} \\zeta_m$.\n\tIt remains to prove that $\\zeta$ is an $(\\ell,S)$-mashup of $g,h$ for every finite $S\\subset{\\mathbb N}$.\n\tLet $S$ be such a finite set, and $m$ be such that $m\\geq n-1$ and\n\t$m\\geq \\max(S)$.\n\tSince $\\zeta_m\\sim_m\\omega_m$ and $\\omega_m$ is an $(\\ell,\\{0,\\dots,m\\})$-mashup of $g,h$,\n\tso is $\\zeta_m$.\n\tFinally, since $\\zeta_m={{\\zeta}|_{{\\{0,\\dots,m\\}}}}$, we have\n    that $\\zeta$ is an $(\\ell,S)$-mashup of $g,h$ for every finite $S$.\n    Let $\\zeta'$ be canonical and obtained from $\\zeta$ by Lemma~\\ref{lem:canonization}.\n    It is immediate that $\\zeta'$ is an $(\\ell,S)$-mashup of $g,h$ for every finite $S$.\n    Moreover, $\\zeta'$ is in $\\overline{G_n\\zeta G_n}$ and we have\n    \n", "itemtype": "equation", "pos": 61198, "prevtext": "\n\twhere $\\epsilon_\\ell=\\beta_\\ell$, and $\\epsilon_{\\ell'}=\\delta_{\\ell'}$\n\tif $\\ell'\\neq\\ell$.\n\tNote that when $x\\in\\{0,\\dots,n-1\\}$, we have\n\t$\\delta_{\\ell'}(x)=\\beta_{\\ell'}(x)=x$\n\tfor every $\\ell'\\in[k]$.\n    This immediately gives\n   \n", "index": 33, "text": "\\[\n    \\omega_S(x_1,\\dots,x_k) =\n    \\begin{cases}\n        \\gamma^{-1}(g(x_1,\\dots,x_k)) & \\text{if $x_l\\in\\{0,\\dots,n-1\\}$}\\\\\n        \\alpha^{-1}(h(x_1,\\dots,x_k)) &\n        \t\\text{if for all } \\ell'\\neq\\ell, x_{\\ell'}\\in\\{0,\\dots,n-1\\}.\n    \\end{cases}\n    \\]\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex20.m1\" class=\"ltx_Math\" alttext=\"\\omega_{S}(x_{1},\\dots,x_{k})=\\begin{cases}\\gamma^{-1}(g(x_{1},\\dots,x_{k}))&amp;%&#10;\\text{if $x_{l}\\in\\{0,\\dots,n-1\\}$}\\\\&#10;\\alpha^{-1}(h(x_{1},\\dots,x_{k}))&amp;\\text{if for all }\\ell^{\\prime}\\neq\\ell,x_{%&#10;\\ell^{\\prime}}\\in\\{0,\\dots,n-1\\}.\\end{cases}\" display=\"block\"><mrow><mrow><msub><mi>\u03c9</mi><mi>S</mi></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msub><mi>x</mi><mi>k</mi></msub><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mrow><mo>{</mo><mtable columnspacing=\"5pt\" displaystyle=\"true\" rowspacing=\"0pt\"><mtr><mtd columnalign=\"left\"><mrow><msup><mi>\u03b3</mi><mrow><mo>-</mo><mn>1</mn></mrow></msup><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mrow><mi>g</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msub><mi>x</mi><mi>k</mi></msub><mo stretchy=\"false\">)</mo></mrow></mrow><mo stretchy=\"false\">)</mo></mrow></mrow></mtd><mtd columnalign=\"left\"><mrow><mtext>if\u00a0</mtext><mrow><msub><mi>x</mi><mi>l</mi></msub><mo>\u2208</mo><mrow><mo stretchy=\"false\">{</mo><mn>0</mn><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><mrow><mi>n</mi><mo>-</mo><mn>1</mn></mrow><mo stretchy=\"false\">}</mo></mrow></mrow></mrow></mtd></mtr><mtr><mtd columnalign=\"left\"><mrow><msup><mi>\u03b1</mi><mrow><mo>-</mo><mn>1</mn></mrow></msup><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mrow><mi>h</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msub><mi>x</mi><mi>k</mi></msub><mo stretchy=\"false\">)</mo></mrow></mrow><mo stretchy=\"false\">)</mo></mrow></mrow></mtd><mtd columnalign=\"left\"><mrow><mrow><mrow><mrow><mtext>if for all\u00a0</mtext><mo>\u2062</mo><msup><mi mathvariant=\"normal\">\u2113</mi><mo>\u2032</mo></msup></mrow><mo>\u2260</mo><mi mathvariant=\"normal\">\u2113</mi></mrow><mo>,</mo><mrow><msub><mi>x</mi><msup><mi mathvariant=\"normal\">\u2113</mi><mo>\u2032</mo></msup></msub><mo>\u2208</mo><mrow><mo stretchy=\"false\">{</mo><mn>0</mn><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><mrow><mi>n</mi><mo>-</mo><mn>1</mn></mrow><mo stretchy=\"false\">}</mo></mrow></mrow></mrow><mo>.</mo></mrow></mtd></mtr></mtable></mrow></mrow></math>", "type": "latex"}, {"file": "1601.04520.tex", "nexttext": "\n    so that $\\zeta'$ is in $\\overline{G_n\\{f_i\\colon i\\in{\\mathbb N}\\}G_n}$ as required.\n\\end{proof}\n\nThe orbit of an element $m$ in $\\{0,\\dots,n-1\\}$ is $\\{m\\}$ and can be interpreted as $m$ itself,\nand the orbit of \nan element in ${\\mathbb N}\\setminus\\{0,\\dots,n-1\\}$ \nis exactly ${\\mathbb N}\\setminus\\{0,\\dots,n-1\\}$, and in the following will be associated with $n$.\n\n\\begin{proposition}[Building Mashups]\\label{prop:M-implies-mashup}\n    Let $g,h$ be canonical functions of arity $k$ and let $\\ell\\in [k]$.\n    Suppose that $\\omega$ is canonical and is an $(\\ell,S)$-mashup of $g,h$ for every finite $S\\subset{\\mathbb N}$.\n    Then $\\xi^{\\mathrm{typ}}_1(\\omega)$ is an $\\ell$-mashup of $\\xi^{{\\mathrm{typ}}}_1(g)$ and $\\xi^{\\mathrm{typ}}_1(h)$.\n\\end{proposition}\n\\begin{proof}\n    \n    \n    \n    Let $x_1,\\dots,x_k \\in {\\mathbb N}$ be such that \n    $x_l \\in \\{0,\\dots,n-1\\}$, \n    and let $y_i$ be the orbit of $x_i$ \n    under $G_n$.\n    Then $\\xi^{\\mathrm{typ}}_1(\\omega)(y_1,\\dots,y_k)$ is by definition the orbit of $\\omega(x_1,\\dots,x_k)$.\n    \n    Since $\\omega$ is by assumption an $(\\ell,\\{x_1,\\dots,x_k\\})$-mashup there exists an $\\alpha \\in G_n$ such that $\\omega(x_1,\\dots,x_k) = \\alpha g(x_1,\\dots,x_k)$.\n    \n    \n    Hence, $\\xi^{\\mathrm{typ}}_1(\\omega)(y_1,\\dots,y_k) = \\xi^{\\mathrm{typ}}_1(g)(y_1,\\dots,y_k)$.\n    The proof for the case that $x_{\\ell'} \\in \\{0,\\dots,n-1\\}$ for all $\\ell' \\neq \\ell$ is similar.\n\\end{proof}\n\n\n\nWe now apply mashups to study\nfunction clones ${\\mathscr C}$ such that for some $n \\geq 0$, the set of operations \n$G_n$ is dense in the set of all unary operations of ${\\mathscr C}$, which we denote by ${\\mathscr C}^{(1)}$.\nWe prove that for these clones, we can reduce the question of the existence\nof \\emph{continuous h1 clone homomorphisms} to ${\\mathbf 2}$\nto the existence of (regular) clone homomorphisms from the\ncanonical subclone of ${\\mathscr C}$ to ${\\mathbf 2}$.\n\nLet ${\\mathscr C}$ be a closed function clone over ${\\mathbb N}$.\nWhen $G_n$ is dense in ${\\mathscr C}^{(1)}$,\nthe map that takes $f\\in{\\mathscr C}$ to ${{f}|_{{{\\mathbb N}\\setminus\\{0,\\dots,n-1\\}}}}$\nis well-defined and a continuous clone homomorphism;\nthe image of this clone homomorphism\nis a function clone ${\\mathscr C}_{\\neq}$ \nover the domain ${{\\mathbb N}\\setminus\\{0,\\dots,n-1\\}}$.\nClearly, every permutation of the domain \nof ${\\mathscr C}_{\\neq}$ is an operation in ${\\mathscr C}_{\\neq}$.\nSuch clones have been studied in~\\cite{ecsps} in the context of constraint satisfaction\nproblems. In particular, the authors show the following.\n\n\\begin{thm}[Consequence of Theorem~7 in~\\cite{ecsps}]\\label{thm:classification-equality-languages}\n\tLet ${\\mathscr C}$ be a closed clone over a countably infinite set $D$,\n\tcontaining $\\mathrm{Sym}(D)$.\n\tThen ${\\mathscr C}$ has a continuous homomorphism to ${\\mathbf 2}$\n\tif and only if there is no constant unary \n\tand no injective binary operation in ${\\mathscr C}$.\n\\end{thm}\n\n\n\\begin{proposition}\\label{prop:cyclic-one-type-two-types}\n\tLet ${\\mathscr C}$ be a closed clone over ${\\mathbb N}$ such that $G_n$\n\tis dense in ${\\mathscr C}^{(1)}$.\n\tLet ${\\mathscr D}$ be the subclone of ${\\mathscr C}$ that contains the operations of ${\\mathscr C}$\n\tthat are canonical.\n\tSuppose that the clone ${\\mathscr C}_{\\neq}$ does not have a homomorphism to ${\\mathbf 2}$.\n\tThen if ${\\mathscr D}^{{\\mathrm{typ}}}_1$ has a cyclic operation, so does ${\\mathscr D}^{{\\mathrm{typ}}}_2$.\n\\end{proposition}\n\\begin{proof}\n\tLet $f\\in{\\mathscr D}$ be such that $\\xi^{\\mathrm{typ}}_1(f)$ cyclic in ${\\mathscr D}^{{\\mathrm{typ}}}_1$, of arity $k$.\n\tSince ${\\mathscr C}_{\\neq}$ does not have a homomorphism to ${\\mathbf 2}$,\n\tthere exists by Theorem~\\ref{thm:classification-equality-languages}\n\ta binary function $g'$ in ${\\mathscr D}$ such that $g'$ is injective when restricted to\n\t${\\mathbb N}\\setminus\\{0,\\dots,n-1\\}$ \n\t(indeed, ${\\mathscr C}_{\\neq}$ cannot contain a unary constant function,\n\tfor $G_n$ is dense in ${\\mathscr C}^{(1)}$).\n\tDefine $g(x_1,\\dots,x_k) := g'(x_1,g'(x_2,\\dots g'(x_{k-1},x_k) \\dots ))$ \n\t(an injection on ${\\mathbb N} \\setminus \\{0,\\dots,n-1\\}$), and  \n\tconsider $f' \\in {\\mathscr D}$ defined by\n\t\n", "itemtype": "equation", "pos": 64493, "prevtext": "\n\tThus, \n\t$\\omega_S \\in G_n\\{f_i\\colon i\\in{\\mathbb N}\\}G_n$ is an $(\\ell,S)$-mashup of $g$ and $h$.\n\n\n    \n    We now prove that there exists a single function\n    which is an $(\\ell,S)$-mashup for all finite $S\\subset{\\mathbb N}$.\n    For each positive integer $m\\geq n-1$,\n\tconsider the equivalence relation on functions $\\{0,\\dots,m\\}^k\\to{\\mathbb N}$\n\tdefined by $r\\sim_m s$ iff there exists $\\alpha\\in G_n$\n\tsuch that $r = \\alpha \\circ s$.\n\tNote that if $r$ is an $(\\ell,S)$-mashup of $g,h$ and if $r\\sim_m s$,\n\tthen $s$ is also an $(\\ell,S)$-mashup of $g,h$.\n\tFor each $m\\geq n-1$, this relation has finite index because the action of\n\t$G_n$ on ${\\mathbb N}$ is oligomorphic (that is,\n\tthere are only finitely many orbits of $k$-tuples for every positive integer $k$).\n\tConsider the following forest $\\mathcal F$.\n\tFor each $m\\geq n-1$\n\tand each function $\\omega$ which is an\n\t$(\\ell,\\{0,\\dots,m\\})$-mashup of $g$ and $h$ in $G_n\\{f_i\\colon i\\in{\\mathbb N}\\}G_n$,\n\tthe forest $\\mathcal F$ contains the vertex \n\t${{({{\\omega}|_{{\\{0,\\dots,m\\}}}})}/\\kern-4pt\\sim_{{m}}}$.\n\tFor each $m\\geq n$, if ${{r}/\\kern-4pt\\sim_{{m}}}$ is a vertex of $\\mathcal F$,\n\tthen there is an edge $\\{{{s}/\\kern-4pt\\sim_{{m-1}}}, {{r}/\\kern-4pt\\sim_{{m}}}\\}$\n\twhere $s={{r}|_{{\\{0,\\dots,m-1\\}}}}$.\n\tBy the first paragraph, there are infinitely many vertices in $\\mathcal F$.\n\tSince $\\sim_m$ has finite index for all $m\\geq n-1$,\n\tthe forest is finitely branching, and has finitely many roots.\n\tBy K\\\"onig's lemma, there exists an infinite branch in $\\mathcal F$,\n\twhich we denote by $({{\\omega_m}/\\kern-4pt\\sim_{{m}}})_{m\\geq n-1}$.\n\t\n\tWe now construct a chain of functions $\\zeta_m\\colon\\{0,\\dots,m\\}^k\\to{\\mathbb N}$\n\tsuch that $\\zeta_m\\subset \\zeta_{m+1}$ for all $m\\geq n-1$,\n\tand such that $\\zeta_m$ is $\\sim_m$-equivalent to $\\omega_m$.\n\tFor $m=n-1$, simply put $\\zeta_m = \\omega_m$.\n\tSuppose that $m>n-1$ and that $\\zeta_{m-1}$ is defined.\n\tThere is an edge between $\\omega_{m-1}$ and $\\omega_m$ by hypothesis\n\tand $\\zeta_{m-1}\\sim_{m-1}\\omega_{m-1}$,\n\twhich means that there is $\\alpha$ in $G_n$\n\tsuch that $\\alpha{{\\omega_m}|_{{\\{0,\\dots,m-1\\}}}} = \\zeta_{m-1}$.\n\tDefine $\\zeta_m$ to be $\\alpha\\omega_m$.\n\tWe have $\\zeta_{m-1} = {{\\zeta_m}|_{{\\{0,\\dots,m-1\\}}}}$\n\tand $\\zeta_m\\sim_m\\omega_m$, as required.\n\tLet now $\\zeta = \\bigcup_{m\\geq n-1} \\zeta_m$.\n\tIt remains to prove that $\\zeta$ is an $(\\ell,S)$-mashup of $g,h$ for every finite $S\\subset{\\mathbb N}$.\n\tLet $S$ be such a finite set, and $m$ be such that $m\\geq n-1$ and\n\t$m\\geq \\max(S)$.\n\tSince $\\zeta_m\\sim_m\\omega_m$ and $\\omega_m$ is an $(\\ell,\\{0,\\dots,m\\})$-mashup of $g,h$,\n\tso is $\\zeta_m$.\n\tFinally, since $\\zeta_m={{\\zeta}|_{{\\{0,\\dots,m\\}}}}$, we have\n    that $\\zeta$ is an $(\\ell,S)$-mashup of $g,h$ for every finite $S$.\n    Let $\\zeta'$ be canonical and obtained from $\\zeta$ by Lemma~\\ref{lem:canonization}.\n    It is immediate that $\\zeta'$ is an $(\\ell,S)$-mashup of $g,h$ for every finite $S$.\n    Moreover, $\\zeta'$ is in $\\overline{G_n\\zeta G_n}$ and we have\n    \n", "index": 35, "text": "$$\\overline{G_n\\zeta G_n} \\subseteq \\overline{G_n\\{\\omega_m\\colon m\\geq n-1\\}G_n}\n                               \\subseteq \\overline{G_n\\{f_i\\colon i\\in{\\mathbb N}\\}G_n},$$\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex21.m1\" class=\"ltx_Math\" alttext=\"\\overline{G_{n}\\zeta G_{n}}\\subseteq\\overline{G_{n}\\{\\omega_{m}\\colon m\\geq n-%&#10;1\\}G_{n}}\\subseteq\\overline{G_{n}\\{f_{i}\\colon i\\in{\\mathbb{N}}\\}G_{n}},\" display=\"block\"><mrow><mrow><mover accent=\"true\"><mrow><msub><mi>G</mi><mi>n</mi></msub><mo>\u2062</mo><mi>\u03b6</mi><mo>\u2062</mo><msub><mi>G</mi><mi>n</mi></msub></mrow><mo>\u00af</mo></mover><mo>\u2286</mo><mover accent=\"true\"><mrow><msub><mi>G</mi><mi>n</mi></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">{</mo><msub><mi>\u03c9</mi><mi>m</mi></msub><mo>:</mo><mrow><mi>m</mi><mo>\u2265</mo><mrow><mi>n</mi><mo>-</mo><mn>1</mn></mrow></mrow><mo stretchy=\"false\">}</mo></mrow><mo>\u2062</mo><msub><mi>G</mi><mi>n</mi></msub></mrow><mo>\u00af</mo></mover><mo>\u2286</mo><mover accent=\"true\"><mrow><msub><mi>G</mi><mi>n</mi></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">{</mo><msub><mi>f</mi><mi>i</mi></msub><mo>:</mo><mrow><mi>i</mi><mo>\u2208</mo><mi>\u2115</mi></mrow><mo stretchy=\"false\">}</mo></mrow><mo>\u2062</mo><msub><mi>G</mi><mi>n</mi></msub></mrow><mo>\u00af</mo></mover></mrow><mo>,</mo></mrow></math>", "type": "latex"}, {"file": "1601.04520.tex", "nexttext": "\n\twhere $\\sigma$ is the permutation $(x_1,\\dots,x_k)\\mapsto (x_2,\\dots,x_k,x_1)$.\n\tWe claim that $\\xi^{\\mathrm{typ}}_2(f')\\in{\\mathscr D}^{\\mathrm{typ}}_2$ is cyclic.\n\tIt is trivial to check that $\\xi^{\\mathrm{typ}}_1(f')$ is cyclic in ${\\mathscr D}^{{\\mathrm{typ}}}_1$.\n\t\n\tWe now show that for all $k$-tuples ${\\mathbf a},{\\mathbf b}$\n\tsuch that $f'({\\mathbf a})=f'({\\mathbf b})$ we have\n\t$f'(\\sigma{\\mathbf a}) = f'(\\sigma{\\mathbf b})$.\n\tSuppose that ${\\mathbf a}$ and ${\\mathbf b}$ are given and\n\tmap to the same point under $f'$.\n        This means that\n\t\n", "itemtype": "equation", "pos": 68844, "prevtext": "\n    so that $\\zeta'$ is in $\\overline{G_n\\{f_i\\colon i\\in{\\mathbb N}\\}G_n}$ as required.\n\\end{proof}\n\nThe orbit of an element $m$ in $\\{0,\\dots,n-1\\}$ is $\\{m\\}$ and can be interpreted as $m$ itself,\nand the orbit of \nan element in ${\\mathbb N}\\setminus\\{0,\\dots,n-1\\}$ \nis exactly ${\\mathbb N}\\setminus\\{0,\\dots,n-1\\}$, and in the following will be associated with $n$.\n\n\\begin{proposition}[Building Mashups]\\label{prop:M-implies-mashup}\n    Let $g,h$ be canonical functions of arity $k$ and let $\\ell\\in [k]$.\n    Suppose that $\\omega$ is canonical and is an $(\\ell,S)$-mashup of $g,h$ for every finite $S\\subset{\\mathbb N}$.\n    Then $\\xi^{\\mathrm{typ}}_1(\\omega)$ is an $\\ell$-mashup of $\\xi^{{\\mathrm{typ}}}_1(g)$ and $\\xi^{\\mathrm{typ}}_1(h)$.\n\\end{proposition}\n\\begin{proof}\n    \n    \n    \n    Let $x_1,\\dots,x_k \\in {\\mathbb N}$ be such that \n    $x_l \\in \\{0,\\dots,n-1\\}$, \n    and let $y_i$ be the orbit of $x_i$ \n    under $G_n$.\n    Then $\\xi^{\\mathrm{typ}}_1(\\omega)(y_1,\\dots,y_k)$ is by definition the orbit of $\\omega(x_1,\\dots,x_k)$.\n    \n    Since $\\omega$ is by assumption an $(\\ell,\\{x_1,\\dots,x_k\\})$-mashup there exists an $\\alpha \\in G_n$ such that $\\omega(x_1,\\dots,x_k) = \\alpha g(x_1,\\dots,x_k)$.\n    \n    \n    Hence, $\\xi^{\\mathrm{typ}}_1(\\omega)(y_1,\\dots,y_k) = \\xi^{\\mathrm{typ}}_1(g)(y_1,\\dots,y_k)$.\n    The proof for the case that $x_{\\ell'} \\in \\{0,\\dots,n-1\\}$ for all $\\ell' \\neq \\ell$ is similar.\n\\end{proof}\n\n\n\nWe now apply mashups to study\nfunction clones ${\\mathscr C}$ such that for some $n \\geq 0$, the set of operations \n$G_n$ is dense in the set of all unary operations of ${\\mathscr C}$, which we denote by ${\\mathscr C}^{(1)}$.\nWe prove that for these clones, we can reduce the question of the existence\nof \\emph{continuous h1 clone homomorphisms} to ${\\mathbf 2}$\nto the existence of (regular) clone homomorphisms from the\ncanonical subclone of ${\\mathscr C}$ to ${\\mathbf 2}$.\n\nLet ${\\mathscr C}$ be a closed function clone over ${\\mathbb N}$.\nWhen $G_n$ is dense in ${\\mathscr C}^{(1)}$,\nthe map that takes $f\\in{\\mathscr C}$ to ${{f}|_{{{\\mathbb N}\\setminus\\{0,\\dots,n-1\\}}}}$\nis well-defined and a continuous clone homomorphism;\nthe image of this clone homomorphism\nis a function clone ${\\mathscr C}_{\\neq}$ \nover the domain ${{\\mathbb N}\\setminus\\{0,\\dots,n-1\\}}$.\nClearly, every permutation of the domain \nof ${\\mathscr C}_{\\neq}$ is an operation in ${\\mathscr C}_{\\neq}$.\nSuch clones have been studied in~\\cite{ecsps} in the context of constraint satisfaction\nproblems. In particular, the authors show the following.\n\n\\begin{thm}[Consequence of Theorem~7 in~\\cite{ecsps}]\\label{thm:classification-equality-languages}\n\tLet ${\\mathscr C}$ be a closed clone over a countably infinite set $D$,\n\tcontaining $\\mathrm{Sym}(D)$.\n\tThen ${\\mathscr C}$ has a continuous homomorphism to ${\\mathbf 2}$\n\tif and only if there is no constant unary \n\tand no injective binary operation in ${\\mathscr C}$.\n\\end{thm}\n\n\n\\begin{proposition}\\label{prop:cyclic-one-type-two-types}\n\tLet ${\\mathscr C}$ be a closed clone over ${\\mathbb N}$ such that $G_n$\n\tis dense in ${\\mathscr C}^{(1)}$.\n\tLet ${\\mathscr D}$ be the subclone of ${\\mathscr C}$ that contains the operations of ${\\mathscr C}$\n\tthat are canonical.\n\tSuppose that the clone ${\\mathscr C}_{\\neq}$ does not have a homomorphism to ${\\mathbf 2}$.\n\tThen if ${\\mathscr D}^{{\\mathrm{typ}}}_1$ has a cyclic operation, so does ${\\mathscr D}^{{\\mathrm{typ}}}_2$.\n\\end{proposition}\n\\begin{proof}\n\tLet $f\\in{\\mathscr D}$ be such that $\\xi^{\\mathrm{typ}}_1(f)$ cyclic in ${\\mathscr D}^{{\\mathrm{typ}}}_1$, of arity $k$.\n\tSince ${\\mathscr C}_{\\neq}$ does not have a homomorphism to ${\\mathbf 2}$,\n\tthere exists by Theorem~\\ref{thm:classification-equality-languages}\n\ta binary function $g'$ in ${\\mathscr D}$ such that $g'$ is injective when restricted to\n\t${\\mathbb N}\\setminus\\{0,\\dots,n-1\\}$ \n\t(indeed, ${\\mathscr C}_{\\neq}$ cannot contain a unary constant function,\n\tfor $G_n$ is dense in ${\\mathscr C}^{(1)}$).\n\tDefine $g(x_1,\\dots,x_k) := g'(x_1,g'(x_2,\\dots g'(x_{k-1},x_k) \\dots ))$ \n\t(an injection on ${\\mathbb N} \\setminus \\{0,\\dots,n-1\\}$), and  \n\tconsider $f' \\in {\\mathscr D}$ defined by\n\t\n", "index": 37, "text": "$$f'({\\mathbf x}) = g(f({\\mathbf x}),f(\\sigma{\\mathbf x}),\\dots,f(\\sigma^{k-1}{\\mathbf x})),$$\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex22.m1\" class=\"ltx_Math\" alttext=\"f^{\\prime}({\\mathbf{x}})=g(f({\\mathbf{x}}),f(\\sigma{\\mathbf{x}}),\\dots,f(%&#10;\\sigma^{k-1}{\\mathbf{x}})),\" display=\"block\"><mrow><mrow><mrow><msup><mi>f</mi><mo>\u2032</mo></msup><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>\ud835\udc31</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mrow><mi>g</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mrow><mi>f</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>\ud835\udc31</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>,</mo><mrow><mi>f</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mrow><mi>\u03c3</mi><mo>\u2062</mo><mi>\ud835\udc31</mi></mrow><mo stretchy=\"false\">)</mo></mrow></mrow><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><mrow><mi>f</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mrow><msup><mi>\u03c3</mi><mrow><mi>k</mi><mo>-</mo><mn>1</mn></mrow></msup><mo>\u2062</mo><mi>\ud835\udc31</mi></mrow><mo stretchy=\"false\">)</mo></mrow></mrow><mo stretchy=\"false\">)</mo></mrow></mrow></mrow><mo>,</mo></mrow></math>", "type": "latex"}, {"file": "1601.04520.tex", "nexttext": "\n\tIf $f({\\mathbf a})=m\\in\\{0,\\dots,n-1\\}$, then $f(\\sigma^i({\\mathbf a}))=m$ for every $i\\in\\{0,\\dots,k-1\\}$ since $f$ is cyclic in ${\\mathscr D}^{{\\mathrm{typ}}}_1$,\n\tand therefore\n\t$f'({\\mathbf a}) = m = f'(\\sigma {\\mathbf a})$.\n\tThis implies that $f'({\\mathbf b})=m$ and $f'(\\sigma{\\mathbf b})=m$ because $f'$ is cyclic in ${\\mathscr D}^{{\\mathrm{typ}}}_1$.\n\tOtherwise, $f({\\mathbf a})\\not\\in\\{0,\\dots,n-1\\}$ (and again, this holds for every cyclic permutation of the arguments).\n\tThen (\\ref{eq:cycl}) implies that \n\t$f(\\sigma^i{\\mathbf a}) = f(\\sigma^i{\\mathbf b})$ for all $i\\in\\{0,\\dots,k-1\\}$ by\n  injectivity of $g$ on ${\\mathbb N}\\setminus\\{0,\\dots,n-1\\}$.\n\tInjecting this back into (\\ref{eq:cycl}), we readily obtain $f'(\\sigma{\\mathbf a}) = f'(\\sigma{\\mathbf b})$.\n\t\n\tTo show that $\\xi^{\\mathrm{typ}}_2(f')$ is cyclic, \n\tlet $(a_1,b_1)$, $\\dots, (a_k,b_k)$ be pairs of integers.\n\tWe have to show that \n\t$(f'({\\mathbf a}), f'({\\mathbf b}))$ \n\tand $(f'(\\sigma{\\mathbf a}), f'(\\sigma{\\mathbf b}))$ are in the same orbit under $G_n$. \n\tSince $\\xi^{\\mathrm{typ}}_1(f')$ is cyclic,\n\twe already know that $f'({\\mathbf a})$ and $f'(\\sigma{\\mathbf a})$ are in the same orbit,\n    and that $f'({\\mathbf b})$ and $f'(\\sigma{\\mathbf b})$ are in the same orbit.\n\tBy the property $(\\dagger)$ we stated in the proof of Lemma~\\ref{lem:canonization},\n\twe only need to check that $f'({\\mathbf a})=f'({\\mathbf b})$ iff\n\t$f'(\\sigma{\\mathbf a}) = f'(\\sigma{\\mathbf b})$.\n\tIn the left-to-right direction, this is what we proved above.\n\tFor the other direction, note that we can apply $k-1$ times\n\tthe argument of the previous paragraph to obtain\n\tthat if $f'(\\sigma {\\mathbf a}) = f'(\\sigma{\\mathbf b})$, then\n\t$f'(\\sigma^k({\\mathbf a})) = f'(\\sigma^k({\\mathbf b}))$,\n\ti.e., $f'({\\mathbf a}) = f'({\\mathbf b})$.\n\\end{proof}\n\n\\begin{thm}\\label{thm:link-to-canonical-subclone}\n\tLet ${\\mathscr C}$ be a closed function clone over ${\\mathbb N}$ such that $G_n$\n\tis dense in ${\\mathscr C}^{(1)}$.\n\tLet ${\\mathscr D}$ be the subclone of ${\\mathscr C}$ \n\tthat contains the\n\tfunctions that are canonical\n\twith respect to $({\\mathbb N};0,\\dots,n-1)$.\n\tSuppose that ${\\mathscr D}$ admits a clone homomorphism to ${\\mathbf 2}$.\n\tThen ${\\mathscr C}$ admits a continuous h1 clone homomorphism to ${\\mathbf 2}$ which preserves\n    left-composition with operations from ${\\mathscr C}^{(1)}$.\n\\end{thm}\n\\begin{proof}\n\tSuppose first that there exists a continuous clone homomorphism from ${\\mathscr C}_{\\neq}$\n\tto ${\\mathbf 2}$.\n\tSince there exists a continuous clone homomorphism from ${\\mathscr C}$ to ${\\mathscr C}_{\\neq}$,\n\twe then obtain a continuous clone homomorphism from ${\\mathscr C}$ to ${\\mathbf 2}$.\n\tThis function is in particular a continuous h1 clone homomorphism.\n\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n\tOtherwise, ${\\mathscr C}_{\\neq}$ does not have a homomorphism to ${\\mathbf 2}$.\nSince  ${\\mathscr D}$ has a clone homomorphism to ${\\mathbf 2}$, \nso does ${\\mathscr D}^{{\\mathrm{typ}}}_2$, by Theorem~6.7 in~\\cite{BPP-projective-homomorphisms}.        \n\tHence, and by Theorem~\\ref{thm:finite}, \n${\\mathscr D}^{{\\mathrm{typ}}}_2$ does not have a cyclic operation. \n\tProposition~\\ref{prop:cyclic-one-type-two-types} then implies that \n\t${\\mathscr D}^{{\\mathrm{typ}}}_1$ does not have a cyclic operation. \n\tAgain by Theorem~\\ref{thm:finite},\n\tthere exists a clone homomorphism from ${\\mathscr D}^{{\\mathrm{typ}}}_1$ to ${\\mathbf 2}$.\n\n\n\tBy Corollary~\\ref{cor:mashup-homomorphism-version}, there exists a clone homomorphism\n\t$\\xi'\\colon{\\mathscr D}^{\\mathrm{typ}}_1\\to{\\mathbf 2}$ such that any two functions of ${\\mathscr D}^{\\mathrm{typ}}_1$ which have\n\tall their mashups in ${\\mathscr D}^{\\mathrm{typ}}_1$ are mapped to the same projection in ${\\mathbf 2}$.\n\tBy composition of $\\xi^{{\\mathrm{typ}}}_1$ with $\\xi'$, we obtain a continuous clone homomorphism\n\t$\\xi\\colon{\\mathscr D}\\to{\\mathbf 2}$.\n\tDefine the extension $\\phi$ of $\\xi$ to the whole clone ${\\mathscr C}$ by setting $\\phi(f) := \\xi(g)$, where $g$\n\tis any canonical function that is interpolated by $f$ modulo $G_n$.\n \n\n\t{\\bf $\\phi$ is well defined:} let $g,h$ be canonical and interpolated by $f$ modulo $G_n$.\n\tLet $\\ell\\in[k]$. By applying Proposition~\\ref{prop:building-mashups} with $f_i=f$ for all $i\\in{\\mathbb N}$,\n\twe obtain an operation $\\zeta_\\ell$\n\twhich is canonical and interpolated by $f$ modulo $G_n$\n\tand which is an $(\\ell,S)$-mashup of $g,h$ for every finite $S\\subset{\\mathbb N}$.\n\tThen $\\xi^{{\\mathrm{typ}}}_1(\\zeta_l) \\in {\\mathscr D}^{\\mathrm{typ}}_1$ is an $\\ell$-mashup of $\\xi^{\\mathrm{typ}}_1(g)$ and $\\xi^{\\mathrm{typ}}_1(h)$ by Proposition~\\ref{prop:M-implies-mashup}.\n    Since this holds for all $\\ell \\in [k]$ \n\twe therefore have $\\xi'(\\xi^{{\\mathrm{typ}}}_1(g))=\\xi'(\\xi^{{\\mathrm{typ}}}_1(h))$,\n\ti.e., $\\xi(g)=\\xi(h)$ and $\\phi$ is well defined.\n\t\n\n\t{\\bf $\\phi$ is continuous:} let $(f_i)_{i\\in{\\mathbb N}}$ be a sequence in ${\\mathscr C}$ converging to $f\\in{\\mathscr C}$.\n\tSince there are only finitely many behaviours of canonical functions of a given arity,\n\tthere exists an infinite set $I\\subseteq{\\mathbb N}$ and a canonical function $h\\in{\\mathscr D}$\n\tsuch that $f_i$ interpolates $h$ modulo $G_n$ for all $i\\in I$.\n\tLet $g$ be any canonical function that is interpolated by $f$\n\tmodulo $G_n$.\n\tBy Proposition~\\ref{prop:building-mashups} with $(f_i)_{i\\in I}\\to f$, \n\tthere exists in $\\overline{G_n\\{f_i\\mid i\\in\\omega\\}G_n}$ a canonical operation $\\zeta_\\ell$ which is an $(\\ell,S)$-mashup of $g,h$\n    for every finite $S\\subset{\\mathbb N}$.\n\tAs above, Proposition~\\ref{prop:M-implies-mashup} implies that for all $\\ell\\in[k]$ the function $\\xi^{\\mathrm{typ}}_1(\\zeta_l) \\in {\\mathscr D}^{\\mathrm{typ}}_1$ is an $\\ell$-mashup\n\tof $\\xi^{\\mathrm{typ}}_1(g)$ and $\\xi^{\\mathrm{typ}}_1(h)$ which implies that $\\xi(g)=\\xi(h)$.\n\tIn particular, this shows that $(\\phi(f_i))_{i\\in{\\mathbb N}}$ converges: indeed,\n\t\\emph{a priori} $h$ depends on the choice of $I\\subset{\\mathbb N}$ but we just proved that $\\xi(h)$\n\tis $\\xi(g)$, whatever $h$ we pick.\n\tSince $(\\phi(f_i))$ converges to $\\phi(f)$ we conclude that $\\phi$ is continuous.\n\n\n\t{\\bf $\\phi$ preserves left-composition with unary operations:} let $\\alpha$ be an invertible of ${\\mathscr C}$,\n\ti.e., $\\alpha$ is an element of $G_n$. Let $f\\in{\\mathscr C}$.\n\tLet $g$ be canonical and interpolated by $\\alpha\\circ f$ modulo $G_n$. Note that $g$ is also interpolated by $f$ modulo $G_n$, so that $\\phi(f) = \\xi(g) = \\phi(\\alpha\\circ f)$.\n\tSince the only unary operation in ${\\mathbf 2}$ is the identity operation, we finally have $\\phi(\\alpha)\\circ\\phi(f)=\\phi(f)$.\n    The continuity of $\\phi$ implies that it also preserves left-composition with elements which are in the topological closure\n    of the invertibles. These are all the unary operations of ${\\mathscr C}$, by assumption.\n\t\n\n\t{\\bf $\\phi$ is an h1 clone homomorphism:} we need to prove that $\\phi(f\\circ(\\pi_{i_1}^m,\\dots,\\pi_{i_k}^m)) = \\phi(f)\\circ(\\pi_{i_1}^m,\\dots,\\pi_{i_k}^m)$\n\tfor every $f\\in{\\mathscr C}$ of arity $k\\geq 1$ and every $m\\geq 1$.\n\tLet $g\\colon{\\mathbb N}^k\\to{\\mathbb N}$ be canonical and interpolated by $f$ modulo $G_n$.\n\tThen $g\\circ(\\pi_{i_1}^m,\\dots,\\pi_{i_k}^m)$\n\tis interpolated modulo $G_n$ by $f\\circ(\\pi_{i_1}^m,\\dots,\\pi_{i_k}^m)$.\n\tSo \n\t\n", "itemtype": "equation", "pos": 69497, "prevtext": "\n\twhere $\\sigma$ is the permutation $(x_1,\\dots,x_k)\\mapsto (x_2,\\dots,x_k,x_1)$.\n\tWe claim that $\\xi^{\\mathrm{typ}}_2(f')\\in{\\mathscr D}^{\\mathrm{typ}}_2$ is cyclic.\n\tIt is trivial to check that $\\xi^{\\mathrm{typ}}_1(f')$ is cyclic in ${\\mathscr D}^{{\\mathrm{typ}}}_1$.\n\t\n\tWe now show that for all $k$-tuples ${\\mathbf a},{\\mathbf b}$\n\tsuch that $f'({\\mathbf a})=f'({\\mathbf b})$ we have\n\t$f'(\\sigma{\\mathbf a}) = f'(\\sigma{\\mathbf b})$.\n\tSuppose that ${\\mathbf a}$ and ${\\mathbf b}$ are given and\n\tmap to the same point under $f'$.\n        This means that\n\t\n", "index": 39, "text": "\\begin{align}\n\tg(f({\\mathbf a}),f(\\sigma{\\mathbf a}),\\dots,f(\\sigma^{k-1}{\\mathbf a})) = g(f({\\mathbf b}),f(\\sigma{\\mathbf b}),\\dots,f(\\sigma^{k-1}{\\mathbf b})).\n\t\\label{eq:cycl}\n\t\\end{align}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E4.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle g(f({\\mathbf{a}}),f(\\sigma{\\mathbf{a}}),\\dots,f(\\sigma^{k-1}{%&#10;\\mathbf{a}}))=g(f({\\mathbf{b}}),f(\\sigma{\\mathbf{b}}),\\dots,f(\\sigma^{k-1}{%&#10;\\mathbf{b}})).\" display=\"inline\"><mrow><mrow><mrow><mi>g</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mrow><mi>f</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>\ud835\udc1a</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>,</mo><mrow><mi>f</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mrow><mi>\u03c3</mi><mo>\u2062</mo><mi>\ud835\udc1a</mi></mrow><mo stretchy=\"false\">)</mo></mrow></mrow><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><mrow><mi>f</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mrow><msup><mi>\u03c3</mi><mrow><mi>k</mi><mo>-</mo><mn>1</mn></mrow></msup><mo>\u2062</mo><mi>\ud835\udc1a</mi></mrow><mo stretchy=\"false\">)</mo></mrow></mrow><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mrow><mi>g</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mrow><mi>f</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>\ud835\udc1b</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>,</mo><mrow><mi>f</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mrow><mi>\u03c3</mi><mo>\u2062</mo><mi>\ud835\udc1b</mi></mrow><mo stretchy=\"false\">)</mo></mrow></mrow><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><mrow><mi>f</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mrow><msup><mi>\u03c3</mi><mrow><mi>k</mi><mo>-</mo><mn>1</mn></mrow></msup><mo>\u2062</mo><mi>\ud835\udc1b</mi></mrow><mo stretchy=\"false\">)</mo></mrow></mrow><mo stretchy=\"false\">)</mo></mrow></mrow></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.04520.tex", "nexttext": "\n\twhere (\\ref{eq:link-canonical-1}) and (\\ref{eq:link-canonical-3})\n\thold by definition of $\\phi$, and (\\ref{eq:link-canonical-2})\n\tholds since $\\xi$ is a clone homomorphism.\n\t\n\t\n\n\\end{proof}\n\nWe can finally prove Theorem~\\ref{thm:ua-result} from the introduction; we first re-state it \nin the terminology from Section~\\ref{sect:tractability-conditions}. \n\n\n\n\\begin{thm}\\label{thm:ua-result-restated}\nLet ${\\mathbb A}$ be a reduct of $({\\mathbb N};0,1,\\dots,n-1)$\nsuch that ${\\operatorname{End}}({\\mathbb A})$ is the set of injections that preserve \n$0,1,\\dots,n-1$. Then either there exists a continuous h1 clone homomorphism from ${\\operatorname{Pol}}({\\mathbb A})$ to ${\\bf 2}$\nthat preserves left-composition with operations from ${\\operatorname{End}}({\\mathbb A})$ or ${\\mathbb A}$ has a cyclic (Siggers, weak near-unanimity) polymorphism modulo endomorphisms of ${\\mathbb A}$\nthat is canonical with respect to $({\\mathbb N};0,1,\\dots,n-1)$. \n\\end{thm}\n\nWe first prove that the two cases\nare indeed disjoint; \nthis holds in general, and we therefore state it in a separate lemma.  \n\n\\begin{lemma}\\label{lem:disj}\nLet ${\\mathbb A}$ be a relational structure. If ${\\mathbb A}$ has a cyclic polymorphism, a Siggers polymorphism, or a weak near-unanimity polymorphism modulo endomorphisms, then there is no continuous\nh1 clone homomorphism from ${\\operatorname{Pol}}({\\mathbb A})$ to ${\\bf 2}$\nthat preserves left-composition with operations from\n${\\operatorname{End}}({\\mathbb A})$. \n\\end{lemma}\n\\begin{proof}\n Let $f \\in {\\operatorname{Pol}}({\\mathbb A})$\n    which is Siggers modulo ${\\operatorname{End}}({\\mathbb A})$ and let $\\phi$ be an h1 homomorphism\n    from ${\\operatorname{Pol}}({\\mathbb A})$ to ${\\mathbf 2}$ which preserves left-composition.\n    Then we must have $\\phi(e_1\\circ f)(x,y,x,z,y,z) = \\phi(e_2\\circ f)(y,x,z,x,z,y)$\n    for all $x,y,z \\in{\\mathbb N}$ since $\\phi$ preserves equations of height $1$.\n    Moreover, we have $\\phi(e_i\\circ f)=\\phi(f)$ since $\\phi$ preserves left-composition with operations from ${\\operatorname{End}}({\\mathbb A})$.\n    It follows that $\\phi(f)$ is a projection that satisfies the Siggers equation, a contradiction.\n    If $f$ is cyclic or a weak near-unanimity modulo  ${\\operatorname{End}}({\\mathbb A})$, we similarly reach a contradiction. \n\\end{proof}\n\n\\begin{proof}[Proof of Theorem~\\ref{thm:ua-result-restated}]\nLemma~\\ref{lem:disj} shows that the two cases are indeed disjoint.\n    Suppose now that the first case does not apply.\n    It follows from Theorem~\\ref{thm:link-to-canonical-subclone} that if ${\\mathscr D}$\n    is the canonical subclone of ${\\operatorname{Pol}}({\\mathbb A})$, there is no clone homomorphism ${\\mathscr D}\\to{\\mathbf 2}$. Since there is\n    a clone homomorphism \n    $\\xi^{\\mathrm{typ}}_2\\colon{\\mathscr D}\\to{\\mathscr D}^{\\mathrm{typ}}_2$, it also\n    follows that there is no clone homomorphism \n    ${\\mathscr D}^{\\mathrm{typ}}_2\\to{\\mathbf 2}$. Since \n    ${\\mathbb A}$ is $\\omega$-categorical, the function clone \n    ${\\mathscr D}^{\\mathrm{typ}}_2$ acts on a finite domain. \n    Moreover, since the endomorphisms of ${\\mathbb A}$ are all injective and fix $0,\\dots,n-1$, we see that\n    all operations in $\\mathcal D$ preserve\n    all orbits of pairs, and therefore all operations in \n    ${\\mathscr D}^{\\mathrm{typ}}_2$ are idempotent. We can now\n    apply Theorem~\\ref{thm:finite} and obtain\n    that ${\\mathscr D}^{\\mathrm{typ}}_2$ contains a Siggers\n    operation (equivalently, a cyclic operation\n    or a weak near-unanimity).     \n    Proposition~6.6 in~\\cite{BPP-projective-homomorphisms} states that there is an operation $f \\in {\\mathscr D}$ which is Siggers (equivalently, a cyclic operation\n    or a weak near-unanimity) modulo unary operations in ${\\mathscr D}$.\n    The unary operations in ${\\mathscr D}$ are endomorphisms\n    of ${\\mathbb B}$, and $f$ is a polymorphism of ${\\mathbb B}$ that \n    is canonical with respect to $({\\mathbb N};0,1,\\dots,n-1)$. \n\\end{proof}\n\n\n\\section{Lifting the Tractability Conjecture}\n\\label{sect:lift}\nIn this section, we present\na tractability conjecture for finite-signature reducts \n${\\mathbb A}$ of $({\\mathbb N}; 0,1,2,\\dots)$, and prove that\nthe tractability conjecture is equivalent to the tractability conjecture for finite-domain constraint satisfaction as stated in Section~\\ref{sect:tractability-conditions}. \n\n\\begin{conj}\\label{conj:our-tractability}\nLet ${\\mathbb A}$ be a finite-signature reduct ${\\mathbb A}$ \nof the structure $({\\mathbb N};0,1,2,\\dots)$. \nThen ${\\operatorname{CSP}}({\\mathbb A})$ is in P if \n    an expansion ${\\mathbb C}$ of\n    the model-complete core of ${\\mathbb A}$ by finitely many constants has a Siggers polymorphism modulo endomorphisms of ${\\mathbb C}$ \n    which is canonical with respect to ${\\mathbb C}$,\n    and is NP-complete otherwise.\n\\end{conj}\n\nIn combination with the algorithmic\nresults from Section~\\ref{sect:tractability-conditions}, \nTheorem~\\ref{thm:ua-result-restated}\nwill take care of the situation (up to isomorphisms) where\n${\\operatorname{End}}({\\mathbb A})$ is the set of injections \nthat preserve $0,1,\\dots,n-1$. \nIn the following, we reduce\nthe general case to this situation. \n\n\n\n\n\n\n\n\n\n\n\n\nAn $\\omega$-categorical structure ${\\mathbb A}$ is a \\emph{model-complete core} if the set of automorphisms of ${\\mathbb A}$ is dense in the set of endomorphisms of ${\\mathbb A}$.\nExamples of model-complete cores are the structures ${\\mathbb A}$\nin the statement of Theorem~\\ref{thm:ua-result-restated}.\nIndeed, let ${\\mathbb A}$ be such a structure. The automorphism group of ${\\mathbb A}$\ncontains all the permutations of ${\\mathbb N}$ that pointwise fix $0,\\dots,n-1$.\nHence, if $e$ is an injective function on ${\\mathbb N}$ fixing $0,\\dots,n-1$ and $S$ is a finite subset of ${\\mathbb N}$, then there is an automorphism $\\alpha$ of ${\\mathbb A}$\nsuch that ${{\\alpha}|_{{S}}}={{e}|_{{S}}}$. Therefore, $e$ is\nin the topological closure of ${\\operatorname{Aut}}({\\mathbb A})$, and ${\\operatorname{Aut}}({\\mathbb A})$ is dense\nin ${\\operatorname{End}}({\\mathbb A})$.\n\n\n\n\n\n\\begin{thm}[From \\cite{Cores-journal}]\nLet ${\\mathbb A}$ be an $\\omega$-categorical structure. Then ${\\mathbb A}$ is homomorphically equivalent to a model-complete core, which is unique up to isomorphism, and again $\\omega$-categorical. \n\\end{thm}\n\nWe can assume that the model-complete core ${\\mathbb B}$ of ${\\mathbb A}$ \nis a substructure of ${\\mathbb A}$.\nIndeed, if $f\\colon{\\mathbb A}\\to{\\mathbb B}$ and $g\\colon{\\mathbb B}\\to{\\mathbb A}$ are homomorphisms,\nthen $f\\circ g$ is an endomorphism of ${\\mathbb B}$, and is therefore an embedding\n${\\mathbb B}\\hookrightarrow{\\mathbb B}$. This implies that $g$ is an embedding of ${\\mathbb B}$ into ${\\mathbb A}$.\nWe can then replace ${\\mathbb B}$ by $g({\\mathbb B})\\subseteq{\\mathbb A}$.\n\n\\begin{lemma}\\label{lem:mc-core}\nLet ${\\mathbb A}$ be a reduct of $({\\mathbb N};0,\\dots,n-1)$, and let ${\\mathbb B}$ be the model-complete core of ${\\mathbb A}$.\nThen ${\\mathbb B}$ is finite or there exists an $n' \\leq n$ such that ${\\mathbb B}$ is isomorphic to a reduct of $({\\mathbb N};0,\\dots,n'-1)$. \n\\end{lemma}\n\\begin{proof}\nSuppose that ${\\mathbb B}$ is an infinite substructure of ${\\mathbb A}$. \nLet $h$ be a homomorphism from ${\\mathbb A}$ to ${\\mathbb B}$.\nLet $S$ be $\\{0,\\dots,n-1\\}\\cap B$. We prove that every permutation\nof $B$ which fixes $S$ pointwise is an automorphism of ${\\mathbb B}$.\nLet $\\beta$ be such a permutation. Then $\\beta$ can be extended to a permutation $\\alpha$\nof ${\\mathbb N}$ which fixes $0,\\dots,n-1$, and therefore $\\alpha$ is an automorphism of ${\\mathbb A}$.\nThus, $h\\circ\\beta={{h\\circ\\alpha}|_{{B}}}\\colon {\\mathbb B}\\to{\\mathbb B}$ is an endomorphism of ${\\mathbb B}$,\nand so an embedding since ${\\mathbb B}$ is a model-complete core.\nThis implies that $\\beta$ is an embedding, i.e., it is an automorphism of ${\\mathbb B}$. \n\nNote that $S$ is finite, and let $s_0,\\dots,s_{n'-1}$ be the elements of $S$.\nWe proved in the previous paragraph that the automorphism group of ${\\mathbb B}$\ncontains all the permutations that fix $S$ pointwise,\nand note that $(B;s_0,\\dots,s_{n'-1})$ is an $\\omega$-categorical structure.\nIt is a known corollary of the Ryll-Narzewski theorem~\\cite{Hodges}\nthat if a structure ${\\mathbb C}$ is $\\omega$-categorical\nand ${\\operatorname{Aut}}({\\mathbb C})\\subseteq{\\operatorname{Aut}}({\\mathbb B})$ then ${\\mathbb B}$ is a first-order reduct of ${\\mathbb C}$.\nIt follows that ${\\mathbb B}$ is a first-order \nreduct of $(B; s_0,\\dots,s_{n'-1})$,\nso it is isomorphic to a reduct of $({\\mathbb N}; 0,\\dots,n'-1)$.\n\\end{proof}\n\n\n\n\\begin{cor}\\label{cor:Siggers-iff-no-homo} \n    Let ${\\mathbb A}$ be a first-order reduct of $({\\mathbb N};0,\\dots,n-1)$ \n       and let ${\\mathbb C}$ be the model-complete core of ${\\mathbb A}$.\n       Then there are elements $c_0,\\dots,c_{n'-1}$ of ${\\mathbb C}$\n       such that ${\\mathscr C} := {\\operatorname{Pol}}({\\mathbb C},c_0,\\dots,c_{n'-1})$ \n       satisfies exactly one of the following cases:\n    \\begin{enumerate}\n        \\item there is a continuous h1 clone homomorphism ${\\mathscr C} \\to{\\mathbf 2}$ that\n        preserves left-composition with ${\\operatorname{End}}({\\mathbb C})$;\n        \\item ${\\mathscr C}$ contains a cyclic \n        (equivalently: a Siggers,\n         or a weak near unanimity) operation $f$\n        modulo unary operations of ${\\mathscr C}$; moreover, $f$ is\n        canonical with respect to $(C;c_0,\\dots,c_{n'-1})$.\n     \\end{enumerate}\n\\end{cor}\n\\begin{proof} \nIf ${\\mathbb C}$ is finite, then we choose $c_1,\\dots,c_{n'}$ to be all the elements of ${\\mathbb C}$, and the statement follows from\nTheorem~\\ref{thm:finite}. Otherwise, \n${\\mathbb C}$ is isomorphic to a reduct of $({\\mathbb N};0,\\dots,n'-1)$ for some $n'$ by Lemma~\\ref{lem:mc-core}. We now assume\nthat ${\\mathbb C}$ is a reduct of $({\\mathbb N};0,\\dots,n'-1)$,\nand choose $c_i := i$. \nThen ${\\mathscr C} := {\\operatorname{Pol}}({\\mathbb C},c_0,\\dots,c_{n'-1})$ satisfies \nthe assumptions of Theorem~\\ref{thm:ua-result-restated}\nwith $n'$ instead of $n$, and the statement follows\ndirectly from Theorem~\\ref{thm:ua-result-restated}. \n\\end{proof}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nThe following clearly implies\nTheorem~\\ref{thm:main}\nfrom the introduction. \n\n\\begin{cor}\\label{cor:siggers-polymorphism}\n    The tractability conjecture for finite-domain CSPs is equivalent to \n    Conjecture~\\ref{conj:our-tractability}. \n\\end{cor}\n\\begin{proof}\n    Assume the tractability conjecture, \n    and let ${\\mathbb A}$ be a finite-siganture reduct of $({\\mathbb N};0,1,2,\\dots)$.\n    Since ${\\mathbb A}$ has finite signature, \n    it is a reduct of $({\\mathbb N},0,\\dots,n-1)$ for some $n \\in {\\mathbb N}$. \n    Let $c_1,\\dots,c_{n'-1}$ be as in the statement \n    of Corollary~\\ref{cor:Siggers-iff-no-homo}, and\n    let ${\\mathbb C}$ be the expansion of the \n    be the model-complete core of ${\\mathbb A}$ \n    by $c_1,\\dots,c_{n'-1}$. \n    \n    \n    \n    \n    Suppose that ${\\mathbb C}$ has a Siggers polymorphism modulo \n    endomorphisms of ${\\mathbb C}$ which is canonical with\n    respect to ${\\mathbb C}$. \n    Then ${T_{\\mB,m}}({\\mathbb C})$ has a Siggers polymorphism, by Lemma~\\ref{lem:polymorphisms-type-algebra}.\n    The tractability conjecture states that the CSP of ${T_{\\mB,m}}({\\mathbb C})$\n    is polynomial-time tractable.\n    It follows from Theorem~\\ref{thm:types-tractable-implies-structure-tractable} that ${\\operatorname{CSP}}({\\mathbb C})$\n    is tractable, too. \n    \n    Now suppose that ${\\mathbb C}$ does not have a \n    Siggers polymorphism modulo \n    endomorphisms of ${\\mathbb C}$ which is canonical with\n    respect to ${\\mathbb C}$. \n    Then Theorem~\\ref{thm:ua-result-restated}\n    states that there is a continuous h1 clone homomorphism from ${\\operatorname{Pol}}({\\mathbb C})$ to ${\\mathbf 2}$ which preserves left-composition with ${\\operatorname{End}}({\\mathbb C})$. \n    By Proposition~6.4 in~\\cite{wonderland}, a continuous map from the polymorphism clone of a countable $\\omega$-categorical structure to another function clone that preserves left-composition with invertibles is uniformly continuous. \n    By Proposition~6.1 and Corollary~4.7 in~\\cite{wonderland}, there exists a polynomial-time reduction\n    from, say, 3-SAT to ${\\operatorname{CSP}}({\\mathbb C})$. Therefore, ${\\operatorname{CSP}}({\\mathbb C})$ is NP-complete. \n\n    Conversely, we show that Conjecture~\\ref{conj:our-tractability} \n    implies the finite-domain tractability conjecture. \n    Let ${\\mathbb A}$ be a finite relational structure on $n+1$ elements (say $\\{a_0,\\dots,a_n\\}$), with relations $R^{\\mathbb A}_1,\\dots,R^{\\mathbb A}_k$.\n    Let $p\\colon{\\mathbb N}\\to A$ be such that for $i\\in\\{0,\\dots,n-1\\}$, $p(i) = a_i$ and for $i\\geq n$ we define $p(i)=a_n$.\n    Let ${\\mathbb A}'$ be the structure whose domain is ${\\mathbb N}$ and such that $R^{{\\mathbb A}'}_i$ is $p^{-1}(R^{\\mathbb A}_i)$.\n    It is clear that ${\\mathbb A}'$ is a first-order reduct of $({\\mathbb N};0,\\dots,n-1)$.\n    Moreover, ${\\mathbb A}$ and ${\\mathbb A}'$ are homomorphically equivalent. Indeed, $p$ is by construction a homomorphism from ${\\mathbb A}'$ to ${\\mathbb A}$,\n    and we can embed ${\\mathbb A}$ into ${\\mathbb A}'$ by sending $a_i$ to $i$.\n    Therefore the model-complete core of ${\\mathbb A}$ and of ${\\mathbb A}'$ coincide. \n    \n    If ${\\mathbb A}$ has a Siggers polymorphism, then \n    its core also has a Siggers polymorphism; this follows from the fact that the two structures are homomorphically equivalent.\n    Hence, \n    \n    the model-complete core of ${\\mathbb A}'$ has a Siggers polymorphism,\n    too. Now the hypothesis entails that ${\\operatorname{CSP}}({\\mathbb A}')$\n    and therefore ${\\operatorname{CSP}}({\\mathbb A})$ is in P. \n    \n    \n    \\end{proof}\n\nWe mention that\nusing the results from~\\cite{BPT-decidability-of-definability}, \nit can be shown that the tractability condition \n\n\n\nfrom Conjecture~\\ref{conj:our-tractability} is decidable, \nfor given first-order formulas that define the relations of ${\\mathbb A}$\nover $({\\mathbb N};0,1,\\dots)$. Finally, we believe that Conjecture~\\ref{conj:our-tractability} also holds for\nall CSPs expressible in the logic MMSNP introduced by Feder and Vardi~\\cite{FederVardi}. It is already known that this logic has a complexity dichotomy if and only if finite-domain CSPs have dichotomy, but the proof requires~\\cite{Kun} and it would be interesting to by-pass this.\n\n\n\\printbibliography\n\n\n\n", "itemtype": "equation", "pos": 76947, "prevtext": "\n\tIf $f({\\mathbf a})=m\\in\\{0,\\dots,n-1\\}$, then $f(\\sigma^i({\\mathbf a}))=m$ for every $i\\in\\{0,\\dots,k-1\\}$ since $f$ is cyclic in ${\\mathscr D}^{{\\mathrm{typ}}}_1$,\n\tand therefore\n\t$f'({\\mathbf a}) = m = f'(\\sigma {\\mathbf a})$.\n\tThis implies that $f'({\\mathbf b})=m$ and $f'(\\sigma{\\mathbf b})=m$ because $f'$ is cyclic in ${\\mathscr D}^{{\\mathrm{typ}}}_1$.\n\tOtherwise, $f({\\mathbf a})\\not\\in\\{0,\\dots,n-1\\}$ (and again, this holds for every cyclic permutation of the arguments).\n\tThen (\\ref{eq:cycl}) implies that \n\t$f(\\sigma^i{\\mathbf a}) = f(\\sigma^i{\\mathbf b})$ for all $i\\in\\{0,\\dots,k-1\\}$ by\n  injectivity of $g$ on ${\\mathbb N}\\setminus\\{0,\\dots,n-1\\}$.\n\tInjecting this back into (\\ref{eq:cycl}), we readily obtain $f'(\\sigma{\\mathbf a}) = f'(\\sigma{\\mathbf b})$.\n\t\n\tTo show that $\\xi^{\\mathrm{typ}}_2(f')$ is cyclic, \n\tlet $(a_1,b_1)$, $\\dots, (a_k,b_k)$ be pairs of integers.\n\tWe have to show that \n\t$(f'({\\mathbf a}), f'({\\mathbf b}))$ \n\tand $(f'(\\sigma{\\mathbf a}), f'(\\sigma{\\mathbf b}))$ are in the same orbit under $G_n$. \n\tSince $\\xi^{\\mathrm{typ}}_1(f')$ is cyclic,\n\twe already know that $f'({\\mathbf a})$ and $f'(\\sigma{\\mathbf a})$ are in the same orbit,\n    and that $f'({\\mathbf b})$ and $f'(\\sigma{\\mathbf b})$ are in the same orbit.\n\tBy the property $(\\dagger)$ we stated in the proof of Lemma~\\ref{lem:canonization},\n\twe only need to check that $f'({\\mathbf a})=f'({\\mathbf b})$ iff\n\t$f'(\\sigma{\\mathbf a}) = f'(\\sigma{\\mathbf b})$.\n\tIn the left-to-right direction, this is what we proved above.\n\tFor the other direction, note that we can apply $k-1$ times\n\tthe argument of the previous paragraph to obtain\n\tthat if $f'(\\sigma {\\mathbf a}) = f'(\\sigma{\\mathbf b})$, then\n\t$f'(\\sigma^k({\\mathbf a})) = f'(\\sigma^k({\\mathbf b}))$,\n\ti.e., $f'({\\mathbf a}) = f'({\\mathbf b})$.\n\\end{proof}\n\n\\begin{thm}\\label{thm:link-to-canonical-subclone}\n\tLet ${\\mathscr C}$ be a closed function clone over ${\\mathbb N}$ such that $G_n$\n\tis dense in ${\\mathscr C}^{(1)}$.\n\tLet ${\\mathscr D}$ be the subclone of ${\\mathscr C}$ \n\tthat contains the\n\tfunctions that are canonical\n\twith respect to $({\\mathbb N};0,\\dots,n-1)$.\n\tSuppose that ${\\mathscr D}$ admits a clone homomorphism to ${\\mathbf 2}$.\n\tThen ${\\mathscr C}$ admits a continuous h1 clone homomorphism to ${\\mathbf 2}$ which preserves\n    left-composition with operations from ${\\mathscr C}^{(1)}$.\n\\end{thm}\n\\begin{proof}\n\tSuppose first that there exists a continuous clone homomorphism from ${\\mathscr C}_{\\neq}$\n\tto ${\\mathbf 2}$.\n\tSince there exists a continuous clone homomorphism from ${\\mathscr C}$ to ${\\mathscr C}_{\\neq}$,\n\twe then obtain a continuous clone homomorphism from ${\\mathscr C}$ to ${\\mathbf 2}$.\n\tThis function is in particular a continuous h1 clone homomorphism.\n\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n\tOtherwise, ${\\mathscr C}_{\\neq}$ does not have a homomorphism to ${\\mathbf 2}$.\nSince  ${\\mathscr D}$ has a clone homomorphism to ${\\mathbf 2}$, \nso does ${\\mathscr D}^{{\\mathrm{typ}}}_2$, by Theorem~6.7 in~\\cite{BPP-projective-homomorphisms}.        \n\tHence, and by Theorem~\\ref{thm:finite}, \n${\\mathscr D}^{{\\mathrm{typ}}}_2$ does not have a cyclic operation. \n\tProposition~\\ref{prop:cyclic-one-type-two-types} then implies that \n\t${\\mathscr D}^{{\\mathrm{typ}}}_1$ does not have a cyclic operation. \n\tAgain by Theorem~\\ref{thm:finite},\n\tthere exists a clone homomorphism from ${\\mathscr D}^{{\\mathrm{typ}}}_1$ to ${\\mathbf 2}$.\n\n\n\tBy Corollary~\\ref{cor:mashup-homomorphism-version}, there exists a clone homomorphism\n\t$\\xi'\\colon{\\mathscr D}^{\\mathrm{typ}}_1\\to{\\mathbf 2}$ such that any two functions of ${\\mathscr D}^{\\mathrm{typ}}_1$ which have\n\tall their mashups in ${\\mathscr D}^{\\mathrm{typ}}_1$ are mapped to the same projection in ${\\mathbf 2}$.\n\tBy composition of $\\xi^{{\\mathrm{typ}}}_1$ with $\\xi'$, we obtain a continuous clone homomorphism\n\t$\\xi\\colon{\\mathscr D}\\to{\\mathbf 2}$.\n\tDefine the extension $\\phi$ of $\\xi$ to the whole clone ${\\mathscr C}$ by setting $\\phi(f) := \\xi(g)$, where $g$\n\tis any canonical function that is interpolated by $f$ modulo $G_n$.\n \n\n\t{\\bf $\\phi$ is well defined:} let $g,h$ be canonical and interpolated by $f$ modulo $G_n$.\n\tLet $\\ell\\in[k]$. By applying Proposition~\\ref{prop:building-mashups} with $f_i=f$ for all $i\\in{\\mathbb N}$,\n\twe obtain an operation $\\zeta_\\ell$\n\twhich is canonical and interpolated by $f$ modulo $G_n$\n\tand which is an $(\\ell,S)$-mashup of $g,h$ for every finite $S\\subset{\\mathbb N}$.\n\tThen $\\xi^{{\\mathrm{typ}}}_1(\\zeta_l) \\in {\\mathscr D}^{\\mathrm{typ}}_1$ is an $\\ell$-mashup of $\\xi^{\\mathrm{typ}}_1(g)$ and $\\xi^{\\mathrm{typ}}_1(h)$ by Proposition~\\ref{prop:M-implies-mashup}.\n    Since this holds for all $\\ell \\in [k]$ \n\twe therefore have $\\xi'(\\xi^{{\\mathrm{typ}}}_1(g))=\\xi'(\\xi^{{\\mathrm{typ}}}_1(h))$,\n\ti.e., $\\xi(g)=\\xi(h)$ and $\\phi$ is well defined.\n\t\n\n\t{\\bf $\\phi$ is continuous:} let $(f_i)_{i\\in{\\mathbb N}}$ be a sequence in ${\\mathscr C}$ converging to $f\\in{\\mathscr C}$.\n\tSince there are only finitely many behaviours of canonical functions of a given arity,\n\tthere exists an infinite set $I\\subseteq{\\mathbb N}$ and a canonical function $h\\in{\\mathscr D}$\n\tsuch that $f_i$ interpolates $h$ modulo $G_n$ for all $i\\in I$.\n\tLet $g$ be any canonical function that is interpolated by $f$\n\tmodulo $G_n$.\n\tBy Proposition~\\ref{prop:building-mashups} with $(f_i)_{i\\in I}\\to f$, \n\tthere exists in $\\overline{G_n\\{f_i\\mid i\\in\\omega\\}G_n}$ a canonical operation $\\zeta_\\ell$ which is an $(\\ell,S)$-mashup of $g,h$\n    for every finite $S\\subset{\\mathbb N}$.\n\tAs above, Proposition~\\ref{prop:M-implies-mashup} implies that for all $\\ell\\in[k]$ the function $\\xi^{\\mathrm{typ}}_1(\\zeta_l) \\in {\\mathscr D}^{\\mathrm{typ}}_1$ is an $\\ell$-mashup\n\tof $\\xi^{\\mathrm{typ}}_1(g)$ and $\\xi^{\\mathrm{typ}}_1(h)$ which implies that $\\xi(g)=\\xi(h)$.\n\tIn particular, this shows that $(\\phi(f_i))_{i\\in{\\mathbb N}}$ converges: indeed,\n\t\\emph{a priori} $h$ depends on the choice of $I\\subset{\\mathbb N}$ but we just proved that $\\xi(h)$\n\tis $\\xi(g)$, whatever $h$ we pick.\n\tSince $(\\phi(f_i))$ converges to $\\phi(f)$ we conclude that $\\phi$ is continuous.\n\n\n\t{\\bf $\\phi$ preserves left-composition with unary operations:} let $\\alpha$ be an invertible of ${\\mathscr C}$,\n\ti.e., $\\alpha$ is an element of $G_n$. Let $f\\in{\\mathscr C}$.\n\tLet $g$ be canonical and interpolated by $\\alpha\\circ f$ modulo $G_n$. Note that $g$ is also interpolated by $f$ modulo $G_n$, so that $\\phi(f) = \\xi(g) = \\phi(\\alpha\\circ f)$.\n\tSince the only unary operation in ${\\mathbf 2}$ is the identity operation, we finally have $\\phi(\\alpha)\\circ\\phi(f)=\\phi(f)$.\n    The continuity of $\\phi$ implies that it also preserves left-composition with elements which are in the topological closure\n    of the invertibles. These are all the unary operations of ${\\mathscr C}$, by assumption.\n\t\n\n\t{\\bf $\\phi$ is an h1 clone homomorphism:} we need to prove that $\\phi(f\\circ(\\pi_{i_1}^m,\\dots,\\pi_{i_k}^m)) = \\phi(f)\\circ(\\pi_{i_1}^m,\\dots,\\pi_{i_k}^m)$\n\tfor every $f\\in{\\mathscr C}$ of arity $k\\geq 1$ and every $m\\geq 1$.\n\tLet $g\\colon{\\mathbb N}^k\\to{\\mathbb N}$ be canonical and interpolated by $f$ modulo $G_n$.\n\tThen $g\\circ(\\pi_{i_1}^m,\\dots,\\pi_{i_k}^m)$\n\tis interpolated modulo $G_n$ by $f\\circ(\\pi_{i_1}^m,\\dots,\\pi_{i_k}^m)$.\n\tSo \n\t\n", "index": 41, "text": "\\begin{align}\n\t\\phi(f\\circ(\\pi_{i_1}^m,\\dots,\\pi_{i_k}^m)) & = \\xi(g\\circ(\\pi_{i_1}^m,\\dots,\\pi_{i_k}^m)) \\label{eq:link-canonical-1} \\\\\n\t& = \\xi(g)\\circ(\\pi_{i_1}^m,\\dots,\\pi_{i_k}^m) \\label{eq:link-canonical-2} \\\\\n\t& = \\phi(f)\\circ(\\pi_{i_1}^m,\\dots,\\pi_{i_k}^m) \\label{eq:link-canonical-3}\n\t\\end{align}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E5.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle\\phi(f\\circ(\\pi_{i_{1}}^{m},\\dots,\\pi_{i_{k}}^{m}))\" display=\"inline\"><mrow><mi>\u03d5</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mrow><mi>f</mi><mo>\u2218</mo><mrow><mo stretchy=\"false\">(</mo><msubsup><mi>\u03c0</mi><msub><mi>i</mi><mn>1</mn></msub><mi>m</mi></msubsup><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msubsup><mi>\u03c0</mi><msub><mi>i</mi><mi>k</mi></msub><mi>m</mi></msubsup><mo stretchy=\"false\">)</mo></mrow></mrow><mo stretchy=\"false\">)</mo></mrow></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E5.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle=\\xi(g\\circ(\\pi_{i_{1}}^{m},\\dots,\\pi_{i_{k}}^{m}))\" display=\"inline\"><mrow><mi/><mo>=</mo><mrow><mi>\u03be</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mrow><mi>g</mi><mo>\u2218</mo><mrow><mo stretchy=\"false\">(</mo><msubsup><mi>\u03c0</mi><msub><mi>i</mi><mn>1</mn></msub><mi>m</mi></msubsup><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msubsup><mi>\u03c0</mi><msub><mi>i</mi><mi>k</mi></msub><mi>m</mi></msubsup><mo stretchy=\"false\">)</mo></mrow></mrow><mo stretchy=\"false\">)</mo></mrow></mrow></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E6.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle=\\xi(g)\\circ(\\pi_{i_{1}}^{m},\\dots,\\pi_{i_{k}}^{m})\" display=\"inline\"><mrow><mi/><mo>=</mo><mrow><mrow><mi>\u03be</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>g</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2218</mo><mrow><mo stretchy=\"false\">(</mo><msubsup><mi>\u03c0</mi><msub><mi>i</mi><mn>1</mn></msub><mi>m</mi></msubsup><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msubsup><mi>\u03c0</mi><msub><mi>i</mi><mi>k</mi></msub><mi>m</mi></msubsup><mo stretchy=\"false\">)</mo></mrow></mrow></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E7.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle=\\phi(f)\\circ(\\pi_{i_{1}}^{m},\\dots,\\pi_{i_{k}}^{m})\" display=\"inline\"><mrow><mi/><mo>=</mo><mrow><mrow><mi>\u03d5</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>f</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2218</mo><mrow><mo stretchy=\"false\">(</mo><msubsup><mi>\u03c0</mi><msub><mi>i</mi><mn>1</mn></msub><mi>m</mi></msubsup><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msubsup><mi>\u03c0</mi><msub><mi>i</mi><mi>k</mi></msub><mi>m</mi></msubsup><mo stretchy=\"false\">)</mo></mrow></mrow></mrow></math>", "type": "latex"}]