[{"file": "1601.05831.tex", "nexttext": "\nwhere the vector with entries $\\beta_j$ corresponds to a row of the corresponding transformation matrix.\nIf the device is balanced, we have $|\\beta_j|^2=\\frac1D$. A possible physical model for this device can be a cascaded sequence of $D-1$ conventional beamsplitters, with reflectivities $\\frac{1}{D}$, $\\frac{1}{D-1}$ \\dots $\\frac{1}{2}$, but other possibilities exist, including on-chip solutions. We note that all-optical solutions are just one area of applicability of our results, which can be applied to any multiplexer with a final set of detectors, which can be even as large as the set of pixels in an EMCCD or an ICCD. Configurations of the multiplexing part with closed paths are to be avoided, because the bosonic nature of photons would make them bunch and bypass the loops. For the same reason, we are not required to take phases into account. The multiplexer finally couples to a set of on/off single photon detectors. We wish to calculate the probability of observing $C$ clicks, given an initial photon number state of $N$ photons and given that all $D$ detectors have a quantum efficiency $\\eta$ and a dark count probability $\\varepsilon$. We start from the ideal case $\\eta=1,\\ \\varepsilon=0$ and then move on to the general case $0\\leq\\eta\\leq1,\\ 0\\leq\\varepsilon\\leq1$ and from the general case we retrieve a simple Corollary that holds for $0\\leq\\eta\\leq1,\\ \\varepsilon\\ll N/D$. \n\n\n\\subsection{Ideal detectors}\nThe fundamental ingredient for our analysis is the probability of distributing $N$ photons into exactly $C$ out of $D$ detectors. We start by numbering the detectors from 1 to $D$, then a certain string of numbers will describe an event, where the detectors numbered in the string are the ones that clicked. Note that in absence of noise the number of events cannot exceed the number of input photons, i.e. $C\\leq N$. \n\n\\begin{lemma*}\n\\label{lemma}\nThe probability of observing $C$ clicks by distributing a Fock state of $N$ photons evenly amongst $D$ ideal (i.e. noiseless and with 100\\% quantum efficiency) on/off detectors is given by \n", "itemtype": "equation", "pos": 3046, "prevtext": "\n\n\\title{Theory of multiplexed photon number discrimination}\n\n\\author{Filippo.~M.~Miatto$^{1}$, Akbar Safari$^{1}$, Robert W.~Boyd$^{1,2}$}\n\\affiliation{$^1$Dept.~of Physics, University of Ottawa, 150 Louis Pasteur, Ottawa, Ontario, K1N 6N5 Canada}\n\\affiliation{$^2$Institute of Optics, University of Rochester, Rochester, USA}\n\\date{\\today}\n\n\n\\begin{abstract}\nAlthough some non-trivial photon number resolving detectors exist, it may still be convenient to discriminate photon number states with the method of multiplexed detection. Multiplexing can be performed with paths in real space, with paths in time, and in principle with any degree of freedom that has a sufficient number of eigenstates and that can be coupled to the photon number. Previous works have addressed the probabilities involved in these measurements with Monte Carlo simulations, or by restricting the number of detectors to powers of 2, or without including quantum efficiency or noise.\nIn this work we find an analytical expression of the detection probabilities for any number of input photons and any number of on/off photon detectors with a quantum efficiency $0\\%\\leq\\eta\\leq100\\%$ and a false count probability $\\varepsilon\\geq0$. This allows us to retrodict the number of photons that we had at the input in the least unbiased way possible. We conclude our work with some examples.\n\\end{abstract}\n\\maketitle\n\n\\section{Introduction}\nFor practical applications of quantum optics it would be a great advantage to have a detector that can discriminate between different photon number states \\cite{silberhorn2007detecting}. There are currently several different solutions that allow one to achieve this to some extent \\cite{miller2003demonstration, fujiwara2005multiphoton, gansen2007photon, kardynal2007photon, divochiy2008superconducting, namekata2010non}, but the resources that such detectors require (such as very low temperatures, costly materials and/or optical configurations) make them rather costly to obtain and operate. There are workarounds that involve squeezing more information out of the conventional detectors \\cite{kim1999multiphoton,kardynal2008avalanche}, or by multiplexing the photons towards multiple single-photon detectors \\cite{achilles2003fiber, fitch2003photon, achilles2004photon, jiang2007photon, lantz2008multi,avenhaus2010accessing,thomas2012practical}.\n\nThe most common single-photon detectors are only able to tell us whether they detected ``zero photons'' or ``more than zero photons''. Furthermore they are subject to noise and a sub-optimal efficiency, which means that sometimes they click when they shouldn't have clicked or that they fail to click when they should have clicked \\cite{hadfield2009single}.\n\nIn this work we explore photon-number discrimination by multiplexing, our novel contribution is to take into account quantum efficiency and noise, as well as any number of detectors.\n\n\\section{Discrimination probability} \nConsider a linear device that converts $D$ inputs into $D$ outputs. A single-mode input then becomes\n\n", "index": 1, "text": "\\begin{align}\n\\hat a_\\mathrm{in}^\\dagger\\rightarrow\\sum_{j=1}^D\\beta_j \\hat b_j^\\dagger,\n\\end{align}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E1.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle\\hat{a}_{\\mathrm{in}}^{\\dagger}\\rightarrow\\sum_{j=1}^{D}\\beta_{j}%&#10;\\hat{b}_{j}^{\\dagger},\" display=\"inline\"><mrow><mrow><msubsup><mover accent=\"true\"><mi>a</mi><mo stretchy=\"false\">^</mo></mover><mi>in</mi><mo>\u2020</mo></msubsup><mo>\u2192</mo><mrow><mstyle displaystyle=\"true\"><munderover><mo largeop=\"true\" movablelimits=\"false\" symmetric=\"true\">\u2211</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>D</mi></munderover></mstyle><mrow><msub><mi>\u03b2</mi><mi>j</mi></msub><mo>\u2062</mo><msubsup><mover accent=\"true\"><mi>b</mi><mo stretchy=\"false\">^</mo></mover><mi>j</mi><mo>\u2020</mo></msubsup></mrow></mrow></mrow><mo>,</mo></mrow></math>", "type": "latex"}, {"file": "1601.05831.tex", "nexttext": " where $\\mathcal{S}$ is the Stirling number of second kind.\n\\end{lemma*}\n\n\\begin{proof}\nOur goal is to compute the number of detection strings (i.e. the strings of numbers describing a detection event) that include exactly $C$ out of $D$ detectors.\n\nCall $S_i$ the set of strings corresponding to $N$ input photons that do not include the $i$-th detector. Then select a specific subset $\\mathcal K$ of cardinality $|\\mathcal K|=k$ from the $D$ detectors. The set of strings that do not include any of the detectors in $\\mathcal K$ is the intersection of the sets excluding each of the elements of $\\mathcal K$: $\\bigcap_{i\\in \\mathcal K}S_i$ and its cardinality is \n\n", "itemtype": "equation", "pos": -1, "prevtext": "\nwhere the vector with entries $\\beta_j$ corresponds to a row of the corresponding transformation matrix.\nIf the device is balanced, we have $|\\beta_j|^2=\\frac1D$. A possible physical model for this device can be a cascaded sequence of $D-1$ conventional beamsplitters, with reflectivities $\\frac{1}{D}$, $\\frac{1}{D-1}$ \\dots $\\frac{1}{2}$, but other possibilities exist, including on-chip solutions. We note that all-optical solutions are just one area of applicability of our results, which can be applied to any multiplexer with a final set of detectors, which can be even as large as the set of pixels in an EMCCD or an ICCD. Configurations of the multiplexing part with closed paths are to be avoided, because the bosonic nature of photons would make them bunch and bypass the loops. For the same reason, we are not required to take phases into account. The multiplexer finally couples to a set of on/off single photon detectors. We wish to calculate the probability of observing $C$ clicks, given an initial photon number state of $N$ photons and given that all $D$ detectors have a quantum efficiency $\\eta$ and a dark count probability $\\varepsilon$. We start from the ideal case $\\eta=1,\\ \\varepsilon=0$ and then move on to the general case $0\\leq\\eta\\leq1,\\ 0\\leq\\varepsilon\\leq1$ and from the general case we retrieve a simple Corollary that holds for $0\\leq\\eta\\leq1,\\ \\varepsilon\\ll N/D$. \n\n\n\\subsection{Ideal detectors}\nThe fundamental ingredient for our analysis is the probability of distributing $N$ photons into exactly $C$ out of $D$ detectors. We start by numbering the detectors from 1 to $D$, then a certain string of numbers will describe an event, where the detectors numbered in the string are the ones that clicked. Note that in absence of noise the number of events cannot exceed the number of input photons, i.e. $C\\leq N$. \n\n\\begin{lemma*}\n\\label{lemma}\nThe probability of observing $C$ clicks by distributing a Fock state of $N$ photons evenly amongst $D$ ideal (i.e. noiseless and with 100\\% quantum efficiency) on/off detectors is given by \n", "index": 3, "text": "$$P_D(C|N)={D\\choose C}\\frac{C!}{D^N}\\mathcal{S}_N^C,$$\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex1.m1\" class=\"ltx_Math\" alttext=\"P_{D}(C|N)={D\\choose C}\\frac{C!}{D^{N}}\\mathcal{S}_{N}^{C},\" display=\"block\"><mrow><msub><mi>P</mi><mi>D</mi></msub><mrow><mo stretchy=\"false\">(</mo><mi>C</mi><mo stretchy=\"false\">|</mo><mi>N</mi><mo stretchy=\"false\">)</mo></mrow><mo>=</mo><mrow><mo>(</mo><mfrac linethickness=\"0pt\"><mi>D</mi><mi>C</mi></mfrac><mo>)</mo></mrow><mfrac><mrow><mi>C</mi><mo lspace=\"0pt\" rspace=\"3.5pt\">!</mo></mrow><msup><mi>D</mi><mi>N</mi></msup></mfrac><msubsup><mi class=\"ltx_font_mathcaligraphic\">\ud835\udcae</mi><mi>N</mi><mi>C</mi></msubsup><mo>,</mo></mrow></math>", "type": "latex"}, {"file": "1601.05831.tex", "nexttext": "\nas we have $N$ choices with repetition, from $(D-k)$ possible detectors. Of course, we are also counting strings that exclude \\emph{any other} detector, in addition to the ones in  $\\mathcal K$. To get around this problem, we use the inclusion-exclusion rule to count the elements in unions of sets $S_i$. In particular, we need the union of $S_i$ for $i\\in\\{1,\\dots,D\\}$, i.e. the set of all strings that exclude \\emph{at least} 1 detector, whose cardinality is\n\n", "itemtype": "equation", "pos": 5940, "prevtext": " where $\\mathcal{S}$ is the Stirling number of second kind.\n\\end{lemma*}\n\n\\begin{proof}\nOur goal is to compute the number of detection strings (i.e. the strings of numbers describing a detection event) that include exactly $C$ out of $D$ detectors.\n\nCall $S_i$ the set of strings corresponding to $N$ input photons that do not include the $i$-th detector. Then select a specific subset $\\mathcal K$ of cardinality $|\\mathcal K|=k$ from the $D$ detectors. The set of strings that do not include any of the detectors in $\\mathcal K$ is the intersection of the sets excluding each of the elements of $\\mathcal K$: $\\bigcap_{i\\in \\mathcal K}S_i$ and its cardinality is \n\n", "index": 5, "text": "\\begin{align}\n\\left|\\bigcap_{i\\in \\mathcal K}S_i\\right|=(D-k)^N\n\\end{align}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E2.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle\\left|\\bigcap_{i\\in\\mathcal{K}}S_{i}\\right|=(D-k)^{N}\" display=\"inline\"><mrow><mrow><mo>|</mo><mrow><mstyle displaystyle=\"true\"><munder><mo largeop=\"true\" mathsize=\"160%\" movablelimits=\"false\" stretchy=\"false\" symmetric=\"true\">\u22c2</mo><mrow><mi>i</mi><mo>\u2208</mo><mi class=\"ltx_font_mathcaligraphic\">\ud835\udca6</mi></mrow></munder></mstyle><msub><mi>S</mi><mi>i</mi></msub></mrow><mo>|</mo></mrow><mo>=</mo><msup><mrow><mo stretchy=\"false\">(</mo><mrow><mi>D</mi><mo>-</mo><mi>k</mi></mrow><mo stretchy=\"false\">)</mo></mrow><mi>N</mi></msup></mrow></math>", "type": "latex"}, {"file": "1601.05831.tex", "nexttext": "\nThe complement of this set is the set of strings that include all $D$ detectors (if they missed any they would fall in $\\bigcup_{i=1}^D S_i$), so by De Morgan's law we have\n\n", "itemtype": "equation", "pos": 6479, "prevtext": "\nas we have $N$ choices with repetition, from $(D-k)$ possible detectors. Of course, we are also counting strings that exclude \\emph{any other} detector, in addition to the ones in  $\\mathcal K$. To get around this problem, we use the inclusion-exclusion rule to count the elements in unions of sets $S_i$. In particular, we need the union of $S_i$ for $i\\in\\{1,\\dots,D\\}$, i.e. the set of all strings that exclude \\emph{at least} 1 detector, whose cardinality is\n\n", "index": 7, "text": "\\begin{align}\n\\left|\\bigcup_{i=1}^D S_i\\right|=\\sum_{j=1}^D(-1)^{j+1}{D\\choose j}(D-j)^N\n\\end{align}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E3.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle\\left|\\bigcup_{i=1}^{D}S_{i}\\right|=\\sum_{j=1}^{D}(-1)^{j+1}{D%&#10;\\choose j}(D-j)^{N}\" display=\"inline\"><mrow><mrow><mo>|</mo><mrow><mstyle displaystyle=\"true\"><munderover><mo largeop=\"true\" mathsize=\"160%\" movablelimits=\"false\" stretchy=\"false\" symmetric=\"true\">\u22c3</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>D</mi></munderover></mstyle><msub><mi>S</mi><mi>i</mi></msub></mrow><mo>|</mo></mrow><mo>=</mo><mrow><mstyle displaystyle=\"true\"><munderover><mo largeop=\"true\" movablelimits=\"false\" symmetric=\"true\">\u2211</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>D</mi></munderover></mstyle><mrow><msup><mrow><mo stretchy=\"false\">(</mo><mrow><mo>-</mo><mn>1</mn></mrow><mo stretchy=\"false\">)</mo></mrow><mrow><mi>j</mi><mo>+</mo><mn>1</mn></mrow></msup><mo>\u2062</mo><mrow><mo>(</mo><mstyle displaystyle=\"true\"><mfrac linethickness=\"0pt\"><mi>D</mi><mi>j</mi></mfrac></mstyle><mo>)</mo></mrow><mo>\u2062</mo><msup><mrow><mo stretchy=\"false\">(</mo><mrow><mi>D</mi><mo>-</mo><mi>j</mi></mrow><mo stretchy=\"false\">)</mo></mrow><mi>N</mi></msup></mrow></mrow></mrow></math>", "type": "latex"}, {"file": "1601.05831.tex", "nexttext": "\nFinally, we can compute the number of strings that include precisely $C$ out of $D$ detectors: pick $D-C$ detectors to be excluded (there are $D\\choose C$ ways of doing this) and compute the number of strings that include all of the remaining $C$ detectors:\n\n", "itemtype": "equation", "pos": 6753, "prevtext": "\nThe complement of this set is the set of strings that include all $D$ detectors (if they missed any they would fall in $\\bigcup_{i=1}^D S_i$), so by De Morgan's law we have\n\n", "index": 9, "text": "\\begin{align}\n\\left|\\overline{\\bigcup_{i=1}^D S_i}\\right|=\\left|\\bigcap_{i=1}^D\\overline{S_i}\\right|=\\sum_{j=0}^D(-1)^{j}{D\\choose j}(D-j)^N\n\\end{align}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E4.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle\\left|\\overline{\\bigcup_{i=1}^{D}S_{i}}\\right|=\\left|\\bigcap_{i=1%&#10;}^{D}\\overline{S_{i}}\\right|=\\sum_{j=0}^{D}(-1)^{j}{D\\choose j}(D-j)^{N}\" display=\"inline\"><mrow><mrow><mo>|</mo><mover accent=\"true\"><mrow><mstyle displaystyle=\"true\"><munderover><mo largeop=\"true\" mathsize=\"160%\" movablelimits=\"false\" stretchy=\"false\" symmetric=\"true\">\u22c3</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>D</mi></munderover></mstyle><msub><mi>S</mi><mi>i</mi></msub></mrow><mo>\u00af</mo></mover><mo>|</mo></mrow><mo>=</mo><mrow><mo>|</mo><mrow><mstyle displaystyle=\"true\"><munderover><mo largeop=\"true\" mathsize=\"160%\" movablelimits=\"false\" stretchy=\"false\" symmetric=\"true\">\u22c2</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>D</mi></munderover></mstyle><mover accent=\"true\"><msub><mi>S</mi><mi>i</mi></msub><mo>\u00af</mo></mover></mrow><mo>|</mo></mrow><mo>=</mo><mrow><mstyle displaystyle=\"true\"><munderover><mo largeop=\"true\" movablelimits=\"false\" symmetric=\"true\">\u2211</mo><mrow><mi>j</mi><mo>=</mo><mn>0</mn></mrow><mi>D</mi></munderover></mstyle><mrow><msup><mrow><mo stretchy=\"false\">(</mo><mrow><mo>-</mo><mn>1</mn></mrow><mo stretchy=\"false\">)</mo></mrow><mi>j</mi></msup><mo>\u2062</mo><mrow><mo>(</mo><mstyle displaystyle=\"true\"><mfrac linethickness=\"0pt\"><mi>D</mi><mi>j</mi></mfrac></mstyle><mo>)</mo></mrow><mo>\u2062</mo><msup><mrow><mo stretchy=\"false\">(</mo><mrow><mi>D</mi><mo>-</mo><mi>j</mi></mrow><mo stretchy=\"false\">)</mo></mrow><mi>N</mi></msup></mrow></mrow></mrow></math>", "type": "latex"}, {"file": "1601.05831.tex", "nexttext": "\nwhere $\\mathcal{S}_N^C$ is the Stirling number of the second kind.\nSo the probability of ending up with exactly $C$ clicks is the result above divided by the total number of possible strings $D^N$:\n\n", "itemtype": "equation", "pos": 7164, "prevtext": "\nFinally, we can compute the number of strings that include precisely $C$ out of $D$ detectors: pick $D-C$ detectors to be excluded (there are $D\\choose C$ ways of doing this) and compute the number of strings that include all of the remaining $C$ detectors:\n\n", "index": 11, "text": "\\begin{align}\n{D\\choose C}\\left|\\bigcap_{i=1}^C\\overline{S_i}\\right|&={D\\choose C}\\sum_{j=0}^{C}(-1)^{j}{C\\choose j}(C-j)^N\\\\\n&={D\\choose C}C!\\,\\mathcal{S}_N^C,\n\\end{align}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E5.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle{D\\choose C}\\left|\\bigcap_{i=1}^{C}\\overline{S_{i}}\\right|\" display=\"inline\"><mrow><mrow><mo>(</mo><mstyle displaystyle=\"true\"><mfrac linethickness=\"0pt\"><mi>D</mi><mi>C</mi></mfrac></mstyle><mo>)</mo></mrow><mo>\u2062</mo><mrow><mo>|</mo><mrow><mstyle displaystyle=\"true\"><munderover><mo largeop=\"true\" mathsize=\"160%\" movablelimits=\"false\" stretchy=\"false\" symmetric=\"true\">\u22c2</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>C</mi></munderover></mstyle><mover accent=\"true\"><msub><mi>S</mi><mi>i</mi></msub><mo>\u00af</mo></mover></mrow><mo>|</mo></mrow></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E5.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle={D\\choose C}\\sum_{j=0}^{C}(-1)^{j}{C\\choose j}(C-j)^{N}\" display=\"inline\"><mrow><mi/><mo>=</mo><mrow><mrow><mo>(</mo><mstyle displaystyle=\"true\"><mfrac linethickness=\"0pt\"><mi>D</mi><mi>C</mi></mfrac></mstyle><mo>)</mo></mrow><mo>\u2062</mo><mrow><mstyle displaystyle=\"true\"><munderover><mo largeop=\"true\" movablelimits=\"false\" symmetric=\"true\">\u2211</mo><mrow><mi>j</mi><mo>=</mo><mn>0</mn></mrow><mi>C</mi></munderover></mstyle><mrow><msup><mrow><mo stretchy=\"false\">(</mo><mrow><mo>-</mo><mn>1</mn></mrow><mo stretchy=\"false\">)</mo></mrow><mi>j</mi></msup><mo>\u2062</mo><mrow><mo>(</mo><mstyle displaystyle=\"true\"><mfrac linethickness=\"0pt\"><mi>C</mi><mi>j</mi></mfrac></mstyle><mo>)</mo></mrow><mo>\u2062</mo><msup><mrow><mo stretchy=\"false\">(</mo><mrow><mi>C</mi><mo>-</mo><mi>j</mi></mrow><mo stretchy=\"false\">)</mo></mrow><mi>N</mi></msup></mrow></mrow></mrow></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E6.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle={D\\choose C}C!\\,\\mathcal{S}_{N}^{C},\" display=\"inline\"><mrow><mrow><mi/><mo>=</mo><mrow><mrow><mo>(</mo><mstyle displaystyle=\"true\"><mfrac linethickness=\"0pt\"><mi>D</mi><mi>C</mi></mfrac></mstyle><mo>)</mo></mrow><mo>\u2062</mo><mrow><mi>C</mi><mo lspace=\"0pt\" rspace=\"3.5pt\">!</mo></mrow><mo>\u2062</mo><msubsup><mi class=\"ltx_font_mathcaligraphic\">\ud835\udcae</mi><mi>N</mi><mi>C</mi></msubsup></mrow></mrow><mo>,</mo></mrow></math>", "type": "latex"}, {"file": "1601.05831.tex", "nexttext": "\nand our proof is complete.\n\\end{proof}\n\n\\subsection{Nonideal detectors}\nNonideal detectors are subject to mainly two effects: sub-unity quantum efficiency and noise, which can come from various sources. We model these as Bernoulli trials, where for each detector we have a probability $\\eta$ of missing the photon and a probability $\\varepsilon$ of a false count within the measurement window, in which case we learn that the detector clicked regardless of a photon hitting it or not (we don't worry about the source of noise, be it a dark count where the detector really fires albeit for no reason, or just electronic noise where we are informed of a click without it necessarily happening). Whether a detector detects an actual photon or gives a false count, we consider it out of order until the electronics have enough time to reset (e.g. about 40 ns for avalanche photodiodes). In this section we take both of these effects into account.\n\\begin{widetext}\n\\begin{theorem*}\nThe probability of observing $C$ clicks by distributing a Fock state of $N$ photons evenly amongst $D$ on/off detectors with quantum efficiency $\\eta$ and false count probability $\\varepsilon$ is given by \n", "itemtype": "equation", "pos": 7535, "prevtext": "\nwhere $\\mathcal{S}_N^C$ is the Stirling number of the second kind.\nSo the probability of ending up with exactly $C$ clicks is the result above divided by the total number of possible strings $D^N$:\n\n", "index": 13, "text": "\\begin{align}\nP_D(C|N)&={D\\choose C}\\frac{C!}{D^N}\\mathcal{S}_N^C\n\\label{stirling}\n\\end{align}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E7.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle P_{D}(C|N)\" display=\"inline\"><mrow><msub><mi>P</mi><mi>D</mi></msub><mrow><mo stretchy=\"false\">(</mo><mi>C</mi><mo stretchy=\"false\">|</mo><mi>N</mi><mo stretchy=\"false\">)</mo></mrow></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E7.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle={D\\choose C}\\frac{C!}{D^{N}}\\mathcal{S}_{N}^{C}\" display=\"inline\"><mrow><mi/><mo>=</mo><mrow><mrow><mo>(</mo><mstyle displaystyle=\"true\"><mfrac linethickness=\"0pt\"><mi>D</mi><mi>C</mi></mfrac></mstyle><mo>)</mo></mrow><mo>\u2062</mo><mstyle displaystyle=\"true\"><mfrac><mrow><mi>C</mi><mo lspace=\"0pt\" rspace=\"3.5pt\">!</mo></mrow><msup><mi>D</mi><mi>N</mi></msup></mfrac></mstyle><mo>\u2062</mo><msubsup><mi class=\"ltx_font_mathcaligraphic\">\ud835\udcae</mi><mi>N</mi><mi>C</mi></msubsup></mrow></mrow></math>", "type": "latex"}, {"file": "1601.05831.tex", "nexttext": "\nwhere $p_\\xi(m|n)={n\\choose m}\\xi^m(1-\\xi)^{n-m}$ is the probability of having $m$ successes out of $n$ trials when the success probability of a single trial is $\\xi$.\n\\end{theorem*}\n\\end{widetext}\n\n\\begin{proof}\nThe proof comprises of 3 steps, each of which is of a similar nature: we consider in which ways an event can happen and we sum the relative probabilities. In the first step we split the observed number of clicks into spurious and real clicks. In the second step we split the initial photons into those that landed onto inactive detectors (the noisy ones) and those that landed onto active ones. In the third step we split the photons that landed onto active detectors into those that made it past the quantum efficiency and those that didn't. Finally, we use the ideal detection Lemma.\n\n\\emph{Step 1} We sum over the probability of obtaining $C$ total clicks by having $i$ of them come from noise and $C-i$ come from actual detections. We write the probability of $i$ false events given $D$ detectors as $p_\\varepsilon(i|D)={D\\choose i}\\varepsilon^i(1-\\varepsilon)^{D-i}$.\n\n\\emph{Step 2} Now $C-i$ clicks must come from real detection events from the remaining $D-i$ active detectors.\nThe probability that $j$ out of $N$ photons make to the $D-i$ active detectors is $p_{\\frac{D-i}{D}}(j|N)$.\n\n\\emph{Step 3} As our detectors have a quantum efficiency $\\eta\\leq1$, the probability of remaining with $k$ out of $j$ photons is given by $p_\\eta(k|j)$.\n\nNow we can now apply the Lemma to write the probability of detecting $C-i$ out of $k$ survivor photons with $D-i$ detectors and combine these steps in the final result.\n\\end{proof}\n\nThere is a simple corollary of this theorem, which describes the case $\\varepsilon=0$. Such corollary can be used even for noisy detectors as long as $D\\varepsilon\\ll N$:\n\\begin{corollary*}\nThe probability of observing $C$ clicks by distributing a Fock state of $N$ photons evenly amongst $D$ noiseless on/off detectors with quantum efficiency $\\eta$ is given by \n", "itemtype": "equation", "pos": 8812, "prevtext": "\nand our proof is complete.\n\\end{proof}\n\n\\subsection{Nonideal detectors}\nNonideal detectors are subject to mainly two effects: sub-unity quantum efficiency and noise, which can come from various sources. We model these as Bernoulli trials, where for each detector we have a probability $\\eta$ of missing the photon and a probability $\\varepsilon$ of a false count within the measurement window, in which case we learn that the detector clicked regardless of a photon hitting it or not (we don't worry about the source of noise, be it a dark count where the detector really fires albeit for no reason, or just electronic noise where we are informed of a click without it necessarily happening). Whether a detector detects an actual photon or gives a false count, we consider it out of order until the electronics have enough time to reset (e.g. about 40 ns for avalanche photodiodes). In this section we take both of these effects into account.\n\\begin{widetext}\n\\begin{theorem*}\nThe probability of observing $C$ clicks by distributing a Fock state of $N$ photons evenly amongst $D$ on/off detectors with quantum efficiency $\\eta$ and false count probability $\\varepsilon$ is given by \n", "index": 15, "text": "$$P_{D,\\eta,\\varepsilon}(C|N)=\\sum_{i=0}^C  p_\\varepsilon(i|D)\\sum_{j=C-i}^N  p_{\\frac{D-i}{D}}(j|N)\\sum_{k=C-i}^j p_\\eta(k|j)P_{D-i}(C-i|k),$$\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex2.m1\" class=\"ltx_Math\" alttext=\"P_{D,\\eta,\\varepsilon}(C|N)=\\sum_{i=0}^{C}p_{\\varepsilon}(i|D)\\sum_{j=C-i}^{N}%&#10;p_{\\frac{D-i}{D}}(j|N)\\sum_{k=C-i}^{j}p_{\\eta}(k|j)P_{D-i}(C-i|k),\" display=\"block\"><mrow><msub><mi>P</mi><mrow><mi>D</mi><mo>,</mo><mi>\u03b7</mi><mo>,</mo><mi>\u03b5</mi></mrow></msub><mrow><mo stretchy=\"false\">(</mo><mi>C</mi><mo stretchy=\"false\">|</mo><mi>N</mi><mo stretchy=\"false\">)</mo></mrow><mo>=</mo><munderover><mo largeop=\"true\" movablelimits=\"false\" symmetric=\"true\">\u2211</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>C</mi></munderover><msub><mi>p</mi><mi>\u03b5</mi></msub><mrow><mo stretchy=\"false\">(</mo><mi>i</mi><mo stretchy=\"false\">|</mo><mi>D</mi><mo stretchy=\"false\">)</mo></mrow><munderover><mo largeop=\"true\" movablelimits=\"false\" symmetric=\"true\">\u2211</mo><mrow><mi>j</mi><mo>=</mo><mrow><mi>C</mi><mo>-</mo><mi>i</mi></mrow></mrow><mi>N</mi></munderover><msub><mi>p</mi><mfrac><mrow><mi>D</mi><mo>-</mo><mi>i</mi></mrow><mi>D</mi></mfrac></msub><mrow><mo stretchy=\"false\">(</mo><mi>j</mi><mo stretchy=\"false\">|</mo><mi>N</mi><mo stretchy=\"false\">)</mo></mrow><munderover><mo largeop=\"true\" movablelimits=\"false\" symmetric=\"true\">\u2211</mo><mrow><mi>k</mi><mo>=</mo><mrow><mi>C</mi><mo>-</mo><mi>i</mi></mrow></mrow><mi>j</mi></munderover><msub><mi>p</mi><mi>\u03b7</mi></msub><mrow><mo stretchy=\"false\">(</mo><mi>k</mi><mo stretchy=\"false\">|</mo><mi>j</mi><mo stretchy=\"false\">)</mo></mrow><msub><mi>P</mi><mrow><mi>D</mi><mo>-</mo><mi>i</mi></mrow></msub><mrow><mo stretchy=\"false\">(</mo><mi>C</mi><mo>-</mo><mi>i</mi><mo stretchy=\"false\">|</mo><mi>k</mi><mo stretchy=\"false\">)</mo></mrow><mo>,</mo></mrow></math>", "type": "latex"}, {"file": "1601.05831.tex", "nexttext": "\n\\end{corollary*}\n\\begin{proof}\nWe use the identity $p_0(m|n)=\\delta_{m,0}$ to replace every occurrence of $i$ in the noisy detection Theorem by 0, and the identity $p_1(m|n)=\\delta_{m,n}$ to replace every occurrence of $j$ by $N$. This gets rid of the first two summations and the result follows.\n\\end{proof}\n\n\\section{retrodicting the photon number}\nTo retrodict the photon number \\emph{given} an observed number of clicks, we have to invert the probability in the main theorem using Bayes' rule:\n\n", "itemtype": "equation", "pos": 10963, "prevtext": "\nwhere $p_\\xi(m|n)={n\\choose m}\\xi^m(1-\\xi)^{n-m}$ is the probability of having $m$ successes out of $n$ trials when the success probability of a single trial is $\\xi$.\n\\end{theorem*}\n\\end{widetext}\n\n\\begin{proof}\nThe proof comprises of 3 steps, each of which is of a similar nature: we consider in which ways an event can happen and we sum the relative probabilities. In the first step we split the observed number of clicks into spurious and real clicks. In the second step we split the initial photons into those that landed onto inactive detectors (the noisy ones) and those that landed onto active ones. In the third step we split the photons that landed onto active detectors into those that made it past the quantum efficiency and those that didn't. Finally, we use the ideal detection Lemma.\n\n\\emph{Step 1} We sum over the probability of obtaining $C$ total clicks by having $i$ of them come from noise and $C-i$ come from actual detections. We write the probability of $i$ false events given $D$ detectors as $p_\\varepsilon(i|D)={D\\choose i}\\varepsilon^i(1-\\varepsilon)^{D-i}$.\n\n\\emph{Step 2} Now $C-i$ clicks must come from real detection events from the remaining $D-i$ active detectors.\nThe probability that $j$ out of $N$ photons make to the $D-i$ active detectors is $p_{\\frac{D-i}{D}}(j|N)$.\n\n\\emph{Step 3} As our detectors have a quantum efficiency $\\eta\\leq1$, the probability of remaining with $k$ out of $j$ photons is given by $p_\\eta(k|j)$.\n\nNow we can now apply the Lemma to write the probability of detecting $C-i$ out of $k$ survivor photons with $D-i$ detectors and combine these steps in the final result.\n\\end{proof}\n\nThere is a simple corollary of this theorem, which describes the case $\\varepsilon=0$. Such corollary can be used even for noisy detectors as long as $D\\varepsilon\\ll N$:\n\\begin{corollary*}\nThe probability of observing $C$ clicks by distributing a Fock state of $N$ photons evenly amongst $D$ noiseless on/off detectors with quantum efficiency $\\eta$ is given by \n", "index": 17, "text": "$$P_{D,\\eta}(C|N)=\\sum_{k=C}^N p_\\eta(k|N)P_{D}(C|k).$$\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex3.m1\" class=\"ltx_Math\" alttext=\"P_{D,\\eta}(C|N)=\\sum_{k=C}^{N}p_{\\eta}(k|N)P_{D}(C|k).\" display=\"block\"><mrow><msub><mi>P</mi><mrow><mi>D</mi><mo>,</mo><mi>\u03b7</mi></mrow></msub><mrow><mo stretchy=\"false\">(</mo><mi>C</mi><mo stretchy=\"false\">|</mo><mi>N</mi><mo stretchy=\"false\">)</mo></mrow><mo>=</mo><munderover><mo largeop=\"true\" movablelimits=\"false\" symmetric=\"true\">\u2211</mo><mrow><mi>k</mi><mo>=</mo><mi>C</mi></mrow><mi>N</mi></munderover><msub><mi>p</mi><mi>\u03b7</mi></msub><mrow><mo stretchy=\"false\">(</mo><mi>k</mi><mo stretchy=\"false\">|</mo><mi>N</mi><mo stretchy=\"false\">)</mo></mrow><msub><mi>P</mi><mi>D</mi></msub><mrow><mo stretchy=\"false\">(</mo><mi>C</mi><mo stretchy=\"false\">|</mo><mi>k</mi><mo stretchy=\"false\">)</mo></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.05831.tex", "nexttext": "\nThis general formula is always valid, but it cannot be solved explicitly unless we specify the prior, which is what we will do next, for some special cases of particular relevance.\n\n\\subsection{Poisson prior}\nIn case of a Poissonian prior with mean photon number $\\mu$ (which may occur when we deal with coherent states):\n\n", "itemtype": "equation", "pos": 11517, "prevtext": "\n\\end{corollary*}\n\\begin{proof}\nWe use the identity $p_0(m|n)=\\delta_{m,0}$ to replace every occurrence of $i$ in the noisy detection Theorem by 0, and the identity $p_1(m|n)=\\delta_{m,n}$ to replace every occurrence of $j$ by $N$. This gets rid of the first two summations and the result follows.\n\\end{proof}\n\n\\section{retrodicting the photon number}\nTo retrodict the photon number \\emph{given} an observed number of clicks, we have to invert the probability in the main theorem using Bayes' rule:\n\n", "index": 19, "text": "\\begin{align}\nP_{D,\\eta,\\varepsilon}(N|C)=\\frac{P_{D,\\eta,\\varepsilon}(C|N)Pr(N)}{\\sum_k P_{D,\\eta,\\varepsilon}(C|k)Pr(k)}\n\\label{bayes}\n\\end{align}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E8.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle P_{D,\\eta,\\varepsilon}(N|C)=\\frac{P_{D,\\eta,\\varepsilon}(C|N)Pr(%&#10;N)}{\\sum_{k}P_{D,\\eta,\\varepsilon}(C|k)Pr(k)}\" display=\"inline\"><mrow><msub><mi>P</mi><mrow><mi>D</mi><mo>,</mo><mi>\u03b7</mi><mo>,</mo><mi>\u03b5</mi></mrow></msub><mrow><mo stretchy=\"false\">(</mo><mi>N</mi><mo stretchy=\"false\">|</mo><mi>C</mi><mo stretchy=\"false\">)</mo></mrow><mo>=</mo><mstyle displaystyle=\"true\"><mfrac><mrow><msub><mi>P</mi><mrow><mi>D</mi><mo>,</mo><mi>\u03b7</mi><mo>,</mo><mi>\u03b5</mi></mrow></msub><mrow><mo stretchy=\"false\">(</mo><mi>C</mi><mo stretchy=\"false\">|</mo><mi>N</mi><mo stretchy=\"false\">)</mo></mrow><mi>P</mi><mi>r</mi><mrow><mo stretchy=\"false\">(</mo><mi>N</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mrow><msub><mo largeop=\"true\" symmetric=\"true\">\u2211</mo><mi>k</mi></msub><msub><mi>P</mi><mrow><mi>D</mi><mo>,</mo><mi>\u03b7</mi><mo>,</mo><mi>\u03b5</mi></mrow></msub><mrow><mo stretchy=\"false\">(</mo><mi>C</mi><mo stretchy=\"false\">|</mo><mi>k</mi><mo stretchy=\"false\">)</mo></mrow><mi>P</mi><mi>r</mi><mrow><mo stretchy=\"false\">(</mo><mi>k</mi><mo stretchy=\"false\">)</mo></mrow></mrow></mfrac></mstyle></mrow></math>", "type": "latex"}, {"file": "1601.05831.tex", "nexttext": "\nwe can find an explicit expression for the ideal retrodiction probability:\n\n", "itemtype": "equation", "pos": 11988, "prevtext": "\nThis general formula is always valid, but it cannot be solved explicitly unless we specify the prior, which is what we will do next, for some special cases of particular relevance.\n\n\\subsection{Poisson prior}\nIn case of a Poissonian prior with mean photon number $\\mu$ (which may occur when we deal with coherent states):\n\n", "index": 21, "text": "\\begin{align}\nPr(N)=\\frac{\\mu^N e^{-\\mu}}{N!},\n\\end{align}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E9.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle Pr(N)=\\frac{\\mu^{N}e^{-\\mu}}{N!},\" display=\"inline\"><mrow><mrow><mrow><mi>P</mi><mo>\u2062</mo><mi>r</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>N</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mstyle displaystyle=\"true\"><mfrac><mrow><msup><mi>\u03bc</mi><mi>N</mi></msup><mo>\u2062</mo><msup><mi>e</mi><mrow><mo>-</mo><mi>\u03bc</mi></mrow></msup></mrow><mrow><mi>N</mi><mo lspace=\"0pt\" rspace=\"3.5pt\">!</mo></mrow></mfrac></mstyle></mrow><mo>,</mo></mrow></math>", "type": "latex"}, {"file": "1601.05831.tex", "nexttext": "\nwhere $\\gamma=D/\\mu$.\n\n\\subsection{Thermal prior}\nIn case of a thermal prior with mean photon number $\\mu$ (which occurs for instance for two-mode squeezed vacuum states or for EPR states)\n\n", "itemtype": "equation", "pos": 12122, "prevtext": "\nwe can find an explicit expression for the ideal retrodiction probability:\n\n", "index": 23, "text": "\\begin{align}\nP_{D}^\\mathrm{Poisson}(N|C)=\\frac{C!\\,\\mathcal{S}_N^C}{N!\\,\\gamma^{N}}\\frac{1}{(e^{1/\\gamma}-1)^{C}}\n\\end{align}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E10.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle P_{D}^{\\mathrm{Poisson}}(N|C)=\\frac{C!\\,\\mathcal{S}_{N}^{C}}{N!%&#10;\\,\\gamma^{N}}\\frac{1}{(e^{1/\\gamma}-1)^{C}}\" display=\"inline\"><mrow><msubsup><mi>P</mi><mi>D</mi><mi>Poisson</mi></msubsup><mrow><mo stretchy=\"false\">(</mo><mi>N</mi><mo stretchy=\"false\">|</mo><mi>C</mi><mo stretchy=\"false\">)</mo></mrow><mo>=</mo><mstyle displaystyle=\"true\"><mfrac><mrow><mrow><mi>C</mi><mo lspace=\"0pt\" rspace=\"3.5pt\">!</mo></mrow><mo>\u2062</mo><msubsup><mi class=\"ltx_font_mathcaligraphic\">\ud835\udcae</mi><mi>N</mi><mi>C</mi></msubsup></mrow><mrow><mrow><mi>N</mi><mo lspace=\"0pt\" rspace=\"3.5pt\">!</mo></mrow><mo>\u2062</mo><msup><mi>\u03b3</mi><mi>N</mi></msup></mrow></mfrac></mstyle><mstyle displaystyle=\"true\"><mfrac><mn>1</mn><msup><mrow><mo stretchy=\"false\">(</mo><mrow><msup><mi>e</mi><mrow><mn>1</mn><mo>/</mo><mi>\u03b3</mi></mrow></msup><mo>-</mo><mn>1</mn></mrow><mo stretchy=\"false\">)</mo></mrow><mi>C</mi></msup></mfrac></mstyle></mrow></math>", "type": "latex"}, {"file": "1601.05831.tex", "nexttext": "\nthe ideal retrodiction probability can be written as:\n\n", "itemtype": "equation", "pos": 12438, "prevtext": "\nwhere $\\gamma=D/\\mu$.\n\n\\subsection{Thermal prior}\nIn case of a thermal prior with mean photon number $\\mu$ (which occurs for instance for two-mode squeezed vacuum states or for EPR states)\n\n", "index": 25, "text": "\\begin{align}\nPr(N)=\\frac{\\mu^N}{(\\mu+1)^{N+1}},\n\\end{align}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E11.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle Pr(N)=\\frac{\\mu^{N}}{(\\mu+1)^{N+1}},\" display=\"inline\"><mrow><mrow><mrow><mi>P</mi><mo>\u2062</mo><mi>r</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>N</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mstyle displaystyle=\"true\"><mfrac><msup><mi>\u03bc</mi><mi>N</mi></msup><msup><mrow><mo stretchy=\"false\">(</mo><mrow><mi>\u03bc</mi><mo>+</mo><mn>1</mn></mrow><mo stretchy=\"false\">)</mo></mrow><mrow><mi>N</mi><mo>+</mo><mn>1</mn></mrow></msup></mfrac></mstyle></mrow><mo>,</mo></mrow></math>", "type": "latex"}, {"file": "1601.05831.tex", "nexttext": "\n\n\\subsection{Considerations}\nWhen one moves away from the ideal case, a sub-unity quantum efficiency plays a fundamental role, while the number of detectors is typically less important. One finds that the probability of detecting all the input photons with a noiseless apparatus, saturates at a value lower than 1 even for an infinite number of detectors:\n\n", "itemtype": "equation", "pos": 12553, "prevtext": "\nthe ideal retrodiction probability can be written as:\n\n", "index": 27, "text": "\\begin{align}\n\\label{thermal}\nP_{D}^\\mathrm{Therm}(N|C)=\\frac{C!\\,\\mathcal{S}_N^C}{(D+\\gamma)^{N}}\\frac{\\Gamma(D+\\gamma)}{\\Gamma(D+\\gamma-C)!}\n\\end{align}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E12.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle P_{D}^{\\mathrm{Therm}}(N|C)=\\frac{C!\\,\\mathcal{S}_{N}^{C}}{(D+%&#10;\\gamma)^{N}}\\frac{\\Gamma(D+\\gamma)}{\\Gamma(D+\\gamma-C)!}\" display=\"inline\"><mrow><msubsup><mi>P</mi><mi>D</mi><mi>Therm</mi></msubsup><mrow><mo stretchy=\"false\">(</mo><mi>N</mi><mo stretchy=\"false\">|</mo><mi>C</mi><mo stretchy=\"false\">)</mo></mrow><mo>=</mo><mstyle displaystyle=\"true\"><mfrac><mrow><mrow><mi>C</mi><mo lspace=\"0pt\" rspace=\"3.5pt\">!</mo></mrow><mo>\u2062</mo><msubsup><mi class=\"ltx_font_mathcaligraphic\">\ud835\udcae</mi><mi>N</mi><mi>C</mi></msubsup></mrow><msup><mrow><mo stretchy=\"false\">(</mo><mrow><mi>D</mi><mo>+</mo><mi>\u03b3</mi></mrow><mo stretchy=\"false\">)</mo></mrow><mi>N</mi></msup></mfrac></mstyle><mstyle displaystyle=\"true\"><mfrac><mrow><mi mathvariant=\"normal\">\u0393</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mrow><mi>D</mi><mo>+</mo><mi>\u03b3</mi></mrow><mo stretchy=\"false\">)</mo></mrow></mrow><mrow><mi mathvariant=\"normal\">\u0393</mi><mo>\u2062</mo><mrow><mrow><mo stretchy=\"false\">(</mo><mrow><mrow><mi>D</mi><mo>+</mo><mi>\u03b3</mi></mrow><mo>-</mo><mi>C</mi></mrow><mo stretchy=\"false\">)</mo></mrow><mo lspace=\"0pt\" rspace=\"3.5pt\">!</mo></mrow></mrow></mfrac></mstyle></mrow></math>", "type": "latex"}, {"file": "1601.05831.tex", "nexttext": "\n\nThe effect of noise in the detectors is tangible only when their number is sufficiently large, for instance when the number of spurious counts is comparable with the actual number of photons hitting the detectors i.e. when $D\\varepsilon\\approx N$.\n\n\\section{Applications}\nWe now would like to give a few examples of how to apply our results. The examples will be retrodiction of photon number for heralding quantum states.\n\n\\subsection{Example 1: heralding of a NOON state}\nFor this example we consider the following setup: we replace the two mirrors in the middle of a Mach-Zehnder (MZ) interferometer with 50:50 beam splitters and add detectors to measure the photons that leak. This configuration (if the phase difference between the two arms of the MZ is set to $\\pi/2$) will output a $(|4,0\\rangle+|0,4\\rangle)/\\sqrt{2}$ state if we start with the state $|3,3\\rangle$ and if each of the two detectors measures exactly 1 photon.\n\nNow the question is how well do we know that we had exactly 1 photon at the detectors? If we resort to multiplexed detection, we first need to compute the prior joint probability $Pr(N_1,N_2)$ of having $N_1$ photons at detector 1 and $N_2$ photons at detector 2. This is achieved using simple input-output relations for 50:50 beam splitters; we report it in Fig.\\ref{table}.\n\n\\begin{figure}[h]\n\\begin{center}\n\\includegraphics[width=0.7\\columnwidth]{table.pdf}\n\\caption{\\label{table}Joint probabilities of having $(i,j)$ photons (where $i$ and $j$ are listed in the headings on top and on the left) at the detectors in the modified MZ interferometer of the NOON state heralding example. These are computed assuming the input $|3,3\\rangle$.}\n\\end{center}\n\\end{figure}\n\nThen, we apply Bayes' rule (assuming that the two sets of multiplexed detectors are identical, but we could easily modify the equation below to account for different configurations) and find $P_{D,\\eta,\\varepsilon}(N_1,N_2|C_1,C_2)$ to be given by\n\n", "itemtype": "equation", "pos": 13064, "prevtext": "\n\n\\subsection{Considerations}\nWhen one moves away from the ideal case, a sub-unity quantum efficiency plays a fundamental role, while the number of detectors is typically less important. One finds that the probability of detecting all the input photons with a noiseless apparatus, saturates at a value lower than 1 even for an infinite number of detectors:\n\n", "index": 29, "text": "\\begin{align}\n\\lim_{D\\rightarrow\\infty}P_{D,\\eta}(N|N)=\\eta^N\\lim_{D\\rightarrow\\infty}P_{D}(N|N)=\\eta^N\n\\end{align}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E13.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle\\lim_{D\\rightarrow\\infty}P_{D,\\eta}(N|N)=\\eta^{N}\\lim_{D%&#10;\\rightarrow\\infty}P_{D}(N|N)=\\eta^{N}\" display=\"inline\"><mrow><munder><mo movablelimits=\"false\">lim</mo><mrow><mi>D</mi><mo>\u2192</mo><mi mathvariant=\"normal\">\u221e</mi></mrow></munder><msub><mi>P</mi><mrow><mi>D</mi><mo>,</mo><mi>\u03b7</mi></mrow></msub><mrow><mo stretchy=\"false\">(</mo><mi>N</mi><mo stretchy=\"false\">|</mo><mi>N</mi><mo stretchy=\"false\">)</mo></mrow><mo>=</mo><msup><mi>\u03b7</mi><mi>N</mi></msup><munder><mo movablelimits=\"false\">lim</mo><mrow><mi>D</mi><mo>\u2192</mo><mi mathvariant=\"normal\">\u221e</mi></mrow></munder><msub><mi>P</mi><mi>D</mi></msub><mrow><mo stretchy=\"false\">(</mo><mi>N</mi><mo stretchy=\"false\">|</mo><mi>N</mi><mo stretchy=\"false\">)</mo></mrow><mo>=</mo><msup><mi>\u03b7</mi><mi>N</mi></msup></mrow></math>", "type": "latex"}, {"file": "1601.05831.tex", "nexttext": "\nWe finally use the quantity $P_{D,\\eta,\\varepsilon}(N_1,N_2|C_1,C_2)$ to infer the retrodictive power of our multiplexed detectors. To complete the example, in Fig.~\\ref{retroNOON} we plot the retrodicted probabilities of four configurations: 4 and 16 detectors with 60\\% and 75\\% quantum efficiency (and 500 dark counts/sec, with 10 ns gated measurement window), given that they both reported a single click each.\n\n\\begin{figure}[h]\n\\begin{tabular}{cc}\n\\subfloat[4 detectors, 60\\% QE]{\\includegraphics[width = .5\\columnwidth]{4plot6.jpg}} &\n\\subfloat[4 detectors, 75\\% QE]{\\includegraphics[width = .5\\columnwidth]{4plot75.jpg}} \\\\\n\\subfloat[64 detectors, 60\\% QE]{\\includegraphics[width = .5\\columnwidth]{64plot6.jpg}} &\n\\subfloat[64 detectors, 75\\% QE]{\\includegraphics[width = .5\\columnwidth]{64plot75.jpg}}\n\\end{tabular}\n\\caption{\\label{retroNOON}Plots of the probability of retrodicted photon number for a NOON state heralding setup using multiplexed detection. Although the most probable case is the desired $|1,1\\rangle$, its individual probability can be quite low, which leads to a low fidelity with the desired NOON state. The bottleneck in this case is quantum efficiency: even increasing the number of detectors from 4 to 64 does not perform as well as increasing the quantum efficiency from 60\\% to 75\\%.}\n\\end{figure}\n\nFor comparison, in Fig.~\\ref{retroNOON2} we plot the retrodiction probabilities for a non-multiplexed measurement.\n\\begin{figure}[h!]\n\\begin{tabular}{cc}\n\\subfloat[1 detector, 75\\% QE]{\\includegraphics[width = .5\\columnwidth]{1plot75.jpg}} &\n\\subfloat[1 detector, 100\\% QE]{\\includegraphics[width = .5\\columnwidth]{1plot1.jpg}}\n\\end{tabular}\n\\caption{\\label{retroNOON2}(left) A pair of realistic detectors are likely to lie: if they report a single click each, the state was more likely to be $|1,2\\rangle$ or $|2,1\\rangle$. (right) Even a pair of ideal (100\\% quantum efficiency) detectors yields equal probability for the states $|1,1\\rangle$, $|1,2\\rangle$ and $|2,1\\rangle$.}\n\\end{figure}\n\n\n\\subsection{Example 2: single photon heralding from squeezed vacuum}\n\nWe now consider an example of single photon heralding from a two-mode squeezed vacuum, which is performed by producing photons in pairs and heralding one by detecting the other. Such two-mode state can be generated by pumping a nonlinear crystal with an intense coherent laser pulse. The output of the process is a state in the following form:\n\n", "itemtype": "equation", "pos": 15131, "prevtext": "\n\nThe effect of noise in the detectors is tangible only when their number is sufficiently large, for instance when the number of spurious counts is comparable with the actual number of photons hitting the detectors i.e. when $D\\varepsilon\\approx N$.\n\n\\section{Applications}\nWe now would like to give a few examples of how to apply our results. The examples will be retrodiction of photon number for heralding quantum states.\n\n\\subsection{Example 1: heralding of a NOON state}\nFor this example we consider the following setup: we replace the two mirrors in the middle of a Mach-Zehnder (MZ) interferometer with 50:50 beam splitters and add detectors to measure the photons that leak. This configuration (if the phase difference between the two arms of the MZ is set to $\\pi/2$) will output a $(|4,0\\rangle+|0,4\\rangle)/\\sqrt{2}$ state if we start with the state $|3,3\\rangle$ and if each of the two detectors measures exactly 1 photon.\n\nNow the question is how well do we know that we had exactly 1 photon at the detectors? If we resort to multiplexed detection, we first need to compute the prior joint probability $Pr(N_1,N_2)$ of having $N_1$ photons at detector 1 and $N_2$ photons at detector 2. This is achieved using simple input-output relations for 50:50 beam splitters; we report it in Fig.\\ref{table}.\n\n\\begin{figure}[h]\n\\begin{center}\n\\includegraphics[width=0.7\\columnwidth]{table.pdf}\n\\caption{\\label{table}Joint probabilities of having $(i,j)$ photons (where $i$ and $j$ are listed in the headings on top and on the left) at the detectors in the modified MZ interferometer of the NOON state heralding example. These are computed assuming the input $|3,3\\rangle$.}\n\\end{center}\n\\end{figure}\n\nThen, we apply Bayes' rule (assuming that the two sets of multiplexed detectors are identical, but we could easily modify the equation below to account for different configurations) and find $P_{D,\\eta,\\varepsilon}(N_1,N_2|C_1,C_2)$ to be given by\n\n", "index": 31, "text": "\\begin{align}\n\\frac{P_{D,\\eta,\\varepsilon}(C_1|N_1)P_{D,\\eta,\\varepsilon}(C_2|N_2)Pr(N_1,N_2)}{\\sum_{k_1,k_2} P_{D,\\eta,\\varepsilon}(C_1|k_1)P_{D,\\eta,\\varepsilon}(C_2|k_2)Pr(k_1,k_2)}\n\\end{align}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E14.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle\\frac{P_{D,\\eta,\\varepsilon}(C_{1}|N_{1})P_{D,\\eta,\\varepsilon}(C%&#10;_{2}|N_{2})Pr(N_{1},N_{2})}{\\sum_{k_{1},k_{2}}P_{D,\\eta,\\varepsilon}(C_{1}|k_{%&#10;1})P_{D,\\eta,\\varepsilon}(C_{2}|k_{2})Pr(k_{1},k_{2})}\" display=\"inline\"><mstyle displaystyle=\"true\"><mfrac><mrow><msub><mi>P</mi><mrow><mi>D</mi><mo>,</mo><mi>\u03b7</mi><mo>,</mo><mi>\u03b5</mi></mrow></msub><mrow><mo stretchy=\"false\">(</mo><msub><mi>C</mi><mn>1</mn></msub><mo stretchy=\"false\">|</mo><msub><mi>N</mi><mn>1</mn></msub><mo stretchy=\"false\">)</mo></mrow><msub><mi>P</mi><mrow><mi>D</mi><mo>,</mo><mi>\u03b7</mi><mo>,</mo><mi>\u03b5</mi></mrow></msub><mrow><mo stretchy=\"false\">(</mo><msub><mi>C</mi><mn>2</mn></msub><mo stretchy=\"false\">|</mo><msub><mi>N</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo></mrow><mi>P</mi><mi>r</mi><mrow><mo stretchy=\"false\">(</mo><msub><mi>N</mi><mn>1</mn></msub><mo>,</mo><msub><mi>N</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo></mrow></mrow><mrow><msub><mo largeop=\"true\" symmetric=\"true\">\u2211</mo><mrow><msub><mi>k</mi><mn>1</mn></msub><mo>,</mo><msub><mi>k</mi><mn>2</mn></msub></mrow></msub><msub><mi>P</mi><mrow><mi>D</mi><mo>,</mo><mi>\u03b7</mi><mo>,</mo><mi>\u03b5</mi></mrow></msub><mrow><mo stretchy=\"false\">(</mo><msub><mi>C</mi><mn>1</mn></msub><mo stretchy=\"false\">|</mo><msub><mi>k</mi><mn>1</mn></msub><mo stretchy=\"false\">)</mo></mrow><msub><mi>P</mi><mrow><mi>D</mi><mo>,</mo><mi>\u03b7</mi><mo>,</mo><mi>\u03b5</mi></mrow></msub><mrow><mo stretchy=\"false\">(</mo><msub><mi>C</mi><mn>2</mn></msub><mo stretchy=\"false\">|</mo><msub><mi>k</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo></mrow><mi>P</mi><mi>r</mi><mrow><mo stretchy=\"false\">(</mo><msub><mi>k</mi><mn>1</mn></msub><mo>,</mo><msub><mi>k</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo></mrow></mrow></mfrac></mstyle></math>", "type": "latex"}, {"file": "1601.05831.tex", "nexttext": "\nwhere $\\zeta=g e^{i\\phi}$ is the squeezing parameter. For small enough values of the gain $g$ one can indeed ignore components with photon number larger than 1, but if the gain  is too large the heralded state can contain more than 1 photon. If such states were further used for crucial applications such as quantum cryptography, they would be vulnerable for example to the photon number splitting attack. Could a multiplexed detection scheme make for a better heralded single-photon source?\nFirst note that the amplitudes of the two-mode squeezed vacuum follow a thermal distribution, if we recognize that $\\sinh(g)^2$ is the mean photon number per mode. Then, we apply Eq.~\\eqref{bayes} to find the retrodicted photon number distribution, which we plot for a few examples in Fig.~\\ref{retroSqueezed}. Note that as the gain increases, the probability of the various number states levels off and becomes stable. \n\\begin{figure}[h]\n\\begin{tabular}{cc}\n\\subfloat[4 detectors, 60\\% QE]{\\includegraphics[width = .5\\columnwidth]{4squeezed6.pdf}} &\n\\subfloat[4 detectors, 75\\% QE]{\\includegraphics[width = .5\\columnwidth]{4squeezed75.pdf}} \\\\\n\\subfloat[100 detectors, 60\\% QE]{\\includegraphics[width = .5\\columnwidth]{100squeezed6.pdf}} &\n\\subfloat[100 detectors, 75\\% QE]{\\includegraphics[width = .5\\columnwidth]{100squeezed75.pdf}}\n\\end{tabular}\n\\caption{\\label{retroSqueezed}Plots of the probability of retrodicted photon number for a squeezed vacuum state. Again, the bottleneck is quantum efficiency. Note that the probability of retrodicting a given photon number becomes constant as the gain $g$ increases.}\n\\end{figure}\n\n\\section{conclusions and outlook}\nIn conclusion, we have shown the most unbiased way of analyzing a detection event in a multiplexed measurement scheme, taking noise and efficiency into account. The corollary of our theorem can apply even to realistic situations if some conditions on the noise are met, which can be very advantageous as it is computationally much simpler to implement than the full theorem.\n\nOur results can be applied also to optical engineering issues such as on-chip denoising in consumer imaging devices, where multiple pixels can fill an Airy disk and can be used to retrodict the intensity more accurately. There are still interesting questions to be asked, for instance whether it is possible to find closed form solutions of Eq.~\\ref{bayes} for useful priors when the quantum efficiency is not unity, or if there is a reasonable way of relaxing the assumption of uniform illumination. We leave these to a future work.\n\n\\section{Acknowledgements}\nThis work was supported by the Canada Excellence Research Chairs program.\n\n\n\\bibliography{multiplexingBibliography}\n\\bibstyle{unsrt}\n\n\n\n\n", "itemtype": "equation", "pos": 17770, "prevtext": "\nWe finally use the quantity $P_{D,\\eta,\\varepsilon}(N_1,N_2|C_1,C_2)$ to infer the retrodictive power of our multiplexed detectors. To complete the example, in Fig.~\\ref{retroNOON} we plot the retrodicted probabilities of four configurations: 4 and 16 detectors with 60\\% and 75\\% quantum efficiency (and 500 dark counts/sec, with 10 ns gated measurement window), given that they both reported a single click each.\n\n\\begin{figure}[h]\n\\begin{tabular}{cc}\n\\subfloat[4 detectors, 60\\% QE]{\\includegraphics[width = .5\\columnwidth]{4plot6.jpg}} &\n\\subfloat[4 detectors, 75\\% QE]{\\includegraphics[width = .5\\columnwidth]{4plot75.jpg}} \\\\\n\\subfloat[64 detectors, 60\\% QE]{\\includegraphics[width = .5\\columnwidth]{64plot6.jpg}} &\n\\subfloat[64 detectors, 75\\% QE]{\\includegraphics[width = .5\\columnwidth]{64plot75.jpg}}\n\\end{tabular}\n\\caption{\\label{retroNOON}Plots of the probability of retrodicted photon number for a NOON state heralding setup using multiplexed detection. Although the most probable case is the desired $|1,1\\rangle$, its individual probability can be quite low, which leads to a low fidelity with the desired NOON state. The bottleneck in this case is quantum efficiency: even increasing the number of detectors from 4 to 64 does not perform as well as increasing the quantum efficiency from 60\\% to 75\\%.}\n\\end{figure}\n\nFor comparison, in Fig.~\\ref{retroNOON2} we plot the retrodiction probabilities for a non-multiplexed measurement.\n\\begin{figure}[h!]\n\\begin{tabular}{cc}\n\\subfloat[1 detector, 75\\% QE]{\\includegraphics[width = .5\\columnwidth]{1plot75.jpg}} &\n\\subfloat[1 detector, 100\\% QE]{\\includegraphics[width = .5\\columnwidth]{1plot1.jpg}}\n\\end{tabular}\n\\caption{\\label{retroNOON2}(left) A pair of realistic detectors are likely to lie: if they report a single click each, the state was more likely to be $|1,2\\rangle$ or $|2,1\\rangle$. (right) Even a pair of ideal (100\\% quantum efficiency) detectors yields equal probability for the states $|1,1\\rangle$, $|1,2\\rangle$ and $|2,1\\rangle$.}\n\\end{figure}\n\n\n\\subsection{Example 2: single photon heralding from squeezed vacuum}\n\nWe now consider an example of single photon heralding from a two-mode squeezed vacuum, which is performed by producing photons in pairs and heralding one by detecting the other. Such two-mode state can be generated by pumping a nonlinear crystal with an intense coherent laser pulse. The output of the process is a state in the following form:\n\n", "index": 33, "text": "\\begin{align}\n\\hat S(\\zeta)|0,0\\rangle=\\sum_{n=0}^\\infty e^{in\\phi}\\frac{\\sinh(g)^n}{\\left(\\sinh(g)^2+1\\right)^{\\frac{n+1}{2}}}|n,n\\rangle,\n\\end{align}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E15.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle\\hat{S}(\\zeta)|0,0\\rangle=\\sum_{n=0}^{\\infty}e^{in\\phi}\\frac{%&#10;\\sinh(g)^{n}}{\\left(\\sinh(g)^{2}+1\\right)^{\\frac{n+1}{2}}}|n,n\\rangle,\" display=\"inline\"><mrow><mrow><mrow><mover accent=\"true\"><mi>S</mi><mo stretchy=\"false\">^</mo></mover><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>\u03b6</mi><mo stretchy=\"false\">)</mo></mrow><mo>\u2062</mo><mrow><mo fence=\"true\" stretchy=\"false\">|</mo><mrow><mn>0</mn><mo>,</mo><mn>0</mn></mrow><mo stretchy=\"false\">\u27e9</mo></mrow></mrow><mo>=</mo><mrow><mstyle displaystyle=\"true\"><munderover><mo largeop=\"true\" movablelimits=\"false\" symmetric=\"true\">\u2211</mo><mrow><mi>n</mi><mo>=</mo><mn>0</mn></mrow><mi mathvariant=\"normal\">\u221e</mi></munderover></mstyle><mrow><msup><mi>e</mi><mrow><mi>i</mi><mo>\u2062</mo><mi>n</mi><mo>\u2062</mo><mi>\u03d5</mi></mrow></msup><mo>\u2062</mo><mstyle displaystyle=\"true\"><mfrac><mrow><mi>sinh</mi><msup><mrow><mo stretchy=\"false\">(</mo><mi>g</mi><mo stretchy=\"false\">)</mo></mrow><mi>n</mi></msup></mrow><msup><mrow><mo>(</mo><mi>sinh</mi><msup><mrow><mo stretchy=\"false\">(</mo><mi>g</mi><mo stretchy=\"false\">)</mo></mrow><mn>2</mn></msup><mo>+</mo><mn>1</mn><mo>)</mo></mrow><mfrac><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow><mn>2</mn></mfrac></msup></mfrac></mstyle><mo>\u2062</mo><mrow><mo fence=\"true\" stretchy=\"false\">|</mo><mrow><mi>n</mi><mo>,</mo><mi>n</mi></mrow><mo stretchy=\"false\">\u27e9</mo></mrow></mrow></mrow></mrow><mo>,</mo></mrow></math>", "type": "latex"}]