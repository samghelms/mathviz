[{"file": "1601.05158.tex", "nexttext": "\n\nIn the between-species scenario, we denote the numbers of biological samples from {\\textcolor{black}{{species 1 and 2}}} as {\\textcolor{black}{{$m_1$}}} and $m_2${\\textcolor{black}{{. The gene population consists of all orthologous gene pairs between the two species, and the number of pairs is denoted as $N$. {\\textcolor{black}{{ The ortholog pairs can be represented as a two-column table with $N$ rows.  }}}  We use $X_i$ ($i=1,2,\\dots,m_1$) and $Y_j$ ($j=1,2,\\dots,m_2$) to denote {\\textcolor{black}{{the genes of species 1 and 2 that are in orthologous gene pairs and also overlap with}}} the associated genes of {\\textcolor{black}{{sample $i$ in species 1 and sample $j$ in species 2}}}.  {\\textcolor{black}{{  In other words, $X_i$ (or $Y_j$) is the intersection of associated genes in sample $i$ of species 1 (or sample $j$ of species 2) and orthologous gene pairs.  }}}   Please note that $X_i$ and $Y_j$ may contain repetitive genes, since there {\\textcolor{black}{{exist}}} many-to-one, one-to-many and many-to-many orthologous gene pairs.}}}  Let $m_0$ be the number of orthologous gene pairs {\\textcolor{black}{{existent between $X_i$ and $Y_j$: $m_0$ out of $N$ pairs of orthologs can be formed by matching genes in $X_i$ and $Y_j$.}}}  Then\nthe $p$-value for between-species comparison {\\textcolor{black}{{of the two samples}}} is calculated as\n\n", "itemtype": "equation", "pos": 8544, "prevtext": "\n\n\\maketitle\n\n\\blfootnote{\\\\$^{1}$ Department of Statistics, University of California, Los Angeles, CA 90095-1554\\\\\n$^{2}$ Department of Human Genetics, University of California, Los Angeles, CA 90095-7088\\\\\n$^{*}$ To whom correspondence should be addressed.\nEmail: jli@stat.ucla.edu\n}\n\n\n\\begin{abstract}\nComparative transcriptomics has gained increasing popularity in genomic research thanks to the development of high-throughput technologies including microarray and next-generation RNA sequencing that have generated numerous transcriptomic data. An important question is to understand the conservation and differentiation of biological processes in different species. We propose a testing-based method TROM (Transcriptome Overlap Measure) for comparing transcriptomes within or between different species, and provide a different perspective to interpret transcriptomic similarity in contrast to traditional correlation analyses. Specifically, the TROM method focuses on identifying associated genes that capture molecular characteristics of biological samples, and subsequently comparing the biological samples by testing the overlap of their associated genes. We use simulation and real data studies to demonstrate that TROM is more powerful in identifying similar transcriptomes and more robust to stochastic gene expression noise than Pearson and Spearman correlations. We apply TROM to compare the developmental stages of six \\emph{Drosophila} species, \\emph{C. elegans}, {\\textcolor{black}{{\\emph{S. purpuratus}, \\emph{D. rerio}}}} and mouse liver, and find interesting correspondence patterns that imply conserved gene expression programs in {\\textcolor{black}{{the}}} development {\\textcolor{black}{{of these species}}}. The TROM method is available as an R package on CRAN (\\href{http://cran.r-project.org/}{http://cran.r-project.org/}) with manuals and source codes available at \\href{http://www.stat.ucla.edu/~jingyi.li/software-and-data/trom.html}{http://www.stat.ucla.edu/~jingyi.li/software-and-data/trom.html}.\n\n\\noindent \\textbf{Key words}: transcriptomic similarity measure; multi-species developmental stages; robustness to platform differences; comparative transcriptomics; microarray vs. RNA-seq; \nPearson correlation coefficient; Spearman correlation coefficient; overlap test\n\n\\end{abstract}\n\n\n\n\n\\section{Introduction}\n\nComparative genomics is an important field {\\textcolor{black}{{that addresses}}} evolutionary questions and {\\textcolor{black}{{studies}}} developmental processes across distant species \\cite{Pantalacci2015}. Studying transcriptomes is essential for understanding functions of genomic regions and interpreting regulatory relationships of multiple genomic elements \\cite{Wang2009}. Comparing transcriptomes of the same species can reveal molecular mechanisms behind the {\\textcolor{black}{{occurrence}}} and progression of important biological processes, such as organism development and stem cell differentiation \\cite{Shen2012,Labbe2012}. Comparing transcriptomes of different species can help understand the conservation and differentiation of {\\textcolor{black}{{these}}} molecular mechanisms in evolution \\cite{Li2014}. High-throughput technologies have generated large amounts of publicly available transcriptomic data, creating an unprecedented opportunity for comparing multi-species transcriptomes under various biological conditions.\n\nFinding the transcriptomic similarity and disparity of biological samples is a key step to understanding the underlying molecular mechanisms common or unique to them. It is desirable to have a transcriptomic similarity measure that can lead to a clear correspondence pattern among biological samples from the same or different species. Correlation analysis is a classical approach for comparing transcriptomes based on gene expression data. Commonly used measures are Pearson and Spearman correlation coefficients, both of which have played important roles in biological discoveries \\cite{Arbeitman2002,Spencer2011,Necsulea2014}. However, in most scenarios neither of them can produce a clear correspondence pattern among biological samples. The main reason is the existence of many housekeeping genes, which would inflate {\\textcolor{black}{{correlation}}} coefficients. {\\textcolor{black}{{Moreover, correlation measures rely heavily on the accuracy of gene expression data and are {\\textcolor{black}{{susceptible}}} to the {\\textcolor{black}{{low signal-to-noise ratios of}}} lowly expressed genes.}}} Therefore, it is often difficult to use correlation analysis to find a clear correspondence pattern {\\textcolor{black}{{of transcriptomes}}}.\n\n\nHere we introduce a new {\\textcolor{black}{{testing-based}}} measure--transcriptome overlap measure {\\textcolor{black}{{(TROM)}}}--to find correspondence {\\textcolor{black}{{of transcriptomes}}} of the same or different species. The measure is based on testing the overlap of ``associated genes'', which represent transcriptomic characteristics of biological samples. {\\textcolor{black}{{We show that compared to Pearson and Spearman correlations, TROM is more powerful in detecting transcriptome correspondence in simulations, and can lead to clearer correspondence maps of developmental stages within and between multiple species in real data studies. TROM also provides a systematic approach for selecting associated genes of every biological sample. We show that these associated genes can well capture transcriptomic characteristics and help construct developmental trees in multiple species. In addition, we demonstrate that TROM is robust to {\\textcolor{black}{{data normalization and }}}differences of high-throughput platforms{\\textcolor{black}{{.}}}}}}\n\n{\\textcolor{black}{{In Section 2, we describe the TROM method including the identification of associated genes, the calculation of TROM scores, and the selection of a threshold parameter. In Section 3, we present real data applications of TROM to large-scale transcriptomic data sets, power analysis of TROM and Pearson and Spearman correlations, demonstration of the robustness of TROM to data normalization and platform difference, and bioinformatic analyses of TROM results. }}}\n\n\n\n\n\\section{Method}\\label{sec:method}\n\n\\subsection{{\\textcolor{black}{{Associated genes and TROM scores}}}}\nOur method focuses on selecting associated genes to perform a gene set overlap test \\cite{Li2014}, which will lead to TROM scores that can be used to compare biological samples. We define {\\textcolor{black}{{\\textit{associated genes} of a sample}}} using the following criterion: the genes that have $z$-scores (normalized expression levels across samples) $\\geq z_0$ in the sample, where $z_0$ is a threshold {\\textcolor{black}{{that can be selected in a systematic approach (please see Section \\ref{secthre}) or set by users}}}. {\\textcolor{black}{{Based on this definition, associated genes of a sample are those with higher expression in the sample compared to a few other samples. In other words, associated genes are highly expressed in the sample of interest but not always highly expressed in all samples, and they are a superset of sample specific genes. Hence, associated genes capture gene expression characteristics of a sample, and these characteristics are either specific to the sample or may belong to a few other samples but not all samples. Associated genes provide a basis for comparing biological samples.}}} We compare two biological samples by statistically testing the dependence of their associated genes: to compare two samples of the same species, we calculate the significance of the number of their overlapping associated genes (resulting in a within-species TROM score); to compare two samples of different species, we calculate the significance of the number of orthologous gene pairs in their associated genes (resulting in a between-species TROM score).\n\nWe consider the two sample-associated gene sets as two samples drawn from the gene population. \nIn the within-species scenario, we denote the number of biological samples {\\textcolor{black}{{of a}}} given species as $k${\\textcolor{black}{{, and use}}} $X_i$ and $X_j$ ($i,j=1,2,\\dots,k$) to denote the associated genes of samples {\\textcolor{black}{{$i$ and $j$}}} to be compared. The gene population consists of all genes of the given species{\\textcolor{black}{{, and the size of the gene population}}} is denoted as $N$. \n{\\textcolor{black}{{Then the}}} $p$-value for within-species comparison between {\\textcolor{black}{{samples $i$ and $j$}}} is calculated as\n\n", "index": 1, "text": "\\begin{equation}\\label{eq1}\np\\text{-value} = \\sum_{m = |X_i\\cap X_j|}^{\\min(|X_i|,|X_j|)} \\frac{{N \\choose m}{N-m \\choose |X_i|-m} {N-|X_i| \\choose |X_j|-m}} {{N \\choose |X_i|}{N \\choose |X_j|}}.\n\\end{equation}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E1.m1\" class=\"ltx_Math\" alttext=\"p\\text{-value}=\\sum_{m=|X_{i}\\cap X_{j}|}^{\\min(|X_{i}|,|X_{j}|)}\\frac{{N%&#10;\\choose m}{N-m\\choose|X_{i}|-m}{N-|X_{i}|\\choose|X_{j}|-m}}{{N\\choose|X_{i}|}{%&#10;N\\choose|X_{j}|}}.\" display=\"block\"><mrow><mrow><mrow><mi>p</mi><mo>\u2062</mo><mtext>-value</mtext></mrow><mo>=</mo><mrow><munderover><mo largeop=\"true\" movablelimits=\"false\" symmetric=\"true\">\u2211</mo><mrow><mi>m</mi><mo>=</mo><mrow><mo stretchy=\"false\">|</mo><mrow><msub><mi>X</mi><mi>i</mi></msub><mo>\u2229</mo><msub><mi>X</mi><mi>j</mi></msub></mrow><mo stretchy=\"false\">|</mo></mrow></mrow><mrow><mi>min</mi><mo>\u2061</mo><mrow><mo stretchy=\"false\">(</mo><mrow><mo stretchy=\"false\">|</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy=\"false\">|</mo></mrow><mo>,</mo><mrow><mo stretchy=\"false\">|</mo><msub><mi>X</mi><mi>j</mi></msub><mo stretchy=\"false\">|</mo></mrow><mo stretchy=\"false\">)</mo></mrow></mrow></munderover><mfrac><mrow><mrow><mo>(</mo><mfrac linethickness=\"0pt\"><mi>N</mi><mi>m</mi></mfrac><mo>)</mo></mrow><mo>\u2062</mo><mrow><mo>(</mo><mfrac linethickness=\"0pt\"><mrow><mi>N</mi><mo>-</mo><mi>m</mi></mrow><mrow><mrow><mo stretchy=\"false\">|</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy=\"false\">|</mo></mrow><mo>-</mo><mi>m</mi></mrow></mfrac><mo>)</mo></mrow><mo>\u2062</mo><mrow><mo>(</mo><mfrac linethickness=\"0pt\"><mrow><mi>N</mi><mo>-</mo><mrow><mo stretchy=\"false\">|</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy=\"false\">|</mo></mrow></mrow><mrow><mrow><mo stretchy=\"false\">|</mo><msub><mi>X</mi><mi>j</mi></msub><mo stretchy=\"false\">|</mo></mrow><mo>-</mo><mi>m</mi></mrow></mfrac><mo>)</mo></mrow></mrow><mrow><mrow><mo>(</mo><mfrac linethickness=\"0pt\"><mi>N</mi><mrow><mo stretchy=\"false\">|</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy=\"false\">|</mo></mrow></mfrac><mo>)</mo></mrow><mo>\u2062</mo><mrow><mo>(</mo><mfrac linethickness=\"0pt\"><mi>N</mi><mrow><mo stretchy=\"false\">|</mo><msub><mi>X</mi><mi>j</mi></msub><mo stretchy=\"false\">|</mo></mrow></mfrac><mo>)</mo></mrow></mrow></mfrac></mrow></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.05158.tex", "nexttext": "\nThen we define the within-species or between-species TROM score as\n\n", "itemtype": "equation", "pos": 10117, "prevtext": "\n\nIn the between-species scenario, we denote the numbers of biological samples from {\\textcolor{black}{{species 1 and 2}}} as {\\textcolor{black}{{$m_1$}}} and $m_2${\\textcolor{black}{{. The gene population consists of all orthologous gene pairs between the two species, and the number of pairs is denoted as $N$. {\\textcolor{black}{{ The ortholog pairs can be represented as a two-column table with $N$ rows.  }}}  We use $X_i$ ($i=1,2,\\dots,m_1$) and $Y_j$ ($j=1,2,\\dots,m_2$) to denote {\\textcolor{black}{{the genes of species 1 and 2 that are in orthologous gene pairs and also overlap with}}} the associated genes of {\\textcolor{black}{{sample $i$ in species 1 and sample $j$ in species 2}}}.  {\\textcolor{black}{{  In other words, $X_i$ (or $Y_j$) is the intersection of associated genes in sample $i$ of species 1 (or sample $j$ of species 2) and orthologous gene pairs.  }}}   Please note that $X_i$ and $Y_j$ may contain repetitive genes, since there {\\textcolor{black}{{exist}}} many-to-one, one-to-many and many-to-many orthologous gene pairs.}}}  Let $m_0$ be the number of orthologous gene pairs {\\textcolor{black}{{existent between $X_i$ and $Y_j$: $m_0$ out of $N$ pairs of orthologs can be formed by matching genes in $X_i$ and $Y_j$.}}}  Then\nthe $p$-value for between-species comparison {\\textcolor{black}{{of the two samples}}} is calculated as\n\n", "index": 3, "text": "\\begin{equation}\\label{eq2}\np\\text{-value} = \\sum_{m = m_0}^{\\min(|X_i|,|Y_j|)} \\frac{{N \\choose m}{N-m \\choose |X_i|-m} {N-|X_i| \\choose |Y_j|-m}}{{N \\choose |X_i|}{N \\choose |Y_j|}}.\n\\end{equation}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E2.m1\" class=\"ltx_Math\" alttext=\"p\\text{-value}=\\sum_{m=m_{0}}^{\\min(|X_{i}|,|Y_{j}|)}\\frac{{N\\choose m}{N-m%&#10;\\choose|X_{i}|-m}{N-|X_{i}|\\choose|Y_{j}|-m}}{{N\\choose|X_{i}|}{N\\choose|Y_{j}%&#10;|}}.\" display=\"block\"><mrow><mrow><mrow><mi>p</mi><mo>\u2062</mo><mtext>-value</mtext></mrow><mo>=</mo><mrow><munderover><mo largeop=\"true\" movablelimits=\"false\" symmetric=\"true\">\u2211</mo><mrow><mi>m</mi><mo>=</mo><msub><mi>m</mi><mn>0</mn></msub></mrow><mrow><mi>min</mi><mo>\u2061</mo><mrow><mo stretchy=\"false\">(</mo><mrow><mo stretchy=\"false\">|</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy=\"false\">|</mo></mrow><mo>,</mo><mrow><mo stretchy=\"false\">|</mo><msub><mi>Y</mi><mi>j</mi></msub><mo stretchy=\"false\">|</mo></mrow><mo stretchy=\"false\">)</mo></mrow></mrow></munderover><mfrac><mrow><mrow><mo>(</mo><mfrac linethickness=\"0pt\"><mi>N</mi><mi>m</mi></mfrac><mo>)</mo></mrow><mo>\u2062</mo><mrow><mo>(</mo><mfrac linethickness=\"0pt\"><mrow><mi>N</mi><mo>-</mo><mi>m</mi></mrow><mrow><mrow><mo stretchy=\"false\">|</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy=\"false\">|</mo></mrow><mo>-</mo><mi>m</mi></mrow></mfrac><mo>)</mo></mrow><mo>\u2062</mo><mrow><mo>(</mo><mfrac linethickness=\"0pt\"><mrow><mi>N</mi><mo>-</mo><mrow><mo stretchy=\"false\">|</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy=\"false\">|</mo></mrow></mrow><mrow><mrow><mo stretchy=\"false\">|</mo><msub><mi>Y</mi><mi>j</mi></msub><mo stretchy=\"false\">|</mo></mrow><mo>-</mo><mi>m</mi></mrow></mfrac><mo>)</mo></mrow></mrow><mrow><mrow><mo>(</mo><mfrac linethickness=\"0pt\"><mi>N</mi><mrow><mo stretchy=\"false\">|</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy=\"false\">|</mo></mrow></mfrac><mo>)</mo></mrow><mo>\u2062</mo><mrow><mo>(</mo><mfrac linethickness=\"0pt\"><mi>N</mi><mrow><mo stretchy=\"false\">|</mo><msub><mi>Y</mi><mi>j</mi></msub><mo stretchy=\"false\">|</mo></mrow></mfrac><mo>)</mo></mrow></mrow></mfrac></mrow></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.05158.tex", "nexttext": "\n{\\textcolor{black}{{which describes transcriptome similarity of two biological samples. A larger TROM score represents greater similarity.}}}\n\n\n\n\n\n\n\n\\subsection{{\\textcolor{black}{{Selection of \\texorpdfstring{$z$}-score threshold}}}}\\label{secthre}\n\n\\begin{figure}[!tpb]\n\\centering\n\\includegraphics[width=0.9\\linewidth]{choosez.pdf}\n\\caption{Selection of {\\textcolor{black}{{$z$-score threshold}}} for \\emph{D. melanogaster}. \\textbf{A}: The indicator $u(z)$ of the power of different thresholds. The curve above the horizontal dashed line refers to the range $[\\text{mode}(u)-\\text{sd}(u), \\text{mode}(u)+\\text{sd}(u)]$ and the corresponding $z$ values of this part is considered as candidate thresholds. As a consequence, the selected threshold is $1.8$. \\textbf{B}: The change of TROM correspondence maps along with the change of thresholds. The corresponding threshold is marked above each heatmap.}\n\\label{zthre}\n\\end{figure}\n\nThe selection of {\\textcolor{black}{{the $z$-score threshold $z_0$}}} will directly influence the {\\textcolor{black}{{sensitivity and}}} specificity of sample-associated genes and thus {\\textcolor{black}{{affect}}} the resulting TROM scores. If {\\textcolor{black}{{$z_0$ is too small}}}, a large {\\textcolor{black}{{number of associated genes will be selected for every sample and more associated genes will be shared by {\\textcolor{black}{{different}}} samples, {\\textcolor{black}{{and thus it becomes}}} difficult to distinguish different biological samples. If $z_0$ is too large, only a small number of associated genes will}}} be identified for each sample and potentially informative genes could be filtered out, {\\textcolor{black}{{and thus no similarity of biological samples will be captured by TROM}}}. \nAlthough the selection of {\\textcolor{black}{{$z_0$}}} is {\\textcolor{black}{{ultimately subject to}}} {\\textcolor{black}{{users'}}} preference for the resulting correspondence maps {\\textcolor{black}{{(a larger $z_0$ for a sparser map or a smaller $z_0$ for a denser map)}}}, we propose an objective approach to choose {\\textcolor{black}{{an}}} appropriate threshold when no prior knowledge is available. Our approach aims at {\\textcolor{black}{{balancing}}} two goals: {\\textcolor{black}{{(1)}}} the threshold should {\\textcolor{black}{{help}}} minimize {\\textcolor{black}{{noisy correspondence of biological samples}}} and thus leads to {\\textcolor{black}{{a}}} sparse correspondence {\\textcolor{black}{{map}}}; {\\textcolor{black}{{(2)}}} the threshold should help preserve {\\textcolor{black}{{strong correspondence of samples}}} and thus leads to {\\textcolor{black}{{a}}} stable correspondence {\\textcolor{black}{{map}}}.\n\nWe use the mean of TROM scores {\\textcolor{black}{{of all pairwise {\\textcolor{black}{{comparisons of biological samples}}} in the correspondence map}}} as the {\\textcolor{black}{{objective function, which}}} is defined as\n\n", "itemtype": "equation", "pos": 10384, "prevtext": "\nThen we define the within-species or between-species TROM score as\n\n", "index": 5, "text": "\\begin{equation}\\label{eq3}\n\\text{TROM score} = -\\log_{10}(\\text{Bonferroni-corrected}\\ p\\text{-value}),\n\\end{equation}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E3.m1\" class=\"ltx_Math\" alttext=\"\\text{TROM score}=-\\log_{10}(\\text{Bonferroni-corrected}\\ p\\text{-value}),\" display=\"block\"><mrow><mrow><mtext>TROM score</mtext><mo>=</mo><mrow><mo>-</mo><mrow><msub><mi>log</mi><mn>10</mn></msub><mo>\u2061</mo><mrow><mo stretchy=\"false\">(</mo><mrow><mpadded width=\"+5pt\"><mtext>Bonferroni-corrected</mtext></mpadded><mo>\u2062</mo><mi>p</mi><mo>\u2062</mo><mtext>-value</mtext></mrow><mo stretchy=\"false\">)</mo></mrow></mrow></mrow></mrow><mo>,</mo></mrow></math>", "type": "latex"}, {"file": "1601.05158.tex", "nexttext": "\nwhere $k$ is the number of biological samples, {\\textcolor{black}{{$A(z)=\\left(a_{ij}(z)\\right)_{k\\times k}$}}} is the TROM {\\textcolor{black}{{score}}} matrix based on threshold $z_0=z$. \n\n{\\textcolor{black}{{We select the desirable threshold {\\textcolor{black}{{$z_0^*$}}} by the following approach. Considering our goal {\\textcolor{black}{{(2)}}}, we would like $u(z)$ to be stable for $z$ values near {\\textcolor{black}{{$z_0^*$}}}. Since similar $u(z)$ values would lead to a peak in the density of {\\textcolor{black}{{$u(z)$, denoted as $f(u)$,}}} we consider the $z$ values whose $u(z)$ are close to the peak, that is, $\\left\\{z: u(z) \\in \\left[\\text{mode}(u)-\\text{sd}(u), \\text{mode}(u)+\\text{sd}(u)\\right] \\right\\}$, where mode$(u) = \\arg\\max_u f(u)$ (i.e., the $u$ value that maximizes the density of $f(u)$ for $u = u(z)$ with $z \\in [-2,3]$) and sd$(u)$ is the standard deviation of $u(z)$ for $z \\in [-2,3]$). Also considering our goal (1), we would like to select $z_0^*$ as the largest $z$ value that {\\textcolor{black}{{leads to}}} the stable region of $u(z)$. Hence, we find $z_0^*$ as}}}\n\n", "itemtype": "equation", "pos": 13401, "prevtext": "\n{\\textcolor{black}{{which describes transcriptome similarity of two biological samples. A larger TROM score represents greater similarity.}}}\n\n\n\n\n\n\n\n\\subsection{{\\textcolor{black}{{Selection of \\texorpdfstring{$z$}-score threshold}}}}\\label{secthre}\n\n\\begin{figure}[!tpb]\n\\centering\n\\includegraphics[width=0.9\\linewidth]{choosez.pdf}\n\\caption{Selection of {\\textcolor{black}{{$z$-score threshold}}} for \\emph{D. melanogaster}. \\textbf{A}: The indicator $u(z)$ of the power of different thresholds. The curve above the horizontal dashed line refers to the range $[\\text{mode}(u)-\\text{sd}(u), \\text{mode}(u)+\\text{sd}(u)]$ and the corresponding $z$ values of this part is considered as candidate thresholds. As a consequence, the selected threshold is $1.8$. \\textbf{B}: The change of TROM correspondence maps along with the change of thresholds. The corresponding threshold is marked above each heatmap.}\n\\label{zthre}\n\\end{figure}\n\nThe selection of {\\textcolor{black}{{the $z$-score threshold $z_0$}}} will directly influence the {\\textcolor{black}{{sensitivity and}}} specificity of sample-associated genes and thus {\\textcolor{black}{{affect}}} the resulting TROM scores. If {\\textcolor{black}{{$z_0$ is too small}}}, a large {\\textcolor{black}{{number of associated genes will be selected for every sample and more associated genes will be shared by {\\textcolor{black}{{different}}} samples, {\\textcolor{black}{{and thus it becomes}}} difficult to distinguish different biological samples. If $z_0$ is too large, only a small number of associated genes will}}} be identified for each sample and potentially informative genes could be filtered out, {\\textcolor{black}{{and thus no similarity of biological samples will be captured by TROM}}}. \nAlthough the selection of {\\textcolor{black}{{$z_0$}}} is {\\textcolor{black}{{ultimately subject to}}} {\\textcolor{black}{{users'}}} preference for the resulting correspondence maps {\\textcolor{black}{{(a larger $z_0$ for a sparser map or a smaller $z_0$ for a denser map)}}}, we propose an objective approach to choose {\\textcolor{black}{{an}}} appropriate threshold when no prior knowledge is available. Our approach aims at {\\textcolor{black}{{balancing}}} two goals: {\\textcolor{black}{{(1)}}} the threshold should {\\textcolor{black}{{help}}} minimize {\\textcolor{black}{{noisy correspondence of biological samples}}} and thus leads to {\\textcolor{black}{{a}}} sparse correspondence {\\textcolor{black}{{map}}}; {\\textcolor{black}{{(2)}}} the threshold should help preserve {\\textcolor{black}{{strong correspondence of samples}}} and thus leads to {\\textcolor{black}{{a}}} stable correspondence {\\textcolor{black}{{map}}}.\n\nWe use the mean of TROM scores {\\textcolor{black}{{of all pairwise {\\textcolor{black}{{comparisons of biological samples}}} in the correspondence map}}} as the {\\textcolor{black}{{objective function, which}}} is defined as\n\n", "index": 7, "text": "\\begin{equation}\\label{eq4}\n{\\textcolor{black}{{  u(z)=\\log_{10}\\left(\\frac{\\sum^k_{i=1}\\sum^k_{j=1, j\\neq i}a_{ij}(z)}{k^2-k} + 1\\right) }}}\n\\end{equation}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E4.m1\" class=\"ltx_Math\" alttext=\"{{\\color[rgb]{0,0,0}{u(z)=\\log_{10}\\left(\\frac{\\sum^{k}_{i=1}\\sum^{k}_{j=1,j%&#10;\\neq i}a_{ij}(z)}{k^{2}-k}+1\\right)}}}\" display=\"block\"><mrow><mrow><mi mathcolor=\"#000000\">u</mi><mo mathcolor=\"#000000\">\u2062</mo><mrow><mo mathcolor=\"#000000\" stretchy=\"false\">(</mo><mi mathcolor=\"#000000\">z</mi><mo mathcolor=\"#000000\" stretchy=\"false\">)</mo></mrow></mrow><mo mathcolor=\"#000000\">=</mo><mrow><msub><mi mathcolor=\"#000000\">log</mi><mn mathcolor=\"#000000\">10</mn></msub><mo mathcolor=\"#000000\">\u2061</mo><mrow><mo mathcolor=\"#000000\">(</mo><mrow><mfrac mathcolor=\"#000000\"><mrow><msubsup><mo largeop=\"true\" mathcolor=\"#000000\" symmetric=\"true\">\u2211</mo><mrow><mi mathcolor=\"#000000\">i</mi><mo mathcolor=\"#000000\">=</mo><mn mathcolor=\"#000000\">1</mn></mrow><mi mathcolor=\"#000000\">k</mi></msubsup><mrow><msubsup><mo largeop=\"true\" mathcolor=\"#000000\" symmetric=\"true\">\u2211</mo><mrow><mrow><mi mathcolor=\"#000000\">j</mi><mo mathcolor=\"#000000\">=</mo><mn mathcolor=\"#000000\">1</mn></mrow><mo mathcolor=\"#000000\">,</mo><mrow><mi mathcolor=\"#000000\">j</mi><mo mathcolor=\"#000000\">\u2260</mo><mi mathcolor=\"#000000\">i</mi></mrow></mrow><mi mathcolor=\"#000000\">k</mi></msubsup><mrow><msub><mi mathcolor=\"#000000\">a</mi><mrow><mi mathcolor=\"#000000\">i</mi><mo mathcolor=\"#000000\">\u2062</mo><mi mathcolor=\"#000000\">j</mi></mrow></msub><mo mathcolor=\"#000000\">\u2062</mo><mrow><mo mathcolor=\"#000000\" stretchy=\"false\">(</mo><mi mathcolor=\"#000000\">z</mi><mo mathcolor=\"#000000\" stretchy=\"false\">)</mo></mrow></mrow></mrow></mrow><mrow><msup><mi mathcolor=\"#000000\">k</mi><mn mathcolor=\"#000000\">2</mn></msup><mo mathcolor=\"#000000\">-</mo><mi mathcolor=\"#000000\">k</mi></mrow></mfrac><mo mathcolor=\"#000000\">+</mo><mn mathcolor=\"#000000\">1</mn></mrow><mo mathcolor=\"#000000\">)</mo></mrow></mrow></mrow></math>", "type": "latex"}, {"file": "1601.05158.tex", "nexttext": "\nwhere $u = u(z) \\text{ for } z \\in [-2,3]$\n\nWe list the selected thresholds {\\textcolor{black}{{of various species}}} by this approach in Appendix Table \\ref{tab:z_thre}. We demonstrate how this approach can select an appropriate threshold for comparing \\emph{D. melanogaster} developmental stages by applying it to the RNA-seq data of $k=30$ stages. We consider candidate thresholds in the range of $z \\in [-2, 3]$ and calculate TROM matrices for all the candidate values in this range with a step size of $0.1$. The corresponding $u(z)$ is plotted in Figure \\ref{zthre}A. \n\n\n{\\textcolor{black}{{ As shown in Lemma ~\\ref{lemma1}, an important feature of $u(z)$ is that it approaches $0$ when the absolute value of $z$ is large. This is because the entire gene population will be selected as associated genes when threshold $z$ is small enough while no genes will be selected when $z$ is large enough. In both extreme cases, the resulting TROM score is $0$ for any pair of samples. Because of this feature and the non-negativity of $u(z)$, $u(z)$ must have a mode at a certain value of $z$. The observed unimodal shape is a typical feature of $u(z)$ for the various species we have investigated. }}}\n\n\\begin{lemma}\\label{lemma1}\n\t$u(z) \\rightarrow 0$ as $|z| \\rightarrow \\infty$.\n\\end{lemma}\n\\begin{proof}\n\\small\nBecause of the criterion of selecting associated genes: $z$-scores $\\ge z$, for within-species comparison between samples $i$ and $j$, whose sets of associated genes are denoted as $X_i$ and $X_j$, we have\n\\begin{itemize}\n\\item as $z \\rightarrow -\\infty$, $|X_i| \\rightarrow N$, $|X_j| \\rightarrow N$, and $|X_i \\cap X_j| \\rightarrow N$, where $N$ is the number of all genes of the species;\n\\item as $z \\rightarrow \\infty$, $|X_i| \\rightarrow 0$, $|X_j| \\rightarrow 0$, and $|X_i \\cap X_j| \\rightarrow 0$.\n\\end{itemize}\nGiven the $p$-value formula (Equation~(\\ref{eq1})) of the within-species overlap test in TROM, we have\n\\begin{itemize}\n\\item as  $|X_i| \\rightarrow N$, $|X_j| \\rightarrow N$, and $|X_i \\cap X_j| \\rightarrow N$, $p$-value $\\rightarrow 1$;\n\\item as $|X_i| \\rightarrow 0$, $|X_j| \\rightarrow 0$, and $|X_i \\cap X_j| \\rightarrow 0$, $p$-value $\\rightarrow 1$.\n\\end{itemize}\n\nFor between-species comparison between samples $i$ from species 1 and sample $j$ from species 2, whose associated genes correspond to ortholog pairs denoted as $X_i$ and $Y_j$, and between $X_i$ and $Y_j$ there are $m_0$ ortholog pairs, we have\n\\begin{itemize}\n\\item as $z \\rightarrow -\\infty$, $|X_i| \\rightarrow N$, $|Y_j| \\rightarrow N$, and $m_0 \\rightarrow N$, where $N$ is the total number of ortholog pairs between the two species;\n\\item as $z \\rightarrow \\infty$, $|X_i| \\rightarrow 0$, $|Y_j| \\rightarrow 0$, and $m_0 \\rightarrow 0$.\n\\end{itemize}\nGiven the $p$-value formula (Equation~(\\ref{eq2})) of the between-species overlap test in TROM, we have\n\\begin{itemize}\n\\item as $|X_i| \\rightarrow N$, $|Y_j| \\rightarrow N$, and $m_0 \\rightarrow N$, $p$-value $\\rightarrow 1$;\n\\item as $|X_i| \\rightarrow 0$, $|Y_j| \\rightarrow 0$, and $m_0 \\rightarrow 0$, $p$-value $\\rightarrow 1$.\n\\end{itemize}\n\nSo for both within-species and between-species comparisons, we have TROM score $a_{ij}(z) \\rightarrow 0$ as $|z| \\rightarrow \\infty$ given Equation~(\\ref{eq3}).\n\nHence, given the definition of $u(z)$ in Equation~(\\ref{eq4}), we have $u(z) \\rightarrow 0$ as $|z| \\rightarrow \\infty$.\n\\end{proof}\n\n\nOur selection approach finds $z_0 = 1.8$, which is on the right margin of $z \\in [0,2]$, an interval corresponding to stable values of $u(z)$. Figure \\ref{zthre}B shows how the selection of $z_0$ can influence the patterns of correspondence maps. When the threshold is too low (e.g., $-0.4$), many stage pairs are mapped to each other, {\\textcolor{black}{{providing}}} vague information on the relationships of different stages. On the other hand, when the threshold is too high (e.g., $2.6$), {\\textcolor{black}{{so}}} much information is filtered out that most stages are only mapped to themselves, and important correspondence such as the {\\textcolor{black}{{similarity}}} between fly early embryos and female adults is missing \\cite{Li2014}. {\\textcolor{black}{{Unlike the two extremes}}}, our selected threshold $1.8$ {\\textcolor{black}{{reveals}}} important correspondence patterns and {\\textcolor{black}{{meanwhile yields}}} a clean correspondence map. \n\n{\\textcolor{black}{{For all the results in the following sections, the TROM method uses default $z$-score thresholds selected by this approach unless otherwise specified.}}}\n\n\n\n\n\\section{Results}\n\n\n\n\n\\subsection {Application of TROM to finding correspondence of developmental stages of multiple species}\\label{sec:TROM scores}\n\n\\begin{figure}[!tb]\n\\centering\n\\includegraphics[width=0.75\\linewidth]{TROM_map.pdf}\n\\caption{Within-species and between-species correspondence maps of TROM scores. For better illustration, TROM scores are saturated at $6$: all the scores larger than $6$ are set to $6$. \\textbf{A}: pairwise within-species TROM scores calculated for the $14$ stages of mouse liver; \\textbf{B}: pairwise within-species TROM scores calculated for the $10$ stages of sea urchin; \\textbf{C}: pairwise within-species TROM scores calculated for the $10$ stages of \\emph{D. melanogaster}. The column stages {\\textcolor{black}{{are from}}} the microarray data, {\\textcolor{black}{{and}}} the row stages {\\textcolor{black}{{are from}}} the RNA-seq data; \\textbf{D}: pairwise between-species TROM scores of \\emph{D. melanogaster} vs. mouse liver. The columns represent the $14$ mouse stages, {\\textcolor{black}{{and}}} the rows represent the $30$ fly stages.}\n\\label{TROM_map}\n\\end{figure}\n\n\n{\\textcolor{black}{{We first demonstrate the use and the performance of TROM in comparative transcriptomics.}}} We apply TROM to find correspondence patterns of developmental stages of six \\textit{Drosophila} (fly) species, \\textit{C. elegans} (worm), \\textit{S. purpuratus} (sea urchin), \\textit{D. rerio} (zebrafish) and {\\textcolor{black}{{mouse}}} liver tissues. The goal is to find similarity of developmental stages within and between species in terms of gene expression dynamics. We use multiple datasets including RNA-seq data of $30$ \\textit{D. melanogaster} developmental stages with expression estimates of $15,095$ genes, RNA-seq data of $35$ \\emph{C. elegans} stages with $31,622$ genes \\cite{gerstein2014comparative,Li2014}, RNA-seq data of $10$ sea urchin stages with $21,090$ genes \\cite{tu2014quantitative}, microarray data of six fly species: \\emph{D. melanogaster, D. simulans, D. ananassae, D. persimilis, D. pseudoobscura} and \\emph{D. virilis} with $9$ to $13$ embryonic stages and $3,663$ genes \\cite{Arbeitman2002}, microarray data of mouse liver development with $14$ stages and $45,101$ genes \\cite{li2009multi} \nand microarray data of \\textit{D. rerio} with $61$ stages and {\\textcolor{black}{{$18,259$}}} genes \\cite{domazet2010phylogenetically}. A detailed description of these datasets is given in Appendix Table \\ref{stage_label}.\n\n\n\nIn the comparison of developmental stages within each species, the TROM method finds {\\textcolor{black}{{block}}} diagonal correspondence patterns as expected. That is, in every species, adjacent developmental stages close to each other in the time order have high TROM scores. We illustrate the correspondence maps of developmental stages of mouse liver (Figure~\\ref{TROM_map}A), sea urchin (Figure~\\ref{TROM_map}B) \n\nand the six \\textit{Drosophila} species (Appendix Figure \\ref{TROM_scores}). These results provide strong support to the efficacy and validity of TROM in finding transcriptomic similarity of biological samples, in addition to our previous results on {\\textcolor{black}{{the}}} correspondence of \\textit{D. melanogaster} and \\textit{C. elegans} stages based on RNA-seq data \\cite{Li2014}, {\\textcolor{black}{{to which}}} we applied the preliminary idea of TROM.\n\n\n\nWe also apply TROM to compare the developmental stages of two different species. {\\textcolor{black}{{We use ortholog information downloaded from Ensembl \\cite{cunningham2015ensembl} in the comparison}}}. Since fly, worm and mouse are vastly distant from each other in evolution, any correspondence between their developmental stages revealed by TROM will be interesting and may imply conserved developmental programs. Between \\textit{D. melanogaster} life cycle and mouse liver development (Figure~\\ref{TROM_map}D), TROM finds unknown correspondence between fly early embryos and {\\textcolor{black}{{mouse embryo liver tissues}}}, and between fly female adults and {\\textcolor{black}{{mouse embryo liver tissues}}}. A {\\textcolor{black}{{main}}} reason for the latter correspondence is the transcriptomic similarity of fly early embryos and female adults due to the expression of maternal effect genes \\cite{Li2014}. Additionally, there is some irregular correspondence between fly larvae and liver {\\textcolor{black}{{tissues of}}} born mice. We can see a clear separation of {\\textcolor{black}{{the liver tissues of}}} mouse embryos and born mice, {\\textcolor{black}{{and their}}} corresponding fly stages also exhibit a separation of embryos and female adults from other stages. These results {\\textcolor{black}{{indicate}}} that even for vastly different species such as fly and mouse, there is good conservation in their embryonic development. Similarly between the six \\textit{Drosophila} species' embryonic development and mouse liver development, we also see good correspondence of fly early embryos and {\\textcolor{black}{{mouse embryo liver tissues}}}, and correspondence between fly late embryos and {\\textcolor{black}{{mouse adult liver tissues}}} (Appendix Figure \\ref{TROM_scores}). Moreover, {\\textcolor{black}{{mouse embryo liver tissues are}}} observed to correspond well with worm embryos, {\\textcolor{black}{{and this is consistent with the observed correspondence between fly embryos and worm embryos (Appendix Figure \\ref{TROM_scores})}}}.  These consistent correspondence patterns together validate the efficacy of the TROM approach. \n\n\nBetween the six \\textit{Drosophila} species, since they are known to have similar developmental programs \\cite{Arbeitman2002}, comparisons of their developmental stages {\\textcolor{black}{{resemble}}} within-species comparisons, and {\\textcolor{black}{{block}}} diagonal correspondence patterns {\\textcolor{black}{{are}}} expected. Our results confirm this{\\textcolor{black}{{: d}}}iagonal patterns are observed between the developmental stages of every two fly species (Appendix Figure \\ref{TROM_scores}). These results again demonstrate the validity of TROM. \n\n\n\n\n\n\n\n\n\\subsection{Comparison between TROM and {\\textcolor{black}{{Pearson/Spearman}}} correlation measures}\n\n{\\textcolor{black}{{We next describe the problem setting where TROM serves as a better method than Pearson/Spearman correlation measures.}}} A key difference between the TROM method and {\\textcolor{black}{{the}}} Pearson/Spearman correlation analysis is that TROM divides genes into two sets (associated genes and non-associated genes) for every sample based on gene expression dynamics across all samples{\\textcolor{black}{{, and after}}} the division the TROM score calculation does not rely on actual gene expression measurements. {\\textcolor{black}{{Hence, TROM defines similarity of transcriptomes based on the overlap of their associated genes.}}} In contrast to TROM, Pearson and Spearman correlations are calculated based on actual expression measurements of the same set of genes in two samples. Hence, they are more sensitive to expression fluctuations of lowly expressed genes {\\textcolor{black}{{due to measurement errors, and their values can be driven high by the genes that have approximately constant expression across samples and carry little information on sample characteristics (e.g. housekeeping genes). For our goal of constructing a clear sample correspondence map in terms of gene expression, Pearson and Spearman correlation measures are usually unsatisfactory, as they often give rise to noisy correspondence maps (Appendix Figures \\ref{outline}, \\ref{cor_associated}).}}}\n\nTo demonstrate the power of TROM in detecting the correspondence of biological samples that share transcriptomic characteristics in {\\textcolor{black}{{highly expressed genes}}}, we conduct a simulation study to compare TROM and correlation measures. In the design of this simulation, we\n{\\textcolor{black}{{ focus on the pairwise comparison between biological samples and set the null hypothesis as that \\textit{two samples have associated genes independently drawn from the gene population}. The alternative hypothesis is that \\textit{the two samples share the same set of associated genes}. }}} \nWe simulate $1000$ sets of gene expression matrices under each hypothesis and compare the statistical power (the probability of rejecting the null hypothesis when the alternative is true) of the three measures: TROM, Pearson correlation and Spearman correlation, at $0.05$ significance level (the probability of rejecting the null hypothesis when it is true). \n\n\\begin{figure}[!tb]\n\\centering\n\\includegraphics[width=1\\linewidth]{simulation.pdf}\n\\caption{\\textbf{A}: {\\textcolor{black}{{The left (right) panel demonstrates a typical scatterplot of the gene expression in two biological samples generated under the null (alternative) hypothesis, with $n=2000$ and $d=1.9$. In both panels, the $x$ axis represents the $\\log_{10}$ of gene expression in sample 1 while the $y$ axis represents the $\\log_{10}$ of gene expression in sample 2. Orange or green points are genes only associated with sample 1 or 2; black points are associated genes shared by sample 1 and 2; gray points are genes not associated with any samples.}}}\n\\textbf{B}: The power of the three measures: TROM, Pearson correlation and Spearman correlation under different simulation settings. It can be observed that TROM is able to achieve a power of $1$ in all the cases.}\n\\label{simulation}\n\\end{figure}\n\n\n\nSuppose a given species has a total number of $N$ genes. \nLet $\\bm X_j = (X_{1j}, \\ldots, X_{Nj})^T$, $(j=1,2)$ denote the expression vector of the $N$ genes in sample $j$. Let $\\bm I_j = (I_{1j}, \\ldots, I_{Nj})^T, \\ (j=1,2)$ be the indicator vector denoting whether each of the $N$ genes is an associated gene of sample $j$: $I_{ij}=1$ if gene $i$ is an associated gene of sample $j$ and $I_{ij}=0$ if gene $i$ is a non-associated gene of sample $j$. We assume that the expression values of associated genes follow a probability distribution $f_1$ while the expression values of non-associated genes follow a different distribution $f_0$:\n\n", "itemtype": "equation", "pos": 14665, "prevtext": "\nwhere $k$ is the number of biological samples, {\\textcolor{black}{{$A(z)=\\left(a_{ij}(z)\\right)_{k\\times k}$}}} is the TROM {\\textcolor{black}{{score}}} matrix based on threshold $z_0=z$. \n\n{\\textcolor{black}{{We select the desirable threshold {\\textcolor{black}{{$z_0^*$}}} by the following approach. Considering our goal {\\textcolor{black}{{(2)}}}, we would like $u(z)$ to be stable for $z$ values near {\\textcolor{black}{{$z_0^*$}}}. Since similar $u(z)$ values would lead to a peak in the density of {\\textcolor{black}{{$u(z)$, denoted as $f(u)$,}}} we consider the $z$ values whose $u(z)$ are close to the peak, that is, $\\left\\{z: u(z) \\in \\left[\\text{mode}(u)-\\text{sd}(u), \\text{mode}(u)+\\text{sd}(u)\\right] \\right\\}$, where mode$(u) = \\arg\\max_u f(u)$ (i.e., the $u$ value that maximizes the density of $f(u)$ for $u = u(z)$ with $z \\in [-2,3]$) and sd$(u)$ is the standard deviation of $u(z)$ for $z \\in [-2,3]$). Also considering our goal (1), we would like to select $z_0^*$ as the largest $z$ value that {\\textcolor{black}{{leads to}}} the stable region of $u(z)$. Hence, we find $z_0^*$ as}}}\n\n", "index": 9, "text": "\\begin{equation}\nz_0^* = \\max\\left\\{z: u(z) \\in \\left[\\text{mode}(u)-\\text{sd}(u), \\text{mode}(u)+\\text{sd}(u)\\right] \\right\\}~, \n\n\\end{equation}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E5.m1\" class=\"ltx_Math\" alttext=\"z_{0}^{*}=\\max\\left\\{z:u(z)\\in\\left[\\text{mode}(u)-\\text{sd}(u),\\text{mode}(u)%&#10;+\\text{sd}(u)\\right]\\right\\}~{},\\par&#10;\" display=\"block\"><mrow><mrow><msubsup><mi>z</mi><mn>0</mn><mo>*</mo></msubsup><mo>=</mo><mrow><mi>max</mi><mo>\u2061</mo><mrow><mo>{</mo><mrow><mi>z</mi><mo>:</mo><mrow><mrow><mi>u</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>z</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2208</mo><mrow><mo>[</mo><mrow><mrow><mtext>mode</mtext><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>u</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>-</mo><mrow><mtext>sd</mtext><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>u</mi><mo stretchy=\"false\">)</mo></mrow></mrow></mrow><mo>,</mo><mrow><mrow><mtext>mode</mtext><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>u</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>+</mo><mrow><mtext>sd</mtext><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>u</mi><mo stretchy=\"false\">)</mo></mrow></mrow></mrow><mo>]</mo></mrow></mrow></mrow><mo rspace=\"5.8pt\">}</mo></mrow></mrow></mrow><mo>,</mo></mrow></math>", "type": "latex"}, {"file": "1601.05158.tex", "nexttext": "\nIn this simple simulation setting, we assume that $X_{ij} | I_{ij}$ $(i=1,\\ldots,N; j=1,2)$ are independent. \n\n\n{\\textcolor{black}{{ The null hypothesis states that the two samples have independent associated genes: \n", "itemtype": "equation", "pos": 29466, "prevtext": "\nwhere $u = u(z) \\text{ for } z \\in [-2,3]$\n\nWe list the selected thresholds {\\textcolor{black}{{of various species}}} by this approach in Appendix Table \\ref{tab:z_thre}. We demonstrate how this approach can select an appropriate threshold for comparing \\emph{D. melanogaster} developmental stages by applying it to the RNA-seq data of $k=30$ stages. We consider candidate thresholds in the range of $z \\in [-2, 3]$ and calculate TROM matrices for all the candidate values in this range with a step size of $0.1$. The corresponding $u(z)$ is plotted in Figure \\ref{zthre}A. \n\n\n{\\textcolor{black}{{ As shown in Lemma ~\\ref{lemma1}, an important feature of $u(z)$ is that it approaches $0$ when the absolute value of $z$ is large. This is because the entire gene population will be selected as associated genes when threshold $z$ is small enough while no genes will be selected when $z$ is large enough. In both extreme cases, the resulting TROM score is $0$ for any pair of samples. Because of this feature and the non-negativity of $u(z)$, $u(z)$ must have a mode at a certain value of $z$. The observed unimodal shape is a typical feature of $u(z)$ for the various species we have investigated. }}}\n\n\\begin{lemma}\\label{lemma1}\n\t$u(z) \\rightarrow 0$ as $|z| \\rightarrow \\infty$.\n\\end{lemma}\n\\begin{proof}\n\\small\nBecause of the criterion of selecting associated genes: $z$-scores $\\ge z$, for within-species comparison between samples $i$ and $j$, whose sets of associated genes are denoted as $X_i$ and $X_j$, we have\n\\begin{itemize}\n\\item as $z \\rightarrow -\\infty$, $|X_i| \\rightarrow N$, $|X_j| \\rightarrow N$, and $|X_i \\cap X_j| \\rightarrow N$, where $N$ is the number of all genes of the species;\n\\item as $z \\rightarrow \\infty$, $|X_i| \\rightarrow 0$, $|X_j| \\rightarrow 0$, and $|X_i \\cap X_j| \\rightarrow 0$.\n\\end{itemize}\nGiven the $p$-value formula (Equation~(\\ref{eq1})) of the within-species overlap test in TROM, we have\n\\begin{itemize}\n\\item as  $|X_i| \\rightarrow N$, $|X_j| \\rightarrow N$, and $|X_i \\cap X_j| \\rightarrow N$, $p$-value $\\rightarrow 1$;\n\\item as $|X_i| \\rightarrow 0$, $|X_j| \\rightarrow 0$, and $|X_i \\cap X_j| \\rightarrow 0$, $p$-value $\\rightarrow 1$.\n\\end{itemize}\n\nFor between-species comparison between samples $i$ from species 1 and sample $j$ from species 2, whose associated genes correspond to ortholog pairs denoted as $X_i$ and $Y_j$, and between $X_i$ and $Y_j$ there are $m_0$ ortholog pairs, we have\n\\begin{itemize}\n\\item as $z \\rightarrow -\\infty$, $|X_i| \\rightarrow N$, $|Y_j| \\rightarrow N$, and $m_0 \\rightarrow N$, where $N$ is the total number of ortholog pairs between the two species;\n\\item as $z \\rightarrow \\infty$, $|X_i| \\rightarrow 0$, $|Y_j| \\rightarrow 0$, and $m_0 \\rightarrow 0$.\n\\end{itemize}\nGiven the $p$-value formula (Equation~(\\ref{eq2})) of the between-species overlap test in TROM, we have\n\\begin{itemize}\n\\item as $|X_i| \\rightarrow N$, $|Y_j| \\rightarrow N$, and $m_0 \\rightarrow N$, $p$-value $\\rightarrow 1$;\n\\item as $|X_i| \\rightarrow 0$, $|Y_j| \\rightarrow 0$, and $m_0 \\rightarrow 0$, $p$-value $\\rightarrow 1$.\n\\end{itemize}\n\nSo for both within-species and between-species comparisons, we have TROM score $a_{ij}(z) \\rightarrow 0$ as $|z| \\rightarrow \\infty$ given Equation~(\\ref{eq3}).\n\nHence, given the definition of $u(z)$ in Equation~(\\ref{eq4}), we have $u(z) \\rightarrow 0$ as $|z| \\rightarrow \\infty$.\n\\end{proof}\n\n\nOur selection approach finds $z_0 = 1.8$, which is on the right margin of $z \\in [0,2]$, an interval corresponding to stable values of $u(z)$. Figure \\ref{zthre}B shows how the selection of $z_0$ can influence the patterns of correspondence maps. When the threshold is too low (e.g., $-0.4$), many stage pairs are mapped to each other, {\\textcolor{black}{{providing}}} vague information on the relationships of different stages. On the other hand, when the threshold is too high (e.g., $2.6$), {\\textcolor{black}{{so}}} much information is filtered out that most stages are only mapped to themselves, and important correspondence such as the {\\textcolor{black}{{similarity}}} between fly early embryos and female adults is missing \\cite{Li2014}. {\\textcolor{black}{{Unlike the two extremes}}}, our selected threshold $1.8$ {\\textcolor{black}{{reveals}}} important correspondence patterns and {\\textcolor{black}{{meanwhile yields}}} a clean correspondence map. \n\n{\\textcolor{black}{{For all the results in the following sections, the TROM method uses default $z$-score thresholds selected by this approach unless otherwise specified.}}}\n\n\n\n\n\\section{Results}\n\n\n\n\n\\subsection {Application of TROM to finding correspondence of developmental stages of multiple species}\\label{sec:TROM scores}\n\n\\begin{figure}[!tb]\n\\centering\n\\includegraphics[width=0.75\\linewidth]{TROM_map.pdf}\n\\caption{Within-species and between-species correspondence maps of TROM scores. For better illustration, TROM scores are saturated at $6$: all the scores larger than $6$ are set to $6$. \\textbf{A}: pairwise within-species TROM scores calculated for the $14$ stages of mouse liver; \\textbf{B}: pairwise within-species TROM scores calculated for the $10$ stages of sea urchin; \\textbf{C}: pairwise within-species TROM scores calculated for the $10$ stages of \\emph{D. melanogaster}. The column stages {\\textcolor{black}{{are from}}} the microarray data, {\\textcolor{black}{{and}}} the row stages {\\textcolor{black}{{are from}}} the RNA-seq data; \\textbf{D}: pairwise between-species TROM scores of \\emph{D. melanogaster} vs. mouse liver. The columns represent the $14$ mouse stages, {\\textcolor{black}{{and}}} the rows represent the $30$ fly stages.}\n\\label{TROM_map}\n\\end{figure}\n\n\n{\\textcolor{black}{{We first demonstrate the use and the performance of TROM in comparative transcriptomics.}}} We apply TROM to find correspondence patterns of developmental stages of six \\textit{Drosophila} (fly) species, \\textit{C. elegans} (worm), \\textit{S. purpuratus} (sea urchin), \\textit{D. rerio} (zebrafish) and {\\textcolor{black}{{mouse}}} liver tissues. The goal is to find similarity of developmental stages within and between species in terms of gene expression dynamics. We use multiple datasets including RNA-seq data of $30$ \\textit{D. melanogaster} developmental stages with expression estimates of $15,095$ genes, RNA-seq data of $35$ \\emph{C. elegans} stages with $31,622$ genes \\cite{gerstein2014comparative,Li2014}, RNA-seq data of $10$ sea urchin stages with $21,090$ genes \\cite{tu2014quantitative}, microarray data of six fly species: \\emph{D. melanogaster, D. simulans, D. ananassae, D. persimilis, D. pseudoobscura} and \\emph{D. virilis} with $9$ to $13$ embryonic stages and $3,663$ genes \\cite{Arbeitman2002}, microarray data of mouse liver development with $14$ stages and $45,101$ genes \\cite{li2009multi} \nand microarray data of \\textit{D. rerio} with $61$ stages and {\\textcolor{black}{{$18,259$}}} genes \\cite{domazet2010phylogenetically}. A detailed description of these datasets is given in Appendix Table \\ref{stage_label}.\n\n\n\nIn the comparison of developmental stages within each species, the TROM method finds {\\textcolor{black}{{block}}} diagonal correspondence patterns as expected. That is, in every species, adjacent developmental stages close to each other in the time order have high TROM scores. We illustrate the correspondence maps of developmental stages of mouse liver (Figure~\\ref{TROM_map}A), sea urchin (Figure~\\ref{TROM_map}B) \n\nand the six \\textit{Drosophila} species (Appendix Figure \\ref{TROM_scores}). These results provide strong support to the efficacy and validity of TROM in finding transcriptomic similarity of biological samples, in addition to our previous results on {\\textcolor{black}{{the}}} correspondence of \\textit{D. melanogaster} and \\textit{C. elegans} stages based on RNA-seq data \\cite{Li2014}, {\\textcolor{black}{{to which}}} we applied the preliminary idea of TROM.\n\n\n\nWe also apply TROM to compare the developmental stages of two different species. {\\textcolor{black}{{We use ortholog information downloaded from Ensembl \\cite{cunningham2015ensembl} in the comparison}}}. Since fly, worm and mouse are vastly distant from each other in evolution, any correspondence between their developmental stages revealed by TROM will be interesting and may imply conserved developmental programs. Between \\textit{D. melanogaster} life cycle and mouse liver development (Figure~\\ref{TROM_map}D), TROM finds unknown correspondence between fly early embryos and {\\textcolor{black}{{mouse embryo liver tissues}}}, and between fly female adults and {\\textcolor{black}{{mouse embryo liver tissues}}}. A {\\textcolor{black}{{main}}} reason for the latter correspondence is the transcriptomic similarity of fly early embryos and female adults due to the expression of maternal effect genes \\cite{Li2014}. Additionally, there is some irregular correspondence between fly larvae and liver {\\textcolor{black}{{tissues of}}} born mice. We can see a clear separation of {\\textcolor{black}{{the liver tissues of}}} mouse embryos and born mice, {\\textcolor{black}{{and their}}} corresponding fly stages also exhibit a separation of embryos and female adults from other stages. These results {\\textcolor{black}{{indicate}}} that even for vastly different species such as fly and mouse, there is good conservation in their embryonic development. Similarly between the six \\textit{Drosophila} species' embryonic development and mouse liver development, we also see good correspondence of fly early embryos and {\\textcolor{black}{{mouse embryo liver tissues}}}, and correspondence between fly late embryos and {\\textcolor{black}{{mouse adult liver tissues}}} (Appendix Figure \\ref{TROM_scores}). Moreover, {\\textcolor{black}{{mouse embryo liver tissues are}}} observed to correspond well with worm embryos, {\\textcolor{black}{{and this is consistent with the observed correspondence between fly embryos and worm embryos (Appendix Figure \\ref{TROM_scores})}}}.  These consistent correspondence patterns together validate the efficacy of the TROM approach. \n\n\nBetween the six \\textit{Drosophila} species, since they are known to have similar developmental programs \\cite{Arbeitman2002}, comparisons of their developmental stages {\\textcolor{black}{{resemble}}} within-species comparisons, and {\\textcolor{black}{{block}}} diagonal correspondence patterns {\\textcolor{black}{{are}}} expected. Our results confirm this{\\textcolor{black}{{: d}}}iagonal patterns are observed between the developmental stages of every two fly species (Appendix Figure \\ref{TROM_scores}). These results again demonstrate the validity of TROM. \n\n\n\n\n\n\n\n\n\\subsection{Comparison between TROM and {\\textcolor{black}{{Pearson/Spearman}}} correlation measures}\n\n{\\textcolor{black}{{We next describe the problem setting where TROM serves as a better method than Pearson/Spearman correlation measures.}}} A key difference between the TROM method and {\\textcolor{black}{{the}}} Pearson/Spearman correlation analysis is that TROM divides genes into two sets (associated genes and non-associated genes) for every sample based on gene expression dynamics across all samples{\\textcolor{black}{{, and after}}} the division the TROM score calculation does not rely on actual gene expression measurements. {\\textcolor{black}{{Hence, TROM defines similarity of transcriptomes based on the overlap of their associated genes.}}} In contrast to TROM, Pearson and Spearman correlations are calculated based on actual expression measurements of the same set of genes in two samples. Hence, they are more sensitive to expression fluctuations of lowly expressed genes {\\textcolor{black}{{due to measurement errors, and their values can be driven high by the genes that have approximately constant expression across samples and carry little information on sample characteristics (e.g. housekeeping genes). For our goal of constructing a clear sample correspondence map in terms of gene expression, Pearson and Spearman correlation measures are usually unsatisfactory, as they often give rise to noisy correspondence maps (Appendix Figures \\ref{outline}, \\ref{cor_associated}).}}}\n\nTo demonstrate the power of TROM in detecting the correspondence of biological samples that share transcriptomic characteristics in {\\textcolor{black}{{highly expressed genes}}}, we conduct a simulation study to compare TROM and correlation measures. In the design of this simulation, we\n{\\textcolor{black}{{ focus on the pairwise comparison between biological samples and set the null hypothesis as that \\textit{two samples have associated genes independently drawn from the gene population}. The alternative hypothesis is that \\textit{the two samples share the same set of associated genes}. }}} \nWe simulate $1000$ sets of gene expression matrices under each hypothesis and compare the statistical power (the probability of rejecting the null hypothesis when the alternative is true) of the three measures: TROM, Pearson correlation and Spearman correlation, at $0.05$ significance level (the probability of rejecting the null hypothesis when it is true). \n\n\\begin{figure}[!tb]\n\\centering\n\\includegraphics[width=1\\linewidth]{simulation.pdf}\n\\caption{\\textbf{A}: {\\textcolor{black}{{The left (right) panel demonstrates a typical scatterplot of the gene expression in two biological samples generated under the null (alternative) hypothesis, with $n=2000$ and $d=1.9$. In both panels, the $x$ axis represents the $\\log_{10}$ of gene expression in sample 1 while the $y$ axis represents the $\\log_{10}$ of gene expression in sample 2. Orange or green points are genes only associated with sample 1 or 2; black points are associated genes shared by sample 1 and 2; gray points are genes not associated with any samples.}}}\n\\textbf{B}: The power of the three measures: TROM, Pearson correlation and Spearman correlation under different simulation settings. It can be observed that TROM is able to achieve a power of $1$ in all the cases.}\n\\label{simulation}\n\\end{figure}\n\n\n\nSuppose a given species has a total number of $N$ genes. \nLet $\\bm X_j = (X_{1j}, \\ldots, X_{Nj})^T$, $(j=1,2)$ denote the expression vector of the $N$ genes in sample $j$. Let $\\bm I_j = (I_{1j}, \\ldots, I_{Nj})^T, \\ (j=1,2)$ be the indicator vector denoting whether each of the $N$ genes is an associated gene of sample $j$: $I_{ij}=1$ if gene $i$ is an associated gene of sample $j$ and $I_{ij}=0$ if gene $i$ is a non-associated gene of sample $j$. We assume that the expression values of associated genes follow a probability distribution $f_1$ while the expression values of non-associated genes follow a different distribution $f_0$:\n\n", "index": 11, "text": "\\begin{align}\nX_{ij}|I_{ij}=0 &\\sim f_0,\\\\\nX_{ij}|I_{ij}=1 &\\sim f_1.\n\\end{align}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E6.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle X_{ij}|I_{ij}=0\" display=\"inline\"><mrow><msub><mi>X</mi><mrow><mi>i</mi><mo>\u2062</mo><mi>j</mi></mrow></msub><mo stretchy=\"false\">|</mo><msub><mi>I</mi><mrow><mi>i</mi><mo>\u2062</mo><mi>j</mi></mrow></msub><mo>=</mo><mn>0</mn></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E6.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle\\sim f_{0},\" display=\"inline\"><mrow><mrow><mi/><mo>\u223c</mo><msub><mi>f</mi><mn>0</mn></msub></mrow><mo>,</mo></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E7.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle X_{ij}|I_{ij}=1\" display=\"inline\"><mrow><msub><mi>X</mi><mrow><mi>i</mi><mo>\u2062</mo><mi>j</mi></mrow></msub><mo stretchy=\"false\">|</mo><msub><mi>I</mi><mrow><mi>i</mi><mo>\u2062</mo><mi>j</mi></mrow></msub><mo>=</mo><mn>1</mn></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E7.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle\\sim f_{1}.\" display=\"inline\"><mrow><mrow><mi/><mo>\u223c</mo><msub><mi>f</mi><mn>1</mn></msub></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.05158.tex", "nexttext": " }}}\n\n\nWe use $n$ to denote the expected number of associated genes in any sample, and use $d$ to denote the {\\textcolor{black}{{mean}}} difference of expression levels between associated genes and non-associated genes in every sample. \n{\\textcolor{black}{{ Here we assume that the log of expression values of the non-associated genes follow $t$-distribution with $4$ degrees of freedom: $f_2=t_{4}$ while the $\\log_{10}$ of expression values of associated genes follow $f_1=t_{4}+d$. }}}\nThe $1000$ sets of gene expression values under null hypothesis are simulated using the following steps.\n\n{\\textcolor{black}{{ \\begin{description} \\item[Step 1] Randomly sample the number of associated genes $n_j$ from $N(n, \\sigma)$ for sample $j$, $j=1,2$. \\item[Step 2] For sample $j$, independently sample indicator variable $I_{ij}$ ($i=1,\\ldots,N$) from Bernoulli$(\\frac{n_j}{N})$: each gene's chance of being sampled as an associated gene is $\\frac{n_j}{N}$. Then the indicator vector $\\bm I_j$ determines the division of associated and non-associated genes for sample $j$. \\item[Step 3] For sample $j$, the $\\log_{10}$ transformed expression values of the $N-\\sum_{i=1}^N I_{ij}$ non-associated genes are independently simulated from $f_0$; the $\\log_{10}$ transformed of expression values of $\\sum_{i=1}^N I_{ij}$ associated genes are independently simulated from $f_1$. The simulated $\\log_{10}$ transformed  expression values of the $N$ genes in the two samples constitute a gene expression matrix. \\item[Step 4]  Repeat Step 1-3 for $1000$ times to generate $\\bm X^{(0,m)}$, $m=1,2\\dots, 1000$, where $\\bm X^{(0,m)}$ represents an $N\\times 2$ gene expression matrix. We illustrate an example of the simulated expression values in the left panel of Figure \\ref{simulation}A. Since $\\bm I_{1} \\bot \\bm I_{2}$ under the null hypothesis, the two columns of $\\bm X^{(0,m)}$ are independent of each other. \\end{description} }}}\n\n\n{\\textcolor{black}{{ The alternative hypothesis states that the two samples share the same set of associated genes: \n", "itemtype": "equation", "pos": -1, "prevtext": "\nIn this simple simulation setting, we assume that $X_{ij} | I_{ij}$ $(i=1,\\ldots,N; j=1,2)$ are independent. \n\n\n{\\textcolor{black}{{ The null hypothesis states that the two samples have independent associated genes: \n", "index": 13, "text": "\\begin{equation} H_0: \\bm I_{1} \\bot \\bm I_{2} \\end{equation}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E8.m1\" class=\"ltx_Math\" alttext=\"H_{0}:\\bm{I}_{1}\\bot\\bm{I}_{2}\" display=\"block\"><mrow><msub><mi>H</mi><mn>0</mn></msub><mo>:</mo><mrow><msub><mi>\ud835\udc70</mi><mn>1</mn></msub><mo>\u22a5</mo><msub><mi>\ud835\udc70</mi><mn>2</mn></msub></mrow></mrow></math>", "type": "latex"}, {"file": "1601.05158.tex", "nexttext": " }}}\nThe $1000$ sets of gene expression values under alternative hypothesis are simulated using the following steps.\n{\\textcolor{black}{{ \\begin{description} \\item[Step 1] Randomly sample the number of associated genes $n_0$ of both samples from $N(n, \\sigma)$. \\item[Step 2] Independently sample indicator variable $I_{i1} = I_{i2}$ ($i=1,\\ldots,N$) from Bernoulli$(\\frac{n_0}{N})$: each gene's chance of being sampled as an associated gene is $\\frac{n_0}{N}$. Then both samples share the same set of associated and non-associated genes determined by the indicator vector $\\bm I_1 = \\bm I_2$. \\item[Step 3] For sample $j$, the $\\log_{10}$ transformed expression values of the $N-\\sum_{i=1}^N I_{ij}$ non-associated genes are independently simulated from $f_0$; the $\\log_{10}$ transformed of expression values of $\\sum_{i=1}^N I_{ij}$ associated genes are independently simulated from $f_1$. The simulated $\\log_{10}$ transformed  expression values of the $N$ genes in the two samples constitute a gene expression matrix. \\item[Step 4]  Repeat Step 1-3 for $1000$ times to generate $\\bm X^{(a,m)}$, $m=1,2\\dots, 1000$, where $\\bm X^{(a,m)}$ represents an $N\\times 2$ gene expression matrix. Since $\\bm I_{1} = \\bm I_{2}$ under the alternative hypothesis, the two columns of $\\bm X^{(a,m)}$ are more dependent of each other than the columns of $\\bm X^{(0,m)}$. But as shown by one example in the right panel of Figure~\\ref{simulation}B, the correlation of the two columns is still weak, because the expression values are conditionally independently simulated given the indicator vectors, . \\end{description} }}}\n\n\n\n\n\nFor the $1000$ sets of $\\bm X^{(0,m)}$ generated under the null hypothesis, {\\textcolor{black}{{we calculate TROM score matrices, Pearson correlation matrices and Spearman correlation matrices and denote them as $T^{(m)}_0, P^{(m)}_0$ and $S^{(m)}_0$. }}}\nFor the $1000$ sets of $\\bm X^{(a,m)}$ generated under the alternative hypothesis, the corresponding TROM score matrices, Pearson correlation matrices and Spearman correlation matrices are denoted as $T^{(m)}_a, P^{(m)}_a$ and $S^{(m)}_a$. \n\n{\\textcolor{black}{{For TROM}}}, we select a threshold $c_T$ on $T^{(m)}_0$ to control {\\textcolor{black}{{the type}}} I error at significance level $\\alpha$. {\\textcolor{black}{{Specifically, the threshold $c_T$ is chosen as \n", "itemtype": "equation", "pos": -1, "prevtext": " }}}\n\n\nWe use $n$ to denote the expected number of associated genes in any sample, and use $d$ to denote the {\\textcolor{black}{{mean}}} difference of expression levels between associated genes and non-associated genes in every sample. \n{\\textcolor{black}{{ Here we assume that the log of expression values of the non-associated genes follow $t$-distribution with $4$ degrees of freedom: $f_2=t_{4}$ while the $\\log_{10}$ of expression values of associated genes follow $f_1=t_{4}+d$. }}}\nThe $1000$ sets of gene expression values under null hypothesis are simulated using the following steps.\n\n{\\textcolor{black}{{ \\begin{description} \\item[Step 1] Randomly sample the number of associated genes $n_j$ from $N(n, \\sigma)$ for sample $j$, $j=1,2$. \\item[Step 2] For sample $j$, independently sample indicator variable $I_{ij}$ ($i=1,\\ldots,N$) from Bernoulli$(\\frac{n_j}{N})$: each gene's chance of being sampled as an associated gene is $\\frac{n_j}{N}$. Then the indicator vector $\\bm I_j$ determines the division of associated and non-associated genes for sample $j$. \\item[Step 3] For sample $j$, the $\\log_{10}$ transformed expression values of the $N-\\sum_{i=1}^N I_{ij}$ non-associated genes are independently simulated from $f_0$; the $\\log_{10}$ transformed of expression values of $\\sum_{i=1}^N I_{ij}$ associated genes are independently simulated from $f_1$. The simulated $\\log_{10}$ transformed  expression values of the $N$ genes in the two samples constitute a gene expression matrix. \\item[Step 4]  Repeat Step 1-3 for $1000$ times to generate $\\bm X^{(0,m)}$, $m=1,2\\dots, 1000$, where $\\bm X^{(0,m)}$ represents an $N\\times 2$ gene expression matrix. We illustrate an example of the simulated expression values in the left panel of Figure \\ref{simulation}A. Since $\\bm I_{1} \\bot \\bm I_{2}$ under the null hypothesis, the two columns of $\\bm X^{(0,m)}$ are independent of each other. \\end{description} }}}\n\n\n{\\textcolor{black}{{ The alternative hypothesis states that the two samples share the same set of associated genes: \n", "index": 15, "text": "\\begin{align} H_a: \\bm I_{1} = \\bm I_{2}. \\end{align}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E9.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle H_{a}:\\bm{I}_{1}=\\bm{I}_{2}.\" display=\"inline\"><mrow><mrow><msub><mi>H</mi><mi>a</mi></msub><mo>:</mo><mrow><msub><mi>\ud835\udc70</mi><mn>1</mn></msub><mo>=</mo><msub><mi>\ud835\udc70</mi><mn>2</mn></msub></mrow></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.05158.tex", "nexttext": " where ${\\rm 1}\\kern-0.24em{\\rm I}(\\cdot)$ is an indicator function.}}}\nUsing the same procedure, we find the threshold $c_P$ for Pearson correlation and $c_S$ for Spearman correlation at significance level $\\alpha$\n{\\textcolor{black}{{ \n", "itemtype": "equation", "pos": -1, "prevtext": " }}}\nThe $1000$ sets of gene expression values under alternative hypothesis are simulated using the following steps.\n{\\textcolor{black}{{ \\begin{description} \\item[Step 1] Randomly sample the number of associated genes $n_0$ of both samples from $N(n, \\sigma)$. \\item[Step 2] Independently sample indicator variable $I_{i1} = I_{i2}$ ($i=1,\\ldots,N$) from Bernoulli$(\\frac{n_0}{N})$: each gene's chance of being sampled as an associated gene is $\\frac{n_0}{N}$. Then both samples share the same set of associated and non-associated genes determined by the indicator vector $\\bm I_1 = \\bm I_2$. \\item[Step 3] For sample $j$, the $\\log_{10}$ transformed expression values of the $N-\\sum_{i=1}^N I_{ij}$ non-associated genes are independently simulated from $f_0$; the $\\log_{10}$ transformed of expression values of $\\sum_{i=1}^N I_{ij}$ associated genes are independently simulated from $f_1$. The simulated $\\log_{10}$ transformed  expression values of the $N$ genes in the two samples constitute a gene expression matrix. \\item[Step 4]  Repeat Step 1-3 for $1000$ times to generate $\\bm X^{(a,m)}$, $m=1,2\\dots, 1000$, where $\\bm X^{(a,m)}$ represents an $N\\times 2$ gene expression matrix. Since $\\bm I_{1} = \\bm I_{2}$ under the alternative hypothesis, the two columns of $\\bm X^{(a,m)}$ are more dependent of each other than the columns of $\\bm X^{(0,m)}$. But as shown by one example in the right panel of Figure~\\ref{simulation}B, the correlation of the two columns is still weak, because the expression values are conditionally independently simulated given the indicator vectors, . \\end{description} }}}\n\n\n\n\n\nFor the $1000$ sets of $\\bm X^{(0,m)}$ generated under the null hypothesis, {\\textcolor{black}{{we calculate TROM score matrices, Pearson correlation matrices and Spearman correlation matrices and denote them as $T^{(m)}_0, P^{(m)}_0$ and $S^{(m)}_0$. }}}\nFor the $1000$ sets of $\\bm X^{(a,m)}$ generated under the alternative hypothesis, the corresponding TROM score matrices, Pearson correlation matrices and Spearman correlation matrices are denoted as $T^{(m)}_a, P^{(m)}_a$ and $S^{(m)}_a$. \n\n{\\textcolor{black}{{For TROM}}}, we select a threshold $c_T$ on $T^{(m)}_0$ to control {\\textcolor{black}{{the type}}} I error at significance level $\\alpha$. {\\textcolor{black}{{Specifically, the threshold $c_T$ is chosen as \n", "index": 17, "text": "\\begin{equation} c_T = \\sup\\left\\{c: \\frac{1}{1000} \\sum^{1000}_{m=1} {\\rm 1}\\kern-0.24em{\\rm I} \\left(T^{(m)}_0>c\\right) \\le \\alpha \\right\\}, \\end{equation}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E10.m1\" class=\"ltx_Math\" alttext=\"c_{T}=\\sup\\left\\{c:\\frac{1}{1000}\\sum^{1000}_{m=1}{\\rm 1}\\kern-2.4pt{\\rm I}%&#10;\\left(T^{(m)}_{0}&gt;c\\right)\\leq\\alpha\\right\\},\" display=\"block\"><mrow><msub><mi>c</mi><mi>T</mi></msub><mo>=</mo><mo movablelimits=\"false\">sup</mo><mrow><mo>{</mo><mi>c</mi><mo>:</mo><mfrac><mn>1</mn><mn>1000</mn></mfrac><munderover><mo largeop=\"true\" movablelimits=\"false\" symmetric=\"true\">\u2211</mo><mrow><mi>m</mi><mo>=</mo><mn>1</mn></mrow><mn>1000</mn></munderover><mn>1</mn><mi mathvariant=\"normal\">I</mi><mrow><mo>(</mo><msubsup><mi>T</mi><mn>0</mn><mrow><mo stretchy=\"false\">(</mo><mi>m</mi><mo stretchy=\"false\">)</mo></mrow></msubsup><mo>&gt;</mo><mi>c</mi><mo>)</mo></mrow><mo>\u2264</mo><mi>\u03b1</mi><mo>}</mo></mrow><mo>,</mo></mrow></math>", "type": "latex"}, {"file": "1601.05158.tex", "nexttext": " \n", "itemtype": "equation", "pos": -1, "prevtext": " where ${\\rm 1}\\kern-0.24em{\\rm I}(\\cdot)$ is an indicator function.}}}\nUsing the same procedure, we find the threshold $c_P$ for Pearson correlation and $c_S$ for Spearman correlation at significance level $\\alpha$\n{\\textcolor{black}{{ \n", "index": 19, "text": "\\begin{equation} c_P = \\sup\\left\\{c: \\frac{1}{1000} \\sum^{1000}_{m=1} {\\rm 1}\\kern-0.24em{\\rm I} \\left(P^{(m)}_0>c\\right) \\le \\alpha \\right\\}, \\end{equation}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E11.m1\" class=\"ltx_Math\" alttext=\"c_{P}=\\sup\\left\\{c:\\frac{1}{1000}\\sum^{1000}_{m=1}{\\rm 1}\\kern-2.4pt{\\rm I}%&#10;\\left(P^{(m)}_{0}&gt;c\\right)\\leq\\alpha\\right\\},\" display=\"block\"><mrow><msub><mi>c</mi><mi>P</mi></msub><mo>=</mo><mo movablelimits=\"false\">sup</mo><mrow><mo>{</mo><mi>c</mi><mo>:</mo><mfrac><mn>1</mn><mn>1000</mn></mfrac><munderover><mo largeop=\"true\" movablelimits=\"false\" symmetric=\"true\">\u2211</mo><mrow><mi>m</mi><mo>=</mo><mn>1</mn></mrow><mn>1000</mn></munderover><mn>1</mn><mi mathvariant=\"normal\">I</mi><mrow><mo>(</mo><msubsup><mi>P</mi><mn>0</mn><mrow><mo stretchy=\"false\">(</mo><mi>m</mi><mo stretchy=\"false\">)</mo></mrow></msubsup><mo>&gt;</mo><mi>c</mi><mo>)</mo></mrow><mo>\u2264</mo><mi>\u03b1</mi><mo>}</mo></mrow><mo>,</mo></mrow></math>", "type": "latex"}, {"file": "1601.05158.tex", "nexttext": " }}}\nThen we apply {\\textcolor{black}{{$c_T$, $c_P$ and $c_S$}}} to $T^{(m)}_a, P^{(m)}_a$ and $S^{(m)}_a$ {\\textcolor{black}{{respectively}}} to calculate the {\\textcolor{black}{{power of TROM, Pearson correlation and Spearman correlation at significance level $\\alpha$}}}. {\\textcolor{black}{{For TROM, its power is calculated as}}} \n\n\n\n\n\n\n{\\textcolor{black}{{ \n", "itemtype": "equation", "pos": -1, "prevtext": " \n", "index": 21, "text": "\\begin{equation} c_S = \\sup\\left\\{c: \\frac{1}{1000} \\sum^{1000}_{m=1} {\\rm 1}\\kern-0.24em{\\rm I} \\left(S^{(m)}_0>c\\right) \\le \\alpha \\right\\}. \\end{equation}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E12.m1\" class=\"ltx_Math\" alttext=\"c_{S}=\\sup\\left\\{c:\\frac{1}{1000}\\sum^{1000}_{m=1}{\\rm 1}\\kern-2.4pt{\\rm I}%&#10;\\left(S^{(m)}_{0}&gt;c\\right)\\leq\\alpha\\right\\}.\" display=\"block\"><mrow><msub><mi>c</mi><mi>S</mi></msub><mo>=</mo><mo movablelimits=\"false\">sup</mo><mrow><mo>{</mo><mi>c</mi><mo>:</mo><mfrac><mn>1</mn><mn>1000</mn></mfrac><munderover><mo largeop=\"true\" movablelimits=\"false\" symmetric=\"true\">\u2211</mo><mrow><mi>m</mi><mo>=</mo><mn>1</mn></mrow><mn>1000</mn></munderover><mn>1</mn><mi mathvariant=\"normal\">I</mi><mrow><mo>(</mo><msubsup><mi>S</mi><mn>0</mn><mrow><mo stretchy=\"false\">(</mo><mi>m</mi><mo stretchy=\"false\">)</mo></mrow></msubsup><mo>&gt;</mo><mi>c</mi><mo>)</mo></mrow><mo>\u2264</mo><mi>\u03b1</mi><mo>}</mo></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.05158.tex", "nexttext": " }}}\nThe power of the Pearson and Spearman correlation $p_P$ and $p_S$ {\\textcolor{black}{{are similarly calculated as}}}\n\n\n{\\textcolor{black}{{ \n", "itemtype": "equation", "pos": -1, "prevtext": " }}}\nThen we apply {\\textcolor{black}{{$c_T$, $c_P$ and $c_S$}}} to $T^{(m)}_a, P^{(m)}_a$ and $S^{(m)}_a$ {\\textcolor{black}{{respectively}}} to calculate the {\\textcolor{black}{{power of TROM, Pearson correlation and Spearman correlation at significance level $\\alpha$}}}. {\\textcolor{black}{{For TROM, its power is calculated as}}} \n\n\n\n\n\n\n{\\textcolor{black}{{ \n", "index": 23, "text": "\\begin{align} p_{T} & =  \\frac{1}{1000} \\sum^{1000}_{m=1}{\\rm 1}\\kern-0.24em{\\rm I}\\{{T^{(m)}_a}\\geq c_T\\} \\end{align}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E13.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle p_{T}\" display=\"inline\"><msub><mi>p</mi><mi>T</mi></msub></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E13.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle=\\frac{1}{1000}\\sum^{1000}_{m=1}{\\rm 1}\\kern-2.4pt{\\rm I}\\{{T^{(m%&#10;)}_{a}}\\geq c_{T}\\}\" display=\"inline\"><mrow><mo>=</mo><mstyle displaystyle=\"true\"><mfrac><mn>1</mn><mn>1000</mn></mfrac></mstyle><mstyle displaystyle=\"true\"><munderover><mo largeop=\"true\" movablelimits=\"false\" symmetric=\"true\">\u2211</mo><mrow><mi>m</mi><mo>=</mo><mn>1</mn></mrow><mn>1000</mn></munderover></mstyle><mn>1</mn><mi mathvariant=\"normal\">I</mi><mrow><mo stretchy=\"false\">{</mo><msubsup><mi>T</mi><mi>a</mi><mrow><mo stretchy=\"false\">(</mo><mi>m</mi><mo stretchy=\"false\">)</mo></mrow></msubsup><mo>\u2265</mo><msub><mi>c</mi><mi>T</mi></msub><mo stretchy=\"false\">}</mo></mrow></mrow></math>", "type": "latex"}, {"file": "1601.05158.tex", "nexttext": "}}}\n\nIn our example, the simulation parameters are set as $N=10,000$ and $\\sigma=20$. We let $n$ range from $1000$ to $2000$ with a step size of $200$ and $d$ range from $0.1$ to $1.9$ with a step size of $0.2$.  {\\textcolor{black}{{We set the significance level $\\alpha=0.05$.}}} Figure~\\ref{simulation}B shows the power analysis result. The result shows that for all the candidate values of $n$ and $d$, TROM has perfect power, while Pearson correlation has no power. Spearman correlation has {\\textcolor{black}{{increasing}}} power as $n$ or $d$ increases. The reason why Pearson correlation fails in the case is that {\\textcolor{black}{{under the alternative hypothesis the}}} expression levels of associated genes have no correlation between two samples, {\\textcolor{black}{{neither do the expression levels of non-associated genes.}}} {\\textcolor{black}{{As}}} the associated genes and non-associated genes have expression values from two distributions, when the difference of the two distributions (i.e., $d$) is large, Spearman correlation, {\\textcolor{black}{{a more robust measure than Pearson correlation}}}, can capture the correspondence of two samples with {\\textcolor{black}{{identical}}} associated genes {\\textcolor{black}{{under the alternative hypothesis}}}. This simulation demonstrates the power of TROM in detecting the correspondence of biological samples {\\textcolor{black}{{based on associated genes}}} regardless of gene expression fluctuations.\n\n\n\nWe also compare TROM with Pearson and Spearman correlation coefficients on two real data sets: modENCODE RNA-seq data of $30$ \\textit{D. melanogaster} developmental stages and $35$ \\textit{C. elegans} developmental stages \\cite{gerstein2014comparative}. In our previous work \\cite{Li2014}, we applied the preliminary idea of TROM to {\\textcolor{black}{{comparing}}} the developmental stages within each species and between the two species, and found interesting correspondence patterns: a {\\textcolor{black}{{block}}} diagonal pattern for within-species comparison and two parallel patterns {\\textcolor{black}{{between fly and worm developmental stages}}}. By applying Pearson and Spearman correlations to comparing these stages based on the same data, however, we cannot see clear correspondence patterns found by either correlation {\\textcolor{black}{{measure}}} in the between-species comparison (Appendix Figure \\ref{outline}). In the within-species comparison, Spearman correlation finds a vague diagonal pattern, while Pearson correlation leads to {\\textcolor{black}{{an}}} unreasonable {\\textcolor{black}{{checkerboard}}} pattern.\n{\\textcolor{black}{{ We also calculate Pearson and Spearman correlation matrices based on the union of all stage-associated genes. {\\textcolor{black}{{However, correlation methods}}} still cannot provide correspondence maps as clear as our {\\textcolor{black}{{TROM}}} method {\\textcolor{black}{{does}}} (Appendix Figure \\ref{cor_associated}). }}}\n\n\n\n\\subsection {{\\textcolor{black}{{Robustness of TROM to data normalization}}}}\n\n{\\textcolor{black}{{ Since quantile normalization has become an essential {\\textcolor{black}{{step in}}} analysis pipelines for high-throughput data such as microarray and RNA-seq {\\textcolor{black}{{data}}} \\cite{quantile2014}, we conduct a simulation study to demonstrate the influence of quantile normalization on TROM scores. We simulate 1000 sets of gene expression matrices with or without quantile normalization procedure and compute their corresponding TROM scores. Then we check whether the distribution of TROM scores {\\textcolor{black}{{changes with the use of}}} quantile normalization. }}}\n\n\n\n{\\textcolor{black}{{ We set the size of gene population as $N=10,000$ and the number of biological samples from the species as $k=2$. We consider {\\textcolor{black}{{$\\log_{10}$ transformed}}} gene expression values and simulate expression matrices following multivariate $t$-distribution with 4 degrees of freedom. The mean and covariance used in the $t$-distribution are  \n", "itemtype": "equation", "pos": -1, "prevtext": " }}}\nThe power of the Pearson and Spearman correlation $p_P$ and $p_S$ {\\textcolor{black}{{are similarly calculated as}}}\n\n\n{\\textcolor{black}{{ \n", "index": 25, "text": "\\begin{align} p_{P} & =  \\frac{1}{1000} \\sum^{1000}_{m=1}{\\rm 1}\\kern-0.24em{\\rm I}\\{{P^{(m)}_a}\\geq c_P\\}\\\\ p_{S} & =  \\frac{1}{1000} \\sum^{1000}_{m=1}{\\rm 1}\\kern-0.24em{\\rm I}\\{{S^{(m)}_a}\\geq c_S\\} \\end{align}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E14.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle p_{P}\" display=\"inline\"><msub><mi>p</mi><mi>P</mi></msub></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E14.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle=\\frac{1}{1000}\\sum^{1000}_{m=1}{\\rm 1}\\kern-2.4pt{\\rm I}\\{{P^{(m%&#10;)}_{a}}\\geq c_{P}\\}\" display=\"inline\"><mrow><mo>=</mo><mstyle displaystyle=\"true\"><mfrac><mn>1</mn><mn>1000</mn></mfrac></mstyle><mstyle displaystyle=\"true\"><munderover><mo largeop=\"true\" movablelimits=\"false\" symmetric=\"true\">\u2211</mo><mrow><mi>m</mi><mo>=</mo><mn>1</mn></mrow><mn>1000</mn></munderover></mstyle><mn>1</mn><mi mathvariant=\"normal\">I</mi><mrow><mo stretchy=\"false\">{</mo><msubsup><mi>P</mi><mi>a</mi><mrow><mo stretchy=\"false\">(</mo><mi>m</mi><mo stretchy=\"false\">)</mo></mrow></msubsup><mo>\u2265</mo><msub><mi>c</mi><mi>P</mi></msub><mo stretchy=\"false\">}</mo></mrow></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E15.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle p_{S}\" display=\"inline\"><msub><mi>p</mi><mi>S</mi></msub></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E15.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle=\\frac{1}{1000}\\sum^{1000}_{m=1}{\\rm 1}\\kern-2.4pt{\\rm I}\\{{S^{(m%&#10;)}_{a}}\\geq c_{S}\\}\" display=\"inline\"><mrow><mo>=</mo><mstyle displaystyle=\"true\"><mfrac><mn>1</mn><mn>1000</mn></mfrac></mstyle><mstyle displaystyle=\"true\"><munderover><mo largeop=\"true\" movablelimits=\"false\" symmetric=\"true\">\u2211</mo><mrow><mi>m</mi><mo>=</mo><mn>1</mn></mrow><mn>1000</mn></munderover></mstyle><mn>1</mn><mi mathvariant=\"normal\">I</mi><mrow><mo stretchy=\"false\">{</mo><msubsup><mi>S</mi><mi>a</mi><mrow><mo stretchy=\"false\">(</mo><mi>m</mi><mo stretchy=\"false\">)</mo></mrow></msubsup><mo>\u2265</mo><msub><mi>c</mi><mi>S</mi></msub><mo stretchy=\"false\">}</mo></mrow></mrow></math>", "type": "latex"}, {"file": "1601.05158.tex", "nexttext": " These parameters are estimated from the RNA-seq data of \\emph{D. melanogaster}. For the {\\textcolor{black}{{scenario}}} without quantile normalization, we simulate $1000$ sets of {\\textcolor{black}{{$N \\times k$}}} expression matrices and multiply each column in the matrices by a random number drawn from normal distribution $N(0, 10s)$ to {\\textcolor{black}{{change}}} the range of expression values in each sample. For the {\\textcolor{black}{{scenario}}} with quantile normalization, we simulate $1000$ sets of expression matrices {\\textcolor{black}{{and apply}}} quantile {\\textcolor{black}{{normalization to them}}}. We then calculate the corresponding TROM scores of these simulated gene expression matrices. The {\\textcolor{black}{{$z$-score threshold of TROM is set as}}} $0.2$.}}}\n\n{\\textcolor{black}{{ We focus on the {\\textcolor{black}{{TROM scores of comparing the two samples}}} since {\\textcolor{black}{{it is trivial to compare a sample to itself}}}. We use Kolmogorov-Smirnov (KS) test to check whether the distribution of TROM {\\textcolor{black}{{scores}}} changes significantly with or without quantile normalization. The $p$-value of KS test on TROM scores is always 1 when shift parameter $s=1,2,\\dots,5$. This result suggests that TROM is robust to {\\textcolor{black}{{data without quantile normalization}}} and the correspondence patterns {\\textcolor{black}{{are stable}}}. }}}\n\n\n\n\n\n\\subsection {{\\textcolor{black}{{Robustness of TROM to different platforms: comparison of \\textit{D. melanogaster} developmental stages based on microarray and RNA-seq data}}}}\n\nAlthough many studies have claimed that RNA-seq is the technique of choice that provides more accurate estimation of absolute gene expression levels compared with microarray \\cite{zhao2014comparison,fu2009estimating}, several genome-wide analyses have also suggested that microarray can measure the expression of above-median expressed genes reasonably well, and on these genes the two platforms have good concordance \\cite{wang2014concordance}. Since microarray has been widely used to study transcriptomes of multiple species under various conditions in the past decade, it is desirable to have a good comparative transcriptomic method that is robust to the platform difference of microarray and RNA-seq data. \n\nHere we demonstrate the robustness of TROM by applying it to {\\textcolor{black}{{comparing}}} the microarray and RNA-seq data {\\textcolor{black}{{of}}} the developmental stages of \\textit{D. melanogaster}. If TROM is robust, it should identify strong correspondence between  similar developmental stages in the microarray and RNA-seq data. \n\nFor a pair of developmental stages, one with microarray data and the other with RNA-seq data, TROM identifies a set of associated genes for each of them based on all the stages {\\textcolor{black}{{with}}} microarray {\\textcolor{black}{{and}}} RNA-seq data, respectively. Then TROM performs the overlap test and produces a correspondence map.\n\nThe results show that TROM can find almost perfect correspondence of the same \\textit{D. melanogaster} embryonic stages between microarray or RNA-seq (Figure~\\ref{TROM_map}C).\n{\\textcolor{black}{{There are five other \\textit{Drosophila} species that}}} have similar developmental patterns as \\textit{D. melanogaster}, as we have already shown in the within-species and between-species comparison in Section \\ref{sec:TROM scores}. We also compare their microarray data {\\textcolor{black}{{of}}} embryonic stages with the RNA-seq data of \\textit{D. melanogaster} as a further check. In the result (Appendix Figure \\ref{micro_vs_rna}), we observe strong {\\textcolor{black}{{block}}} diagonal patterns. Although RNA-seq data contains larvae, prepupae, and adult stages that do not have {\\textcolor{black}{{corresponding}}} microarray data, the off-diagonal patterns, which we observe (1) between late embryos in microarray and prepupae in RNA-seq and (2) between early embryos in microarray and female adults in RNA-seq, are consistent with our previous within-species correspondence map based on RNA-seq data only \\cite{Li2014} and previous studies \\cite{Arbeitman2002}. These results show that TROM can find almost the same correspondence of \\textit{Drosophila} developmental stages {\\textcolor{black}{{regardless}}} of the platform being microarray or RNA-seq. \n\n\n\n\n\\subsection{Gene Ontology (GO) enrichment analysis}\n\nTo understand the biological functions behind the correspondence we {\\textcolor{black}{{have observed}}} between developmental stages, we perform enrichment analysis \\cite{ashburner2000gene} of biological process (BP) gene ontology (GO) terms in stage-associated genes, as a way to determine common biological functions and processes in corresponding stages.\nFirst, we examine the GO term enrichment in the associated genes of every \\emph{D. melanogaster} embryomnic stage, using RNA-seq data and microarray data respectively. The enrichment scores are defined as $-\\log_{10}(\\text{Bonferroni corrected}\\ p\\text{-value})$ where $p$-values are calculated based on a the hypergeometric test, and the results are illustrated in Appendix Figures \\ref{fly_GO_rna}, \\ref{fly_GO_micro}. {\\textcolor{black}{{For every fly embryonic stage, the}}} top 20 enriched GO terms {\\textcolor{black}{{in the associated genes}}} identified {\\textcolor{black}{{by}}} RNA-seq data {\\textcolor{black}{{contain biological functions highly relevant to these stages, and many of these terms have been discovered as enriched in {\\textcolor{black}{{relevant embryonic samples}}} by previous studies}}} \\cite{Li2014,puniyani2010spex2}. A proportion of these top enrichment GO terms with {\\textcolor{black}{{support in the literature}}} are listed in Table \\ref{flyGO}. {\\textcolor{black}{{The enriched GO terms identified from both RNA-seq and microarray data}}} support the {\\textcolor{black}{{correspondence}}} patterns observed in TROM correspondence maps: common enriched GO terms are often shared by adjacent stages {\\textcolor{black}{{whose pairwise TROM scores are high}}}. The top enriched GO terms {\\textcolor{black}{{found by both microarray and RNA-seq are informative for further functional studies on the associated genes of every stage, so as to better understand embryonic development of \\emph{D. melanogaster}}}}.\n\\begin{table}[t]\n\\caption{Selected enriched GO terms in each stage of \\emph{D. melanogaster}.}{\n\\resizebox{\\columnwidth}{!}{\n\\begin{tabular}{ll}\n\\hline\n{\\textcolor{black}{{Stage Name}}} & Top enriched GO terms  \\\\\n\\hline\nEmbryo 0-2h & oogenesis, DNA replication, germ cell development, neurogenesis\\\\\nEmbryo 2-4h & neurogenesis, mRNA splicing via spliceosome, zygotic determination of anterior/posterior axis\\\\\nEmbryo 4-6h & mRNA splicing via spliceosome, specification of segmental identity, cell fate specification\\\\\nEmbryo 6-8h & cell fate specification, sensory organ development, open tracheal system development\\\\\nEmbryo 8-10h & myoblast fusion, multicellular organism reproduction, puparial adhesion\\\\\nEmbryo 10-12h & myoblast fusion, translation, mitotic spindle elongation, septate junction assembly\\\\\nEmbryo 12-14h & axon guidance, septate junction assembly, branch fusion open tracheal system\\\\\nEmbryo 14-16h & circadian rhythm, response to light stimulus, crystal cell differentiation\\\\\nEmbryo 16-18h & chitin-based cuticle development, body morphogenesis, chitin metabolic process\\\\\nEmbryo 18-20h & body morphogenesis, chitin metabolic process, proteolysis\\\\\n\\hline\n\\end{tabular}\n}\n}\n\\label{flyGO}\n\\end{table}\n\n\n{\\textcolor{black}{{We also examine the GO term enrichment in the associated genes of every developmental stage of mouse liver}}}. The resulting enrichment scores are illustrated in Appendix Figure \\ref{mouse_GO}. The {\\textcolor{black}{{top 10 enriched}}} GO terms in our selected stage-associated genes {\\textcolor{black}{{of every stage}}} {\\textcolor{black}{{confirm}}} previous findings on liver development and regeneration. In E11.5-12.5, {\\textcolor{black}{{two of the early stages}}}, top enriched GO terms are {\\textcolor{black}{{mostly}}} cell cycle related terms like {\\textcolor{black}{{``translation\", ``mRNA processing\", ``cell cycle\" and ``cell division\"}}} \\cite{li2009multi}. Previous research has shown that mouse liver takes over the function of hematopoiesis at E10.5-12.5 \\cite{li2009multi,hata2007liver}{\\textcolor{black}{{,}}} and we found that the GO terms {\\textcolor{black}{{including ``heme biosynthetic process\" and ``porphyrin-containing compound biosynthetic process\"}}} are top enriched in subsequent stages. For {\\textcolor{black}{{stages}}} E17.5-Day7, the GO terms {\\textcolor{black}{{``innate immune response\" and ``immune system process\"}}} are top enriched, in accordance with the theory that liver is an organ with innate immune features \\cite{dong2007roles}. Finally, as the function of mouse liver {\\textcolor{black}{{switches}}} from hematopoiesis to metabolism and this capacity dominates in the adult liver \\cite{hata2007liver,li2009multi}, we {\\textcolor{black}{{observe}}} that GO terms related to various metobolic processes {\\textcolor{black}{{become}}} enriched in {\\textcolor{black}{{stages}}} E17.5-NL(normal adult liver tissue). These findings again illustrate the {\\textcolor{black}{{capacity}}} of the associated genes in capturing {\\textcolor{black}{{transcriptomic characteristics of biological samples}}}.\n\n\n\n\n\\subsection{Construction of developmental trees using stage-associated genes}\nWe further demonstrate that the selected stage-associated genes contain abundant information to group and distinct developmental stages. Tree construction has been a popular approach for studying the relationships of different developmental stages in organism development \\cite{Arbeitman2002} as well as cell lineages in cell differentiation \\cite{virmani2002hierarchical}. Here we attempt to construct developmental trees of diverse species (see Appendix Figure \\ref{tree_supp}) based on the identified associated genes of each developmental stage, reasoning that the associated genes capture stage characteristics and thus can lead to reasonable developmental trees. \n{\\textcolor{black}{{ In tree construction, both Simpson and Jacard similarity coefficients can be used to measure the distances between different samples. However, Simpson coefficent will produce a result of $1$ when {\\textcolor{black}{{the associated genes of one sample}}} is a subset of the {\\textcolor{black}{{associated genes of the other sample, and it}}} thus fails to distinguish two samples in this case. In contrast, Jacard coefficient is able to separate two biological samples in this case{\\textcolor{black}{{, because it}}} considers two samples as identical if and only if they have exactly the same associated genes. }}}\nAs a consequence, we carry out the tree construction by hierarchical clustering, using average linkage and Jaccard coefficient, where the distance between two stages $i$ and $j$ is calculated as\n\n", "itemtype": "equation", "pos": -1, "prevtext": "}}}\n\nIn our example, the simulation parameters are set as $N=10,000$ and $\\sigma=20$. We let $n$ range from $1000$ to $2000$ with a step size of $200$ and $d$ range from $0.1$ to $1.9$ with a step size of $0.2$.  {\\textcolor{black}{{We set the significance level $\\alpha=0.05$.}}} Figure~\\ref{simulation}B shows the power analysis result. The result shows that for all the candidate values of $n$ and $d$, TROM has perfect power, while Pearson correlation has no power. Spearman correlation has {\\textcolor{black}{{increasing}}} power as $n$ or $d$ increases. The reason why Pearson correlation fails in the case is that {\\textcolor{black}{{under the alternative hypothesis the}}} expression levels of associated genes have no correlation between two samples, {\\textcolor{black}{{neither do the expression levels of non-associated genes.}}} {\\textcolor{black}{{As}}} the associated genes and non-associated genes have expression values from two distributions, when the difference of the two distributions (i.e., $d$) is large, Spearman correlation, {\\textcolor{black}{{a more robust measure than Pearson correlation}}}, can capture the correspondence of two samples with {\\textcolor{black}{{identical}}} associated genes {\\textcolor{black}{{under the alternative hypothesis}}}. This simulation demonstrates the power of TROM in detecting the correspondence of biological samples {\\textcolor{black}{{based on associated genes}}} regardless of gene expression fluctuations.\n\n\n\nWe also compare TROM with Pearson and Spearman correlation coefficients on two real data sets: modENCODE RNA-seq data of $30$ \\textit{D. melanogaster} developmental stages and $35$ \\textit{C. elegans} developmental stages \\cite{gerstein2014comparative}. In our previous work \\cite{Li2014}, we applied the preliminary idea of TROM to {\\textcolor{black}{{comparing}}} the developmental stages within each species and between the two species, and found interesting correspondence patterns: a {\\textcolor{black}{{block}}} diagonal pattern for within-species comparison and two parallel patterns {\\textcolor{black}{{between fly and worm developmental stages}}}. By applying Pearson and Spearman correlations to comparing these stages based on the same data, however, we cannot see clear correspondence patterns found by either correlation {\\textcolor{black}{{measure}}} in the between-species comparison (Appendix Figure \\ref{outline}). In the within-species comparison, Spearman correlation finds a vague diagonal pattern, while Pearson correlation leads to {\\textcolor{black}{{an}}} unreasonable {\\textcolor{black}{{checkerboard}}} pattern.\n{\\textcolor{black}{{ We also calculate Pearson and Spearman correlation matrices based on the union of all stage-associated genes. {\\textcolor{black}{{However, correlation methods}}} still cannot provide correspondence maps as clear as our {\\textcolor{black}{{TROM}}} method {\\textcolor{black}{{does}}} (Appendix Figure \\ref{cor_associated}). }}}\n\n\n\n\\subsection {{\\textcolor{black}{{Robustness of TROM to data normalization}}}}\n\n{\\textcolor{black}{{ Since quantile normalization has become an essential {\\textcolor{black}{{step in}}} analysis pipelines for high-throughput data such as microarray and RNA-seq {\\textcolor{black}{{data}}} \\cite{quantile2014}, we conduct a simulation study to demonstrate the influence of quantile normalization on TROM scores. We simulate 1000 sets of gene expression matrices with or without quantile normalization procedure and compute their corresponding TROM scores. Then we check whether the distribution of TROM scores {\\textcolor{black}{{changes with the use of}}} quantile normalization. }}}\n\n\n\n{\\textcolor{black}{{ We set the size of gene population as $N=10,000$ and the number of biological samples from the species as $k=2$. We consider {\\textcolor{black}{{$\\log_{10}$ transformed}}} gene expression values and simulate expression matrices following multivariate $t$-distribution with 4 degrees of freedom. The mean and covariance used in the $t$-distribution are  \n", "index": 27, "text": "\\begin{align*} \\mu &= (0.3, 0.3)^T,\\\\ \\Sigma &=   \\left( \\begin{array}{cc} 1.0 & 0.8  \\\\ 0.8 & 1.0   \\end{array} \\right). \\end{align*}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex1.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle\\mu\" display=\"inline\"><mi>\u03bc</mi></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex1.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle=(0.3,0.3)^{T},\" display=\"inline\"><mrow><mrow><mi/><mo>=</mo><msup><mrow><mo stretchy=\"false\">(</mo><mn>0.3</mn><mo>,</mo><mn>0.3</mn><mo stretchy=\"false\">)</mo></mrow><mi>T</mi></msup></mrow><mo>,</mo></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex2.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle\\Sigma\" display=\"inline\"><mi mathvariant=\"normal\">\u03a3</mi></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex2.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle=\\left(\\begin{array}[]{cc}1.0&amp;0.8\\\\&#10;0.8&amp;1.0\\end{array}\\right).\" display=\"inline\"><mrow><mrow><mi/><mo>=</mo><mrow><mo>(</mo><mtable columnspacing=\"5pt\" rowspacing=\"0pt\"><mtr><mtd columnalign=\"center\"><mn>1.0</mn></mtd><mtd columnalign=\"center\"><mn>0.8</mn></mtd></mtr><mtr><mtd columnalign=\"center\"><mn>0.8</mn></mtd><mtd columnalign=\"center\"><mn>1.0</mn></mtd></mtr></mtable><mo>)</mo></mrow></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.05158.tex", "nexttext": "\nwhere $|X_i|$ {\\textcolor{black}{{and}}} $|X_j|$ are the {\\textcolor{black}{{sizes}}} of two sets of stage-associated genes and $|X_i\\cap X_j|$ is the number of {\\textcolor{black}{{genes in their}}} intersection.\n\nThe {\\textcolor{black}{{developmental}}} tree (see Figure \\ref{tree}A) constructed for mouse liver development shows an interesting pattern: the first major {\\textcolor{black}{{branch}}} of the tree {\\textcolor{black}{{successfully}}} divides the $14$ stages into embryonic stages and postnatal stages with one exception that the last embryonic stage E18.5 is clustered {\\textcolor{black}{{with}}} the postnatal stages. {\\textcolor{black}{{Moreover, neighboring stages are clustered with each other in small branches.}}} \nThese observations are in accordance with the correspondence pattern illustrated by TROM scores (see Figure \\ref{TROM_map}A): mappings exist between neighboring stages but not between E11.5-E17.5 and E18.5-NL. {\\textcolor{black}{{Previous}}} hierarchical clustering results on genes whose expression levels are changed by more than 1.5-fold to average \\cite{li2009multi} {\\textcolor{black}{{supported our constructed tree and the}}} similarity between E18.5 and postnatal stages. The GO enrichment analysis {\\textcolor{black}{{provides functional explanation on the observed clustering of E18.5 and Day 7, which both have enriched GO term including ``innate immune response\", ``immune system process\" and ``multicellular organismal development\".}}}\n\nThe {\\textcolor{black}{{developmental}}} tree (see Figure \\ref{tree}B) constructed for sea urchin embryonic development also matches existent understanding of temporal interrelations of developmental {\\textcolor{black}{{stages}}}. First, the major {\\textcolor{black}{{branch}}} of the differentiation tree divides the stages into two sub-groups: one is 00, 10, 18, 24 {\\textcolor{black}{{and}}} 30 hpf and the other is 40, 48, 56, 64 {\\textcolor{black}{{and}}} 72 hpf. Previous studies show that oral/aboral (O/A) axis specification, endomesoderm development and autonomous specification are the major developmental processes before 40 hpf{\\textcolor{black}{{,}}} while set-aside cells and rudiment formation and embryonic morphogenesis take over the major processes after 40 hpf \\cite{davidson1998specific}. This functional explanation supports our constructed tree. Second, neighboring stages are grouped into small branches, and the overall tree is in accordance with {\\textcolor{black}{{sea urchin's embryonic development periods}}} as cleavage, blastuda, gastrula and prism-pluteus \\cite{davidson1998specific}.\n\n\n\\begin{figure}[!tpb]\n\\centering\n\\includegraphics[width=0.8\\linewidth]{tree.pdf}\n\\caption{{\\textcolor{black}{{Developmental trees constructed based on}}} stage-associated genes. \\textbf{A}: {\\textcolor{black}{{Developmental tree of}}} mouse liver. \\textbf{B}: {\\textcolor{black}{{Developmental tree of}}} sea urchin.}\n\\label{tree}\n\\end{figure}\n\n\n\n\n\n\n\\section{Discussion}\n{\\textcolor{black}{{ In this work, we demonstrate that our proposed measure TROM is more efficient in finding transcriptomic similarity and correspondence patterns {\\textcolor{black}{{of biological samples within and between}}} species compared with {\\textcolor{black}{{Pearson and Spearman correlations}}}. Both simulation and real data analysis verify the superior power of TROM in detecting biologically meaningful relationships between different samples. The comparison results suggest that {\\textcolor{black}{{in the TROM method}}} the selection of associated genes is a {\\textcolor{black}{{critical}}} step {\\textcolor{black}{{before}}} the overlap test. The selection step ensures that the transcriptomic characteristics of each sample are {\\textcolor{black}{{well}}} captured and represented. {\\textcolor{black}{{Moreover, the strength of TROM also lies}}} in the overlap test {\\textcolor{black}{{that}}} is independent of specific gene expression values and thus relatively robust to noisy data. This is the reason why {\\textcolor{black}{{Pearson and Spearman correlations}}} fail to {\\textcolor{black}{{detect clear}}} correspondence patterns even {\\textcolor{black}{{based on the}}} associated genes.  }}}\n\n{\\textcolor{black}{{ We {\\textcolor{black}{{observe}}} that it is possible to improve the {\\textcolor{black}{{correspondence map found by}}} Spearman correlation by {\\textcolor{black}{{thresholding its correlation values, i.e., setting all the values below the threshold to the minimum value of all pairwise comparisons}}}. We test this procedure on the RNA-seq datasets of \\emph{D. melanogaster} and \\emph{C. elegans} and the results are summarized in Appendix Figure \\ref{sp_thre}. As expected, thresholding on the Spearman correlation can give rise to relatively clearer correspondence patterns. However, this procedure is very sensitive to the threshold and often miss biologically meaningful mappings: the similarity of early embryos and female adults in fly is only captured once and the similarity of embryo and adults in worm is totally {\\textcolor{black}{{missing at all thresholds}}} \\cite{Li2014}.}}}\n\n{\\textcolor{black}{{ We would also like to point out that although TROM is not a parameter-free method, the resulting similarity patterns are usually not very sensitive to the selection of {\\textcolor{black}{{the $z$-score threshold}}}. In addition, {\\textcolor{black}{{the TROM method}}} provides users with the flexibility to tune the {\\textcolor{black}{{threshold}}} according to {\\textcolor{black}{{the level of}}} relationships they {\\textcolor{black}{{look}}} for between biological samples. }}}\n\n{\\textcolor{black}{{  The sample-associated genes identified {\\textcolor{black}{{based on}}} the threshold carry important transcriptomic characteristics of the corresponding samples and are not simply the compliment of housekeeping genes. These associated genes filter out not only housekeeping genes, but also those genes that with little variation across samples. In addition, it is worth noting that the concept of associated genes is not equivalent to specific genes, since associated genes also contain genes that capture transcriptomic similarity among closely relevant samples, and part of these genes can be shared {\\textcolor{black}{{by several samples but not all samples}}}.}}}\n\n{\\textcolor{black}{{ {\\textcolor{black}{{To our knowledge,}}} the only previous attempt other than correlation-based methods to {\\textcolor{black}{{compare biological samples across species is a method by Le et al}}} \\cite{le2010cross}. This method compares expression experiments from different species through a newly defined distance metric between the ranking of orthologous genes in the two species. However, their method relies on a large training dataset of known similar samples to learn the parameters for distance functions, which is not practical for finding novel patterns {\\textcolor{black}{{of biological samples of rarely studied species such as \\textit{D. rerio}}}}. {\\textcolor{black}{{Another}}} advantage of TROM compared with this method is that TROM can identify informative associated genes that enable various downstream analysis. }}}\n\n\n\n\\section{Conclusion}\nTROM, a testing-based method is introduced for finding correspondence patterns among transcriptomes of the same or different species. We demonstrate the greater power of TROM compared to correlation measures in finding transcriptomic similarity in terms of highly expressed genes. We apply TROM to find correspondence maps of developmental stages within and between multiple species, and we show that the associated genes TROM finds for developmental stages can be used to construct developmental trees in these speces. We also show that TROM is robust to {\\textcolor{black}{{data normalization and}}} platform differences of microarray and RNA-seq. {\\textcolor{black}{{In addition, we design}}} a systematic approach for selecting a key threshold parameter in TROM. We provide the TROM method in an R package, which provides functions with flexibility for illustration and customization and can be easily integrated into existing comparative genomic pipelines.\n\n\n\n\\bibliographystyle{plain}\n\\bibliography{TROM}\n\n\n\n\n\\newpage\n\\section*{Appendix}\n\\setcounter{table}{0}\n\\setcounter{figure}{0}\n\n\n\\begin{longtable}{cc}\n\\caption{Selected $z$-score threshold for different species}\\\\\n\n\\hline\n{\\textcolor{black}{{Species}}} & threshold of $z$-scores  \\\\\n\\hline\n\\emph{D. melanogaster} (RNA-seq) & $1.8$ \\\\\n\n\\emph{C. elegans} &  $2.0$\\\\\n\n\\emph{D. melanogaster} (microarray) & $0.9$\\\\ \n\n\\emph{D. ananassae} & $0.9$ \\\\\n\n\\emph{D. simulans} & $0.9$ \\\\\n\n\\emph{D. persimilis} & $0.9$ \\\\\n\n\\emph{D. pseudoobscura} &  $0.8$\\\\\n\n\\emph{D. virilis} & $1.1$ \\\\\n\nmouse liver & $1.4$\\\\\n\nsea urchin & $1.1$\\\\\n\n\\emph{D. rerio} & $1.0$\\\\\n\\hline\n\n\\label{tab:z_thre}\n\\end{longtable}\n\n\n\n\n\n\n\\begin{longtable}{p{0.2\\textwidth}p{0.8\\textwidth}}\n\\caption{Description of sample labels of different species}\\\\\n\\hline\n{\\textcolor{black}{{Species}}} & Sample labels and corresponding explanation  \\\\\n\\hline\n\\emph{D. melanogaster} (RNA-seq) & Embryo0-2h, Embryo2-4h, Embryo4-6h, Embryo6-8h, Embryo8-10h, Embryo10-12h, Embryo12-14h, Embryo14-16h, Embryo16-18h, Embryo18-20h, Embryo20-22h, Embryo22-24h, L1 (L1 stage larvae), L2 (L2 stage larvae), L3+12h (L3 stage larvae, 12 hr post-molt), L3PS1-2 (L3 stage larvae, dark blue gut, puff stage 1-2), L3PS3-6 (L3 stage larvae, light blue gut, puff stage 3-6), L3PS7-9 (L3 stage larvae, clear gut puff stage 7-9), Prepupae (White prepupae), Prepupae+12h (Pupae, 12 hours after white prepupae), Prepupae+24h (Pupae, 24 hours after white prepupae), Prepupae+2d (Pupae, 2 days after white prepupae), Prepupae+3d (Pupae, 3 days after white prepupae), Prepupae+4d (Pupae, 4 days after white prepupae), Male+1d (Adult male, one day after eclosion), Male+5d (Adult male, 5 days after eclosion), Female+1d (Adult female, one day after eclosion), Female+5d (Adult female, 5 days after eclosion), Female+30d (Adult female, 30 days after eclosion) \\\\\n\\hline\n\\emph{C. elegans} & EE\\_50-0(embryo 0 mins), EE\\_50-30 (embryo 30 mins), EE\\_50-60, EE\\_50-90, EE\\_50-120, EE\\_50-150, EE\\_50-180, EE\\_50-210, EE\\_50-240, EE\\_50-300, EE\\_50-330, EE\\_50-360, EE\\_50-390, EE\\_50-420, EE\\_50-450, EE\\_50-480, EE\\_50-510, EE\\_50-540, EE\\_50-570, EE\\_50-600, EE\\_50-630, EE\\_50-660, EE\\_50-690, EE\\_50-720, L1 (larva L1), LIN35 (larva L1 lin35), L2 (larva L2), L3 (larva L3), L4 (larva L4), L4MALE (larva L4 male), YA (young adult), AdultSPE9 (adult spe9), DauerEntryDAF2, DauerDAF2, DauerExitDAF2 \\\\\n\\hline\n\\emph{Drosophila} (microarray) & E0-2h (Embryo 0-2h), E2-4h (Embryo 2-4h), E4-6h (Embryo 4-6h), E6-8h (Embryo 6-8h), E8-10h (Embryo 8-10h), E10-12h (Embryo 12-14h), E14-16h (Embryo 14-16h), E16-18h (Embryo 16-18h), E18-20h (Embryo 18-20h), E20-22h (Embryo 20-22h), E22-24h (Embryo 22-24h), E22-24h (Embryo 24-26h)\\\\\n\\hline\nmouse liver & E11.5 (embryonic day 11.5), E12.5 (embryonic day 12.5), E13.5 (embryonic day 13.5), E14.5 (embryonic day 14.5), E15.5 (embryonic day 15.5), E16.5 (embryonic day 16.5), E17.5 (embryonic day 17.5), E18.5 (embryonic day 18.5), Day0 (the day of birth), Day3, Day7, Day14, Day21, and NL (normal adult liver)\\\\\n\\hline\nsea urchin & 00 hpf (0 hours post-fertilization), 10 hpf, 18 hpf, 24 hpf, 30 hpf, 40 hpf, 48 hpf, 56 hpf, 64 hpf, 72 hpf\\\\\n\\hline\n\\emph{D. rerio} & 0min (egg 0min), 15min (zygote 15min), 45min(cleavage 45min), 1h15min(cleavage 1h15min), 1h45min(cleavage 1h45min), 2h15min(blastula 2h15min), 2h45min(blastula 2h45min), 3h20min(blastula 3h20min), 4h(blastula 4h), 4h40min(blastula 4h40min), 5h20min(gastrula 5h20min), 6h(gastrula 6h), 7h(gastrula 7h), 8h(gastrula 8h), 9h(gastrula 9h), 10h(gastrula 10h), 10h20min(segmentation 10h20min), 11h(segmentation 11h), 11h40min(segmentation 11h40min), 12h(segmentation 12h), 13h(segmentation 13h), 14h(segmentation 14h), 15h(segmentation 15h), 16h(segmentation 16h), 17h(segmentation 17h), 18h(segmentation 18h), 19h(segmentation 19h), 20h(segmentation 20h), 21h(segmentation 21h), 22h(segmentation 22h), 23h(segmentation 23h), 1d1h(pharyngula 1d1h), 1d3h(pharyngula 1d3h), 1d6h(pharyngula 1d6h), 1d10h(pharyngula 1d10h), 1d14h(pharyngula 1d14h), 1d18h(pharyngula 1d18h), 2d(hatching 2d), 2d12h(hatching 2d12h), 3d(hatching 3d), 4d(larva 4d), 6d(larva 6d), 8d(larva 8d), 10d(larva 10d), 14d(larva 14d), 18d(larva 18d), 24d(larva 24d), 30d(larva 30d), 40d(larva 40d), 45d(juvenile 45d), 55d(juvenile 55d), 65d(juvenile 65d), 80d(juvenile 80d), 90d(adult 90d female), 3m15d(adult 3m15d female), 4m(adult 4m female), 7m(adult 7m female), 9m(adult 9m female), 1y2m(adult 1y2m female), 1y6m(adult 1y6m female), 1y9m(adult 1y9m), 55d(adult 55d male), 65d(adult 65d male), 80d(adult 80d male), 90d(adult 90d male), 3m15d(adult 3m15d male), 4m(adult 4m male), 7m(adult 7m male), 9m(adult 9m male), 1y2m(adult 1y2m male), 1y6m(adult 1y6m male), 1y9m(adult 1y9m male)\\\\\n\\hline\n\\label{stage_label}\n\\end{longtable}\n\n\n\n\n\n\n\n\n\n\n\\begin{figure}[!b]\n\\centerline{\\includegraphics[width=\\linewidth, angle=90, scale=1.3]{TROM_scores.pdf}}\n\\caption{Correspondence maps of within-species and between-species TROM scores. TROM scores are saturated at $6$. The names of the species are marked as row or column labels of the corresponding heatmaps. For the \\emph{Drosophila} species the stages labels 1-13 refer to Embryo 0-2h, 2-4h, 4-6h, 6-8h, 8-10h, 10-12h, 12-14h, 14-16h, 16-18h, 18-20h, 20-22h, 22-24h and 24-26h respectively.}\n\\label{TROM_scores}\n\\end{figure}\n\n\n\\begin{figure}[!pb]\n\\centerline{\\includegraphics[width=0.8\\linewidth]{outline.pdf}}\n\\cprotect\\caption{Outline of the package \\verb|TROM|. The three left (and right) heatmaps illustrate the within-species (and between-species) comparison results by using TROM, Pearson correlation and Spearman correlation. Greater similarities are shown in darker colors. The results show that compared to the popular Pearson and Spearman correlations, TROM can find clearer correspondence patterns. \\verb|TROM| takes gene expression matrices and orthologous genes of the species of interest as input. The functions \\verb|select.associated.genes| and \\verb|select.associated.|\\ \\verb|orthologs| select the associated genes of different biological samples among all the genes or only among the genes with orthologs in the other species to be compared with. They also provide graphical summaries of the numbers of selected associated genes and orthologs. The functions \\verb|ws.trom| and \\verb|ws.trom.orthologs| perform the within-species transcriptome comparison, find the overlapping associated genes between every two samples and calculate within-species TROM scores. The function \\verb|bs.trom| performs the between-species transcriptome comparison, find the overlapping associated orthologs between every two samples from different species and calculate the between-species TROM scores. The function \\verb|heatmap.3| visualizes the TROM scores in a heatmap, with various add-on options for customization. The functions \\verb|find.top.GO.terms| and \\verb|find.top.GO.slim.terms| perform gene set enrichment analysis and find top enriched Gene Ontology (GO) terms and GO slim terms in the associated genes. Instead of using the selected associated genes, users may input customized gene lists representing characteristics of different biological samples into the above functions. Please see the package manual and vignette of \\verb|TROM| for details.}\n\\label{outline}\n\\end{figure}\n\n\n\\begin{figure}[!pb]\n\\centerline{\\includegraphics[width=\\linewidth]{correlation_associated.pdf}}\n\\caption{Correlation measures calculated based on the union of associated genes. \\textbf{A-B:} Pearson correlation (A) and Spearman correlation (B) for every pair of \\emph{D. melanogaster} stages calculated based on the union of associated genes of all stages. \n\\textbf{C-D:} Pearson correlation (C) and Spearman correlation (D) for every pair of \\emph{D. melanogaster} and \\emph{C. elegans} stages calculated based on the union of associated ortholog pairs of all stages.  Correlation measures based on only associated genes still cannot lead to clear correspondence patterns in the comparison of species.\n}\n\\label{cor_associated}\n\\end{figure}\n\n\n\n\\begin{figure}[!pb]\n\\centerline{\\includegraphics[width=\\linewidth]{micro_vs_rna.pdf}}\n\\caption{Correspondence maps of TROM scores. TROM scores are calculated using the RNA-seq data of \\emph{D. melanogaster} and the microarray data of the other five \\emph{Drosophila} species.  }\n\\label{micro_vs_rna}\n\\end{figure}\n\n\n\n\n\\begin{figure}[!pb]\n\\centerline{\\includegraphics[width=0.65\\linewidth]{Dmel_GO_rna.pdf}}\n\\caption{Top 20 enriched biological process GO terms of \\textit{D.melanogaster}. The enrichment scores in the heatmap were calculated through stage-associated genes identified from the RNA-seq data and are saturated at 6. For each stage, the common enriched GO terms identified from both microarray (Figure \\ref{fly_GO_micro}) and RNA-seq data sets are marked in red color. }\n\\label{fly_GO_rna}\n\\end{figure}\n\n\\begin{figure}[!tpb]\n\\centerline{\\includegraphics[width=0.85\\linewidth]{Dmel_GO_micro.pdf}}\n\\caption{Top 20 enriched biological process GO terms of \\textit{D.melanogaster}. The enrichment scores in the heatmap were calculated through stage-associated genes identified from the microarray data and are saturated at 6. For each stage, the common enriched GO terms identified from both microarray and RNA-seq (Figure \\ref{fly_GO_rna}) data sets are marked in red color.  }\n\\label{fly_GO_micro}\n\\end{figure}\n\n\n\n\\begin{figure}[!pb]\n\\centerline{\\includegraphics[width=\\linewidth, scale =1.5]{Mouse_top_10_GO_term.pdf}}\n\\caption{Top 10 enriched biological process GO terms of mouse liver. The enrichment scores in the heatmap \n were calculated through stage-associated genes identified from the microarray data. For each stage, the highly \n relevant GO terms that were confirmed in previous studies are marked in red color. }\n\\label{mouse_GO}\n\\end{figure}\n\n\n\\begin{figure}[!pb]\n\\centerline{\\includegraphics[width=\\linewidth, scale=1.3]{tree2.pdf}}\n\\caption{Developmental tree constructed using stage-associated genes. \\textbf{A}-\\textbf{F} are for \\emph{Drosophila} species and \\textbf{G} is for \\emph{C.elegans}.}\n\\label{tree_supp}\n\\end{figure}\n\n\n\n\n\n\\begin{figure}[!pb]\n\\centerline{\\includegraphics[width=0.95\\linewidth]{spearman_threshold.pdf}}\n\\cprotect\\caption{Spearman correlation of the developmental stages of \\emph{D. melanogaster} (fly) and \\emph{C. elegans} (worm). \\textbf{A}: The first panel shows Spearman correlation of fly's stages while the rest show Spearman correlation of fly's stages under different thresholds.  \\textbf{B}: The first panel shows Spearman correlation of worm's stages while the rest show Spearman correlation of worm's stages under different thresholds. \\textbf{C}: TROM scores of fly. \\textbf{D}: TROM scores of worm. All the values under the selected threshold are set to the minimum value of the coefficients in the correlation matrix.  }\n\\label{sp_thre}\n\\end{figure}\n\n\n\n\n\n", "itemtype": "equation", "pos": 50938, "prevtext": " These parameters are estimated from the RNA-seq data of \\emph{D. melanogaster}. For the {\\textcolor{black}{{scenario}}} without quantile normalization, we simulate $1000$ sets of {\\textcolor{black}{{$N \\times k$}}} expression matrices and multiply each column in the matrices by a random number drawn from normal distribution $N(0, 10s)$ to {\\textcolor{black}{{change}}} the range of expression values in each sample. For the {\\textcolor{black}{{scenario}}} with quantile normalization, we simulate $1000$ sets of expression matrices {\\textcolor{black}{{and apply}}} quantile {\\textcolor{black}{{normalization to them}}}. We then calculate the corresponding TROM scores of these simulated gene expression matrices. The {\\textcolor{black}{{$z$-score threshold of TROM is set as}}} $0.2$.}}}\n\n{\\textcolor{black}{{ We focus on the {\\textcolor{black}{{TROM scores of comparing the two samples}}} since {\\textcolor{black}{{it is trivial to compare a sample to itself}}}. We use Kolmogorov-Smirnov (KS) test to check whether the distribution of TROM {\\textcolor{black}{{scores}}} changes significantly with or without quantile normalization. The $p$-value of KS test on TROM scores is always 1 when shift parameter $s=1,2,\\dots,5$. This result suggests that TROM is robust to {\\textcolor{black}{{data without quantile normalization}}} and the correspondence patterns {\\textcolor{black}{{are stable}}}. }}}\n\n\n\n\n\n\\subsection {{\\textcolor{black}{{Robustness of TROM to different platforms: comparison of \\textit{D. melanogaster} developmental stages based on microarray and RNA-seq data}}}}\n\nAlthough many studies have claimed that RNA-seq is the technique of choice that provides more accurate estimation of absolute gene expression levels compared with microarray \\cite{zhao2014comparison,fu2009estimating}, several genome-wide analyses have also suggested that microarray can measure the expression of above-median expressed genes reasonably well, and on these genes the two platforms have good concordance \\cite{wang2014concordance}. Since microarray has been widely used to study transcriptomes of multiple species under various conditions in the past decade, it is desirable to have a good comparative transcriptomic method that is robust to the platform difference of microarray and RNA-seq data. \n\nHere we demonstrate the robustness of TROM by applying it to {\\textcolor{black}{{comparing}}} the microarray and RNA-seq data {\\textcolor{black}{{of}}} the developmental stages of \\textit{D. melanogaster}. If TROM is robust, it should identify strong correspondence between  similar developmental stages in the microarray and RNA-seq data. \n\nFor a pair of developmental stages, one with microarray data and the other with RNA-seq data, TROM identifies a set of associated genes for each of them based on all the stages {\\textcolor{black}{{with}}} microarray {\\textcolor{black}{{and}}} RNA-seq data, respectively. Then TROM performs the overlap test and produces a correspondence map.\n\nThe results show that TROM can find almost perfect correspondence of the same \\textit{D. melanogaster} embryonic stages between microarray or RNA-seq (Figure~\\ref{TROM_map}C).\n{\\textcolor{black}{{There are five other \\textit{Drosophila} species that}}} have similar developmental patterns as \\textit{D. melanogaster}, as we have already shown in the within-species and between-species comparison in Section \\ref{sec:TROM scores}. We also compare their microarray data {\\textcolor{black}{{of}}} embryonic stages with the RNA-seq data of \\textit{D. melanogaster} as a further check. In the result (Appendix Figure \\ref{micro_vs_rna}), we observe strong {\\textcolor{black}{{block}}} diagonal patterns. Although RNA-seq data contains larvae, prepupae, and adult stages that do not have {\\textcolor{black}{{corresponding}}} microarray data, the off-diagonal patterns, which we observe (1) between late embryos in microarray and prepupae in RNA-seq and (2) between early embryos in microarray and female adults in RNA-seq, are consistent with our previous within-species correspondence map based on RNA-seq data only \\cite{Li2014} and previous studies \\cite{Arbeitman2002}. These results show that TROM can find almost the same correspondence of \\textit{Drosophila} developmental stages {\\textcolor{black}{{regardless}}} of the platform being microarray or RNA-seq. \n\n\n\n\n\\subsection{Gene Ontology (GO) enrichment analysis}\n\nTo understand the biological functions behind the correspondence we {\\textcolor{black}{{have observed}}} between developmental stages, we perform enrichment analysis \\cite{ashburner2000gene} of biological process (BP) gene ontology (GO) terms in stage-associated genes, as a way to determine common biological functions and processes in corresponding stages.\nFirst, we examine the GO term enrichment in the associated genes of every \\emph{D. melanogaster} embryomnic stage, using RNA-seq data and microarray data respectively. The enrichment scores are defined as $-\\log_{10}(\\text{Bonferroni corrected}\\ p\\text{-value})$ where $p$-values are calculated based on a the hypergeometric test, and the results are illustrated in Appendix Figures \\ref{fly_GO_rna}, \\ref{fly_GO_micro}. {\\textcolor{black}{{For every fly embryonic stage, the}}} top 20 enriched GO terms {\\textcolor{black}{{in the associated genes}}} identified {\\textcolor{black}{{by}}} RNA-seq data {\\textcolor{black}{{contain biological functions highly relevant to these stages, and many of these terms have been discovered as enriched in {\\textcolor{black}{{relevant embryonic samples}}} by previous studies}}} \\cite{Li2014,puniyani2010spex2}. A proportion of these top enrichment GO terms with {\\textcolor{black}{{support in the literature}}} are listed in Table \\ref{flyGO}. {\\textcolor{black}{{The enriched GO terms identified from both RNA-seq and microarray data}}} support the {\\textcolor{black}{{correspondence}}} patterns observed in TROM correspondence maps: common enriched GO terms are often shared by adjacent stages {\\textcolor{black}{{whose pairwise TROM scores are high}}}. The top enriched GO terms {\\textcolor{black}{{found by both microarray and RNA-seq are informative for further functional studies on the associated genes of every stage, so as to better understand embryonic development of \\emph{D. melanogaster}}}}.\n\\begin{table}[t]\n\\caption{Selected enriched GO terms in each stage of \\emph{D. melanogaster}.}{\n\\resizebox{\\columnwidth}{!}{\n\\begin{tabular}{ll}\n\\hline\n{\\textcolor{black}{{Stage Name}}} & Top enriched GO terms  \\\\\n\\hline\nEmbryo 0-2h & oogenesis, DNA replication, germ cell development, neurogenesis\\\\\nEmbryo 2-4h & neurogenesis, mRNA splicing via spliceosome, zygotic determination of anterior/posterior axis\\\\\nEmbryo 4-6h & mRNA splicing via spliceosome, specification of segmental identity, cell fate specification\\\\\nEmbryo 6-8h & cell fate specification, sensory organ development, open tracheal system development\\\\\nEmbryo 8-10h & myoblast fusion, multicellular organism reproduction, puparial adhesion\\\\\nEmbryo 10-12h & myoblast fusion, translation, mitotic spindle elongation, septate junction assembly\\\\\nEmbryo 12-14h & axon guidance, septate junction assembly, branch fusion open tracheal system\\\\\nEmbryo 14-16h & circadian rhythm, response to light stimulus, crystal cell differentiation\\\\\nEmbryo 16-18h & chitin-based cuticle development, body morphogenesis, chitin metabolic process\\\\\nEmbryo 18-20h & body morphogenesis, chitin metabolic process, proteolysis\\\\\n\\hline\n\\end{tabular}\n}\n}\n\\label{flyGO}\n\\end{table}\n\n\n{\\textcolor{black}{{We also examine the GO term enrichment in the associated genes of every developmental stage of mouse liver}}}. The resulting enrichment scores are illustrated in Appendix Figure \\ref{mouse_GO}. The {\\textcolor{black}{{top 10 enriched}}} GO terms in our selected stage-associated genes {\\textcolor{black}{{of every stage}}} {\\textcolor{black}{{confirm}}} previous findings on liver development and regeneration. In E11.5-12.5, {\\textcolor{black}{{two of the early stages}}}, top enriched GO terms are {\\textcolor{black}{{mostly}}} cell cycle related terms like {\\textcolor{black}{{``translation\", ``mRNA processing\", ``cell cycle\" and ``cell division\"}}} \\cite{li2009multi}. Previous research has shown that mouse liver takes over the function of hematopoiesis at E10.5-12.5 \\cite{li2009multi,hata2007liver}{\\textcolor{black}{{,}}} and we found that the GO terms {\\textcolor{black}{{including ``heme biosynthetic process\" and ``porphyrin-containing compound biosynthetic process\"}}} are top enriched in subsequent stages. For {\\textcolor{black}{{stages}}} E17.5-Day7, the GO terms {\\textcolor{black}{{``innate immune response\" and ``immune system process\"}}} are top enriched, in accordance with the theory that liver is an organ with innate immune features \\cite{dong2007roles}. Finally, as the function of mouse liver {\\textcolor{black}{{switches}}} from hematopoiesis to metabolism and this capacity dominates in the adult liver \\cite{hata2007liver,li2009multi}, we {\\textcolor{black}{{observe}}} that GO terms related to various metobolic processes {\\textcolor{black}{{become}}} enriched in {\\textcolor{black}{{stages}}} E17.5-NL(normal adult liver tissue). These findings again illustrate the {\\textcolor{black}{{capacity}}} of the associated genes in capturing {\\textcolor{black}{{transcriptomic characteristics of biological samples}}}.\n\n\n\n\n\\subsection{Construction of developmental trees using stage-associated genes}\nWe further demonstrate that the selected stage-associated genes contain abundant information to group and distinct developmental stages. Tree construction has been a popular approach for studying the relationships of different developmental stages in organism development \\cite{Arbeitman2002} as well as cell lineages in cell differentiation \\cite{virmani2002hierarchical}. Here we attempt to construct developmental trees of diverse species (see Appendix Figure \\ref{tree_supp}) based on the identified associated genes of each developmental stage, reasoning that the associated genes capture stage characteristics and thus can lead to reasonable developmental trees. \n{\\textcolor{black}{{ In tree construction, both Simpson and Jacard similarity coefficients can be used to measure the distances between different samples. However, Simpson coefficent will produce a result of $1$ when {\\textcolor{black}{{the associated genes of one sample}}} is a subset of the {\\textcolor{black}{{associated genes of the other sample, and it}}} thus fails to distinguish two samples in this case. In contrast, Jacard coefficient is able to separate two biological samples in this case{\\textcolor{black}{{, because it}}} considers two samples as identical if and only if they have exactly the same associated genes. }}}\nAs a consequence, we carry out the tree construction by hierarchical clustering, using average linkage and Jaccard coefficient, where the distance between two stages $i$ and $j$ is calculated as\n\n", "index": 29, "text": "\\begin{equation}\nJ_{ij} = \\frac{|X_i\\cap X_j|}{|X_i| + |X_j| - |X_i\\cap X_j|}\\,,\n\\end{equation}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E16.m1\" class=\"ltx_Math\" alttext=\"J_{ij}=\\frac{|X_{i}\\cap X_{j}|}{|X_{i}|+|X_{j}|-|X_{i}\\cap X_{j}|}\\,,\" display=\"block\"><mrow><mrow><msub><mi>J</mi><mrow><mi>i</mi><mo>\u2062</mo><mi>j</mi></mrow></msub><mo>=</mo><mpadded width=\"+1.7pt\"><mfrac><mrow><mo stretchy=\"false\">|</mo><mrow><msub><mi>X</mi><mi>i</mi></msub><mo>\u2229</mo><msub><mi>X</mi><mi>j</mi></msub></mrow><mo stretchy=\"false\">|</mo></mrow><mrow><mrow><mrow><mo stretchy=\"false\">|</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy=\"false\">|</mo></mrow><mo>+</mo><mrow><mo stretchy=\"false\">|</mo><msub><mi>X</mi><mi>j</mi></msub><mo stretchy=\"false\">|</mo></mrow></mrow><mo>-</mo><mrow><mo stretchy=\"false\">|</mo><mrow><msub><mi>X</mi><mi>i</mi></msub><mo>\u2229</mo><msub><mi>X</mi><mi>j</mi></msub></mrow><mo stretchy=\"false\">|</mo></mrow></mrow></mfrac></mpadded></mrow><mo>,</mo></mrow></math>", "type": "latex"}]