[{"file": "1601.00946.tex", "nexttext": "\nBy the uniqueness assertion,\nwe obtain a cubical action ${\\operatorname{QI}}(X){\\curvearrowright} |{\\mathcal{B}}|$ of the quasi-isometry \ngroup of $X$ on $|{\\mathcal{B}}|$.\n\\end{theorem}\n\nWe point out that the partial rigidity statement of the theorem does not hold\nfor general RAAG's: it only holds for the RAAG's covered by the theorem in\n\\cite {huang2014quasi}.\n\n\n\\bigskip\\bigskip\n\n\\subsection*{The main results}\nWe will produce good geometric models quasi-isometric to $X({\\Gamma})$\nthat are simultaneously compatible with group actions,  the underlying\nbuilding $|{\\mathcal{B}}|$, and cubical structure.   The key idea for expressing this is:\n\n\n\\begin{definition}\n\\label{def_restriction_quotient}\nA cubical map \n $q:Y\\rightarrow Z$ between ${\\operatorname{CAT}}(0)$ cube complexes (see Definition \\ref{cubical map})\nis a {\\em restriction\nquotient}\nif it is  surjective, and the point inverse $q^{-1}(z)$  is a convex subset of $Y$ \nfor every $z\\in Z$.\n\\end{definition} \n\n\nIt turns out that restriction quotients as defined above are essentially \nequivalent to the class of mappings introduced by Caprace-Sageev \n\\cite{caprace2011rank} with a different definition (see\nSection \\ref{sec_restriction_quotients} \nfor the proof that the definitions are equivalent).  \nRestriction quotients $Y\\rightarrow |{\\mathcal{B}}|$ provide a means to ``resolve'' or \t``blow-up''\nthe locally infinite building $|{\\mathcal{B}}|$ to a locally finite ${\\operatorname{CAT}}(0)$ cube complex.\n\n\n\\begin{theorem}\n\\label{thm_main_intro_quasi_action}\n(See Section \\ref{sec_preliminaries} for definitions.)\nLet $H{\\curvearrowright} X$ be a quasi-action of an arbitrary group on $X=X({\\Gamma})$,\nwhere ${\\operatorname{Out}}(G({\\Gamma}))$ is finite and $G({\\Gamma})\\not\\simeq {\\mathbb Z}$.   Then there is an $H$-equivariant \nrestriction quotient $H{\\curvearrowright} Y\\stackrel{q}{{\\longrightarrow}}H{\\curvearrowright} |{\\mathcal{B}}|$\n\n\n\n\n\n\n\n\nwhere: \n\\begin{enumerate}[label=(\\alph*)]\n\\item $H{\\curvearrowright} |{\\mathcal{B}}|$ is the cubical action arising from the quasi-action $H{\\curvearrowright} X$\nusing Theorem \\ref{thm_main_intro_quasi_action}, and $H{\\curvearrowright} Y$ is a cubical  action.\n\\item The point inverse $q^{-1}(v)$ of every rank $k$ vertex $v\\in |{\\mathcal{B}}|^{(0)}$\nis a copy of ${\\mathbb R}^k$ with the usual cubulation.\n\\item $H{\\curvearrowright} X$ is \nquasiconjugate to the cubical action $H{\\curvearrowright} Y$.\n\\end{enumerate} \n\n\n\n\n\n\n\\end{theorem}\n\n\n\\begin{theorem}\n\\label{thm_main_intro}\nIf $|{\\operatorname{Out}}(G({\\Gamma}))|<\\infty$ and $G({\\Gamma})\\not\\simeq{\\mathbb Z}$, then  a finitely generated group $H$ \nis quasi-isometric to $G({\\Gamma})$ iff \n there is an $H$-equivariant \nrestriction quotient $H{\\curvearrowright} Y\\stackrel{q}{{\\longrightarrow}}H{\\curvearrowright} |{\\mathcal{B}}|$\nwhere \n\\begin{enumerate}[label=(\\alph*)]\n\\item $H{\\curvearrowright} Y$ is a geometric cubical  action.\n\\item $H{\\curvearrowright} |{\\mathcal{B}}|$ is cubical.\n\\item The point inverse $q^{-1}(v)$ of every rank $k$ vertex $v\\in |{\\mathcal{B}}|^{(0)}$\nis a copy of ${\\mathbb R}^k$ with the usual cubulation.\n\\end{enumerate}\n\\end{theorem}\n\\begin{remark}\nIn fact the restriction quotient $Y\\rightarrow |{\\mathcal{B}}|$ in Theorems\n\\ref{thm_main_intro_quasi_action} and \\ref{thm_main_intro} has slightly\nmore structure, see Theorem \\ref{thm_quasi_action1}.\n\\end{remark}\n\nIn particular, we have:\n\\begin{corollary}\n\\label{cor_intro_main} \nAny group quasi-isometric to $G$ is cocompactly cubulated, i.e.\nit has a geometric cubical action on a  ${\\operatorname{CAT}}(0)$ cube complex.\n\\end{corollary}\n\n\nOne may compare Theorem \\ref{thm_main_intro} with rigidity theorems for\nsymmetric spaces or products of trees, which characterize a quasi-isometry \nclass of groups by the existence of a geometric action on a model space of\na specified type\n\\cite{sullivan,gromov_hyperbolic_manifolds_groups,tukia,pansu,kleiner1997rigidity,stallings,dunwoody1985accessibility,kapovich1998quasi,mosher2003quasi,ahlin}.  \nAs in the case of products of trees --- and unlike the\ncase of symmetric spaces ---\nthere are finitely generated groups $H$ as in \nTheorem \\ref{thm_main_intro} which do not admit a\ngeometric action on the original model space $X$, so one is forced\nto pass to a different space $Y$ \\cite{bks2,huang2014quasi}.  Also, Theorems \\ref{thm_main_intro_quasi_action} \nand \\ref{thm_main_intro} fail for general RAAG's, for instance for \nfree abelian groups of rank $\\geq 2$, and for products of nonabelian\nfree groups $\\prod_{1\\leq j\\leq k} G_j$, for $k\\geq 1$.\n\n\nThe quasi-isometry invariance \nof the existence of a cocompact cubulation as asserted in Corollary\n\\ref{cor_intro_main} is false in general.\nSome groups quasi-isometric to ${\\mathbb H}^2\\times{\\mathbb R}$ \nadmit a cocompact cubulation, while others are not virtually $CAT(0)$\n\\cite{bridson_haefliger}.   Combining \n\\cite{leeb}, \\cite{behrstock2008quasi} and \\cite{hagen_przytycki}, \nit follows that there is a\npair of quasi-isometric $CAT(0)$ graph manifold groups, one of which \nis the fundamental group of a compact special cube complex, while the\nother is not virtually cocompactly cubulated.\nThe  quasi-isometry invariance of cocompact cubulations fails to hold even among RAAG's:\nfor $n>1$\nthere are groups  \nquasi-isometric  ${\\mathbb R}^n$ that are not cocompactly cubulated\n\\cite{hagen_crystallographic}.\n\nEarlier cocompact\ncubulation theorems in the spirit of  Corollary \\ref{cor_intro_main} \ninclude \nthe cases of groups quasi-isometric to trees, products of trees, and \nhyperbolic $k$-space ${\\mathbb H}^k$ for $k\\in \\{2,3\\}$\n\\cite{stallings,dunwoody1985accessibility,kapovich1998quasi,mosher2003quasi,ahlin,gitik_widths,kahn_markovic,bergeron_wise}.  \nIt is worth noting that each case requires\ndifferent ingredients that are specific to the spaces in question.  \n\n\n\n\n\n\n\n\n\n\n\n\\subsection*{Further results}\nWe briefly discuss some further results here, referring the reader to the\nbody of the paper for details.\n\nOne portion of the proof of Theorem \\ref{thm_main_intro_quasi_action} has\nto do with \nthe geometry of restriction quotients, and more specifically, restriction\nquotients with a right-angled building as target.  We view this as a \ncontribution to cube complex geometry, and to the geometric theory of \ngraph products; beyond the \nreferences mentioned already, our treatment has been\ninfluenced by the papers of Januszkiewicz-Swiatkowski and Haglund  \n\\cite{januszkiewicz_swiatkowski,haglund2008finite}.\nThe main results on this are:\n\n\n\\begin{enumerate}[label=(\\alph*)]\n\\item We show in Section \\ref{sec_restriction_quotients}\nthat restriction quotients  may be characterized\nin several different ways.  \n\\item We show that having a restriction quotient $q:Y \\rightarrow Z$\nis equivalent to \nknowing certain ``fiber data'' living on the target complex $Z$.  \n\\item When $|{\\mathcal{B}}|$ is the Davis realization of  a right-angled\nbuilding ${\\mathcal{B}}$ and $Y\\rightarrow |{\\mathcal{B}}|$ is a restriction\nquotient whose fibers are copies of ${\\mathbb R}^k$ with dimension specified \nas in Theorems \\ref{thm_main_intro_quasi_action} and \\ref{thm_main_intro},\nthe fiber data in (b) may be distilled even more, leading to what we call\n``blow-up data''.   \n\\end{enumerate}\n\nAs by-products of (a)-(c), we obtain:\n\n\\begin{itemize}\n\\item A characterization of the quasi-actions $H{\\curvearrowright} X({\\Gamma})$ that are \nquasiconjugate to isometric actions $H{\\curvearrowright} X({\\Gamma})$ (Section \\ref{subsection_nicer action}).\n\\item A characterization of the restriction quotients $Y\\rightarrow |{\\mathcal{B}}|$\nsatisfying (b) of Theorem \\ref{thm_main_intro_quasi_action}\nfor which $Y$ is quasi-isometric to $X$ (Corollary \\ref{if and only if} and Theorem \\ref{quasi-isometry to G}).  \n\\item A proof of uniqueness of the right-angled building modelled\non the right-angled Coxeter group $W({\\Gamma})$ with defining graph ${\\Gamma}$,\nwith countably infinite rank $1$ residues (Corollary \\ref{uniqueness of building}).\n\\item Applications to more general graph products (Theorem \\ref{geometric action}).\n\\end{itemize}\n\nIt follows from \\cite{kleiner2001groups} that a finitely generated group $H$ \nquasi-isometric to a symmetric space of noncompact type $X$ admits\nan epimorphism $H\\rightarrow {\\Lambda}$ with finite kernel, where ${\\Lambda}$ is a \ncocompact lattice in the isometry group ${\\operatorname{Isom}}(X)$.  \nIn contrast to this, we have the following result,\nwhich is inspired by \\cite[Theorem 9, Corollary 10]{mosher2003quasi}:\n\n\n\\begin{theorem}\n\\label{thm_no_overgroup}\n(See Section \\ref{subsection_nicer action})\nSuppose $G$ is a RAAG with $|{\\operatorname{Out}}(G)|<\\infty$.\nThen there are finitely generated groups $H$ and $H'$ quasi-isometric to \n$G$  that do not admit discrete, virtually faithful cocompact\nrepresentations into\nthe same locally compact topological group.\n\\end{theorem} \n\n\\subsection*{Open questions}\nAs mentioned above, Corollary \\ref{cor_intro_main} may be considered part\nof the quasi-isometry classification program for finitely generated groups.\nThe leads to:\n\n\\begin{question}\n\\label{que_commensurability}\nIf ${\\operatorname{Out}}(G({\\Gamma}))$ is finite, what is the commensurability classification of\ngroups quasi-isometric to $G({\\Gamma})$?\nAre they all commensurable to $G({\\Gamma})$? What about cocompact lattices\nin the automorphism group of $X({\\Gamma})$?\n\\end{question}\nFor comparison, we recall that any  group quasi-isometric\nto a tree is commensurable to a free group, but there are groups\nquasi-isometric to a product of trees that contain no nontrivial \nfinite index subgroups, and are therefore not commensurable to\na product of free groups \\cite{wise1996non,burger_mozes}.\n\nWe mention that Theorem \\ref{thm_main_intro}\nwill be used in forthcoming \nwork to  answer Question \\ref{que_commensurability} in certain cases.\n\n\n\n\\bigskip\n\n\\subsection*{Discussion of the proofs}\nBefore sketching the arguments for Theorems \n\\ref{thm_main_intro_quasi_action} and\n\\ref{thm_main_intro}, we first illustrate\nthem in the tautological case when $H=G$ and the quasi-action is the \ndeck group action\n$G{\\curvearrowright} X$.  In this case we cannot take $Y=X$, as there is no\n$H$-equivariant restriction quotient $H{\\curvearrowright} X\\rightarrow H{\\curvearrowright} |{\\mathcal{B}}|$\nsatisfying (c) of Theorem \\ref{thm_main_intro}.  Instead, we\nuse a different geometric model.  \n\n\\begin{definition}[Graph products of spaces \\cite{haglund2008finite}]\n\\label{def_graph_product_of_spaces}\nFor every vertex $v\\in V({\\Gamma})$, choose a pointed geodesic metric space\n$(Z_v,\\star_v)$.  The {\\em ${\\Gamma}$-graph product of  \n$\\{(Z_v,\\star_v)\\}_{v\\in V({\\Gamma})}$}\nis obtained by forming the product $\\prod_v (Z_v,\\star_v)$, and passing\nto the union of the subproducts corresponding to the cliques in ${\\Gamma}$.\nWe denote this by $\\prod_{\\Gamma} (Z_v,\\star_v)$.\nWhen the $Z_v$'s are nonpositively curved, then so is the\ngraph product \\cite[Corollary 4.6]{haglund2008finite}.\n\\end{definition}\n\n\nThere are three graph products that are useful here:\n\\begin{enumerate}\n\\item The\nSalvetti complex $S({\\Gamma})$ is the graph product $\\prod_{\\Gamma}(S^1_v,\\star_v)$,\nwhere $(S^1_v,\\star_v)$ is a pointed unit circle.\n\\item  For every $v\\in V({\\Gamma})$, let $(L_v,\\star_v)$\nbe a pointed lollipop, i.e. $L_v$ is the wedge of the \nunit  circle $S^1_v$\nand a unit interval $I_v$, and the basepoint $\\star_v\\in L_v$ is the vertex\nof valence $1$.   Then the graph product \n$\\prod_{\\Gamma}(L_v,\\star_v)$ is the {\\em exploded Salvetti \ncomplex $S_e=S_e({\\Gamma})$.} We denote its universal covering \nby $X_e\\rightarrow S_e$.\n\\item If  $(Z_v,\\star_v)$  is a unit interval and $\\star_v\\in Z_v$ is an endpoint\nfor every $v\\in V({\\Gamma})$, then the graph product \n$\\prod_{\\Gamma} (Z_v,\\star_v)$ is the {\\em Davis chamber}, \ni.e. it is a copy of the Davis realization $|c|$ of a chamber $c$ in \n$|{\\mathcal{B}}|({\\Gamma})$;  \n for this reason we will denote it by $|c|_{\\Gamma}$.\n\\end{enumerate}\nBy collapsing  the  interval $I_v$ in each lollipop $L_v$\nto a point, we obtain a cubical map $S_e\\rightarrow S$; this has  \ncontractible point inverses, and  is therefore  a homotopy \nequivalence.  If we collapse the circles $S^1_v\\subset L_v$\nto points instead, we get a  map $S_e \\rightarrow |c|_{\\Gamma}$ to the Davis chamber\nwhose point \ninverses are closed, locally convex tori.  The point inverses of the \ncomposition $X_e\\rightarrow S_e\\rightarrow |c|_{\\Gamma}$ cover the torus point inverses of \n$S_e\\rightarrow |c|_{\\Gamma}$, and their connected components form a ``foliation'' of $X_e$\nby flat convex subspaces.  It turns out that by collapsing $X_e$ along\nthese flat subspaces, we obtain a copy of $|{\\mathcal{B}}|$, and the quotient map\n$X_e\\rightarrow |{\\mathcal{B}}|$ is a restriction quotient $X_e\\rightarrow |{\\mathcal{B}}|$.  Alternately,\none may take the collection $\\mathcal{K}$ of hyperplanes  of $X_e$ \ndual to edges ${\\sigma}\\subset X_e$ whose projection under $X_e\\rightarrow |c|_{\\Gamma}$ is\nan edge, and form the restriction quotient using the Caprace-Sageev\nconstruction.\n\n\n\\begin{remark}\nThe exploded Salvetti complex and the restriction quotient $X_e\\rightarrow |{\\mathcal{B}}|$\nwere discussed  in \\cite{bks2} in the $2$-dimensional\ncase, using an ad hoc construction that was initially \ninvented for ``ease of visualization''.  However, the authors were unaware of\nthe  general description above, and the notion of restriction \nquotient had not yet appeared. \n\\end{remark}\n\nWe now discuss the proofs of Theorem \\ref{thm_main_intro_quasi_action}\nand the forward direction of \\ref{thm_main_intro}.\n\n\nThe \nforward direction of Theorem \\ref{thm_main_intro} reduces to Theorem \n\\ref{thm_main_intro_quasi_action}, by the standard observation that\na quasi-isometry $H\\rightarrow G\\stackrel{qi}{\\simeq}X$ allows us to \nquasiconjugate the left translation action $H{\\curvearrowright} H$ to a quasi-action\n$H{\\curvearrowright} X$.  Therefore we focus on Theorem \\ref{thm_main_intro_quasi_action}.\n\nLet $H{\\curvearrowright} X$ be as in Theorem \\ref{thm_main_intro_quasi_action}.  By a \nbounded perturbation, we may assume that this quasi-action preserves the\n$0$-skeleton $X^{(0)}\\subset X$.  Applying\nTheorem \\ref{thm_intro_vertex_rigidity}, we may further assume that we\nhave an action $H{\\curvearrowright} X^{(0)}$ by flat-preserving quasi-isometries.  The \nfact the we have an action, rather than just a quasi-action, \ncomes from the\nuniqueness in Theorem \\ref{thm_main_intro_quasi_action}; this turns\nout to be a crucial point in the sequel.\n\nBefore proceeding further, we remark that if one is only interested in \nCorollary \\ref{cor_intro_main} as opposed to the more refined statement in \nTheorem \\ref{thm_main_intro}, then there is an alternate approach using \nwallspaces.  This is treated in Sections \\ref{sec_construction of wallspace}\nand \\ref{sec_property of wallspace}.\n\nGiven a standard geodesic $\\ell\\subset X$, the parallel set $P_\\ell\\subset X$\ndecomposes as a product ${\\mathbb R}_\\ell\\times Q_\\ell$, where ${\\mathbb R}_\\ell$ is a copy\nof ${\\mathbb R}$;  likewise there\nis a product decomposition of $0$-skeleta \n$P_\\ell^{(0)}\\simeq {\\mathbb Z}_\\ell\\times Q_\\ell^{(0)}$.  One argues that\nthe action $H{\\curvearrowright} X^{(0)}$ permutes the collection of \n$0$-skeleta $\\{P_\\ell^{(0)}\\}_{\\ell}$, and that for any $\\ell$, the stabilizer\n${\\operatorname{Stab}}(P_\\ell^{(0)},H)$ \nof $P_\\ell^{(0)}$ in $H$ acts on $P_\\ell^{(0)}\\simeq {\\mathbb Z}_\\ell\\times Q_\\ell^{(0)}$\npreserving the product structure.  We call the \naction ${\\operatorname{Stab}}(P_\\ell^{(0)},H){\\curvearrowright} {\\mathbb Z}_\\ell$ a {\\em factor action}.  The factor\nactions are by bijections with  quasi-isometry constants \nbounded uniformly independent of $\\ell$.\n\nIt turns out that factor actions  play\na central role in the story.  For instance, when the action $H{\\curvearrowright} X^{(0)}$ \nis the restriction of an action $H{\\curvearrowright} X$ by cubical isometries, then \nthe factor actions $H_{[\\ell]}{\\curvearrowright} {\\mathbb Z}_{[\\ell]}$ are also actions by isometries.\nIn general the factor actions can be arbitrary: up to isometric\nconjugacy, any action $A{\\curvearrowright} {\\mathbb Z}$\nby quasi-isometries with uniform constants can arise as a factor\naction for some action as in Theorem \\ref{thm_main_intro_quasi_action}.  \nA key step in the proof is to show that such actions have a relatively\nsimple structure:\n\\begin{proposition}[Semiconjugacy]\n\\label{prop_intro_semiconjugacy}\nLet $U\\stackrel{\\rho_0}{{\\curvearrowright}} {\\mathbb Z}$ be an action of an arbitrary\ngroup by $(L,A)$-quasi-isometries. \nThen there is an\nisometric action $U\\stackrel{\\rho_1}{{\\curvearrowright}}{\\mathbb Z}$ and  \nsurjective equivariant $(L',A')$-quasi-isometry \n\n", "itemtype": "equation", "pos": 10332, "prevtext": "\n\n\n\\title{Groups quasi-isometric to RAAG's}\n\\author{Jingyin Huang}\n\\author{Bruce Kleiner}\n\n\\date{\\today}\n\\maketitle\n\n\\begin{abstract}\nWe characterize groups quasi-isometric to a right-angled Artin group $G$ \nwith finite outer automorphism group.   In particular all such groups admit a geometric action on \na ${\\operatorname{CAT}}(0)$ cube complex that has an equivariant ``fibering'' over the Davis\nbuilding of $G$.\n \n\n\n\n\n\n\n\n\n\\end{abstract}\n\n\n\\section{Introduction}\n\n\n\n\\subsection*{Overview}\nIn this paper we will study right angled\nArtin groups (RAAG's).\nLike other authors, our motivation for considering these groups\nstems from the fact that they are an easily defined yet\nremarkably rich class of objects, exhibiting interesting features\nfrom many different vantage points: \nalgebraic structure (subgroup structure, automorphism groups)\n\\cite{droms1987isomorphisms,servatius1989automorphisms,laurence1995generating,charney_vogtmann_crisp}, finiteness properties\n\\cite{bestvina1997morse,brady2001connectivity}, representation varieties\n\\cite{kapovich_millson},\n$CAT(0)$ geometry \\cite{croke2000spaces}, cube complex geometry\n\\cite{wise,haglund_wise_special}, and coarse geometry \n\\cite{wise1996non,burger_mozes,bks2,behrstock2008quasi,MR2727658,huang_quasiflat,huang2014quasi}. \nFurther impetus for studying RAAG's comes from\ntheir  role in the theory of special cube complexes, \nwhich was a key ingredient in Agol's spectacular solution of Thurston's\nvirtual Haken and virtual fibered conjectures  \n\\cite{agol,wise,haglund_wise_special,MR1347406,kahn_markovic}.\n\nOur focus here is on \nquasi-isometric rigidity, which is part of \nGromov's program for quasi-isometric classification of\ngroups and metric spaces.  \nIn this paper we build on \\cite{bks1,bks2,huang_quasiflat,huang2014quasi}, \nwhich analyzed the structure\nof individual quasi-isometries $G\\rightarrow G$, where $G$ is \na RAAG with finite outer automorphism group.\nOur main results are a structure theorem for groups of quasi-isometries \n(more precisely quasi-actions), and a characterization of finitely\ngenerated groups quasi-isometric to such RAAG's.  Both are formulated \nusing a geometric description\nin terms of Caprace-Sageev restriction quotients  \n\\cite{caprace2011rank} and the Davis building \\cite{davis_buildings_are_cat0}.\n \n\n\\subsection*{Background}\nPrior results on quasi-isometric\nclassification of RAAG's may be loosely divided into two types: \ninternal quasi-isometry\nclassification among (families of) RAAG's, \nand  quasi-isometry rigidity results characterizing arbitrary finitely\ngenerated groups quasi-isometric to a given RAAG.\nIn the former category, it is known   \nthat to classify RAAG's up to quasi-isometry, it suffices to consider the \ncase when the groups are $1$-ended and do not admit any nontrivial direct product\ndecomposition, or equivalently, when their defining graphs are connected,\ncontain more than one vertex, and do not admit a nontrivial join\ndecomposition\n(\\cite[Theorem 2.9]{huang2014quasi},\n\\cite{papasoglu2002quasi,kapovich1998quasi}).  \nThis covers, for instance, the classification  up to quasi-isometry of\nRAAG's that may be formed inductively by taking products or free products,\nstarting from copies of ${\\mathbb Z}$.\nBeyond this, internal classification is known for RAAG's whose  defining graph \nis a tree \\cite{behrstock2008quasi} or a higher dimension analog\n\\cite{MR2727658}, or when the outer automorphism\ngroup is finite \\cite{huang2014quasi,bks2}.\nGeneral quasi-isometric classification \nresults in the literature are much more limited; if $H$ is a \nfinitely generated group quasi-isometric to a RAAG $G$ then:\n\\begin{enumerate}[label=(\\roman*)]\n\\item If $G$ is  free or free abelian,  $H$ is virtually\nfree or free abelian, respectively \\cite{stallings,dunwoody1985accessibility,bass1972degree,gromov1981groups}.\n\\item If $G=F_k\\times {\\mathbb Z}^\\ell$, then $H$ is virtually $F_k\\times {\\mathbb Z}^\\ell$ \\cite{whyte2010coarse}.\n\\item If the defining graph of \n$G$ is a tree, then $H$ is virtually a RAAG having a tree\nas defining graph \\cite{behrstock2008quasi,kapovich1997quasi}.\n\\item If $G$ is a product of free groups, then $H$ acts geometrically\non a product of trees \\cite{ahlin,kapovich1998quasi,mosher2003quasi}.\n\\end{enumerate}\nUnlike (i)-(iii), which give characterizations up to commensurability, \nthe  characterization in (iv) only asserts the existence of an action on a \ngood geometric model; the stronger commensurability assertion is false,\nin view of examples of Wise and Burger-Mozes\n\\cite{wise1996non,burger_mozes}.\n\n\n\n\\subsection*{The setup}\nWe now recall some terminology and notation;\nsee Section \\ref{sec_preliminaries} for more detail.\n\nIf ${\\Gamma}$ is a finite simplicial graph with vertex\nset $V({\\Gamma})$, we denote the\nassociated right-angled Artin group by $G({\\Gamma})$.  \nThis is the fundamental group of the Salvetti complex $S({\\Gamma})$, a nonpositively\ncurved cube complex that may be constructed by choosing a pointed unit\nlength circle $(S^1_v,\\star_v)$ for every vertex $v\\in V({\\Gamma})$,\nforming the pointed product torus $\\prod_v (S^1_v,\\star_v)$, \nand passing to the union of\nthe product subtori corresponding to the cliques (complete subgraphs) in ${\\Gamma}$.  \nThe clique subtori are the {\\em standard tori} in $S({\\Gamma})$.\n\n\nWe denote the universal covering by $X({\\Gamma})\\rightarrow S({\\Gamma})$; here $X({\\Gamma})$\nis a ${\\operatorname{CAT}}(0)$ cube complex on which $G({\\Gamma})$ acts geometrically by \ndeck transformations.   \nThe inverse image of a standard torus\nin $S({\\Gamma})$ under the universal covering $X({\\Gamma})\\rightarrow S({\\Gamma})$\nbreaks up into connected components;\nthese are the {\\em standard flats} in $X({\\Gamma})$ which we partial order \nby inclusion.  Note that we include\nstandard tori and standard flats of dimension $0$.\n\n\nThe poset of standard flats in $X({\\Gamma})$ turns out to be\ncrucial to our story.  Using it one may define \n a locally infinite  ${\\operatorname{CAT}}(0)$ cube complex $|{\\mathcal{B}}|({\\Gamma})$ whose cubes\nof dimension $k\\geq 0$\nare indexed by inclusions $F_1\\subset F_2$, and $F_1,F_2$ are standard flats\nwhere $\\dim F_2=\\dim F_1 + k$.  Elements of the $0$-skeleton\n $|{\\mathcal{B}}|^{(0)}({\\Gamma})$ correspond to the trivial inclusions $F\\subset F$\nwhere $F$ is a standard flat, so we will identify $|{\\mathcal{B}}|^{(0)}({\\Gamma})$\nwith the collection of standard flats, and define the rank of a vertex\nof $|{\\mathcal{B}}|({\\Gamma})$ to be the dimension of the corresponding standard flat;\nin particular we may identify the $0$-skeleton\n$X^{(0)}({\\Gamma})$ with the set of rank $0$ vertices of \n$|{\\mathcal{B}}|^{(0)}$.\nSince $G({\\Gamma}){\\curvearrowright} X({\\Gamma})$ preserves the collection of standard flats, \nthere is an induced action\n$G({\\Gamma}){\\curvearrowright}|{\\mathcal{B}}|({\\Gamma})$ by cubical isomorphisms.\nThe above description is a slight variation on\nthe original construction of the same object given by \nDavis, in which one  views $|{\\mathcal{B}}|({\\Gamma})$ as the Davis realization of a\ncertain right-angled building ${\\mathcal{B}}({\\Gamma})$ associated with $G({\\Gamma})$, where\nthe apartments of ${\\mathcal{B}}({\\Gamma})$ are\nmodelled on the right-angled Coxeter group \n$W({\\Gamma})$ with defining graph ${\\Gamma}$; see \\cite{davis_buildings_are_cat0}\nand Section \\ref{sec_preliminaries}.   By abuse of terminology\nwe will refer to this cube complex as the {\\em Davis building\nassociated with $G({\\Gamma})$}; it has been called the \nmodified Deligne complex in \\cite{charney_davis_kpi1_problem} \nand flat space in \\cite{bks1}.\n\n\nThe following lemma is not difficult to prove.\n\\begin{lemma}\n\n\\mbox{}\n\\begin{itemize}\n\\item Every isomorphism $|{\\mathcal{B}}|^{(0)}({\\Gamma})\\rightarrow |{\\mathcal{B}}|^{(0)}({\\Gamma})$ \nof the poset of standard flats\nextends to a unique cubical isomorphism $|{\\mathcal{B}}|({\\Gamma})\\rightarrow |{\\mathcal{B}}|({\\Gamma})$ $($Section \\ref{building}$)$.\n\\item  Every cubical isomorphism of $|{\\mathcal{B}}|\\rightarrow |{\\mathcal{B}}|$ induces  a poset\nisomorphism $|{\\mathcal{B}}|^{(0)}\\rightarrow |{\\mathcal{B}}|^{(0)}$ $($Lemma \\ref{rank preserving}$)$.\n\\item A bijection $\\phi^{(0)}:|{\\mathcal{B}}|^{(0)}({\\Gamma})\\supset\nX^{(0)}({\\Gamma})\\rightarrow X^{(0)}({\\Gamma})\\subset |{\\mathcal{B}}|^{(0)}({\\Gamma})$  induces/extends to a \nposet isomorphism $|{\\mathcal{B}}|^{(0)}({\\Gamma})\\rightarrow |{\\mathcal{B}}|^{(0)}({\\Gamma})$ iff it\nis\nflat-preserving in the sense that for every standard flat\n$F_1\\subset X({\\Gamma})$, the $0$-skeleton $F_1^{(0)}$ is mapped bijectively\nby $\\phi^{(0)}$ onto the\n$0$-skeleton of some standard flat $F_2$ $($Section \\ref{subsection_canonical restriction quotient}$)$.\n\\end{itemize}\n\\end{lemma}\n\n\\begin{remark}\nWe caution the reader \nthat a cubical isomorphism $|{\\mathcal{B}}|({\\Gamma})\\rightarrow |{\\mathcal{B}}|({\\Gamma})$ need not arise from\nan isomorphism ${\\mathcal{B}}({\\Gamma})\\rightarrow {\\mathcal{B}}({\\Gamma})$ of the right-angled building.\n\\end{remark}\n\n\n\n\n\\subsection*{Rigidity and flexibility}\nWe now fix a finite graph ${\\Gamma}$ such that the outer\nautomorphism group ${\\operatorname{Out}}(G({\\Gamma}))$ is finite;\nby  work of \\cite{charney2012random,day_out}, one may view this\nas the generic case.   The reader may  find it helpful to keep in mind the case when \n${\\Gamma}$ is a pentagon. \n\nSince there is no ambiguity \nin ${\\Gamma}$ we will often suppress it in the notation below. \n\n\n\nIt is known that in this case $X=X({\\Gamma})$ is not quasi-isometrically\nrigid: there are quasi-isometries that are not at finite sup distance\nfrom isometries, and there are finitely generated groups $H$ that\nare quasi-isometric to $X$, but do not admit geometric actions on \n$X$ (Corollary \\ref{no action}).  On the other hand, quasi-isometries \nexhibit a form of  partial\nrigidity that is captured by the building $|{\\mathcal{B}}|$:\n\\begin{theorem}[\\cite{huang2014quasi,bks2}]\n\\label{thm_intro_vertex_rigidity}\nSuppose ${\\operatorname{Out}}(G(\\Gamma))$ is finite and $G({\\Gamma})\\not\\simeq{\\mathbb Z}$. If $\\phi:X^{(0)}\\rightarrow X^{(0)}$ is an $(L,A)$-quasi-isometry,\nthen there is a unique cubical isomorphism  $|{\\mathcal{B}}|\\rightarrow |{\\mathcal{B}}|$\nsuch that associated flat-preserving bijection\n$\\bar\\phi:X^{(0)}\\rightarrow X^{(0)}$ is at finite sup\ndistance from $\\phi$, and moreover\n\n", "index": 1, "text": "$$\nd(\\bar\\phi,\\phi)=\\sup\\{v\\in X^{(0)}\\mid d(\\bar\\phi(v),\\phi(v))\\}\n<D=D(L,A)\\,.\n$$\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex1.m1\" class=\"ltx_Math\" alttext=\"d(\\bar{\\phi},\\phi)=\\sup\\{v\\in X^{(0)}\\mid d(\\bar{\\phi}(v),\\phi(v))\\}&lt;D=D(L,A)\\,.\" display=\"block\"><mrow><mrow><mrow><mi>d</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mover accent=\"true\"><mi>\u03d5</mi><mo stretchy=\"false\">\u00af</mo></mover><mo>,</mo><mi>\u03d5</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mrow><mo movablelimits=\"false\">sup</mo><mo>\u2061</mo><mrow><mo stretchy=\"false\">{</mo><mrow><mi>v</mi><mo>\u2208</mo><msup><mi>X</mi><mrow><mo stretchy=\"false\">(</mo><mn>0</mn><mo stretchy=\"false\">)</mo></mrow></msup></mrow><mo>\u2223</mo><mrow><mi>d</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mrow><mover accent=\"true\"><mi>\u03d5</mi><mo stretchy=\"false\">\u00af</mo></mover><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>v</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>,</mo><mrow><mi>\u03d5</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>v</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo stretchy=\"false\">)</mo></mrow></mrow><mo stretchy=\"false\">}</mo></mrow></mrow><mo>&lt;</mo><mi>D</mi><mo>=</mo><mrow><mi>D</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>L</mi><mo>,</mo><mi>A</mi><mo rspace=\"4.2pt\" stretchy=\"false\">)</mo></mrow></mrow></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.00946.tex", "nexttext": "\nwhere $L'$ and $A'$ depend only on $L$ and $A$.\n\\end{proposition}\nThe assumption that $\\rho_0$ is an action, as opposed\nto a quasi-action, is crucial:\nif a group $U$ has a nontrivial\nquasihomomorphism $\\alpha:U\\rightarrow {\\mathbb R}$, then the translation quasi-action\n$U\\stackrel{\\hat\\alpha}{{\\curvearrowright}}{\\mathbb R}$ defined by  $\\hat\\alpha(u)(x)=x+\\alpha(u)$\nis quasiconjugate to a quasi-action on ${\\mathbb Z}$, but not to an isometric\naction on ${\\mathbb Z}$.  \n\nIt follows immediately from the\nProposition \\ref{prop_intro_semiconjugacy} that $U\\stackrel{\\rho_0}{{\\curvearrowright}}{\\mathbb Z}$\nis quasiconjugate to an isometric action on the tree ${\\mathbb R}$.\nIn that respect Proposition \\ref{prop_intro_semiconjugacy} is similar to\nthe theorem of Mosher-Sageev-Whyte \nabout promoting quasi-actions on bushy trees to isometric actions on trees\n\\cite[Theorem 1]{mosher2003quasi}.\nSince ${\\mathbb R}$ is not \nbushy  \\cite[Theorem 1]{mosher2003quasi} does not apply, and indeed the \nexample\nabove shows that the assumption of bushiness is essential in that theorem.\n\n\nContinuing with   the proof of Theorem \\ref{thm_main_intro_quasi_action},\nProposition \\ref{prop_intro_semiconjugacy} gives a good geometric\nmodel for the factor action ${\\operatorname{Stab}}(P_\\ell^{(0)},H){\\curvearrowright} {\\mathbb Z}_\\ell$: we \nsimply extend each isometry ${\\mathbb Z}_\\ell\\rightarrow{\\mathbb Z}_\\ell$ to an isometry \n${\\mathbb R}_\\ell\\rightarrow {\\mathbb R}_\\ell$, thereby obtaining a cubical action\n${\\operatorname{Stab}}(P_\\ell^{(0)},H){\\curvearrowright} {\\mathbb R}_\\ell$.  \nIn vague terms, the remainder of the proof is concerned with combining \nthese cubical models into models for the fibers of a restriction\nquotient $Z\\rightarrow |{\\mathcal{B}}|$, in an $H$-equivariant way.  This portion of the proof\nis covered by more general results about restriction quotients, see\n(b)-(c) in the subsection on further results above. \n\n\n\\subsection*{Organization of the paper}\n\nThe paper is divided into three relatively independent parts. We first outline the content of each part, then give suggestions \nfor readers who want to focus on one particular part.\n\nA summary of notation can found in Section \\ref{sec_index_of_notation}. Section \\ref{sec_preliminaries} contains some background material on quasi-actions, $CAT(0)$ cube complexes, RAAG's and buildings. One can proceed directly to later sections with Section \\ref{sec_index_of_notation} and Section \\ref{sec_preliminaries} as references.\n\nThe main part of the paper is Section \\ref{sec_restriction_quotients} to Section \\ref{sec_quasi action on Z}, where we prove Theorem \\ref{thm_main_intro}. In Section \\ref{sec_restriction_quotients} we discuss restriction\nquotients, showing how to construct a restriction quotient $Y\\rightarrow Z$ starting\nfrom the target $Z$ and an admissible assignment of fibres to the cubes of $Z$. Then we discuss equivariance properties and the coarse geometry of restriction quotients.\n\nIn Section \\ref{sec_blow-up of building}, we introduce blow-ups of buildings based on Section \\ref{sec_restriction_quotients}.  These are restriction quotients\n$Y\\rightarrow |{\\mathcal{B}}|$ where the target is a right-angled building and the fibres are Euclidean spaces of varying dimension. We motivate our construction in Section \\ref{subsection_canonical restriction quotient} and Section \\ref{subsection_Restriction quotients with Euclidean fibers}. Blow-ups of buildings are constructed in Section \\ref{subsection_input for Z-blow-up}. Several properties of them are discussed in Section \\ref{subsection_more properties} and Section \\ref{subsection_morhpism of blow-up data}. We incorporate a group action into our construction in Section \\ref{subsection_an equivariant constuction}.\n\nIn Section \\ref{subsec_cubulation}, we apply the construction in Section \\ref{subsection_an equivariant constuction} to RAAG's and prove Theorem \\ref{thm_main_intro} modulo Theorem \\ref{prop_intro_semiconjugacy}, which is postponed until Section \\ref{sec_quasi action on Z}. In Section \\ref{subsection_nicer action} we answer several natural questions motivated by Theorem \\ref{thm_main_intro}, and prove Theorem \\ref{thm_no_overgroup}.\n\nThe second part of the paper is Section \\ref{sec_blow-up building more general version}. We discuss an alternative construction of blow-ups of buildings. In certain cases, this is more general than the construction in Section \\ref{sec_blow-up of building}. We also discuss several applications of this construction to graph products.\n\nThe third part of the paper is Section \\ref{sec_construction of wallspace} and Section \\ref{sec_property of wallspace}. Using wallspaces we give an alternative way to cubulate groups quasi-isometric to RAAG's, and prove a weaker version of Theorem \\ref{thm_main_intro}.\n\nThe reader can proceed directly to Section \\ref{sec_blow-up building more general version} with reference to Section \\ref{building} and Definition \\ref{factor action}. The reader can also start with Section \\ref{sec_construction of wallspace} with reference to Section \\ref{subsec_raag}, and come back to Section \\ref{sec_quasi action on Z} when needed.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\\subsection*{Acknowledgements}\nThe second author would like to thank Mladen Bestvian and Michah Sageev for \nmany discussions related to atomic RAAG's, which planted the seeds for the\ncubulation result in this paper.  In particular, Proposition \n\\ref{key lemma} originated in these discussions.\n\n\\tableofcontents\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\\section{Index of notation}\n\\label{sec_index_of_notation}\n\\begin{itemize}\n\\item $\\mathcal{B}$: A combinatorial  building (Section \\ref{building}).\n\\item $|{\\mathcal{B}}|$: The Davis realization of a building (Section \\ref{building}).\n\\item Chambers in the combinatorial building $\\mathcal{B}$ are $c$, $c'$, $d$.\n\\item $|c|_{\\Gamma}$: the Davis chamber (the discussion after\nDefinition \\ref{def_graph_product_of_spaces}, Section \\ref{building}).\n\\item ${\\mathsf{S}^r}$: the collection of all spherical residues in the building ${\\mathcal{B}}$.\n\\item $\\textmd{proj}_{{\\mathcal R}}:{\\mathcal{B}}\\to {\\mathcal R}$: the nearest point projection from ${\\mathcal{B}}$ to a residue ${\\mathcal R}$ (Section \\ref{building}).\n\\item $\\Lambda_{{\\mathcal{B}}}$: the collection of parallel classes of rank 1 residues in the combinatorial building ${\\mathcal{B}}$. We also write $\\Lambda$ when the building ${\\mathcal{B}}$ is clear (Section \\ref{subsection_input for Z-blow-up}).\n\\item $T$: a type map which assigns each residue of ${\\mathcal{B}}$ a subset of $\\Lambda_{{\\mathcal{B}}}$ (Section \\ref{subsection_input for Z-blow-up}).\n\\item $\\beta$: a branched line (Section \\ref{sec_construction of wallspace}).\n\\item ${\\operatorname{CCC}}$: the category of nonempty ${\\operatorname{CAT}}(0)$ cube complexes with morphisms\ngiven by convex cubical embeddings.\n\\item $P_C$: the parallel set of a closed convex subset of a ${\\operatorname{CAT}}(0)$ space\n(Section \\ref{subsec_cube complex}).\n\\item $W({\\Gamma})$:  The right-angled Coxeter group with defining graph ${\\Gamma}$\n(Section \\ref{building}).\n\\item $G({\\Gamma})$ the right-angled Artin group with defining graph ${\\Gamma}$.\n\\item $X({\\Gamma})\\to S({\\Gamma})$ the universal covering of the Salvetti complex (Section \\ref{subsec_raag})\n\\item $X_e({\\Gamma})\\to S_e({\\Gamma})$ the universal covering of the exploded Salvetti complex (after Definition \\ref{def_graph_product_of_spaces} and Section \\ref{subsection_canonical restriction quotient}). We also write $X_e\\rightarrow S_e$ when the graph ${\\Gamma}$ is clear.\n\\item $\\mathcal{P}({\\Gamma})$: the extension complex \n(Definition \\ref{def_extension_complex}).\n\\item $X\\rightarrow X({\\mathcal K})$: the restriction quotient arising from a set ${\\mathcal K}$ of \nhyperplanes in a ${\\operatorname{CAT}}(0)$ cube complex (Definition \\ref{def_restriction_quotient}).\n\\item $Lk(x,X)$ or $Lk(c,X)$: the link of a vertex $x$ or a cell $c$ in a polyhedral complex $X$.\n\\item ${\\Gamma}_1\\circ{\\Gamma}_2$: the join of two graphs.\n\\item $K_1\\ast K_2$: the join of two simplicial complexes.\n\\end{itemize}\n\n\\section{Preliminaries}\n\\label{sec_preliminaries}\n\\subsection{Quasi-actions} We recall several definitions from coarse geometry.\n\\begin{definition}\nAn $(L,A)$-quasi-action of a group $G$ on a metric space $Z$ is a map $\\rho:G\\times Z\\to Z$ so that $\\rho({\\gamma},\\cdot):Z\\to Z$ is an $(L,A)$ quasi-isometry for every ${\\gamma}\\in G$, $d(\\rho({\\gamma}_1,\\rho({\\gamma}_2,z)),\\rho({\\gamma}_1{\\gamma}_2,z))<A$ for every ${\\gamma}_1,{\\gamma}_2\\in G$, $z\\in Z$, and $d(\\rho(e,z),z)<A$ for every $z\\in Z$.\n\\end{definition}\n\nThe action $\\rho$ is \\textit{discrete} if for any point $z\\in Z$ and any $R>0$, the set of all ${\\gamma}\\in G$ such that $\\rho({\\gamma},z)$ is contained in the ball $B_{R}(z)$ is finite; $\\rho$ is \\textit{cobounded} if $Z$ coincides with a finite tubular neighbourhood of the \\textquotedblleft orbit\\textquotedblright\\ $\\rho(G,z)$. If $\\rho$ is a discrete and cobounded quasi-action of $G$ on $Z$, then the orbit map ${\\gamma}\\in G\\to \\rho({\\gamma},z)$ is a quasi-isometry. Conversely, given a quasi-isometry between $G$ and $Z$, it induces a discrete and cobounded action of $G$ on $Z$.\n\nTwo quasi-actions $\\rho$ and $\\rho'$ are \\textit{equivalent} if there exists a constant $D$ so that $d(\\rho({\\gamma}),\\rho'({\\gamma}))<D$ for all ${\\gamma}\\in G$.\n\n\\begin{definition}\nLet $\\rho$ and $\\rho'$ be quasi-actions of $G$ on $Z$ and $Z'$ respectively, and let $\\phi:Z\\to Z'$ be a quasi-isometry. Then $\\rho$ is \\textit{quasiconjugate} to $\\rho'$ via $\\phi$ if there is a $D$ so that $d(\\phi\\circ\\rho({\\gamma}),\\rho'(r)\\circ\\phi)<D$ for all ${\\gamma}\\in G$.\n\\end{definition}\n\\subsection{${\\operatorname{CAT}}(0)$ cube complexes}\n\\label{subsec_cube complex}\nWe refer to \\cite{bridson_haefliger} for background about ${\\operatorname{CAT}}(0)$ spaces (Chapter II.1) and cube complexes (Chapter II.5), and \\cite{MR1347406,sageevnotes} for ${\\operatorname{CAT}}(0)$ cube complexes and hyperplanes.\n\nA unit Euclidean $n$-cube is $[0,1]^{n}$ with the standard metric. A \\textit{mid-cube} is the set of fixed points of a reflection with respect to some $[0,1]$ factor of $[0,1]^{n}$. A cube complex $Y$ is obtained by taking a collection of unit Euclidean cubes and gluing them along isometric faces. The gluing metric on $Y$ is ${\\operatorname{CAT}}(0)$ if and only if $Y$ is simply connected and the link of each vertex in $Y$ is a flag simplicial complex (\\cite{MR919829}), in this case, $Y$ is called a \\textit{${\\operatorname{CAT}}(0)$ cube complex}. \n\nLet $X$ be a ${\\operatorname{CAT}}(0)$ space and let $C\\subset X$ be a closed convex subset. Then there is a well-defined nearest point projection from $X$ to $C$, which we denote by $\\pi_{C}:X\\to C$. Two convex subsets $C_{1}$ and $C_{2}$ are \\textit{parallel} if $d(\\cdot,C_{2})|_{C_{1}}$ and $d(\\cdot,C_{1})|_{C_{2}}$ are constant functions. In this case, the convex hull of $C_{1}$ and $C_{2}$ is isometric to $C_{1}\\times [0,d(C_{1},C_{2})]$.\n\nFor closed convex subset $C\\subset X$, we define $P_{C}$, the \\textit{parallel set} of $C$, to be the union of all convex subsets of $X$ which are parallel to $C$. If $C$ has geodesic extension property, then $P_{C}$ is also a closed convex subset and admits a canonical splitting $P_{C}\\cong C\\times C^{\\perp}$ (\\cite[Chapter II.2.12]{bridson_haefliger}).\n\nSuppose $Y$ is a ${\\operatorname{CAT}}(0)$ cube complex. Then two edges $e$ and $e'$ are parallel if and only if there exists sequences of edges $\\{e_{i}\\}_{i=1}^{n}$ such that $e_{1}=e$, $e_{n}=e'$, and $e_{i},e_{i+1}$ are the opposite sides of a $2$-cube in $Y$. For each edge $e\\subset Y$. Let $N_{e}$ be the union of cubes in $Y$ which contain an edge parallel to $e$. Then $N_{e}$ is a convex subcomplex of $Y$, moreover, $N_{e}$ has a natural splitting $N_{e}\\cong h_{e}\\times[0,1]$, where $[0,1]$ corresponds to the $e$ direction. The subset $h_{e}\\times\\{1/2\\}$ is called the \\textit{hyperplane} dual to $e$, and $N_{e}$ is called the \\textit{carrier} of this hyperplane. Each hyperplane is a union of mid-cubes, hence has a natural cube complex structure, which makes it a ${\\operatorname{CAT}}(0)$ cube complex. The following are true for hyperplanes:\n\\begin{enumerate}\n\\item Each hyperplane $h$ is a convex subset of $Y$. Moreover, $Y\\setminus h$ has exactly two connected components. The closure of each connected component is called a \\textit{halfspace}. Each halfspace is also a convex subset.\n\\item Pick an edge $e\\subset Y$. We identify $e$ with $[0,1]$ and consider the ${\\operatorname{CAT}}(0)$ projection $\\pi_{e}:Y\\to e\\cong[0,1]$. Then $h=\\pi^{-1}_{e}(1/2)$ is the hyperplane dual to $e$, and $\\pi^{-1}_{e}([0,1/2]),\\pi^{-1}_{e}([1/2,1])$ are two halfspaces associated with $h$. The closure of $\\pi^{-1}_{e}((0,1))$ is the carrier of $h$.\n\\end{enumerate}\n\nLet $Y$ be a ${\\operatorname{CAT}}(0)$ cube complex and let $l\\in Y$ be a geodesic line (with respect to the ${\\operatorname{CAT}}(0)$ metric) in the 1-skeleton of $Y$. Let $e\\subset l$ be an edge and pick $x\\in e$. We claim that if $x$ is in the interior of $e$, then $\\pi^{-1}_{l}(x)=\\pi^{-1}_{e}(x)$. It is clear that $\\pi^{-1}_{l}(x)\\subset\\pi^{-1}_{e}(x)$. Suppose $y\\in \\pi^{-1}_{e}(x)$. It follows from the splitting $N_{e}\\cong h_{e}\\times[0,1]$ as above that the geodesic segment $\\overline{xy}$ is orthogonal to $l$, i.e. $\\angle_{x}(y,y')=\\pi/2$ for any $y'\\in l\\setminus\\{x\\}$, thus $y\\in \\pi^{-1}_{l}(x)$.\n\nThe above claim implies $\\pi^{-1}_{l}(x)$ is a convex subset for any $x\\in l$. Moreover, the following lemma is true.\n\n\\begin{lem}\n\\label{project onto line}\nLet $Y$ and $l$ be as before. Pick an edge $e\\subset Y$. If $e$ is parallel to some edge $e'\\subset l$, then $\\pi_{l}(e)=e'$, otherwise $\\pi_{l}(e)$ is a vertex of $l$.\n\\end{lem}\n\nNow we define an alternative metric on the ${\\operatorname{CAT}}(0)$ cube complex $Y$, which is called the $l^{1}$-metric. One can view the 1-skeleton of $Y$ as a metric graph with edge length $=1$, and this metric extends naturally to a metric on $Y$. The distant between two vertices in $Y$ with respect to this metric is equal to the number of hyperplanes separating these two vertices.\n\nA \\textit{combinatorial geodesic} in $Y$ is an edge path in $Y^{(1)}$ which is a geodesic with respect to the $l^{1}$ metric. However, we always refer to the ${\\operatorname{CAT}}(0)$ metric when we talk about a geodesic.\n\nIf $Y$ is finite dimensional, the $l^{1}$ metric and the ${\\operatorname{CAT}}(0)$ metric on $Y$ are quasi-isometric (\\cite[Lemma 2.2]{caprace2011rank}). In this paper, we will use the ${\\operatorname{CAT}}(0)$ metric unless otherwise specified.\n\n\\begin{definition} (\\cite[Section 2.1]{caprace2011rank})\n\\label{cubical map}\nA cellular map between cube complexes is \\textit{cubical} if its restriction $\\sigma\\to\\tau$ between cubes factors as $\\sigma\\to\\eta\\to\\tau$, where the first map $\\sigma\\to\\eta$ is a natural projection onto a face of $\\sigma$ and the second map $\\eta\\to\\tau$ is an isometry. \n\\end{definition}\n\n\\subsection{Right-angled Artin groups}\n\\label{subsec_raag}\nPick a finite simplicial graph $\\Gamma$, recall that $G({\\Gamma})$ is the right-angled Artin group with defining graph ${\\Gamma}$. Let $S$ be a standard generating set for $G(\\Gamma)$ and we label the vertices of $\\Gamma$ by elements in $S$. $G(\\Gamma)$ has a nice Eilenberg-MacLane space $S(\\Gamma)$, called the Salvetti complex (see \\cite{MR1368655,charney2007introduction}). Recall that $S(\\Gamma)$ is the graph product $\\prod_{\\Gamma}(S^1_v,\\star_v)$, where $(S^1_v,\\star_v)$ is a pointed unit circle (see Definition \\ref{def_graph_product_of_spaces}).\n\nThe 2-skeleton of $S(\\Gamma)$ is the usual presentation complex of $G(\\Gamma)$, so $\\pi_{1}(S(\\Gamma))\\cong G(\\Gamma)$. The 0-skeleton of $S(\\Gamma)$ consists of one point whose link is a flag complex, so $S(\\Gamma)$ is non-positively curved and $S(\\Gamma)$ is an Eilenberg-MacLane space for $G(\\Gamma)$ by the Cartan-Hadamard theorem (\\cite[Theorem II.4.1]{bridson_haefliger}).\n\nThe closure of each $k$-cell in $S(\\Gamma)$ is a $k$-torus. Tori of this kind are called \\textit{standard tori}. There is a 1-1 correspondence between the $k$-cells (or standard torus of dimension $k$) in $S(\\Gamma)$ and $k$-cliques in $\\Gamma$. We define the \\textit{dimension} of $G(\\Gamma)$ to be the dimension of $S(\\Gamma)$.\n\nDenote the universal cover of $S(\\Gamma)$ by $X(\\Gamma)$, which is a ${\\operatorname{CAT}}(0)$ cube complex. Our previous labelling of vertices of $\\Gamma$ induces a labelling of the standard circles of $S(\\Gamma)$, which lifts to a labelling of edges of $X(\\Gamma)$. A \\textit{standard k-flat} in $X(\\Gamma)$ is a connected component of the inverse image of a standard $k$-torus under the covering map $X(\\Gamma)\\to S(\\Gamma)$. When $k=1$, we also call it a \\textit{standard geodesic}.\n\nFor each simplicial graph $\\Gamma$, there is a simplicial complex $\\mathcal{P}(\\Gamma)$ called the \\textit{extension complex}, which captures the combinatorial pattern of how standard flats intersect each other in $X(\\Gamma)$. This object was first introduced in \\cite{kim2013embedability}. We will define it in a slightly different way (see \\cite[Section 4.1]{huang2014quasi} for more discussion).\n\n\\begin{definition}[Extension complex]\n\\label{def_extension_complex}\nThe vertices of $\\mathcal{P}(\\Gamma)$ are in 1-1 correspondence with the parallel classes of standard geodesics in $X(\\Gamma)$. Two distinct vertices $v_{1},v_{2}\\in\\mathcal{P}(\\Gamma)$ are connected by an edge if and only if there is standard geodesic $l_{i}$ in the parallel class associated with $v_{i}$ ($i=1,2$) such that $l_{1}$ and $l_{2}$ span a standard 2-flat. Then $\\mathcal{P}(\\Gamma)$ is defined to be the flag complex of its 1-skeleton, namely we build $\\mathcal{P}(\\Gamma)$ inductively from its 1-skeleton by filling a $k$-simplex whenever we see the $(k-1)$-skeleton of a $k$-simplex. \n\\end{definition}\n\nSince each complete subgraph in the 1-skeleton of $\\mathcal{P}(\\Gamma)$ gives rise to a collection of mutually orthogonal standard geodesics lines, there is a 1-1 correspondence between $k$-simplexes in $\\mathcal{P}(\\Gamma)$ and parallel classes of standard $(k+1)$-flats in $X(\\Gamma)$. In particular, there is a 1-1 correspondence between maximal simplexes in $\\mathcal{P}(\\Gamma)$ and maximal standard flats in $X(\\Gamma)$. Given standard flat $F\\subset X(\\Gamma)$, we denote the simplex in $\\mathcal{P}(\\Gamma)$ associated with the parallel class containing $F$ by $\\Delta(F)$. \n\n\\begin{lem}\n\\label{projection}\nPick non-adjacent vertices $v,u\\in\\mathcal{P}(\\Gamma)$ and let $l_{u}$ be a standard geodesic such that $\\Delta(l_{u})=u$. Then for any standard geodesic line $l$ with $\\Delta(l)=v$, $\\pi_{l_{u}}(l)$ is a vertex of $l_{u}$ which does not depend on the choice of $l$ in the parallel class. Thus we define this vertex to be the projection of $v$ on $l_{u}$ and denote it by $\\pi_{l_{u}}(v)$.\n\\end{lem}\n\n\\begin{proof}\nIt follows from Lemma \\ref{project onto line} that if two standard geodesic lines $l_{1}$ and $l_{2}$ are not parallel, then $\\pi_{l_{1}}(l_{2})$ is a vertex of $l_{2}$. Thus $\\pi_{l_{u}}(l)$ is a vertex of $l_{u}$. Suppose $l'$ is parallel to $l$, then there exists a chain of parallel standard geodesic lines $\\{l_{i}\\}_{i=1}^{n}$ such that $l_{1}=l$, $l_{n}=l'$ and $l_{i},l_{i+1}$ are in the same standard 2-flat $F_{i}$. Let $l^{\\perp}\\subset F_{i}$ be a standard geodesic orthogonal to $l_{i}$ and $l_{i+1}$. Since $v$ and $u$ are not adjacent in $\\mathcal{P}(\\Gamma)$, $l^{\\perp}$ and $l_{u}$ are not parallel, thus $\\pi_{l_{u}}(l^{\\perp})$ is a point. It follows that $\\pi_{l_{u}}(l_{i})=\\pi_{l_{u}}(l_{i+1})$, hence $\\pi_{l_{u}}(l)=\\pi_{l_{u}}(l')$.\n\\end{proof}\n\n\\subsection{Right-angled buildings}\n\\label{building}\nWe will follow the treatment in \\cite{davis_buildings_are_cat0,abramenko2008buildings,ronan2009lectures}. In particular, we refer to Section 1.1 to Section 1.3 of \\cite{davis_buildings_are_cat0} for the definitions of chamber systems, galleries, residues, Coxeter groups and buildings. We will focus on right-angled buildings,  i.e. the associated Coxeter group is right-angled, though most of the discussion below is valid for general buildings.\n\nLet $W=W({\\Gamma})$ be a right-angled Coxeter group with (finite) defining graph ${\\Gamma}$. Let ${\\mathcal{B}}={\\mathcal{B}}({\\Gamma})$ be a right-angled building with the associated $W$-distance function denoted by $\\delta:{\\mathcal{B}}\\times {\\mathcal{B}}\\to W$. We will also call ${\\mathcal{B}}({\\Gamma})$ a \\textit{right-angled ${\\Gamma}$-building} for simplicity.\n\nLet $I$ be the vertex set of ${\\Gamma}$. Recall that a subset $J\\subset I$ is \\textit{spherical} if the subgroup of $W$ generated by $J$ is finite. Let $\\mathsf{S}$ be the poset of spherical subsets of $I$ (including the empty set) and let $|\\mathsf{S}|_{\\Delta}$ be the geometric realization of $\\mathsf{S}$, i.e. $|\\mathsf{S}|_{\\Delta}$ is a simplicial complex such that its vertices are in 1-1 correspondence to elements in $\\mathsf{S}$ and its $n$-simplices are in 1-1 correspondence to $(n+1)$-chains in $\\mathsf{S}$. Note that $|\\mathsf{S}|_{\\Delta}$ is isomorphic the simplicial cone over the barycentric subdivision of the flag complex of ${\\Gamma}$.\n\nRecall that for elements $x\\le y$ in $\\mathsf{S}$, the \\textit{interval} $I_{xy}$ between $x$ and $y$ is a poset consist of elements $z\\in\\mathsf{S}$ such that $x\\le z\\le y$ with the induced order from $\\mathsf{S}$. There is a natural simplicial embedding $|I_{xy}|_{\\Delta}\\hookrightarrow|\\mathsf{S}|_{\\Delta}$. Each $|I_{xy}|_{\\Delta}$ is a simplicial cone over the barycentric subdivision of a simplex, thus can be viewed a subdivision of a cube into simplices. It is not hard to check the collection of all intervals in $\\mathsf{S}$ gives rise to a structure of cube complex on $|\\mathsf{S}|_{\\Delta}$. Let $|\\mathsf{S}|$ be the resulting cube complex, then $|\\mathsf{S}|$ is $CAT(0)$.\n\nA residue is \\textit{spherical} if it is a $J$-residue with $J\\in \\mathsf{S}$. Let $ {\\mathsf{S}^r}$ be the poset of all spherical residues in ${\\mathcal{B}}$. For $x\\in  {\\mathsf{S}^r}$ which comes from a $J$-residue, we define the \\textit{rank} of $x$ to be the cardinality of $J$, and define a \\textit{type map} $t: {\\mathsf{S}^r}\\to\\mathsf{S}$ which maps $x$ to $J\\in \\mathsf{S}$. Let $|{\\mathsf{S}^r}|_{\\Delta}$ be the geometric realization of ${\\mathsf{S}^r}$, then the type map induces a simplicial map $t:|{\\mathsf{S}^r}|_{\\Delta}\\to |\\mathsf{S}|_{\\Delta}$. For $x\\in {\\mathsf{S}^r}$, let ${\\mathsf{S}^r}_{x}$ be the sub-poset made of elements in ${\\mathsf{S}^r}$ which is $\\ge x$. If $x$ is of rank $0$, then ${\\mathsf{S}^r}_{ x}$ is isomorphic to $\\mathsf{S}$, moreover, there is a natural simplicial embedding $|{\\mathsf{S}^r}_{x}|_{\\Delta}\\to|{\\mathsf{S}^r}|_{\\Delta}$ and $t$ maps the image of $|{\\mathsf{S}^r}_{x}|_{\\Delta}$ isomorphically onto $|\\mathsf{S}|_{\\Delta}$. \n\nAs before, the geometric realization of each interval in ${\\mathsf{S}^r}$ is a subdivision of a cube into simplices. Moreover, the intersection of two intervals in ${\\mathsf{S}^r}$ is also an interval. Thus one gets a cube complex $|{\\mathcal{B}}|$ whose cubes are in 1-1 correspondence with intervals in ${\\mathsf{S}^r}$. $|{\\mathcal{B}}|$ is called the \\textit{Davis realization} of the building ${\\mathcal{B}}$ and $|{\\mathcal{B}}|$ is a $CAT(0)$ cube complex by \\cite{davis_buildings_are_cat0}. Moreover, the above type map induces a cubical map $t:|{\\mathcal{B}}|\\to|\\mathsf{S}|$. Let ${\\mathcal R}\\subset {\\mathcal{B}}$ be a residue. Since ${\\mathcal R}$ also has the structure of a building, there is an isometric embedding $|{\\mathcal R}|\\to|{\\mathcal{B}}|$ between their Davis realizations. $|{\\mathcal R}|$ is called a \\textit{residue} in $|{\\mathcal{B}}|$.\n\nIn the special case when ${\\mathcal{B}}$ is equal to the associated Coxeter group $W$, there is a natural embedding from the Cayley graph of $W$ to $|{\\mathcal{B}}|$ such that vertices of Cayley graph are mapped to vertices of rank $0$ in $|{\\mathcal{B}}|$. And $|{\\mathcal{B}}|$ can be viewed as the first cubical subdivision of the cubical completion of the Cayley graph of $W$ (the cubical completion means we attach an $n$-cube to the graph whenever there is a copy of the 1-skeleton of an $n$-cube inside the graph). \n\nEach vertex of $|{\\mathcal{B}}|$ corresponds to a $J$-residue in ${\\mathcal{B}}$, thus has a well-defined rank. For a vertex $x$ of rank $0$, the space $|{\\mathsf{S}^r}_{x}|_{\\Delta}$ discussed in the previous paragraph induces a subcomplex $|{\\mathcal{B}}_x|\\subset|{\\mathcal{B}}|$. Note that $t$ maps $|{\\mathcal{B}}_x|$ isomorphically onto $|\\mathsf{S}|$. $|{\\mathcal{B}}_x|$ is called a \\textit{chamber} in $|{\\mathcal{B}}|$, and there is a 1-1 correspondence between chambers in $|{\\mathcal{B}}|$ and chambers in ${\\mathcal{B}}$. Let $|{\\mathcal{B}}_x|$ and $|{\\mathcal{B}}_y|$ be two chambers in $|{\\mathcal{B}}|$. Since there is an apartment ${\\mathcal A}\\subset {\\mathcal{B}}$ which contains both $x$ and $y$, this induces an isometric embedding $|{\\mathcal A}|\\to |{\\mathcal{B}}|$ whose image contains $|{\\mathcal{B}}_x|$ and $|{\\mathcal{B}}_y|$, here $|{\\mathcal A}|$ is isomorphic to the Davis realization of the Coxeter group $W$. $|{\\mathcal A}|$ is called an \\textit{apartment} in $|{\\mathcal{B}}|$.\n\n\\begin{definition}\n\\label{distance of residue}\nFor $c_1,c_2\\in {\\mathcal{B}}$, define $d(c_1,c_2)$ to be the minimal length of word in $W$ (with respect to the generating set $I$) that represents $\\delta(c_1,c_2)$. For any two residues ${\\mathcal R}_1,{\\mathcal R}_2\\in{\\mathcal{B}}$, we define $d({\\mathcal R}_1,{\\mathcal R}_2)=\\min\\{d(c,d)\\mid c\\in{\\mathcal R}_1,d\\in{\\mathcal R}_2\\}$. It turns out that for any $c\\in {\\mathcal R}_1$ and $d\\in{\\mathcal R}_2$ with $d(c,d)=d({\\mathcal R}_1,{\\mathcal R}_2)$, $\\delta(c,d)$ gives rise to the same element in $W$ (\\cite[Chapter 5.3.2]{abramenko2008buildings}), this element is defined to be $\\delta({\\mathcal R}_1,{\\mathcal R}_2)$.\n\\end{definition}\n\n\n\\begin{lem}\n\\label{distance}\n$d(c_1,c_2)=2d_{l^1}(c_1,c_2)$, here $d_{l^1}$ means the $l^1$-distance in $|{\\mathcal{B}}|$. Since $c_1$ and $c_2$ can be also viewed as vertex of rank $0$ in $|{\\mathcal{B}}|$, $d_{l^1}(c_1,c_2)$ makes sense.\n\\end{lem}\n\n\\begin{proof}\nIf ${\\mathcal{B}}=W$, then this lemma follows from the above description of the Davis realization of a Coxeter group. The general case can be reduced to this case by considering an apartment $|{\\mathcal A}|\\subset|{\\mathcal{B}}|$ which contains $c_1$ and $c_2$. Note that $|{\\mathcal A}|$ is convex in $|{\\mathcal{B}}|$.\n\\end{proof}\n\nGiven a residue ${\\mathcal R}\\subset{\\mathcal{B}}$, there is a well-defined nearest point projection map as follows.\n\n\\begin{theorem}[Proposition 5.34, \\cite{abramenko2008buildings}]\n\\label{prj}\nLet ${\\mathcal R}$ be a residue and $c$ a chamber. Then there exists a unique $c'\\in{\\mathcal R}$ such that $d(c,c')=d({\\mathcal R},c)$.\n\\end{theorem}\n\nThis projection is compatible with several other projections in the following sense. Let $|{\\mathcal R}|\\subset|{\\mathcal{B}}|$ be the convex subcomplex corresponding to ${\\mathcal R}$. Let $c$ and $c'$ be as above. We also view them as vertex of rank $0$ in $|{\\mathcal{B}}|$. Let $c_1$ be the combinatorial projection of $c$ onto $|{\\mathcal R}|$ (see \\cite[Lemma 13.8]{haglund_wise_special}) and let $c_2$ be the $CAT(0)$ projection of $c$ onto $|{\\mathcal R}|$.\n\n\\begin{lem}\n\\label{equivalence of projections}\n$c'=c_1=c_2$.\n\\end{lem} \n\n\\begin{proof}\n$c_1=c_2$ is actually true for any $CAT(0)$ cube complexes. By \\cite[Lemma 2.3]{huang2014quasi}, $c_2$ is a vertex. If $c_2\\neq c_1$, by \\cite[Lemma 13.8]{haglund_wise_special}, the concatenation of the combinatorial geodesic $\\omega_1$ which connects $c_2$ and $c_1$ and the combinatorial geodesic $\\omega_2$ which connects $c_1$ and $c$ is a combinatorial geodesic connecting $c$ and $c_2$. Note that $\\omega_1\\subset |{\\mathcal R}|$. Let $e\\subset\\omega_1$ be the edge that contains $c_2$ and let $x$ be the other endpoint of $e$. Then $x$ and $c$ are in the same side of the hyperplane dual to $e$. It is easy to see $d(x,c)<d(c_2,c)$ (here $d$ denotes the $CAT(0)$ distance), which yields a contradiction.\n\nTo see $c'=c_1$, by Lemma \\ref{distance}, it suffices to prove $c_1$ is of rank $0$. When ${\\mathcal{B}}=W$, this follows from $c_1=c_2$, since we can work with the cubical completion of the Cayley graph of $W$ instead of $|W|$ (the latter is the cubical subdivision of the former) and apply \\cite[Lemma 2.3]{huang2014quasi}. The general case follows by considering an apartment $|{\\mathcal A}|\\subset|{\\mathcal{B}}|$ which contains $c_1$ and $c$, note that in this case $|{\\mathcal A}|\\cap|{\\mathcal R}|$ can be viewed as a residue in $|{\\mathcal A}|$.\n\\end{proof}\n\n\\begin{definition}\n\\label{definition_parallel}\nLet $\\textmd{proj}_{{\\mathcal R}}$ be the map defined in Theorem \\ref{prj}. Two residues ${\\mathcal R}_1$ and ${\\mathcal R}_2$ are \\textit{parallel} if $\\textmd{proj}_{{\\mathcal R}_1}({\\mathcal R}_2)={\\mathcal R}_1$ and $\\textmd{proj}_{{\\mathcal R}_2}({\\mathcal R}_1)={\\mathcal R}_2$. In this case $\\textmd{proj}_{{\\mathcal R}_1}$ and $\\textmd{proj}_{{\\mathcal R}_2}$ induce mutually inverse bijections between ${\\mathcal R}_1$ and ${\\mathcal R}_2$. These bijections are called \\textit{parallelism maps} between ${\\mathcal R}_1$ and ${\\mathcal R}_2$. They are also isomorphisms of chamber system i.e. they map residues to residues (\\cite[Proposition 5.37]{abramenko2008buildings}).\n\\end{definition}\n\nIt follows from the uniqueness of the projection map that if $f:{\\mathcal R}\\to{\\mathcal R}'$ is the parallelism map between two parallel residues and ${\\mathcal R}_1\\subset{\\mathcal R}$ is a residue, then ${\\mathcal R}_1$ and $f({\\mathcal R}_1)$ are parallel, and the parallelism map between ${\\mathcal R}_1$ and $f({\\mathcal R}_1)$ is induced by $f$.\n\n\\begin{lem}\n\\label{parallel}\nIf ${\\mathcal R}_1$ and ${\\mathcal R}_2$ are parallel, then $|{\\mathcal R}_1|$ and $|{\\mathcal R}_2|$ are parallel with respect to the $CAT(0)$ metric on $|{\\mathcal{B}}|$. Moreover, the parallelism maps between ${\\mathcal R}_1$ and ${\\mathcal R}_2$ induces by $\\textmd{proj}_{{\\mathcal R}_1}$ and $\\textmd{proj}_{{\\mathcal R}_2}$ is compatible with the $CAT(0)$ parallelism between $|{\\mathcal R}_1|$ and $|{\\mathcal R}_2|$ induced by $CAT(0)$ projections.\n\\end{lem}\n\n\\begin{proof}\nBy Lemma \\ref{equivalence of projections}, it suffices to show for any residue ${\\mathcal R}\\in{\\mathcal{B}}$, $|{\\mathcal R}|$ is the convex hull of the vertices of rank $0$ inside $|{\\mathcal R}|$. This is clear when ${\\mathcal{B}}=W$ if one consider the cubical completion of the Cayley graph of $W$. The general case also follows since $|{\\mathcal R}|$ is a union of apartments in $|{\\mathcal R}|$, and $|{\\mathcal R}|$ is convex in $|{\\mathcal{B}}|$.\n\\end{proof}\n\nIt follows that if ${\\mathcal R}_1$ and ${\\mathcal R}_2$ are parallel residues, and ${\\mathcal R}_2$ and ${\\mathcal R}_3$ are parallel residues, then ${\\mathcal R}_1$ is parallel to ${\\mathcal R}_3$. Moreover, let $f_{ij}$ be the parallelism map from ${\\mathcal R}_i$ to ${\\mathcal R}_j$ induced by the projection map, then $f_{13}=f_{23}\\circ f_{12}$.\n\nGiven chamber systems $C_1,\\cdots,C_k$ over $I_1,\\cdots,I_k$, their direct product $C_{1}\\times \\cdots\\times C_k$ is a chamber system over the disjoint union $I_1\\sqcup\\cdots\\sqcup I_k$. Its chambers are $k$-tuples $(c_1,\\cdots,c_k)$ with $c_t\\in C_t$. For $i\\in I_t$, $(c_1,\\cdots,c_k)$ is $i$-adjacent to $(d_1,\\cdots,d_k)$ if $c_j=d_j$ for $j\\neq t$ and $c_t$ and $d_t$ are $i$-adjacent.\n\nSuppose the defining graph ${\\Gamma}$ of the right-angled Coxeter group $W$ admits a join decomposition ${\\Gamma}={\\Gamma}_1\\circ{\\Gamma}_2\\circ\\cdots\\circ{\\Gamma}_k$. Let $I=\\cup_{i=1}^{k}I_i$ be the corresponding decomposition of the vertex set of ${\\Gamma}$ and $W=\\prod_{i=1}^{k}W_i$ be the induced product decomposition of $W$. Pick chamber $c\\in{\\mathcal{B}}$, and let ${\\mathcal{B}}_i$ be the $I_i$-residue that contains $c$. Define a map $\\phi:{\\mathcal{B}}\\to{\\mathcal{B}}_1\\times{\\mathcal{B}}_2\\times\\cdots\\times{\\mathcal{B}}_k$ by $\\phi(d)=(\\textmd{proj}_{{\\mathcal{B}}_1}(d),\\textmd{proj}_{{\\mathcal{B}}_2}(d),\\cdots,\\textmd{proj}_{{\\mathcal{B}}_k}(d))$ for any chamber $d\\in{\\mathcal{B}}$.\n\n\\begin{thm}[Theorem 3.10, \\cite{ronan2009lectures}]\n\\label{product decomposition}\nThe definition of $\\phi$ does not depend on the choice of $c$, and $\\phi$ is an isomorphism of buildings.\n\\end{thm}\n\nIt follows from the definition of the Davis realization that there is a natural isomorphism $|{\\mathcal{B}}_1\\times{\\mathcal{B}}_2\\times\\cdots\\times{\\mathcal{B}}_k|\\cong|{\\mathcal{B}}_1|\\times|{\\mathcal{B}}_2|\\times\\cdots\\times|{\\mathcal{B}}_k|$, thus we have a product decomposition $|\n{\\mathcal{B}}|\\cong|{\\mathcal{B}}_1|\\times|{\\mathcal{B}}_2|\\times\\cdots\\times|{\\mathcal{B}}_k|$, where the isomorphism is induced by $CAT(0)$ projections from $|{\\mathcal{B}}|$ to $|{\\mathcal{B}}_i|$'s (this is a consequence of Lemma \\ref{parallel}).\n\nWe define the \\textit{parallel set} of a residue ${\\mathcal R}\\subset{\\mathcal{B}}$ to be the union of all residues in ${\\mathcal{B}}$ that are parallel to ${\\mathcal R}$.\n\n\\begin{lem}\n\\label{parallel sets of residues}\nSuppose ${\\mathcal R}$ is a $J$-residue. Let $J^{\\perp}\\subset I$ be the collection of vertices in ${\\Gamma}$ which are adjacent to every vertex in $J$. Then: \n\\begin{enumerate}\n\\item If ${\\mathcal R}'$ is parallel to ${\\mathcal R}$, then ${\\mathcal R}'$ is a $J$-residue.\n\\item The parallel set of ${\\mathcal R}$ is the $J\\cup J^{\\perp}$-residue that contains ${\\mathcal R}$.\n\\end{enumerate}\n\\end{lem}\n\nNote that this lemma is not true if the building under consideration is not right-angled.\n\\begin{proof}\nSuppose ${\\mathcal R}'$ is a $J_1$-residue. Let $w=\\delta({\\mathcal R},{\\mathcal R}')$ (see Definition \\ref{distance of residue}). It follows from (2) of \\cite[Lemma 5.36]{abramenko2008buildings} that ${\\mathcal R}'$ is a $(J\\cap w J_1 w^{-1})$-residue. Since ${\\mathcal R}$ and ${\\mathcal R}'$ are parallel, they have the same rank, thus $J=w J_{1} w^{-1}$. By considering the abelianization of the right-angled Coxeter group $W$, we deduce that $J=J_1$ (this proves the first assertion of the lemma) and $w$ commutes with each element in $J$. Thus $w$ belongs to the subgroup generated by $J^{\\perp}$ and ${\\mathcal R}'$ is in the $J\\cup J^{\\perp}$-residue ${\\mathcal S}$ that contains ${\\mathcal R}$. Then the parallel set of ${\\mathcal R}$ is contained in ${\\mathcal S}$. It remains to prove every $J$-residue in ${\\mathcal S}$ is parallel to ${\\mathcal R}$, but this follows from Theorem \\ref{product decomposition}.\n\\end{proof}\n\nPick a vertex $v\\in|{\\mathcal{B}}|$ of rank $k$ and let ${\\mathcal R}=\\prod_{i=1}^{k}{\\mathcal R}_i$ be the associated residue with its product decomposition. Let $\\{v_{\\lambda}\\}_{\\lambda\\in\\Lambda}$ be the collection of vertices that are adjacent to $v$. Then there is a decomposition $\\{v_{\\lambda}\\}_{\\lambda\\in\\Lambda}=\\{v_{\\lambda}\\le v\\}\\sqcup \\{v_{\\lambda}>v\\}$, where $\\{v_{\\lambda}>v\\}$ denotes the collection of vertices whose associated residues contain ${\\mathcal R}$. This induces a decomposition $Lk(v,|{\\mathcal{B}}|)=K_1\\ast K_2$ of the link of $v$ in $|{\\mathcal{B}}|$ (\\cite[Definition I.7.15]{bridson_haefliger}) into a spherical join of two $CAT(1)$ all-right spherical complexes. Note that $K_2$ is finite, since $\\{v_{\\lambda>v}\\}$ is finite. Moreover, $K_1\\cong Lk(v,|{\\mathcal R}|)$. However, $|{\\mathcal R}|\\cong\\prod_{i=1}^{k}|{\\mathcal R}_i|$, thus $K_1$ is the spherical join of $k$ discrete sets such that elements in each of these discrete sets are in 1-1 correspondence to elements in some ${\\mathcal R}_i$. Now we can deduce from this the following result.\n\\begin{lem}\n\\label{rank preserving}\nSuppose ${\\mathcal{B}}$ is a right-angled building such that each of its residues of rank 1 \ncontains infinitely many elements. If $\\alpha:|{\\mathcal{B}}|\\to|{\\mathcal{B}}|$ is a cubical isomorphism, then $\\alpha$ preserves the rank of vertices in $|{\\mathcal{B}}|$.\n\\end{lem}\n\n\n\\section*{Part I: A fibration approach to cubulating RAAG's}\n\n\n\\section{Restriction quotients}\n\\label{sec_restriction_quotients}\nIn this section we study restriction quotients, \na certain type of mapping between ${\\operatorname{CAT}}(0)$ cube complexes \nintroduced by Caprace and Sageev in \\cite{caprace2011rank}.  These\nplay a central role in our story. \n\nWe first show in Subsection \\ref{subsec_quotient_maps_cube_complexes}\nthat restriction quotients can be characterized in \nseveral different ways, see Theorem \\ref{thm_restriction_quotient_characterization}.  \nWe then show in Subsection \\ref{sec_restriction_maps_versus_fiber_functors}\nthat a restriction\nquotient $f:Y\\rightarrow Z$ determines fiber data that satisfies\ncertain conditions; conversely, given such fiber data, one may construct\na restriction quotient inducing the given data, which is unique up to equivalence.\nThis correspondence will later be applied to construct restriction quotients over\nright-angled buildings.  Subsections \\ref{sec_equivariance_properties}\nand \\ref{sec_quasiisometric_properties} deals with the behavior of restriction\nquotients under group actions and quasi-isometries.\n\n\n\n\\subsection{Quotient maps between ${\\operatorname{CAT}}(0)$ cube complexes}\n\\label{subsec_quotient_maps_cube_complexes}\nWe recall the notion of restriction quotient from \\cite[Section 2.3]{caprace2011rank}; see Section \\ref{subsec_wallspaces} for the background on wallspaces.\n\n\n\\begin{definition}\n\\label{def_restriction_quotient}\nLet $Y$ be a ${\\operatorname{CAT}}(0)$ cube complex and let ${\\mathcal H}$ be the collection of walls in the $0$-skeleton $Y^{(0)}$ corresponding to the hyperplanes in $Y$. Pick a subset ${\\mathcal K}\\subset {\\mathcal H}$ and let $Y({\\mathcal K})$ be the ${\\operatorname{CAT}}(0)$ cube complex associated with the wallspace $(Y^{(0)},{\\mathcal K})$. Then every 0-cube of the wallspace $(Y^{(0)},{\\mathcal H})$ gives rise to a 0-cube of $(Y^{(0)},{\\mathcal K})$ by restriction. This can be extended to a surjective cubical map $q:Y\\to Y({\\mathcal K})$, which is called the {\\em restriction quotient} arising from the subset ${\\mathcal K}\\subset{\\mathcal H}$.\n\\end{definition}\n\n\nThe following example motivates many of the constructions\nin this paper:\n\\begin{example}[The canonical restriction quotient of a RAAG]\n\\label{the key example}\nFor a fixed graph ${\\Gamma}$,\nlet $S_e\\rightarrow |c|_{\\Gamma}$ and $X_e\\rightarrow S_e$ be the mappings associated with the \nexploded Salvetti complex, as defined in the introduction after\nDefinition \\ref{def_graph_product_of_spaces}.\nLet ${\\mathcal K}$ be the collection\nof hyperplanes in $X_e({\\Gamma})$ dual to edges\n$e\\subset X_e$ that project to edges under the composition \n$X_e\\rightarrow S_e\\rightarrow |c|_{\\Gamma}$.  Then the {\\em canonical restriction quotient of $G=G({\\Gamma})$}\nis the restriction quotient arising from ${\\mathcal K}$.\n\\end{example}\n\n\nLet $q:Y\\to Y({\\mathcal K})$ be a restriction quotient. Pick an edge $e\\subset Y$. If $e$ is dual to some element in ${\\mathcal K}$, then $q(e)$ is an edge, otherwise $q(e)$ is a point. The edge $e$ is called \\textit{horizontal} in the former case, and \\textit{vertical} in the latter case. We record the following simple observation.\n\\begin{lem}\n\\label{descending automorphism general case}\nLet $\\alpha: Y\\rightarrow Y$ be a cubical ${\\operatorname{CAT}}(0)$  automorphism of $Y$ that maps vertical \nedges to vertical \nedges and horizontal edges to horizontal edges. Then $\\alpha$ descends to an \nautomorphism  $Y({\\mathcal K})\\rightarrow Y({\\mathcal K})$.\n\\end{lem}\n\n\nThe following result shows that restriction quotients may be characterized in \nseveral different ways.\n\\begin{thm}\n\\label{thm_restriction_quotient_characterization}\nIf $f:Y\\to Z$ is a surjective cubical map between two ${\\operatorname{CAT}}(0)$ cube complexes, then the following conditions are equivalent:\n\\begin{enumerate}\n\\item The inverse image of each vertex of $Z$ is convex.\n\\item The inverse image of every point in $Z$ is convex.\n\\item The inverse image of every convex subcomplex of $Z$ is convex.\n\\item The inverse image of every hyperplane in $Z$ is a hyperplane.\n\\item $f$ is equivalent to a restriction quotient, i.e. for some set of walls\n${\\mathcal K}$ in $Y$, there is a cubical isomorphism $\\phi:Z\\rightarrow Y({\\mathcal K})$\nmaking the following   diagram commute:\n\\begin{diagram}\nY       &&\\\\\n\\dTo^f  & \\rdTo^q &\\\\\nZ       & \\rTo_\\phi   & Y({\\mathcal K})\n\\end{diagram}\n\\end{enumerate}\n\\end{thm}\n\nThe proof of Theorem \n\\ref{thm_restriction_quotient_characterization} will take several lemmas.\nFor the remainder of this subsection we \nfix  ${\\operatorname{CAT}}(0)$ cube complexes $Y$ and $Z$ and a (not necessarily\nsurjective) cubical map $f:Y\\to Z$. \n\n\\begin{lemma}\n\\label{lem_fiber_functor}\nLet $\\sigma\\subset Z$ be a cube and let $Y_{\\sigma}$ be the be the union of cubes in $Y$ whose image under $f$ is exactly $\\sigma$. Then:\n\\begin{enumerate}\n\\item If $y\\in \\sigma$ is an interior point, then $f^{-1}(y)\\subset Y_{\\sigma}$.\n\\item $f^{-1}(y)$ has a natural induced structure as a cube complex; moreover, there is a natural isomorphism of cube complexes $Y_{\\sigma}\\cong f^{-1}(y)\\times \\sigma$.\n\\item If ${\\sigma}_1\\subset{\\sigma}_2$ are cubes of $Z$ and $y_i\\in{\\sigma}_i$ are interior\npoints, then there is a canonical embedding $f^{-1}(y_2)\\hookrightarrow f^{-1}(y_1)$.\nMoreover, these embeddings are compatible with composition of inclusions.\n\\end{enumerate}\n\\end{lemma}\n\n\\begin{lem}\n\n\\mbox{}\n\\begin{enumerate}\n\\item For every  $y\\in Z$, every \nconnected component of $f^{-1}(y)$ is a convex subset of $Y$.\n\\item For every convex subcomplex $A\\subset Z$, every connected component of $f^{-1}(A)$ is a convex subcomplex of $Y$.\n\\end{enumerate}\n\\end{lem}\n\n\\begin{proof}\nFirst we prove (1). Let $\\sigma$ be the support of $y$ and let $Y_{\\sigma}\\cong f^{-1}(y)\\times \\sigma$ be the subcomplex defined as above. It suffices to show $Y_{\\sigma}$ is locally convex. Pick vertex $x\\in Y_{\\sigma}$, and let $\\{e_{i}\\}_{i=1}^{n}$ be a collection of edges in $Y_{\\sigma}$ that contains $x$. It suffices to show if these edges span an $n$-cube $\\eta\\subset Y$, then $\\eta\\subset Y_{\\sigma}$. It suffices to consider the case when all $e_{i}$'s are orthogonal to $\\sigma$, in which case it follows from Definition \\ref{cubical map} that $\\eta\\times \\sigma\\subset Y_{\\sigma}$.\n\nTo see (2), pick an $n$-cube $\\eta\\subset Y$ and let $\\{e_{i}\\}_{i=1}^{n}$ be the edges of $\\eta$ at one corner $c\\subset \\eta$.\nIt suffices to show if $f(e_{i})\\subset A$, then $f(\\eta)\\subset A$. Note that $f(\\eta)$ is a cube, and every edge of this cube which emanates from the corner $f(c)$ is contained in $A$.  Thus $f(\\eta)\\subset A$ by the convexity of $A$.\n\\end{proof}\n\n\\begin{lem}\n\\label{inverse image of hyperplane}\nLet $f:Y\\to Z$ be a cubical map as above. Then:\n\\begin{enumerate}\n\\item The inverse image of each hyperplane of $Z$ is a disjoint union of hyperplanes in $Y$.\n\\item If the inverse image of each hyperplane of $Z$ is a single hyperplane, then for each point $y\\in Z$, the point inverse $f^{-1}(y)$ is connected, and hence convex. \n\\end{enumerate}\n\\end{lem}\n\n\\begin{proof}\nIt follows from Definition \\ref{cubical map} that the inverse image of each hyperplane of $Z$ is an union of hyperplanes. If two of them were to \nintersect, then there would be a 2-cube in $Y$ with two consecutive edges  \nmapped to the same edge in $Z$, which is impossible.\n\nNow we prove (2). It suffices to consider the case that $y$ is the center of some cube in $Z$. In this case, $y$ is a vertex in the first cubical subdivision of $Z$, and $f$ can viewed as a cubical map from the first cubical subdivision of $Y$ to the first cubical subdivision of $Z$ such that the inverse image of each hyperplane is a single hyperplane, thus it suffices to consider the case that $y$ is a vertex of $Z$.\n\nSuppose $f^{-1}(y)$ contains two connected components $A$ and $B$. Pick a combinatorial geodesic $\\omega$ of shortest distant that connects vertices in $A$ and vertices in $B$. Note that $f(\\omega)$ is a non-trivial edge-loop in $Z$, otherwise we will have $\\omega\\subset f^{-1}(y)$. It follows that there exists two different edges $e_{1}$ and $e_{2}$ of $\\omega$ mapping to parallel edges in $Y$. The hyperplanes dual to $e_{1}$ and $e_{2}$ are different, yet they are mapped to the same hyperplane in $Y$, which is a contradiction.\n\\end{proof}\n\n\\begin{lem}\n\\label{vertex to hyperplane}\nIf $f$ is surjective, and for any vertex $v\\in Z$, $f^{-1}(v)$ is connected, then the inverse image of each hyperplane of $Z$ is a single hyperplane.\n\\end{lem}\n\n\\begin{proof}\nLet $h\\subset Z$ be a hyperplane, by Lemma \\ref{inverse image of hyperplane}, $f^{-1}(h)=\\sqcup_{\\lambda\\in\\Lambda}h_{\\lambda}$ where each $h_{\\lambda}$ is a hyperplane in $Y$. Since $f$ is surjective, $\\{f(h_{\\lambda})\\}_{\\lambda\\in\\Lambda}$ is a collection of subcomplexes of $h$ that cover $h$. Thus there exists $h_1,h_2\\in\\{h_{\\lambda}\\}_{\\lambda\\in\\Lambda}$ and vertex $u\\in h$ such that $u\\subset f(h_1)\\cup f(h_2)$. Let $e\\subset Z$ be the edge such that $u=e\\cap h$, then there exist edges $e_{1},e_{2}\\subset Y$ such that $e_{i}\\cap h_{i}\\neq\\emptyset$ and $f(e_{i})=e$ for $i=1,2$. Since $h_{1}\\cap h_{2}=\\emptyset$, a case study implies there exist $x_{1}$ and $x_{2}$ which are endpoints of $e_1$ and $e_2$ respectively such that \n\\begin{enumerate}\n\\item these two points are separated by at least one of $h_{1}$ and $h_2$;\n\\item they are mapped to the same end point $y\\in e$.\n\\end{enumerate}\nIt follows that $f^{-1}(y)$ is disconnected, which is a contradiction.\n\\end{proof}\n\n\\begin{remark}\nIf $f$ is not surjective, then the above conclusion is not necessarily true. Consider the map from $A=[0,3]\\times[0,1]$ to the unit square which collapses the $[0,1]$ factor in $A$ and maps $[0,3]$ to 3 consecutive edges in the boundary of the unit square.\n\\end{remark}\n\n\n\\begin{lem}\n\\label{restriction quotient}\nIf $q:Y\\to Y({\\mathcal K})$ is the restriction quotient as Definition\n\\ref{def_restriction_quotient}, \nthen the inverse image of each hyperplane in $Y({\\mathcal K})$ is a single hyperplane in $Y$. Conversely, suppose $f:Y\\to Z$ is a surjective cubical map between ${\\operatorname{CAT}}(0)$ cube complexes such that the inverse image of each hyperplane is a hyperplane. Let ${\\mathcal K}$ be the collection of walls arising from inverse images of hyperplanes in $Z$. Then there is a natural isomorphism $i: Z\\cong Y({\\mathcal K})$ which fits into the following commutative diagram:\n\\begin{diagram}\nY &\\rTo^f &Z\\\\\n&\\rdTo_q &\\dTo^i \\\\\n& &Y({\\mathcal K})\n\\end{diagram}\n\\end{lem}\n\n\\begin{proof}\nDefine two vertices of $Y$ to be ${\\mathcal K}$-equivalent if and only if they are not separated by any wall in ${\\mathcal K}$. This defines an equivalence relation on vertices of $Y$, and the corresponding equivalent classes are called ${\\mathcal K}$-classes. For each ${\\mathcal K}$-class $C$ and every wall in ${\\mathcal K}$, we may choose the halfspace that contains $C$; it follows that the points in $C$ are exactly the set of vertices contained in the intersection of such halfspaces, and thus $C$ is the vertex set of a convex subcomplex of $Y$. Note that each ${\\mathcal K}$-class determines a 0-cube of $(Y^{0},{\\mathcal K})$, hence is mapped to this 0-cube under $q$. It follows that the inverse image of every vertex in $Y({\\mathcal K})$ is convex, thus by Lemma \\ref{vertex to hyperplane}, the inverse image of a hyperplane is a hyperplane.\n\nIt remains to prove the converse. Note that the inverse image of each halfspace in $Z$ under $f$ is a halfspace of $Y$. Moreover, the surjectivity of $f$ implies that $f$ maps hyperplane to hyperplane and halfspace to halfspace. Pick vertex $y\\in Z$, let $\\{H_{\\lambda}\\}_{\\lambda\\in\\lambda}$ be the collection of hyperplanes in $Z$ that contains $y$. Then $f^{-1}(y)\\subset \\cap_{\\lambda\\in\\Lambda}f^{-1}(H_{\\lambda})$, and every vertex of $\\cap_{\\lambda\\in\\Lambda}f^{-1}(H_{\\lambda})$ is mapped to $y$ by $f$, and thus the vertex set of $f^{-1}(y)$ is a ${\\mathcal K}$-class. This induces a bijective map from $Z^{(0)}$ to the vertex set of $Y({\\mathcal K})$, which extends to an isomorphism. The above diagram commutes since it commutes when restricted to the 0-skeleton.\n\\end{proof}\n\n\n\n\\begin{proof}[Proof of Theorem \\ref{thm_restriction_quotient_characterization}]\nThe equivalence of (4) and (5) follows from Lemma \\ref{restriction quotient}. $(1)\\Rightarrow(4)$ follows from Lemma \\ref{vertex to hyperplane}, $(4)\\Rightarrow(2)$ follows from Lemma \\ref{inverse image of hyperplane}, $(3)\\Rightarrow(1)$ is obvious. It suffices to show $(2)\\Rightarrow(3)$. Pick a convex subcomplex $K\\subset Z$ and let $\\{R_{\\lambda}\\}_{\\lambda\\in\\Lambda}$ be the collection of cubes in $K$. For each $R_{\\lambda}$, let $Y_{R_{\\lambda}}$ be the subcomplex defined after Definition \\ref{cubical map}. $Y_{R_{\\lambda}}\\neq\\emptyset$ since $f$ is surjective and $Y_{R_{\\lambda}}$ is connected by (2). If $R_{\\lambda}\\subset R_{\\lambda'}$, then $Y_{R_{\\lambda}}\\cap Y_{R_{\\lambda'}}\\neq\\emptyset$. Thus $f^{-1}(K)=\\cup_{\\lambda\\in\\Lambda} Y_{R_{\\lambda}}$ is connected, hence convex.\n\\end{proof}\n\n\n\n\n\\subsection{Restriction maps versus fiber functors}\n\\label{sec_restriction_maps_versus_fiber_functors}\n\n\n\n\n\n\n\n\n\n\n\nIf $q:Y\\rightarrow Z$ is a restriction quotient between ${\\operatorname{CAT}}(0)$ cube complexes, then\n we may express the fiber structure in categorical\nlanguage as follows.  Let ${\\operatorname{Face}}(Z)$ denote the face poset of $Z$, viewed as a\ncategory, and let \n ${\\operatorname{CCC}}$  \ndenote the category whose objects are  nonempty ${\\operatorname{CAT}}(0)$\ncube complexes and whose morphisms are convex cubical embeddings. \nBy Lemma \\ref{lem_fiber_functor}, we obtain a contravariant functor \n$\\Psi_q:{\\operatorname{Face}}(Z)\\rightarrow {\\operatorname{CCC}}$.\n\n\\begin{definition}\nThe contravariant functor $\\Psi_q$ is the {\\em fiber functor} of the \nrestriction quotient $q:Y\\rightarrow Z$. \n\\end{definition}\nFor notational brevity, for any inclusion $i:{\\sigma}_1\\rightarrow{\\sigma}_2$, we \nwill often denote the map $\\Psi(i):\\Psi({\\sigma}_2)\\rightarrow \\Psi({\\sigma}_1)$ simply\nby $\\Psi({\\sigma}_2)\\rightarrow \\Psi({\\sigma}_1)$, suppressing the name of the map.\n\n\n\n\n\n\n\n\n\n\nNote that if ${\\sigma}_1\\subset{\\sigma}_2\\subset{\\sigma}_3$, then the functor property\nimplies that the image of $\\Psi({\\sigma}_3)\\rightarrow \\Psi({\\sigma}_1)$ is a convex\nsubcomplex of the image of $\\Psi({\\sigma}_2)\\rightarrow \\Psi({\\sigma}_1)$.  In particular,\nif $v$ is a vertex of a cube ${\\sigma}$, then the image of\n$\\Phi({\\sigma})\\rightarrow \\Psi(v)$ is a convex subcomplex of the intersection\n\n", "itemtype": "equation", "pos": 27174, "prevtext": "\nBy the uniqueness assertion,\nwe obtain a cubical action ${\\operatorname{QI}}(X){\\curvearrowright} |{\\mathcal{B}}|$ of the quasi-isometry \ngroup of $X$ on $|{\\mathcal{B}}|$.\n\\end{theorem}\n\nWe point out that the partial rigidity statement of the theorem does not hold\nfor general RAAG's: it only holds for the RAAG's covered by the theorem in\n\\cite {huang2014quasi}.\n\n\n\\bigskip\\bigskip\n\n\\subsection*{The main results}\nWe will produce good geometric models quasi-isometric to $X({\\Gamma})$\nthat are simultaneously compatible with group actions,  the underlying\nbuilding $|{\\mathcal{B}}|$, and cubical structure.   The key idea for expressing this is:\n\n\n\\begin{definition}\n\\label{def_restriction_quotient}\nA cubical map \n $q:Y\\rightarrow Z$ between ${\\operatorname{CAT}}(0)$ cube complexes (see Definition \\ref{cubical map})\nis a {\\em restriction\nquotient}\nif it is  surjective, and the point inverse $q^{-1}(z)$  is a convex subset of $Y$ \nfor every $z\\in Z$.\n\\end{definition} \n\n\nIt turns out that restriction quotients as defined above are essentially \nequivalent to the class of mappings introduced by Caprace-Sageev \n\\cite{caprace2011rank} with a different definition (see\nSection \\ref{sec_restriction_quotients} \nfor the proof that the definitions are equivalent).  \nRestriction quotients $Y\\rightarrow |{\\mathcal{B}}|$ provide a means to ``resolve'' or \t``blow-up''\nthe locally infinite building $|{\\mathcal{B}}|$ to a locally finite ${\\operatorname{CAT}}(0)$ cube complex.\n\n\n\\begin{theorem}\n\\label{thm_main_intro_quasi_action}\n(See Section \\ref{sec_preliminaries} for definitions.)\nLet $H{\\curvearrowright} X$ be a quasi-action of an arbitrary group on $X=X({\\Gamma})$,\nwhere ${\\operatorname{Out}}(G({\\Gamma}))$ is finite and $G({\\Gamma})\\not\\simeq {\\mathbb Z}$.   Then there is an $H$-equivariant \nrestriction quotient $H{\\curvearrowright} Y\\stackrel{q}{{\\longrightarrow}}H{\\curvearrowright} |{\\mathcal{B}}|$\n\n\n\n\n\n\n\n\nwhere: \n\\begin{enumerate}[label=(\\alph*)]\n\\item $H{\\curvearrowright} |{\\mathcal{B}}|$ is the cubical action arising from the quasi-action $H{\\curvearrowright} X$\nusing Theorem \\ref{thm_main_intro_quasi_action}, and $H{\\curvearrowright} Y$ is a cubical  action.\n\\item The point inverse $q^{-1}(v)$ of every rank $k$ vertex $v\\in |{\\mathcal{B}}|^{(0)}$\nis a copy of ${\\mathbb R}^k$ with the usual cubulation.\n\\item $H{\\curvearrowright} X$ is \nquasiconjugate to the cubical action $H{\\curvearrowright} Y$.\n\\end{enumerate} \n\n\n\n\n\n\n\\end{theorem}\n\n\n\\begin{theorem}\n\\label{thm_main_intro}\nIf $|{\\operatorname{Out}}(G({\\Gamma}))|<\\infty$ and $G({\\Gamma})\\not\\simeq{\\mathbb Z}$, then  a finitely generated group $H$ \nis quasi-isometric to $G({\\Gamma})$ iff \n there is an $H$-equivariant \nrestriction quotient $H{\\curvearrowright} Y\\stackrel{q}{{\\longrightarrow}}H{\\curvearrowright} |{\\mathcal{B}}|$\nwhere \n\\begin{enumerate}[label=(\\alph*)]\n\\item $H{\\curvearrowright} Y$ is a geometric cubical  action.\n\\item $H{\\curvearrowright} |{\\mathcal{B}}|$ is cubical.\n\\item The point inverse $q^{-1}(v)$ of every rank $k$ vertex $v\\in |{\\mathcal{B}}|^{(0)}$\nis a copy of ${\\mathbb R}^k$ with the usual cubulation.\n\\end{enumerate}\n\\end{theorem}\n\\begin{remark}\nIn fact the restriction quotient $Y\\rightarrow |{\\mathcal{B}}|$ in Theorems\n\\ref{thm_main_intro_quasi_action} and \\ref{thm_main_intro} has slightly\nmore structure, see Theorem \\ref{thm_quasi_action1}.\n\\end{remark}\n\nIn particular, we have:\n\\begin{corollary}\n\\label{cor_intro_main} \nAny group quasi-isometric to $G$ is cocompactly cubulated, i.e.\nit has a geometric cubical action on a  ${\\operatorname{CAT}}(0)$ cube complex.\n\\end{corollary}\n\n\nOne may compare Theorem \\ref{thm_main_intro} with rigidity theorems for\nsymmetric spaces or products of trees, which characterize a quasi-isometry \nclass of groups by the existence of a geometric action on a model space of\na specified type\n\\cite{sullivan,gromov_hyperbolic_manifolds_groups,tukia,pansu,kleiner1997rigidity,stallings,dunwoody1985accessibility,kapovich1998quasi,mosher2003quasi,ahlin}.  \nAs in the case of products of trees --- and unlike the\ncase of symmetric spaces ---\nthere are finitely generated groups $H$ as in \nTheorem \\ref{thm_main_intro} which do not admit a\ngeometric action on the original model space $X$, so one is forced\nto pass to a different space $Y$ \\cite{bks2,huang2014quasi}.  Also, Theorems \\ref{thm_main_intro_quasi_action} \nand \\ref{thm_main_intro} fail for general RAAG's, for instance for \nfree abelian groups of rank $\\geq 2$, and for products of nonabelian\nfree groups $\\prod_{1\\leq j\\leq k} G_j$, for $k\\geq 1$.\n\n\nThe quasi-isometry invariance \nof the existence of a cocompact cubulation as asserted in Corollary\n\\ref{cor_intro_main} is false in general.\nSome groups quasi-isometric to ${\\mathbb H}^2\\times{\\mathbb R}$ \nadmit a cocompact cubulation, while others are not virtually $CAT(0)$\n\\cite{bridson_haefliger}.   Combining \n\\cite{leeb}, \\cite{behrstock2008quasi} and \\cite{hagen_przytycki}, \nit follows that there is a\npair of quasi-isometric $CAT(0)$ graph manifold groups, one of which \nis the fundamental group of a compact special cube complex, while the\nother is not virtually cocompactly cubulated.\nThe  quasi-isometry invariance of cocompact cubulations fails to hold even among RAAG's:\nfor $n>1$\nthere are groups  \nquasi-isometric  ${\\mathbb R}^n$ that are not cocompactly cubulated\n\\cite{hagen_crystallographic}.\n\nEarlier cocompact\ncubulation theorems in the spirit of  Corollary \\ref{cor_intro_main} \ninclude \nthe cases of groups quasi-isometric to trees, products of trees, and \nhyperbolic $k$-space ${\\mathbb H}^k$ for $k\\in \\{2,3\\}$\n\\cite{stallings,dunwoody1985accessibility,kapovich1998quasi,mosher2003quasi,ahlin,gitik_widths,kahn_markovic,bergeron_wise}.  \nIt is worth noting that each case requires\ndifferent ingredients that are specific to the spaces in question.  \n\n\n\n\n\n\n\n\n\n\n\n\\subsection*{Further results}\nWe briefly discuss some further results here, referring the reader to the\nbody of the paper for details.\n\nOne portion of the proof of Theorem \\ref{thm_main_intro_quasi_action} has\nto do with \nthe geometry of restriction quotients, and more specifically, restriction\nquotients with a right-angled building as target.  We view this as a \ncontribution to cube complex geometry, and to the geometric theory of \ngraph products; beyond the \nreferences mentioned already, our treatment has been\ninfluenced by the papers of Januszkiewicz-Swiatkowski and Haglund  \n\\cite{januszkiewicz_swiatkowski,haglund2008finite}.\nThe main results on this are:\n\n\n\\begin{enumerate}[label=(\\alph*)]\n\\item We show in Section \\ref{sec_restriction_quotients}\nthat restriction quotients  may be characterized\nin several different ways.  \n\\item We show that having a restriction quotient $q:Y \\rightarrow Z$\nis equivalent to \nknowing certain ``fiber data'' living on the target complex $Z$.  \n\\item When $|{\\mathcal{B}}|$ is the Davis realization of  a right-angled\nbuilding ${\\mathcal{B}}$ and $Y\\rightarrow |{\\mathcal{B}}|$ is a restriction\nquotient whose fibers are copies of ${\\mathbb R}^k$ with dimension specified \nas in Theorems \\ref{thm_main_intro_quasi_action} and \\ref{thm_main_intro},\nthe fiber data in (b) may be distilled even more, leading to what we call\n``blow-up data''.   \n\\end{enumerate}\n\nAs by-products of (a)-(c), we obtain:\n\n\\begin{itemize}\n\\item A characterization of the quasi-actions $H{\\curvearrowright} X({\\Gamma})$ that are \nquasiconjugate to isometric actions $H{\\curvearrowright} X({\\Gamma})$ (Section \\ref{subsection_nicer action}).\n\\item A characterization of the restriction quotients $Y\\rightarrow |{\\mathcal{B}}|$\nsatisfying (b) of Theorem \\ref{thm_main_intro_quasi_action}\nfor which $Y$ is quasi-isometric to $X$ (Corollary \\ref{if and only if} and Theorem \\ref{quasi-isometry to G}).  \n\\item A proof of uniqueness of the right-angled building modelled\non the right-angled Coxeter group $W({\\Gamma})$ with defining graph ${\\Gamma}$,\nwith countably infinite rank $1$ residues (Corollary \\ref{uniqueness of building}).\n\\item Applications to more general graph products (Theorem \\ref{geometric action}).\n\\end{itemize}\n\nIt follows from \\cite{kleiner2001groups} that a finitely generated group $H$ \nquasi-isometric to a symmetric space of noncompact type $X$ admits\nan epimorphism $H\\rightarrow {\\Lambda}$ with finite kernel, where ${\\Lambda}$ is a \ncocompact lattice in the isometry group ${\\operatorname{Isom}}(X)$.  \nIn contrast to this, we have the following result,\nwhich is inspired by \\cite[Theorem 9, Corollary 10]{mosher2003quasi}:\n\n\n\\begin{theorem}\n\\label{thm_no_overgroup}\n(See Section \\ref{subsection_nicer action})\nSuppose $G$ is a RAAG with $|{\\operatorname{Out}}(G)|<\\infty$.\nThen there are finitely generated groups $H$ and $H'$ quasi-isometric to \n$G$  that do not admit discrete, virtually faithful cocompact\nrepresentations into\nthe same locally compact topological group.\n\\end{theorem} \n\n\\subsection*{Open questions}\nAs mentioned above, Corollary \\ref{cor_intro_main} may be considered part\nof the quasi-isometry classification program for finitely generated groups.\nThe leads to:\n\n\\begin{question}\n\\label{que_commensurability}\nIf ${\\operatorname{Out}}(G({\\Gamma}))$ is finite, what is the commensurability classification of\ngroups quasi-isometric to $G({\\Gamma})$?\nAre they all commensurable to $G({\\Gamma})$? What about cocompact lattices\nin the automorphism group of $X({\\Gamma})$?\n\\end{question}\nFor comparison, we recall that any  group quasi-isometric\nto a tree is commensurable to a free group, but there are groups\nquasi-isometric to a product of trees that contain no nontrivial \nfinite index subgroups, and are therefore not commensurable to\na product of free groups \\cite{wise1996non,burger_mozes}.\n\nWe mention that Theorem \\ref{thm_main_intro}\nwill be used in forthcoming \nwork to  answer Question \\ref{que_commensurability} in certain cases.\n\n\n\n\\bigskip\n\n\\subsection*{Discussion of the proofs}\nBefore sketching the arguments for Theorems \n\\ref{thm_main_intro_quasi_action} and\n\\ref{thm_main_intro}, we first illustrate\nthem in the tautological case when $H=G$ and the quasi-action is the \ndeck group action\n$G{\\curvearrowright} X$.  In this case we cannot take $Y=X$, as there is no\n$H$-equivariant restriction quotient $H{\\curvearrowright} X\\rightarrow H{\\curvearrowright} |{\\mathcal{B}}|$\nsatisfying (c) of Theorem \\ref{thm_main_intro}.  Instead, we\nuse a different geometric model.  \n\n\\begin{definition}[Graph products of spaces \\cite{haglund2008finite}]\n\\label{def_graph_product_of_spaces}\nFor every vertex $v\\in V({\\Gamma})$, choose a pointed geodesic metric space\n$(Z_v,\\star_v)$.  The {\\em ${\\Gamma}$-graph product of  \n$\\{(Z_v,\\star_v)\\}_{v\\in V({\\Gamma})}$}\nis obtained by forming the product $\\prod_v (Z_v,\\star_v)$, and passing\nto the union of the subproducts corresponding to the cliques in ${\\Gamma}$.\nWe denote this by $\\prod_{\\Gamma} (Z_v,\\star_v)$.\nWhen the $Z_v$'s are nonpositively curved, then so is the\ngraph product \\cite[Corollary 4.6]{haglund2008finite}.\n\\end{definition}\n\n\nThere are three graph products that are useful here:\n\\begin{enumerate}\n\\item The\nSalvetti complex $S({\\Gamma})$ is the graph product $\\prod_{\\Gamma}(S^1_v,\\star_v)$,\nwhere $(S^1_v,\\star_v)$ is a pointed unit circle.\n\\item  For every $v\\in V({\\Gamma})$, let $(L_v,\\star_v)$\nbe a pointed lollipop, i.e. $L_v$ is the wedge of the \nunit  circle $S^1_v$\nand a unit interval $I_v$, and the basepoint $\\star_v\\in L_v$ is the vertex\nof valence $1$.   Then the graph product \n$\\prod_{\\Gamma}(L_v,\\star_v)$ is the {\\em exploded Salvetti \ncomplex $S_e=S_e({\\Gamma})$.} We denote its universal covering \nby $X_e\\rightarrow S_e$.\n\\item If  $(Z_v,\\star_v)$  is a unit interval and $\\star_v\\in Z_v$ is an endpoint\nfor every $v\\in V({\\Gamma})$, then the graph product \n$\\prod_{\\Gamma} (Z_v,\\star_v)$ is the {\\em Davis chamber}, \ni.e. it is a copy of the Davis realization $|c|$ of a chamber $c$ in \n$|{\\mathcal{B}}|({\\Gamma})$;  \n for this reason we will denote it by $|c|_{\\Gamma}$.\n\\end{enumerate}\nBy collapsing  the  interval $I_v$ in each lollipop $L_v$\nto a point, we obtain a cubical map $S_e\\rightarrow S$; this has  \ncontractible point inverses, and  is therefore  a homotopy \nequivalence.  If we collapse the circles $S^1_v\\subset L_v$\nto points instead, we get a  map $S_e \\rightarrow |c|_{\\Gamma}$ to the Davis chamber\nwhose point \ninverses are closed, locally convex tori.  The point inverses of the \ncomposition $X_e\\rightarrow S_e\\rightarrow |c|_{\\Gamma}$ cover the torus point inverses of \n$S_e\\rightarrow |c|_{\\Gamma}$, and their connected components form a ``foliation'' of $X_e$\nby flat convex subspaces.  It turns out that by collapsing $X_e$ along\nthese flat subspaces, we obtain a copy of $|{\\mathcal{B}}|$, and the quotient map\n$X_e\\rightarrow |{\\mathcal{B}}|$ is a restriction quotient $X_e\\rightarrow |{\\mathcal{B}}|$.  Alternately,\none may take the collection $\\mathcal{K}$ of hyperplanes  of $X_e$ \ndual to edges ${\\sigma}\\subset X_e$ whose projection under $X_e\\rightarrow |c|_{\\Gamma}$ is\nan edge, and form the restriction quotient using the Caprace-Sageev\nconstruction.\n\n\n\\begin{remark}\nThe exploded Salvetti complex and the restriction quotient $X_e\\rightarrow |{\\mathcal{B}}|$\nwere discussed  in \\cite{bks2} in the $2$-dimensional\ncase, using an ad hoc construction that was initially \ninvented for ``ease of visualization''.  However, the authors were unaware of\nthe  general description above, and the notion of restriction \nquotient had not yet appeared. \n\\end{remark}\n\nWe now discuss the proofs of Theorem \\ref{thm_main_intro_quasi_action}\nand the forward direction of \\ref{thm_main_intro}.\n\n\nThe \nforward direction of Theorem \\ref{thm_main_intro} reduces to Theorem \n\\ref{thm_main_intro_quasi_action}, by the standard observation that\na quasi-isometry $H\\rightarrow G\\stackrel{qi}{\\simeq}X$ allows us to \nquasiconjugate the left translation action $H{\\curvearrowright} H$ to a quasi-action\n$H{\\curvearrowright} X$.  Therefore we focus on Theorem \\ref{thm_main_intro_quasi_action}.\n\nLet $H{\\curvearrowright} X$ be as in Theorem \\ref{thm_main_intro_quasi_action}.  By a \nbounded perturbation, we may assume that this quasi-action preserves the\n$0$-skeleton $X^{(0)}\\subset X$.  Applying\nTheorem \\ref{thm_intro_vertex_rigidity}, we may further assume that we\nhave an action $H{\\curvearrowright} X^{(0)}$ by flat-preserving quasi-isometries.  The \nfact the we have an action, rather than just a quasi-action, \ncomes from the\nuniqueness in Theorem \\ref{thm_main_intro_quasi_action}; this turns\nout to be a crucial point in the sequel.\n\nBefore proceeding further, we remark that if one is only interested in \nCorollary \\ref{cor_intro_main} as opposed to the more refined statement in \nTheorem \\ref{thm_main_intro}, then there is an alternate approach using \nwallspaces.  This is treated in Sections \\ref{sec_construction of wallspace}\nand \\ref{sec_property of wallspace}.\n\nGiven a standard geodesic $\\ell\\subset X$, the parallel set $P_\\ell\\subset X$\ndecomposes as a product ${\\mathbb R}_\\ell\\times Q_\\ell$, where ${\\mathbb R}_\\ell$ is a copy\nof ${\\mathbb R}$;  likewise there\nis a product decomposition of $0$-skeleta \n$P_\\ell^{(0)}\\simeq {\\mathbb Z}_\\ell\\times Q_\\ell^{(0)}$.  One argues that\nthe action $H{\\curvearrowright} X^{(0)}$ permutes the collection of \n$0$-skeleta $\\{P_\\ell^{(0)}\\}_{\\ell}$, and that for any $\\ell$, the stabilizer\n${\\operatorname{Stab}}(P_\\ell^{(0)},H)$ \nof $P_\\ell^{(0)}$ in $H$ acts on $P_\\ell^{(0)}\\simeq {\\mathbb Z}_\\ell\\times Q_\\ell^{(0)}$\npreserving the product structure.  We call the \naction ${\\operatorname{Stab}}(P_\\ell^{(0)},H){\\curvearrowright} {\\mathbb Z}_\\ell$ a {\\em factor action}.  The factor\nactions are by bijections with  quasi-isometry constants \nbounded uniformly independent of $\\ell$.\n\nIt turns out that factor actions  play\na central role in the story.  For instance, when the action $H{\\curvearrowright} X^{(0)}$ \nis the restriction of an action $H{\\curvearrowright} X$ by cubical isometries, then \nthe factor actions $H_{[\\ell]}{\\curvearrowright} {\\mathbb Z}_{[\\ell]}$ are also actions by isometries.\nIn general the factor actions can be arbitrary: up to isometric\nconjugacy, any action $A{\\curvearrowright} {\\mathbb Z}$\nby quasi-isometries with uniform constants can arise as a factor\naction for some action as in Theorem \\ref{thm_main_intro_quasi_action}.  \nA key step in the proof is to show that such actions have a relatively\nsimple structure:\n\\begin{proposition}[Semiconjugacy]\n\\label{prop_intro_semiconjugacy}\nLet $U\\stackrel{\\rho_0}{{\\curvearrowright}} {\\mathbb Z}$ be an action of an arbitrary\ngroup by $(L,A)$-quasi-isometries. \nThen there is an\nisometric action $U\\stackrel{\\rho_1}{{\\curvearrowright}}{\\mathbb Z}$ and  \nsurjective equivariant $(L',A')$-quasi-isometry \n\n", "index": 3, "text": "$$\nU\\stackrel{\\rho_0}{{\\curvearrowright}} {\\mathbb Z}{\\longrightarrow}\nU\\stackrel{\\rho_1}{{\\curvearrowright}}{\\mathbb Z}\\,,\n$$\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex2.m1\" class=\"ltx_Math\" alttext=\"U\\stackrel{\\rho_{0}}{{\\curvearrowright}}{\\mathbb{Z}}{\\longrightarrow}U%&#10;\\stackrel{\\rho_{1}}{{\\curvearrowright}}{\\mathbb{Z}}\\,,\" display=\"block\"><mrow><mrow><mi>U</mi><mover><mo movablelimits=\"false\">\u21b7</mo><msub><mi mathsize=\"142%\">\u03c1</mi><mn mathsize=\"140%\">0</mn></msub></mover><mi>\u2124</mi><mo>\u27f6</mo><mi>U</mi><mover><mo movablelimits=\"false\">\u21b7</mo><msub><mi mathsize=\"142%\">\u03c1</mi><mn mathsize=\"140%\">1</mn></msub></mover><mpadded width=\"+1.7pt\"><mi>\u2124</mi></mpadded></mrow><mo>,</mo></mrow></math>", "type": "latex"}, {"file": "1601.00946.tex", "nexttext": "\n\n\n\\begin{definition}\nLet $Z$ be a cube complex.\nA contravariant functor $\\Psi:{\\operatorname{Face}}(Z)\\rightarrow {\\operatorname{CCC}}$ is {\\bf $1$-determined}\nif for every cube ${\\sigma}\\in{\\operatorname{Face}}(Z)$, and every vertex $v\\in{\\sigma}^{(0)}$,\n\n", "itemtype": "equation", "pos": 78731, "prevtext": "\nwhere $L'$ and $A'$ depend only on $L$ and $A$.\n\\end{proposition}\nThe assumption that $\\rho_0$ is an action, as opposed\nto a quasi-action, is crucial:\nif a group $U$ has a nontrivial\nquasihomomorphism $\\alpha:U\\rightarrow {\\mathbb R}$, then the translation quasi-action\n$U\\stackrel{\\hat\\alpha}{{\\curvearrowright}}{\\mathbb R}$ defined by  $\\hat\\alpha(u)(x)=x+\\alpha(u)$\nis quasiconjugate to a quasi-action on ${\\mathbb Z}$, but not to an isometric\naction on ${\\mathbb Z}$.  \n\nIt follows immediately from the\nProposition \\ref{prop_intro_semiconjugacy} that $U\\stackrel{\\rho_0}{{\\curvearrowright}}{\\mathbb Z}$\nis quasiconjugate to an isometric action on the tree ${\\mathbb R}$.\nIn that respect Proposition \\ref{prop_intro_semiconjugacy} is similar to\nthe theorem of Mosher-Sageev-Whyte \nabout promoting quasi-actions on bushy trees to isometric actions on trees\n\\cite[Theorem 1]{mosher2003quasi}.\nSince ${\\mathbb R}$ is not \nbushy  \\cite[Theorem 1]{mosher2003quasi} does not apply, and indeed the \nexample\nabove shows that the assumption of bushiness is essential in that theorem.\n\n\nContinuing with   the proof of Theorem \\ref{thm_main_intro_quasi_action},\nProposition \\ref{prop_intro_semiconjugacy} gives a good geometric\nmodel for the factor action ${\\operatorname{Stab}}(P_\\ell^{(0)},H){\\curvearrowright} {\\mathbb Z}_\\ell$: we \nsimply extend each isometry ${\\mathbb Z}_\\ell\\rightarrow{\\mathbb Z}_\\ell$ to an isometry \n${\\mathbb R}_\\ell\\rightarrow {\\mathbb R}_\\ell$, thereby obtaining a cubical action\n${\\operatorname{Stab}}(P_\\ell^{(0)},H){\\curvearrowright} {\\mathbb R}_\\ell$.  \nIn vague terms, the remainder of the proof is concerned with combining \nthese cubical models into models for the fibers of a restriction\nquotient $Z\\rightarrow |{\\mathcal{B}}|$, in an $H$-equivariant way.  This portion of the proof\nis covered by more general results about restriction quotients, see\n(b)-(c) in the subsection on further results above. \n\n\n\\subsection*{Organization of the paper}\n\nThe paper is divided into three relatively independent parts. We first outline the content of each part, then give suggestions \nfor readers who want to focus on one particular part.\n\nA summary of notation can found in Section \\ref{sec_index_of_notation}. Section \\ref{sec_preliminaries} contains some background material on quasi-actions, $CAT(0)$ cube complexes, RAAG's and buildings. One can proceed directly to later sections with Section \\ref{sec_index_of_notation} and Section \\ref{sec_preliminaries} as references.\n\nThe main part of the paper is Section \\ref{sec_restriction_quotients} to Section \\ref{sec_quasi action on Z}, where we prove Theorem \\ref{thm_main_intro}. In Section \\ref{sec_restriction_quotients} we discuss restriction\nquotients, showing how to construct a restriction quotient $Y\\rightarrow Z$ starting\nfrom the target $Z$ and an admissible assignment of fibres to the cubes of $Z$. Then we discuss equivariance properties and the coarse geometry of restriction quotients.\n\nIn Section \\ref{sec_blow-up of building}, we introduce blow-ups of buildings based on Section \\ref{sec_restriction_quotients}.  These are restriction quotients\n$Y\\rightarrow |{\\mathcal{B}}|$ where the target is a right-angled building and the fibres are Euclidean spaces of varying dimension. We motivate our construction in Section \\ref{subsection_canonical restriction quotient} and Section \\ref{subsection_Restriction quotients with Euclidean fibers}. Blow-ups of buildings are constructed in Section \\ref{subsection_input for Z-blow-up}. Several properties of them are discussed in Section \\ref{subsection_more properties} and Section \\ref{subsection_morhpism of blow-up data}. We incorporate a group action into our construction in Section \\ref{subsection_an equivariant constuction}.\n\nIn Section \\ref{subsec_cubulation}, we apply the construction in Section \\ref{subsection_an equivariant constuction} to RAAG's and prove Theorem \\ref{thm_main_intro} modulo Theorem \\ref{prop_intro_semiconjugacy}, which is postponed until Section \\ref{sec_quasi action on Z}. In Section \\ref{subsection_nicer action} we answer several natural questions motivated by Theorem \\ref{thm_main_intro}, and prove Theorem \\ref{thm_no_overgroup}.\n\nThe second part of the paper is Section \\ref{sec_blow-up building more general version}. We discuss an alternative construction of blow-ups of buildings. In certain cases, this is more general than the construction in Section \\ref{sec_blow-up of building}. We also discuss several applications of this construction to graph products.\n\nThe third part of the paper is Section \\ref{sec_construction of wallspace} and Section \\ref{sec_property of wallspace}. Using wallspaces we give an alternative way to cubulate groups quasi-isometric to RAAG's, and prove a weaker version of Theorem \\ref{thm_main_intro}.\n\nThe reader can proceed directly to Section \\ref{sec_blow-up building more general version} with reference to Section \\ref{building} and Definition \\ref{factor action}. The reader can also start with Section \\ref{sec_construction of wallspace} with reference to Section \\ref{subsec_raag}, and come back to Section \\ref{sec_quasi action on Z} when needed.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\\subsection*{Acknowledgements}\nThe second author would like to thank Mladen Bestvian and Michah Sageev for \nmany discussions related to atomic RAAG's, which planted the seeds for the\ncubulation result in this paper.  In particular, Proposition \n\\ref{key lemma} originated in these discussions.\n\n\\tableofcontents\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\\section{Index of notation}\n\\label{sec_index_of_notation}\n\\begin{itemize}\n\\item $\\mathcal{B}$: A combinatorial  building (Section \\ref{building}).\n\\item $|{\\mathcal{B}}|$: The Davis realization of a building (Section \\ref{building}).\n\\item Chambers in the combinatorial building $\\mathcal{B}$ are $c$, $c'$, $d$.\n\\item $|c|_{\\Gamma}$: the Davis chamber (the discussion after\nDefinition \\ref{def_graph_product_of_spaces}, Section \\ref{building}).\n\\item ${\\mathsf{S}^r}$: the collection of all spherical residues in the building ${\\mathcal{B}}$.\n\\item $\\textmd{proj}_{{\\mathcal R}}:{\\mathcal{B}}\\to {\\mathcal R}$: the nearest point projection from ${\\mathcal{B}}$ to a residue ${\\mathcal R}$ (Section \\ref{building}).\n\\item $\\Lambda_{{\\mathcal{B}}}$: the collection of parallel classes of rank 1 residues in the combinatorial building ${\\mathcal{B}}$. We also write $\\Lambda$ when the building ${\\mathcal{B}}$ is clear (Section \\ref{subsection_input for Z-blow-up}).\n\\item $T$: a type map which assigns each residue of ${\\mathcal{B}}$ a subset of $\\Lambda_{{\\mathcal{B}}}$ (Section \\ref{subsection_input for Z-blow-up}).\n\\item $\\beta$: a branched line (Section \\ref{sec_construction of wallspace}).\n\\item ${\\operatorname{CCC}}$: the category of nonempty ${\\operatorname{CAT}}(0)$ cube complexes with morphisms\ngiven by convex cubical embeddings.\n\\item $P_C$: the parallel set of a closed convex subset of a ${\\operatorname{CAT}}(0)$ space\n(Section \\ref{subsec_cube complex}).\n\\item $W({\\Gamma})$:  The right-angled Coxeter group with defining graph ${\\Gamma}$\n(Section \\ref{building}).\n\\item $G({\\Gamma})$ the right-angled Artin group with defining graph ${\\Gamma}$.\n\\item $X({\\Gamma})\\to S({\\Gamma})$ the universal covering of the Salvetti complex (Section \\ref{subsec_raag})\n\\item $X_e({\\Gamma})\\to S_e({\\Gamma})$ the universal covering of the exploded Salvetti complex (after Definition \\ref{def_graph_product_of_spaces} and Section \\ref{subsection_canonical restriction quotient}). We also write $X_e\\rightarrow S_e$ when the graph ${\\Gamma}$ is clear.\n\\item $\\mathcal{P}({\\Gamma})$: the extension complex \n(Definition \\ref{def_extension_complex}).\n\\item $X\\rightarrow X({\\mathcal K})$: the restriction quotient arising from a set ${\\mathcal K}$ of \nhyperplanes in a ${\\operatorname{CAT}}(0)$ cube complex (Definition \\ref{def_restriction_quotient}).\n\\item $Lk(x,X)$ or $Lk(c,X)$: the link of a vertex $x$ or a cell $c$ in a polyhedral complex $X$.\n\\item ${\\Gamma}_1\\circ{\\Gamma}_2$: the join of two graphs.\n\\item $K_1\\ast K_2$: the join of two simplicial complexes.\n\\end{itemize}\n\n\\section{Preliminaries}\n\\label{sec_preliminaries}\n\\subsection{Quasi-actions} We recall several definitions from coarse geometry.\n\\begin{definition}\nAn $(L,A)$-quasi-action of a group $G$ on a metric space $Z$ is a map $\\rho:G\\times Z\\to Z$ so that $\\rho({\\gamma},\\cdot):Z\\to Z$ is an $(L,A)$ quasi-isometry for every ${\\gamma}\\in G$, $d(\\rho({\\gamma}_1,\\rho({\\gamma}_2,z)),\\rho({\\gamma}_1{\\gamma}_2,z))<A$ for every ${\\gamma}_1,{\\gamma}_2\\in G$, $z\\in Z$, and $d(\\rho(e,z),z)<A$ for every $z\\in Z$.\n\\end{definition}\n\nThe action $\\rho$ is \\textit{discrete} if for any point $z\\in Z$ and any $R>0$, the set of all ${\\gamma}\\in G$ such that $\\rho({\\gamma},z)$ is contained in the ball $B_{R}(z)$ is finite; $\\rho$ is \\textit{cobounded} if $Z$ coincides with a finite tubular neighbourhood of the \\textquotedblleft orbit\\textquotedblright\\ $\\rho(G,z)$. If $\\rho$ is a discrete and cobounded quasi-action of $G$ on $Z$, then the orbit map ${\\gamma}\\in G\\to \\rho({\\gamma},z)$ is a quasi-isometry. Conversely, given a quasi-isometry between $G$ and $Z$, it induces a discrete and cobounded action of $G$ on $Z$.\n\nTwo quasi-actions $\\rho$ and $\\rho'$ are \\textit{equivalent} if there exists a constant $D$ so that $d(\\rho({\\gamma}),\\rho'({\\gamma}))<D$ for all ${\\gamma}\\in G$.\n\n\\begin{definition}\nLet $\\rho$ and $\\rho'$ be quasi-actions of $G$ on $Z$ and $Z'$ respectively, and let $\\phi:Z\\to Z'$ be a quasi-isometry. Then $\\rho$ is \\textit{quasiconjugate} to $\\rho'$ via $\\phi$ if there is a $D$ so that $d(\\phi\\circ\\rho({\\gamma}),\\rho'(r)\\circ\\phi)<D$ for all ${\\gamma}\\in G$.\n\\end{definition}\n\\subsection{${\\operatorname{CAT}}(0)$ cube complexes}\n\\label{subsec_cube complex}\nWe refer to \\cite{bridson_haefliger} for background about ${\\operatorname{CAT}}(0)$ spaces (Chapter II.1) and cube complexes (Chapter II.5), and \\cite{MR1347406,sageevnotes} for ${\\operatorname{CAT}}(0)$ cube complexes and hyperplanes.\n\nA unit Euclidean $n$-cube is $[0,1]^{n}$ with the standard metric. A \\textit{mid-cube} is the set of fixed points of a reflection with respect to some $[0,1]$ factor of $[0,1]^{n}$. A cube complex $Y$ is obtained by taking a collection of unit Euclidean cubes and gluing them along isometric faces. The gluing metric on $Y$ is ${\\operatorname{CAT}}(0)$ if and only if $Y$ is simply connected and the link of each vertex in $Y$ is a flag simplicial complex (\\cite{MR919829}), in this case, $Y$ is called a \\textit{${\\operatorname{CAT}}(0)$ cube complex}. \n\nLet $X$ be a ${\\operatorname{CAT}}(0)$ space and let $C\\subset X$ be a closed convex subset. Then there is a well-defined nearest point projection from $X$ to $C$, which we denote by $\\pi_{C}:X\\to C$. Two convex subsets $C_{1}$ and $C_{2}$ are \\textit{parallel} if $d(\\cdot,C_{2})|_{C_{1}}$ and $d(\\cdot,C_{1})|_{C_{2}}$ are constant functions. In this case, the convex hull of $C_{1}$ and $C_{2}$ is isometric to $C_{1}\\times [0,d(C_{1},C_{2})]$.\n\nFor closed convex subset $C\\subset X$, we define $P_{C}$, the \\textit{parallel set} of $C$, to be the union of all convex subsets of $X$ which are parallel to $C$. If $C$ has geodesic extension property, then $P_{C}$ is also a closed convex subset and admits a canonical splitting $P_{C}\\cong C\\times C^{\\perp}$ (\\cite[Chapter II.2.12]{bridson_haefliger}).\n\nSuppose $Y$ is a ${\\operatorname{CAT}}(0)$ cube complex. Then two edges $e$ and $e'$ are parallel if and only if there exists sequences of edges $\\{e_{i}\\}_{i=1}^{n}$ such that $e_{1}=e$, $e_{n}=e'$, and $e_{i},e_{i+1}$ are the opposite sides of a $2$-cube in $Y$. For each edge $e\\subset Y$. Let $N_{e}$ be the union of cubes in $Y$ which contain an edge parallel to $e$. Then $N_{e}$ is a convex subcomplex of $Y$, moreover, $N_{e}$ has a natural splitting $N_{e}\\cong h_{e}\\times[0,1]$, where $[0,1]$ corresponds to the $e$ direction. The subset $h_{e}\\times\\{1/2\\}$ is called the \\textit{hyperplane} dual to $e$, and $N_{e}$ is called the \\textit{carrier} of this hyperplane. Each hyperplane is a union of mid-cubes, hence has a natural cube complex structure, which makes it a ${\\operatorname{CAT}}(0)$ cube complex. The following are true for hyperplanes:\n\\begin{enumerate}\n\\item Each hyperplane $h$ is a convex subset of $Y$. Moreover, $Y\\setminus h$ has exactly two connected components. The closure of each connected component is called a \\textit{halfspace}. Each halfspace is also a convex subset.\n\\item Pick an edge $e\\subset Y$. We identify $e$ with $[0,1]$ and consider the ${\\operatorname{CAT}}(0)$ projection $\\pi_{e}:Y\\to e\\cong[0,1]$. Then $h=\\pi^{-1}_{e}(1/2)$ is the hyperplane dual to $e$, and $\\pi^{-1}_{e}([0,1/2]),\\pi^{-1}_{e}([1/2,1])$ are two halfspaces associated with $h$. The closure of $\\pi^{-1}_{e}((0,1))$ is the carrier of $h$.\n\\end{enumerate}\n\nLet $Y$ be a ${\\operatorname{CAT}}(0)$ cube complex and let $l\\in Y$ be a geodesic line (with respect to the ${\\operatorname{CAT}}(0)$ metric) in the 1-skeleton of $Y$. Let $e\\subset l$ be an edge and pick $x\\in e$. We claim that if $x$ is in the interior of $e$, then $\\pi^{-1}_{l}(x)=\\pi^{-1}_{e}(x)$. It is clear that $\\pi^{-1}_{l}(x)\\subset\\pi^{-1}_{e}(x)$. Suppose $y\\in \\pi^{-1}_{e}(x)$. It follows from the splitting $N_{e}\\cong h_{e}\\times[0,1]$ as above that the geodesic segment $\\overline{xy}$ is orthogonal to $l$, i.e. $\\angle_{x}(y,y')=\\pi/2$ for any $y'\\in l\\setminus\\{x\\}$, thus $y\\in \\pi^{-1}_{l}(x)$.\n\nThe above claim implies $\\pi^{-1}_{l}(x)$ is a convex subset for any $x\\in l$. Moreover, the following lemma is true.\n\n\\begin{lem}\n\\label{project onto line}\nLet $Y$ and $l$ be as before. Pick an edge $e\\subset Y$. If $e$ is parallel to some edge $e'\\subset l$, then $\\pi_{l}(e)=e'$, otherwise $\\pi_{l}(e)$ is a vertex of $l$.\n\\end{lem}\n\nNow we define an alternative metric on the ${\\operatorname{CAT}}(0)$ cube complex $Y$, which is called the $l^{1}$-metric. One can view the 1-skeleton of $Y$ as a metric graph with edge length $=1$, and this metric extends naturally to a metric on $Y$. The distant between two vertices in $Y$ with respect to this metric is equal to the number of hyperplanes separating these two vertices.\n\nA \\textit{combinatorial geodesic} in $Y$ is an edge path in $Y^{(1)}$ which is a geodesic with respect to the $l^{1}$ metric. However, we always refer to the ${\\operatorname{CAT}}(0)$ metric when we talk about a geodesic.\n\nIf $Y$ is finite dimensional, the $l^{1}$ metric and the ${\\operatorname{CAT}}(0)$ metric on $Y$ are quasi-isometric (\\cite[Lemma 2.2]{caprace2011rank}). In this paper, we will use the ${\\operatorname{CAT}}(0)$ metric unless otherwise specified.\n\n\\begin{definition} (\\cite[Section 2.1]{caprace2011rank})\n\\label{cubical map}\nA cellular map between cube complexes is \\textit{cubical} if its restriction $\\sigma\\to\\tau$ between cubes factors as $\\sigma\\to\\eta\\to\\tau$, where the first map $\\sigma\\to\\eta$ is a natural projection onto a face of $\\sigma$ and the second map $\\eta\\to\\tau$ is an isometry. \n\\end{definition}\n\n\\subsection{Right-angled Artin groups}\n\\label{subsec_raag}\nPick a finite simplicial graph $\\Gamma$, recall that $G({\\Gamma})$ is the right-angled Artin group with defining graph ${\\Gamma}$. Let $S$ be a standard generating set for $G(\\Gamma)$ and we label the vertices of $\\Gamma$ by elements in $S$. $G(\\Gamma)$ has a nice Eilenberg-MacLane space $S(\\Gamma)$, called the Salvetti complex (see \\cite{MR1368655,charney2007introduction}). Recall that $S(\\Gamma)$ is the graph product $\\prod_{\\Gamma}(S^1_v,\\star_v)$, where $(S^1_v,\\star_v)$ is a pointed unit circle (see Definition \\ref{def_graph_product_of_spaces}).\n\nThe 2-skeleton of $S(\\Gamma)$ is the usual presentation complex of $G(\\Gamma)$, so $\\pi_{1}(S(\\Gamma))\\cong G(\\Gamma)$. The 0-skeleton of $S(\\Gamma)$ consists of one point whose link is a flag complex, so $S(\\Gamma)$ is non-positively curved and $S(\\Gamma)$ is an Eilenberg-MacLane space for $G(\\Gamma)$ by the Cartan-Hadamard theorem (\\cite[Theorem II.4.1]{bridson_haefliger}).\n\nThe closure of each $k$-cell in $S(\\Gamma)$ is a $k$-torus. Tori of this kind are called \\textit{standard tori}. There is a 1-1 correspondence between the $k$-cells (or standard torus of dimension $k$) in $S(\\Gamma)$ and $k$-cliques in $\\Gamma$. We define the \\textit{dimension} of $G(\\Gamma)$ to be the dimension of $S(\\Gamma)$.\n\nDenote the universal cover of $S(\\Gamma)$ by $X(\\Gamma)$, which is a ${\\operatorname{CAT}}(0)$ cube complex. Our previous labelling of vertices of $\\Gamma$ induces a labelling of the standard circles of $S(\\Gamma)$, which lifts to a labelling of edges of $X(\\Gamma)$. A \\textit{standard k-flat} in $X(\\Gamma)$ is a connected component of the inverse image of a standard $k$-torus under the covering map $X(\\Gamma)\\to S(\\Gamma)$. When $k=1$, we also call it a \\textit{standard geodesic}.\n\nFor each simplicial graph $\\Gamma$, there is a simplicial complex $\\mathcal{P}(\\Gamma)$ called the \\textit{extension complex}, which captures the combinatorial pattern of how standard flats intersect each other in $X(\\Gamma)$. This object was first introduced in \\cite{kim2013embedability}. We will define it in a slightly different way (see \\cite[Section 4.1]{huang2014quasi} for more discussion).\n\n\\begin{definition}[Extension complex]\n\\label{def_extension_complex}\nThe vertices of $\\mathcal{P}(\\Gamma)$ are in 1-1 correspondence with the parallel classes of standard geodesics in $X(\\Gamma)$. Two distinct vertices $v_{1},v_{2}\\in\\mathcal{P}(\\Gamma)$ are connected by an edge if and only if there is standard geodesic $l_{i}$ in the parallel class associated with $v_{i}$ ($i=1,2$) such that $l_{1}$ and $l_{2}$ span a standard 2-flat. Then $\\mathcal{P}(\\Gamma)$ is defined to be the flag complex of its 1-skeleton, namely we build $\\mathcal{P}(\\Gamma)$ inductively from its 1-skeleton by filling a $k$-simplex whenever we see the $(k-1)$-skeleton of a $k$-simplex. \n\\end{definition}\n\nSince each complete subgraph in the 1-skeleton of $\\mathcal{P}(\\Gamma)$ gives rise to a collection of mutually orthogonal standard geodesics lines, there is a 1-1 correspondence between $k$-simplexes in $\\mathcal{P}(\\Gamma)$ and parallel classes of standard $(k+1)$-flats in $X(\\Gamma)$. In particular, there is a 1-1 correspondence between maximal simplexes in $\\mathcal{P}(\\Gamma)$ and maximal standard flats in $X(\\Gamma)$. Given standard flat $F\\subset X(\\Gamma)$, we denote the simplex in $\\mathcal{P}(\\Gamma)$ associated with the parallel class containing $F$ by $\\Delta(F)$. \n\n\\begin{lem}\n\\label{projection}\nPick non-adjacent vertices $v,u\\in\\mathcal{P}(\\Gamma)$ and let $l_{u}$ be a standard geodesic such that $\\Delta(l_{u})=u$. Then for any standard geodesic line $l$ with $\\Delta(l)=v$, $\\pi_{l_{u}}(l)$ is a vertex of $l_{u}$ which does not depend on the choice of $l$ in the parallel class. Thus we define this vertex to be the projection of $v$ on $l_{u}$ and denote it by $\\pi_{l_{u}}(v)$.\n\\end{lem}\n\n\\begin{proof}\nIt follows from Lemma \\ref{project onto line} that if two standard geodesic lines $l_{1}$ and $l_{2}$ are not parallel, then $\\pi_{l_{1}}(l_{2})$ is a vertex of $l_{2}$. Thus $\\pi_{l_{u}}(l)$ is a vertex of $l_{u}$. Suppose $l'$ is parallel to $l$, then there exists a chain of parallel standard geodesic lines $\\{l_{i}\\}_{i=1}^{n}$ such that $l_{1}=l$, $l_{n}=l'$ and $l_{i},l_{i+1}$ are in the same standard 2-flat $F_{i}$. Let $l^{\\perp}\\subset F_{i}$ be a standard geodesic orthogonal to $l_{i}$ and $l_{i+1}$. Since $v$ and $u$ are not adjacent in $\\mathcal{P}(\\Gamma)$, $l^{\\perp}$ and $l_{u}$ are not parallel, thus $\\pi_{l_{u}}(l^{\\perp})$ is a point. It follows that $\\pi_{l_{u}}(l_{i})=\\pi_{l_{u}}(l_{i+1})$, hence $\\pi_{l_{u}}(l)=\\pi_{l_{u}}(l')$.\n\\end{proof}\n\n\\subsection{Right-angled buildings}\n\\label{building}\nWe will follow the treatment in \\cite{davis_buildings_are_cat0,abramenko2008buildings,ronan2009lectures}. In particular, we refer to Section 1.1 to Section 1.3 of \\cite{davis_buildings_are_cat0} for the definitions of chamber systems, galleries, residues, Coxeter groups and buildings. We will focus on right-angled buildings,  i.e. the associated Coxeter group is right-angled, though most of the discussion below is valid for general buildings.\n\nLet $W=W({\\Gamma})$ be a right-angled Coxeter group with (finite) defining graph ${\\Gamma}$. Let ${\\mathcal{B}}={\\mathcal{B}}({\\Gamma})$ be a right-angled building with the associated $W$-distance function denoted by $\\delta:{\\mathcal{B}}\\times {\\mathcal{B}}\\to W$. We will also call ${\\mathcal{B}}({\\Gamma})$ a \\textit{right-angled ${\\Gamma}$-building} for simplicity.\n\nLet $I$ be the vertex set of ${\\Gamma}$. Recall that a subset $J\\subset I$ is \\textit{spherical} if the subgroup of $W$ generated by $J$ is finite. Let $\\mathsf{S}$ be the poset of spherical subsets of $I$ (including the empty set) and let $|\\mathsf{S}|_{\\Delta}$ be the geometric realization of $\\mathsf{S}$, i.e. $|\\mathsf{S}|_{\\Delta}$ is a simplicial complex such that its vertices are in 1-1 correspondence to elements in $\\mathsf{S}$ and its $n$-simplices are in 1-1 correspondence to $(n+1)$-chains in $\\mathsf{S}$. Note that $|\\mathsf{S}|_{\\Delta}$ is isomorphic the simplicial cone over the barycentric subdivision of the flag complex of ${\\Gamma}$.\n\nRecall that for elements $x\\le y$ in $\\mathsf{S}$, the \\textit{interval} $I_{xy}$ between $x$ and $y$ is a poset consist of elements $z\\in\\mathsf{S}$ such that $x\\le z\\le y$ with the induced order from $\\mathsf{S}$. There is a natural simplicial embedding $|I_{xy}|_{\\Delta}\\hookrightarrow|\\mathsf{S}|_{\\Delta}$. Each $|I_{xy}|_{\\Delta}$ is a simplicial cone over the barycentric subdivision of a simplex, thus can be viewed a subdivision of a cube into simplices. It is not hard to check the collection of all intervals in $\\mathsf{S}$ gives rise to a structure of cube complex on $|\\mathsf{S}|_{\\Delta}$. Let $|\\mathsf{S}|$ be the resulting cube complex, then $|\\mathsf{S}|$ is $CAT(0)$.\n\nA residue is \\textit{spherical} if it is a $J$-residue with $J\\in \\mathsf{S}$. Let $ {\\mathsf{S}^r}$ be the poset of all spherical residues in ${\\mathcal{B}}$. For $x\\in  {\\mathsf{S}^r}$ which comes from a $J$-residue, we define the \\textit{rank} of $x$ to be the cardinality of $J$, and define a \\textit{type map} $t: {\\mathsf{S}^r}\\to\\mathsf{S}$ which maps $x$ to $J\\in \\mathsf{S}$. Let $|{\\mathsf{S}^r}|_{\\Delta}$ be the geometric realization of ${\\mathsf{S}^r}$, then the type map induces a simplicial map $t:|{\\mathsf{S}^r}|_{\\Delta}\\to |\\mathsf{S}|_{\\Delta}$. For $x\\in {\\mathsf{S}^r}$, let ${\\mathsf{S}^r}_{x}$ be the sub-poset made of elements in ${\\mathsf{S}^r}$ which is $\\ge x$. If $x$ is of rank $0$, then ${\\mathsf{S}^r}_{ x}$ is isomorphic to $\\mathsf{S}$, moreover, there is a natural simplicial embedding $|{\\mathsf{S}^r}_{x}|_{\\Delta}\\to|{\\mathsf{S}^r}|_{\\Delta}$ and $t$ maps the image of $|{\\mathsf{S}^r}_{x}|_{\\Delta}$ isomorphically onto $|\\mathsf{S}|_{\\Delta}$. \n\nAs before, the geometric realization of each interval in ${\\mathsf{S}^r}$ is a subdivision of a cube into simplices. Moreover, the intersection of two intervals in ${\\mathsf{S}^r}$ is also an interval. Thus one gets a cube complex $|{\\mathcal{B}}|$ whose cubes are in 1-1 correspondence with intervals in ${\\mathsf{S}^r}$. $|{\\mathcal{B}}|$ is called the \\textit{Davis realization} of the building ${\\mathcal{B}}$ and $|{\\mathcal{B}}|$ is a $CAT(0)$ cube complex by \\cite{davis_buildings_are_cat0}. Moreover, the above type map induces a cubical map $t:|{\\mathcal{B}}|\\to|\\mathsf{S}|$. Let ${\\mathcal R}\\subset {\\mathcal{B}}$ be a residue. Since ${\\mathcal R}$ also has the structure of a building, there is an isometric embedding $|{\\mathcal R}|\\to|{\\mathcal{B}}|$ between their Davis realizations. $|{\\mathcal R}|$ is called a \\textit{residue} in $|{\\mathcal{B}}|$.\n\nIn the special case when ${\\mathcal{B}}$ is equal to the associated Coxeter group $W$, there is a natural embedding from the Cayley graph of $W$ to $|{\\mathcal{B}}|$ such that vertices of Cayley graph are mapped to vertices of rank $0$ in $|{\\mathcal{B}}|$. And $|{\\mathcal{B}}|$ can be viewed as the first cubical subdivision of the cubical completion of the Cayley graph of $W$ (the cubical completion means we attach an $n$-cube to the graph whenever there is a copy of the 1-skeleton of an $n$-cube inside the graph). \n\nEach vertex of $|{\\mathcal{B}}|$ corresponds to a $J$-residue in ${\\mathcal{B}}$, thus has a well-defined rank. For a vertex $x$ of rank $0$, the space $|{\\mathsf{S}^r}_{x}|_{\\Delta}$ discussed in the previous paragraph induces a subcomplex $|{\\mathcal{B}}_x|\\subset|{\\mathcal{B}}|$. Note that $t$ maps $|{\\mathcal{B}}_x|$ isomorphically onto $|\\mathsf{S}|$. $|{\\mathcal{B}}_x|$ is called a \\textit{chamber} in $|{\\mathcal{B}}|$, and there is a 1-1 correspondence between chambers in $|{\\mathcal{B}}|$ and chambers in ${\\mathcal{B}}$. Let $|{\\mathcal{B}}_x|$ and $|{\\mathcal{B}}_y|$ be two chambers in $|{\\mathcal{B}}|$. Since there is an apartment ${\\mathcal A}\\subset {\\mathcal{B}}$ which contains both $x$ and $y$, this induces an isometric embedding $|{\\mathcal A}|\\to |{\\mathcal{B}}|$ whose image contains $|{\\mathcal{B}}_x|$ and $|{\\mathcal{B}}_y|$, here $|{\\mathcal A}|$ is isomorphic to the Davis realization of the Coxeter group $W$. $|{\\mathcal A}|$ is called an \\textit{apartment} in $|{\\mathcal{B}}|$.\n\n\\begin{definition}\n\\label{distance of residue}\nFor $c_1,c_2\\in {\\mathcal{B}}$, define $d(c_1,c_2)$ to be the minimal length of word in $W$ (with respect to the generating set $I$) that represents $\\delta(c_1,c_2)$. For any two residues ${\\mathcal R}_1,{\\mathcal R}_2\\in{\\mathcal{B}}$, we define $d({\\mathcal R}_1,{\\mathcal R}_2)=\\min\\{d(c,d)\\mid c\\in{\\mathcal R}_1,d\\in{\\mathcal R}_2\\}$. It turns out that for any $c\\in {\\mathcal R}_1$ and $d\\in{\\mathcal R}_2$ with $d(c,d)=d({\\mathcal R}_1,{\\mathcal R}_2)$, $\\delta(c,d)$ gives rise to the same element in $W$ (\\cite[Chapter 5.3.2]{abramenko2008buildings}), this element is defined to be $\\delta({\\mathcal R}_1,{\\mathcal R}_2)$.\n\\end{definition}\n\n\n\\begin{lem}\n\\label{distance}\n$d(c_1,c_2)=2d_{l^1}(c_1,c_2)$, here $d_{l^1}$ means the $l^1$-distance in $|{\\mathcal{B}}|$. Since $c_1$ and $c_2$ can be also viewed as vertex of rank $0$ in $|{\\mathcal{B}}|$, $d_{l^1}(c_1,c_2)$ makes sense.\n\\end{lem}\n\n\\begin{proof}\nIf ${\\mathcal{B}}=W$, then this lemma follows from the above description of the Davis realization of a Coxeter group. The general case can be reduced to this case by considering an apartment $|{\\mathcal A}|\\subset|{\\mathcal{B}}|$ which contains $c_1$ and $c_2$. Note that $|{\\mathcal A}|$ is convex in $|{\\mathcal{B}}|$.\n\\end{proof}\n\nGiven a residue ${\\mathcal R}\\subset{\\mathcal{B}}$, there is a well-defined nearest point projection map as follows.\n\n\\begin{theorem}[Proposition 5.34, \\cite{abramenko2008buildings}]\n\\label{prj}\nLet ${\\mathcal R}$ be a residue and $c$ a chamber. Then there exists a unique $c'\\in{\\mathcal R}$ such that $d(c,c')=d({\\mathcal R},c)$.\n\\end{theorem}\n\nThis projection is compatible with several other projections in the following sense. Let $|{\\mathcal R}|\\subset|{\\mathcal{B}}|$ be the convex subcomplex corresponding to ${\\mathcal R}$. Let $c$ and $c'$ be as above. We also view them as vertex of rank $0$ in $|{\\mathcal{B}}|$. Let $c_1$ be the combinatorial projection of $c$ onto $|{\\mathcal R}|$ (see \\cite[Lemma 13.8]{haglund_wise_special}) and let $c_2$ be the $CAT(0)$ projection of $c$ onto $|{\\mathcal R}|$.\n\n\\begin{lem}\n\\label{equivalence of projections}\n$c'=c_1=c_2$.\n\\end{lem} \n\n\\begin{proof}\n$c_1=c_2$ is actually true for any $CAT(0)$ cube complexes. By \\cite[Lemma 2.3]{huang2014quasi}, $c_2$ is a vertex. If $c_2\\neq c_1$, by \\cite[Lemma 13.8]{haglund_wise_special}, the concatenation of the combinatorial geodesic $\\omega_1$ which connects $c_2$ and $c_1$ and the combinatorial geodesic $\\omega_2$ which connects $c_1$ and $c$ is a combinatorial geodesic connecting $c$ and $c_2$. Note that $\\omega_1\\subset |{\\mathcal R}|$. Let $e\\subset\\omega_1$ be the edge that contains $c_2$ and let $x$ be the other endpoint of $e$. Then $x$ and $c$ are in the same side of the hyperplane dual to $e$. It is easy to see $d(x,c)<d(c_2,c)$ (here $d$ denotes the $CAT(0)$ distance), which yields a contradiction.\n\nTo see $c'=c_1$, by Lemma \\ref{distance}, it suffices to prove $c_1$ is of rank $0$. When ${\\mathcal{B}}=W$, this follows from $c_1=c_2$, since we can work with the cubical completion of the Cayley graph of $W$ instead of $|W|$ (the latter is the cubical subdivision of the former) and apply \\cite[Lemma 2.3]{huang2014quasi}. The general case follows by considering an apartment $|{\\mathcal A}|\\subset|{\\mathcal{B}}|$ which contains $c_1$ and $c$, note that in this case $|{\\mathcal A}|\\cap|{\\mathcal R}|$ can be viewed as a residue in $|{\\mathcal A}|$.\n\\end{proof}\n\n\\begin{definition}\n\\label{definition_parallel}\nLet $\\textmd{proj}_{{\\mathcal R}}$ be the map defined in Theorem \\ref{prj}. Two residues ${\\mathcal R}_1$ and ${\\mathcal R}_2$ are \\textit{parallel} if $\\textmd{proj}_{{\\mathcal R}_1}({\\mathcal R}_2)={\\mathcal R}_1$ and $\\textmd{proj}_{{\\mathcal R}_2}({\\mathcal R}_1)={\\mathcal R}_2$. In this case $\\textmd{proj}_{{\\mathcal R}_1}$ and $\\textmd{proj}_{{\\mathcal R}_2}$ induce mutually inverse bijections between ${\\mathcal R}_1$ and ${\\mathcal R}_2$. These bijections are called \\textit{parallelism maps} between ${\\mathcal R}_1$ and ${\\mathcal R}_2$. They are also isomorphisms of chamber system i.e. they map residues to residues (\\cite[Proposition 5.37]{abramenko2008buildings}).\n\\end{definition}\n\nIt follows from the uniqueness of the projection map that if $f:{\\mathcal R}\\to{\\mathcal R}'$ is the parallelism map between two parallel residues and ${\\mathcal R}_1\\subset{\\mathcal R}$ is a residue, then ${\\mathcal R}_1$ and $f({\\mathcal R}_1)$ are parallel, and the parallelism map between ${\\mathcal R}_1$ and $f({\\mathcal R}_1)$ is induced by $f$.\n\n\\begin{lem}\n\\label{parallel}\nIf ${\\mathcal R}_1$ and ${\\mathcal R}_2$ are parallel, then $|{\\mathcal R}_1|$ and $|{\\mathcal R}_2|$ are parallel with respect to the $CAT(0)$ metric on $|{\\mathcal{B}}|$. Moreover, the parallelism maps between ${\\mathcal R}_1$ and ${\\mathcal R}_2$ induces by $\\textmd{proj}_{{\\mathcal R}_1}$ and $\\textmd{proj}_{{\\mathcal R}_2}$ is compatible with the $CAT(0)$ parallelism between $|{\\mathcal R}_1|$ and $|{\\mathcal R}_2|$ induced by $CAT(0)$ projections.\n\\end{lem}\n\n\\begin{proof}\nBy Lemma \\ref{equivalence of projections}, it suffices to show for any residue ${\\mathcal R}\\in{\\mathcal{B}}$, $|{\\mathcal R}|$ is the convex hull of the vertices of rank $0$ inside $|{\\mathcal R}|$. This is clear when ${\\mathcal{B}}=W$ if one consider the cubical completion of the Cayley graph of $W$. The general case also follows since $|{\\mathcal R}|$ is a union of apartments in $|{\\mathcal R}|$, and $|{\\mathcal R}|$ is convex in $|{\\mathcal{B}}|$.\n\\end{proof}\n\nIt follows that if ${\\mathcal R}_1$ and ${\\mathcal R}_2$ are parallel residues, and ${\\mathcal R}_2$ and ${\\mathcal R}_3$ are parallel residues, then ${\\mathcal R}_1$ is parallel to ${\\mathcal R}_3$. Moreover, let $f_{ij}$ be the parallelism map from ${\\mathcal R}_i$ to ${\\mathcal R}_j$ induced by the projection map, then $f_{13}=f_{23}\\circ f_{12}$.\n\nGiven chamber systems $C_1,\\cdots,C_k$ over $I_1,\\cdots,I_k$, their direct product $C_{1}\\times \\cdots\\times C_k$ is a chamber system over the disjoint union $I_1\\sqcup\\cdots\\sqcup I_k$. Its chambers are $k$-tuples $(c_1,\\cdots,c_k)$ with $c_t\\in C_t$. For $i\\in I_t$, $(c_1,\\cdots,c_k)$ is $i$-adjacent to $(d_1,\\cdots,d_k)$ if $c_j=d_j$ for $j\\neq t$ and $c_t$ and $d_t$ are $i$-adjacent.\n\nSuppose the defining graph ${\\Gamma}$ of the right-angled Coxeter group $W$ admits a join decomposition ${\\Gamma}={\\Gamma}_1\\circ{\\Gamma}_2\\circ\\cdots\\circ{\\Gamma}_k$. Let $I=\\cup_{i=1}^{k}I_i$ be the corresponding decomposition of the vertex set of ${\\Gamma}$ and $W=\\prod_{i=1}^{k}W_i$ be the induced product decomposition of $W$. Pick chamber $c\\in{\\mathcal{B}}$, and let ${\\mathcal{B}}_i$ be the $I_i$-residue that contains $c$. Define a map $\\phi:{\\mathcal{B}}\\to{\\mathcal{B}}_1\\times{\\mathcal{B}}_2\\times\\cdots\\times{\\mathcal{B}}_k$ by $\\phi(d)=(\\textmd{proj}_{{\\mathcal{B}}_1}(d),\\textmd{proj}_{{\\mathcal{B}}_2}(d),\\cdots,\\textmd{proj}_{{\\mathcal{B}}_k}(d))$ for any chamber $d\\in{\\mathcal{B}}$.\n\n\\begin{thm}[Theorem 3.10, \\cite{ronan2009lectures}]\n\\label{product decomposition}\nThe definition of $\\phi$ does not depend on the choice of $c$, and $\\phi$ is an isomorphism of buildings.\n\\end{thm}\n\nIt follows from the definition of the Davis realization that there is a natural isomorphism $|{\\mathcal{B}}_1\\times{\\mathcal{B}}_2\\times\\cdots\\times{\\mathcal{B}}_k|\\cong|{\\mathcal{B}}_1|\\times|{\\mathcal{B}}_2|\\times\\cdots\\times|{\\mathcal{B}}_k|$, thus we have a product decomposition $|\n{\\mathcal{B}}|\\cong|{\\mathcal{B}}_1|\\times|{\\mathcal{B}}_2|\\times\\cdots\\times|{\\mathcal{B}}_k|$, where the isomorphism is induced by $CAT(0)$ projections from $|{\\mathcal{B}}|$ to $|{\\mathcal{B}}_i|$'s (this is a consequence of Lemma \\ref{parallel}).\n\nWe define the \\textit{parallel set} of a residue ${\\mathcal R}\\subset{\\mathcal{B}}$ to be the union of all residues in ${\\mathcal{B}}$ that are parallel to ${\\mathcal R}$.\n\n\\begin{lem}\n\\label{parallel sets of residues}\nSuppose ${\\mathcal R}$ is a $J$-residue. Let $J^{\\perp}\\subset I$ be the collection of vertices in ${\\Gamma}$ which are adjacent to every vertex in $J$. Then: \n\\begin{enumerate}\n\\item If ${\\mathcal R}'$ is parallel to ${\\mathcal R}$, then ${\\mathcal R}'$ is a $J$-residue.\n\\item The parallel set of ${\\mathcal R}$ is the $J\\cup J^{\\perp}$-residue that contains ${\\mathcal R}$.\n\\end{enumerate}\n\\end{lem}\n\nNote that this lemma is not true if the building under consideration is not right-angled.\n\\begin{proof}\nSuppose ${\\mathcal R}'$ is a $J_1$-residue. Let $w=\\delta({\\mathcal R},{\\mathcal R}')$ (see Definition \\ref{distance of residue}). It follows from (2) of \\cite[Lemma 5.36]{abramenko2008buildings} that ${\\mathcal R}'$ is a $(J\\cap w J_1 w^{-1})$-residue. Since ${\\mathcal R}$ and ${\\mathcal R}'$ are parallel, they have the same rank, thus $J=w J_{1} w^{-1}$. By considering the abelianization of the right-angled Coxeter group $W$, we deduce that $J=J_1$ (this proves the first assertion of the lemma) and $w$ commutes with each element in $J$. Thus $w$ belongs to the subgroup generated by $J^{\\perp}$ and ${\\mathcal R}'$ is in the $J\\cup J^{\\perp}$-residue ${\\mathcal S}$ that contains ${\\mathcal R}$. Then the parallel set of ${\\mathcal R}$ is contained in ${\\mathcal S}$. It remains to prove every $J$-residue in ${\\mathcal S}$ is parallel to ${\\mathcal R}$, but this follows from Theorem \\ref{product decomposition}.\n\\end{proof}\n\nPick a vertex $v\\in|{\\mathcal{B}}|$ of rank $k$ and let ${\\mathcal R}=\\prod_{i=1}^{k}{\\mathcal R}_i$ be the associated residue with its product decomposition. Let $\\{v_{\\lambda}\\}_{\\lambda\\in\\Lambda}$ be the collection of vertices that are adjacent to $v$. Then there is a decomposition $\\{v_{\\lambda}\\}_{\\lambda\\in\\Lambda}=\\{v_{\\lambda}\\le v\\}\\sqcup \\{v_{\\lambda}>v\\}$, where $\\{v_{\\lambda}>v\\}$ denotes the collection of vertices whose associated residues contain ${\\mathcal R}$. This induces a decomposition $Lk(v,|{\\mathcal{B}}|)=K_1\\ast K_2$ of the link of $v$ in $|{\\mathcal{B}}|$ (\\cite[Definition I.7.15]{bridson_haefliger}) into a spherical join of two $CAT(1)$ all-right spherical complexes. Note that $K_2$ is finite, since $\\{v_{\\lambda>v}\\}$ is finite. Moreover, $K_1\\cong Lk(v,|{\\mathcal R}|)$. However, $|{\\mathcal R}|\\cong\\prod_{i=1}^{k}|{\\mathcal R}_i|$, thus $K_1$ is the spherical join of $k$ discrete sets such that elements in each of these discrete sets are in 1-1 correspondence to elements in some ${\\mathcal R}_i$. Now we can deduce from this the following result.\n\\begin{lem}\n\\label{rank preserving}\nSuppose ${\\mathcal{B}}$ is a right-angled building such that each of its residues of rank 1 \ncontains infinitely many elements. If $\\alpha:|{\\mathcal{B}}|\\to|{\\mathcal{B}}|$ is a cubical isomorphism, then $\\alpha$ preserves the rank of vertices in $|{\\mathcal{B}}|$.\n\\end{lem}\n\n\n\\section*{Part I: A fibration approach to cubulating RAAG's}\n\n\n\\section{Restriction quotients}\n\\label{sec_restriction_quotients}\nIn this section we study restriction quotients, \na certain type of mapping between ${\\operatorname{CAT}}(0)$ cube complexes \nintroduced by Caprace and Sageev in \\cite{caprace2011rank}.  These\nplay a central role in our story. \n\nWe first show in Subsection \\ref{subsec_quotient_maps_cube_complexes}\nthat restriction quotients can be characterized in \nseveral different ways, see Theorem \\ref{thm_restriction_quotient_characterization}.  \nWe then show in Subsection \\ref{sec_restriction_maps_versus_fiber_functors}\nthat a restriction\nquotient $f:Y\\rightarrow Z$ determines fiber data that satisfies\ncertain conditions; conversely, given such fiber data, one may construct\na restriction quotient inducing the given data, which is unique up to equivalence.\nThis correspondence will later be applied to construct restriction quotients over\nright-angled buildings.  Subsections \\ref{sec_equivariance_properties}\nand \\ref{sec_quasiisometric_properties} deals with the behavior of restriction\nquotients under group actions and quasi-isometries.\n\n\n\n\\subsection{Quotient maps between ${\\operatorname{CAT}}(0)$ cube complexes}\n\\label{subsec_quotient_maps_cube_complexes}\nWe recall the notion of restriction quotient from \\cite[Section 2.3]{caprace2011rank}; see Section \\ref{subsec_wallspaces} for the background on wallspaces.\n\n\n\\begin{definition}\n\\label{def_restriction_quotient}\nLet $Y$ be a ${\\operatorname{CAT}}(0)$ cube complex and let ${\\mathcal H}$ be the collection of walls in the $0$-skeleton $Y^{(0)}$ corresponding to the hyperplanes in $Y$. Pick a subset ${\\mathcal K}\\subset {\\mathcal H}$ and let $Y({\\mathcal K})$ be the ${\\operatorname{CAT}}(0)$ cube complex associated with the wallspace $(Y^{(0)},{\\mathcal K})$. Then every 0-cube of the wallspace $(Y^{(0)},{\\mathcal H})$ gives rise to a 0-cube of $(Y^{(0)},{\\mathcal K})$ by restriction. This can be extended to a surjective cubical map $q:Y\\to Y({\\mathcal K})$, which is called the {\\em restriction quotient} arising from the subset ${\\mathcal K}\\subset{\\mathcal H}$.\n\\end{definition}\n\n\nThe following example motivates many of the constructions\nin this paper:\n\\begin{example}[The canonical restriction quotient of a RAAG]\n\\label{the key example}\nFor a fixed graph ${\\Gamma}$,\nlet $S_e\\rightarrow |c|_{\\Gamma}$ and $X_e\\rightarrow S_e$ be the mappings associated with the \nexploded Salvetti complex, as defined in the introduction after\nDefinition \\ref{def_graph_product_of_spaces}.\nLet ${\\mathcal K}$ be the collection\nof hyperplanes in $X_e({\\Gamma})$ dual to edges\n$e\\subset X_e$ that project to edges under the composition \n$X_e\\rightarrow S_e\\rightarrow |c|_{\\Gamma}$.  Then the {\\em canonical restriction quotient of $G=G({\\Gamma})$}\nis the restriction quotient arising from ${\\mathcal K}$.\n\\end{example}\n\n\nLet $q:Y\\to Y({\\mathcal K})$ be a restriction quotient. Pick an edge $e\\subset Y$. If $e$ is dual to some element in ${\\mathcal K}$, then $q(e)$ is an edge, otherwise $q(e)$ is a point. The edge $e$ is called \\textit{horizontal} in the former case, and \\textit{vertical} in the latter case. We record the following simple observation.\n\\begin{lem}\n\\label{descending automorphism general case}\nLet $\\alpha: Y\\rightarrow Y$ be a cubical ${\\operatorname{CAT}}(0)$  automorphism of $Y$ that maps vertical \nedges to vertical \nedges and horizontal edges to horizontal edges. Then $\\alpha$ descends to an \nautomorphism  $Y({\\mathcal K})\\rightarrow Y({\\mathcal K})$.\n\\end{lem}\n\n\nThe following result shows that restriction quotients may be characterized in \nseveral different ways.\n\\begin{thm}\n\\label{thm_restriction_quotient_characterization}\nIf $f:Y\\to Z$ is a surjective cubical map between two ${\\operatorname{CAT}}(0)$ cube complexes, then the following conditions are equivalent:\n\\begin{enumerate}\n\\item The inverse image of each vertex of $Z$ is convex.\n\\item The inverse image of every point in $Z$ is convex.\n\\item The inverse image of every convex subcomplex of $Z$ is convex.\n\\item The inverse image of every hyperplane in $Z$ is a hyperplane.\n\\item $f$ is equivalent to a restriction quotient, i.e. for some set of walls\n${\\mathcal K}$ in $Y$, there is a cubical isomorphism $\\phi:Z\\rightarrow Y({\\mathcal K})$\nmaking the following   diagram commute:\n\\begin{diagram}\nY       &&\\\\\n\\dTo^f  & \\rdTo^q &\\\\\nZ       & \\rTo_\\phi   & Y({\\mathcal K})\n\\end{diagram}\n\\end{enumerate}\n\\end{thm}\n\nThe proof of Theorem \n\\ref{thm_restriction_quotient_characterization} will take several lemmas.\nFor the remainder of this subsection we \nfix  ${\\operatorname{CAT}}(0)$ cube complexes $Y$ and $Z$ and a (not necessarily\nsurjective) cubical map $f:Y\\to Z$. \n\n\\begin{lemma}\n\\label{lem_fiber_functor}\nLet $\\sigma\\subset Z$ be a cube and let $Y_{\\sigma}$ be the be the union of cubes in $Y$ whose image under $f$ is exactly $\\sigma$. Then:\n\\begin{enumerate}\n\\item If $y\\in \\sigma$ is an interior point, then $f^{-1}(y)\\subset Y_{\\sigma}$.\n\\item $f^{-1}(y)$ has a natural induced structure as a cube complex; moreover, there is a natural isomorphism of cube complexes $Y_{\\sigma}\\cong f^{-1}(y)\\times \\sigma$.\n\\item If ${\\sigma}_1\\subset{\\sigma}_2$ are cubes of $Z$ and $y_i\\in{\\sigma}_i$ are interior\npoints, then there is a canonical embedding $f^{-1}(y_2)\\hookrightarrow f^{-1}(y_1)$.\nMoreover, these embeddings are compatible with composition of inclusions.\n\\end{enumerate}\n\\end{lemma}\n\n\\begin{lem}\n\n\\mbox{}\n\\begin{enumerate}\n\\item For every  $y\\in Z$, every \nconnected component of $f^{-1}(y)$ is a convex subset of $Y$.\n\\item For every convex subcomplex $A\\subset Z$, every connected component of $f^{-1}(A)$ is a convex subcomplex of $Y$.\n\\end{enumerate}\n\\end{lem}\n\n\\begin{proof}\nFirst we prove (1). Let $\\sigma$ be the support of $y$ and let $Y_{\\sigma}\\cong f^{-1}(y)\\times \\sigma$ be the subcomplex defined as above. It suffices to show $Y_{\\sigma}$ is locally convex. Pick vertex $x\\in Y_{\\sigma}$, and let $\\{e_{i}\\}_{i=1}^{n}$ be a collection of edges in $Y_{\\sigma}$ that contains $x$. It suffices to show if these edges span an $n$-cube $\\eta\\subset Y$, then $\\eta\\subset Y_{\\sigma}$. It suffices to consider the case when all $e_{i}$'s are orthogonal to $\\sigma$, in which case it follows from Definition \\ref{cubical map} that $\\eta\\times \\sigma\\subset Y_{\\sigma}$.\n\nTo see (2), pick an $n$-cube $\\eta\\subset Y$ and let $\\{e_{i}\\}_{i=1}^{n}$ be the edges of $\\eta$ at one corner $c\\subset \\eta$.\nIt suffices to show if $f(e_{i})\\subset A$, then $f(\\eta)\\subset A$. Note that $f(\\eta)$ is a cube, and every edge of this cube which emanates from the corner $f(c)$ is contained in $A$.  Thus $f(\\eta)\\subset A$ by the convexity of $A$.\n\\end{proof}\n\n\\begin{lem}\n\\label{inverse image of hyperplane}\nLet $f:Y\\to Z$ be a cubical map as above. Then:\n\\begin{enumerate}\n\\item The inverse image of each hyperplane of $Z$ is a disjoint union of hyperplanes in $Y$.\n\\item If the inverse image of each hyperplane of $Z$ is a single hyperplane, then for each point $y\\in Z$, the point inverse $f^{-1}(y)$ is connected, and hence convex. \n\\end{enumerate}\n\\end{lem}\n\n\\begin{proof}\nIt follows from Definition \\ref{cubical map} that the inverse image of each hyperplane of $Z$ is an union of hyperplanes. If two of them were to \nintersect, then there would be a 2-cube in $Y$ with two consecutive edges  \nmapped to the same edge in $Z$, which is impossible.\n\nNow we prove (2). It suffices to consider the case that $y$ is the center of some cube in $Z$. In this case, $y$ is a vertex in the first cubical subdivision of $Z$, and $f$ can viewed as a cubical map from the first cubical subdivision of $Y$ to the first cubical subdivision of $Z$ such that the inverse image of each hyperplane is a single hyperplane, thus it suffices to consider the case that $y$ is a vertex of $Z$.\n\nSuppose $f^{-1}(y)$ contains two connected components $A$ and $B$. Pick a combinatorial geodesic $\\omega$ of shortest distant that connects vertices in $A$ and vertices in $B$. Note that $f(\\omega)$ is a non-trivial edge-loop in $Z$, otherwise we will have $\\omega\\subset f^{-1}(y)$. It follows that there exists two different edges $e_{1}$ and $e_{2}$ of $\\omega$ mapping to parallel edges in $Y$. The hyperplanes dual to $e_{1}$ and $e_{2}$ are different, yet they are mapped to the same hyperplane in $Y$, which is a contradiction.\n\\end{proof}\n\n\\begin{lem}\n\\label{vertex to hyperplane}\nIf $f$ is surjective, and for any vertex $v\\in Z$, $f^{-1}(v)$ is connected, then the inverse image of each hyperplane of $Z$ is a single hyperplane.\n\\end{lem}\n\n\\begin{proof}\nLet $h\\subset Z$ be a hyperplane, by Lemma \\ref{inverse image of hyperplane}, $f^{-1}(h)=\\sqcup_{\\lambda\\in\\Lambda}h_{\\lambda}$ where each $h_{\\lambda}$ is a hyperplane in $Y$. Since $f$ is surjective, $\\{f(h_{\\lambda})\\}_{\\lambda\\in\\Lambda}$ is a collection of subcomplexes of $h$ that cover $h$. Thus there exists $h_1,h_2\\in\\{h_{\\lambda}\\}_{\\lambda\\in\\Lambda}$ and vertex $u\\in h$ such that $u\\subset f(h_1)\\cup f(h_2)$. Let $e\\subset Z$ be the edge such that $u=e\\cap h$, then there exist edges $e_{1},e_{2}\\subset Y$ such that $e_{i}\\cap h_{i}\\neq\\emptyset$ and $f(e_{i})=e$ for $i=1,2$. Since $h_{1}\\cap h_{2}=\\emptyset$, a case study implies there exist $x_{1}$ and $x_{2}$ which are endpoints of $e_1$ and $e_2$ respectively such that \n\\begin{enumerate}\n\\item these two points are separated by at least one of $h_{1}$ and $h_2$;\n\\item they are mapped to the same end point $y\\in e$.\n\\end{enumerate}\nIt follows that $f^{-1}(y)$ is disconnected, which is a contradiction.\n\\end{proof}\n\n\\begin{remark}\nIf $f$ is not surjective, then the above conclusion is not necessarily true. Consider the map from $A=[0,3]\\times[0,1]$ to the unit square which collapses the $[0,1]$ factor in $A$ and maps $[0,3]$ to 3 consecutive edges in the boundary of the unit square.\n\\end{remark}\n\n\n\\begin{lem}\n\\label{restriction quotient}\nIf $q:Y\\to Y({\\mathcal K})$ is the restriction quotient as Definition\n\\ref{def_restriction_quotient}, \nthen the inverse image of each hyperplane in $Y({\\mathcal K})$ is a single hyperplane in $Y$. Conversely, suppose $f:Y\\to Z$ is a surjective cubical map between ${\\operatorname{CAT}}(0)$ cube complexes such that the inverse image of each hyperplane is a hyperplane. Let ${\\mathcal K}$ be the collection of walls arising from inverse images of hyperplanes in $Z$. Then there is a natural isomorphism $i: Z\\cong Y({\\mathcal K})$ which fits into the following commutative diagram:\n\\begin{diagram}\nY &\\rTo^f &Z\\\\\n&\\rdTo_q &\\dTo^i \\\\\n& &Y({\\mathcal K})\n\\end{diagram}\n\\end{lem}\n\n\\begin{proof}\nDefine two vertices of $Y$ to be ${\\mathcal K}$-equivalent if and only if they are not separated by any wall in ${\\mathcal K}$. This defines an equivalence relation on vertices of $Y$, and the corresponding equivalent classes are called ${\\mathcal K}$-classes. For each ${\\mathcal K}$-class $C$ and every wall in ${\\mathcal K}$, we may choose the halfspace that contains $C$; it follows that the points in $C$ are exactly the set of vertices contained in the intersection of such halfspaces, and thus $C$ is the vertex set of a convex subcomplex of $Y$. Note that each ${\\mathcal K}$-class determines a 0-cube of $(Y^{0},{\\mathcal K})$, hence is mapped to this 0-cube under $q$. It follows that the inverse image of every vertex in $Y({\\mathcal K})$ is convex, thus by Lemma \\ref{vertex to hyperplane}, the inverse image of a hyperplane is a hyperplane.\n\nIt remains to prove the converse. Note that the inverse image of each halfspace in $Z$ under $f$ is a halfspace of $Y$. Moreover, the surjectivity of $f$ implies that $f$ maps hyperplane to hyperplane and halfspace to halfspace. Pick vertex $y\\in Z$, let $\\{H_{\\lambda}\\}_{\\lambda\\in\\lambda}$ be the collection of hyperplanes in $Z$ that contains $y$. Then $f^{-1}(y)\\subset \\cap_{\\lambda\\in\\Lambda}f^{-1}(H_{\\lambda})$, and every vertex of $\\cap_{\\lambda\\in\\Lambda}f^{-1}(H_{\\lambda})$ is mapped to $y$ by $f$, and thus the vertex set of $f^{-1}(y)$ is a ${\\mathcal K}$-class. This induces a bijective map from $Z^{(0)}$ to the vertex set of $Y({\\mathcal K})$, which extends to an isomorphism. The above diagram commutes since it commutes when restricted to the 0-skeleton.\n\\end{proof}\n\n\n\n\\begin{proof}[Proof of Theorem \\ref{thm_restriction_quotient_characterization}]\nThe equivalence of (4) and (5) follows from Lemma \\ref{restriction quotient}. $(1)\\Rightarrow(4)$ follows from Lemma \\ref{vertex to hyperplane}, $(4)\\Rightarrow(2)$ follows from Lemma \\ref{inverse image of hyperplane}, $(3)\\Rightarrow(1)$ is obvious. It suffices to show $(2)\\Rightarrow(3)$. Pick a convex subcomplex $K\\subset Z$ and let $\\{R_{\\lambda}\\}_{\\lambda\\in\\Lambda}$ be the collection of cubes in $K$. For each $R_{\\lambda}$, let $Y_{R_{\\lambda}}$ be the subcomplex defined after Definition \\ref{cubical map}. $Y_{R_{\\lambda}}\\neq\\emptyset$ since $f$ is surjective and $Y_{R_{\\lambda}}$ is connected by (2). If $R_{\\lambda}\\subset R_{\\lambda'}$, then $Y_{R_{\\lambda}}\\cap Y_{R_{\\lambda'}}\\neq\\emptyset$. Thus $f^{-1}(K)=\\cup_{\\lambda\\in\\Lambda} Y_{R_{\\lambda}}$ is connected, hence convex.\n\\end{proof}\n\n\n\n\n\\subsection{Restriction maps versus fiber functors}\n\\label{sec_restriction_maps_versus_fiber_functors}\n\n\n\n\n\n\n\n\n\n\n\nIf $q:Y\\rightarrow Z$ is a restriction quotient between ${\\operatorname{CAT}}(0)$ cube complexes, then\n we may express the fiber structure in categorical\nlanguage as follows.  Let ${\\operatorname{Face}}(Z)$ denote the face poset of $Z$, viewed as a\ncategory, and let \n ${\\operatorname{CCC}}$  \ndenote the category whose objects are  nonempty ${\\operatorname{CAT}}(0)$\ncube complexes and whose morphisms are convex cubical embeddings. \nBy Lemma \\ref{lem_fiber_functor}, we obtain a contravariant functor \n$\\Psi_q:{\\operatorname{Face}}(Z)\\rightarrow {\\operatorname{CCC}}$.\n\n\\begin{definition}\nThe contravariant functor $\\Psi_q$ is the {\\em fiber functor} of the \nrestriction quotient $q:Y\\rightarrow Z$. \n\\end{definition}\nFor notational brevity, for any inclusion $i:{\\sigma}_1\\rightarrow{\\sigma}_2$, we \nwill often denote the map $\\Psi(i):\\Psi({\\sigma}_2)\\rightarrow \\Psi({\\sigma}_1)$ simply\nby $\\Psi({\\sigma}_2)\\rightarrow \\Psi({\\sigma}_1)$, suppressing the name of the map.\n\n\n\n\n\n\n\n\n\n\nNote that if ${\\sigma}_1\\subset{\\sigma}_2\\subset{\\sigma}_3$, then the functor property\nimplies that the image of $\\Psi({\\sigma}_3)\\rightarrow \\Psi({\\sigma}_1)$ is a convex\nsubcomplex of the image of $\\Psi({\\sigma}_2)\\rightarrow \\Psi({\\sigma}_1)$.  In particular,\nif $v$ is a vertex of a cube ${\\sigma}$, then the image of\n$\\Phi({\\sigma})\\rightarrow \\Psi(v)$ is a convex subcomplex of the intersection\n\n", "index": 5, "text": "$$\n\\bigcap_{v\\subsetneq e\\subset{\\sigma}^{(1)}}{\\operatorname{Im}}(\\Psi(e)\\rightarrow \\Psi(v))\n$$\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex3.m1\" class=\"ltx_Math\" alttext=\"\\bigcap_{v\\subsetneq e\\subset{\\sigma}^{(1)}}{\\operatorname{Im}}(\\Psi(e)%&#10;\\rightarrow\\Psi(v))\" display=\"block\"><mrow><munder><mo largeop=\"true\" mathsize=\"160%\" movablelimits=\"false\" stretchy=\"false\" symmetric=\"true\">\u22c2</mo><mrow><mi>v</mi><mo>\u228a</mo><mi>e</mi><mo>\u2282</mo><msup><mi>\u03c3</mi><mrow><mo stretchy=\"false\">(</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow></msup></mrow></munder><mrow><mo>Im</mo><mo>\u2061</mo><mrow><mo stretchy=\"false\">(</mo><mrow><mrow><mi mathvariant=\"normal\">\u03a8</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>e</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2192</mo><mrow><mi mathvariant=\"normal\">\u03a8</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>v</mi><mo stretchy=\"false\">)</mo></mrow></mrow></mrow><mo stretchy=\"false\">)</mo></mrow></mrow></mrow></math>", "type": "latex"}, {"file": "1601.00946.tex", "nexttext": "\n\\end{definition}\n\n\n\\begin{lemma}\nIf $q:Y\\rightarrow Z$ is a  restriction quotient,\nthen the fiber functor $\\Psi:{\\operatorname{Face}}(Z)\\rightarrow{\\operatorname{CCC}}$ \nis $1$-determined.\n\\end{lemma}\n\\begin{proof}\n Pick ${\\sigma}\\in{\\operatorname{Face}}(Z)$, $v\\in {\\sigma}^{(0)}$.\nWe know that ${\\operatorname{Im}}(\\Psi({\\sigma})\\rightarrow \\Psi(v))$ is a nonempty convex subcomplex\nof $\\cap_{v\\subsetneq e\\subset {\\sigma}^{(1)}}{\\operatorname{Im}}(\\Psi(e)\\rightarrow \\Psi(v))$, so to \nestablish (\\ref{eqn_1_determined}) we need only show that the two convex subcomplexes\nhave the same $0$-skeleton.\n\nPick a vertex  $w\\in {\\operatorname{Im}}(\\Psi({\\sigma})\\rightarrow \\Psi(v))$, and let\n$w'\\in \\cap_{v\\subsetneq e\\subset {\\sigma}^{(1)}}{\\operatorname{Im}}(\\Psi(e)\\rightarrow \\Psi(v))$ be a vertex\nadjacent to $w$.  We let $\\tau\\in{\\operatorname{Face}}(Y)$ denote  the edge spanned by $w,w'$.\nFor every edge $e$ of $Z$ with \n$v\\subsetneq e\\subset{\\sigma}^{(1)}$, let $\\hat e\\subset Y^{(1)}$\ndenote the edge with $q(\\hat e)=e$ that contains $w$.  By assumption, the collection\nof edges $\\{\\tau\\}\\cup \\{\\hat e\\}_{v\\subsetneq e\\subset {\\sigma}^{(1)}}$  determines\na complete graph in the link of $w$, and therefore is contained in a \ncube $\\hat {\\sigma}$ of dimension $1+\\dim{\\sigma}$.  Then $q(\\hat{\\sigma})={\\sigma}$ and \n$\\tau \\subset\\hat{\\sigma}$; this implies that $\\tau\\subset {\\operatorname{Im}}(\\Psi({\\sigma})\\rightarrow\\Psi(v))$.\n\nSince the $1$-skeleton of \n$\\cap_{v\\subsetneq e\\subset {\\sigma}^{(1)}}{\\operatorname{Im}}(\\Psi(e)\\rightarrow \\Psi(v))$ is connected,\nwe conclude that it coincides with the $1$-skeleton of ${\\operatorname{Im}}(\\Psi({\\sigma})\\rightarrow\\Psi(v))$.\nBy convexity, we get (\\ref{eqn_1_determined}).\n\\end{proof}\n\n\\begin{theorem}\n\\label{thm_fiber_functor_gives_restriction_quotient}\nLet $Z$ be a ${\\operatorname{CAT}}(0)$ cube complex, and $\\Psi:{\\operatorname{Face}}(Z)\\rightarrow {\\operatorname{CCC}}$ be a $1$-determined\ncontravariant functor.  Then there is a restriction quotient\n$q:Y\\rightarrow Z$ such that\nthe associated fiber functor $\\Psi_q:{\\operatorname{Face}}(Z)\\rightarrow {\\operatorname{CCC}}$ is equivalent by a natural\ntransformation to $\\Psi$. \n\\end{theorem}\n\\begin{proof}\nWe first construct the cube complex $Y$, and then verify that it has the\ndesired properties.\n\nWe begin with the disjoint union\n$\\bigsqcup_{{\\sigma}\\in{\\operatorname{Face}}(Z)}({\\sigma}\\times \\Psi({\\sigma}))$, and for every inclusion\n${\\sigma}\\subset\\tau$, we glue the subset \n${\\sigma}\\times \\Psi(\\tau)\\subset \\tau\\times\\Psi(\\tau)$ \nto ${\\sigma}\\times\\Psi({\\sigma})$ by using the map\n\n", "itemtype": "equation", "pos": 79085, "prevtext": "\n\n\n\\begin{definition}\nLet $Z$ be a cube complex.\nA contravariant functor $\\Psi:{\\operatorname{Face}}(Z)\\rightarrow {\\operatorname{CCC}}$ is {\\bf $1$-determined}\nif for every cube ${\\sigma}\\in{\\operatorname{Face}}(Z)$, and every vertex $v\\in{\\sigma}^{(0)}$,\n\n", "index": 7, "text": "\\begin{equation}\n\\label{eqn_1_determined}\n{\\operatorname{Im}}(\\Psi({\\sigma}){\\longrightarrow} \\Psi(v))\n=\\bigcap_{v\\subsetneq e\\subset{\\sigma}^{(1)}}{\\operatorname{Im}}(\\Psi(e)\\rightarrow \\Psi(v))\\,.\n\\end{equation}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E1.m1\" class=\"ltx_Math\" alttext=\"{\\operatorname{Im}}(\\Psi({\\sigma}){\\longrightarrow}\\Psi(v))=\\bigcap_{v%&#10;\\subsetneq e\\subset{\\sigma}^{(1)}}{\\operatorname{Im}}(\\Psi(e)\\rightarrow\\Psi(v%&#10;))\\,.\" display=\"block\"><mrow><mrow><mrow><mo>Im</mo><mo>\u2061</mo><mrow><mo stretchy=\"false\">(</mo><mrow><mrow><mi mathvariant=\"normal\">\u03a8</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>\u03c3</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u27f6</mo><mrow><mi mathvariant=\"normal\">\u03a8</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>v</mi><mo stretchy=\"false\">)</mo></mrow></mrow></mrow><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mrow><munder><mo largeop=\"true\" mathsize=\"160%\" movablelimits=\"false\" stretchy=\"false\" symmetric=\"true\">\u22c2</mo><mrow><mi>v</mi><mo>\u228a</mo><mi>e</mi><mo>\u2282</mo><msup><mi>\u03c3</mi><mrow><mo stretchy=\"false\">(</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow></msup></mrow></munder><mrow><mo>Im</mo><mo>\u2061</mo><mrow><mo stretchy=\"false\">(</mo><mrow><mrow><mi mathvariant=\"normal\">\u03a8</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>e</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2192</mo><mrow><mi mathvariant=\"normal\">\u03a8</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>v</mi><mo stretchy=\"false\">)</mo></mrow></mrow></mrow><mo rspace=\"4.2pt\" stretchy=\"false\">)</mo></mrow></mrow></mrow></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.00946.tex", "nexttext": "\nOne checks that the cubical structure on \n$\\bigsqcup_{{\\sigma}\\in{\\operatorname{Face}}(Z)}({\\sigma}\\times \\Psi({\\sigma}))$ descends to the quotient $Y$,\n the projection maps ${\\sigma}\\times\\Psi({\\sigma})\\rightarrow {\\sigma}$ descend to a\ncubical map $q:Y\\rightarrow Z$, and for every ${\\sigma}\\in{\\operatorname{Face}}(Z)$, the union of the\ncubes $\\hat{\\sigma}\\subset Y$ such that $f(\\hat{\\sigma})={\\sigma}$ is a copy of \n${\\sigma}\\times \\Psi({\\sigma})$. \n\n\nWe now verify that links in $Y$ are flag complexes.\n\nLet $v$ be a $0$-cube in $Y$, and suppose ${\\sigma}_1,\\ldots,{\\sigma}_k$ are $1$-cubes\ncontaining $v$, such that for all $1\\leq i\\neq j\\leq k$ the $1$-cubes ${\\sigma}_i,{\\sigma}_j$\nspan a $2$-cube ${\\sigma}_{ij}$ in the link of $v$.  We may assume after reindexing\nthat for some $h\\geq 0$  the image $q({\\sigma}_i)$ is\n a $1$-cube in $Z$ if $i\\leq h$ and a $0$-cube if $i>h$.  \n \nSince $\\Psi(v)$ is a ${\\operatorname{CAT}}(0)$ cube complex, the edges $\\{{\\sigma}_i\\}_{i>h}$ \nspan a cube ${\\sigma}_{vert}\\subset q^{-1}(v)$.  \n\nFor $1\\leq i\\neq j\\leq h$, the $2$-cube ${\\sigma}_{ij}$ projects to a \n$2$-cube $q({\\sigma}_{ij})$ spanned by the two edges  $q({\\sigma}_i),q({\\sigma}_j)$.\nSince $Z$ is a ${\\operatorname{CAT}}(0)$ cube complex, the edges $\\{q({\\sigma}_i)\\}_{i\\leq h}$\nspan an $h$-cube   $\\bar{\\sigma}_{hor}\\subset Z$.  By the $1$-determined\nproperty, we get that ${\\operatorname{Im}}(\\Psi(\\bar{\\sigma}_{hor})\\rightarrow \\Psi(v))$ contains $v$,\nand so there is an $h$-cube ${\\sigma}_{hor}\\subset Y$ containing $v$ such\nthat $q({\\sigma}_{hor})=\\bar{\\sigma}_{hor}$.  \n \nFix $1\\leq i\\leq h$.  Then for $j>h$, the $2$-cube ${\\sigma}_{ij}$ projects to \n$q({\\sigma}_i)$, and hence ${\\sigma}_j$ belongs to ${\\operatorname{Im}}(\\Psi({\\sigma}_i)\\rightarrow\\Psi(v))$.  \nIf $j,k>h$, then ${\\sigma}_j,{\\sigma}_k$ both belong to ${\\operatorname{Im}}(\\Psi({\\sigma}_i)\\rightarrow\\Psi(v))$,\nand by the convexity of ${\\operatorname{Im}}(\\Psi({\\sigma}_i)\\rightarrow\\Psi(v))$ in $\\Psi(v)$, we get\nthat ${\\sigma}_{jk}$ also belongs to ${\\operatorname{Im}}(\\Psi({\\sigma}_i)\\rightarrow\\Psi(v))$.  Applying\nconvexity again,\nwe get that ${\\sigma}_{vert}\\subset {\\operatorname{Im}}(\\Psi({\\sigma}_i)\\rightarrow\\Psi(v))$.  By the $1$-determined\nproperty, it follows that ${\\sigma}_{vert}\\subset {\\operatorname{Im}}(\\Psi(\\bar{\\sigma}_{hor})\\rightarrow \\Psi(v))$.\nThis yields a $k$-cube ${\\sigma}\\subset Y$ containing ${\\sigma}_{hor}\\cup{\\sigma}_{vert}$,\nwhich is spanned by ${\\sigma}_1,\\ldots,{\\sigma}_k$.  \n\nThus we have shown that links in $Y$ are flag complexes.  The fact that the\nfibers of $f:Y\\rightarrow Z$ are contractible implies that $Y$ is contractible\n(in particular simply connected), so $Y$ is ${\\operatorname{CAT}}(0)$.\n\n\n\\end{proof}\n\n\nWe now observe that the construction of restriction quotients is compatible\nwith product structure:\n\\begin{lemma}[Behavior under products]\n\\label{lem_behavior_under_products}\nFor $i\\in \\{1,2\\}$ let $q_i:Y_i\\rightarrow Z_i$ be a restriction quotient with fiber\nfunctor $\\Psi_i:{\\operatorname{Face}}(Z_i)\\rightarrow {\\operatorname{CCC}}$.  Then the\nproduct $q_1\\times q_2:Y_1\\times Y_2\\rightarrow Z_1\\times Z_2$ is a\nrestriction quotient with fiber functor given by the product:\n\n", "itemtype": "equation", "pos": 81903, "prevtext": "\n\\end{definition}\n\n\n\\begin{lemma}\nIf $q:Y\\rightarrow Z$ is a  restriction quotient,\nthen the fiber functor $\\Psi:{\\operatorname{Face}}(Z)\\rightarrow{\\operatorname{CCC}}$ \nis $1$-determined.\n\\end{lemma}\n\\begin{proof}\n Pick ${\\sigma}\\in{\\operatorname{Face}}(Z)$, $v\\in {\\sigma}^{(0)}$.\nWe know that ${\\operatorname{Im}}(\\Psi({\\sigma})\\rightarrow \\Psi(v))$ is a nonempty convex subcomplex\nof $\\cap_{v\\subsetneq e\\subset {\\sigma}^{(1)}}{\\operatorname{Im}}(\\Psi(e)\\rightarrow \\Psi(v))$, so to \nestablish (\\ref{eqn_1_determined}) we need only show that the two convex subcomplexes\nhave the same $0$-skeleton.\n\nPick a vertex  $w\\in {\\operatorname{Im}}(\\Psi({\\sigma})\\rightarrow \\Psi(v))$, and let\n$w'\\in \\cap_{v\\subsetneq e\\subset {\\sigma}^{(1)}}{\\operatorname{Im}}(\\Psi(e)\\rightarrow \\Psi(v))$ be a vertex\nadjacent to $w$.  We let $\\tau\\in{\\operatorname{Face}}(Y)$ denote  the edge spanned by $w,w'$.\nFor every edge $e$ of $Z$ with \n$v\\subsetneq e\\subset{\\sigma}^{(1)}$, let $\\hat e\\subset Y^{(1)}$\ndenote the edge with $q(\\hat e)=e$ that contains $w$.  By assumption, the collection\nof edges $\\{\\tau\\}\\cup \\{\\hat e\\}_{v\\subsetneq e\\subset {\\sigma}^{(1)}}$  determines\na complete graph in the link of $w$, and therefore is contained in a \ncube $\\hat {\\sigma}$ of dimension $1+\\dim{\\sigma}$.  Then $q(\\hat{\\sigma})={\\sigma}$ and \n$\\tau \\subset\\hat{\\sigma}$; this implies that $\\tau\\subset {\\operatorname{Im}}(\\Psi({\\sigma})\\rightarrow\\Psi(v))$.\n\nSince the $1$-skeleton of \n$\\cap_{v\\subsetneq e\\subset {\\sigma}^{(1)}}{\\operatorname{Im}}(\\Psi(e)\\rightarrow \\Psi(v))$ is connected,\nwe conclude that it coincides with the $1$-skeleton of ${\\operatorname{Im}}(\\Psi({\\sigma})\\rightarrow\\Psi(v))$.\nBy convexity, we get (\\ref{eqn_1_determined}).\n\\end{proof}\n\n\\begin{theorem}\n\\label{thm_fiber_functor_gives_restriction_quotient}\nLet $Z$ be a ${\\operatorname{CAT}}(0)$ cube complex, and $\\Psi:{\\operatorname{Face}}(Z)\\rightarrow {\\operatorname{CCC}}$ be a $1$-determined\ncontravariant functor.  Then there is a restriction quotient\n$q:Y\\rightarrow Z$ such that\nthe associated fiber functor $\\Psi_q:{\\operatorname{Face}}(Z)\\rightarrow {\\operatorname{CCC}}$ is equivalent by a natural\ntransformation to $\\Psi$. \n\\end{theorem}\n\\begin{proof}\nWe first construct the cube complex $Y$, and then verify that it has the\ndesired properties.\n\nWe begin with the disjoint union\n$\\bigsqcup_{{\\sigma}\\in{\\operatorname{Face}}(Z)}({\\sigma}\\times \\Psi({\\sigma}))$, and for every inclusion\n${\\sigma}\\subset\\tau$, we glue the subset \n${\\sigma}\\times \\Psi(\\tau)\\subset \\tau\\times\\Psi(\\tau)$ \nto ${\\sigma}\\times\\Psi({\\sigma})$ by using the map\n\n", "index": 9, "text": "$$\n{\\sigma}\\times\\Psi(\\tau)\n\\xrightarrow{{\\operatorname{id}}_{\\sigma}\\times\\Psi({\\sigma}\\subset\\tau)}{\\sigma}\\times\\Psi({\\sigma})\\,.\n$$\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex4.m1\" class=\"ltx_Math\" alttext=\"{\\sigma}\\times\\Psi(\\tau)\\xrightarrow{{\\operatorname{id}}_{\\sigma}\\times\\Psi({%&#10;\\sigma}\\subset\\tau)}{\\sigma}\\times\\Psi({\\sigma})\\,.\" display=\"block\"><mrow><mrow><mrow><mrow><mi>\u03c3</mi><mo>\u00d7</mo><mi mathvariant=\"normal\">\u03a8</mi></mrow><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>\u03c4</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mover accent=\"true\"><mo>\u2192</mo><mrow><msub><mo>id</mo><mi>\u03c3</mi></msub><mo>\u00d7</mo><mi mathvariant=\"normal\">\u03a8</mi><mrow><mo stretchy=\"false\">(</mo><mi>\u03c3</mi><mo>\u2282</mo><mi>\u03c4</mi><mo stretchy=\"false\">)</mo></mrow></mrow></mover><mrow><mrow><mi>\u03c3</mi><mo>\u00d7</mo><mi mathvariant=\"normal\">\u03a8</mi></mrow><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>\u03c3</mi><mo rspace=\"4.2pt\" stretchy=\"false\">)</mo></mrow></mrow></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.00946.tex", "nexttext": "\n\nIn particular, if one starts with  ${\\operatorname{CAT}}(0)$ cube complexes $Z_i$ and\nfiber functors $\\Psi_i:Z_i\\rightarrow {\\operatorname{CCC}}$ for $i\\in\\{1,2\\}$, then the product\nfiber functor defined as above is the fiber functor of the product of the \nrestriction quotients associated to the $\\Psi_i$'s.\n\\end{lemma} \n\n\n\n\\subsection{Equivariance properties}\n\\label{sec_equivariance_properties}\n\n\n\\mbox{}\nWe now discuss isomorphisms between restriction quotients, and the naturality properties of the restriction quotient \nassociated with a fiber functor.\n\nSuppose we have a commutative diagram\n\\begin{diagram}\nY_1    &\\rTo^{\\hat{\\alpha}}&Y_2\\\\\n\\dTo^{q_1} &  &\\dTo^{q_2}\\\\\nZ_1      & \\rTo^{\\alpha}  & Z_2\n\\end{diagram}\nwhere the $q_i$'s are restriction quotients and ${\\alpha},\\hat{\\alpha}$ are cubical isomorphisms.   Let $\\Psi_i:{\\operatorname{Face}}(Z_i)\\rightarrow {\\operatorname{CCC}}$\nbe the fiber functor associated with $q_i$.   Notice that the pair ${\\alpha},\\hat{\\alpha}$ allows us to compare  the two\nfiber functors, since for every ${\\sigma}\\in{\\operatorname{Face}}(Z_1)$,  the map $\\hat{\\alpha}$ induces a cubical isomorphism\nbetween $\\Psi_1({\\sigma})$ and $\\Psi_2({\\alpha}({\\sigma}))$, and this is compatible with maps induced with inclusions of\nfaces.   This may be stated more compactly by saying that $\\hat{\\alpha}$ induces a natural isomorphism\nbetween the\n fiber functors $\\Psi_1$ and $\\Psi_2\\circ {\\operatorname{Face}}({\\alpha})$, where ${\\operatorname{Face}}({\\alpha}):{\\operatorname{Face}}(Z_1)\\rightarrow{\\operatorname{Face}}(Z_2)$\nis the poset isomorphism induced by ${\\alpha}$.  Here the term {\\em natural isomorphism} is being used\nin the sense of category theory, i.e. a natural transformation \nthat has an inverse that is also a natural transformation.\n\nNow suppose  that for $i\\in \\{1,2\\}$ we have a ${\\operatorname{CAT}}(0)$ cube complex $Z_i$\nand a $1$-determined fiber functor $\\Psi_i:{\\operatorname{Face}}(Z_i)\\rightarrow {\\operatorname{CCC}}$.   Let $f_i:Y_i\\rightarrow Z_i$ be the \nassociated restriction quotients.  If we have a pair ${\\alpha},{\\beta}$, where ${\\alpha}:Z_1\\rightarrow Z_2$ is a\ncubical isomorphism, and ${\\beta}$ is a natural isomorphism between the\nfiber functors $\\Psi_1$ and $\\Psi_2\\circ {\\operatorname{Face}}({\\alpha})$, then we get an induced map $\\hat{\\alpha}:Y_1\\rightarrow Y_2$,\nwhich may be defined by using the description of $Y_i$ as the quotient of the disjoint collection\n$\\{{\\sigma}\\times \\Psi_i({\\sigma})\\}_{{\\sigma}\\in {\\operatorname{Face}}(Z_i)}$.  \n\nAs a consequence of the above, having an action of a group $G$ on a restriction quotient $f:Y\\rightarrow Z$\nis equivalent to having an action $G{\\curvearrowright} Z$ together with a compatible ``action'' on the fiber functor\n$\\Psi_f$, i.e. a family $\\{({\\alpha}(g),{\\beta}(g))\\}_{g\\in G}$ as above that\nalso satisfies an appropriate composition rule.\n\n\\subsection{Quasi-isometric properties} \n\\label{sec_quasiisometric_properties}\n\n\nWe now consider the coarse geometry of restriction quotients; this amounts\nto a ``coarsification'' of the discussion in the preceding subsection.\n\nThe relevant definition is a coarsification of the natural isomorphisms between\nfiber functors.\n\n\\begin{definition}\nLet $Z$ be a ${\\operatorname{CAT}}(0)$ cube complex and $\\Psi_i:{\\operatorname{Face}}(Z)\\rightarrow{\\operatorname{CCC}}$\nbe fiber functors for $i\\in\\{1,2\\}$.\nAn {\\em $(L,A)$-quasi-natural isomorphism from $\\Psi_1$ to $\\Psi_2$}\nis a collection $\\{\\phi({\\sigma}):\\Psi_1({\\sigma})\\rightarrow\\Psi_2({\\sigma})\\}_{{\\sigma}\\in{\\operatorname{Face}}(Z)}$\nsuch that\n$\\phi({\\sigma})$ is an $(L,A)$-quasi-isometry for all ${\\sigma}\\in{\\operatorname{Face}}(Z)$,\nand for every inclusion ${\\sigma}\\subset\\tau$, the diagram\n\\begin{diagram}\n\\Psi_1(\\tau)    &\\rTo^{\\phi(\\tau)}&\\Psi_2(\\tau)\\\\\n\\dTo &  &\\dTo\\\\\n\\Psi_1({\\sigma})     & \\rTo^{\\phi({\\sigma})}  & \\Psi_2({\\sigma})\n\\end{diagram}\ncommutes up to error $L$.\n\\end{definition}\n\nNow for $i\\in \\{1,2\\}$\nlet $f_i:Y_i\\rightarrow Z$ be a finite dimensional restriction quotient, with\nrespective fiber functor $\\Psi_i:{\\operatorname{Face}}(Z)\\rightarrow{\\operatorname{CCC}}$.  For any \n${\\sigma}\\in{\\operatorname{Face}}(Z)$, we identify $\\Psi_i({\\sigma})$ with $f_i(b_{\\sigma})$,\nwhere $b_{\\sigma}\\in{\\sigma}$ is the barycenter.  \n\n\\begin{lemma}\n\\label{lem_quasiisometry_gives_quasiisomorphism}\nSuppose we have a commutative diagram\n\\begin{diagram}\nY_1   &            &\\pile{\\rTo^{\\phi}\\\\\\lTo_{\\phi'}}& &Y_2\\\\\n\t  &\\rdTo_{f_1} &                 &\\ldTo_{f_2}&\\\\\n    && Z  && \n\\end{diagram}\nwhere $\\phi,\\phi'$ are $(L,A)$-quasi-isometries that are $A$-quasi-inverses,\ni.e. the compositions $\\phi\\circ\\phi'$, $\\phi'\\circ\\phi$ are at distance\n$<A$ from the identity maps.\nThen the collection \n\n", "itemtype": "equation", "pos": 85257, "prevtext": "\nOne checks that the cubical structure on \n$\\bigsqcup_{{\\sigma}\\in{\\operatorname{Face}}(Z)}({\\sigma}\\times \\Psi({\\sigma}))$ descends to the quotient $Y$,\n the projection maps ${\\sigma}\\times\\Psi({\\sigma})\\rightarrow {\\sigma}$ descend to a\ncubical map $q:Y\\rightarrow Z$, and for every ${\\sigma}\\in{\\operatorname{Face}}(Z)$, the union of the\ncubes $\\hat{\\sigma}\\subset Y$ such that $f(\\hat{\\sigma})={\\sigma}$ is a copy of \n${\\sigma}\\times \\Psi({\\sigma})$. \n\n\nWe now verify that links in $Y$ are flag complexes.\n\nLet $v$ be a $0$-cube in $Y$, and suppose ${\\sigma}_1,\\ldots,{\\sigma}_k$ are $1$-cubes\ncontaining $v$, such that for all $1\\leq i\\neq j\\leq k$ the $1$-cubes ${\\sigma}_i,{\\sigma}_j$\nspan a $2$-cube ${\\sigma}_{ij}$ in the link of $v$.  We may assume after reindexing\nthat for some $h\\geq 0$  the image $q({\\sigma}_i)$ is\n a $1$-cube in $Z$ if $i\\leq h$ and a $0$-cube if $i>h$.  \n \nSince $\\Psi(v)$ is a ${\\operatorname{CAT}}(0)$ cube complex, the edges $\\{{\\sigma}_i\\}_{i>h}$ \nspan a cube ${\\sigma}_{vert}\\subset q^{-1}(v)$.  \n\nFor $1\\leq i\\neq j\\leq h$, the $2$-cube ${\\sigma}_{ij}$ projects to a \n$2$-cube $q({\\sigma}_{ij})$ spanned by the two edges  $q({\\sigma}_i),q({\\sigma}_j)$.\nSince $Z$ is a ${\\operatorname{CAT}}(0)$ cube complex, the edges $\\{q({\\sigma}_i)\\}_{i\\leq h}$\nspan an $h$-cube   $\\bar{\\sigma}_{hor}\\subset Z$.  By the $1$-determined\nproperty, we get that ${\\operatorname{Im}}(\\Psi(\\bar{\\sigma}_{hor})\\rightarrow \\Psi(v))$ contains $v$,\nand so there is an $h$-cube ${\\sigma}_{hor}\\subset Y$ containing $v$ such\nthat $q({\\sigma}_{hor})=\\bar{\\sigma}_{hor}$.  \n \nFix $1\\leq i\\leq h$.  Then for $j>h$, the $2$-cube ${\\sigma}_{ij}$ projects to \n$q({\\sigma}_i)$, and hence ${\\sigma}_j$ belongs to ${\\operatorname{Im}}(\\Psi({\\sigma}_i)\\rightarrow\\Psi(v))$.  \nIf $j,k>h$, then ${\\sigma}_j,{\\sigma}_k$ both belong to ${\\operatorname{Im}}(\\Psi({\\sigma}_i)\\rightarrow\\Psi(v))$,\nand by the convexity of ${\\operatorname{Im}}(\\Psi({\\sigma}_i)\\rightarrow\\Psi(v))$ in $\\Psi(v)$, we get\nthat ${\\sigma}_{jk}$ also belongs to ${\\operatorname{Im}}(\\Psi({\\sigma}_i)\\rightarrow\\Psi(v))$.  Applying\nconvexity again,\nwe get that ${\\sigma}_{vert}\\subset {\\operatorname{Im}}(\\Psi({\\sigma}_i)\\rightarrow\\Psi(v))$.  By the $1$-determined\nproperty, it follows that ${\\sigma}_{vert}\\subset {\\operatorname{Im}}(\\Psi(\\bar{\\sigma}_{hor})\\rightarrow \\Psi(v))$.\nThis yields a $k$-cube ${\\sigma}\\subset Y$ containing ${\\sigma}_{hor}\\cup{\\sigma}_{vert}$,\nwhich is spanned by ${\\sigma}_1,\\ldots,{\\sigma}_k$.  \n\nThus we have shown that links in $Y$ are flag complexes.  The fact that the\nfibers of $f:Y\\rightarrow Z$ are contractible implies that $Y$ is contractible\n(in particular simply connected), so $Y$ is ${\\operatorname{CAT}}(0)$.\n\n\n\\end{proof}\n\n\nWe now observe that the construction of restriction quotients is compatible\nwith product structure:\n\\begin{lemma}[Behavior under products]\n\\label{lem_behavior_under_products}\nFor $i\\in \\{1,2\\}$ let $q_i:Y_i\\rightarrow Z_i$ be a restriction quotient with fiber\nfunctor $\\Psi_i:{\\operatorname{Face}}(Z_i)\\rightarrow {\\operatorname{CCC}}$.  Then the\nproduct $q_1\\times q_2:Y_1\\times Y_2\\rightarrow Z_1\\times Z_2$ is a\nrestriction quotient with fiber functor given by the product:\n\n", "index": 11, "text": "$$\n{\\operatorname{Face}}(Z_1\\times Z_2)\\simeq {\\operatorname{Face}}(Z_1)\\times {\\operatorname{Face}}(Z_2)\n\\xrightarrow{\\Psi_1\\times\\Psi_2}{\\operatorname{CCC}}\\times{\\operatorname{CCC}}\n\\xrightarrow{\\times}{\\operatorname{CCC}}\\,.\n$$\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex5.m1\" class=\"ltx_Math\" alttext=\"{\\operatorname{Face}}(Z_{1}\\times Z_{2})\\simeq{\\operatorname{Face}}(Z_{1})%&#10;\\times{\\operatorname{Face}}(Z_{2})\\xrightarrow{\\Psi_{1}\\times\\Psi_{2}}{%&#10;\\operatorname{CCC}}\\times{\\operatorname{CCC}}\\xrightarrow{\\times}{%&#10;\\operatorname{CCC}}\\,.\" display=\"block\"><mrow><mrow><mrow><mo>Face</mo><mo>\u2061</mo><mrow><mo stretchy=\"false\">(</mo><mrow><msub><mi>Z</mi><mn>1</mn></msub><mo>\u00d7</mo><msub><mi>Z</mi><mn>2</mn></msub></mrow><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2243</mo><mrow><mrow><mo>Face</mo><mo>\u2061</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>Z</mi><mn>1</mn></msub><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u00d7</mo><mrow><mo>Face</mo><mo>\u2061</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>Z</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo></mrow></mrow></mrow><mover accent=\"true\"><mo>\u2192</mo><mrow><msub><mi mathvariant=\"normal\">\u03a8</mi><mn>1</mn></msub><mo>\u00d7</mo><msub><mi mathvariant=\"normal\">\u03a8</mi><mn>2</mn></msub></mrow></mover><mrow><mo>CCC</mo><mo>\u00d7</mo><mo>CCC</mo></mrow><mover accent=\"true\"><mo>\u2192</mo><mo>\u00d7</mo></mover><mo rspace=\"4.2pt\">CCC</mo></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.00946.tex", "nexttext": "\nis an $(L',A')$-quasi-natural isomorphism where $L'=L'(L,A,\\dim Y_i)$,\n$A'=A'(L,A,\\dim Y_i)$.\n\\end{lemma}\n\\begin{proof}\nBy Theorem \\ref{thm_restriction_quotient_characterization}, \nthe fiber $f_i^{-1}(b_{\\sigma})$ is a convex subset of $Y_i$, and\nhence is isometrically embedded.  Therefore $\\phi$ and $\\phi'$\ninduce  $(L,A)$-quasi-isometric\nembeddings $f_1^{-1}(b_{\\sigma})\\rightarrow f_2^{-1}(b_{\\sigma})$, \n$f_2^{-1}({\\sigma}_b)\\rightarrow f_1^{-1}(b_{\\sigma})$.  If ${\\sigma}\\subset\\tau$, then any\npoint $x\\in f_i^{-1}(b_\\tau)$ lies at distance $<C=C(\\dim Y_i)$\nfrom a point in $f_i^{-1}(b_{\\sigma})$, and this implies that \nthe collection of maps $\\{\\Psi_1({\\sigma})\\rightarrow \\Psi_2({\\sigma})\\}_{{\\sigma}\\in{\\operatorname{Face}}(Z)}$\nis an $(L',A')$-quasi-natural isomorphism as claimed.\n\\end{proof}\n\n\n\\begin{lemma}\n\\label{lem_quasiisomorphism_gives_quasiisometry}\nIf $\\{\\phi({\\sigma}):\\Psi_1({\\sigma})\\rightarrow \\Psi_2({\\sigma})\\}_{{\\sigma}\\in{\\operatorname{Face}}(Z)}$\nis an $(L,A)$-quasi-natural isomorphism from $\\Psi_1$ to $\\Psi_2$,\nthen it arises from a commutative diagram as in the previous lemma,\nwhere $\\phi$, $\\phi'$ are $(L',A')$-quasi-isometries that are $A'$-quasi-inverses,\nand $L',A'$ depend only on $L,A$, and $\\dim Y_i$.\n\\end{lemma}\n\\begin{proof}\nFor every ${\\sigma}\\in{\\operatorname{Face}}(Z)$, we may choose a quasi-inverse \n$\\phi'({\\sigma}):\\Psi_2({\\sigma})\\rightarrow \\Psi_1({\\sigma})$ with uniform constants;\nthis is also a quasi-natural isomorphism.\nIdentifying $f_i^{-1}({\\operatorname{Int}}({\\sigma}))$ with the product\n${\\operatorname{Int}}({\\sigma})\\times \\Psi_i({\\sigma})$, we define $\\phi{\\mbox{\\Large \\(|\\)\\normalsize}}_{f_1^{-1}({\\operatorname{Int}}({\\sigma}))}$ \nby\n\n", "itemtype": "equation", "pos": 90227, "prevtext": "\n\nIn particular, if one starts with  ${\\operatorname{CAT}}(0)$ cube complexes $Z_i$ and\nfiber functors $\\Psi_i:Z_i\\rightarrow {\\operatorname{CCC}}$ for $i\\in\\{1,2\\}$, then the product\nfiber functor defined as above is the fiber functor of the product of the \nrestriction quotients associated to the $\\Psi_i$'s.\n\\end{lemma} \n\n\n\n\\subsection{Equivariance properties}\n\\label{sec_equivariance_properties}\n\n\n\\mbox{}\nWe now discuss isomorphisms between restriction quotients, and the naturality properties of the restriction quotient \nassociated with a fiber functor.\n\nSuppose we have a commutative diagram\n\\begin{diagram}\nY_1    &\\rTo^{\\hat{\\alpha}}&Y_2\\\\\n\\dTo^{q_1} &  &\\dTo^{q_2}\\\\\nZ_1      & \\rTo^{\\alpha}  & Z_2\n\\end{diagram}\nwhere the $q_i$'s are restriction quotients and ${\\alpha},\\hat{\\alpha}$ are cubical isomorphisms.   Let $\\Psi_i:{\\operatorname{Face}}(Z_i)\\rightarrow {\\operatorname{CCC}}$\nbe the fiber functor associated with $q_i$.   Notice that the pair ${\\alpha},\\hat{\\alpha}$ allows us to compare  the two\nfiber functors, since for every ${\\sigma}\\in{\\operatorname{Face}}(Z_1)$,  the map $\\hat{\\alpha}$ induces a cubical isomorphism\nbetween $\\Psi_1({\\sigma})$ and $\\Psi_2({\\alpha}({\\sigma}))$, and this is compatible with maps induced with inclusions of\nfaces.   This may be stated more compactly by saying that $\\hat{\\alpha}$ induces a natural isomorphism\nbetween the\n fiber functors $\\Psi_1$ and $\\Psi_2\\circ {\\operatorname{Face}}({\\alpha})$, where ${\\operatorname{Face}}({\\alpha}):{\\operatorname{Face}}(Z_1)\\rightarrow{\\operatorname{Face}}(Z_2)$\nis the poset isomorphism induced by ${\\alpha}$.  Here the term {\\em natural isomorphism} is being used\nin the sense of category theory, i.e. a natural transformation \nthat has an inverse that is also a natural transformation.\n\nNow suppose  that for $i\\in \\{1,2\\}$ we have a ${\\operatorname{CAT}}(0)$ cube complex $Z_i$\nand a $1$-determined fiber functor $\\Psi_i:{\\operatorname{Face}}(Z_i)\\rightarrow {\\operatorname{CCC}}$.   Let $f_i:Y_i\\rightarrow Z_i$ be the \nassociated restriction quotients.  If we have a pair ${\\alpha},{\\beta}$, where ${\\alpha}:Z_1\\rightarrow Z_2$ is a\ncubical isomorphism, and ${\\beta}$ is a natural isomorphism between the\nfiber functors $\\Psi_1$ and $\\Psi_2\\circ {\\operatorname{Face}}({\\alpha})$, then we get an induced map $\\hat{\\alpha}:Y_1\\rightarrow Y_2$,\nwhich may be defined by using the description of $Y_i$ as the quotient of the disjoint collection\n$\\{{\\sigma}\\times \\Psi_i({\\sigma})\\}_{{\\sigma}\\in {\\operatorname{Face}}(Z_i)}$.  \n\nAs a consequence of the above, having an action of a group $G$ on a restriction quotient $f:Y\\rightarrow Z$\nis equivalent to having an action $G{\\curvearrowright} Z$ together with a compatible ``action'' on the fiber functor\n$\\Psi_f$, i.e. a family $\\{({\\alpha}(g),{\\beta}(g))\\}_{g\\in G}$ as above that\nalso satisfies an appropriate composition rule.\n\n\\subsection{Quasi-isometric properties} \n\\label{sec_quasiisometric_properties}\n\n\nWe now consider the coarse geometry of restriction quotients; this amounts\nto a ``coarsification'' of the discussion in the preceding subsection.\n\nThe relevant definition is a coarsification of the natural isomorphisms between\nfiber functors.\n\n\\begin{definition}\nLet $Z$ be a ${\\operatorname{CAT}}(0)$ cube complex and $\\Psi_i:{\\operatorname{Face}}(Z)\\rightarrow{\\operatorname{CCC}}$\nbe fiber functors for $i\\in\\{1,2\\}$.\nAn {\\em $(L,A)$-quasi-natural isomorphism from $\\Psi_1$ to $\\Psi_2$}\nis a collection $\\{\\phi({\\sigma}):\\Psi_1({\\sigma})\\rightarrow\\Psi_2({\\sigma})\\}_{{\\sigma}\\in{\\operatorname{Face}}(Z)}$\nsuch that\n$\\phi({\\sigma})$ is an $(L,A)$-quasi-isometry for all ${\\sigma}\\in{\\operatorname{Face}}(Z)$,\nand for every inclusion ${\\sigma}\\subset\\tau$, the diagram\n\\begin{diagram}\n\\Psi_1(\\tau)    &\\rTo^{\\phi(\\tau)}&\\Psi_2(\\tau)\\\\\n\\dTo &  &\\dTo\\\\\n\\Psi_1({\\sigma})     & \\rTo^{\\phi({\\sigma})}  & \\Psi_2({\\sigma})\n\\end{diagram}\ncommutes up to error $L$.\n\\end{definition}\n\nNow for $i\\in \\{1,2\\}$\nlet $f_i:Y_i\\rightarrow Z$ be a finite dimensional restriction quotient, with\nrespective fiber functor $\\Psi_i:{\\operatorname{Face}}(Z)\\rightarrow{\\operatorname{CCC}}$.  For any \n${\\sigma}\\in{\\operatorname{Face}}(Z)$, we identify $\\Psi_i({\\sigma})$ with $f_i(b_{\\sigma})$,\nwhere $b_{\\sigma}\\in{\\sigma}$ is the barycenter.  \n\n\\begin{lemma}\n\\label{lem_quasiisometry_gives_quasiisomorphism}\nSuppose we have a commutative diagram\n\\begin{diagram}\nY_1   &            &\\pile{\\rTo^{\\phi}\\\\\\lTo_{\\phi'}}& &Y_2\\\\\n\t  &\\rdTo_{f_1} &                 &\\ldTo_{f_2}&\\\\\n    && Z  && \n\\end{diagram}\nwhere $\\phi,\\phi'$ are $(L,A)$-quasi-isometries that are $A$-quasi-inverses,\ni.e. the compositions $\\phi\\circ\\phi'$, $\\phi'\\circ\\phi$ are at distance\n$<A$ from the identity maps.\nThen the collection \n\n", "index": 13, "text": "$$\n\\{\\Psi_1({\\sigma})=f_1^{-1}(b_{\\sigma})\\stackrel{\\phi{\\mbox{\\Large \\(|\\)\\normalsize}}_{f_1^{-1}}(b_{\\sigma})}{{\\longrightarrow}}\nf_2^{-1}(b_{\\sigma})=\\Psi_2({\\sigma})\\}_{{\\sigma}\\in{\\operatorname{Face}}(Z)}\n$$\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex6.m1\" class=\"ltx_Math\" alttext=\"\\{\\Psi_{1}({\\sigma})=f_{1}^{-1}(b_{\\sigma})\\stackrel{\\phi{\\mbox{\\Large\\(|\\)%&#10;\\normalsize}}_{f_{1}^{-1}}(b_{\\sigma})}{{\\longrightarrow}}f_{2}^{-1}(b_{\\sigma%&#10;})=\\Psi_{2}({\\sigma})\\}_{{\\sigma}\\in{\\operatorname{Face}}(Z)}\" display=\"block\"><msub><mrow><mo stretchy=\"false\">{</mo><msub><mi mathvariant=\"normal\">\u03a8</mi><mn>1</mn></msub><mrow><mo stretchy=\"false\">(</mo><mi>\u03c3</mi><mo stretchy=\"false\">)</mo></mrow><mo>=</mo><msubsup><mi>f</mi><mn>1</mn><mrow><mo>-</mo><mn>1</mn></mrow></msubsup><mrow><mo stretchy=\"false\">(</mo><msub><mi>b</mi><mi>\u03c3</mi></msub><mo stretchy=\"false\">)</mo></mrow><mover><mo movablelimits=\"false\">\u27f6</mo><mrow><msub><mrow><mi mathsize=\"142%\">\u03d5</mi><mo fence=\"true\" maxsize=\"205%\" minsize=\"205%\">|</mo></mrow><msubsup><mi mathsize=\"140%\">f</mi><mn>1</mn><mrow><mo>-</mo><mn>1</mn></mrow></msubsup></msub><mo>\u2062</mo><mrow><mo maxsize=\"142%\" minsize=\"142%\">(</mo><msub><mi mathsize=\"142%\">b</mi><mi mathsize=\"140%\">\u03c3</mi></msub><mo maxsize=\"142%\" minsize=\"142%\">)</mo></mrow></mrow></mover><msubsup><mi>f</mi><mn>2</mn><mrow><mo>-</mo><mn>1</mn></mrow></msubsup><mrow><mo stretchy=\"false\">(</mo><msub><mi>b</mi><mi>\u03c3</mi></msub><mo stretchy=\"false\">)</mo></mrow><mo>=</mo><msub><mi mathvariant=\"normal\">\u03a8</mi><mn>2</mn></msub><mrow><mo stretchy=\"false\">(</mo><mi>\u03c3</mi><mo stretchy=\"false\">)</mo></mrow><mo stretchy=\"false\">}</mo></mrow><mrow><mi>\u03c3</mi><mo>\u2208</mo><mrow><mo>Face</mo><mo>\u2061</mo><mrow><mo stretchy=\"false\">(</mo><mi>Z</mi><mo stretchy=\"false\">)</mo></mrow></mrow></mrow></msub></math>", "type": "latex"}, {"file": "1601.00946.tex", "nexttext": "\nand $\\phi'$ similarly using $\\{\\phi'({\\sigma})\\}_{{\\sigma}\\in{\\operatorname{Face}}(Z)}$.\nOne readily checks that $\\phi$, $\\phi'$ are quasi-isometric embeddings\nthat are also quasi-inverses, where the constants depend on $L, A$, and\n$\\dim Y_i$.\n\\end{proof}\n\n\\section{The ${\\mathbb Z}$-blow-up of right-angled Building}\n\\label{sec_blow-up of building}\nIn this section ${\\Gamma}$ will be an arbitrary finite simplicial graph, and\nall buildings will be right-angled buildings modelled on the right-angled Coxeter group $W({\\Gamma})$ with defining graph ${\\Gamma}$.   The reader may wish to review Section \n\\ref{building} for terminology and notation regarding buildings, before proceeding. \n\n\nThe goal of this section is examine restriction quotients\n$q:Y\\rightarrow |{\\mathcal{B}}|$, where the fibers are Euclidean spaces satisfying a\ndimension condition as in Theorem \\ref{thm_main_intro_quasi_action}\nor \\ref{thm_main_intro}.  For such restriction quotients, the fiber functor\nmay be distilled down to $1$-data, see Definition \\ref{1-data}; this is discussed in \nSubsection \\ref{subsection_Restriction quotients with Euclidean fibers}.\nConversely, given a building ${\\mathcal{B}}$ and certain blow-up data (Definition\n\\ref{input data}), one can construct a corresponding $1$-determined\nfiber functor as in Section \\ref{sec_restriction_maps_versus_fiber_functors};\nsee Subsection \\ref{subsection_input for Z-blow-up}.  \n\n\n\n\n\\subsection{The canonical restriction quotient for a RAAG}\n\\label{subsection_canonical restriction quotient}\nLet $G(\\Gamma)$ be the RAAG with defining graph ${\\Gamma}$ and let ${\\mathcal{B}}({\\Gamma})$ be the building associated with $G({\\Gamma})$  (see \\cite[Section 5]{davis_buildings_are_cat0}). Then $G(\\Gamma)$ can identified with the set of chambers of ${\\mathcal{B}}({\\Gamma})$. Under this identification, the $J$-residues of ${\\mathcal{B}}$, for $J$ a collection of vertices in ${\\Gamma}$, are the left cosets of the standard subgroups of $G(\\Gamma)$ generated by $J$. Thus the poset of spherical residues is exactly the poset of left cosets of standard Abelian subgroups of $G(\\Gamma)$, which is also isomorphic to the poset of standard flats in $X({\\Gamma})$.\n\n\nWe now revisit \nthe discussion after Definition \\ref{def_graph_product_of_spaces} and Example \\ref{the key example} in more detail, and relate them to buildings. To simplify notation, we will write $G=G({\\Gamma})$, ${\\mathcal{B}}={\\mathcal{B}}({\\Gamma})$ and $X=X({\\Gamma})$.\n\nLet $|{\\mathcal{B}}|$ be the Davis realization of the building ${\\mathcal{B}}$.  Then we have an induced isometric action $G {\\curvearrowright} |{\\mathcal{B}}|$, which is cocompact, but not proper. It turns out there is natural way to blow-up $|{\\mathcal{B}}|$ to obtain a space $X_e=X_{e}({\\Gamma})$ such that there is a geometric action $G {\\curvearrowright} X_{e}$ and a $G$-equivariant restriction quotient map $X_{e}\\to |{\\mathcal{B}}|$.\n\n$X_e$ can be constructed as follows. First we constructed the \\textit{exploded Salvetti complex} $S_e=S_{e}({\\Gamma})$, which was introduced in \\cite{bks2}, see also the discussion after Definition \\ref{def_graph_product_of_spaces}. Suppose $L$ is the \\textquotedblleft lollipop\\textquotedblright, which is the union of a unit circle $S$ and a unit interval $I$ along one point. For each vertex $v$ in the vertex set $V({\\Gamma})$ of ${\\Gamma}$, we associate a copy of $L_{v}=S_v\\cup I_v$, and let $\\star_v\\in L_v$ be the free end of $I_v$. Let $T=\\prod_{v\\in V({\\Gamma})} L_v$. Each clique $\\Delta\\subset {\\Gamma}$ gives rise to a subcomplex $T_{\\Delta}=\\prod_{v\\in\\Delta} L_{v}\\times\\prod_{v\\notin\\Delta}\\{\\star_v\\}$. Then $S_e$ is the subcomplex of $T$ which is the union of all such $T_{\\Delta}$'s, here $\\Delta$ is allowed to be empty. It is easy to check $S_e$ is a non-positively curved cube complex. A \\textit{standard torus} in $S_e$ is a subcomplex of form $\\prod_{v\\in\\Delta} S_{v}\\times\\prod_{v\\notin\\Delta}\\{\\star_v\\}$, where $\\Delta\\subset{\\Gamma}$ is a clique. Note that there is a unique standard torus of dimension $0$, which corresponds to the empty clique. There is a natural map $S_e=S_e({\\Gamma})\\to S({\\Gamma})$ by collapsing the $I_v$-edge in each $L_v$-factor. This maps induces a 1-1 correspondence between standard tori in $S_e$ and standard tori in $S({\\Gamma})$. Notice that there is also a 1-1 correspondence between vertices in $S_e$ and standard tori in $S_e$.\n\nLet $X_e$ be the universal cover of $S_e$. Then $X_e$ is a $CAT(0)$ cube complex and the action $G{\\curvearrowright} X_e$ is geometric. The inverse images of standard tori in $S_e$ are called \\textit{standard flats}. Note that each vertex in $X_e$ is contained in a unique standard flat. We define a map between the 0-skeletons $p: X^{(0)}_e({\\Gamma})\\to |{\\mathcal{B}}|^{(0)}$ as follow. Pick a $G$-equivariant identification between $0$-dimensional standard flats in $X$ and elements in $G$, and pick a $G$-equivariant map $\\phi:X_e\\to X$ induced by $S_e=S_e({\\Gamma})\\to S({\\Gamma})$ described as above. Note that $c$ induces a 1-1 correspondence between standard flats in $X_e$ and standard flats in $X$. This gives rise to a 1-1 correspondence between standard flats in $X_e$ and left cosets of standard Abelian subgroups of $G$. For each $x\\in X^{(0)}_e({\\Gamma})$, we define $p(x)$ to be the vertex in $|{\\mathcal{B}}|^{(0)}$ that represents the left coset of the standard Abelian subgroup of $G$ which corresponds to the unique standard flat that contains $x$.\n\nA \\textit{vertical edge} of $X_e$ is an edge which covers some $S_v$-circle in $S_e$. A \\textit{horizontal edge} of $X_e$ is an edge which covers some $I_v$-interval in $S_e$. Two endpoints of every vertical edge are in the same standard flat, thus they are mapped by $p$ to the same point in $|{\\mathcal{B}}|^{(0)}$. More generally, for any given \\textit{vertical cube}, i.e. every edge in this cube is a vertical edge, its vertex set is mapped by $p$ to one point in $|{\\mathcal{B}}|^{(0)}$. Pick a horizontal edge and let $F_1,F_2\\subset X_e$ be standard flats which contain the two endpoints of this edge respectively. Then $\\phi(F_{1})$ and $\\phi(F_2)$ are two standard flats in $X$ such that one is contained as a codimension 1 flat inside another. More generally, if $\\sigma$ is a horizontal cube, i.e. each edge of $\\sigma$ is a horizontal edge, then by looking the image of $\\sigma$ under the covering map $X_e\\to S_e$, we know the vertex set of $\\sigma$ corresponds to an interval in the poset of standard flats of $X$. Every cube in $X_e$ splits as a product of a vertical cube and a horizontal cube (again this is clear by looking at cells in $S_e$). Thus we can extend $p$ to a cubical map $p:X_e\\to |{\\mathcal{B}}|$.\n\nBy construction, for a vertex $v\\in |{\\mathcal{B}}|$ of rank $k$, $p^{-1}(v)$ is isometric to ${\\mathbb E}^n$. It follows from Theorem~\\ref{thm_restriction_quotient_characterization} that $p$ arises from a restriction quotient, and this is called the \\textit{canonical restriction quotient} for the RAAG $G$. This restriction quotient is exactly the one described in Example~\\ref{the key example}, since hyperplanes in ${\\mathcal K}$ of Example~\\ref{the key example} are those which are dual to horizontal edges. We record following immediate consequence of the this construction.\n\\begin{lem}\n\\label{inverse image are flats}\nLet $\\sigma\\subset|{\\mathcal{B}}|$ be a cube and let $v\\in \\sigma$ be the vertex of minimal rank in $\\sigma$. Then for any interior point $x\\in \\sigma$, $p^{-1}(x)$ is isometric to ${\\mathbb E}^{rank(\\sigma)}$.\n\\end{lem}\n\n\\begin{remark}\n\\label{rem_charney_folding_map}\nIn the literature, there is a related cubical map $X\\to |{\\mathcal{B}}|$ defined as follows. First we recall an alternative description of $X$. Actually similar spaces can be defined for all Artin groups (not necessarily right-angled) and was introduced by Salvetti. We will follow the description in \\cite{charneyproblems}. Let $G\\to W({\\Gamma})$ be the natural projection map. This map has a set theoretic section defined by representing an element $w\\in W$ by a minimal length positive word with respect to the standard generating set and setting $\\sigma(w)$ to be the image of this word $G$. It follows from fundamental facts about Coxeter groups that $\\sigma$ is well-defined. Let $I$ be the vertex set of ${\\Gamma}$, and for any $J\\subset I$, let $W(J)$ be the subgroup of $W({\\Gamma})$ generated by $J$. Let $K$ be the geometric realization of the following poset:\n\\begin{center}\n$\\{g\\sigma(W(J))\\mid g\\in G, J\\subset I, W(J)$ is finite$\\}$.\n\\end{center}\nIt turns out that $K$ is isomorphic to the first barycentric subdivision of $X$. Let $G(J)\\le G$ be the subgroup generated by $J$. We associate each $g\\sigma(W(J))$ with the left coset $g G(J)$, and this induces a cubical map from the first cubical subdivision of $X$ to $|{\\mathcal{B}}|$. However, this map is not a restriction quotient, since it has a lot of foldings (think of the special case when $G\\cong{\\mathbb Z}$).\n\\end{remark}\n\n\\subsection{Restriction quotients with Euclidean fibers}\n\\label{subsection_Restriction quotients with Euclidean fibers}\nWe reminder the reader that in\nthis section,  $W=W({\\Gamma})$ will be the right-angled Coxeter group with defining graph ${\\Gamma}$ and standard generating set $I$. Let ${\\mathcal{B}}$ be an arbitrary right-angled building modelled on $W$. Let $\\mathsf{S}$ be the poset of spherical subsets of $I$ and let $|{\\mathcal{B}}|$ be the Davis realization of ${\\mathcal{B}}$.\n\nOur next goal is to generalize the canonical restriction quotient mentioned in the previous subsection. However, to motivate our construction, we will first consider a restriction quotient  $q:Y'\\to|{\\mathcal{B}}|$ which satisfies the conclusion of Lemma~\\ref{inverse image are flats}, and identify  several key features of $q$.  \n\nLet $\\Phi$ be the fiber functor associated with $q$ (see Section~\\ref{sec_restriction_maps_versus_fiber_functors}). For any vertices $v,w\\in |{\\mathcal{B}}|$, we will write $v\\le w$ if and only if the residue associated with $v$ is contained in the residue associated with $w$. \n\nLet ${\\mathsf{S}^r}$ be the poset of spherical residues in ${\\mathcal{B}}$. Then $\\Phi$ induces a functor $\\Phi'$ from ${\\mathsf{S}^r}$ to ${\\operatorname{CCC}}$ (Section~\\ref{sec_restriction_maps_versus_fiber_functors}) as follows. Each element in ${\\mathsf{S}^r}$ is associated with the fiber of the corresponding vertex in $|{\\mathcal{B}}|$. If $s,t\\in {\\mathsf{S}^r}$ are two elements such that $rank(t)=rank(s)+1$ and $s<t$, then the associated vertices in $v_s,v_t\\in|{\\mathcal{B}}|$ are joined by an edge $e_{st}$. In this case $\\Phi(e_{st})\\to\\Phi(v_s)$ is an isomorphism, so we define the morphism $\\Phi'(s)\\to\\Phi'(t)$ to be the map induced by $\\Phi(e_{st})\\to\\Phi(v_t)$. If $s,t\\in{\\mathsf{S}^r}$ are arbitrary two elements with $s\\le t$, then we find an ascending chain from $s$ to $t$ such that the difference between the ranks of adjacent elements in the chain is $1$, and define $\\Phi'(s)\\to\\Phi'(t)$ be the composition of those maps induced by the chain. It follows from the functor property of $\\Phi$ that $\\Phi'(s)\\to\\Phi'(t)$ does not depend on the choice of the chain, and $\\Phi'$ is a functor. Recall that there is a 1-1 correspondence between elements in ${\\mathsf{S}^r}$ and vertices of $|{\\mathcal{B}}|$, so we will also view $\\Phi'$ as a functor from the vertex set of $|{\\mathcal{B}}|$ to ${\\operatorname{CCC}}$. Let $\\sigma_1\\subset\\sigma_2$ be faces in $|{\\mathcal{B}}|$ and let $v_i$ be the vertex of minimal rank in $\\sigma_i$ for $i=1,2$. Then by our construction, then morphism $\\Phi(\\sigma_2)\\to\\Phi(\\sigma_1)$ is the same as $\\Phi'(v_2)\\to\\Phi'(v_1)$.\n\n\\begin{definition}[1-data]\n\\label{1-data}\nPick a vertex $v\\in|{\\mathcal{B}}|$ of rank 1, and let ${\\mathcal R}_v$ be the associated residue. Let $\\{v_\\lambda\\}_{\\lambda\\in\\Lambda}$ be the collection of vertices in $|{\\mathcal{B}}|$ which is $<v$ and let $e_{\\lambda}$ be the edge joining $v$ and $v_{\\lambda}$. Then there is a 1-1 correspondence between elements in ${\\mathcal R}_v$ and $v_{\\lambda}$'s. Each $v_{\\lambda}$ determines a point in $\\Phi(v)$ by consider the image of $\\Phi(e_{\\lambda})\\to\\Phi(v)$. This induced a map $f_{{\\mathcal R}_v}:{\\mathcal R}_v\\to \\Phi(v)$. The collection of all such $f_{{\\mathcal R}_v}$'s with $v$ ranging over all rank 1 vertices of $|{\\mathcal{B}}|$ is called the \\textit{1-data} associated with the restriction quotient $q:Y'\\to|{\\mathcal{B}}|$.\n\\end{definition}\n\n\n\\begin{lem}\n\\label{compactible with parallelism}\nPick two vertices $v,u\\in|{\\mathcal{B}}|$ of rank 1, and let ${\\mathcal R}_{v},{\\mathcal R}_{u}$ be the corresponding residues. Suppose these two residues are parallel with the parallelism map given by $p:{\\mathcal R}_{v}\\to{\\mathcal R}_{u}$. Then: \n\\begin{enumerate}\n\\item $\\Phi(v)$ and $\\Phi(u)$, considered as convex subcomplexes of $Y'$, are parallel.\n\\item If $p':\\Phi(v)\\to\\Phi(u)$ is the parallelism map, then the following diagram commutes:\n\\begin{center}\n$\\begin{CD}\n{\\mathcal R}_{v}        @>p>>        {\\mathcal R}_{u}  \\\\\n@Vf_{{\\mathcal R}_{v}}VV                                   @Vf_{{\\mathcal R}_{u}}VV\\\\\n\\Phi(v)                         @>p'>>       \\Phi(u) \n\\end{CD}$\n\\end{center}\n\\end{enumerate}\n\\end{lem}\n\n\\begin{proof}\nIt follows from Lemma~\\ref{parallel sets of residues} that there is a finite chain of residues, starting at ${\\mathcal R}_v$ and ending at ${\\mathcal R}_{u}$, such that adjacent elements in the chain are parallel residues in a spherical residue of rank 2. Thus we can assume without loss of generality that ${\\mathcal R}_v$ and ${\\mathcal R}_{u}$ are contained in the a spherical residue ${\\mathcal S}$ of type $J=\\{j,j'\\}$, and we assume both ${\\mathcal R}_v$ and ${\\mathcal R}_{u}$ are $j$-residues.\n\nPick $x\\in{\\mathcal R}_v$. By Theorem \\ref{product decomposition}, there is a $j'$-residue ${\\mathcal W}$ which contains both $x$ and $p(x)$. Let $s,w\\in|{\\mathcal{B}}|$ be the vertex corresponding to ${\\mathcal S}$ and ${\\mathcal W}$. Note that there is a 2-cube in $|{\\mathcal{B}}|$ such that $v,w,s$ are its vertices. Since $\\Phi$ is 1-determined, ${\\operatorname{Im}}(\\Phi'(v)\\to\\Phi'(s))$ and ${\\operatorname{Im}}(\\Phi'(w)\\to\\Phi'(s))$ are orthogonal lines in the 2-flat $\\Phi'(s)$. Moreover, the intersection these two lines is the image of $f_{{\\mathcal R}_v}(x)$ under the morphism $\\Phi'(v)\\to\\Phi'(s)$. Similarly, the images of $\\Phi'(u)\\to\\Phi'(s)$ and $\\Phi'(w)\\to\\Phi'(s)$ are orthogonal lines $\\Phi'(s)$, and their intersection is the image of $f_{{\\mathcal R}_u}(p(x))$ under $\\Phi'(v)\\to\\Phi'(s)$. It follows that ${\\operatorname{Im}}(\\Phi'(v)\\to\\Phi'(s))$ and ${\\operatorname{Im}}(\\Phi'(u)\\to\\Phi'(s))$ are parallel, hence $\\Phi(v)$ and $\\Phi(u)$, considered as convex subcomplexes of $Y'$, are parallel. Moreover, since image of $f_{{\\mathcal R}_v}(x)$ under $\\Phi'(v)\\to\\Phi'(s)$ and the image of $f_{{\\mathcal R}_u}(p(x))$ under $\\Phi'(v)\\to\\Phi'(s)$ are in the line ${\\operatorname{Im}}(\\Phi'(w)\\to\\Phi'(s))$, the diagram in (2) commutes.\n\\end{proof}\n\nPick a vertex $u\\in|{\\mathcal{B}}|$ of rank $=k$ and let ${\\mathcal R}_u$ be the corresponding $J$-residue with $J=\\cup_{i=1}^{k}j_i$. Then there is a map $f_{{\\mathcal R}_u}:{\\mathcal R}_u\\to \\Phi'({\\mathcal R}_u)=\\Phi(u)$ defined by considering $\\Phi'(x)\\to\\Phi'({\\mathcal R}_u)$ for each element $x\\in {\\mathcal R}_u$. This map coincides with the $f_{{\\mathcal R}_u}$ defined before when $u$ is rank 1. For $1\\le i\\le k$, let ${\\mathcal R}_i$ be a $j_i$-residue in ${\\mathcal R}_u$. Since $\\Phi$ is 1-determined, $\\{{\\operatorname{Im}}(\\Phi'({\\mathcal R}_i)\\to\\Phi'({\\mathcal R}_u))\\}_{i=1}^{k}$ are mutually orthogonal lines in $\\Phi'({\\mathcal R}_u)$. This induces an isomorphism \n\n", "itemtype": "equation", "pos": 92147, "prevtext": "\nis an $(L',A')$-quasi-natural isomorphism where $L'=L'(L,A,\\dim Y_i)$,\n$A'=A'(L,A,\\dim Y_i)$.\n\\end{lemma}\n\\begin{proof}\nBy Theorem \\ref{thm_restriction_quotient_characterization}, \nthe fiber $f_i^{-1}(b_{\\sigma})$ is a convex subset of $Y_i$, and\nhence is isometrically embedded.  Therefore $\\phi$ and $\\phi'$\ninduce  $(L,A)$-quasi-isometric\nembeddings $f_1^{-1}(b_{\\sigma})\\rightarrow f_2^{-1}(b_{\\sigma})$, \n$f_2^{-1}({\\sigma}_b)\\rightarrow f_1^{-1}(b_{\\sigma})$.  If ${\\sigma}\\subset\\tau$, then any\npoint $x\\in f_i^{-1}(b_\\tau)$ lies at distance $<C=C(\\dim Y_i)$\nfrom a point in $f_i^{-1}(b_{\\sigma})$, and this implies that \nthe collection of maps $\\{\\Psi_1({\\sigma})\\rightarrow \\Psi_2({\\sigma})\\}_{{\\sigma}\\in{\\operatorname{Face}}(Z)}$\nis an $(L',A')$-quasi-natural isomorphism as claimed.\n\\end{proof}\n\n\n\\begin{lemma}\n\\label{lem_quasiisomorphism_gives_quasiisometry}\nIf $\\{\\phi({\\sigma}):\\Psi_1({\\sigma})\\rightarrow \\Psi_2({\\sigma})\\}_{{\\sigma}\\in{\\operatorname{Face}}(Z)}$\nis an $(L,A)$-quasi-natural isomorphism from $\\Psi_1$ to $\\Psi_2$,\nthen it arises from a commutative diagram as in the previous lemma,\nwhere $\\phi$, $\\phi'$ are $(L',A')$-quasi-isometries that are $A'$-quasi-inverses,\nand $L',A'$ depend only on $L,A$, and $\\dim Y_i$.\n\\end{lemma}\n\\begin{proof}\nFor every ${\\sigma}\\in{\\operatorname{Face}}(Z)$, we may choose a quasi-inverse \n$\\phi'({\\sigma}):\\Psi_2({\\sigma})\\rightarrow \\Psi_1({\\sigma})$ with uniform constants;\nthis is also a quasi-natural isomorphism.\nIdentifying $f_i^{-1}({\\operatorname{Int}}({\\sigma}))$ with the product\n${\\operatorname{Int}}({\\sigma})\\times \\Psi_i({\\sigma})$, we define $\\phi{\\mbox{\\Large \\(|\\)\\normalsize}}_{f_1^{-1}({\\operatorname{Int}}({\\sigma}))}$ \nby\n\n", "index": 15, "text": "$$\nf_1^{-1}({\\operatorname{Int}}({\\sigma}))={\\operatorname{Int}}({\\sigma})\\times \\Psi_1({\\sigma})\n\\stackrel{{\\operatorname{id}}_{{\\operatorname{Int}}({\\sigma})}\\times \\phi({\\sigma})}{{\\longrightarrow}}\n{\\operatorname{Int}}({\\sigma})\\times \\Psi_2({\\sigma})=f_2^{-1}({\\sigma})\\,,\n$$\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex7.m1\" class=\"ltx_Math\" alttext=\"f_{1}^{-1}({\\operatorname{Int}}({\\sigma}))={\\operatorname{Int}}({\\sigma})%&#10;\\times\\Psi_{1}({\\sigma})\\stackrel{{\\operatorname{id}}_{{\\operatorname{Int}}({%&#10;\\sigma})}\\times\\phi({\\sigma})}{{\\longrightarrow}}{\\operatorname{Int}}({\\sigma}%&#10;)\\times\\Psi_{2}({\\sigma})=f_{2}^{-1}({\\sigma})\\,,\" display=\"block\"><mrow><mrow><mrow><msubsup><mi>f</mi><mn>1</mn><mrow><mo>-</mo><mn>1</mn></mrow></msubsup><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mrow><mo>Int</mo><mo>\u2061</mo><mrow><mo stretchy=\"false\">(</mo><mi>\u03c3</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mrow><mrow><mrow><mo>Int</mo><mo>\u2061</mo><mrow><mo stretchy=\"false\">(</mo><mi>\u03c3</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u00d7</mo><msub><mi mathvariant=\"normal\">\u03a8</mi><mn>1</mn></msub></mrow><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>\u03c3</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mover><mo movablelimits=\"false\">\u27f6</mo><mrow><mrow><msub><mo mathsize=\"142%\" stretchy=\"false\">id</mo><mrow><mo mathsize=\"140%\" stretchy=\"false\">Int</mo><mo>\u2061</mo><mrow><mo maxsize=\"140%\" minsize=\"140%\">(</mo><mi mathsize=\"140%\">\u03c3</mi><mo maxsize=\"140%\" minsize=\"140%\">)</mo></mrow></mrow></msub><mo mathsize=\"142%\" stretchy=\"false\">\u00d7</mo><mi mathsize=\"142%\">\u03d5</mi></mrow><mo>\u2062</mo><mrow><mo maxsize=\"142%\" minsize=\"142%\">(</mo><mi mathsize=\"142%\">\u03c3</mi><mo maxsize=\"142%\" minsize=\"142%\">)</mo></mrow></mrow></mover><mrow><mrow><mrow><mo>Int</mo><mo>\u2061</mo><mrow><mo stretchy=\"false\">(</mo><mi>\u03c3</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u00d7</mo><msub><mi mathvariant=\"normal\">\u03a8</mi><mn>2</mn></msub></mrow><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>\u03c3</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mrow><msubsup><mi>f</mi><mn>2</mn><mrow><mo>-</mo><mn>1</mn></mrow></msubsup><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>\u03c3</mi><mo rspace=\"4.2pt\" stretchy=\"false\">)</mo></mrow></mrow></mrow><mo>,</mo></mrow></math>", "type": "latex"}, {"file": "1601.00946.tex", "nexttext": "\nThe following is a consequence of (2) of Lemma \\ref{compactible with parallelism}.\n\n\\begin{cor}\n\\label{compactible with product}\nThe map $f_{{\\mathcal R}_u}$ satisfies $f_{{\\mathcal R}_u}=i\\circ(\\prod_{i=1}^{k}f_{{\\mathcal R}_i})\\circ g$, where $g:{\\mathcal R}_u\\to\\prod_{i=1}^{k}{\\mathcal R}_i$ is the map in Theorem \\ref{product decomposition}. In this case, we will write $f_{{\\mathcal R}_u}=\\prod_{i=1}^{k}f_{{\\mathcal R}_i}$ for simplicity.\n\\end{cor}\n\nPick $J'\\subset J$ and let ${\\mathcal R}_u'$ be a $J'$-residue in ${\\mathcal R}_u$. By Theorem~\\ref{product decomposition}, ${\\mathcal R}_u'=\\prod_{i\\in J'}{\\mathcal R}_i\\times\\prod_{i\\notin J'}\\{a_{i}\\}$ for $a_{i}\\in {\\mathcal R}_i$. Then the following is a consequence of Corollary \\ref{compactible with product} and the functorality of $\\Phi'$.\n\\begin{cor}\n\\label{morphism in terms of product}\nLet $h$ be the morphism between $\\Phi'({\\mathcal R}_{u'})$ and $\\Phi'({\\mathcal R}_u)=\\Phi'({\\mathcal R}_{u'})\\times\\prod_{i\\notin J'}\\Phi'({\\mathcal R}_i)$. Then for $x\\in \\Phi'({\\mathcal R}_{u'})$, we have $h(x)=\\{x\\}\\times \\prod_{i\\notin J'}\\{f_{{\\mathcal R}_i}(a_{i})\\}$.\n\\end{cor}\n\n\\subsection{Construction of the ${\\mathbb Z}$-blow-up}\n\\label{subsection_input for Z-blow-up}\n\nIn the previous section, we started from a restriction quotient $q:Y'\\to|{\\mathcal{B}}|$, and produced associated 1-data (Definition~\\ref{1-data}), which is compatible with parallelism in the sense of Lemma~\\ref{compactible with parallelism}. In this section, we will consider the inverse, namely we want construct a restriction quotient from this data. \n\nLet $\\Lambda_{{\\mathcal{B}}}$ be the collection of parallel sets of $i$-residues in ${\\mathcal{B}}$ ($i$ could be any element in $I$). There is another type map $T$ which maps a spherical $J$-residue ${\\mathcal R}$ to $\\{\\lambda\\in\\Lambda_{{\\mathcal{B}}}\\mid$ $\\lambda$ contains a representative in ${\\mathcal R}\\}$. In other words, let ${\\mathcal R}\\cong\\prod_{i\\in I}{\\mathcal R}_i$ be the product decomposition as in Theorem \\ref{product decomposition}, where each ${\\mathcal R}_i$ is an $i$-residue in ${\\mathcal R}$ ($i\\in J$). Then $T({\\mathcal R})$ is the collection of parallel sets represented by those ${\\mathcal R}_i$'s. Let ${\\mathbb Z}^{T({\\mathcal R})}$ be the collection of maps from $T({\\mathcal R})$ to ${\\mathbb Z}$, and let ${\\mathbb Z}^{\\emptyset}$ be a single point. \n\n\n\nOur goal in this section is to construct a restriction quotient from the following data.\n\\begin{definition}[Blow-up data]\n\\label{input data}\nFor each $i$-residue ${\\mathcal R}\\subset{\\mathcal{B}}$, we associate a map $h_{{\\mathcal R}}:{\\mathcal R}\\to{\\mathbb Z}^{T({\\mathcal R})}$ such that if two $i$-residues ${\\mathcal R}_1$ and ${\\mathcal R}_2$ are parallel, let $h_{12}:{\\mathcal R}_1\\to{\\mathcal R}_2$ be the parallelism map, then $h_{{\\mathcal R}_1}=h_{{\\mathcal R}_2}\\circ h_{12}$. \n\\end{definition}\n\nIf ${\\mathcal R}$ is a spherical residue with  product decomposition given by ${\\mathcal R}\\cong\\prod_{i\\in I}{\\mathcal R}_i$, then the maps $h_{{\\mathcal R}_{i}}:{\\mathcal R}_{i}\\to{\\mathbb Z}$ induces a map $h_{{\\mathcal R}}:{\\mathcal R}\\to {\\mathbb Z}^{T({\\mathcal R})}$. It follows from the definition of $h_{{\\mathcal R}}$, and the discussion after Definition \\ref{definition_parallel} that if ${\\mathcal R},{\\mathcal R}'\\in C$ are parallel and let $h:{\\mathcal R}\\to{\\mathcal R}'$ be the parallelism map, then $h_{{\\mathcal R}}=h_{{\\mathcal R}'}\\circ h$.\n\nThe following result is a consequence of Theorem \\ref{product decomposition}:\n\n\\begin{lem}\nLet ${\\mathcal T}\\in C$ be an $H$-residue. Let $g:{\\mathcal T}\\cong\\prod_{i=1}^{n}{\\mathcal T}_i$ be the product decomposition induced by $H=\\sqcup_{i=1}^{n}H_i$ (see Theorem \\ref{product decomposition}). Then $h_{{\\mathcal T}}=(\\prod_{i=1}^{n}h_{{\\mathcal T}_i})\\circ g$.\n\\end{lem}\n\nTo simplify notation, we will write $h_{{\\mathcal T}}=\\prod_{i=1}^{n}h_{{\\mathcal T}_i}$ instead of $h_{{\\mathcal T}}=(\\prod_{i=1}^{n}h_{{\\mathcal T}_i})\\circ g$.\n\nLet $J$ and ${\\mathcal R}=\\prod_{i\\in J}{\\mathcal R}_i$ be as before. A $J'$-residue ${\\mathcal R}'\\subset{\\mathcal R}$ can be expressed as $(\\prod_{i\\in J'}{\\mathcal R}_i)\\times(\\prod_{i\\in J\\setminus J'}\\{c_i\\})$, here $c_i$ is a chamber in ${\\mathcal R}_i$. We define an inclusion $h_{{\\mathcal R}'{\\mathcal R}}:{\\mathbb Z}^{T({\\mathcal R}')}\\rightarrow{\\mathbb Z}^{T({\\mathcal R})}$ by $h_{{\\mathcal R}'{\\mathcal R}}(a)=\\{a\\}\\times \\prod_{i\\in J\\setminus J'}\\{h_{{\\mathcal R}_i}(c_i)\\}$. Since $h_{{\\mathcal R}}=h_{{\\mathcal R}'}\\times(\\prod_{i\\in J\\setminus J'}h_{{\\mathcal R}_i})$, $h_{{\\mathcal R}'{\\mathcal R}}$ fits into the following commutative diagram:\n\\begin{center}\n$\\begin{CD}\n{\\mathcal R}'                         @>>>       {\\mathcal R}\\\\\n@Vh_{{\\mathcal R}'}VV                                   @Vh_{{\\mathcal R}}VV\\\\\n{\\mathbb Z}^{T({\\mathcal R}')}        @>h_{{\\mathcal R}'{\\mathcal R}}>>        {\\mathbb Z}^{T({\\mathcal R})}\n\\end{CD}$\n\\end{center}\nSuppose ${\\mathcal R}''$ is a $J''$-residue such that ${\\mathcal R}''\\subset{\\mathcal R}'\\subset{\\mathcal R}$. Since $h_{{\\mathcal R}}=h_{{\\mathcal R}'}\\times(\\prod_{i\\in J\\setminus J'}h_{{\\mathcal R}_i})=h_{{\\mathcal R}''}\\times (\\prod_{i\\in J'\\setminus J''}h_{{\\mathcal R}_i})\\times (\\prod_{i\\in J\\setminus J'}h_{{\\mathcal R}_i})$, we have\n\n", "itemtype": "equation", "pos": 108177, "prevtext": "\nand $\\phi'$ similarly using $\\{\\phi'({\\sigma})\\}_{{\\sigma}\\in{\\operatorname{Face}}(Z)}$.\nOne readily checks that $\\phi$, $\\phi'$ are quasi-isometric embeddings\nthat are also quasi-inverses, where the constants depend on $L, A$, and\n$\\dim Y_i$.\n\\end{proof}\n\n\\section{The ${\\mathbb Z}$-blow-up of right-angled Building}\n\\label{sec_blow-up of building}\nIn this section ${\\Gamma}$ will be an arbitrary finite simplicial graph, and\nall buildings will be right-angled buildings modelled on the right-angled Coxeter group $W({\\Gamma})$ with defining graph ${\\Gamma}$.   The reader may wish to review Section \n\\ref{building} for terminology and notation regarding buildings, before proceeding. \n\n\nThe goal of this section is examine restriction quotients\n$q:Y\\rightarrow |{\\mathcal{B}}|$, where the fibers are Euclidean spaces satisfying a\ndimension condition as in Theorem \\ref{thm_main_intro_quasi_action}\nor \\ref{thm_main_intro}.  For such restriction quotients, the fiber functor\nmay be distilled down to $1$-data, see Definition \\ref{1-data}; this is discussed in \nSubsection \\ref{subsection_Restriction quotients with Euclidean fibers}.\nConversely, given a building ${\\mathcal{B}}$ and certain blow-up data (Definition\n\\ref{input data}), one can construct a corresponding $1$-determined\nfiber functor as in Section \\ref{sec_restriction_maps_versus_fiber_functors};\nsee Subsection \\ref{subsection_input for Z-blow-up}.  \n\n\n\n\n\\subsection{The canonical restriction quotient for a RAAG}\n\\label{subsection_canonical restriction quotient}\nLet $G(\\Gamma)$ be the RAAG with defining graph ${\\Gamma}$ and let ${\\mathcal{B}}({\\Gamma})$ be the building associated with $G({\\Gamma})$  (see \\cite[Section 5]{davis_buildings_are_cat0}). Then $G(\\Gamma)$ can identified with the set of chambers of ${\\mathcal{B}}({\\Gamma})$. Under this identification, the $J$-residues of ${\\mathcal{B}}$, for $J$ a collection of vertices in ${\\Gamma}$, are the left cosets of the standard subgroups of $G(\\Gamma)$ generated by $J$. Thus the poset of spherical residues is exactly the poset of left cosets of standard Abelian subgroups of $G(\\Gamma)$, which is also isomorphic to the poset of standard flats in $X({\\Gamma})$.\n\n\nWe now revisit \nthe discussion after Definition \\ref{def_graph_product_of_spaces} and Example \\ref{the key example} in more detail, and relate them to buildings. To simplify notation, we will write $G=G({\\Gamma})$, ${\\mathcal{B}}={\\mathcal{B}}({\\Gamma})$ and $X=X({\\Gamma})$.\n\nLet $|{\\mathcal{B}}|$ be the Davis realization of the building ${\\mathcal{B}}$.  Then we have an induced isometric action $G {\\curvearrowright} |{\\mathcal{B}}|$, which is cocompact, but not proper. It turns out there is natural way to blow-up $|{\\mathcal{B}}|$ to obtain a space $X_e=X_{e}({\\Gamma})$ such that there is a geometric action $G {\\curvearrowright} X_{e}$ and a $G$-equivariant restriction quotient map $X_{e}\\to |{\\mathcal{B}}|$.\n\n$X_e$ can be constructed as follows. First we constructed the \\textit{exploded Salvetti complex} $S_e=S_{e}({\\Gamma})$, which was introduced in \\cite{bks2}, see also the discussion after Definition \\ref{def_graph_product_of_spaces}. Suppose $L$ is the \\textquotedblleft lollipop\\textquotedblright, which is the union of a unit circle $S$ and a unit interval $I$ along one point. For each vertex $v$ in the vertex set $V({\\Gamma})$ of ${\\Gamma}$, we associate a copy of $L_{v}=S_v\\cup I_v$, and let $\\star_v\\in L_v$ be the free end of $I_v$. Let $T=\\prod_{v\\in V({\\Gamma})} L_v$. Each clique $\\Delta\\subset {\\Gamma}$ gives rise to a subcomplex $T_{\\Delta}=\\prod_{v\\in\\Delta} L_{v}\\times\\prod_{v\\notin\\Delta}\\{\\star_v\\}$. Then $S_e$ is the subcomplex of $T$ which is the union of all such $T_{\\Delta}$'s, here $\\Delta$ is allowed to be empty. It is easy to check $S_e$ is a non-positively curved cube complex. A \\textit{standard torus} in $S_e$ is a subcomplex of form $\\prod_{v\\in\\Delta} S_{v}\\times\\prod_{v\\notin\\Delta}\\{\\star_v\\}$, where $\\Delta\\subset{\\Gamma}$ is a clique. Note that there is a unique standard torus of dimension $0$, which corresponds to the empty clique. There is a natural map $S_e=S_e({\\Gamma})\\to S({\\Gamma})$ by collapsing the $I_v$-edge in each $L_v$-factor. This maps induces a 1-1 correspondence between standard tori in $S_e$ and standard tori in $S({\\Gamma})$. Notice that there is also a 1-1 correspondence between vertices in $S_e$ and standard tori in $S_e$.\n\nLet $X_e$ be the universal cover of $S_e$. Then $X_e$ is a $CAT(0)$ cube complex and the action $G{\\curvearrowright} X_e$ is geometric. The inverse images of standard tori in $S_e$ are called \\textit{standard flats}. Note that each vertex in $X_e$ is contained in a unique standard flat. We define a map between the 0-skeletons $p: X^{(0)}_e({\\Gamma})\\to |{\\mathcal{B}}|^{(0)}$ as follow. Pick a $G$-equivariant identification between $0$-dimensional standard flats in $X$ and elements in $G$, and pick a $G$-equivariant map $\\phi:X_e\\to X$ induced by $S_e=S_e({\\Gamma})\\to S({\\Gamma})$ described as above. Note that $c$ induces a 1-1 correspondence between standard flats in $X_e$ and standard flats in $X$. This gives rise to a 1-1 correspondence between standard flats in $X_e$ and left cosets of standard Abelian subgroups of $G$. For each $x\\in X^{(0)}_e({\\Gamma})$, we define $p(x)$ to be the vertex in $|{\\mathcal{B}}|^{(0)}$ that represents the left coset of the standard Abelian subgroup of $G$ which corresponds to the unique standard flat that contains $x$.\n\nA \\textit{vertical edge} of $X_e$ is an edge which covers some $S_v$-circle in $S_e$. A \\textit{horizontal edge} of $X_e$ is an edge which covers some $I_v$-interval in $S_e$. Two endpoints of every vertical edge are in the same standard flat, thus they are mapped by $p$ to the same point in $|{\\mathcal{B}}|^{(0)}$. More generally, for any given \\textit{vertical cube}, i.e. every edge in this cube is a vertical edge, its vertex set is mapped by $p$ to one point in $|{\\mathcal{B}}|^{(0)}$. Pick a horizontal edge and let $F_1,F_2\\subset X_e$ be standard flats which contain the two endpoints of this edge respectively. Then $\\phi(F_{1})$ and $\\phi(F_2)$ are two standard flats in $X$ such that one is contained as a codimension 1 flat inside another. More generally, if $\\sigma$ is a horizontal cube, i.e. each edge of $\\sigma$ is a horizontal edge, then by looking the image of $\\sigma$ under the covering map $X_e\\to S_e$, we know the vertex set of $\\sigma$ corresponds to an interval in the poset of standard flats of $X$. Every cube in $X_e$ splits as a product of a vertical cube and a horizontal cube (again this is clear by looking at cells in $S_e$). Thus we can extend $p$ to a cubical map $p:X_e\\to |{\\mathcal{B}}|$.\n\nBy construction, for a vertex $v\\in |{\\mathcal{B}}|$ of rank $k$, $p^{-1}(v)$ is isometric to ${\\mathbb E}^n$. It follows from Theorem~\\ref{thm_restriction_quotient_characterization} that $p$ arises from a restriction quotient, and this is called the \\textit{canonical restriction quotient} for the RAAG $G$. This restriction quotient is exactly the one described in Example~\\ref{the key example}, since hyperplanes in ${\\mathcal K}$ of Example~\\ref{the key example} are those which are dual to horizontal edges. We record following immediate consequence of the this construction.\n\\begin{lem}\n\\label{inverse image are flats}\nLet $\\sigma\\subset|{\\mathcal{B}}|$ be a cube and let $v\\in \\sigma$ be the vertex of minimal rank in $\\sigma$. Then for any interior point $x\\in \\sigma$, $p^{-1}(x)$ is isometric to ${\\mathbb E}^{rank(\\sigma)}$.\n\\end{lem}\n\n\\begin{remark}\n\\label{rem_charney_folding_map}\nIn the literature, there is a related cubical map $X\\to |{\\mathcal{B}}|$ defined as follows. First we recall an alternative description of $X$. Actually similar spaces can be defined for all Artin groups (not necessarily right-angled) and was introduced by Salvetti. We will follow the description in \\cite{charneyproblems}. Let $G\\to W({\\Gamma})$ be the natural projection map. This map has a set theoretic section defined by representing an element $w\\in W$ by a minimal length positive word with respect to the standard generating set and setting $\\sigma(w)$ to be the image of this word $G$. It follows from fundamental facts about Coxeter groups that $\\sigma$ is well-defined. Let $I$ be the vertex set of ${\\Gamma}$, and for any $J\\subset I$, let $W(J)$ be the subgroup of $W({\\Gamma})$ generated by $J$. Let $K$ be the geometric realization of the following poset:\n\\begin{center}\n$\\{g\\sigma(W(J))\\mid g\\in G, J\\subset I, W(J)$ is finite$\\}$.\n\\end{center}\nIt turns out that $K$ is isomorphic to the first barycentric subdivision of $X$. Let $G(J)\\le G$ be the subgroup generated by $J$. We associate each $g\\sigma(W(J))$ with the left coset $g G(J)$, and this induces a cubical map from the first cubical subdivision of $X$ to $|{\\mathcal{B}}|$. However, this map is not a restriction quotient, since it has a lot of foldings (think of the special case when $G\\cong{\\mathbb Z}$).\n\\end{remark}\n\n\\subsection{Restriction quotients with Euclidean fibers}\n\\label{subsection_Restriction quotients with Euclidean fibers}\nWe reminder the reader that in\nthis section,  $W=W({\\Gamma})$ will be the right-angled Coxeter group with defining graph ${\\Gamma}$ and standard generating set $I$. Let ${\\mathcal{B}}$ be an arbitrary right-angled building modelled on $W$. Let $\\mathsf{S}$ be the poset of spherical subsets of $I$ and let $|{\\mathcal{B}}|$ be the Davis realization of ${\\mathcal{B}}$.\n\nOur next goal is to generalize the canonical restriction quotient mentioned in the previous subsection. However, to motivate our construction, we will first consider a restriction quotient  $q:Y'\\to|{\\mathcal{B}}|$ which satisfies the conclusion of Lemma~\\ref{inverse image are flats}, and identify  several key features of $q$.  \n\nLet $\\Phi$ be the fiber functor associated with $q$ (see Section~\\ref{sec_restriction_maps_versus_fiber_functors}). For any vertices $v,w\\in |{\\mathcal{B}}|$, we will write $v\\le w$ if and only if the residue associated with $v$ is contained in the residue associated with $w$. \n\nLet ${\\mathsf{S}^r}$ be the poset of spherical residues in ${\\mathcal{B}}$. Then $\\Phi$ induces a functor $\\Phi'$ from ${\\mathsf{S}^r}$ to ${\\operatorname{CCC}}$ (Section~\\ref{sec_restriction_maps_versus_fiber_functors}) as follows. Each element in ${\\mathsf{S}^r}$ is associated with the fiber of the corresponding vertex in $|{\\mathcal{B}}|$. If $s,t\\in {\\mathsf{S}^r}$ are two elements such that $rank(t)=rank(s)+1$ and $s<t$, then the associated vertices in $v_s,v_t\\in|{\\mathcal{B}}|$ are joined by an edge $e_{st}$. In this case $\\Phi(e_{st})\\to\\Phi(v_s)$ is an isomorphism, so we define the morphism $\\Phi'(s)\\to\\Phi'(t)$ to be the map induced by $\\Phi(e_{st})\\to\\Phi(v_t)$. If $s,t\\in{\\mathsf{S}^r}$ are arbitrary two elements with $s\\le t$, then we find an ascending chain from $s$ to $t$ such that the difference between the ranks of adjacent elements in the chain is $1$, and define $\\Phi'(s)\\to\\Phi'(t)$ be the composition of those maps induced by the chain. It follows from the functor property of $\\Phi$ that $\\Phi'(s)\\to\\Phi'(t)$ does not depend on the choice of the chain, and $\\Phi'$ is a functor. Recall that there is a 1-1 correspondence between elements in ${\\mathsf{S}^r}$ and vertices of $|{\\mathcal{B}}|$, so we will also view $\\Phi'$ as a functor from the vertex set of $|{\\mathcal{B}}|$ to ${\\operatorname{CCC}}$. Let $\\sigma_1\\subset\\sigma_2$ be faces in $|{\\mathcal{B}}|$ and let $v_i$ be the vertex of minimal rank in $\\sigma_i$ for $i=1,2$. Then by our construction, then morphism $\\Phi(\\sigma_2)\\to\\Phi(\\sigma_1)$ is the same as $\\Phi'(v_2)\\to\\Phi'(v_1)$.\n\n\\begin{definition}[1-data]\n\\label{1-data}\nPick a vertex $v\\in|{\\mathcal{B}}|$ of rank 1, and let ${\\mathcal R}_v$ be the associated residue. Let $\\{v_\\lambda\\}_{\\lambda\\in\\Lambda}$ be the collection of vertices in $|{\\mathcal{B}}|$ which is $<v$ and let $e_{\\lambda}$ be the edge joining $v$ and $v_{\\lambda}$. Then there is a 1-1 correspondence between elements in ${\\mathcal R}_v$ and $v_{\\lambda}$'s. Each $v_{\\lambda}$ determines a point in $\\Phi(v)$ by consider the image of $\\Phi(e_{\\lambda})\\to\\Phi(v)$. This induced a map $f_{{\\mathcal R}_v}:{\\mathcal R}_v\\to \\Phi(v)$. The collection of all such $f_{{\\mathcal R}_v}$'s with $v$ ranging over all rank 1 vertices of $|{\\mathcal{B}}|$ is called the \\textit{1-data} associated with the restriction quotient $q:Y'\\to|{\\mathcal{B}}|$.\n\\end{definition}\n\n\n\\begin{lem}\n\\label{compactible with parallelism}\nPick two vertices $v,u\\in|{\\mathcal{B}}|$ of rank 1, and let ${\\mathcal R}_{v},{\\mathcal R}_{u}$ be the corresponding residues. Suppose these two residues are parallel with the parallelism map given by $p:{\\mathcal R}_{v}\\to{\\mathcal R}_{u}$. Then: \n\\begin{enumerate}\n\\item $\\Phi(v)$ and $\\Phi(u)$, considered as convex subcomplexes of $Y'$, are parallel.\n\\item If $p':\\Phi(v)\\to\\Phi(u)$ is the parallelism map, then the following diagram commutes:\n\\begin{center}\n$\\begin{CD}\n{\\mathcal R}_{v}        @>p>>        {\\mathcal R}_{u}  \\\\\n@Vf_{{\\mathcal R}_{v}}VV                                   @Vf_{{\\mathcal R}_{u}}VV\\\\\n\\Phi(v)                         @>p'>>       \\Phi(u) \n\\end{CD}$\n\\end{center}\n\\end{enumerate}\n\\end{lem}\n\n\\begin{proof}\nIt follows from Lemma~\\ref{parallel sets of residues} that there is a finite chain of residues, starting at ${\\mathcal R}_v$ and ending at ${\\mathcal R}_{u}$, such that adjacent elements in the chain are parallel residues in a spherical residue of rank 2. Thus we can assume without loss of generality that ${\\mathcal R}_v$ and ${\\mathcal R}_{u}$ are contained in the a spherical residue ${\\mathcal S}$ of type $J=\\{j,j'\\}$, and we assume both ${\\mathcal R}_v$ and ${\\mathcal R}_{u}$ are $j$-residues.\n\nPick $x\\in{\\mathcal R}_v$. By Theorem \\ref{product decomposition}, there is a $j'$-residue ${\\mathcal W}$ which contains both $x$ and $p(x)$. Let $s,w\\in|{\\mathcal{B}}|$ be the vertex corresponding to ${\\mathcal S}$ and ${\\mathcal W}$. Note that there is a 2-cube in $|{\\mathcal{B}}|$ such that $v,w,s$ are its vertices. Since $\\Phi$ is 1-determined, ${\\operatorname{Im}}(\\Phi'(v)\\to\\Phi'(s))$ and ${\\operatorname{Im}}(\\Phi'(w)\\to\\Phi'(s))$ are orthogonal lines in the 2-flat $\\Phi'(s)$. Moreover, the intersection these two lines is the image of $f_{{\\mathcal R}_v}(x)$ under the morphism $\\Phi'(v)\\to\\Phi'(s)$. Similarly, the images of $\\Phi'(u)\\to\\Phi'(s)$ and $\\Phi'(w)\\to\\Phi'(s)$ are orthogonal lines $\\Phi'(s)$, and their intersection is the image of $f_{{\\mathcal R}_u}(p(x))$ under $\\Phi'(v)\\to\\Phi'(s)$. It follows that ${\\operatorname{Im}}(\\Phi'(v)\\to\\Phi'(s))$ and ${\\operatorname{Im}}(\\Phi'(u)\\to\\Phi'(s))$ are parallel, hence $\\Phi(v)$ and $\\Phi(u)$, considered as convex subcomplexes of $Y'$, are parallel. Moreover, since image of $f_{{\\mathcal R}_v}(x)$ under $\\Phi'(v)\\to\\Phi'(s)$ and the image of $f_{{\\mathcal R}_u}(p(x))$ under $\\Phi'(v)\\to\\Phi'(s)$ are in the line ${\\operatorname{Im}}(\\Phi'(w)\\to\\Phi'(s))$, the diagram in (2) commutes.\n\\end{proof}\n\nPick a vertex $u\\in|{\\mathcal{B}}|$ of rank $=k$ and let ${\\mathcal R}_u$ be the corresponding $J$-residue with $J=\\cup_{i=1}^{k}j_i$. Then there is a map $f_{{\\mathcal R}_u}:{\\mathcal R}_u\\to \\Phi'({\\mathcal R}_u)=\\Phi(u)$ defined by considering $\\Phi'(x)\\to\\Phi'({\\mathcal R}_u)$ for each element $x\\in {\\mathcal R}_u$. This map coincides with the $f_{{\\mathcal R}_u}$ defined before when $u$ is rank 1. For $1\\le i\\le k$, let ${\\mathcal R}_i$ be a $j_i$-residue in ${\\mathcal R}_u$. Since $\\Phi$ is 1-determined, $\\{{\\operatorname{Im}}(\\Phi'({\\mathcal R}_i)\\to\\Phi'({\\mathcal R}_u))\\}_{i=1}^{k}$ are mutually orthogonal lines in $\\Phi'({\\mathcal R}_u)$. This induces an isomorphism \n\n", "index": 17, "text": "\\begin{equation}\n\\label{functor product decomposition}\ni:\\prod_{i=1}^{k}\\Phi'({\\mathcal R}_i)\\to \\Phi'({\\mathcal R}_u).\n\\end{equation}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E2.m1\" class=\"ltx_Math\" alttext=\"i:\\prod_{i=1}^{k}\\Phi^{\\prime}({\\mathcal{R}}_{i})\\to\\Phi^{\\prime}({\\mathcal{R}%&#10;}_{u}).\" display=\"block\"><mrow><mrow><mi>i</mi><mo>:</mo><mrow><mrow><munderover><mo largeop=\"true\" movablelimits=\"false\" symmetric=\"true\">\u220f</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>k</mi></munderover><mrow><msup><mi mathvariant=\"normal\">\u03a6</mi><mo>\u2032</mo></msup><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi class=\"ltx_font_mathcaligraphic\">\u211b</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo></mrow></mrow></mrow><mo>\u2192</mo><mrow><msup><mi mathvariant=\"normal\">\u03a6</mi><mo>\u2032</mo></msup><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi class=\"ltx_font_mathcaligraphic\">\u211b</mi><mi>u</mi></msub><mo stretchy=\"false\">)</mo></mrow></mrow></mrow></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.00946.tex", "nexttext": "\n\nNow we define a contravariant functor $\\Psi:{\\operatorname{Face}}(|{\\mathcal{B}}|)\\rightarrow {\\operatorname{CCC}}$ as follows. Let $f$ be a face of $|{\\mathcal{B}}|$ and let $v_f\\in f$ be unique vertex which has minimal rank among the vertices of $f$. Let ${\\mathcal R}_f\\subset{\\mathcal{B}}$ be the residue associated with $v_f$. We define $\\Psi(f)={\\mathbb R}^{T({\\mathcal R}_f)}$ (${\\mathbb R}^{\\emptyset}$ is a single point), here ${\\mathbb R}^{T({\\mathcal R}_f)}$ is endowed with the standard cubical structure and we identify ${\\mathbb Z}^{T({\\mathcal R}_f)}$ with the $0$-skeleton of ${\\mathbb R}^{T({\\mathcal R}_f)}$. \n\nAn inclusion of faces $f\\rightarrow f'$ induces an inclusion ${\\mathcal R}_{f'}\\rightarrow{\\mathcal R}_{f}$. We define the morphism $\\Psi(f')\\rightarrow\\Psi(f)$ to be the embedding induce by $h_{{\\mathcal R}_{f'}{\\mathcal R}_f}:{\\mathbb Z}^{T({\\mathcal R}_{f'})}\\rightarrow{\\mathbb Z}^{T({\\mathcal R}_{f})}$. \n\n\\begin{lem}\n$\\Psi$ is contravariant functor.\n\\end{lem}\n\n\\begin{proof}\nIt is easy to check that passing from an inclusion of faces $f\\rightarrow f'$ to ${\\mathcal R}_{f'}\\rightarrow{\\mathcal R}_{f}$ is a functor. And it follows from (\\ref{composition}) that passing from ${\\mathcal R}_{f'}\\rightarrow{\\mathcal R}_{f}$ to $h_{{\\mathcal R}_{f'}{\\mathcal R}_f}:{\\mathbb Z}^{T({\\mathcal R}_{f'})}\\rightarrow{\\mathbb Z}^{T({\\mathcal R}_{f})}$ is a functor.\n\\end{proof}\n\n\\begin{lem}\n$\\Psi$ is 1-determined.\n\\end{lem}\n\n\\begin{proof}\nLet $\\sigma\\subset|{\\mathcal{B}}|$ be a face and pick a vertex $v\\in\\sigma$. Let $\\{v_{i}\\}_{i=1}^{k}$ be the vertices in $\\sigma$ that are adjacent to $v$ along an edge $e_i$. Let $\\sigma_{\\le v}$ be the sub-cube of $\\sigma$ that is spanned by $e_{i}$'s such that $v_{i}\\ge v$. We define $\\sigma_{>v}$ similarly ($\\sigma_{>v}$ could be empty). Then $\\sigma=\\sigma_{\\le v}\\times\\sigma_{>v}$. Moreover, $v$ is the maximal vertex in $\\sigma_{\\le v}$ and the minimum vertex in $\\sigma_{>v}$. Note that $\\Psi(e_{i})\\to\\Psi(v)$ is an isometry if $v_{i}>v$. Thus it suffices to consider the case where $v$ is the maximal vertex of $\\sigma$.\n\nLet $v_{m}$ be the minimal vertex of $\\sigma$. Note that ${\\operatorname{Im}}(\\Psi({\\sigma})\\to \\Psi(v))\\subset\\cap^{k}_{i=1}{\\operatorname{Im}}(\\Psi(e)\\to \\Psi(v))$ is a cubical convex embedding of Euclidean subspaces, it suffices to show they have the same dimension. Let ${\\mathcal R}(v)\\subset C$ be the residue corresponding to the vertex $v$. Note that $T({\\mathcal R}(v_m))=\\cap_{i=1}^{k}T({\\mathcal R}(v_i))$ ($T$ is the type map defined on the beginning of Section \\ref{subsection_input for Z-blow-up}). Thus the dimension of $\\cap^{k}_{i=1}{\\operatorname{Im}}(\\Psi(e)\\to \\Psi(v))$ equals to the cardinality of $T({\\mathcal R}(v_m))$, which is the dimension of ${\\operatorname{Im}}(\\Psi({\\sigma})\\to \\Psi(v))$.\n\\end{proof}\n\n$\\Psi$ is called the \\textit{fiber functor associated with the blow-up data $\\{h_{{\\mathcal R}}\\}$}, and the restriction quotient $q:Y\\to|{\\mathcal{B}}|$ which arises from the fiber functor $\\Psi$ (see Theorem~\\ref{thm_fiber_functor_gives_restriction_quotient}) is called the \\textit{restriction quotient associated with the blow-up data $\\{h_{{\\mathcal R}}\\}$}. It is clear from the construction that the $1$-data of $q$ (Definition \\ref{1-data}) is the blow-up data $\\{h_{{\\mathcal R}}\\}$ (we naturally identify ${\\mathbb Z}^{T({\\mathcal R})}$'s in the blow-up data with the 0-skeleton of the $q$-fibers of rank 1 vertices in $|{\\mathcal{B}}|$). We summarize the above discussion in the following theorem.\n\n\\begin{thm}\nGiven the blow-up data $\\{h_{{\\mathcal R}}\\}$ as in Definition \\ref{input data}, there exists a restriction quotient $q:Y\\to|{\\mathcal{B}}|$ whose 1-data is the blow-up data we start with.\n\\end{thm}\n\n\\begin{remark}\nHere we blow up the building ${\\mathcal{B}}$ with respect to a collection of ${\\mathbb Z}$'s since we want to apply the construction for RAAG's. However, in other cases, it may be natural to blow up with respect to other objects. Here is a variation. For each parallel class of rank 1 residues $\\lambda\\in\\Lambda_{{\\mathcal{B}}}$, we associate a $CAT(0)$ cube complex $Z_{\\lambda}$. For each rank 1 residue ${\\mathcal R}$ in the class $\\lambda$, we define a map $h_{{\\mathcal R}}$ which assigns each element of ${\\mathcal R}$ a convex subcomplex of $Z_{\\lambda}$. We require these $\\{h_{{\\mathcal R}}\\}$ to be compatible with parallelism between rank 1 residues. Given this set of blow-up data, we can repeat the previous construction to obtain a restriction quotient over $|{\\mathcal{B}}|$. It is also possible to blow-up buildings with respect to spaces more general than $CAT(0)$ cube complexes. We give a slightly different approach in Section \\ref{sec_blow-up building more general version}.\n\\end{remark}\n\nNow we show that the construction in this section is indeed a converse to Section~\\ref{subsection_Restriction quotients with Euclidean fibers} in the following sense. Let $q:Y'\\to|{\\mathcal{B}}|$ be a restriction quotient as in Section \\ref{subsection_Restriction quotients with Euclidean fibers} and let $\\Phi$ and $\\Phi'$ be the functors introduced there. For each vertex $v\\in|{\\mathcal{B}}|$ of rank 1 and its associated residue ${\\mathcal R}_v$, we pick an isometric embedding $\\eta_v:{\\mathbb Z}^{T({\\mathcal R}_v)}\\to \\Phi(v)$ such that its image is vertex set of $\\Phi(v)$. We also require these $\\eta_v$'s respect parallelism. More precisely, let $u\\in|{\\mathcal{B}}|$ be a vertex of rank 1 such that $\\Phi(v)$ and $\\Phi(u)$ (understood as subcomplexes of $Y'$) are parallel with the parallelism map given by $p:\\Phi(v)\\to\\Phi(u)$. Then $p\\circ\\eta_v=\\eta_u$ (note that $T({\\mathcal R}_v)=T({\\mathcal R}_u)$ by Lemma \\ref{compactible with parallelism}).\n\nLet $\\Psi$ be the functor constructed in this section from the blow-up data $\\{h_{{\\mathcal R}_v}=\\eta^{-1}_v\\circ f_{{\\mathcal R}_v}:{\\mathcal R}_v\\to {\\mathbb Z}^{T({\\mathcal R}_v)}\\}_{v\\in |{\\mathcal{B}}|}$, here $v$ ranges over all vertices of rank 1 in $|{\\mathcal{B}}|$, ${\\mathcal R}_v$ is the residue associated with $v$ and $f_{{\\mathcal R}_v}$ is the map in Definition~\\ref{1-data}. Pick a face $\\sigma\\in|{\\mathcal{B}}|$ and let $u\\in\\sigma$ be the vertex of minimal rank. Let ${\\mathcal R}_u$ be the associated $J$-residue with its product decomposition given by ${\\mathcal R}_u=\\prod_{j\\in J}{\\mathcal R}_{v_j}$ ($v_j$'s are rank 1 vertices $\\le u$). Let $\\xi_{\\sigma}:\\Psi(\\sigma)\\to\\Phi(\\sigma)$ be the isometry induced by \n\\begin{center}\n$\\prod_{j\\in J}\\eta_{v_j}:{\\mathbb Z}^{T({\\mathcal R}_u)}\\to \\prod_{j\\in J}\\Phi(v_{j})$\n\\end{center}\nand the product decomposition $\\prod_{j\\in J}\\Phi(v_{j})\\cong \\Phi(u)\\cong\\Phi(\\sigma)$ which comes from (\\ref{functor product decomposition}). The following is a consequence of Corollary \\ref{compactible with product}, Corollary \\ref{morphism in terms of product} and the discussion in this section.\n\n\\begin{cor}\n\\label{consistence}\nThe maps $\\{\\xi_{\\sigma}\\}_{{\\sigma}\\in {\\operatorname{Face}}(|{\\mathcal{B}}|)}$ induce a natural isomorphism between $\\Phi$ and $\\Psi$. Thus for any restriction quotient $q:Y'\\to|{\\mathcal{B}}|$ which satisfies the conclusion of Lemma~\\ref{inverse image are flats}, \nif $q'$ is the restriction quotient  whose blow-up data is the 1-data of $q$, then\n$q'$ is equivalent to $q$ up to a natural isomorphism between their fiber functors.\n\\end{cor}\n\n\\begin{cor}\n\\label{product of restriction quotient with Euclidean fibers}\nLet $q:Y\\to|{\\mathcal{B}}|$ be a restriction quotient which satisfies the conclusion of Lemma \\ref{inverse image are flats}. Let ${\\mathcal{B}}\\cong{\\mathcal{B}}_1\\times{\\mathcal{B}}_2$ be a product decomposition of the building ${\\mathcal{B}}$ induced by the join decomposition ${\\Gamma}={\\Gamma}_1\\circ{\\Gamma}_2$ of the defining graph of the associated right-angled Coxeter group. Then there are two restriction quotients $q_{1}:Y_{1}\\to|{\\mathcal{B}}_1|$ and $q_{2}:Y_{2}\\to|{\\mathcal{B}}_2|$ such that $Y=Y_1\\times Y_2$ and $q=q_1\\times q_2$. Moreover, $q_1$ and $q_2$ also satisfy the conclusion of Lemma \\ref{inverse image are flats}.\n\\end{cor}\n\n\\begin{proof}\nBy Corollary~\\ref{consistence}, we can assume $q$ is the restriction quotient associated with a set of blow-up data $\\{h_{{\\mathcal R}}\\}$. For every ${\\mathcal{B}}_1$-slice in ${\\mathcal{B}}$, we can restrict $\\{h_{{\\mathcal R}}\\}$ to ${\\mathcal{B}}_1$ to obtain a blow-up data for ${\\mathcal{B}}_1$. This does not depend on our choice of the ${\\mathcal{B}}_1$-slice, since the blow-up data respects parallelism. We obtain a blow-up data for ${\\mathcal{B}}_2$ in a similar way. It follows from the above construction that the fiber functor associated with $\\{h_{{\\mathcal R}}\\}$ is the product of the fiber functors associated the blow-up data on ${\\mathcal{B}}_1$ and ${\\mathcal{B}}_2$. Thus this corollary is a consequence of Lemma~\\ref{lem_behavior_under_products}.\n\\end{proof}\n\n\\subsection{More properties of the blow-up buildings}\n\\label{subsection_more properties}\nIn this section, we look at the restriction quotient $q:Y\\to|{\\mathcal{B}}|$ associated with the blow-up data $\\{h_{{\\mathcal R}}\\}$ as in Definition~\\ref{input data} (or equivalently, a restriction quotient $q:Y\\to|{\\mathcal{B}}|$ which satisfies the conclusion of Lemma \\ref{inverse image are flats}) in more detail, and record several basic properties of $Y$. A hurried reader can go through Definition~\\ref{rank and inverse map}, then proceed directly to Section~\\ref{subsection_morhpism of blow-up data} and come back to this part later.\n\n\\begin{definition}\n\\label{rank and inverse map}\nA vertex $y\\in Y$ is of \\textit{rank $k$} if $p(y)$ is a vertex of rank $k$. Thus $q$ induces a bijection between rank $0$ vertices in $Y$ and rank $0$ vertices in $|{\\mathcal{B}}|$. Since rank $0$ vertices in $|{\\mathcal{B}}|$ can be identified with chambers in ${\\mathcal{B}}$, $q^{-1}$ induces a well-defined map $q^{-1}:{\\mathcal{B}}\\to Y$ from the set of chambers of ${\\mathcal{B}}$ (or rank $0$ vertices of $|{\\mathcal{B}}|$) to rank $0$ vertices in $Y$.\n\\end{definition}\n\n\\begin{lem}\n\\label{restriction}\nFor any residue ${\\mathcal R}\\subset{\\mathcal{B}}$, we view ${\\mathcal R}$ as a building and restrict the blow-up data over ${\\mathcal{B}}$ to a blow-up data over ${\\mathcal R}$. Let $q_{{\\mathcal R}}:Y_{{\\mathcal R}}\\to |{\\mathcal R}|$ be the associated restriction quotient. Then there exists an isometric embedding $i:Y_{{\\mathcal R}}\\to Y$ which fits into the following commutative diagram:\n\\begin{center}\n$\\begin{CD}\nY_{\\mathcal R}                         @>i>>       Y\\\\\n@Vq_{{\\mathcal R}}VV                                   @VqVV\\\\\n|{\\mathcal R}|       @>i'>>        |{\\mathcal{B}}|\n\\end{CD}$\n\\end{center}\nMoreover, $i(Y_{{\\mathcal R}})=q^{-1}(i'(|{\\mathcal R}|))$.\n\\end{lem}\n\nThe lemma is a direct consequence of the construction in Section \\ref{subsection_input for Z-blow-up}.\n \nPick a vertex $v\\in |{\\mathcal{B}}|$. The \\textit{downward complex of $v$} is the smallest convex subcomplex of $|{\\mathcal{B}}|$ which contains all vertices which are $\\le v$. If ${\\mathcal R}_v$ is the residue associated with $v$, then the downward complex is the image of the embedding $|{\\mathcal R}_v|\\hookrightarrow |{\\mathcal{B}}|$. The next result follows from Lemma \\ref{restriction} and Corollary~\\ref{product of restriction quotient with Euclidean fibers}.\n\n\\begin{lem}\n\\label{downward complex}\nLet $D_v$ be the downward complex of a vertex $v\\in{\\mathcal{B}}$ and let ${\\mathcal R}_v=\\prod_{i=1}^{k}{\\mathcal R}_i$ be the product decomposition of residue associated with $v$. Then $q^{-1}(D_v)$ is isomorphic to the product of the mapping cylinders of ${\\mathcal R}_i\\xrightarrow{h_{{\\mathcal R}_i}}{\\mathbb Z}^{T({\\mathcal R}_i)}\\to {\\mathbb R}^{T({\\mathcal R}_i)}$ $(1\\le i\\le k)$.\n\\end{lem}\n\n\\begin{lem}\\\n\\label{locally-finite and cocompact}\n\\begin{enumerate}\n\\item If $h^{-1}_{{\\mathcal R}}(x)$ is finite for any rank 1 residue ${\\mathcal R}$ and $x\\in{\\mathbb Z}^{T({\\mathcal R})}$, then $Y$ is locally finite. If there is a uniform upper bound for the cardinality of $h^{-1}_{{\\mathcal R}}(x)$, then $Y$ is uniformly locally finite.\n\\item If there exists $D>0$ such that the image of each $h_{{\\mathcal R}}$ is $D$-dense in ${\\mathbb Z}^{T({\\mathcal R})}$, then there exists $D'$ which depends on $D$ and the dimension of $|{\\mathcal{B}}|$ such that the collection of inverse images of rank $0$ vertices in $|{\\mathcal{B}}|$ is $D'$-dense in $Y$.\n\\end{enumerate}\n\\end{lem}\n\n\\begin{proof}\nWe prove (1) first. Pick a vertex $y\\in Y$. Let $v=q(y)$. It suffices to show the set of edges in $|{\\mathcal{B}}|$ which contain $v$, and can be lifted to an edge in $Y$ that contains $y$, is finite. Since there are only finitely many vertices in $|{\\mathcal{B}}|$ which are $\\ge v$, it suffices to consider the edges of the form $\\overline{v_{\\lambda}v}$ with $v_\\lambda<v$. It follows from our assumption and Lemma \\ref{downward complex} that there are only finitely many such edges which have the required lift. The proof of uniform local finiteness is similar. \n\nTo see (2), notice that $\\cup_{v\\in|{\\mathcal{B}}|}\\Psi(v)$ is 1-dense in $Y$, here $v$ ranges over all vertices of $|{\\mathcal{B}}|$. It follows from Lemma \\ref{downward complex} that every point in $\\Psi(v)$ be can approximated by the inverse image of some rank $0$ vertex up to distance $D'$.\n\\end{proof}\n\nNext we discuss the relation between $Y$ and the exploded Salvetti complex $S_e=S_e({\\Gamma})$ introduced in Section~\\ref{subsection_canonical restriction quotient}. Let $\\Psi$ be the fiber functor associated with $q:Y\\to|{\\mathcal{B}}|$.\n\nFirst we label each vertex $v\\in Y$ by a clique in ${\\Gamma}$ as follows. Recall that $q(v)$ is associated with a $J$-residue ${\\mathcal R}\\subset{\\mathcal{B}}$, where $J$ is the vertex set of a clique in ${\\Gamma}$. Thus we label $v$ by this clique. We also label each vertex of $S_e$ by a clique. Any vertex $v\\in S_e$ is contained in a unique standard torus. Recall that a standard torus arises from a clique in ${\\Gamma}$, thus we label $v$ by this clique. Note some vertices of $Y$ and $S_e$ are labelled by the empty set. There is a unique label-preserving map $p:Y^{(0)}\\to S^{(0)}_e({\\Gamma})$.\n\nAn edge in $Y$ or $S_e$ is \\textit{horizontal} if the labels on its two endpoints are different, otherwise, this edge is \\textit{vertical}. When $Y=X_e$, this definition coincides with the one in Section \\ref{subsection_canonical restriction quotient}. Moreover, horizontal (or vertical) edges in $X_e$ are lifts of horizontal (or vertical) edges in $S_e$.\n\nHorizontal edges in $Y$ are exactly those ones whose dual hyperplanes are mapped by $q$ to hyperplanes in $|{\\mathcal{B}}|$, and the $q$-image of any vertical edge is a point. Now we label each edge vertical edge of $Y$ by vertices in ${\\Gamma}$ as follows. Pick vertical edge $e\\subset Y$ and let $v=q(e)$. Let ${\\mathcal R}=\\prod_{i=1}^{k}{\\mathcal R}_i$ be the product decomposition of the residue associated with $v$. There is a corresponding product decomposition $\\Psi(v)=\\prod_{i=1}^{k}\\ell_i$, where $\\ell_i$ is a line which is parallel to $\\Psi(v_i)$, here $v_i\\in|{\\mathcal{B}}|$ is the vertex associated with ${\\mathcal R}_i$, and we view $\\Psi(v_i)$ and $\\Psi(v)$ as subcomplexes of $Y$. If $e$ is in the $\\ell_i$-direction, then we label $e$ by the type of ${\\mathcal R}_i$, which is a vertex in ${\\Gamma}$. A case study implies if two vertical edges are the opposite sides of a 2-cube, then they have the same label. Hence all parallel vertical edges have the same label. Now we label vertical edges in $S_e$. Recall that the map $S_e\\to S({\\Gamma})$ induces a 1-1 correspondence between vertical edges in $S_e$ and edges in $S({\\Gamma})$, and edges in $S({\\Gamma})$ are labelled by vertices of ${\\Gamma}$. This induces a labelling of vertical edges in $S_e$.\n\nWe pick an orientation for each vertical edge in $S_e$, and orient every vertical edge in $Y$ in the following way. A \\textit{vertical line} is a geodesic line made of vertical edges. It is easy to see every vertical edge is contained in a vertical line. For two vertical $\\ell_1$ and $\\ell_2$, if there exist edges $e_i\\in\\ell_i$ for $i=1,2$ such that they are parallel, then $\\ell_1$ and $\\ell_2$ are parallel. To see this, it suffices to consider the case where $e_1$ and $e_2$ are the opposite sides of a 2-cube, and this follows from a similar case study as before. Now we pick an orientation for each parallel class of vertical lines, and this induces well-define orientation on each vertical edge of $Y$, moreover, this orientation respects parallelism of edges.\n\nThere is a unique way to extend $p:Y^{(0)}\\to S^{(0)}_e({\\Gamma})$ to $p:Y^{(1)}\\to S^{(1)}_e({\\Gamma})$ such that $p$ preserves the orientation and labelling of vertical edges. One can further extend $p$ to higher-dimensional cells as follows. A cube $\\sigma\\subset Y$ is of \\textit{type $(m,n)$} if $\\sigma$ is the product of $m$ vertical edges and $n$ horizontal edges. We extend $p$ according to the type:\n\\begin{enumerate}\n\\item If $\\sigma$ is of type $(m,0)$, then we can define $p$ on $\\sigma$ since the orientation of vertical edges in $Y$ respects parallelism, and $p$ preserves labelling and orientation of vertical edges. In this case, $p(\\sigma)$ is an $m$-dimensional standard torus.\n\\item If $\\sigma$ is of type $(0,n)$, then we can define $p$ on $\\sigma$ since $p$ preserves labelling of vertices. In this case, $p(\\sigma)\\cong[0,1]^n$.\n\\item If $\\sigma$ is of type $(m,n)$, then we can define $p$ on $\\sigma$ for similar reasons as before. In this case, $p(\\sigma)\\cong \\Bbb T^m\\times[0,1]^n$.\n\\end{enumerate}\n\nPick vertex $y\\in Y$, then $p$ induces a simplicial map between the vertex links $p_y:Lk(y,Y)\\cong Lk(p(y),S_e)$. The above case study implies $p_y$ is a \\textit{combinatorial} map, i.e. $p_y$ maps each simplex isomorphically onto its image.\n\n\\begin{thm}\n\\label{isomorphic to canonical blow-up}\nIf each map $h_{{\\mathcal R}}$ in the blow-up data is a bijection, then $Y$ is isomorphic to $X_e=X_e({\\Gamma})$, which is the universal cover of the exploded Salvetti complex $S_e=S_e({\\Gamma})$.\n\\end{thm}\n\n\\begin{proof}\nWe prove the theorem by showing $p:Y\\to S_e$ is a covering map. It suffices to show for each vertex $y\\in Y$, the above map $p_y$ is an isomorphism. Suppose $y$ is labelled by a clique $\\Delta\\subset {\\Gamma}$. We look at edges which contain $y$, which fall into three classes:\n\\begin{enumerate}\n\\item vertical edges;\n\\item horizontal edges whose other endpoints are labelled by cliques in $\\Delta$;\n\\item horizontal edges whose other endpoints are labelled by cliques that contain $\\Delta$.\n\\end{enumerate}\nNote that there is a 1-1 correspondence between edges in $(3)$ and cliques which contain $\\Delta$ and have exactly one vertex not in $\\Delta$. For any clique $\\Delta'\\subset\\Delta$ which contains all but one vertex of $\\Delta$, there exists a unique edge in (2) such that its other endpoint is labelled by $\\Delta'$, since if such edge does not exist, then some $h_{{\\mathcal R}}$ will not be surjective; if there exists more than one such edges, then some $h_{{\\mathcal R}}$ will not be injective. Thus there is a 1-1 correspondence between horizontal edges which contains $y$ and horizontal edges which contains $p(y)$. Hence $p_y$ induces bijection between the 0-skeletons. Moreover, edges in (3) are orthogonal to edges in (1) and (2), so a case study implies if two edges at $p(y)$ form the corner of a 2-cube, then their lifts at $y$ (if any exist) also form the corner of a 2-cube. It follows that $p_y$ induces isomorphism between the 1-skeletons. Since both $Lk(y,Y)$ and $Lk(p(y),S_e)$ are flag complexes, $p_y$ is an isomorphism.\n\\end{proof}\n\n\\begin{remark}\nIf each map $h_{{\\mathcal R}}$ is injective (or surjective), then $p$ is locally injective (or locally surjective).\n\\end{remark}\n\n\\begin{cor}\n\\label{uniqueness of building}\nLet ${\\mathcal{B}}_1={\\mathcal{B}}_1({\\Gamma})$ and ${\\mathcal{B}}_2={\\mathcal{B}}_2({\\Gamma})$ be two right-angled ${\\Gamma}$-buildings with countably infinite rank $1$ residues. Then they are isomorphic as buildings.\n\\end{cor}\n\n\\begin{proof}\nWe pick a blow-up for ${\\mathcal{B}}_1$ such that each map in the blow-up data is a bijection. Let $Y\\to|{\\mathcal{B}}_1|$ be the associated restriction quotient and let $p:Y\\to S_e$ be the covering map as in Theorem \\ref{isomorphic to canonical blow-up}. Note that $p$ sends vertical edges to vertical edges and horizontal edges to horizontal edges, and $p$ preserves the labelling of vertices and edges. So does the lift $\\tilde{p}:Y\\to X_e$ of $p$. Lemma~\\ref{descending automorphism general case} implies $\\tilde{p}$ descends to a cubical isomorphism $|{\\mathcal{B}}_1|\\to|{\\mathcal{B}}|$, where $|{\\mathcal{B}}|$ is the building associated with $G({\\Gamma})$. Since $\\tilde{p}$ is label-preserving, this cubical isomorphism induces a building isomorphism ${\\mathcal{B}}_1\\to{\\mathcal{B}}$. Similarly, we can obtain a building isomorphism ${\\mathcal{B}}_2\\to{\\mathcal{B}}$. Hence the corollary follows.\n\\end{proof}\n\n\\begin{thm}\n\\label{descending automorphism building case}\nSuppose ${\\Gamma}$ does not admit a join decomposition ${\\Gamma}={\\Gamma}_1\\circ{\\Gamma}_2$ where that ${\\Gamma}_1$ is a discrete graph with more than one vertex.  If ${\\mathcal{B}}$ is a ${\\Gamma}$-building\nand $q:Y\\to|{\\mathcal{B}}|$ is a restriction quotient with  blow-up data $\\{h_{{\\mathcal R}}\\}$,\nthen any automorphism $\\alpha:Y\\to Y$ descends to an automorphism $\\alpha':|{\\mathcal{B}}|\\to|{\\mathcal{B}}|$.\n\\end{thm}\n\n\\begin{proof}\nBy Lemma~\\ref{descending automorphism general case}, it suffices to show $\\alpha$ preserves the rank (Definition \\ref{rank and inverse map}) of vertices of $Y$. Let $F({\\Gamma})$ be the flag complex of ${\\Gamma}$. Here we change the label of each vertex in $Y$ from some clique in ${\\Gamma}$ to the associated simplex in $F({\\Gamma})$. Suppose $y\\in Y$ is vertex of rand $k$ labelled by $\\Delta$. Then Lemma~\\ref{downward complex} and the proof of Theorem~\\ref{isomorphic to canonical blow-up} imply $Lk(y,Y)\\cong K_1\\ast K_2\\ast\\cdots\\ast K_k\\ast Lk(\\Delta,F({\\Gamma}))$, where each $K_i$ is discrete with cardinality $\\ge 2$, and $Lk(\\Delta,F({\\Gamma}))$ is understood to be $F({\\Gamma})$ when $\\Delta=\\emptyset$. Note that $\\{K_i\\}_{i=1}^{k}$ comes from vertices adjacent to $y$ of rank $\\le k$, and $Lk(\\Delta,F({\\Gamma}))$ comes from vertices adjacent to $y$ of rank $> k$. Thus $\\alpha$ preserves the collection of rank $0$ vertices.\n\nNow we assume $\\alpha$ preserves the collection of rank $i$ vertices for $i\\le k-1$. A rank $k$ vertex in $Y$ is of \\textit{type I} if it is adjacent to a vertex of rank $k-1$, otherwise it is a vertex of \\textit{type II}. It is clear that $\\alpha$ preserves the collection of rank $k$ vertices of type I. Before we deal with type II vertices, we need the following claim. Suppose $w\\in Y$ is a vertex of rank $k$ such that $\\alpha(w)$ is also of rank $k$. If there exist $k$ vertices $\\{z_i\\}_{i=1}^{k}$ adjacent to $w$ such that \n\\begin{enumerate}\n\\item $rank(z_i)\\le k$ and $rank(\\alpha(z_i))\\le k$;\n\\item the edges $\\{\\overline{z_iw}\\}_{i=1}^{k}$ are mutually orthogonal,\n\\end{enumerate}\nthen $rank (\\alpha(z))\\le k$ for any $z$ adjacent to $w$ with $rank(z)\\le k$. \n\nLet $w'=\\alpha(w)$. Suppose $w$ and $w'$ are labelled by $\\Delta$ and $\\Delta'$. Then $\\alpha$ induces an isomorphism between the links of $w$ and $w'$ in $Y$:\n\\begin{center}\n$\\alpha_{\\ast}: K_1\\ast \\cdots\\ast K_k\\ast Lk(\\Delta,F({\\Gamma}))\\to  K'_1\\ast\\cdots\\ast K'_k\\ast Lk(\\Delta',F({\\Gamma}))$.\n\\end{center}\nEach edge $\\overline{z_iw}$ gives rise to a vertex in $K_i$, and each edge $\\overline{\\alpha(z_i)w'}$ gives rise to a vertex in $K'_i$. Thus $\\alpha_{\\ast}(K_1\\ast \\cdots\\ast K_k)=K'_1\\ast\\cdots\\ast K'_k$. Since the edge $\\overline{zw}$ gives rise to a vertex in $K_1\\ast \\cdots\\ast K_k$, the edge $\\overline{\\alpha(z)w'}$ gives rise to a vertex in $K'_1\\ast\\cdots\\ast K'_k$. Then $\\alpha(z)$ is of rank $\\le k$.\n\nLet $y\\in Y$ be a rank $k$ vertex of type II. Then there exists an edge path $\\omega$ from $y$ to a type I vertex $y_1$ such that every vertex in $\\omega$ is of rank $k$. Let $\\{y_i\\}_{i=1}^{m}$ be consecutive vertices in $\\omega$ such that $y_m=y$. Note that there are $k$ vertices of rank $k-1$ adjacent to $y_1$. By the induction assumption, they are send to vertices of rank $k-1$ by $\\alpha$. Moreover, $rank(\\alpha(y_1))=k$ since $y_1$ is of type I. Thus the assumption of the claim is satisfied for $y_1$. Then $rank(\\alpha(y_2))\\le k$, hence $rank(\\alpha(y_2))=k$ by the induction assumption. Next we show $y_2$ satisfies the assumption of the claim. Let $\\{z_i\\}_{i=1}^{k}$ be vertices of rank $k$ such that they are adjacent to $y_1$ and $\\{\\overline{z_iy_1}\\}_{i=1}^{k}$ are mutually orthogonal. We also assume $y_2=z_1$. Then $rank(\\alpha(z_i))=k$ for all $i$. Hence all $\\alpha(\\overline{z_iy_1})$'s are vertical edges. For $i\\ge 2$, let $z'_i$ be the vertex adjacent to $y_2$ such that $\\overline{z'_iy_2}$ and $\\overline{z_iy_1}$ are parallel. Then $\\alpha(\\overline{z'_iy_2})$ is a vertical edge for $i\\ge 2$. Thus $rank(\\alpha(z'_i))=k$ and the assumption of the claim is satisfies for $y_2$. We can repeat this argument finite many times to deduce that $rank(\\alpha(y))=k$.\n\\end{proof}\n\n\\begin{remark}\n\\label{rem_does_not_descend}\nIf the assumption on ${\\Gamma}$ in Theorem~\\ref{descending automorphism building case} is not satisfied, then there exists a blow-up $Y\\to|{\\mathcal{B}}|$ and an automorphism of $Y$ such that it does not descend to an automorphism of $|{\\mathcal{B}}|$. By Corollary \\ref{product of restriction quotient with Euclidean fibers}, it suffices to construct an example in the case when ${\\Gamma}$ be a discrete graph with $n$ vertices with $n\\ge 2$. If $n\\ge 3$, then we define each $h_{{\\mathcal R}}$ to be a surjective map such that the inverse image of each point has $n-2$ points. Then $Y$ is a tree with valence $=n$. If $n=2$, then we define $h_{{\\mathcal R}}$ to be an injective map whose image is the set of even integers. Then $Y$ is isomorphic to the first subdivision of a tree of valence 3. In both case, it is not hard to find an automorphism of $Y$ which maps some vertex of rank 0 to a vertex of rank 1.\n\\end{remark}\n\n\\subsection{Morphisms between blow-up data}\n\\label{subsection_morhpism of blow-up data}\nLet ${\\mathcal{B}}$ and ${\\mathcal{B}}'$ be two buildings modelled on the same right-angled Coxeter group $W({\\Gamma})$. An isomorphism $\\eta:|{\\mathcal{B}}|\\to|{\\mathcal{B}}'|$ is \\textit{rank-preserving} if for each vertex $v\\in|{\\mathcal{B}}|$, $v$ and $\\eta(v)$ have the same rank. Note that such $\\eta$ induces a bijection $\\eta':{\\mathcal{B}}\\to{\\mathcal{B}}'$ which preserves the spherical residues. Conversely, every bijection ${\\mathcal{B}}\\to{\\mathcal{B}}'$ which preserves the spherical residues induces a rank-preserving isomorphism $|{\\mathcal{B}}|\\to|{\\mathcal{B}}'|$. Note that $\\eta'$ maps parallel residues of rank 1 to parallel residues of rank 1, thus $\\eta'$ induces a bijection $\\bar{\\eta}:\\Lambda_{{\\mathcal{B}}}\\to\\Lambda_{{\\mathcal{B}}'}$, where $\\Lambda_{{\\mathcal{B}}}$ and $\\Lambda_{{\\mathcal{B}}'}$ denote the collection of parallel classes of residues of rank 1 in ${\\mathcal{B}}$ and ${\\mathcal{B}}'$ respectively (see Section~\\ref{subsection_input for Z-blow-up}).\n\n\\begin{definition}[$\\eta$-isomorphism]\n\\label{eta-isomorphism}\nSuppose the blow-up data (Definition \\ref{input data}) of $|{\\mathcal{B}}|$ and $|{\\mathcal{B}}'|$ are given by $\\{h_{{\\mathcal R}}\\}$ and $\\{h'_{{\\mathcal R}}\\}$ respectively. An \\textit{$\\eta$-isomorphism} between the blow-up data is defined to be a collection of isometries $\\{f_{\\lambda}:{\\mathbb Z}^{\\lambda}\\to{\\mathbb Z}^{\\bar{\\eta}(\\lambda)}\\}_{\\lambda\\in\\Lambda_{{\\mathcal{B}}}}$ such that the following diagram commutes for every rank 1 residue ${\\mathcal R}\\subset{\\mathcal{B}}$:\n\\begin{center}\n$\\begin{CD}\n{\\mathcal R}                        @>h_{{\\mathcal R}}>>       {\\mathbb Z}^{T({\\mathcal R})}\\\\\n@V\\eta'VV                                   @Vf_{T({\\mathcal R})}VV\\\\\n\\eta'({\\mathcal R})        @>h'_{\\eta'({\\mathcal R})}>>        {\\mathbb Z}^{\\bar{\\eta}(T({\\mathcal R}))}\n\\end{CD}$\n\\end{center}\nHere $T$ is the type map defined in the beginning of Section~\\ref{subsection_input for Z-blow-up}. The map $h_{{\\mathcal R}}$ is \\textit{nondegenerate} if its image contains more than one point. In this case, if $f_{T({\\mathcal R})}$ exists, then it is unique. If $h_{{\\mathcal R}}$ is degenerate, then we have two choices for $f_{T({\\mathcal R})}$.\n\n\n\nLet $\\eta_1:|{\\mathcal{B}}_1|\\to |{\\mathcal{B}}_2|$, $\\eta_2:|{\\mathcal{B}}_2|\\to |{\\mathcal{B}}_3|$ and $\\eta:|{\\mathcal{B}}_1|\\to |{\\mathcal{B}}_3|$ be rank-preserving isomorphisms such that $\\eta=\\eta_2\\circ\\eta_1$. We fix a blow-up data for each ${\\mathcal{B}}_i$. Let $\\{f_{\\lambda}:{\\mathbb Z}^{\\lambda}\\to{\\mathbb Z}^{\\bar{\\eta}_1(\\lambda)}\\}_{\\lambda\\in\\Lambda_{{\\mathcal{B}}_1}}$ and $\\{g_{\\lambda}:{\\mathbb Z}^{\\lambda}\\to{\\mathbb Z}^{\\bar{\\eta}_2(\\lambda)}\\}_{\\lambda\\in\\Lambda_{{\\mathcal{B}}_2}}$ be the $\\eta_1$-isomorphism and $\\eta_2$-isomorphism between the corresponding blow-up data. We define the \\textit{composition} of them to be $\\{g_{\\bar{\\eta}_1 (\\lambda)}\\circ f_{\\lambda}\\}_{\\lambda\\in\\Lambda}$, which turns out to be an $\\eta$-isomorphism.\n\\end{definition}\n\nLet $\\Psi$ and $\\Psi'$ be the fiber functor associated with the blow-up data $\\{h_{{\\mathcal R}}\\}$ and $\\{h'_{{\\mathcal R}}\\}$ respectively, and let $Y\\to|{\\mathcal{B}}|$ and $Y'\\to|{\\mathcal{B}}'|$ be the associated restriction quotient.\n\n\\begin{lem}\n\\label{eta to natural}\nEvery $\\eta$-isomorphism induces a natural isomorphism from $\\Psi$ to $\\Psi'$, hence by Section~\\ref{sec_equivariance_properties}, it induces an isomorphism $Y\\to Y'$ which is a lift of $\\eta:|{\\mathcal{B}}|\\to|{\\mathcal{B}}'|$. Moreover, composition of $\\eta$-isomorphisms gives rise to composition of natural transformations of the associated fiber functors.\n\\end{lem}\n\n\\begin{proof}\nFor every spherical residue ${\\mathcal R}\\subset{\\mathcal{B}}$, $\\eta'$ respects the product decomposition of ${\\mathcal R}$. Thus the following diagram commutes:\n\\begin{center}\n$\\begin{CD}\n{\\mathcal R}                        @>h_{{\\mathcal R}}>>       {\\mathbb Z}^{T({\\mathcal R})}\\\\\n@V\\eta'VV                                   @V\\prod_{\\lambda\\in T({\\mathcal R})}f_{\\lambda}VV\\\\\n\\eta'({\\mathcal R})        @>h'_{\\eta'({\\mathcal R})}>>        {\\mathbb Z}^{\\bar{\\eta}(T({\\mathcal R}))}\n\\end{CD}$\n\\end{center}\nHere $\\prod_{\\lambda\\in T({\\mathcal R})}f_{\\lambda}$ induces an isometry ${\\mathbb R}^{T({\\mathcal R})}\\to{\\mathbb R}^{\\bar{\\eta}(T({\\mathcal R}))}$. This gives rise to a collection of isometries between objects of $\\Psi$ and $\\Psi'$. It follows from the construction in Section \\ref{subsection_input for Z-blow-up} that these isometries give the required natural isomorphism between $\\Psi$ and $\\Psi'$. The second assertion in the lemma is straightforward.\n\\end{proof}\n\n\\begin{remark}\nIf we weaken the assumption of Definition~\\ref{eta-isomorphism} by assuming each $f_{\\lambda}$ is a bijection, then we can obtain a bijection between the vertex sets of $Y$ and $Y'$. This bijection preserves the fibers, however, we may not be able to extend it to a cubical map. \n\\end{remark}\n\n\\begin{thm}\nIf each map $h_{{\\mathcal R}}$ in the blow-up data is a bijection, then $Y$ is isomorphic to $X_e=X_e({\\Gamma})$, which is the universal cover of the exploded Salvetti complex.\n\\end{thm}\n\n\\begin{definition}[$\\eta$-quasi-morphism]\nWe follow the notation in Definition \\ref{eta-isomorphism}. An \\textit{$(\\eta,L,A)$-quasi-morphism} between the blow-up data $\\{h_{{\\mathcal R}}\\}$ and $\\{h'_{{\\mathcal R}}\\}$ is a collection of $(L,A)$-quasi-isometries $\\{f_{\\lambda}:{\\mathbb Z}^{\\lambda}\\to{\\mathbb Z}^{\\bar{\\eta}(\\lambda)}\\}_{\\lambda\\in\\Lambda_{{\\mathcal{B}}}}$ such that the diagram in Definition \\ref{eta-isomorphism} commutes up to error $A$.\n\\end{definition}\n\n\\begin{lem}\n\\label{eta-quasi}\nEach $(\\eta,L,A)$-quasi-morphism between $\\{h_{{\\mathcal R}}\\}$ and $\\{h'_{{\\mathcal R}}\\}$ induces an $(L',A')$-quasi-isometry $Y\\to Y'$ with $L',A'$ depending on $L,A$, and the dimension of $|{\\mathcal{B}}|$.\n\\end{lem}\n\n\\begin{proof}\nBy Lemma~\\ref{lem_quasiisomorphism_gives_quasiisometry}, it suffices to produce an $(L',A')$-quasi-natural isomorphism from $\\Psi$ to $\\Psi'$. This can be done by considering maps of form $\\prod_{\\lambda\\in T({\\mathcal R})}f_{\\lambda}$ as in Lemma \\ref{eta to natural}.\n\\end{proof}\n\n\\begin{remark}[A nice representative]\n\\label{good representative}\nLet $Y_0$ be the collection of rank $0$ vertices in $Y$ (Definition \\ref{rank and inverse map}). We define $Y_0'$ similarly. If the assumption in Lemma~\\ref{locally-finite and cocompact} (2) is satisfied, then $Y_0$ and $Y'_0$ are $D$-dense in $Y$ and $Y'$ respectively. In this case, the quasi-isometry $Y\\to Y'$ in Lemma~\\ref{eta-quasi} can be represented by $\\phi:Y_0\\to Y'_0$, where $\\phi$ is the bijection induced by $\\eta:|{\\mathcal{B}}|\\to|{\\mathcal{B}}'|$ (recall that we can identify $Y_0$ and $Y'_0$ with rank $0$ vertices in $|{\\mathcal{B}}|$ and $|{\\mathcal{B}}'|$ respectively, see Definition \\ref{rank and inverse map}). The fact that $\\phi$ is a quasi-isometry follows from the construction in the proof Lemma~\\ref{lem_quasiisomorphism_gives_quasiisometry}.\n\\end{remark}\n\n\n\\begin{cor}\n\\label{quasi-isometry criterion}\nIf there exists constant $D>0$ such that each map $h_{{\\mathcal R}}$ in the blow-up data satisfies:\n\\begin{enumerate}\n\\item For any $x\\in{\\mathbb Z}^{T({\\mathcal R})}$, $|h^{-1}_{{\\mathcal R}}(x)|\\le D$.\n\\item The image of $h_{{\\mathcal R}}$ is $D$-dense in ${\\mathbb Z}^{T({\\mathcal R})}$.\n\\end{enumerate}\nThen $Y$ is quasi-isometric to $G({\\Gamma})$.\n\\end{cor}\n\n\\begin{proof}\nBy the assumptions, there exists another set of blow-up data $\\{h'_{{\\mathcal R}}\\}$ such that each $h'_{{\\mathcal R}}$ is a bijection, and an $(\\eta,L,A)$-quasi-isomorphism $\\{f_{\\lambda}\\}_{\\lambda\\in\\Lambda_{{\\mathcal{B}}}}$ from $\\{h'_{{\\mathcal R}}\\}$ to $\\{h_{{\\mathcal R}}\\}$ where $\\eta$ is the identity map. It follows from Lemma~\\ref{eta-quasi} and Theorem~\\ref{isomorphic to canonical blow-up} that $Y$ is quasi-isometric to $X_e$, the universal cover of the exploded Salvetti complex; hence $Y$ is quasi-isometric to $G({\\Gamma})$.\n\\end{proof}\n\nIn the rest of this section, we look at the special case when ${\\mathcal{B}}={\\mathcal{B}}({\\Gamma})$\nis the Davis building of $G({\\Gamma})$ (see the beginning of Section \\ref{subsection_canonical restriction quotient}), and record an observation for later use. In this case, we identify points in $G({\\Gamma})$ with chambers in ${\\mathcal{B}}$.\n\nWe denote the word metric on $G({\\Gamma})$ by $d_w$. If we identify $G({\\Gamma})$ with chambers of the building ${\\mathcal{B}}={\\mathcal{B}}({\\Gamma})$, then there is another metric on $G({\\Gamma})$ defined in Definition~\\ref{distance of residue}. We caution the reader that these two metrics are not the same. We pick a set of blow-up data $\\{h_{{\\mathcal R}}\\}$ on ${\\mathcal{B}}$ and let $q:Y\\to |{\\mathcal{B}}|$ be the associated restriction quotient. Recall that vertices of rank 0 on $|{\\mathcal{B}}|$ can be identified with chambers in ${\\mathcal{B}}$, hence can be identified with $G({\\Gamma})$. Thus the map $q^{-1}:G({\\Gamma})\\to Y$ is well-defined. \n\n\\begin{lem}\n\\label{quasi-isometry produced by inverse map}\nIf there exist $L,A>0$ such that all $\\{h_{{\\mathcal R}}:{\\mathcal R}\\to{\\mathbb Z}^{T({\\mathcal R})}\\}$ are $(L,A)$-quasi-isometries $($here we identify chambers in ${\\mathcal R}$ with a subset of $G({\\Gamma})$, hence ${\\mathcal R}$ is endowed with an induced metric from $d_w)$, then $q^{-1}:(G({\\Gamma}),d_w)\\to Y$ is an $(L',A')$-quasi-isometry with its constants depending on $L,A$ and ${\\Gamma}$.\n\\end{lem}\n\n\n\\begin{proof}\nLet $q':X_e\\to |{\\mathcal{B}}|$ be the $G({\\Gamma})$-equivariant canonical restriction quotient constructed in Section~\\ref{subsection_canonical restriction quotient}. In this case, $(q')^{-1}:G({\\Gamma})\\to X_e$ is a quasi-isometry whose constants depend on ${\\Gamma}$. Let $h'_{{\\mathcal R}}$ be the blow-up data which arises from the 1-data (Definition~\\ref{1-data}) of $q'$. Then each $h'_{{\\mathcal R}}$ is an isometry. It follows from the assumption that there exists an $(\\eta,L,A)$-quasi-isomorphism from the blow-up data $\\{h'_{{\\mathcal R}}\\}$ to $\\{h_{{\\mathcal R}}\\}$ with $\\eta$ being the identity map. Thus there exists a quasi-isometry $X_e\\to Y$ which can be represented by a map $\\phi$ of the form in Remark~\\ref{good representative}. Since $q^{-1}=\\phi\\circ(q')^{-1}$, the lemma follows.\n\\end{proof}\n\n\\subsection{An equivariant construction}\n\\label{subsection_an equivariant constuction}\nLet ${\\mathcal{B}}={\\mathcal{B}}({\\Gamma})$ be a right-angled building. Let $K$ be group which acts on $|{\\mathcal{B}}|$ by automorphisms which preserve the rank of its vertices and let $K{\\curvearrowright} {\\mathcal{B}}$ and $K{\\curvearrowright}\\Lambda_{{\\mathcal{B}}}$ be the induced actions ($\\Lambda_{\\mathcal{B}}$ is defined in the beginning of Section \\ref{subsection_input for Z-blow-up}). \n\n\\begin{definition}[Factor actions]\n\\label{factor action}\nPick $\\lambda\\in\\Lambda$ and let ${\\mathcal R}_\\lambda\\subset {\\mathcal{B}}$ be a residue of rank 1 such that $T({\\mathcal R}_\\lambda)=\\lambda$ ($T$ is the type map defined in Section~\\ref{subsection_input for Z-blow-up}). Let $K_{\\lambda}$ be the stabilizer of $\\lambda$ with respect to the action $K{\\curvearrowright}\\Lambda_{{\\mathcal{B}}}$ and let $P({\\mathcal R}_\\lambda)={\\mathcal R}_\\lambda\\times{\\mathcal R}^{\\perp}_\\lambda$ be the parallel set of ${\\mathcal R}_\\lambda$ with its product decomposition (see Lemma~\\ref{parallel sets of residues} and Theorem~\\ref{product decomposition}). Then $P({\\mathcal R}_\\lambda)$ is $K_\\lambda$-invariant, and $K_\\lambda$ respects the product decomposition of $P({\\mathcal R}_\\lambda)$. Let $\\rho_\\lambda:K_\\lambda{\\curvearrowright} {\\mathcal R}_\\lambda$ be the action of $K_\\lambda$ on the ${\\mathcal R}_\\lambda$-factor. This action $\\rho_\\lambda$ is called a \\textit{factor action}. \n\\end{definition}\n\nWe construct  equivariant blow-up data as follows. Pick one representative from each $K$-orbit of $K{\\curvearrowright}\\Lambda_{{\\mathcal{B}}}$ and form the set $\\{\\lambda_u\\}_{u\\in U}$. Let $K_u$ be the stabilizer of $\\lambda_u$. Pick residue ${\\mathcal R}_u\\subset {\\mathcal{B}}$ of rank 1 such that $T({\\mathcal R}_u)=\\lambda_u$ and let $\\rho_u:K_u{\\curvearrowright} {\\mathcal R}_u$ be the factor action defined as above.\n\nTo obtain a $K$-equivariant blow-up data, we pick an isometric action $K_u{\\curvearrowright}{\\mathbb Z}^{\\lambda_u}$ and a $K_u$-equivariant map $h_{{\\mathcal R}_u}:{\\mathcal R}_u\\to {\\mathbb Z}^{\\lambda_u}$. If ${\\mathcal R}$ is parallel to ${\\mathcal R}_u$ with the parallelism map given by $p:{\\mathcal R}\\to{\\mathcal R}_u$, we define $h_{{\\mathcal R}}=h_{{\\mathcal R}_u}\\circ p$. By the previous discussion, there is a factor action $K_u{\\curvearrowright}{\\mathcal R}$, and $h_{{\\mathcal R}}$ is $K_u$-equivariant. We run this process for each element in $\\{\\lambda_u\\}_{u\\in U}$. If $\\lambda\\notin \\{\\lambda_u\\}_{u\\in U}$, then we fix an element $g_{\\lambda}\\in K$ such that $g_{\\lambda}(\\lambda)\\in \\{\\lambda_u\\}_{u\\in U}$. For rank 1 element ${\\mathcal R}$ with $T({\\mathcal R})=\\lambda$, we define $h_{{\\mathcal R}}=\\textmd{Id}\\circ h_{g_{\\lambda}({\\mathcal R})}\\circ g_{\\lambda}$, here $\\textmd{Id}:{\\mathbb Z}^{g_{\\lambda}(\\lambda)}\\to{\\mathbb Z}^{\\lambda}$ is the identity map. Let $K_{\\lambda}=g^{-1}_{\\lambda}K_{g_{\\lambda}(\\lambda)}g_{\\lambda}$ be the stabilizer of $\\lambda$. We define the action $K_{\\lambda}{\\curvearrowright} {\\mathbb Z}^{\\lambda}$ by letting $g^{-1}_{\\lambda}gg_{\\lambda}$ acts on ${\\mathbb Z}^{\\lambda}$ by $\\textmd{Id}\\circ g\\circ\\textmd{Id}^{-1}$ ($g\\in K_{g_{\\lambda}(\\lambda)}$). Then $h_{{\\mathcal R}}$ becomes $K_{\\lambda}$-equivariant.\n\nIt follows from the above construction that we can produce an isometry $f_{g,{\\mathcal R}}:{\\mathbb Z}^{T({\\mathcal R})}\\to {\\mathbb Z}^{T(g({\\mathcal R}))}$ for each $g\\in K$ and rank 1 residue ${\\mathcal R}\\in{\\mathcal{B}}$ such that the following diagram commutes\n\\begin{center}\n$\\begin{CD}\n{\\mathcal R}                        @>h_{{\\mathcal R}}>>       {\\mathbb Z}^{T({\\mathcal R})}\\\\\n@VgVV                                   @Vf_{g,{\\mathcal R}}VV\\\\\ng({\\mathcal R})        @>h_{g({\\mathcal R})}>>        {\\mathbb Z}^{T(g({\\mathcal R}))}\n\\end{CD}$\n\\end{center}\nand $f_{g_1g_2,{\\mathcal R}}=f_{g_1,g_2({\\mathcal R})}\\circ f_{g_2,{\\mathcal R}}$ for any $g_1,g_2\\in K$. Let $\\Psi$ be the fiber functor associated with the above blow-up data and let $q:Y\\to|{\\mathcal{B}}|$ be the corresponding restriction quotient. Lemma \\ref{eta to natural} implies $K$ acts on $\\Psi$ by natural transformations, hence there is an induced action $K{\\curvearrowright} Y$ and $q$ is $K$-equivariant. \n\n\\begin{remark}\nThe previous construction depends on several choices:\n\\begin{enumerate}\n\\item The choice of the set $\\{\\lambda_u\\}_{u\\in U}$.\n\\item The choice of the isometric action $K_u{\\curvearrowright}{\\mathbb Z}^{\\lambda_u}$ and the $K_u$-equivariant map $h_{{\\mathcal R}_u}:{\\mathcal R}_u\\to {\\mathbb Z}^{\\lambda_u}$.\n\\item The choice of the elements $g_{\\lambda}$'s.\n\\end{enumerate}\n\\end{remark}\n\n\\section{Quasi-actions on RAAG's}\n\\label{section_quasi-action on RAAGs}\n\nIn this section we will apply the construction in Section \\ref{subsection_an equivariant constuction} to study quasi-actions on RAAG's.\n\nWe assume $G(\\Gamma)\\neq{\\mathbb Z}$ throughout Section \\ref{section_quasi-action on RAAGs}.\n\n\n\\subsection{The cubulation}\n\\label{subsec_cubulation}\n\nThroughout Subsection \\ref{subsec_cubulation} we assume $G({\\Gamma})\\not\\simeq {\\mathbb Z}$ is a RAAG with $|{\\operatorname{Out}}(G({\\Gamma}))|<\\infty$, and $\\rho:H{\\curvearrowright} G(\\Gamma)$ is an $(L,A)$-quasi-action.\n\nRecall that $G(\\Gamma)$ acts on $X(\\Gamma)$ by deck transformations, and this action is simply transitive on the vertex set of $X(\\Gamma)$. By picking a base point in $X(\\Gamma)$, we identify $G(\\Gamma)$ with the 0-skeleton of $X(\\Gamma)$. \n\n\\begin{definition}\n\\label{def_flat_preserving}\nA quasi-isometry $\\phi:G({\\Gamma})\\rightarrow G({\\Gamma})$ is\n{\\em flat-preserving} if it \nis a bijection and for every standard flat $F\\subset X({\\Gamma})$ there is a \nstandard flat $F'\\subset X({\\Gamma})$ such that $\\phi$ maps\nthe $0$-skeleton of $F$ bijectively onto the $0$-skeleton of $F'$.\nThe standard flat $F'$ is uniquely determined, and we denote it by\n$\\phi_*(F)$. Note that if $\\phi$ is flat-preserving, then $\\phi^{-1}$ is also flat-preserving.\n\\end{definition}\n\nBy Theorem \\ref{thm_intro_vertex_rigidity}, without loss of generality\nwe can assume $\\rho:H{\\curvearrowright} G({\\Gamma})$ is an action by flat-preserving bijections which are also $(L,A)$-quasi-isometries. \n\nOn the one hand, we want to think $G({\\Gamma})$ as a metric space with the word metric with respect to its standard generating set, or equivalently, with the induced $l^1$-metric from $X({\\Gamma})$; on the other hand, we want to treat $G({\\Gamma})$ as a right-angled building (see Section~\\ref{subsection_canonical restriction quotient}), more precisely, we want to identify points in $G({\\Gamma})$ with chambers in the associated right-angled building of $G({\\Gamma})$. Then the $\\rho$ preserves the spherical residues in $G({\\Gamma})$, thus there is an induced $\\rho_{|{\\mathcal{B}}|}:H{\\curvearrowright} |{\\mathcal{B}}|$ on the Davis realization $|{\\mathcal{B}}|$ of $G({\\Gamma})$. \n\n\nLet $\\Lambda$ be the collection of parallel classes of standard geodesic lines in $X({\\Gamma})$, in other words, $\\Lambda$ is the collection of parallel classes of rank 1 residues in $G({\\Gamma})$, and let $T$ be the type map defined in the beginning of Section~\\ref{subsection_input for Z-blow-up}. There is another induced action $\\rho_{\\Lambda}:H{\\curvearrowright}\\Lambda$. For each $\\lambda\\in\\Lambda$, let $H_{\\lambda}$ be the stabilizer of $\\lambda$. Pick a residue ${\\mathcal R}$ in the parallel class $\\lambda$, and let $\\rho_{\\lambda}:H_{\\lambda}{\\curvearrowright} {\\mathcal R}$ be the factor action in Definition~\\ref{factor action}. Note that ${\\mathcal R}$ is an isometrically embedded copy of ${\\mathbb Z}$ with respect to the metric on $G({\\Gamma})$; moreover, $\\rho_{\\lambda}$ is an action by $(L',A')$-quasi-isometries. Here we can choose $L'$ and $A'$ such that they depend only on $L$ and $A$, so in particular they do not depend on $\\lambda$ and ${\\mathcal R}$. \n\nFor the action $\\rho_{\\Lambda}:H{\\curvearrowright}\\Lambda$, we pick a representative from each $H$-orbit and form the set $\\{\\lambda_u\\}_{u\\in U}$. By the construction in Section~\\ref{subsection_an equivariant constuction}, it remains to choose an isometric action $G_u{\\curvearrowright}{\\mathbb Z}^{\\lambda_u}$ and a $G_u$-equivariant map $h_{{\\mathcal R}_u}:{\\mathcal R}_u\\to {\\mathbb Z}^{\\lambda_u}$ for each $u\\in U$ (${\\mathcal R}_u$ is a residue in the parallel class $\\lambda_u$). The choice is provided by the following result, whose proof is postponed to Section~\\ref{sec_quasi action on Z}. \n\n\\begin{proposition}\n\\label{key lemma}\nIf a group $K$ has an action on $\\Bbb Z$ by $(L,A)$-quasi-isometries, then there exists another action $K\\curvearrowright\\Bbb Z$ by isometries which is related to the original action by a surjective equivariant $(L',A')$-quasi-isometry $f: \\Bbb Z\\to \\Bbb Z$ where $L',A'$ depend on $L$ and $A$.\n\\end{proposition}\n\nFrom the above data, we produce  $H$-equivariant blow-up data $h_{{\\mathcal R}}:{\\mathcal R}\\to{\\mathbb Z}^{T({\\mathcal R})}$ for each rank 1 residue ${\\mathcal R}\\subset G({\\Gamma})$ as in Section~\\ref{subsection_an equivariant constuction}. Note that each $h_{{\\mathcal R}}$ is an $(L'',A'')$-quasi-isometry with constants depending only on $L$ and $A$.\n\nLet $q:Y\\to |{\\mathcal{B}}|$ be the restriction quotient associated with the above blow-up data. Then there is an induced action $H{\\curvearrowright} Y$ by isomorphisms, and $q$ is $H$-equivariant. It follows from Lemma~\\ref{locally-finite and cocompact} that $Y$ is uniformly locally finite. \n\n{\\em Claim. There exists an $(L_1,A_1)$-quasi-isometry $G({\\Gamma})\\to Y$ with $L_1,A_1$ depending only on $L$ and $A$.}\n\n\\begin{proof}[Proof of claim]\nLet $h'_{{\\mathcal R}}:{\\mathcal R}\\to {\\mathbb Z}^{T({\\mathcal R})}$ be another blow-up data such that each $h'_{{\\mathcal R}}$ is an isometry (such blow-up data always exists), and let $q':Y'\\to |{\\mathcal{B}}|$ be the associated restriction quotient. By Theorem~\\ref{isomorphic to canonical blow-up}, $Y'$ is isomorphic to $X_e$, which is the universal cover of the exploded Salvetti complex introduced in Section~\\ref{subsection_canonical restriction quotient}. For any $\\lambda\\in\\Lambda$, we define $f_{\\lambda}=h_{{\\mathcal R}}\\circ (h'_{{\\mathcal R}})^{-1}$, here ${\\mathcal R}$ is a residue such that $T({\\mathcal R})=\\lambda$ and the definition of $f_{\\lambda}$ does not depend on ${\\mathcal R}$. Each $f_{\\lambda}$ is an $(L'',A'')$-quasi-isometry and the collection of all $f_{\\lambda}$'s induces a quasi-isomorphism between the blow-up data $\\{h'_{{\\mathcal R}}\\}$ and $\\{h_{{\\mathcal R}}\\}$. It follows from Lemma~\\ref{eta-quasi} that there exists a quasi-isometry between $\\varphi:Y'\\cong X_e\\to Y$, and the claim follows.\n\\end{proof}\n\nLet $B_0$ be the set of vertices of rank 0 in $|{\\mathcal{B}}|$. There is a natural identification of $B_0$ with $G({\\Gamma})$. Letting $Y_0=q^{-1}(B_0)$, we get that $q$ induces a bijection between $Y_0$ and $B_0$. We define $Y'_{0}$ similarly. It follows from (2) of Lemma~\\ref{locally-finite and cocompact} that $Y'_{0}$ and $Y_0$ are $D$-dense in $Y'$ and $Y$ respectively for $D$ depending on $L$ and $A$. Note that $q^{-1}:G({\\Gamma})\\to Y_0$ is $H$-equivariant, and if the action $\\rho:H{\\curvearrowright} G({\\Gamma})$ is cobounded, then $H{\\curvearrowright} Y$ is cocompact. \n\nThe above quasi-isometry $\\varphi$ can be represented by $q^{-1}\\circ q':Y'_0\\to Y_0$ (Remark~\\ref{good representative}). By Lemma~\\ref{quasi-isometry produced by inverse map}, $(q')^{-1}:B_0=G({\\Gamma})\\to Y'_0$ is also a quasi-isometry, and thus $q^{-1}:G({\\Gamma})\\to Y_0$ is a quasi-isometry. This map is $H$-equivariant, so if $\\rho:H{\\curvearrowright} G({\\Gamma})$ is proper, then $H{\\curvearrowright} Y$ is also proper.\n\n\\begin{remark}\nHere we discuss a refinement of the above construction. Instead of requiring each $h'_{{\\mathcal R}}$ to be an isometry, it is possible to choose each $h'_{{\\mathcal R}}$ such that:\n\\begin{enumerate}\n\\item $h'_{{\\mathcal R}}$ is a bijection.\n\\item $h'_{{\\mathcal R}}$ is an $(L_2,A_2)$-quasi-isometry.\n\\item $f_{\\lambda}:{\\mathbb Z}^{\\lambda}\\to{\\mathbb Z}^{\\lambda}$ is a surjective map which respects the order of the ${\\mathbb Z}$, hence can be extended to a surjective cubical map ${\\mathbb R}^{\\lambda}\\to{\\mathbb R}^{\\lambda}$.\n\\end{enumerate}\nThe surjectivity in (3) follows from our choice in Proposition~\\ref{key lemma}. In this case, the space $Y'$ is still isomorphic to $X_e$ (Theorem~\\ref{isomorphic to canonical blow-up}). Let $\\Psi$ and $\\Psi'$ be the fiber functors associated with the blow-up data $\\{h_{{\\mathcal R}}\\}$ and $\\{h'_{{\\mathcal R}}\\}$. As in the proof of Lemma~\\ref{eta to natural}, the  $f_{\\lambda}$'s induce a natural transformation from $\\Psi'$ to $\\Psi$ which is made of a collection of surjective cubical maps from objects in $\\Psi'$ to objects in $\\Psi$; moreover, these maps are quasi-isometries with uniform quasi-isometry constants. Recall that we can describe $Y$ as the quotient of the disjoint collection $\\{{\\sigma}\\times \\Psi({\\sigma})\\}_{{\\sigma}\\in {\\operatorname{Face}}(|{\\mathcal{B}}|)}$ (see the proof of Theorem~\\ref{thm_fiber_functor_gives_restriction_quotient}), and a similar description holds for $Y'$. Thus there is a surjective cubical map $\\phi:Y'\\to Y$ induced by the natural transformation. Actually $\\phi$ is a restriction quotient, since the inverse image of each hyperplane is a hyperplane. We also know $\\phi$ is a quasi-isometry by Lemma~\\ref{lem_quasiisomorphism_gives_quasiisometry}.\n\\end{remark}\n\nThe following theorem summarizes the above discussion.\n \n\\begin{theorem}\n\\label{thm_quasi_action1}\nIf the outer automorphism group \n${\\operatorname{Out}}(G({\\Gamma}))$ is finite and $G({\\Gamma})\\not\\simeq {\\mathbb Z}$, \nthen any quasi-action $\\rho:H{\\curvearrowright} X({\\Gamma})$ is\nquasiconjugate to an action $\\hat{\\rho}$ of $H$ by cubical isometries on a uniformly locally finite $CAT(0)$ cube complex $Y$. Moreover:\n\\begin{enumerate}\n\\item If $\\rho$ is cobounded, then $\\hat{\\rho}$ is cocompact.\n\\item If $\\rho$ is proper, then $\\hat{\\rho}$ is proper.\n\\item Let $|{\\mathcal{B}}|$ be the Davis realization of the right-angled building associated with $G({\\Gamma})$,  let $H{\\curvearrowright} |{\\mathcal{B}}|$ be the induced action, and let $X_e=X_e({\\Gamma})$ be the universal cover of the exploded Salvetti complex for $G({\\Gamma})$. Then $Y$ fits into the following commutative diagram:\n\\begin{diagram}\nX_{e}   &            &\\pile{\\rTo^{\\phi}\\\\}& &Y\\\\\n\t  &\\rdTo_{q'} &                 &\\ldTo_{q}&\\\\\n    && |{\\mathcal{B}}|  && \n\\end{diagram}\nHere $q'$, $q$ and $\\phi$ are restriction quotients. The map $\\phi$ is a quasi-isometry whose constants depend on the constants of the quasi-action $\\rho$, and $q$ is $H$-equivariant.\n\\end{enumerate}\n\\end{theorem}\n\n\\begin{cor}\n\\label{if and only if}\nSuppose the outer automorphism group ${\\operatorname{Out}}(G({\\Gamma}))$ is finite. Then $H$ is quasi-isometric to $G({\\Gamma})$ if and only if there exists an $H$-equivariant restriction quotient map $q:Y\\to |{\\mathcal{B}}|$ such that:\n\\begin{enumerate}\n\\item $|{\\mathcal{B}}|$ is the Davis realization of some right-angled ${\\Gamma}$-building.\n\\item The action $H{\\curvearrowright} Y$ is geometric.\n\\item If $v\\in |{\\mathcal{B}}|$ is a vertex of rank $k$, then $q^{-1}(v)={\\mathbb E}^k$.\n\\end{enumerate}\n\\end{cor}\n\n\n\\begin{proof}\nThe only if direction follows from Theorem~\\ref{thm_quasi_action1}. For the if direction, it suffices to show $Y$ is quasi-isometric to $G({\\Gamma})$. Let $\\Phi$ be the fiber functor associated with $q$.\n\nPick a vertex $v\\in |{\\mathcal{B}}|$ of rank $k$ and let $F_v=q^{-1}(v)$. We claim ${\\operatorname{Stab}}(v)$ acts cocompactly on $F_v$.  By a standard argument, to prove this it suffices to show that $\\{h(F_v)\\}_{h\\in H}$ is a locally finite family in $Y$. Suppose there exists an $R$-ball $N\\subset Y$ such that there are infinitely many distinct elements in $\\{h(F_v)\\}_{h\\in H}$ which have nontrivial intersection of $N$. Since $Y$ admits a geometric action, it is locally finite, and thus there exists a vertex $x\\in|{\\mathcal{B}}|$ which is contained in infinitely many distinct elements in $\\{h(F_v)\\}_{h\\in H}$. This is impossible, since if $h(F_v)\\neq h'(F_v)$, then $q(h(F_v))$ and $q(h'(F_v))$ are distinct vertices in $|{\\mathcal{B}}|$ by the $H$-equivariance of $q$.\n\nConsider a cube $\\sigma\\subset |{\\mathcal{B}}|$ and let $v$ be its vertex of minimal rank. We claim $\\Phi(\\sigma)\\to\\Phi(v)$ is surjective, hence is an isometry. By (3), the action $H{\\curvearrowright} |{\\mathcal{B}}|$ preserves the rank of the vertices, thus ${\\operatorname{Stab}}(\\sigma)\\subset{\\operatorname{Stab}}(v)$. We know that ${\\operatorname{Stab}}(v)$ acts cocompactly on $q^{-1}(v)$; since the poset $\\{w \\geq v\\}$ is finite, ${\\operatorname{Stab}}(\\sigma)$ has finite index in ${\\operatorname{Stab}}(v)$, and so ${\\operatorname{Stab}}(\\sigma)$ also acts cocompactly on $q^{-1}(v)$. Now the image of $\\Phi(\\sigma)\\to\\Phi(v)$ is a convex subcomplex of $q^{-1}(v)$ that is ${\\operatorname{Stab}}(\\sigma)$-invariant, so it coincides with $q^{-1}(v)$. \n\nBy Corollary~\\ref{consistence}, we can assume $q$ is the restriction quotient of a set of blow-up data $\\{h_{{\\mathcal R}}\\}$. Pick a vertex $v\\in|{\\mathcal{B}}|$ of rank 1 and let $D(v)$ be the downward complex of $v$ (see Section~\\ref{subsection_input for Z-blow-up}). Let ${\\mathcal R}_v\\subset{\\mathcal{B}}$ be the associated residue and let ${\\mathcal R}_v\\to {\\mathbb R}^{T({\\mathcal R})}$ be the map induced by $h_{{\\mathcal R}_v}$. Then $q^{-1}(D_v)$ is isomorphic to the mapping cylinder of this map. Since the ${\\operatorname{Stab}}(v)$ acts cocompactly on $q^{-1}(D_v)$,  there are only finite many orbits of vertices of rank 1, and the assumptions of Corollary~\\ref{quasi-isometry criterion} are satisfied. It follows that $Y$ is quasi-isometric to $G({\\Gamma})$.\n\\end{proof}\n\nIt is possible to drop the $H$-equivariant assumption on $q$ under the following conditions. Here we do not put any assumption on ${\\Gamma}$.\n\n\\begin{thm}\n\\label{quasi-isometry to G}\nLet ${\\mathcal{B}}$ be a right-angled ${\\Gamma}$-building. Suppose $q:Y\\to|{\\mathcal{B}}|$ is a restriction quotient such that for every cube $\\sigma\\subset |{\\mathcal{B}}|$, and every interior point $x \\in {\\sigma}$, the point inverse $q^{-1}(x)$ is a copy of ${\\mathbb E}^{rank(v)}$,  where\n$v\\in {\\sigma}$ is the vertex of minimal rank.\n\nIf $H$ acts geometrically on $Y$ by automorphisms, then $H$ is quasi-isometric to $G({\\Gamma})$.  \n\\end{thm}\n\n\\begin{proof}\nFirst we assume ${\\Gamma}$ satisfies the assumption of Theorem~\\ref{descending automorphism building case}. Then the above result is a consequence of Corollary~\\ref{consistence}, Theorem~\\ref{descending automorphism building case} and the argument in Corollary~\\ref{if and only if}.\n\nFor arbitrary ${\\Gamma}$, we make a join decomposition ${\\Gamma}={\\Gamma}_1\\circ{\\Gamma}_2\\circ\\cdots{\\Gamma}_k\\circ{\\Gamma}'$ where ${\\Gamma}'$ satisfies the assumption of Theorem~\\ref{descending automorphism building case}, and all ${\\Gamma}_i$'s are discrete graphs with more than one vertex. By Corollary \\ref{product of restriction quotient with Euclidean fibers}, there are induced cubical product decomposition $Y=Y_1\\times Y_2\\times\\cdots Y_k\\times Y'$ and restriction quotients $q_i:Y_i\\to |{\\mathcal{B}}_i|$ and $q':Y'\\to |{\\mathcal{B}}'|$ which satisfy the assumption of the theorem. By \\cite[Proposition 2.6]{caprace2011rank}, we assume $H$ respects this product decomposition by passing to a finite index subgroup. Since $Y'$ is locally finite and cocompact, the same argument in Corollary~\\ref{if and only if} implies $Y'$ is quasi-isometric to $G({\\Gamma}')$. Each $Y_i$ is a locally finite and cocompact tree which is not quasi-isometric to a line. So $Y_i$ is quasi-isometric to $G({\\Gamma}')$. Thus $Y$ is quasi-isometric to $G({\\Gamma})$.\n\\end{proof}\n\n\\begin{cor}\nSuppose ${\\operatorname{Out}}(G({\\Gamma}))$ is finite and $G({\\Gamma})\\not\\simeq{\\mathbb Z}$. Let ${\\mathcal{B}}$ be the right-angled building of $G({\\Gamma})$. Then $H$ is quasi-isometric to $G({\\Gamma})$ if and only if $H$ acts geometrically on a blow-up of ${\\mathcal{B}}$ in the sense of Section \\ref{subsection_input for Z-blow-up} by automorphisms.\n\\end{cor}\n\\subsection{Reduction to nicer actions} \n\\label{subsection_nicer action}\nThough every action $\\rho:H{\\curvearrowright} G(\\Gamma)$ by flat-preserving bijections which are also $(L,A)$-quasi-isometries is quasiconjugate to an isometric action $H{\\curvearrowright} Y$ as in Theorem~\\ref{thm_quasi_action1}, it is in general impossible to take $Y=X(\\Gamma)$, even if the action $\\rho$ is proper and cobounded. \n\n\\begin{definition}\n\\label{standard action}\nLet $H={\\mathbb Z}/2\\oplus {\\mathbb Z}$ with the generator of ${\\mathbb Z}/2$ and ${\\mathbb Z}$ denoted by $a$ and $b$\nrespectively. Let $H\\stackrel{\\rho_0}{{\\curvearrowright}} {\\mathbb Z}$ be the action\nwhere $\\rho_0(b)(n)=n+2$, and $\\rho_0(a)$ acts on ${\\mathbb Z}$ by flipping $2n$ and $2n+1$ for\nall $n\\in{\\mathbb Z}$. An action $K{\\curvearrowright} {\\mathbb Z}$ is {\\em 2-flipping} if it factors through the action $H\\stackrel{\\rho_0}{{\\curvearrowright}} {\\mathbb Z}$ via an epimorphism $K\\to H$.\n\\end{definition}\n\n\\begin{lem}\n\\label{not conjugate}\nLet $\\rho_K:K{\\curvearrowright} {\\mathbb Z}$ be a 2-flipping action. Then $\\rho_K$ is not conjugate to an action by isometries on ${\\mathbb Z}$ (with respect to the word metric on ${\\mathbb Z}$).\n\\end{lem}\n\n\\begin{proof}\nSuppose there exists a permutation $p:{\\mathbb Z}\\to {\\mathbb Z}$ which conjugates $\\rho_K$ to an isometric action. Let $h:K\\to G$ be the epimorphism in Definition~\\ref{standard action}. Pick $k_1,k_2\\in K$ such that $h(k_1)$ is of order $2$ and $h(k_2)$ is of order infinity. Then $pk_1p^{-1}$ is a reflection of ${\\mathbb Z}$ and $pk_2p^{-1}$ is a translation. However, this is impossible since $h(k_1)$ and $h(k_2)$ commute. \n\\end{proof}\n\n\\begin{lem}\n\\label{not compactible}\nThere does not exists an action $\\rho_K:K{\\curvearrowright} {\\mathbb Z}$ by $(L,A)$-quasi-isometries with the following property. $K$ has two subgroup $K_1$ and $K_2$ such that $\\rho_K|_{K_1}$ is conjugate to a 2-flipping action and $\\rho_K|_{K_2}$ is conjugate to a transitive action on ${\\mathbb Z}$ by translations.\n\\end{lem}\n\n\\begin{proof}\nBy Proposition~\\ref{key lemma}, there exists an isometric action $\\rho'_K:K{\\curvearrowright} {\\mathbb Z}$ and a $K$-equivariant surjective map $f:K\\stackrel{\\rho_K}{{\\curvearrowright}} {\\mathbb Z}{\\longrightarrow}\nK\\stackrel{\\rho'_K}{{\\curvearrowright}}{\\mathbb Z}$. We claim $f$ is also injective. Given this claim, we can deduce a contradiction to Lemma~\\ref{not conjugate} by restricting the action to $K_1$. To see the claim, we restrict the action to $K_2$. Thus we can assume without loss of generality that $\\rho_K$ is a transitive action by translations. Suppose $f(a_1)=f(a_1+k)$ for $a_1,k\\in{\\mathbb Z}$ and $k\\neq 0$. Then the equivariance of $f$ implies $f(a_1)=f(a_1+nk)$ for any integer $n\\in {\\mathbb Z}$, which contradicts that $f$ is a quasi-isometry.\n\\end{proof}\n\n\n\n\\begin{theorem}\nSuppose $G({\\Gamma})$ is a RAAG with $|{\\operatorname{Out}}(G({\\Gamma}))|<\\infty$ and $G({\\Gamma})\\not\\simeq{\\mathbb Z}$.\nThen there is a pair $H, H'$ of finitely generated groups quasi-isometric to \n$G({\\Gamma})$ that does not admit discrete, virtually faithful cocompact\nrepresentations into\nthe same locally compact topological group.\n\\end{theorem} \n\nRecall that a discrete, virtually faithful cocompact representation from $H$ to a locally compact group $\\hat{G}$ is a homomorphism $h:H\\to\\hat{G}$ such that its kernel is finite, and its image is a cocompact lattice.\n\n\\begin{proof}\nPick a vertex $u\\in {\\Gamma}$ and let ${\\Gamma}'$ be a graph obtained by taking two copies of ${\\Gamma}$ and gluing them along the closed star of $u$. There is a graph automorphism $\\alpha:{\\Gamma}'\\to{\\Gamma}'$ which fixes the closed star of $u$ pointwise and flips the two copies of ${\\Gamma}$. Then $\\alpha$ induces an involution $\\alpha:G({\\Gamma}')\\to G({\\Gamma}')$, which gives rise to a semi-product $H=G({\\Gamma}')\\rtimes {\\mathbb Z}/2$. \n\nNote that $G({\\Gamma}')$ is a subgroup of index 2 in both $G({\\Gamma})$ and $H$.  Therefore\nthis induces a quasi-isometry $q:H\\to G({\\Gamma})$, an also a quasi-action $\\rho_{H}:H{\\curvearrowright} G({\\Gamma})$. By the previous discussion, we can assume $\\rho_H$ is an action by flat-preserving quasi-isometries. We look at the associated collection of factor actions $\\{H_{\\lambda}{\\curvearrowright} {\\mathbb Z}\\}_{\\lambda\\in\\Lambda}$ (see Definition~\\ref{factor action}), recall that $\\Lambda$ is the collection of parallel classes of rank 1 residues in $G({\\Gamma})$, and a rank 1 residue in some class $\\lambda$ can be identified with a copy of ${\\mathbb Z}$. Up to conjugacy by bijective quasi-isometries, these factor actions are either transitive actions on ${\\mathbb Z}$ or 2-flipping actions.\n\nWe claim that $G({\\Gamma})$ and $H$ do not admit discrete, virtually faithful cocompact representations into the same locally compact topological group. Suppose such a topological group $\\hat{G}$ exists. Then by \\cite[Chapter 6]{mosher2003quasi}, $\\hat{G}$ has a quasi-action on $G({\\Gamma})$. We assume $\\hat{G}$ acts on $G({\\Gamma})$ by flat-preserving quasi-isometries as before. Then there are restriction actions $\\rho'_{G({\\Gamma})}:G({\\Gamma}){\\curvearrowright} G({\\Gamma})$ and $\\rho'_H:H{\\curvearrowright} G({\\Gamma})$ which are discrete and cobounded. Since any two discrete and cobounded quasi-actions $H{\\curvearrowright} G({\\Gamma})$ are quasi-conjugate, it follows from Theorem~\\ref{thm_intro_vertex_rigidity} that $\\rho_H$ and $\\rho'_{H}$ are conjugate by a flat-preserving quasi-isometry. Thus factor actions of $\\rho'_H$ is conjugate to factor actions of $\\rho_H$ by bijective quasi-isometries. Similarly, we deduce that the factor actions of $\\rho'_{G({\\Gamma})}$ are conjugate to transitive actions by left translations on ${\\mathbb Z}$ via bijective quasi-isometries. Note that the factor actions of $\\rho'_{G({\\Gamma})}$ and the factor actions of $\\rho'_H$ are both restrictions of factor actions of $\\hat{G}{\\curvearrowright} G({\\Gamma})$, however, this is impossible by Lemma~\\ref{not compactible}.\n\\end{proof}\n\n\\begin{cor}\n\\label{no action}\nThe group $H=G({\\Gamma}')\\rtimes {\\mathbb Z}/2$ cannot act geometrically on $X({\\Gamma})$.\n\\end{cor}\n\nWe now give a criterion for when one can quasi-conjugate a quasi-action on $X({\\Gamma})$ to an isometric action $H{\\curvearrowright} X({\\Gamma})$. \n\\begin{thm}\n\\label{isometric action}\nLet $\\rho:H{\\curvearrowright} G({\\Gamma})$ be an action by flat-preserving bijections. If for each $\\lambda\\in\\Lambda$, the factor action $\\rho_{\\lambda}:H_{\\lambda}{\\curvearrowright}{\\mathbb Z}$ can be conjugate to an action by isometries with respect to the word metric of ${\\mathbb Z}$, then there is an flat-preserving bijection $g:G({\\Gamma})\\to G({\\Gamma})$ which conjugates $\\rho:H{\\curvearrowright} G(\\Gamma)$ to an action $\\rho':H{\\curvearrowright} X(\\Gamma)$ by flat-preserving isometries. If $\\rho$ is also an action by $(L,A)$-quasi-isometries, then $g$ can be taken to be a quasi-isometry.\n\\end{thm}\n\n\\begin{proof}\nWe repeat the construction in Section~\\ref{subsec_cubulation} and assume each $h_{{\\mathcal R}}:{\\mathcal R}\\to{\\mathbb Z}^{T({\\mathcal R})}$  is a bijection. Let $q:Y\\to |{\\mathcal{B}}|$, $Y_0$, $q^{-1}:G({\\Gamma})\\to Y_0$ and the action $\\hat{\\rho}:H{\\curvearrowright} Y$ by automorphisms be as in Section~\\ref{subsec_cubulation}. Recall that $q^{-1}$ is $H$-equivariant. There is an isomorphism $i:Y\\to X_e$ by Theorem~\\ref{isomorphic to canonical blow-up}, moreover, $i(Y_0)$ is exactly the collection of $0$-dimensional standard flats $X_0$ in $X_e$. We deduce from the construction of $i$ that the isometric action $H{\\curvearrowright} X_e$ induced by $\\hat{\\rho}$ preserves standard flats in $X_e$. By the construction of $X_e$, there exists a natural identification $f:X_0\\to G({\\Gamma})$ such that any automorphism of $X_e$ which preserves its standard flats induces a flat-preserving isometry of $G({\\Gamma})$ (with respect to the word metric) via $f$. It suffices to take $g=f\\circ i\\circ q^{-1}$. \n\\end{proof}\n\nSuppose we have already conjugated the flat-preserving action $\\rho:H{\\curvearrowright} G(\\Gamma)$ to an action $\\rho':H{\\curvearrowright} X(\\Gamma)$ (or $H{\\curvearrowright} G(\\Gamma)$) by flat-preserving isometries. We ask whether it is possible to further conjugate $\\rho'$ to an action by left translations. \n\nWe can oriented each 1-cell in $S({\\Gamma})$ and label it by the associated generator. This lifts to orientations and labels of edges of $X({\\Gamma})$. If $H$ preserves this orientation and labelling, then $\\rho'$ is already an action by left translations. In general, it suffices to require $H$ preserves a possibly different orientation and labelling which satisfy several compatibility conditions. Now we recall the following definitions from \\cite{huang2014quasi}.\n\n\\begin{definition}[Coherent ordering]\nA \\textit{coherent ordering} for $G({\\Gamma})$ is a blow-up data for $G({\\Gamma})$ such that each map $h_{{\\mathcal R}}$ is a bijection. Two coherent orderings are \\textit{equivalent} if the their maps agree up to translations.\n\\end{definition}\n\nLet $\\mathcal{P}({\\Gamma})$ be the extension complex defined in Section~\\ref{subsec_raag}. Note that we can identify $\\Lambda_{G({\\Gamma})}$ with the $0$-skeleton of ${\\mathcal P}({\\Gamma})$. Any flat-preserving action $H{\\curvearrowright} G(\\Gamma)$ induces an action $H{\\curvearrowright}\\mathcal{P}({\\Gamma})$ by simplicial isomorphisms. Let $F(\\Gamma)$ be the flag complex of ${\\Gamma}$.\n\n\\begin{definition}[Coherent labelling]\nRecall that for each vertex $x\\in X({\\Gamma})$, there is a natural simplicial embedding $i_{x}:F({\\Gamma})\\to\\mathcal{P}({\\Gamma})$ by considering the standard flats passing through $x$. A \\textit{coherent labelling} of $G({\\Gamma})$ is a simplicial map $L:\\mathcal{P}({\\Gamma})\\to F({\\Gamma})$ such that $L\\circ i_{x}: F(\\Gamma)\\to F(\\Gamma)$ is a simplicial isomorphism for every vertex $x\\in X(\\Gamma)$.\n\\end{definition}\n\nThe next result follows from \\cite[Lemma 5.7]{huang2014quasi}.\n\n\\begin{lem}\n\\label{action by translation}\nLet $\\rho':H{\\curvearrowright} G(\\Gamma)$ be an action by flat-preserving bijections and let $H{\\curvearrowright}\\mathcal{P}({\\Gamma})$ be the induced action. If there exists an $H$-invariant coherent ordering and an $H$-invariant coherent labelling, then $\\rho'$ is conjugate to an action by left translations.\n\\end{lem}\n\nSince each vertex of ${\\mathcal P}({\\Gamma})$ corresponds to a parallel class of $v$-residues for vertex $v\\in{\\Gamma}$, this gives a labelling of vertices of ${\\mathcal P}({\\Gamma})$ by vertices of ${\\Gamma}$. We can extend this labelling map to a simplicial map $L:\\mathcal{P}({\\Gamma})\\to F({\\Gamma})$, which gives rise to a coherent labelling.\n \n\\begin{cor}\nLet $\\rho:H{\\curvearrowright} G(\\Gamma)$ be an action by flat-preserving bijections. Suppose: \n\\begin{enumerate}\n\\item The induced action $H{\\curvearrowright}{\\mathcal P}({\\Gamma})$ preserves the vertex labelling of ${\\mathcal P}({\\Gamma})$ as above.\n\\item For each vertex $v\\in\\mathcal{P}(\\Gamma)$, the action $\\rho_{v}:H_{v}{\\curvearrowright} {\\mathbb Z}$ is conjugate to an action by translations.\n\\end{enumerate}\nThen $\\rho$ is conjugate to an action $H{\\curvearrowright} G(\\Gamma)$ by left translations.\n\\end{cor}\nNote that condition (2) is equivalent to the existence of an $H$-invariant coherent ordering.\n\n\n\n\n\n\n\\section{Actions by quasi-isometries on $\\Bbb Z$}\n\\label{sec_quasi action on Z}\nIn this section we prove Proposition \\ref{key lemma}.\n\n\n\n\\subsection{Tracks}\n\\label{subsec_track}\nTracks were introduced in \\cite{dunwoody1985accessibility}. They are hypersurface-like objects in 2-dimensional simplicial complexes.\n\n\n\\begin{definition}[Tracks]\nLet $K$ be 2-dimensional simplicial complex. A \\textit{track} $\\tau\\subset K$ is a connected embedded finite simplicial graph such that:\n\\begin{enumerate}\n\\item For each 2-simplex $\\Delta\\subset K$, $\\tau\\cap\\Delta$ is a finite disjoint union of curves such that the end points of each curve are in the interior of edges of $\\Delta$.\n\\item For each edge $e\\in K$, $\\tau\\cap e$ is a discrete set in the interior of $e$. Let $\\{\\Delta_{\\lambda}\\}_{\\lambda\\in\\Lambda}$ be the collection of 2-simplices that contains $e$. If $v\\in \\tau\\cap e$, then for each $\\lambda$, $\\tau\\cap\\Delta_{\\lambda}$ contains a curve that contains $v$.\n\\end{enumerate}\n\\end{definition}\n\nGiven a track $\\tau\\subset K$, we defined the \\textit{support} of $\\tau$, denoted Spt$(\\tau)$, to be the minimal subcomplex of $K$ which contains $\\tau$.\n\nWe can view hyperplanes defined in Section \\ref{subsec_cube complex} as analogue of tracks in the cubical setting. Each track $\\tau\\subset K$ has a regular neighbourhood which fibres over $\\tau$. When $K$ is simply-connected, $K\\setminus\\tau$ has two connected components, moreover, the regular neighbourhood of $\\tau$ is homeomorphic to $\\tau\\times(-\\epsilon,\\epsilon)$. \n\nTwo tracks $\\tau_{1}$ and $\\tau_{2}$ are \\textit{parallel} if $\\textmd{Spt}(\\tau_{1})=\\textmd{Spt}(\\tau_{2})$ and there is a region homeomorphic to $\\tau_{1}\\times(0,\\epsilon)$ bounded by $\\tau_{1}$ and $\\tau_{2}$. A track $\\tau\\subset K$ is \\textit{essential} if the components of $K\\setminus\\tau$ are unbounded. The following result follows from \\cite[Proposition 3.1]{dunwoody1985accessibility}:\n\\begin{lem}\nIf $K$ is simply-connected and has more than one end, then there exists an essential track $\\tau\\subset K$.\n\\end{lem}\n\nNext we look at essential tracks which are \\textquotedblleft minimal\\textquotedblright;\nthese turn out to behave like minimal surfaces. First we metrize $K$ as in \\cite{scott1996algebraic}.\n\nLet $\\Delta=\\Delta(\\xi_{1}\\xi_{2}\\xi_{3})$ be an ideal triangle in the hyperbolic plane. We mark a point in each side of the triangle as follows. Let $\\phi$ be the unique isometry which fixes $\\xi_{3}$ and flips $\\xi_{1}$ and $\\xi_{2}$, we mark the unique point in $\\overline{\\xi_{1}\\xi_{2}}$ which is fixed by $\\phi$. Other sides of $\\Delta$ are marked similarly. This is called a \\textit{marked ideal triangle}.\n\nWe identify each 2-simplex of $K$ with a marked ideal triangle in the hyperbolic plane and glue these triangles by isometries which identify the marked points. This gives a collection of complete metrics on each connected component of $K-K^{(0)}$ which is not an interval. We denote this collection of metrics by $d_{{\\mathbb H}}$. If a group $G$ acts on $K$ by simplicial isomorphisms, then $G$ also acts by isometries on $(K,d_{{\\mathbb H}})$. The original definition in \\cite{scott1996algebraic} does not required these marked points, see Remark \\ref{why marked} for why we add them.\n\nEach track $\\tau$ has a well-defined length under $d_{{\\mathbb H}}$, which we denote by $l(\\tau)$. We also define the \\textit{weight} of $\\tau$, denoted by $w(\\tau)$, to be cardinality of $\\tau\\cap K^{(1)}$. The \\textit{complexity} $c(\\tau)$ is defined to be the ordered pair $(w(\\tau),l(\\tau))$. We order the complexity lexicographically, namely $c(\\tau_{1})<c(\\tau_{2})$ if and only if $w(\\tau_{1})<w(\\tau_{2})$ or $w(\\tau_{1})=w(\\tau_{2})$ and $l(\\tau_{1})<l(\\tau_{2})$. \n\nThe following result follows from \\cite[Lemma 2.11 and Lemma 2.14]{scott1996algebraic}:\n\\begin{lem}\n\\label{cocompact minimal}\nSuppose $K$ is a uniformly locally finite and simply-connected simplicial 2-complex with at least two ends. Suppose $K$ does not contain separating vertices. Then there exists an essential track $\\tau\\subset K$ which has the least complexity with respect to $d_{{\\mathbb H}}$ among all essential tracks in $K$.\n\\end{lem}\n\n\\begin{remark}\n\\label{why marked}\nLet $\\{\\tau_{i}\\}_{i=1}^{\\infty}$ be a minimizing sequence. Since $K$ is uniformly locally finite, there are only finitely many combinatorial possibilities for $\\{\\tau_{i}\\}_{i=1}^{\\infty}$. Thus we can assume all the $\\tau_{i}$'s are inside a finite subcomplex $L$. Moreover, we can construct a hyperbolic metric $d_{{\\mathbb H}}$ on $L$ as above and it suffices to work in the space $(L,d_{{\\mathbb H}})$. However, if we do not use marked points in the construction of the hyperbolic metric on $K$, then each $\\tau_{i}$ may sit inside a copy of $L$ with different shears along the edges of $L$.\n\nIn \\cite{scott1996algebraic}, $K$ is assumed to be cocompact, so one does not need to worry about the above issue.\n\\end{remark}\n\n\\begin{remark}\nIf we metrize each simplex in $K$ with the Euclidean metric, then Lemma \\ref{cocompact minimal} and Lemma \\ref{subcomplex minimal} may not be true.  For example,\none can take the following picture, where the dotted line is part of some track $\\tau$. Once we shorten $\\tau$, it may hit the central vertex of the hexagon. However, this cannot happen if we have hyperbolic metrics on each simplex. Once $\\tau$ gets too close to some vertex, then it takes a large amount of length for $\\tau$ to escape that vertex since $d_{{\\mathbb H}}$ is complete (actually it does not matter if $d_{{\\mathbb H}}$ is not complete, since we also have a upper bound on the weight of $\\tau$).\n\\begin{center}\n\\includegraphics[scale=0.5]{3.png}\n\\end{center}\n\\end{remark}\n\nThe next result can be proved in a similar fashion:\n\n\\begin{lem}\n\\label{subcomplex minimal}\nLet $K$ be a simply-connected simplicial 2-complex. Let $A\\subset K$ be a uniformly locally finite subcomplex such that \n\\begin{enumerate}\n\\item $A$ contains an essential track of $K$.\n\\item $A$ does not contain any separating vertex of $K$.\n\\end{enumerate}\nThen there exists an essential track $\\tau$ of $K$ which has the least complexity among all essential tracks of $K$ with support in $A$.\n\\end{lem}\n\n\n\n\\begin{lem} \\cite[Lemma 2.7]{scott1996algebraic}\n\\label{disjoint}\nLet $\\tau_{1}$ and $\\tau_{2}$ be two essential tracks of $K$ which are minimal in the sense of Lemma \\ref{cocompact minimal} or Lemma \\ref{subcomplex minimal}, then either $\\tau_{1}=\\tau_{2}$, or $\\tau_{1}\\cap\\tau_{2}=\\emptyset$.\n\\end{lem}\n\n\\subsection{The proof of Proposition \\ref{key lemma}} First we briefly recall the notion of Rips complex. See \\cite[Chapter III.$\\Gamma$.3]{bridson_haefliger} for more detail. Let $(X,d)$ be a metric space and pick $R>0$. The \\textit{Rips complex} $P_{R}(X,d)$ is the geometric realization of the simplicial complex with vertex set $X$ whose $n$-simplices are the $(n+1)$-element subsets $\\{x_{0},\\cdots,x_{n}\\}\\subset X$ of diameter at most $R$.\n\nLet $d$ be the usual metric on $\\Bbb Z$. Define a new metric $\\bar{d}$ on $\\Bbb Z$ by \n\n", "itemtype": "equation", "pos": 113616, "prevtext": "\nThe following is a consequence of (2) of Lemma \\ref{compactible with parallelism}.\n\n\\begin{cor}\n\\label{compactible with product}\nThe map $f_{{\\mathcal R}_u}$ satisfies $f_{{\\mathcal R}_u}=i\\circ(\\prod_{i=1}^{k}f_{{\\mathcal R}_i})\\circ g$, where $g:{\\mathcal R}_u\\to\\prod_{i=1}^{k}{\\mathcal R}_i$ is the map in Theorem \\ref{product decomposition}. In this case, we will write $f_{{\\mathcal R}_u}=\\prod_{i=1}^{k}f_{{\\mathcal R}_i}$ for simplicity.\n\\end{cor}\n\nPick $J'\\subset J$ and let ${\\mathcal R}_u'$ be a $J'$-residue in ${\\mathcal R}_u$. By Theorem~\\ref{product decomposition}, ${\\mathcal R}_u'=\\prod_{i\\in J'}{\\mathcal R}_i\\times\\prod_{i\\notin J'}\\{a_{i}\\}$ for $a_{i}\\in {\\mathcal R}_i$. Then the following is a consequence of Corollary \\ref{compactible with product} and the functorality of $\\Phi'$.\n\\begin{cor}\n\\label{morphism in terms of product}\nLet $h$ be the morphism between $\\Phi'({\\mathcal R}_{u'})$ and $\\Phi'({\\mathcal R}_u)=\\Phi'({\\mathcal R}_{u'})\\times\\prod_{i\\notin J'}\\Phi'({\\mathcal R}_i)$. Then for $x\\in \\Phi'({\\mathcal R}_{u'})$, we have $h(x)=\\{x\\}\\times \\prod_{i\\notin J'}\\{f_{{\\mathcal R}_i}(a_{i})\\}$.\n\\end{cor}\n\n\\subsection{Construction of the ${\\mathbb Z}$-blow-up}\n\\label{subsection_input for Z-blow-up}\n\nIn the previous section, we started from a restriction quotient $q:Y'\\to|{\\mathcal{B}}|$, and produced associated 1-data (Definition~\\ref{1-data}), which is compatible with parallelism in the sense of Lemma~\\ref{compactible with parallelism}. In this section, we will consider the inverse, namely we want construct a restriction quotient from this data. \n\nLet $\\Lambda_{{\\mathcal{B}}}$ be the collection of parallel sets of $i$-residues in ${\\mathcal{B}}$ ($i$ could be any element in $I$). There is another type map $T$ which maps a spherical $J$-residue ${\\mathcal R}$ to $\\{\\lambda\\in\\Lambda_{{\\mathcal{B}}}\\mid$ $\\lambda$ contains a representative in ${\\mathcal R}\\}$. In other words, let ${\\mathcal R}\\cong\\prod_{i\\in I}{\\mathcal R}_i$ be the product decomposition as in Theorem \\ref{product decomposition}, where each ${\\mathcal R}_i$ is an $i$-residue in ${\\mathcal R}$ ($i\\in J$). Then $T({\\mathcal R})$ is the collection of parallel sets represented by those ${\\mathcal R}_i$'s. Let ${\\mathbb Z}^{T({\\mathcal R})}$ be the collection of maps from $T({\\mathcal R})$ to ${\\mathbb Z}$, and let ${\\mathbb Z}^{\\emptyset}$ be a single point. \n\n\n\nOur goal in this section is to construct a restriction quotient from the following data.\n\\begin{definition}[Blow-up data]\n\\label{input data}\nFor each $i$-residue ${\\mathcal R}\\subset{\\mathcal{B}}$, we associate a map $h_{{\\mathcal R}}:{\\mathcal R}\\to{\\mathbb Z}^{T({\\mathcal R})}$ such that if two $i$-residues ${\\mathcal R}_1$ and ${\\mathcal R}_2$ are parallel, let $h_{12}:{\\mathcal R}_1\\to{\\mathcal R}_2$ be the parallelism map, then $h_{{\\mathcal R}_1}=h_{{\\mathcal R}_2}\\circ h_{12}$. \n\\end{definition}\n\nIf ${\\mathcal R}$ is a spherical residue with  product decomposition given by ${\\mathcal R}\\cong\\prod_{i\\in I}{\\mathcal R}_i$, then the maps $h_{{\\mathcal R}_{i}}:{\\mathcal R}_{i}\\to{\\mathbb Z}$ induces a map $h_{{\\mathcal R}}:{\\mathcal R}\\to {\\mathbb Z}^{T({\\mathcal R})}$. It follows from the definition of $h_{{\\mathcal R}}$, and the discussion after Definition \\ref{definition_parallel} that if ${\\mathcal R},{\\mathcal R}'\\in C$ are parallel and let $h:{\\mathcal R}\\to{\\mathcal R}'$ be the parallelism map, then $h_{{\\mathcal R}}=h_{{\\mathcal R}'}\\circ h$.\n\nThe following result is a consequence of Theorem \\ref{product decomposition}:\n\n\\begin{lem}\nLet ${\\mathcal T}\\in C$ be an $H$-residue. Let $g:{\\mathcal T}\\cong\\prod_{i=1}^{n}{\\mathcal T}_i$ be the product decomposition induced by $H=\\sqcup_{i=1}^{n}H_i$ (see Theorem \\ref{product decomposition}). Then $h_{{\\mathcal T}}=(\\prod_{i=1}^{n}h_{{\\mathcal T}_i})\\circ g$.\n\\end{lem}\n\nTo simplify notation, we will write $h_{{\\mathcal T}}=\\prod_{i=1}^{n}h_{{\\mathcal T}_i}$ instead of $h_{{\\mathcal T}}=(\\prod_{i=1}^{n}h_{{\\mathcal T}_i})\\circ g$.\n\nLet $J$ and ${\\mathcal R}=\\prod_{i\\in J}{\\mathcal R}_i$ be as before. A $J'$-residue ${\\mathcal R}'\\subset{\\mathcal R}$ can be expressed as $(\\prod_{i\\in J'}{\\mathcal R}_i)\\times(\\prod_{i\\in J\\setminus J'}\\{c_i\\})$, here $c_i$ is a chamber in ${\\mathcal R}_i$. We define an inclusion $h_{{\\mathcal R}'{\\mathcal R}}:{\\mathbb Z}^{T({\\mathcal R}')}\\rightarrow{\\mathbb Z}^{T({\\mathcal R})}$ by $h_{{\\mathcal R}'{\\mathcal R}}(a)=\\{a\\}\\times \\prod_{i\\in J\\setminus J'}\\{h_{{\\mathcal R}_i}(c_i)\\}$. Since $h_{{\\mathcal R}}=h_{{\\mathcal R}'}\\times(\\prod_{i\\in J\\setminus J'}h_{{\\mathcal R}_i})$, $h_{{\\mathcal R}'{\\mathcal R}}$ fits into the following commutative diagram:\n\\begin{center}\n$\\begin{CD}\n{\\mathcal R}'                         @>>>       {\\mathcal R}\\\\\n@Vh_{{\\mathcal R}'}VV                                   @Vh_{{\\mathcal R}}VV\\\\\n{\\mathbb Z}^{T({\\mathcal R}')}        @>h_{{\\mathcal R}'{\\mathcal R}}>>        {\\mathbb Z}^{T({\\mathcal R})}\n\\end{CD}$\n\\end{center}\nSuppose ${\\mathcal R}''$ is a $J''$-residue such that ${\\mathcal R}''\\subset{\\mathcal R}'\\subset{\\mathcal R}$. Since $h_{{\\mathcal R}}=h_{{\\mathcal R}'}\\times(\\prod_{i\\in J\\setminus J'}h_{{\\mathcal R}_i})=h_{{\\mathcal R}''}\\times (\\prod_{i\\in J'\\setminus J''}h_{{\\mathcal R}_i})\\times (\\prod_{i\\in J\\setminus J'}h_{{\\mathcal R}_i})$, we have\n\n", "index": 19, "text": "\\begin{equation}\n\\label{composition}\nh_{{\\mathcal R}''{\\mathcal R}}=h_{{\\mathcal R}'{\\mathcal R}}\\circ h_{{\\mathcal R}''{\\mathcal R}'}.\n\\end{equation}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E3.m1\" class=\"ltx_Math\" alttext=\"h_{{\\mathcal{R}}^{\\prime\\prime}{\\mathcal{R}}}=h_{{\\mathcal{R}}^{\\prime}{%&#10;\\mathcal{R}}}\\circ h_{{\\mathcal{R}}^{\\prime\\prime}{\\mathcal{R}}^{\\prime}}.\" display=\"block\"><mrow><mrow><msub><mi>h</mi><mrow><msup><mi class=\"ltx_font_mathcaligraphic\">\u211b</mi><mi>\u2032\u2032</mi></msup><mo>\u2062</mo><mi class=\"ltx_font_mathcaligraphic\">\u211b</mi></mrow></msub><mo>=</mo><mrow><msub><mi>h</mi><mrow><msup><mi class=\"ltx_font_mathcaligraphic\">\u211b</mi><mo>\u2032</mo></msup><mo>\u2062</mo><mi class=\"ltx_font_mathcaligraphic\">\u211b</mi></mrow></msub><mo>\u2218</mo><msub><mi>h</mi><mrow><msup><mi class=\"ltx_font_mathcaligraphic\">\u211b</mi><mi>\u2032\u2032</mi></msup><mo>\u2062</mo><msup><mi class=\"ltx_font_mathcaligraphic\">\u211b</mi><mo>\u2032</mo></msup></mrow></msub></mrow></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.00946.tex", "nexttext": "\nNote that $(\\Bbb Z,\\bar{d})$ is quasi-isometric to $(\\Bbb Z,d)$, and $G$ acts on $(\\Bbb Z,\\bar{d})$ by isometries. Since $(\\Bbb Z,\\bar{d})$ is Gromov-hyperbolic, the Rips complex $P_{R}(\\Bbb Z,\\bar{d})$ is contractible for some $R=R(L,A)$ (see \\cite[Proposition III.$\\Gamma$.3.23]{bridson_haefliger}). Let $K$ be the 2-skeleton of $P_{R}(\\Bbb Z,\\bar{d})$. Then $K$ is simply-connected, uniformly locally finite and 2-ended. \n\nWe make $K$ a piecewise Euclidean complex by identifying each 2-face with an equilateral triangle and identifying each edge with $[0,1]$. Let $d_{\\Bbb E}$ be the resulting length metric. There is an inclusion map $i:(\\Bbb Z,d)\\to (K,d_{\\Bbb E})$ which is a quasi-isometry with  quasi-isometry constants depending only on $L$ and $A$.\n \n\\begin{claim}\n\\label{claim_exist_tracks}\nThere exist $D_{1}=D_{1}(L,A)$ and a collection of disjoint essential tracks $\\{\\tau_{i}\\}_{i\\in I}$ of $K$ such that\n\\begin{enumerate}\n\\item $\\{\\tau_{i}\\}_{i\\in I}$ is $G$-invariant.\n\\item The diameter of each $\\tau_i$  with respect to $d_{{\\mathbb E}}$ is $\\le D_{1}$.\n\\item Each connected component of $K\\setminus(\\cup_{i\\in I}\\tau_{i})$ has diameter $\\le D_{1}$.\n\\end{enumerate}\n\\end{claim}\n\nIn the following proof, we denote the ball of radius $D$ centered at $x$ in $K$ with respect to $d_{{\\mathbb E}}$ by $B_{{\\mathbb E}}(x,D)$. Let ${\\operatorname{diam}}_{{\\mathbb E}}$ be the diameter with respect to $d_{{\\mathbb E}}$.\n\n\\begin{proof}[Proof of Claim \\ref{claim_exist_tracks}]\nFirst we assume $K$ does not have separating vertices. Since $K$ is quasi-isometric to ${\\mathbb Z}$, there exists $D=D(L,A)$ such that $K\\setminus B_{{\\mathbb E}}(x,D)$ has at least two unbounded components for each $x\\in K$. Thus every $(D+1)$-ball contains an essential track with  weight bounded above by $D'=D'(L,A)$. We put a $G$-invariant hyperbolic metric $d_{{\\mathbb H}}$ on $K$ as in Section \\ref{subsec_track}. By Lemma \\ref{cocompact minimal}, there exists an essential track $\\tau\\subset K$ of least complexity. Note that ${\\operatorname{diam}}_{{\\mathbb E}}(\\tau)\\le D'$ since the weight $w(\\tau)\\le D'$. Lemma \\ref{disjoint} implies the $G$-orbits of $\\tau$ give rise to collection of disjoint essential tracks in $K$.\n\n\nA collection of tracks $\\{\\tau_{i}\\}_{i\\in I}$ of $K$ is \\textit{admissible} if\n\\begin{enumerate}\n\\item Each track in $\\{\\tau_{i}\\}_{i\\in I}$ is essential and different tracks have empty intersection.\n\\item No two tracks in $\\{\\tau_{i}\\}_{i\\in I}$ are parallel.\n\\item The collection $\\{\\tau_{i}\\}_{i\\in I}$ is $G$-invariant.\n\\item ${\\operatorname{diam}}_{{\\mathbb E}}(\\tau_{i})\\le D'$ for each $i\\in I$.\n\\end{enumerate} \nThere exists a non-empty admissible collection of tracks by previous discussion.\n\nLet $\\{\\tau_{i}\\}_{i\\in I}$ be a maximal admissible collection of tracks. Then this collection satisfies the above claim with $D_{1}=2D'+5D$. To see this, let $C$ be one connected component of $K\\setminus(\\cup_{i\\in I}\\tau_{i})$. Since each track is essential and $K$ is 2-ended, either ${\\operatorname{diam}}_{{\\mathbb E}}(C)< \\infty$ and $\\bar{C}\\setminus C$ ($\\bar{C}$ is the closure of $C$) is made of two tracks $\\tau_{1}$ and $\\tau_{2}$, or ${\\operatorname{diam}}_{{\\mathbb E}}(C)=\\infty$ and $\\bar{C}\\setminus C$ is made of one track. Let us assume the former case is true. The latter case can be dealt in a similar way. Let $A$ be the maximal subcomplex of $K$ which is contained in $C$. Then $A$ is uniformly locally finite and $C\\setminus A$ is contained in the 1-neighbourhood of $\\tau_{1}\\cup\\tau_{2}$.\n\nSuppose ${\\operatorname{diam}}_{{\\mathbb E}}(C)\\ge 2D'+5D$. Since ${\\operatorname{diam}}_{{\\mathbb E}}(\\tau_{i})\\le D'$ for $i=1,2$, there exists $x\\in A$ such that $B_{{\\mathbb E}}(x,2D)\\subset A$. Thus $A$ contains an essential track of $X$ with its weight bounded above by $D'$. Let $\\eta\\subset A$ be an essential track of $K$ which has the least complexity in the sense of Lemma \\ref{subcomplex minimal}, then $w(\\eta)\\le D'$, hence ${\\operatorname{diam}}_{{\\mathbb E}}(\\eta)\\le D'$. Moreover, by Lemma \\ref{disjoint}, for each $g\\in {\\operatorname{Stab}}(A)={\\operatorname{Stab}}(C)$, either $g\\cdot\\eta=\\eta$ or $g\\cdot\\eta\\cap\\eta=\\emptyset$. Thus we can enlarge the original admissible collection of tracks by adding the $G$-orbits of $\\eta$, which yields a contradiction.\n\nThe case when $K$ has separating vertices is actually easier, since one can find essential tracks on the $\\epsilon$-sphere of each separating vertices. The rest of the proof is identical.\n\\end{proof}\n\nWe now continue with the proof of Proposition \\ref{key lemma}.\n\nPick a regular neighbourhood $N(\\tau_{i})$ for each $\\tau_{i}$ such that collection $\\{N(\\tau_{i})\\}_{i\\in I}$ is disjoint and $G$-invariant. Then we define a map $\\phi$ from $K$ to a tree $T$ by collapsing each component of $Y\\setminus\\cup_{i\\in I}N(\\tau_{i})$ to a vertex and collapsing each $N(\\tau_{i})$, which is homeomorphic to $\\tau_{i}\\times (0,1)$, to the $(0,1)$ factor. It is easy to make $\\phi$ equivariant under $G$, and by the above claim, $\\phi$ is a quasi-isometry with  quasi-isometry constants depending only on $L$ and $A$. Note that $T$ is actually a line since $\\tau$ is essential and $K$ is 2-ended. Then Proposition \\ref{key lemma} follows by considering the $G$-equivariant map $\\phi\\circ i:(\\Bbb Z,d)\\to T$. \n\n\\begin{remark}\nIf the action $G\\curvearrowright\\Bbb Z$ by $(L,A)$-quasi-isometries in Proposition \\ref{key lemma} is not cobounded, then the resulting isometric action $\\Lambda:G{\\curvearrowright}{\\mathbb Z}$ is also not cobounded, hence there are two possibilities:\n\\begin{enumerate}\n\\item if $G$ coarsely preserve the orientation of ${\\mathbb Z}$, then $\\Lambda$ is trivial;\n\\item otherwise $\\Lambda$ factors through a ${\\mathbb Z}/2$-action by reflection.\n\\end{enumerate}\n\\end{remark}\n\\section*{Part II: An alternate blow-up construction for buildings}\n\n\n\\section{Blowing-up buildings by metric spaces}\n\\label{sec_blow-up building more general version}\nIn Section \\ref{sec_blow-up of building}\n we discussed a construction for blowing-up a right-angled building.  Here we give a somewhat different approach, which allows us to deal with more general situations.  It unifies several other objects discussed in this paper and has interesting applications to graph products. \n\\subsection{Construction}\n\\label{construction}\nWe are motivated by the fact that the universal cover of the Salvetti complex can obtained by gluing a collection of standard flats in a way determined by the associated building. Similarly, we can construct the universal cover of exploded Salvetti complex by gluing a collection of branched flats. Here we specify the gluing pattern, and replace standard flats or branched flats by other product structures, which allows us to generalize the construction of these objects.\n\nLet ${\\Gamma}$ be a finite simplicial graph, and let ${\\mathcal{B}}$ be a building modelled on the right-angled Coxeter group $W({\\Gamma})$ with finite defining graph ${\\Gamma}$.\n\n\\textit{Step 1:}\nFor every vertex $v$ of ${\\Gamma}$, and every \n$v$-residue $r_v\\subset {\\mathcal{B}}$, we associate a metric space $Z_{r_v}$, and a map $f_{r_v}$ which maps chambers in $r_v$ to $Z_{r_v}$. If another $v$-residue $r'_v$ is parallel to $r_v$, then we associate $r'_v$ with the same space $Z_{r_v}$, and a map $f_{r'_v}$ which is induced by $f_{r_v}$ and the parallelism between $r_v$ and $r'_v$.\n\nLet $M_{r_v}$ be the mapping cylinder of $f_{r_v}$. $M_{r_v}$ is obtained by attaching edges to $Z_{r_v}$, and the endpoints of these edges which correspond to the domain of $f_{r_v}$ are called \\textit{tips} of $M_{r_v}$. There is a 1-1 correspondence between the tips of $M_{r_v}$ and chambers in $r_v$. Each edge in $M_{r_{v}}$ has length $=1$, and $M_{r_{v}}$ is endowed with the quotient metric (see \\cite[Chapter I.5.19]{bridson_haefliger}).\n\nIn summary, for each parallel class of $v$-residues, we have associated a space $M_{r_v}$, whose tips are in 1-1 correspondence with chambers in any chosen $v$-residue in this parallel class.  The spaces $Z_{r_v}$'s and the maps $f_{r_v}$'s is called the \\textit{blow-up data} on \nbuilding ${\\mathcal{B}}$. \n\n\n\n\\textit{Step 2:}\n\nLet ${\\mathsf{S}^r}$ be the poset of spherical residues in ${\\mathcal{B}}$. We define a functor $\\Phi$ from ${\\mathsf{S}^r}$ to the category of nonempty metric spaces and isometric embeddings as follows. \n\nLet $r_J=\\prod_{j\\in J}r_j$ be the product decomposition of a spherical $J$-residue into its rank 1 residues. Define $\\Phi(r_J)=\\prod_{j\\in J}M_{r_j}$, which is the Cartesian product of the metric spaces $M_{r_j}$'s.  \n\nSuppose $r_{J'}$ is a spherical $J'$-residue such that $r_{J'}\\subset r_J$. In this case $J'\\subset J$. Moreover, $r_{J'}$ can be expressed as a product $\\prod_{j\\notin J'} u_j \\times \\prod_{j\\in J'} r_j$, here $u_j\\in r_{j}$ is a chamber. By step 1, each $u_j$ corresponds to a tip $t_j\\in M_{r_{j}}$. Then we define the morphism $\\Phi(r_{J'})\\to\\Phi(r_{J})$ to be the isometric embedding $\\prod_{j\\notin J'} t_j \\times \\prod_{j\\in J'} M_{r_j}\\to \\prod_{j\\in J}M_{r_j}$.\n\n\\textit{Step 3:}\n\nWe begin with the disjoint union\n$\\bigsqcup_{r_{J}\\in{\\mathsf{S}^r}}\\Phi(r_{J})$, and for every inclusion\n$r_{J'}\\subset r_J$, we glue $\\Phi(r_{J'})$ with a subset of $\\Phi(r_J)$ by using the map $\\Phi(r_{J'})\\to\\Phi(r_{J})$ defined in step 2.\n\n\n\n\n\nWe denote the resulting space with the quotient metric (\\cite[Definition I.5.19]{bridson_haefliger}) by $\\Pi$. $\\Pi$ is called the \\textit{blow-up} of ${\\mathcal{B}}$ with respect to the blow-up data $Z_{r_{v}}$'s and $f_{r_{v}}$'s. \n\nThe following lemma gives an alternative description of our gluing process. \n\n\\begin{lem}\n\\label{gluing criterion}\nTwo points $x_1\\in \\Phi(r_{J_1})$ and $x_2\\in \\Phi(r_{J_2})$ are glued together if and only if $r_{J}=r_{J_1}\\cap r_{J_2}\\neq \\emptyset$ and there exists a point $x\\in \\Phi(r_J)$ such that for $i=1,2$, its image under $\\Phi(r_{J})\\to\\Phi(r_{J_i})$ is $x_i$.\n\\end{lem}\n\n\\begin{proof}\nThe if direction is clear. For the only if direction, define $x_1\\sim x_2$ if the condition in the lemma is satisfied, it suffices to show $\\sim$ is an equivalence relation. However, this follows from our construction.\n\\end{proof}\n\nWe can collapse each mapping cylinder in the construction to its range, namely $M_{r_{v}}\\to Z_{r_{v}}$. This induces a collapsing $\\Pi\\to \\bar{\\Pi}$. $\\bar{\\Pi}$ is called the \\textit{reduced blow-up} of ${\\mathcal{B}}$ with respect to $Z_{r_{v}}$'s and $f_{r_{v}}$'s. \n\n\\begin{remark}\nThere is some flexibility in this construction; for example, we can also collapse certain collections of mapping cylinders and keep other mapping cylinders to obtain a \\textquotedblleft semi-reduced\\textquotedblright\\ blow-up. Also instead of requiring $\\Phi(r_J)$ to be the Cartesian product of the metric spaces $M_{r_j}$'s, we can use $l^{p}$-product for $1\\le p\\le\\infty$. We will see an example later where it is more natural to use $l^{1}$-product.\n\\end{remark}\n\nLet ${\\mathcal{B}}_1\\subset{\\mathcal{B}}$ be a residue. We restrict the blow-up data on ${\\mathcal{B}}$ to ${\\mathcal{B}}_1$ and obtain a blow-up $\\Pi_1$ of ${\\mathcal{B}}_1$. There is a natural map $\\Pi_1\\to \\Pi$, which is injective by Lemma~\\ref{gluing criterion}. If ${\\mathcal{B}}_1$ is a spherical residue, then the image of $\\Pi_1\\to \\Pi$ is a product of mapping cylinders. It is called a \\textit{standard product}, and there is a 1-1 correspondence between spherical residues in ${\\mathcal{B}}$ and standard products in $\\Pi$.\n\n\\subsection{Properties}\n\n\\begin{proposition}\n\\label{Davis}\nIf each $Z_{r_{v}}$ in the above construction is a point, then the resulting blow-up $\\Pi$ is isometric to the Davis realization of ${\\mathcal{B}}$.\n\\end{proposition}\n\n\\begin{proof}\nLet $|{\\mathcal{B}}|$ be the Davis realization of ${\\mathcal{B}}$. Let $r_{J}\\subset{\\mathcal{B}}$ be a spherical residue and let $D(r_{J})$ be the subcomplex of $|{\\mathcal{B}}|$ spanned by those vertices corresponding to residues inside $r_{J}$. Note that $D(r_{J})$ is a convex subcomplex, and there is a naturally defined isomorphism $h_{r_J}:D(r_{J})\\to \\Phi(r_{J})$. One readily verifies the following:\n\\begin{enumerate}\n\\item The collection of all such $D(r_{J})$'s covers $|{\\mathcal{B}}|$.\n\\item There is a 1-1 correspondence between $D(r_{J})$'s and $\\Phi(r_{J})$'s in step 2 of Section~\\ref{construction}.\n\\item The gluing pattern of these $D(r_{J})$'s is compatible with step 3 of Section~\\ref{construction} via the maps $h_{r_J}$'s.\n\\end{enumerate}\nIt follows that $h_{r_J}$'s induce a cubical isomorphism $|{\\mathcal{B}}|\\to \\Pi$.\n\\end{proof}\n\n\\begin{remark}\nIf each $Z_{r_{v}}$ is a point, then the corresponding reduced blow-up is a point. However, later we will see cases where the reduced blow-up is more interesting than the blow-up.\n\\end{remark}\n\nIt follows that for any blow-up $\\Pi$ of ${\\mathcal{B}}$, there is a surjective projection map from $\\Pi$ to the Davis realization of ${\\mathcal{B}}$ which is induced by collapsing each $Z_{r_{v}}$ to a point. This is called the \\textit{canonical projection}. This map is a special case of the following situation.\n\nLet $\\Pi_1$ be the blow-up of ${\\mathcal{B}}_1$ with respect to $Z_{r_{v}}$'s and $f_{r_{v}}$'s, and let $\\Pi_2$ be the blow-up of ${\\mathcal{B}}_2$ with respect to $Y_{r_{v}}$'s and $g_{r_{v}}$'s. Let $\\bar{\\Pi}_{1}$ and $\\bar{\\Pi}_{2}$ be the corresponding reduced blow-ups. Suppose: \n\\begin{enumerate}\n\\item There exists a bijection $\\eta:{\\mathcal{B}}_1\\to{\\mathcal{B}}_2$ such that both $\\eta$ and $\\eta^{-1}$ preserve spherical residues.\n\\item For each $r_{v}$, there exists a map $h_{r_{v}}:Z_{r_{v}}\\to Y_{\\eta(r_{v})}$ such that the following diagram commutes:\n\\begin{center}\n$\\begin{CD}\nr_v               @>>\\eta>       \\eta(r_v) \\\\\n@VVf_{r_v}V                              @VVg_{\\eta(r_v)}V     \\\\\nZ_{r_{v}}       @>>h_{r_{v}}>      Y_{\\eta(r_{v})}\n\\end{CD}$\n\\end{center}\n\\end{enumerate}\nThen there are induced maps $h:\\Pi_1\\to \\Pi_2$ and $\\bar{h}:\\bar{\\Pi}_{1}\\to\\bar{\\Pi}_{2}$. Let $\\eta_\\ast:|{\\mathcal{B}}_1|\\to |{\\mathcal{B}}_2|$ be the map between Davis realizations induced by $\\eta$. Then $h$ fits into the following commuting diagram:\n\\begin{center}\n$\\begin{CD}\n\\Pi_1               @>>h>       \\Pi_2 \\\\\n@VVV                              @VVV     \\\\\n|{\\mathcal{B}}_1|       @>>\\eta_{\\ast}>      |{\\mathcal{B}}_2|\n\\end{CD}$\n\\end{center}\n\nLet ${\\mathcal{B}}'\\subset{\\mathcal{B}}$ be a residue. Let $\\textmd{proj}_{{\\mathcal{B}}'}:{\\mathcal{B}}\\to{\\mathcal{B}}'$ be the projection map defined in Section~\\ref{building}. Pick a spherical residue $r\\in{\\mathcal{B}}$. Suppose $r_0=\\textmd{proj}_{r}({\\mathcal{B}}')$ and ${\\mathcal{B}}'_0=\\textmd{proj}_{{\\mathcal{B}}'}(r)$. Let $r=r_0\\times r^{\\perp}_0$ be the product decomposition of $r$. It follows from \\cite[Lemma 5.36]{abramenko2008buildings} that the map $\\textmd{proj}_{{\\mathcal{B}}'}: r\\to {\\mathcal{B}}'_0$ is a composition of the factor projection $r\\to r_0$ and $\\textmd{proj}_{{\\mathcal{B}}'}:r_0\\to {\\mathcal{B}}'_0$. Recall that $r_0$ and ${\\mathcal{B}}'_0$ are parallel and the second map induces the parallelism map between $r_0$ and ${\\mathcal{B}}'_0$.  \n\nLet $\\Pi$ be a blow-up of ${\\mathcal{B}}$. We restrict the blow-up data on ${\\mathcal{B}}$ to ${\\mathcal{B}}'$, and let $\\Pi'$ be the resulting blow-up of ${\\mathcal{B}}'$. Since there is a 1-1 correspondence between spherical residues in ${\\mathcal{B}}$ or ${\\mathcal{B}}'$ with standard products in $\\Pi$ or $\\Pi'$, then above discussion implies that we can assign to each standard product of $\\Pi$ a standard product in $\\Pi'$, together with a map between them. This assignment is compatible with the gluing pattern of these standard products, thus induces a map $\\rho:\\Pi\\to \\Pi'$. This map $\\rho$ is a 1-Lipschitz retraction map, and is called a \\textit{residue retraction} map. The following is an consequence of the existence of such map. \n\n\\begin{cor}\n\\label{isometric embedding}\nThe inclusion $\\Pi'\\to \\Pi$ is an isometric embedding.\n\\end{cor}\n \n\\begin{theorem}\n\\label{blow-up CAT(0)}\nIf each $Z_{r_{v}}$ is $CAT(0)$, then the blow-up $\\Pi$ of a right-angled building ${\\mathcal{B}}$ with the quotient metric is also $CAT(0)$.\n\\end{theorem}\n\n\\begin{proof}\nWe start with the following observation. If ${\\mathcal R}\\subset {\\mathcal{B}}$ is a residue, then ${\\mathcal R}$ is also a building. We can restrict any blow-up data of ${\\mathcal{B}}$ to a blow-up data of ${\\mathcal R}$. Let $\\Pi_{B}$ and $\\Pi_{{\\mathcal R}}$ be the resulting blow-ups. And let $|{\\mathcal{B}}|$ and $|{\\mathcal R}|$ be the Davis realization of ${\\mathcal{B}}$ and ${\\mathcal R}$. Then the following diagram commutes:\n\\begin{center}\n$\\begin{CD}\n\\Pi_{{\\mathcal R}}              @>>i_{1}>       \\Pi_{B} \\\\\n@VVV                              @VVV     \\\\\n|{\\mathcal R}|       @>>i_{2}>      |{\\mathcal{B}}|\n\\end{CD}$\n\\end{center}\nThe two vertical maps are canonical projections, and $i_{1}$ and $i_2$ are isometric embeddings (Corollary~\\ref{isometric embedding}). Moreover, the image of $i_{1}$ is exactly the inverse image of $|{\\mathcal R}|$ under the canonical projection (here $|{\\mathcal R}|$ is viewed as a subspace of $|{\\mathcal{B}}|$).\n\nWe first show $\\Pi_B$ is locally $CAT(0)$. Define the \\textit{rank} of ${\\mathcal{B}}$ to be the maximum possible number of vertices in a clique of ${\\Gamma}$. We induct on the rank of ${\\mathcal{B}}$. The rank 1 case is clear. Now assume ${\\mathcal{B}}$ is of rank $n$, and all blow-ups of buildings of rank $\\le n-1$ are locally $CAT(0)$.\n\nPick vertex $x\\in |{\\mathcal{B}}|$ and suppose $x$ corresponds to a $J$-residue $r\\subset {\\mathcal{B}}$. Let $\\pi:\\Pi_B\\to |{\\mathcal{B}}|$ be the canonical projection and let ${\\textrm{st}}(x)$ be the open star of $x$ in $|{\\mathcal{B}}|$. It suffices to show $\\pi^{-1}({\\textrm{st}}(x))$ is locally $CAT(0)$.\n\n\\textit{Case 1:} $J\\neq\\emptyset$. Let $J^{\\perp}$ be the vertices in ${\\Gamma}$ which are adjacent to every vertex in $J$. Let ${\\mathcal R}$ be the $J\\cup J^{\\perp}$-residue that contains $r$. We restrict the blow-up data on ${\\mathcal{B}}$ to ${\\mathcal R}$, and let $\\Pi_{{\\mathcal R}}$ be resulting metric space. Let ${\\mathcal R}={\\mathcal R}_{1}\\times{\\mathcal R}_{2}$ be the product decomposition (see Section~\\ref{building}) induced by $J\\cup J^{\\perp}$. Then we also have $|{\\mathcal R}|=|{\\mathcal R}_{1}|\\times |{\\mathcal R}_{2}|$ and $\\Pi_{{\\mathcal R}}=\\Pi_{{\\mathcal R}_1}\\times \\Pi_{{\\mathcal R}_i}$ where $\\Pi_{{\\mathcal R}_i}$ is some blow-up of ${\\mathcal R}_{i}$ for $i=1,2$. By the induction assumption, $\\Pi_{{\\mathcal R}_2}$ is locally $CAT(0)$. Moreover, ${\\mathcal R}_{1}$ can be further decomposed into a product of buildings of rank 1, thus $\\Pi_{{\\mathcal R}_1}$ is locally $CAT(0)$. It follows that $\\Pi_{R}$ is locally $CAT(0)$. Since ${\\operatorname{St}}(x)\\subset |{\\mathcal R}|$, $\\pi^{-1}({\\textrm{st}}(x))\\subset \\Pi_{R}$. Since  $\\Pi_{R} \\to \\Pi_B$ is a local isometry, it follows that $\\pi^{-1}({\\textrm{st}}(x))$ is locally $CAT(0)$.\n\n\\textit{Case 2:} $J=\\emptyset$. In this case, $\\pi$ induces a simplicial isomorphism between $\\pi^{-1}({\\operatorname{St}}(x))$ and ${\\operatorname{St}}(x)$. It follows from the $CAT(0)$ property of $|{\\mathcal{B}}|$ and \\cite[Lemma I.5.27]{bridson_haefliger} that $\\pi^{-1}({\\textrm{st}}(x))$ is locally $CAT(0)$.\n\nIt remains to prove $\\Pi_B$ is simply connected. Actually we show the canonical projection $\\pi:\\Pi_B\\to|{\\mathcal{B}}|$ is a homotopy equivalence. We construct a homotopy inverse $\\phi:|{\\mathcal{B}}|\\to \\Pi_B$ as follows. \n\nRecall that $|{\\mathcal{B}}|$ be also be viewed as a blow-up of ${\\mathcal{B}}$ where the associated metric spaces $Z'_{r_v}$'s are single points. Let $M'_{r_v}$ be the mapping cylinder of the constant map $r_v\\to Z'_{r_v}$. There is a natural map $h_{r_v}:M_{r_v}\\to M'_{r_v}$ induced by collapsing each $Z_{r_v}$ to $Z'_{r_v}$. \n\nFor each $r_v$, we choose a map $h'_{r_v}:Z'_{r_v}\\to Z_{r_v}$ such that if $r_v$ and $r_u$ are parallel residues of rank 1, then $h'_{r_v}$ and $h'_{r_u}$ have the same image. We extend $h'_{r_v}$ to a map $M'_{r_v}\\to M_{r_v}$ as follows. Pick a chamber $c\\in r_v$, and let $e_c$ and $e'_c$ be the edges in $M_{r_v}$ and $M'_{r_v}$ corresponding to the chamber $c$ respectively. We identify these two edges with $[0,1]$ such that the $0$-endpoints are the tips. We map the $[1/2,1]$ half of $e'_{c}$ to the constant speed geodesic joining the midpoint of $e_c$ and the image of $h'_{r_v}$ in $Z_{r_v}$ (such geodesic is unique since $M_{r_v}$ is $CAT(0)$), and map the $[0,1/2]$ half of $e'_c$ identically to the $[0,1/2]$ half of $e_c$.\n\nOne readily verify that one can take suitable products of the maps $h'_{r_v}:M'_{r_v}\\to M_{r_v}$ and glue them together to obtain a map $\\phi:|{\\mathcal{B}}|\\to \\Pi_B$. Moreover, for each $r_v$, there is a geodesic homotopy between $h'_{r_v}\\circ h_{r_v}$ to identity, and these homotopies induces a homotopy between $\\phi\\circ\\pi$ and identity. Similarly we can produce a homotopy between $\\pi\\circ\\phi$ and identity.\n\\end{proof}\n\n\\subsection{An equivariant construction}\nThe construction in this section is similar to Section~\\ref{subsection_an equivariant constuction}.\n\\begin{definition}\nLet ${\\mathcal{B}}$ be a right-angled building. A bijection $f:{\\mathcal{B}}\\to{\\mathcal{B}}$ is \\textit{flat-preserving} if both $f$ and $f^{-1}$ map spherical residues to spherical residues.\n\\end{definition}\nThis definition is motivated by Definition~\\ref{def_flat_preserving}.\n\nSuppose $H$ acts on ${\\mathcal{B}}$ by flat-preserving bijections.  Let $\\Lambda$ be the collection of all parallel classes of rank 1 residues, then there is an induced action $H{\\curvearrowright}\\Lambda$. We pick a representative from each orbit of this action and denote the resulting set by $\\{\\lambda_{u}\\}_{u\\in U}$. \n\nLet $H_u$ be the stabilizer of $\\lambda_u$. Pick rank 1 residue $r_u$ in the parallel class $\\Lambda_u$ and let $\\rho_u:H_u{\\curvearrowright} r_u$ be the induced factor action (see Section~\\ref{subsection_an equivariant constuction}). We pick a metric space $Z_{r_u}$, an isometric action $H_u{\\curvearrowright} Z_{r_u}$ and a $H_u$-equivariant map $f_{r_u}:r_u\\to Z_{r_u}$. And we deal with residues which are parallel to $r_u$ as in step 1 of Section~\\ref{construction}.\n\nWe repeat this process for each element in $\\{\\lambda_u\\}_{u\\in U}$. If $\\lambda\\notin \\{\\lambda_u\\}_{u\\in U}$, then we fix an element $g_{\\lambda}\\in H$ such that $g_{\\lambda}(\\lambda)\\in \\{\\lambda_u\\}_{u\\in U}$. For each rank 1 residue $r_v$ in the parallel class $\\lambda$, we associate the metric space $Z_{g_{\\lambda}(r_v)}$ and the map $f_{r_v}=f_{g_{\\lambda}(r_v)}\\circ g_{\\lambda}$, and we deal with residues which are parallel to $r_v$ as before.\n\nLet $\\Pi$ be the blow-up of ${\\mathcal{B}}$ with respect to the above choice of spaces and maps and let $\\bar{{\\mathcal{B}}}$ be the corresponding reduced blow-up.  Then there are induced actions $H{\\curvearrowright} \\Pi$ and $H{\\curvearrowright}\\bar{\\Pi}$ by isometries. Moreover, the canonical projection $\\Pi\\to |{\\mathcal{B}}|$ is $H$-equivariant.\n\nNext we apply this construction to graph products of groups. Pick a finite simplicial graph ${\\Gamma}$ with its vertex set denoted by $I$, and pick a collection of groups $\\{H_i\\}_{i\\in I}$, one for each vertex of ${\\Gamma}$. Let $H$ be the graph product of the $H_i$'s with respect to ${\\Gamma}$ and let ${\\mathcal{B}}={\\mathcal{B}}({\\Gamma})$ be the right-angled building associated with this graph product (see \\cite[Section 5]{davis_buildings_are_cat0}). We can identify $H$ with the set of chambers in ${\\mathcal{B}}$. Under this identification, the rank 1 residues in ${\\mathcal{B}}$ correspond to left cosets of $H_i$'s and spherical residues in ${\\mathcal{B}}$ correspond to left cosets of $\\prod_{j\\in J} H_j$'s where $J$ is the vertex set of some clique in ${\\Gamma}$. \n\nIn the following discussion, we will slightly abuse notation. When we say a residue in $H$, we actually mean the corresponding object in ${\\mathcal{B}}$ under the above identification.\n\nLet $\\Lambda_H$ be the collection of all parallel classes of rank 1 residues in $H$, and let $\\lambda_i\\in\\Lambda_H$ be the parallel class represented by $H_i$. Then there is a 1-1 correspondence between $\\lambda_i$'s and $H$-orbits of the induced action $H{\\curvearrowright} \\Lambda_H$. Thus we take $\\{\\lambda_{u}\\}_{u\\in U}$ in the above construction to be $\\{\\lambda_i\\}_{i\\in I}$. For each $H_i$, pick a metric space $Z_i$, an isometric action $H_i{\\curvearrowright} Z_i$, and a $H_i$-equivariant map $f_i:H_i\\to Z_i$. Given such data, we can produce a blow-up $\\Pi_{H}$ of the building ${\\mathcal{B}}$.\n\n\\begin{thm}\n\\label{geometric action}\nLet $H$ be the graph product of $\\{H_i\\}_{i\\in I}$ with respect to a finite simplicial graph ${\\Gamma}$.  Suppose one of the following properties  is satisfied by all of $H_i$'s:\n\\begin{enumerate}\n\\item It acts geometrically on a $CAT(0)$ space;\n\\item It acts properly on a $CAT(0)$ space;\n\\item It acts geometrically on a $CAT(0)$ cube complex;\n\\item It acts properly on a $CAT(0)$ cube complex.\n\\end{enumerate}\nThen $H$ also has the same property.\n\\end{thm}\n\n\\begin{proof}\nWe prove (1). The other assertions are similar. Suppose each $H_i$ acts geometrically on a $CAT(0)$ space $Z_i$. By Theorem~\\ref{blow-up CAT(0)}, it suffices to show the action $H{\\curvearrowright} \\Pi_H$ is geometric.\n\nWe first show that $H{\\curvearrowright} \\Pi_H$ is cocompact. Note that $\\Pi_H$ is locally compact, since each mapping cylinder in the construction of $\\Pi_H$ is locally compact. We deduce that $\\Pi_H$ is proper since $\\Pi_H$ is $CAT(0)$. Thus it suffices to show $H{\\curvearrowright} \\Pi_H$ is cobounded. Let $|H|$ be the Davis realization of ${\\mathcal{B}}$ and let $\\pi:\\Pi_H\\to |H|$ be the $H$-equivariant canonical projection. Let $V_0\\subset |H|$ be the collection of rank 0 vertices in $|H|$. Note that $\\pi^{-1}(v)$ is exactly one point for any $v\\in V_0$. The $H$-action on $V_0$, hence on $\\pi^{-1}(V_0)$ is transitive. Since each action $H_i{\\curvearrowright} Z_i$ is cobounded, the set of tips in the mapping cylinder of $f_i:H_{i}\\to Z_i$ is cobounded. Thus $\\pi^{-1}(V_0)$ is cobounded in $\\Pi_H$ since it arises from tips of mapping cylinders in the construction of $\\Pi_H$. It follows that $H{\\curvearrowright} \\Pi_H$ is cobounded, hence cocompact.\n\nNow we prove $H{\\curvearrowright} \\Pi_H$ is proper. It suffices to show the intersection of $\\pi^{-1}(V_0)$ with any bounded metric ball in $\\Pi_H$ is finite. For each $\\lambda\\in\\Lambda_H$, pick a residue $r_v$ in the parallel class $\\lambda$. Let $\\xi_{\\lambda}:\\Pi_H\\to M_{r_v}$ be the residue projection. Note that $\\xi_{\\lambda}$ does not depend on the choice of $r_v$ in the parallel class. We claim there exists constant $L>0$ such that \n\n", "itemtype": "equation", "pos": 189117, "prevtext": "\n\nNow we define a contravariant functor $\\Psi:{\\operatorname{Face}}(|{\\mathcal{B}}|)\\rightarrow {\\operatorname{CCC}}$ as follows. Let $f$ be a face of $|{\\mathcal{B}}|$ and let $v_f\\in f$ be unique vertex which has minimal rank among the vertices of $f$. Let ${\\mathcal R}_f\\subset{\\mathcal{B}}$ be the residue associated with $v_f$. We define $\\Psi(f)={\\mathbb R}^{T({\\mathcal R}_f)}$ (${\\mathbb R}^{\\emptyset}$ is a single point), here ${\\mathbb R}^{T({\\mathcal R}_f)}$ is endowed with the standard cubical structure and we identify ${\\mathbb Z}^{T({\\mathcal R}_f)}$ with the $0$-skeleton of ${\\mathbb R}^{T({\\mathcal R}_f)}$. \n\nAn inclusion of faces $f\\rightarrow f'$ induces an inclusion ${\\mathcal R}_{f'}\\rightarrow{\\mathcal R}_{f}$. We define the morphism $\\Psi(f')\\rightarrow\\Psi(f)$ to be the embedding induce by $h_{{\\mathcal R}_{f'}{\\mathcal R}_f}:{\\mathbb Z}^{T({\\mathcal R}_{f'})}\\rightarrow{\\mathbb Z}^{T({\\mathcal R}_{f})}$. \n\n\\begin{lem}\n$\\Psi$ is contravariant functor.\n\\end{lem}\n\n\\begin{proof}\nIt is easy to check that passing from an inclusion of faces $f\\rightarrow f'$ to ${\\mathcal R}_{f'}\\rightarrow{\\mathcal R}_{f}$ is a functor. And it follows from (\\ref{composition}) that passing from ${\\mathcal R}_{f'}\\rightarrow{\\mathcal R}_{f}$ to $h_{{\\mathcal R}_{f'}{\\mathcal R}_f}:{\\mathbb Z}^{T({\\mathcal R}_{f'})}\\rightarrow{\\mathbb Z}^{T({\\mathcal R}_{f})}$ is a functor.\n\\end{proof}\n\n\\begin{lem}\n$\\Psi$ is 1-determined.\n\\end{lem}\n\n\\begin{proof}\nLet $\\sigma\\subset|{\\mathcal{B}}|$ be a face and pick a vertex $v\\in\\sigma$. Let $\\{v_{i}\\}_{i=1}^{k}$ be the vertices in $\\sigma$ that are adjacent to $v$ along an edge $e_i$. Let $\\sigma_{\\le v}$ be the sub-cube of $\\sigma$ that is spanned by $e_{i}$'s such that $v_{i}\\ge v$. We define $\\sigma_{>v}$ similarly ($\\sigma_{>v}$ could be empty). Then $\\sigma=\\sigma_{\\le v}\\times\\sigma_{>v}$. Moreover, $v$ is the maximal vertex in $\\sigma_{\\le v}$ and the minimum vertex in $\\sigma_{>v}$. Note that $\\Psi(e_{i})\\to\\Psi(v)$ is an isometry if $v_{i}>v$. Thus it suffices to consider the case where $v$ is the maximal vertex of $\\sigma$.\n\nLet $v_{m}$ be the minimal vertex of $\\sigma$. Note that ${\\operatorname{Im}}(\\Psi({\\sigma})\\to \\Psi(v))\\subset\\cap^{k}_{i=1}{\\operatorname{Im}}(\\Psi(e)\\to \\Psi(v))$ is a cubical convex embedding of Euclidean subspaces, it suffices to show they have the same dimension. Let ${\\mathcal R}(v)\\subset C$ be the residue corresponding to the vertex $v$. Note that $T({\\mathcal R}(v_m))=\\cap_{i=1}^{k}T({\\mathcal R}(v_i))$ ($T$ is the type map defined on the beginning of Section \\ref{subsection_input for Z-blow-up}). Thus the dimension of $\\cap^{k}_{i=1}{\\operatorname{Im}}(\\Psi(e)\\to \\Psi(v))$ equals to the cardinality of $T({\\mathcal R}(v_m))$, which is the dimension of ${\\operatorname{Im}}(\\Psi({\\sigma})\\to \\Psi(v))$.\n\\end{proof}\n\n$\\Psi$ is called the \\textit{fiber functor associated with the blow-up data $\\{h_{{\\mathcal R}}\\}$}, and the restriction quotient $q:Y\\to|{\\mathcal{B}}|$ which arises from the fiber functor $\\Psi$ (see Theorem~\\ref{thm_fiber_functor_gives_restriction_quotient}) is called the \\textit{restriction quotient associated with the blow-up data $\\{h_{{\\mathcal R}}\\}$}. It is clear from the construction that the $1$-data of $q$ (Definition \\ref{1-data}) is the blow-up data $\\{h_{{\\mathcal R}}\\}$ (we naturally identify ${\\mathbb Z}^{T({\\mathcal R})}$'s in the blow-up data with the 0-skeleton of the $q$-fibers of rank 1 vertices in $|{\\mathcal{B}}|$). We summarize the above discussion in the following theorem.\n\n\\begin{thm}\nGiven the blow-up data $\\{h_{{\\mathcal R}}\\}$ as in Definition \\ref{input data}, there exists a restriction quotient $q:Y\\to|{\\mathcal{B}}|$ whose 1-data is the blow-up data we start with.\n\\end{thm}\n\n\\begin{remark}\nHere we blow up the building ${\\mathcal{B}}$ with respect to a collection of ${\\mathbb Z}$'s since we want to apply the construction for RAAG's. However, in other cases, it may be natural to blow up with respect to other objects. Here is a variation. For each parallel class of rank 1 residues $\\lambda\\in\\Lambda_{{\\mathcal{B}}}$, we associate a $CAT(0)$ cube complex $Z_{\\lambda}$. For each rank 1 residue ${\\mathcal R}$ in the class $\\lambda$, we define a map $h_{{\\mathcal R}}$ which assigns each element of ${\\mathcal R}$ a convex subcomplex of $Z_{\\lambda}$. We require these $\\{h_{{\\mathcal R}}\\}$ to be compatible with parallelism between rank 1 residues. Given this set of blow-up data, we can repeat the previous construction to obtain a restriction quotient over $|{\\mathcal{B}}|$. It is also possible to blow-up buildings with respect to spaces more general than $CAT(0)$ cube complexes. We give a slightly different approach in Section \\ref{sec_blow-up building more general version}.\n\\end{remark}\n\nNow we show that the construction in this section is indeed a converse to Section~\\ref{subsection_Restriction quotients with Euclidean fibers} in the following sense. Let $q:Y'\\to|{\\mathcal{B}}|$ be a restriction quotient as in Section \\ref{subsection_Restriction quotients with Euclidean fibers} and let $\\Phi$ and $\\Phi'$ be the functors introduced there. For each vertex $v\\in|{\\mathcal{B}}|$ of rank 1 and its associated residue ${\\mathcal R}_v$, we pick an isometric embedding $\\eta_v:{\\mathbb Z}^{T({\\mathcal R}_v)}\\to \\Phi(v)$ such that its image is vertex set of $\\Phi(v)$. We also require these $\\eta_v$'s respect parallelism. More precisely, let $u\\in|{\\mathcal{B}}|$ be a vertex of rank 1 such that $\\Phi(v)$ and $\\Phi(u)$ (understood as subcomplexes of $Y'$) are parallel with the parallelism map given by $p:\\Phi(v)\\to\\Phi(u)$. Then $p\\circ\\eta_v=\\eta_u$ (note that $T({\\mathcal R}_v)=T({\\mathcal R}_u)$ by Lemma \\ref{compactible with parallelism}).\n\nLet $\\Psi$ be the functor constructed in this section from the blow-up data $\\{h_{{\\mathcal R}_v}=\\eta^{-1}_v\\circ f_{{\\mathcal R}_v}:{\\mathcal R}_v\\to {\\mathbb Z}^{T({\\mathcal R}_v)}\\}_{v\\in |{\\mathcal{B}}|}$, here $v$ ranges over all vertices of rank 1 in $|{\\mathcal{B}}|$, ${\\mathcal R}_v$ is the residue associated with $v$ and $f_{{\\mathcal R}_v}$ is the map in Definition~\\ref{1-data}. Pick a face $\\sigma\\in|{\\mathcal{B}}|$ and let $u\\in\\sigma$ be the vertex of minimal rank. Let ${\\mathcal R}_u$ be the associated $J$-residue with its product decomposition given by ${\\mathcal R}_u=\\prod_{j\\in J}{\\mathcal R}_{v_j}$ ($v_j$'s are rank 1 vertices $\\le u$). Let $\\xi_{\\sigma}:\\Psi(\\sigma)\\to\\Phi(\\sigma)$ be the isometry induced by \n\\begin{center}\n$\\prod_{j\\in J}\\eta_{v_j}:{\\mathbb Z}^{T({\\mathcal R}_u)}\\to \\prod_{j\\in J}\\Phi(v_{j})$\n\\end{center}\nand the product decomposition $\\prod_{j\\in J}\\Phi(v_{j})\\cong \\Phi(u)\\cong\\Phi(\\sigma)$ which comes from (\\ref{functor product decomposition}). The following is a consequence of Corollary \\ref{compactible with product}, Corollary \\ref{morphism in terms of product} and the discussion in this section.\n\n\\begin{cor}\n\\label{consistence}\nThe maps $\\{\\xi_{\\sigma}\\}_{{\\sigma}\\in {\\operatorname{Face}}(|{\\mathcal{B}}|)}$ induce a natural isomorphism between $\\Phi$ and $\\Psi$. Thus for any restriction quotient $q:Y'\\to|{\\mathcal{B}}|$ which satisfies the conclusion of Lemma~\\ref{inverse image are flats}, \nif $q'$ is the restriction quotient  whose blow-up data is the 1-data of $q$, then\n$q'$ is equivalent to $q$ up to a natural isomorphism between their fiber functors.\n\\end{cor}\n\n\\begin{cor}\n\\label{product of restriction quotient with Euclidean fibers}\nLet $q:Y\\to|{\\mathcal{B}}|$ be a restriction quotient which satisfies the conclusion of Lemma \\ref{inverse image are flats}. Let ${\\mathcal{B}}\\cong{\\mathcal{B}}_1\\times{\\mathcal{B}}_2$ be a product decomposition of the building ${\\mathcal{B}}$ induced by the join decomposition ${\\Gamma}={\\Gamma}_1\\circ{\\Gamma}_2$ of the defining graph of the associated right-angled Coxeter group. Then there are two restriction quotients $q_{1}:Y_{1}\\to|{\\mathcal{B}}_1|$ and $q_{2}:Y_{2}\\to|{\\mathcal{B}}_2|$ such that $Y=Y_1\\times Y_2$ and $q=q_1\\times q_2$. Moreover, $q_1$ and $q_2$ also satisfy the conclusion of Lemma \\ref{inverse image are flats}.\n\\end{cor}\n\n\\begin{proof}\nBy Corollary~\\ref{consistence}, we can assume $q$ is the restriction quotient associated with a set of blow-up data $\\{h_{{\\mathcal R}}\\}$. For every ${\\mathcal{B}}_1$-slice in ${\\mathcal{B}}$, we can restrict $\\{h_{{\\mathcal R}}\\}$ to ${\\mathcal{B}}_1$ to obtain a blow-up data for ${\\mathcal{B}}_1$. This does not depend on our choice of the ${\\mathcal{B}}_1$-slice, since the blow-up data respects parallelism. We obtain a blow-up data for ${\\mathcal{B}}_2$ in a similar way. It follows from the above construction that the fiber functor associated with $\\{h_{{\\mathcal R}}\\}$ is the product of the fiber functors associated the blow-up data on ${\\mathcal{B}}_1$ and ${\\mathcal{B}}_2$. Thus this corollary is a consequence of Lemma~\\ref{lem_behavior_under_products}.\n\\end{proof}\n\n\\subsection{More properties of the blow-up buildings}\n\\label{subsection_more properties}\nIn this section, we look at the restriction quotient $q:Y\\to|{\\mathcal{B}}|$ associated with the blow-up data $\\{h_{{\\mathcal R}}\\}$ as in Definition~\\ref{input data} (or equivalently, a restriction quotient $q:Y\\to|{\\mathcal{B}}|$ which satisfies the conclusion of Lemma \\ref{inverse image are flats}) in more detail, and record several basic properties of $Y$. A hurried reader can go through Definition~\\ref{rank and inverse map}, then proceed directly to Section~\\ref{subsection_morhpism of blow-up data} and come back to this part later.\n\n\\begin{definition}\n\\label{rank and inverse map}\nA vertex $y\\in Y$ is of \\textit{rank $k$} if $p(y)$ is a vertex of rank $k$. Thus $q$ induces a bijection between rank $0$ vertices in $Y$ and rank $0$ vertices in $|{\\mathcal{B}}|$. Since rank $0$ vertices in $|{\\mathcal{B}}|$ can be identified with chambers in ${\\mathcal{B}}$, $q^{-1}$ induces a well-defined map $q^{-1}:{\\mathcal{B}}\\to Y$ from the set of chambers of ${\\mathcal{B}}$ (or rank $0$ vertices of $|{\\mathcal{B}}|$) to rank $0$ vertices in $Y$.\n\\end{definition}\n\n\\begin{lem}\n\\label{restriction}\nFor any residue ${\\mathcal R}\\subset{\\mathcal{B}}$, we view ${\\mathcal R}$ as a building and restrict the blow-up data over ${\\mathcal{B}}$ to a blow-up data over ${\\mathcal R}$. Let $q_{{\\mathcal R}}:Y_{{\\mathcal R}}\\to |{\\mathcal R}|$ be the associated restriction quotient. Then there exists an isometric embedding $i:Y_{{\\mathcal R}}\\to Y$ which fits into the following commutative diagram:\n\\begin{center}\n$\\begin{CD}\nY_{\\mathcal R}                         @>i>>       Y\\\\\n@Vq_{{\\mathcal R}}VV                                   @VqVV\\\\\n|{\\mathcal R}|       @>i'>>        |{\\mathcal{B}}|\n\\end{CD}$\n\\end{center}\nMoreover, $i(Y_{{\\mathcal R}})=q^{-1}(i'(|{\\mathcal R}|))$.\n\\end{lem}\n\nThe lemma is a direct consequence of the construction in Section \\ref{subsection_input for Z-blow-up}.\n \nPick a vertex $v\\in |{\\mathcal{B}}|$. The \\textit{downward complex of $v$} is the smallest convex subcomplex of $|{\\mathcal{B}}|$ which contains all vertices which are $\\le v$. If ${\\mathcal R}_v$ is the residue associated with $v$, then the downward complex is the image of the embedding $|{\\mathcal R}_v|\\hookrightarrow |{\\mathcal{B}}|$. The next result follows from Lemma \\ref{restriction} and Corollary~\\ref{product of restriction quotient with Euclidean fibers}.\n\n\\begin{lem}\n\\label{downward complex}\nLet $D_v$ be the downward complex of a vertex $v\\in{\\mathcal{B}}$ and let ${\\mathcal R}_v=\\prod_{i=1}^{k}{\\mathcal R}_i$ be the product decomposition of residue associated with $v$. Then $q^{-1}(D_v)$ is isomorphic to the product of the mapping cylinders of ${\\mathcal R}_i\\xrightarrow{h_{{\\mathcal R}_i}}{\\mathbb Z}^{T({\\mathcal R}_i)}\\to {\\mathbb R}^{T({\\mathcal R}_i)}$ $(1\\le i\\le k)$.\n\\end{lem}\n\n\\begin{lem}\\\n\\label{locally-finite and cocompact}\n\\begin{enumerate}\n\\item If $h^{-1}_{{\\mathcal R}}(x)$ is finite for any rank 1 residue ${\\mathcal R}$ and $x\\in{\\mathbb Z}^{T({\\mathcal R})}$, then $Y$ is locally finite. If there is a uniform upper bound for the cardinality of $h^{-1}_{{\\mathcal R}}(x)$, then $Y$ is uniformly locally finite.\n\\item If there exists $D>0$ such that the image of each $h_{{\\mathcal R}}$ is $D$-dense in ${\\mathbb Z}^{T({\\mathcal R})}$, then there exists $D'$ which depends on $D$ and the dimension of $|{\\mathcal{B}}|$ such that the collection of inverse images of rank $0$ vertices in $|{\\mathcal{B}}|$ is $D'$-dense in $Y$.\n\\end{enumerate}\n\\end{lem}\n\n\\begin{proof}\nWe prove (1) first. Pick a vertex $y\\in Y$. Let $v=q(y)$. It suffices to show the set of edges in $|{\\mathcal{B}}|$ which contain $v$, and can be lifted to an edge in $Y$ that contains $y$, is finite. Since there are only finitely many vertices in $|{\\mathcal{B}}|$ which are $\\ge v$, it suffices to consider the edges of the form $\\overline{v_{\\lambda}v}$ with $v_\\lambda<v$. It follows from our assumption and Lemma \\ref{downward complex} that there are only finitely many such edges which have the required lift. The proof of uniform local finiteness is similar. \n\nTo see (2), notice that $\\cup_{v\\in|{\\mathcal{B}}|}\\Psi(v)$ is 1-dense in $Y$, here $v$ ranges over all vertices of $|{\\mathcal{B}}|$. It follows from Lemma \\ref{downward complex} that every point in $\\Psi(v)$ be can approximated by the inverse image of some rank $0$ vertex up to distance $D'$.\n\\end{proof}\n\nNext we discuss the relation between $Y$ and the exploded Salvetti complex $S_e=S_e({\\Gamma})$ introduced in Section~\\ref{subsection_canonical restriction quotient}. Let $\\Psi$ be the fiber functor associated with $q:Y\\to|{\\mathcal{B}}|$.\n\nFirst we label each vertex $v\\in Y$ by a clique in ${\\Gamma}$ as follows. Recall that $q(v)$ is associated with a $J$-residue ${\\mathcal R}\\subset{\\mathcal{B}}$, where $J$ is the vertex set of a clique in ${\\Gamma}$. Thus we label $v$ by this clique. We also label each vertex of $S_e$ by a clique. Any vertex $v\\in S_e$ is contained in a unique standard torus. Recall that a standard torus arises from a clique in ${\\Gamma}$, thus we label $v$ by this clique. Note some vertices of $Y$ and $S_e$ are labelled by the empty set. There is a unique label-preserving map $p:Y^{(0)}\\to S^{(0)}_e({\\Gamma})$.\n\nAn edge in $Y$ or $S_e$ is \\textit{horizontal} if the labels on its two endpoints are different, otherwise, this edge is \\textit{vertical}. When $Y=X_e$, this definition coincides with the one in Section \\ref{subsection_canonical restriction quotient}. Moreover, horizontal (or vertical) edges in $X_e$ are lifts of horizontal (or vertical) edges in $S_e$.\n\nHorizontal edges in $Y$ are exactly those ones whose dual hyperplanes are mapped by $q$ to hyperplanes in $|{\\mathcal{B}}|$, and the $q$-image of any vertical edge is a point. Now we label each edge vertical edge of $Y$ by vertices in ${\\Gamma}$ as follows. Pick vertical edge $e\\subset Y$ and let $v=q(e)$. Let ${\\mathcal R}=\\prod_{i=1}^{k}{\\mathcal R}_i$ be the product decomposition of the residue associated with $v$. There is a corresponding product decomposition $\\Psi(v)=\\prod_{i=1}^{k}\\ell_i$, where $\\ell_i$ is a line which is parallel to $\\Psi(v_i)$, here $v_i\\in|{\\mathcal{B}}|$ is the vertex associated with ${\\mathcal R}_i$, and we view $\\Psi(v_i)$ and $\\Psi(v)$ as subcomplexes of $Y$. If $e$ is in the $\\ell_i$-direction, then we label $e$ by the type of ${\\mathcal R}_i$, which is a vertex in ${\\Gamma}$. A case study implies if two vertical edges are the opposite sides of a 2-cube, then they have the same label. Hence all parallel vertical edges have the same label. Now we label vertical edges in $S_e$. Recall that the map $S_e\\to S({\\Gamma})$ induces a 1-1 correspondence between vertical edges in $S_e$ and edges in $S({\\Gamma})$, and edges in $S({\\Gamma})$ are labelled by vertices of ${\\Gamma}$. This induces a labelling of vertical edges in $S_e$.\n\nWe pick an orientation for each vertical edge in $S_e$, and orient every vertical edge in $Y$ in the following way. A \\textit{vertical line} is a geodesic line made of vertical edges. It is easy to see every vertical edge is contained in a vertical line. For two vertical $\\ell_1$ and $\\ell_2$, if there exist edges $e_i\\in\\ell_i$ for $i=1,2$ such that they are parallel, then $\\ell_1$ and $\\ell_2$ are parallel. To see this, it suffices to consider the case where $e_1$ and $e_2$ are the opposite sides of a 2-cube, and this follows from a similar case study as before. Now we pick an orientation for each parallel class of vertical lines, and this induces well-define orientation on each vertical edge of $Y$, moreover, this orientation respects parallelism of edges.\n\nThere is a unique way to extend $p:Y^{(0)}\\to S^{(0)}_e({\\Gamma})$ to $p:Y^{(1)}\\to S^{(1)}_e({\\Gamma})$ such that $p$ preserves the orientation and labelling of vertical edges. One can further extend $p$ to higher-dimensional cells as follows. A cube $\\sigma\\subset Y$ is of \\textit{type $(m,n)$} if $\\sigma$ is the product of $m$ vertical edges and $n$ horizontal edges. We extend $p$ according to the type:\n\\begin{enumerate}\n\\item If $\\sigma$ is of type $(m,0)$, then we can define $p$ on $\\sigma$ since the orientation of vertical edges in $Y$ respects parallelism, and $p$ preserves labelling and orientation of vertical edges. In this case, $p(\\sigma)$ is an $m$-dimensional standard torus.\n\\item If $\\sigma$ is of type $(0,n)$, then we can define $p$ on $\\sigma$ since $p$ preserves labelling of vertices. In this case, $p(\\sigma)\\cong[0,1]^n$.\n\\item If $\\sigma$ is of type $(m,n)$, then we can define $p$ on $\\sigma$ for similar reasons as before. In this case, $p(\\sigma)\\cong \\Bbb T^m\\times[0,1]^n$.\n\\end{enumerate}\n\nPick vertex $y\\in Y$, then $p$ induces a simplicial map between the vertex links $p_y:Lk(y,Y)\\cong Lk(p(y),S_e)$. The above case study implies $p_y$ is a \\textit{combinatorial} map, i.e. $p_y$ maps each simplex isomorphically onto its image.\n\n\\begin{thm}\n\\label{isomorphic to canonical blow-up}\nIf each map $h_{{\\mathcal R}}$ in the blow-up data is a bijection, then $Y$ is isomorphic to $X_e=X_e({\\Gamma})$, which is the universal cover of the exploded Salvetti complex $S_e=S_e({\\Gamma})$.\n\\end{thm}\n\n\\begin{proof}\nWe prove the theorem by showing $p:Y\\to S_e$ is a covering map. It suffices to show for each vertex $y\\in Y$, the above map $p_y$ is an isomorphism. Suppose $y$ is labelled by a clique $\\Delta\\subset {\\Gamma}$. We look at edges which contain $y$, which fall into three classes:\n\\begin{enumerate}\n\\item vertical edges;\n\\item horizontal edges whose other endpoints are labelled by cliques in $\\Delta$;\n\\item horizontal edges whose other endpoints are labelled by cliques that contain $\\Delta$.\n\\end{enumerate}\nNote that there is a 1-1 correspondence between edges in $(3)$ and cliques which contain $\\Delta$ and have exactly one vertex not in $\\Delta$. For any clique $\\Delta'\\subset\\Delta$ which contains all but one vertex of $\\Delta$, there exists a unique edge in (2) such that its other endpoint is labelled by $\\Delta'$, since if such edge does not exist, then some $h_{{\\mathcal R}}$ will not be surjective; if there exists more than one such edges, then some $h_{{\\mathcal R}}$ will not be injective. Thus there is a 1-1 correspondence between horizontal edges which contains $y$ and horizontal edges which contains $p(y)$. Hence $p_y$ induces bijection between the 0-skeletons. Moreover, edges in (3) are orthogonal to edges in (1) and (2), so a case study implies if two edges at $p(y)$ form the corner of a 2-cube, then their lifts at $y$ (if any exist) also form the corner of a 2-cube. It follows that $p_y$ induces isomorphism between the 1-skeletons. Since both $Lk(y,Y)$ and $Lk(p(y),S_e)$ are flag complexes, $p_y$ is an isomorphism.\n\\end{proof}\n\n\\begin{remark}\nIf each map $h_{{\\mathcal R}}$ is injective (or surjective), then $p$ is locally injective (or locally surjective).\n\\end{remark}\n\n\\begin{cor}\n\\label{uniqueness of building}\nLet ${\\mathcal{B}}_1={\\mathcal{B}}_1({\\Gamma})$ and ${\\mathcal{B}}_2={\\mathcal{B}}_2({\\Gamma})$ be two right-angled ${\\Gamma}$-buildings with countably infinite rank $1$ residues. Then they are isomorphic as buildings.\n\\end{cor}\n\n\\begin{proof}\nWe pick a blow-up for ${\\mathcal{B}}_1$ such that each map in the blow-up data is a bijection. Let $Y\\to|{\\mathcal{B}}_1|$ be the associated restriction quotient and let $p:Y\\to S_e$ be the covering map as in Theorem \\ref{isomorphic to canonical blow-up}. Note that $p$ sends vertical edges to vertical edges and horizontal edges to horizontal edges, and $p$ preserves the labelling of vertices and edges. So does the lift $\\tilde{p}:Y\\to X_e$ of $p$. Lemma~\\ref{descending automorphism general case} implies $\\tilde{p}$ descends to a cubical isomorphism $|{\\mathcal{B}}_1|\\to|{\\mathcal{B}}|$, where $|{\\mathcal{B}}|$ is the building associated with $G({\\Gamma})$. Since $\\tilde{p}$ is label-preserving, this cubical isomorphism induces a building isomorphism ${\\mathcal{B}}_1\\to{\\mathcal{B}}$. Similarly, we can obtain a building isomorphism ${\\mathcal{B}}_2\\to{\\mathcal{B}}$. Hence the corollary follows.\n\\end{proof}\n\n\\begin{thm}\n\\label{descending automorphism building case}\nSuppose ${\\Gamma}$ does not admit a join decomposition ${\\Gamma}={\\Gamma}_1\\circ{\\Gamma}_2$ where that ${\\Gamma}_1$ is a discrete graph with more than one vertex.  If ${\\mathcal{B}}$ is a ${\\Gamma}$-building\nand $q:Y\\to|{\\mathcal{B}}|$ is a restriction quotient with  blow-up data $\\{h_{{\\mathcal R}}\\}$,\nthen any automorphism $\\alpha:Y\\to Y$ descends to an automorphism $\\alpha':|{\\mathcal{B}}|\\to|{\\mathcal{B}}|$.\n\\end{thm}\n\n\\begin{proof}\nBy Lemma~\\ref{descending automorphism general case}, it suffices to show $\\alpha$ preserves the rank (Definition \\ref{rank and inverse map}) of vertices of $Y$. Let $F({\\Gamma})$ be the flag complex of ${\\Gamma}$. Here we change the label of each vertex in $Y$ from some clique in ${\\Gamma}$ to the associated simplex in $F({\\Gamma})$. Suppose $y\\in Y$ is vertex of rand $k$ labelled by $\\Delta$. Then Lemma~\\ref{downward complex} and the proof of Theorem~\\ref{isomorphic to canonical blow-up} imply $Lk(y,Y)\\cong K_1\\ast K_2\\ast\\cdots\\ast K_k\\ast Lk(\\Delta,F({\\Gamma}))$, where each $K_i$ is discrete with cardinality $\\ge 2$, and $Lk(\\Delta,F({\\Gamma}))$ is understood to be $F({\\Gamma})$ when $\\Delta=\\emptyset$. Note that $\\{K_i\\}_{i=1}^{k}$ comes from vertices adjacent to $y$ of rank $\\le k$, and $Lk(\\Delta,F({\\Gamma}))$ comes from vertices adjacent to $y$ of rank $> k$. Thus $\\alpha$ preserves the collection of rank $0$ vertices.\n\nNow we assume $\\alpha$ preserves the collection of rank $i$ vertices for $i\\le k-1$. A rank $k$ vertex in $Y$ is of \\textit{type I} if it is adjacent to a vertex of rank $k-1$, otherwise it is a vertex of \\textit{type II}. It is clear that $\\alpha$ preserves the collection of rank $k$ vertices of type I. Before we deal with type II vertices, we need the following claim. Suppose $w\\in Y$ is a vertex of rank $k$ such that $\\alpha(w)$ is also of rank $k$. If there exist $k$ vertices $\\{z_i\\}_{i=1}^{k}$ adjacent to $w$ such that \n\\begin{enumerate}\n\\item $rank(z_i)\\le k$ and $rank(\\alpha(z_i))\\le k$;\n\\item the edges $\\{\\overline{z_iw}\\}_{i=1}^{k}$ are mutually orthogonal,\n\\end{enumerate}\nthen $rank (\\alpha(z))\\le k$ for any $z$ adjacent to $w$ with $rank(z)\\le k$. \n\nLet $w'=\\alpha(w)$. Suppose $w$ and $w'$ are labelled by $\\Delta$ and $\\Delta'$. Then $\\alpha$ induces an isomorphism between the links of $w$ and $w'$ in $Y$:\n\\begin{center}\n$\\alpha_{\\ast}: K_1\\ast \\cdots\\ast K_k\\ast Lk(\\Delta,F({\\Gamma}))\\to  K'_1\\ast\\cdots\\ast K'_k\\ast Lk(\\Delta',F({\\Gamma}))$.\n\\end{center}\nEach edge $\\overline{z_iw}$ gives rise to a vertex in $K_i$, and each edge $\\overline{\\alpha(z_i)w'}$ gives rise to a vertex in $K'_i$. Thus $\\alpha_{\\ast}(K_1\\ast \\cdots\\ast K_k)=K'_1\\ast\\cdots\\ast K'_k$. Since the edge $\\overline{zw}$ gives rise to a vertex in $K_1\\ast \\cdots\\ast K_k$, the edge $\\overline{\\alpha(z)w'}$ gives rise to a vertex in $K'_1\\ast\\cdots\\ast K'_k$. Then $\\alpha(z)$ is of rank $\\le k$.\n\nLet $y\\in Y$ be a rank $k$ vertex of type II. Then there exists an edge path $\\omega$ from $y$ to a type I vertex $y_1$ such that every vertex in $\\omega$ is of rank $k$. Let $\\{y_i\\}_{i=1}^{m}$ be consecutive vertices in $\\omega$ such that $y_m=y$. Note that there are $k$ vertices of rank $k-1$ adjacent to $y_1$. By the induction assumption, they are send to vertices of rank $k-1$ by $\\alpha$. Moreover, $rank(\\alpha(y_1))=k$ since $y_1$ is of type I. Thus the assumption of the claim is satisfied for $y_1$. Then $rank(\\alpha(y_2))\\le k$, hence $rank(\\alpha(y_2))=k$ by the induction assumption. Next we show $y_2$ satisfies the assumption of the claim. Let $\\{z_i\\}_{i=1}^{k}$ be vertices of rank $k$ such that they are adjacent to $y_1$ and $\\{\\overline{z_iy_1}\\}_{i=1}^{k}$ are mutually orthogonal. We also assume $y_2=z_1$. Then $rank(\\alpha(z_i))=k$ for all $i$. Hence all $\\alpha(\\overline{z_iy_1})$'s are vertical edges. For $i\\ge 2$, let $z'_i$ be the vertex adjacent to $y_2$ such that $\\overline{z'_iy_2}$ and $\\overline{z_iy_1}$ are parallel. Then $\\alpha(\\overline{z'_iy_2})$ is a vertical edge for $i\\ge 2$. Thus $rank(\\alpha(z'_i))=k$ and the assumption of the claim is satisfies for $y_2$. We can repeat this argument finite many times to deduce that $rank(\\alpha(y))=k$.\n\\end{proof}\n\n\\begin{remark}\n\\label{rem_does_not_descend}\nIf the assumption on ${\\Gamma}$ in Theorem~\\ref{descending automorphism building case} is not satisfied, then there exists a blow-up $Y\\to|{\\mathcal{B}}|$ and an automorphism of $Y$ such that it does not descend to an automorphism of $|{\\mathcal{B}}|$. By Corollary \\ref{product of restriction quotient with Euclidean fibers}, it suffices to construct an example in the case when ${\\Gamma}$ be a discrete graph with $n$ vertices with $n\\ge 2$. If $n\\ge 3$, then we define each $h_{{\\mathcal R}}$ to be a surjective map such that the inverse image of each point has $n-2$ points. Then $Y$ is a tree with valence $=n$. If $n=2$, then we define $h_{{\\mathcal R}}$ to be an injective map whose image is the set of even integers. Then $Y$ is isomorphic to the first subdivision of a tree of valence 3. In both case, it is not hard to find an automorphism of $Y$ which maps some vertex of rank 0 to a vertex of rank 1.\n\\end{remark}\n\n\\subsection{Morphisms between blow-up data}\n\\label{subsection_morhpism of blow-up data}\nLet ${\\mathcal{B}}$ and ${\\mathcal{B}}'$ be two buildings modelled on the same right-angled Coxeter group $W({\\Gamma})$. An isomorphism $\\eta:|{\\mathcal{B}}|\\to|{\\mathcal{B}}'|$ is \\textit{rank-preserving} if for each vertex $v\\in|{\\mathcal{B}}|$, $v$ and $\\eta(v)$ have the same rank. Note that such $\\eta$ induces a bijection $\\eta':{\\mathcal{B}}\\to{\\mathcal{B}}'$ which preserves the spherical residues. Conversely, every bijection ${\\mathcal{B}}\\to{\\mathcal{B}}'$ which preserves the spherical residues induces a rank-preserving isomorphism $|{\\mathcal{B}}|\\to|{\\mathcal{B}}'|$. Note that $\\eta'$ maps parallel residues of rank 1 to parallel residues of rank 1, thus $\\eta'$ induces a bijection $\\bar{\\eta}:\\Lambda_{{\\mathcal{B}}}\\to\\Lambda_{{\\mathcal{B}}'}$, where $\\Lambda_{{\\mathcal{B}}}$ and $\\Lambda_{{\\mathcal{B}}'}$ denote the collection of parallel classes of residues of rank 1 in ${\\mathcal{B}}$ and ${\\mathcal{B}}'$ respectively (see Section~\\ref{subsection_input for Z-blow-up}).\n\n\\begin{definition}[$\\eta$-isomorphism]\n\\label{eta-isomorphism}\nSuppose the blow-up data (Definition \\ref{input data}) of $|{\\mathcal{B}}|$ and $|{\\mathcal{B}}'|$ are given by $\\{h_{{\\mathcal R}}\\}$ and $\\{h'_{{\\mathcal R}}\\}$ respectively. An \\textit{$\\eta$-isomorphism} between the blow-up data is defined to be a collection of isometries $\\{f_{\\lambda}:{\\mathbb Z}^{\\lambda}\\to{\\mathbb Z}^{\\bar{\\eta}(\\lambda)}\\}_{\\lambda\\in\\Lambda_{{\\mathcal{B}}}}$ such that the following diagram commutes for every rank 1 residue ${\\mathcal R}\\subset{\\mathcal{B}}$:\n\\begin{center}\n$\\begin{CD}\n{\\mathcal R}                        @>h_{{\\mathcal R}}>>       {\\mathbb Z}^{T({\\mathcal R})}\\\\\n@V\\eta'VV                                   @Vf_{T({\\mathcal R})}VV\\\\\n\\eta'({\\mathcal R})        @>h'_{\\eta'({\\mathcal R})}>>        {\\mathbb Z}^{\\bar{\\eta}(T({\\mathcal R}))}\n\\end{CD}$\n\\end{center}\nHere $T$ is the type map defined in the beginning of Section~\\ref{subsection_input for Z-blow-up}. The map $h_{{\\mathcal R}}$ is \\textit{nondegenerate} if its image contains more than one point. In this case, if $f_{T({\\mathcal R})}$ exists, then it is unique. If $h_{{\\mathcal R}}$ is degenerate, then we have two choices for $f_{T({\\mathcal R})}$.\n\n\n\nLet $\\eta_1:|{\\mathcal{B}}_1|\\to |{\\mathcal{B}}_2|$, $\\eta_2:|{\\mathcal{B}}_2|\\to |{\\mathcal{B}}_3|$ and $\\eta:|{\\mathcal{B}}_1|\\to |{\\mathcal{B}}_3|$ be rank-preserving isomorphisms such that $\\eta=\\eta_2\\circ\\eta_1$. We fix a blow-up data for each ${\\mathcal{B}}_i$. Let $\\{f_{\\lambda}:{\\mathbb Z}^{\\lambda}\\to{\\mathbb Z}^{\\bar{\\eta}_1(\\lambda)}\\}_{\\lambda\\in\\Lambda_{{\\mathcal{B}}_1}}$ and $\\{g_{\\lambda}:{\\mathbb Z}^{\\lambda}\\to{\\mathbb Z}^{\\bar{\\eta}_2(\\lambda)}\\}_{\\lambda\\in\\Lambda_{{\\mathcal{B}}_2}}$ be the $\\eta_1$-isomorphism and $\\eta_2$-isomorphism between the corresponding blow-up data. We define the \\textit{composition} of them to be $\\{g_{\\bar{\\eta}_1 (\\lambda)}\\circ f_{\\lambda}\\}_{\\lambda\\in\\Lambda}$, which turns out to be an $\\eta$-isomorphism.\n\\end{definition}\n\nLet $\\Psi$ and $\\Psi'$ be the fiber functor associated with the blow-up data $\\{h_{{\\mathcal R}}\\}$ and $\\{h'_{{\\mathcal R}}\\}$ respectively, and let $Y\\to|{\\mathcal{B}}|$ and $Y'\\to|{\\mathcal{B}}'|$ be the associated restriction quotient.\n\n\\begin{lem}\n\\label{eta to natural}\nEvery $\\eta$-isomorphism induces a natural isomorphism from $\\Psi$ to $\\Psi'$, hence by Section~\\ref{sec_equivariance_properties}, it induces an isomorphism $Y\\to Y'$ which is a lift of $\\eta:|{\\mathcal{B}}|\\to|{\\mathcal{B}}'|$. Moreover, composition of $\\eta$-isomorphisms gives rise to composition of natural transformations of the associated fiber functors.\n\\end{lem}\n\n\\begin{proof}\nFor every spherical residue ${\\mathcal R}\\subset{\\mathcal{B}}$, $\\eta'$ respects the product decomposition of ${\\mathcal R}$. Thus the following diagram commutes:\n\\begin{center}\n$\\begin{CD}\n{\\mathcal R}                        @>h_{{\\mathcal R}}>>       {\\mathbb Z}^{T({\\mathcal R})}\\\\\n@V\\eta'VV                                   @V\\prod_{\\lambda\\in T({\\mathcal R})}f_{\\lambda}VV\\\\\n\\eta'({\\mathcal R})        @>h'_{\\eta'({\\mathcal R})}>>        {\\mathbb Z}^{\\bar{\\eta}(T({\\mathcal R}))}\n\\end{CD}$\n\\end{center}\nHere $\\prod_{\\lambda\\in T({\\mathcal R})}f_{\\lambda}$ induces an isometry ${\\mathbb R}^{T({\\mathcal R})}\\to{\\mathbb R}^{\\bar{\\eta}(T({\\mathcal R}))}$. This gives rise to a collection of isometries between objects of $\\Psi$ and $\\Psi'$. It follows from the construction in Section \\ref{subsection_input for Z-blow-up} that these isometries give the required natural isomorphism between $\\Psi$ and $\\Psi'$. The second assertion in the lemma is straightforward.\n\\end{proof}\n\n\\begin{remark}\nIf we weaken the assumption of Definition~\\ref{eta-isomorphism} by assuming each $f_{\\lambda}$ is a bijection, then we can obtain a bijection between the vertex sets of $Y$ and $Y'$. This bijection preserves the fibers, however, we may not be able to extend it to a cubical map. \n\\end{remark}\n\n\\begin{thm}\nIf each map $h_{{\\mathcal R}}$ in the blow-up data is a bijection, then $Y$ is isomorphic to $X_e=X_e({\\Gamma})$, which is the universal cover of the exploded Salvetti complex.\n\\end{thm}\n\n\\begin{definition}[$\\eta$-quasi-morphism]\nWe follow the notation in Definition \\ref{eta-isomorphism}. An \\textit{$(\\eta,L,A)$-quasi-morphism} between the blow-up data $\\{h_{{\\mathcal R}}\\}$ and $\\{h'_{{\\mathcal R}}\\}$ is a collection of $(L,A)$-quasi-isometries $\\{f_{\\lambda}:{\\mathbb Z}^{\\lambda}\\to{\\mathbb Z}^{\\bar{\\eta}(\\lambda)}\\}_{\\lambda\\in\\Lambda_{{\\mathcal{B}}}}$ such that the diagram in Definition \\ref{eta-isomorphism} commutes up to error $A$.\n\\end{definition}\n\n\\begin{lem}\n\\label{eta-quasi}\nEach $(\\eta,L,A)$-quasi-morphism between $\\{h_{{\\mathcal R}}\\}$ and $\\{h'_{{\\mathcal R}}\\}$ induces an $(L',A')$-quasi-isometry $Y\\to Y'$ with $L',A'$ depending on $L,A$, and the dimension of $|{\\mathcal{B}}|$.\n\\end{lem}\n\n\\begin{proof}\nBy Lemma~\\ref{lem_quasiisomorphism_gives_quasiisometry}, it suffices to produce an $(L',A')$-quasi-natural isomorphism from $\\Psi$ to $\\Psi'$. This can be done by considering maps of form $\\prod_{\\lambda\\in T({\\mathcal R})}f_{\\lambda}$ as in Lemma \\ref{eta to natural}.\n\\end{proof}\n\n\\begin{remark}[A nice representative]\n\\label{good representative}\nLet $Y_0$ be the collection of rank $0$ vertices in $Y$ (Definition \\ref{rank and inverse map}). We define $Y_0'$ similarly. If the assumption in Lemma~\\ref{locally-finite and cocompact} (2) is satisfied, then $Y_0$ and $Y'_0$ are $D$-dense in $Y$ and $Y'$ respectively. In this case, the quasi-isometry $Y\\to Y'$ in Lemma~\\ref{eta-quasi} can be represented by $\\phi:Y_0\\to Y'_0$, where $\\phi$ is the bijection induced by $\\eta:|{\\mathcal{B}}|\\to|{\\mathcal{B}}'|$ (recall that we can identify $Y_0$ and $Y'_0$ with rank $0$ vertices in $|{\\mathcal{B}}|$ and $|{\\mathcal{B}}'|$ respectively, see Definition \\ref{rank and inverse map}). The fact that $\\phi$ is a quasi-isometry follows from the construction in the proof Lemma~\\ref{lem_quasiisomorphism_gives_quasiisometry}.\n\\end{remark}\n\n\n\\begin{cor}\n\\label{quasi-isometry criterion}\nIf there exists constant $D>0$ such that each map $h_{{\\mathcal R}}$ in the blow-up data satisfies:\n\\begin{enumerate}\n\\item For any $x\\in{\\mathbb Z}^{T({\\mathcal R})}$, $|h^{-1}_{{\\mathcal R}}(x)|\\le D$.\n\\item The image of $h_{{\\mathcal R}}$ is $D$-dense in ${\\mathbb Z}^{T({\\mathcal R})}$.\n\\end{enumerate}\nThen $Y$ is quasi-isometric to $G({\\Gamma})$.\n\\end{cor}\n\n\\begin{proof}\nBy the assumptions, there exists another set of blow-up data $\\{h'_{{\\mathcal R}}\\}$ such that each $h'_{{\\mathcal R}}$ is a bijection, and an $(\\eta,L,A)$-quasi-isomorphism $\\{f_{\\lambda}\\}_{\\lambda\\in\\Lambda_{{\\mathcal{B}}}}$ from $\\{h'_{{\\mathcal R}}\\}$ to $\\{h_{{\\mathcal R}}\\}$ where $\\eta$ is the identity map. It follows from Lemma~\\ref{eta-quasi} and Theorem~\\ref{isomorphic to canonical blow-up} that $Y$ is quasi-isometric to $X_e$, the universal cover of the exploded Salvetti complex; hence $Y$ is quasi-isometric to $G({\\Gamma})$.\n\\end{proof}\n\nIn the rest of this section, we look at the special case when ${\\mathcal{B}}={\\mathcal{B}}({\\Gamma})$\nis the Davis building of $G({\\Gamma})$ (see the beginning of Section \\ref{subsection_canonical restriction quotient}), and record an observation for later use. In this case, we identify points in $G({\\Gamma})$ with chambers in ${\\mathcal{B}}$.\n\nWe denote the word metric on $G({\\Gamma})$ by $d_w$. If we identify $G({\\Gamma})$ with chambers of the building ${\\mathcal{B}}={\\mathcal{B}}({\\Gamma})$, then there is another metric on $G({\\Gamma})$ defined in Definition~\\ref{distance of residue}. We caution the reader that these two metrics are not the same. We pick a set of blow-up data $\\{h_{{\\mathcal R}}\\}$ on ${\\mathcal{B}}$ and let $q:Y\\to |{\\mathcal{B}}|$ be the associated restriction quotient. Recall that vertices of rank 0 on $|{\\mathcal{B}}|$ can be identified with chambers in ${\\mathcal{B}}$, hence can be identified with $G({\\Gamma})$. Thus the map $q^{-1}:G({\\Gamma})\\to Y$ is well-defined. \n\n\\begin{lem}\n\\label{quasi-isometry produced by inverse map}\nIf there exist $L,A>0$ such that all $\\{h_{{\\mathcal R}}:{\\mathcal R}\\to{\\mathbb Z}^{T({\\mathcal R})}\\}$ are $(L,A)$-quasi-isometries $($here we identify chambers in ${\\mathcal R}$ with a subset of $G({\\Gamma})$, hence ${\\mathcal R}$ is endowed with an induced metric from $d_w)$, then $q^{-1}:(G({\\Gamma}),d_w)\\to Y$ is an $(L',A')$-quasi-isometry with its constants depending on $L,A$ and ${\\Gamma}$.\n\\end{lem}\n\n\n\\begin{proof}\nLet $q':X_e\\to |{\\mathcal{B}}|$ be the $G({\\Gamma})$-equivariant canonical restriction quotient constructed in Section~\\ref{subsection_canonical restriction quotient}. In this case, $(q')^{-1}:G({\\Gamma})\\to X_e$ is a quasi-isometry whose constants depend on ${\\Gamma}$. Let $h'_{{\\mathcal R}}$ be the blow-up data which arises from the 1-data (Definition~\\ref{1-data}) of $q'$. Then each $h'_{{\\mathcal R}}$ is an isometry. It follows from the assumption that there exists an $(\\eta,L,A)$-quasi-isomorphism from the blow-up data $\\{h'_{{\\mathcal R}}\\}$ to $\\{h_{{\\mathcal R}}\\}$ with $\\eta$ being the identity map. Thus there exists a quasi-isometry $X_e\\to Y$ which can be represented by a map $\\phi$ of the form in Remark~\\ref{good representative}. Since $q^{-1}=\\phi\\circ(q')^{-1}$, the lemma follows.\n\\end{proof}\n\n\\subsection{An equivariant construction}\n\\label{subsection_an equivariant constuction}\nLet ${\\mathcal{B}}={\\mathcal{B}}({\\Gamma})$ be a right-angled building. Let $K$ be group which acts on $|{\\mathcal{B}}|$ by automorphisms which preserve the rank of its vertices and let $K{\\curvearrowright} {\\mathcal{B}}$ and $K{\\curvearrowright}\\Lambda_{{\\mathcal{B}}}$ be the induced actions ($\\Lambda_{\\mathcal{B}}$ is defined in the beginning of Section \\ref{subsection_input for Z-blow-up}). \n\n\\begin{definition}[Factor actions]\n\\label{factor action}\nPick $\\lambda\\in\\Lambda$ and let ${\\mathcal R}_\\lambda\\subset {\\mathcal{B}}$ be a residue of rank 1 such that $T({\\mathcal R}_\\lambda)=\\lambda$ ($T$ is the type map defined in Section~\\ref{subsection_input for Z-blow-up}). Let $K_{\\lambda}$ be the stabilizer of $\\lambda$ with respect to the action $K{\\curvearrowright}\\Lambda_{{\\mathcal{B}}}$ and let $P({\\mathcal R}_\\lambda)={\\mathcal R}_\\lambda\\times{\\mathcal R}^{\\perp}_\\lambda$ be the parallel set of ${\\mathcal R}_\\lambda$ with its product decomposition (see Lemma~\\ref{parallel sets of residues} and Theorem~\\ref{product decomposition}). Then $P({\\mathcal R}_\\lambda)$ is $K_\\lambda$-invariant, and $K_\\lambda$ respects the product decomposition of $P({\\mathcal R}_\\lambda)$. Let $\\rho_\\lambda:K_\\lambda{\\curvearrowright} {\\mathcal R}_\\lambda$ be the action of $K_\\lambda$ on the ${\\mathcal R}_\\lambda$-factor. This action $\\rho_\\lambda$ is called a \\textit{factor action}. \n\\end{definition}\n\nWe construct  equivariant blow-up data as follows. Pick one representative from each $K$-orbit of $K{\\curvearrowright}\\Lambda_{{\\mathcal{B}}}$ and form the set $\\{\\lambda_u\\}_{u\\in U}$. Let $K_u$ be the stabilizer of $\\lambda_u$. Pick residue ${\\mathcal R}_u\\subset {\\mathcal{B}}$ of rank 1 such that $T({\\mathcal R}_u)=\\lambda_u$ and let $\\rho_u:K_u{\\curvearrowright} {\\mathcal R}_u$ be the factor action defined as above.\n\nTo obtain a $K$-equivariant blow-up data, we pick an isometric action $K_u{\\curvearrowright}{\\mathbb Z}^{\\lambda_u}$ and a $K_u$-equivariant map $h_{{\\mathcal R}_u}:{\\mathcal R}_u\\to {\\mathbb Z}^{\\lambda_u}$. If ${\\mathcal R}$ is parallel to ${\\mathcal R}_u$ with the parallelism map given by $p:{\\mathcal R}\\to{\\mathcal R}_u$, we define $h_{{\\mathcal R}}=h_{{\\mathcal R}_u}\\circ p$. By the previous discussion, there is a factor action $K_u{\\curvearrowright}{\\mathcal R}$, and $h_{{\\mathcal R}}$ is $K_u$-equivariant. We run this process for each element in $\\{\\lambda_u\\}_{u\\in U}$. If $\\lambda\\notin \\{\\lambda_u\\}_{u\\in U}$, then we fix an element $g_{\\lambda}\\in K$ such that $g_{\\lambda}(\\lambda)\\in \\{\\lambda_u\\}_{u\\in U}$. For rank 1 element ${\\mathcal R}$ with $T({\\mathcal R})=\\lambda$, we define $h_{{\\mathcal R}}=\\textmd{Id}\\circ h_{g_{\\lambda}({\\mathcal R})}\\circ g_{\\lambda}$, here $\\textmd{Id}:{\\mathbb Z}^{g_{\\lambda}(\\lambda)}\\to{\\mathbb Z}^{\\lambda}$ is the identity map. Let $K_{\\lambda}=g^{-1}_{\\lambda}K_{g_{\\lambda}(\\lambda)}g_{\\lambda}$ be the stabilizer of $\\lambda$. We define the action $K_{\\lambda}{\\curvearrowright} {\\mathbb Z}^{\\lambda}$ by letting $g^{-1}_{\\lambda}gg_{\\lambda}$ acts on ${\\mathbb Z}^{\\lambda}$ by $\\textmd{Id}\\circ g\\circ\\textmd{Id}^{-1}$ ($g\\in K_{g_{\\lambda}(\\lambda)}$). Then $h_{{\\mathcal R}}$ becomes $K_{\\lambda}$-equivariant.\n\nIt follows from the above construction that we can produce an isometry $f_{g,{\\mathcal R}}:{\\mathbb Z}^{T({\\mathcal R})}\\to {\\mathbb Z}^{T(g({\\mathcal R}))}$ for each $g\\in K$ and rank 1 residue ${\\mathcal R}\\in{\\mathcal{B}}$ such that the following diagram commutes\n\\begin{center}\n$\\begin{CD}\n{\\mathcal R}                        @>h_{{\\mathcal R}}>>       {\\mathbb Z}^{T({\\mathcal R})}\\\\\n@VgVV                                   @Vf_{g,{\\mathcal R}}VV\\\\\ng({\\mathcal R})        @>h_{g({\\mathcal R})}>>        {\\mathbb Z}^{T(g({\\mathcal R}))}\n\\end{CD}$\n\\end{center}\nand $f_{g_1g_2,{\\mathcal R}}=f_{g_1,g_2({\\mathcal R})}\\circ f_{g_2,{\\mathcal R}}$ for any $g_1,g_2\\in K$. Let $\\Psi$ be the fiber functor associated with the above blow-up data and let $q:Y\\to|{\\mathcal{B}}|$ be the corresponding restriction quotient. Lemma \\ref{eta to natural} implies $K$ acts on $\\Psi$ by natural transformations, hence there is an induced action $K{\\curvearrowright} Y$ and $q$ is $K$-equivariant. \n\n\\begin{remark}\nThe previous construction depends on several choices:\n\\begin{enumerate}\n\\item The choice of the set $\\{\\lambda_u\\}_{u\\in U}$.\n\\item The choice of the isometric action $K_u{\\curvearrowright}{\\mathbb Z}^{\\lambda_u}$ and the $K_u$-equivariant map $h_{{\\mathcal R}_u}:{\\mathcal R}_u\\to {\\mathbb Z}^{\\lambda_u}$.\n\\item The choice of the elements $g_{\\lambda}$'s.\n\\end{enumerate}\n\\end{remark}\n\n\\section{Quasi-actions on RAAG's}\n\\label{section_quasi-action on RAAGs}\n\nIn this section we will apply the construction in Section \\ref{subsection_an equivariant constuction} to study quasi-actions on RAAG's.\n\nWe assume $G(\\Gamma)\\neq{\\mathbb Z}$ throughout Section \\ref{section_quasi-action on RAAGs}.\n\n\n\\subsection{The cubulation}\n\\label{subsec_cubulation}\n\nThroughout Subsection \\ref{subsec_cubulation} we assume $G({\\Gamma})\\not\\simeq {\\mathbb Z}$ is a RAAG with $|{\\operatorname{Out}}(G({\\Gamma}))|<\\infty$, and $\\rho:H{\\curvearrowright} G(\\Gamma)$ is an $(L,A)$-quasi-action.\n\nRecall that $G(\\Gamma)$ acts on $X(\\Gamma)$ by deck transformations, and this action is simply transitive on the vertex set of $X(\\Gamma)$. By picking a base point in $X(\\Gamma)$, we identify $G(\\Gamma)$ with the 0-skeleton of $X(\\Gamma)$. \n\n\\begin{definition}\n\\label{def_flat_preserving}\nA quasi-isometry $\\phi:G({\\Gamma})\\rightarrow G({\\Gamma})$ is\n{\\em flat-preserving} if it \nis a bijection and for every standard flat $F\\subset X({\\Gamma})$ there is a \nstandard flat $F'\\subset X({\\Gamma})$ such that $\\phi$ maps\nthe $0$-skeleton of $F$ bijectively onto the $0$-skeleton of $F'$.\nThe standard flat $F'$ is uniquely determined, and we denote it by\n$\\phi_*(F)$. Note that if $\\phi$ is flat-preserving, then $\\phi^{-1}$ is also flat-preserving.\n\\end{definition}\n\nBy Theorem \\ref{thm_intro_vertex_rigidity}, without loss of generality\nwe can assume $\\rho:H{\\curvearrowright} G({\\Gamma})$ is an action by flat-preserving bijections which are also $(L,A)$-quasi-isometries. \n\nOn the one hand, we want to think $G({\\Gamma})$ as a metric space with the word metric with respect to its standard generating set, or equivalently, with the induced $l^1$-metric from $X({\\Gamma})$; on the other hand, we want to treat $G({\\Gamma})$ as a right-angled building (see Section~\\ref{subsection_canonical restriction quotient}), more precisely, we want to identify points in $G({\\Gamma})$ with chambers in the associated right-angled building of $G({\\Gamma})$. Then the $\\rho$ preserves the spherical residues in $G({\\Gamma})$, thus there is an induced $\\rho_{|{\\mathcal{B}}|}:H{\\curvearrowright} |{\\mathcal{B}}|$ on the Davis realization $|{\\mathcal{B}}|$ of $G({\\Gamma})$. \n\n\nLet $\\Lambda$ be the collection of parallel classes of standard geodesic lines in $X({\\Gamma})$, in other words, $\\Lambda$ is the collection of parallel classes of rank 1 residues in $G({\\Gamma})$, and let $T$ be the type map defined in the beginning of Section~\\ref{subsection_input for Z-blow-up}. There is another induced action $\\rho_{\\Lambda}:H{\\curvearrowright}\\Lambda$. For each $\\lambda\\in\\Lambda$, let $H_{\\lambda}$ be the stabilizer of $\\lambda$. Pick a residue ${\\mathcal R}$ in the parallel class $\\lambda$, and let $\\rho_{\\lambda}:H_{\\lambda}{\\curvearrowright} {\\mathcal R}$ be the factor action in Definition~\\ref{factor action}. Note that ${\\mathcal R}$ is an isometrically embedded copy of ${\\mathbb Z}$ with respect to the metric on $G({\\Gamma})$; moreover, $\\rho_{\\lambda}$ is an action by $(L',A')$-quasi-isometries. Here we can choose $L'$ and $A'$ such that they depend only on $L$ and $A$, so in particular they do not depend on $\\lambda$ and ${\\mathcal R}$. \n\nFor the action $\\rho_{\\Lambda}:H{\\curvearrowright}\\Lambda$, we pick a representative from each $H$-orbit and form the set $\\{\\lambda_u\\}_{u\\in U}$. By the construction in Section~\\ref{subsection_an equivariant constuction}, it remains to choose an isometric action $G_u{\\curvearrowright}{\\mathbb Z}^{\\lambda_u}$ and a $G_u$-equivariant map $h_{{\\mathcal R}_u}:{\\mathcal R}_u\\to {\\mathbb Z}^{\\lambda_u}$ for each $u\\in U$ (${\\mathcal R}_u$ is a residue in the parallel class $\\lambda_u$). The choice is provided by the following result, whose proof is postponed to Section~\\ref{sec_quasi action on Z}. \n\n\\begin{proposition}\n\\label{key lemma}\nIf a group $K$ has an action on $\\Bbb Z$ by $(L,A)$-quasi-isometries, then there exists another action $K\\curvearrowright\\Bbb Z$ by isometries which is related to the original action by a surjective equivariant $(L',A')$-quasi-isometry $f: \\Bbb Z\\to \\Bbb Z$ where $L',A'$ depend on $L$ and $A$.\n\\end{proposition}\n\nFrom the above data, we produce  $H$-equivariant blow-up data $h_{{\\mathcal R}}:{\\mathcal R}\\to{\\mathbb Z}^{T({\\mathcal R})}$ for each rank 1 residue ${\\mathcal R}\\subset G({\\Gamma})$ as in Section~\\ref{subsection_an equivariant constuction}. Note that each $h_{{\\mathcal R}}$ is an $(L'',A'')$-quasi-isometry with constants depending only on $L$ and $A$.\n\nLet $q:Y\\to |{\\mathcal{B}}|$ be the restriction quotient associated with the above blow-up data. Then there is an induced action $H{\\curvearrowright} Y$ by isomorphisms, and $q$ is $H$-equivariant. It follows from Lemma~\\ref{locally-finite and cocompact} that $Y$ is uniformly locally finite. \n\n{\\em Claim. There exists an $(L_1,A_1)$-quasi-isometry $G({\\Gamma})\\to Y$ with $L_1,A_1$ depending only on $L$ and $A$.}\n\n\\begin{proof}[Proof of claim]\nLet $h'_{{\\mathcal R}}:{\\mathcal R}\\to {\\mathbb Z}^{T({\\mathcal R})}$ be another blow-up data such that each $h'_{{\\mathcal R}}$ is an isometry (such blow-up data always exists), and let $q':Y'\\to |{\\mathcal{B}}|$ be the associated restriction quotient. By Theorem~\\ref{isomorphic to canonical blow-up}, $Y'$ is isomorphic to $X_e$, which is the universal cover of the exploded Salvetti complex introduced in Section~\\ref{subsection_canonical restriction quotient}. For any $\\lambda\\in\\Lambda$, we define $f_{\\lambda}=h_{{\\mathcal R}}\\circ (h'_{{\\mathcal R}})^{-1}$, here ${\\mathcal R}$ is a residue such that $T({\\mathcal R})=\\lambda$ and the definition of $f_{\\lambda}$ does not depend on ${\\mathcal R}$. Each $f_{\\lambda}$ is an $(L'',A'')$-quasi-isometry and the collection of all $f_{\\lambda}$'s induces a quasi-isomorphism between the blow-up data $\\{h'_{{\\mathcal R}}\\}$ and $\\{h_{{\\mathcal R}}\\}$. It follows from Lemma~\\ref{eta-quasi} that there exists a quasi-isometry between $\\varphi:Y'\\cong X_e\\to Y$, and the claim follows.\n\\end{proof}\n\nLet $B_0$ be the set of vertices of rank 0 in $|{\\mathcal{B}}|$. There is a natural identification of $B_0$ with $G({\\Gamma})$. Letting $Y_0=q^{-1}(B_0)$, we get that $q$ induces a bijection between $Y_0$ and $B_0$. We define $Y'_{0}$ similarly. It follows from (2) of Lemma~\\ref{locally-finite and cocompact} that $Y'_{0}$ and $Y_0$ are $D$-dense in $Y'$ and $Y$ respectively for $D$ depending on $L$ and $A$. Note that $q^{-1}:G({\\Gamma})\\to Y_0$ is $H$-equivariant, and if the action $\\rho:H{\\curvearrowright} G({\\Gamma})$ is cobounded, then $H{\\curvearrowright} Y$ is cocompact. \n\nThe above quasi-isometry $\\varphi$ can be represented by $q^{-1}\\circ q':Y'_0\\to Y_0$ (Remark~\\ref{good representative}). By Lemma~\\ref{quasi-isometry produced by inverse map}, $(q')^{-1}:B_0=G({\\Gamma})\\to Y'_0$ is also a quasi-isometry, and thus $q^{-1}:G({\\Gamma})\\to Y_0$ is a quasi-isometry. This map is $H$-equivariant, so if $\\rho:H{\\curvearrowright} G({\\Gamma})$ is proper, then $H{\\curvearrowright} Y$ is also proper.\n\n\\begin{remark}\nHere we discuss a refinement of the above construction. Instead of requiring each $h'_{{\\mathcal R}}$ to be an isometry, it is possible to choose each $h'_{{\\mathcal R}}$ such that:\n\\begin{enumerate}\n\\item $h'_{{\\mathcal R}}$ is a bijection.\n\\item $h'_{{\\mathcal R}}$ is an $(L_2,A_2)$-quasi-isometry.\n\\item $f_{\\lambda}:{\\mathbb Z}^{\\lambda}\\to{\\mathbb Z}^{\\lambda}$ is a surjective map which respects the order of the ${\\mathbb Z}$, hence can be extended to a surjective cubical map ${\\mathbb R}^{\\lambda}\\to{\\mathbb R}^{\\lambda}$.\n\\end{enumerate}\nThe surjectivity in (3) follows from our choice in Proposition~\\ref{key lemma}. In this case, the space $Y'$ is still isomorphic to $X_e$ (Theorem~\\ref{isomorphic to canonical blow-up}). Let $\\Psi$ and $\\Psi'$ be the fiber functors associated with the blow-up data $\\{h_{{\\mathcal R}}\\}$ and $\\{h'_{{\\mathcal R}}\\}$. As in the proof of Lemma~\\ref{eta to natural}, the  $f_{\\lambda}$'s induce a natural transformation from $\\Psi'$ to $\\Psi$ which is made of a collection of surjective cubical maps from objects in $\\Psi'$ to objects in $\\Psi$; moreover, these maps are quasi-isometries with uniform quasi-isometry constants. Recall that we can describe $Y$ as the quotient of the disjoint collection $\\{{\\sigma}\\times \\Psi({\\sigma})\\}_{{\\sigma}\\in {\\operatorname{Face}}(|{\\mathcal{B}}|)}$ (see the proof of Theorem~\\ref{thm_fiber_functor_gives_restriction_quotient}), and a similar description holds for $Y'$. Thus there is a surjective cubical map $\\phi:Y'\\to Y$ induced by the natural transformation. Actually $\\phi$ is a restriction quotient, since the inverse image of each hyperplane is a hyperplane. We also know $\\phi$ is a quasi-isometry by Lemma~\\ref{lem_quasiisomorphism_gives_quasiisometry}.\n\\end{remark}\n\nThe following theorem summarizes the above discussion.\n \n\\begin{theorem}\n\\label{thm_quasi_action1}\nIf the outer automorphism group \n${\\operatorname{Out}}(G({\\Gamma}))$ is finite and $G({\\Gamma})\\not\\simeq {\\mathbb Z}$, \nthen any quasi-action $\\rho:H{\\curvearrowright} X({\\Gamma})$ is\nquasiconjugate to an action $\\hat{\\rho}$ of $H$ by cubical isometries on a uniformly locally finite $CAT(0)$ cube complex $Y$. Moreover:\n\\begin{enumerate}\n\\item If $\\rho$ is cobounded, then $\\hat{\\rho}$ is cocompact.\n\\item If $\\rho$ is proper, then $\\hat{\\rho}$ is proper.\n\\item Let $|{\\mathcal{B}}|$ be the Davis realization of the right-angled building associated with $G({\\Gamma})$,  let $H{\\curvearrowright} |{\\mathcal{B}}|$ be the induced action, and let $X_e=X_e({\\Gamma})$ be the universal cover of the exploded Salvetti complex for $G({\\Gamma})$. Then $Y$ fits into the following commutative diagram:\n\\begin{diagram}\nX_{e}   &            &\\pile{\\rTo^{\\phi}\\\\}& &Y\\\\\n\t  &\\rdTo_{q'} &                 &\\ldTo_{q}&\\\\\n    && |{\\mathcal{B}}|  && \n\\end{diagram}\nHere $q'$, $q$ and $\\phi$ are restriction quotients. The map $\\phi$ is a quasi-isometry whose constants depend on the constants of the quasi-action $\\rho$, and $q$ is $H$-equivariant.\n\\end{enumerate}\n\\end{theorem}\n\n\\begin{cor}\n\\label{if and only if}\nSuppose the outer automorphism group ${\\operatorname{Out}}(G({\\Gamma}))$ is finite. Then $H$ is quasi-isometric to $G({\\Gamma})$ if and only if there exists an $H$-equivariant restriction quotient map $q:Y\\to |{\\mathcal{B}}|$ such that:\n\\begin{enumerate}\n\\item $|{\\mathcal{B}}|$ is the Davis realization of some right-angled ${\\Gamma}$-building.\n\\item The action $H{\\curvearrowright} Y$ is geometric.\n\\item If $v\\in |{\\mathcal{B}}|$ is a vertex of rank $k$, then $q^{-1}(v)={\\mathbb E}^k$.\n\\end{enumerate}\n\\end{cor}\n\n\n\\begin{proof}\nThe only if direction follows from Theorem~\\ref{thm_quasi_action1}. For the if direction, it suffices to show $Y$ is quasi-isometric to $G({\\Gamma})$. Let $\\Phi$ be the fiber functor associated with $q$.\n\nPick a vertex $v\\in |{\\mathcal{B}}|$ of rank $k$ and let $F_v=q^{-1}(v)$. We claim ${\\operatorname{Stab}}(v)$ acts cocompactly on $F_v$.  By a standard argument, to prove this it suffices to show that $\\{h(F_v)\\}_{h\\in H}$ is a locally finite family in $Y$. Suppose there exists an $R$-ball $N\\subset Y$ such that there are infinitely many distinct elements in $\\{h(F_v)\\}_{h\\in H}$ which have nontrivial intersection of $N$. Since $Y$ admits a geometric action, it is locally finite, and thus there exists a vertex $x\\in|{\\mathcal{B}}|$ which is contained in infinitely many distinct elements in $\\{h(F_v)\\}_{h\\in H}$. This is impossible, since if $h(F_v)\\neq h'(F_v)$, then $q(h(F_v))$ and $q(h'(F_v))$ are distinct vertices in $|{\\mathcal{B}}|$ by the $H$-equivariance of $q$.\n\nConsider a cube $\\sigma\\subset |{\\mathcal{B}}|$ and let $v$ be its vertex of minimal rank. We claim $\\Phi(\\sigma)\\to\\Phi(v)$ is surjective, hence is an isometry. By (3), the action $H{\\curvearrowright} |{\\mathcal{B}}|$ preserves the rank of the vertices, thus ${\\operatorname{Stab}}(\\sigma)\\subset{\\operatorname{Stab}}(v)$. We know that ${\\operatorname{Stab}}(v)$ acts cocompactly on $q^{-1}(v)$; since the poset $\\{w \\geq v\\}$ is finite, ${\\operatorname{Stab}}(\\sigma)$ has finite index in ${\\operatorname{Stab}}(v)$, and so ${\\operatorname{Stab}}(\\sigma)$ also acts cocompactly on $q^{-1}(v)$. Now the image of $\\Phi(\\sigma)\\to\\Phi(v)$ is a convex subcomplex of $q^{-1}(v)$ that is ${\\operatorname{Stab}}(\\sigma)$-invariant, so it coincides with $q^{-1}(v)$. \n\nBy Corollary~\\ref{consistence}, we can assume $q$ is the restriction quotient of a set of blow-up data $\\{h_{{\\mathcal R}}\\}$. Pick a vertex $v\\in|{\\mathcal{B}}|$ of rank 1 and let $D(v)$ be the downward complex of $v$ (see Section~\\ref{subsection_input for Z-blow-up}). Let ${\\mathcal R}_v\\subset{\\mathcal{B}}$ be the associated residue and let ${\\mathcal R}_v\\to {\\mathbb R}^{T({\\mathcal R})}$ be the map induced by $h_{{\\mathcal R}_v}$. Then $q^{-1}(D_v)$ is isomorphic to the mapping cylinder of this map. Since the ${\\operatorname{Stab}}(v)$ acts cocompactly on $q^{-1}(D_v)$,  there are only finite many orbits of vertices of rank 1, and the assumptions of Corollary~\\ref{quasi-isometry criterion} are satisfied. It follows that $Y$ is quasi-isometric to $G({\\Gamma})$.\n\\end{proof}\n\nIt is possible to drop the $H$-equivariant assumption on $q$ under the following conditions. Here we do not put any assumption on ${\\Gamma}$.\n\n\\begin{thm}\n\\label{quasi-isometry to G}\nLet ${\\mathcal{B}}$ be a right-angled ${\\Gamma}$-building. Suppose $q:Y\\to|{\\mathcal{B}}|$ is a restriction quotient such that for every cube $\\sigma\\subset |{\\mathcal{B}}|$, and every interior point $x \\in {\\sigma}$, the point inverse $q^{-1}(x)$ is a copy of ${\\mathbb E}^{rank(v)}$,  where\n$v\\in {\\sigma}$ is the vertex of minimal rank.\n\nIf $H$ acts geometrically on $Y$ by automorphisms, then $H$ is quasi-isometric to $G({\\Gamma})$.  \n\\end{thm}\n\n\\begin{proof}\nFirst we assume ${\\Gamma}$ satisfies the assumption of Theorem~\\ref{descending automorphism building case}. Then the above result is a consequence of Corollary~\\ref{consistence}, Theorem~\\ref{descending automorphism building case} and the argument in Corollary~\\ref{if and only if}.\n\nFor arbitrary ${\\Gamma}$, we make a join decomposition ${\\Gamma}={\\Gamma}_1\\circ{\\Gamma}_2\\circ\\cdots{\\Gamma}_k\\circ{\\Gamma}'$ where ${\\Gamma}'$ satisfies the assumption of Theorem~\\ref{descending automorphism building case}, and all ${\\Gamma}_i$'s are discrete graphs with more than one vertex. By Corollary \\ref{product of restriction quotient with Euclidean fibers}, there are induced cubical product decomposition $Y=Y_1\\times Y_2\\times\\cdots Y_k\\times Y'$ and restriction quotients $q_i:Y_i\\to |{\\mathcal{B}}_i|$ and $q':Y'\\to |{\\mathcal{B}}'|$ which satisfy the assumption of the theorem. By \\cite[Proposition 2.6]{caprace2011rank}, we assume $H$ respects this product decomposition by passing to a finite index subgroup. Since $Y'$ is locally finite and cocompact, the same argument in Corollary~\\ref{if and only if} implies $Y'$ is quasi-isometric to $G({\\Gamma}')$. Each $Y_i$ is a locally finite and cocompact tree which is not quasi-isometric to a line. So $Y_i$ is quasi-isometric to $G({\\Gamma}')$. Thus $Y$ is quasi-isometric to $G({\\Gamma})$.\n\\end{proof}\n\n\\begin{cor}\nSuppose ${\\operatorname{Out}}(G({\\Gamma}))$ is finite and $G({\\Gamma})\\not\\simeq{\\mathbb Z}$. Let ${\\mathcal{B}}$ be the right-angled building of $G({\\Gamma})$. Then $H$ is quasi-isometric to $G({\\Gamma})$ if and only if $H$ acts geometrically on a blow-up of ${\\mathcal{B}}$ in the sense of Section \\ref{subsection_input for Z-blow-up} by automorphisms.\n\\end{cor}\n\\subsection{Reduction to nicer actions} \n\\label{subsection_nicer action}\nThough every action $\\rho:H{\\curvearrowright} G(\\Gamma)$ by flat-preserving bijections which are also $(L,A)$-quasi-isometries is quasiconjugate to an isometric action $H{\\curvearrowright} Y$ as in Theorem~\\ref{thm_quasi_action1}, it is in general impossible to take $Y=X(\\Gamma)$, even if the action $\\rho$ is proper and cobounded. \n\n\\begin{definition}\n\\label{standard action}\nLet $H={\\mathbb Z}/2\\oplus {\\mathbb Z}$ with the generator of ${\\mathbb Z}/2$ and ${\\mathbb Z}$ denoted by $a$ and $b$\nrespectively. Let $H\\stackrel{\\rho_0}{{\\curvearrowright}} {\\mathbb Z}$ be the action\nwhere $\\rho_0(b)(n)=n+2$, and $\\rho_0(a)$ acts on ${\\mathbb Z}$ by flipping $2n$ and $2n+1$ for\nall $n\\in{\\mathbb Z}$. An action $K{\\curvearrowright} {\\mathbb Z}$ is {\\em 2-flipping} if it factors through the action $H\\stackrel{\\rho_0}{{\\curvearrowright}} {\\mathbb Z}$ via an epimorphism $K\\to H$.\n\\end{definition}\n\n\\begin{lem}\n\\label{not conjugate}\nLet $\\rho_K:K{\\curvearrowright} {\\mathbb Z}$ be a 2-flipping action. Then $\\rho_K$ is not conjugate to an action by isometries on ${\\mathbb Z}$ (with respect to the word metric on ${\\mathbb Z}$).\n\\end{lem}\n\n\\begin{proof}\nSuppose there exists a permutation $p:{\\mathbb Z}\\to {\\mathbb Z}$ which conjugates $\\rho_K$ to an isometric action. Let $h:K\\to G$ be the epimorphism in Definition~\\ref{standard action}. Pick $k_1,k_2\\in K$ such that $h(k_1)$ is of order $2$ and $h(k_2)$ is of order infinity. Then $pk_1p^{-1}$ is a reflection of ${\\mathbb Z}$ and $pk_2p^{-1}$ is a translation. However, this is impossible since $h(k_1)$ and $h(k_2)$ commute. \n\\end{proof}\n\n\\begin{lem}\n\\label{not compactible}\nThere does not exists an action $\\rho_K:K{\\curvearrowright} {\\mathbb Z}$ by $(L,A)$-quasi-isometries with the following property. $K$ has two subgroup $K_1$ and $K_2$ such that $\\rho_K|_{K_1}$ is conjugate to a 2-flipping action and $\\rho_K|_{K_2}$ is conjugate to a transitive action on ${\\mathbb Z}$ by translations.\n\\end{lem}\n\n\\begin{proof}\nBy Proposition~\\ref{key lemma}, there exists an isometric action $\\rho'_K:K{\\curvearrowright} {\\mathbb Z}$ and a $K$-equivariant surjective map $f:K\\stackrel{\\rho_K}{{\\curvearrowright}} {\\mathbb Z}{\\longrightarrow}\nK\\stackrel{\\rho'_K}{{\\curvearrowright}}{\\mathbb Z}$. We claim $f$ is also injective. Given this claim, we can deduce a contradiction to Lemma~\\ref{not conjugate} by restricting the action to $K_1$. To see the claim, we restrict the action to $K_2$. Thus we can assume without loss of generality that $\\rho_K$ is a transitive action by translations. Suppose $f(a_1)=f(a_1+k)$ for $a_1,k\\in{\\mathbb Z}$ and $k\\neq 0$. Then the equivariance of $f$ implies $f(a_1)=f(a_1+nk)$ for any integer $n\\in {\\mathbb Z}$, which contradicts that $f$ is a quasi-isometry.\n\\end{proof}\n\n\n\n\\begin{theorem}\nSuppose $G({\\Gamma})$ is a RAAG with $|{\\operatorname{Out}}(G({\\Gamma}))|<\\infty$ and $G({\\Gamma})\\not\\simeq{\\mathbb Z}$.\nThen there is a pair $H, H'$ of finitely generated groups quasi-isometric to \n$G({\\Gamma})$ that does not admit discrete, virtually faithful cocompact\nrepresentations into\nthe same locally compact topological group.\n\\end{theorem} \n\nRecall that a discrete, virtually faithful cocompact representation from $H$ to a locally compact group $\\hat{G}$ is a homomorphism $h:H\\to\\hat{G}$ such that its kernel is finite, and its image is a cocompact lattice.\n\n\\begin{proof}\nPick a vertex $u\\in {\\Gamma}$ and let ${\\Gamma}'$ be a graph obtained by taking two copies of ${\\Gamma}$ and gluing them along the closed star of $u$. There is a graph automorphism $\\alpha:{\\Gamma}'\\to{\\Gamma}'$ which fixes the closed star of $u$ pointwise and flips the two copies of ${\\Gamma}$. Then $\\alpha$ induces an involution $\\alpha:G({\\Gamma}')\\to G({\\Gamma}')$, which gives rise to a semi-product $H=G({\\Gamma}')\\rtimes {\\mathbb Z}/2$. \n\nNote that $G({\\Gamma}')$ is a subgroup of index 2 in both $G({\\Gamma})$ and $H$.  Therefore\nthis induces a quasi-isometry $q:H\\to G({\\Gamma})$, an also a quasi-action $\\rho_{H}:H{\\curvearrowright} G({\\Gamma})$. By the previous discussion, we can assume $\\rho_H$ is an action by flat-preserving quasi-isometries. We look at the associated collection of factor actions $\\{H_{\\lambda}{\\curvearrowright} {\\mathbb Z}\\}_{\\lambda\\in\\Lambda}$ (see Definition~\\ref{factor action}), recall that $\\Lambda$ is the collection of parallel classes of rank 1 residues in $G({\\Gamma})$, and a rank 1 residue in some class $\\lambda$ can be identified with a copy of ${\\mathbb Z}$. Up to conjugacy by bijective quasi-isometries, these factor actions are either transitive actions on ${\\mathbb Z}$ or 2-flipping actions.\n\nWe claim that $G({\\Gamma})$ and $H$ do not admit discrete, virtually faithful cocompact representations into the same locally compact topological group. Suppose such a topological group $\\hat{G}$ exists. Then by \\cite[Chapter 6]{mosher2003quasi}, $\\hat{G}$ has a quasi-action on $G({\\Gamma})$. We assume $\\hat{G}$ acts on $G({\\Gamma})$ by flat-preserving quasi-isometries as before. Then there are restriction actions $\\rho'_{G({\\Gamma})}:G({\\Gamma}){\\curvearrowright} G({\\Gamma})$ and $\\rho'_H:H{\\curvearrowright} G({\\Gamma})$ which are discrete and cobounded. Since any two discrete and cobounded quasi-actions $H{\\curvearrowright} G({\\Gamma})$ are quasi-conjugate, it follows from Theorem~\\ref{thm_intro_vertex_rigidity} that $\\rho_H$ and $\\rho'_{H}$ are conjugate by a flat-preserving quasi-isometry. Thus factor actions of $\\rho'_H$ is conjugate to factor actions of $\\rho_H$ by bijective quasi-isometries. Similarly, we deduce that the factor actions of $\\rho'_{G({\\Gamma})}$ are conjugate to transitive actions by left translations on ${\\mathbb Z}$ via bijective quasi-isometries. Note that the factor actions of $\\rho'_{G({\\Gamma})}$ and the factor actions of $\\rho'_H$ are both restrictions of factor actions of $\\hat{G}{\\curvearrowright} G({\\Gamma})$, however, this is impossible by Lemma~\\ref{not compactible}.\n\\end{proof}\n\n\\begin{cor}\n\\label{no action}\nThe group $H=G({\\Gamma}')\\rtimes {\\mathbb Z}/2$ cannot act geometrically on $X({\\Gamma})$.\n\\end{cor}\n\nWe now give a criterion for when one can quasi-conjugate a quasi-action on $X({\\Gamma})$ to an isometric action $H{\\curvearrowright} X({\\Gamma})$. \n\\begin{thm}\n\\label{isometric action}\nLet $\\rho:H{\\curvearrowright} G({\\Gamma})$ be an action by flat-preserving bijections. If for each $\\lambda\\in\\Lambda$, the factor action $\\rho_{\\lambda}:H_{\\lambda}{\\curvearrowright}{\\mathbb Z}$ can be conjugate to an action by isometries with respect to the word metric of ${\\mathbb Z}$, then there is an flat-preserving bijection $g:G({\\Gamma})\\to G({\\Gamma})$ which conjugates $\\rho:H{\\curvearrowright} G(\\Gamma)$ to an action $\\rho':H{\\curvearrowright} X(\\Gamma)$ by flat-preserving isometries. If $\\rho$ is also an action by $(L,A)$-quasi-isometries, then $g$ can be taken to be a quasi-isometry.\n\\end{thm}\n\n\\begin{proof}\nWe repeat the construction in Section~\\ref{subsec_cubulation} and assume each $h_{{\\mathcal R}}:{\\mathcal R}\\to{\\mathbb Z}^{T({\\mathcal R})}$  is a bijection. Let $q:Y\\to |{\\mathcal{B}}|$, $Y_0$, $q^{-1}:G({\\Gamma})\\to Y_0$ and the action $\\hat{\\rho}:H{\\curvearrowright} Y$ by automorphisms be as in Section~\\ref{subsec_cubulation}. Recall that $q^{-1}$ is $H$-equivariant. There is an isomorphism $i:Y\\to X_e$ by Theorem~\\ref{isomorphic to canonical blow-up}, moreover, $i(Y_0)$ is exactly the collection of $0$-dimensional standard flats $X_0$ in $X_e$. We deduce from the construction of $i$ that the isometric action $H{\\curvearrowright} X_e$ induced by $\\hat{\\rho}$ preserves standard flats in $X_e$. By the construction of $X_e$, there exists a natural identification $f:X_0\\to G({\\Gamma})$ such that any automorphism of $X_e$ which preserves its standard flats induces a flat-preserving isometry of $G({\\Gamma})$ (with respect to the word metric) via $f$. It suffices to take $g=f\\circ i\\circ q^{-1}$. \n\\end{proof}\n\nSuppose we have already conjugated the flat-preserving action $\\rho:H{\\curvearrowright} G(\\Gamma)$ to an action $\\rho':H{\\curvearrowright} X(\\Gamma)$ (or $H{\\curvearrowright} G(\\Gamma)$) by flat-preserving isometries. We ask whether it is possible to further conjugate $\\rho'$ to an action by left translations. \n\nWe can oriented each 1-cell in $S({\\Gamma})$ and label it by the associated generator. This lifts to orientations and labels of edges of $X({\\Gamma})$. If $H$ preserves this orientation and labelling, then $\\rho'$ is already an action by left translations. In general, it suffices to require $H$ preserves a possibly different orientation and labelling which satisfy several compatibility conditions. Now we recall the following definitions from \\cite{huang2014quasi}.\n\n\\begin{definition}[Coherent ordering]\nA \\textit{coherent ordering} for $G({\\Gamma})$ is a blow-up data for $G({\\Gamma})$ such that each map $h_{{\\mathcal R}}$ is a bijection. Two coherent orderings are \\textit{equivalent} if the their maps agree up to translations.\n\\end{definition}\n\nLet $\\mathcal{P}({\\Gamma})$ be the extension complex defined in Section~\\ref{subsec_raag}. Note that we can identify $\\Lambda_{G({\\Gamma})}$ with the $0$-skeleton of ${\\mathcal P}({\\Gamma})$. Any flat-preserving action $H{\\curvearrowright} G(\\Gamma)$ induces an action $H{\\curvearrowright}\\mathcal{P}({\\Gamma})$ by simplicial isomorphisms. Let $F(\\Gamma)$ be the flag complex of ${\\Gamma}$.\n\n\\begin{definition}[Coherent labelling]\nRecall that for each vertex $x\\in X({\\Gamma})$, there is a natural simplicial embedding $i_{x}:F({\\Gamma})\\to\\mathcal{P}({\\Gamma})$ by considering the standard flats passing through $x$. A \\textit{coherent labelling} of $G({\\Gamma})$ is a simplicial map $L:\\mathcal{P}({\\Gamma})\\to F({\\Gamma})$ such that $L\\circ i_{x}: F(\\Gamma)\\to F(\\Gamma)$ is a simplicial isomorphism for every vertex $x\\in X(\\Gamma)$.\n\\end{definition}\n\nThe next result follows from \\cite[Lemma 5.7]{huang2014quasi}.\n\n\\begin{lem}\n\\label{action by translation}\nLet $\\rho':H{\\curvearrowright} G(\\Gamma)$ be an action by flat-preserving bijections and let $H{\\curvearrowright}\\mathcal{P}({\\Gamma})$ be the induced action. If there exists an $H$-invariant coherent ordering and an $H$-invariant coherent labelling, then $\\rho'$ is conjugate to an action by left translations.\n\\end{lem}\n\nSince each vertex of ${\\mathcal P}({\\Gamma})$ corresponds to a parallel class of $v$-residues for vertex $v\\in{\\Gamma}$, this gives a labelling of vertices of ${\\mathcal P}({\\Gamma})$ by vertices of ${\\Gamma}$. We can extend this labelling map to a simplicial map $L:\\mathcal{P}({\\Gamma})\\to F({\\Gamma})$, which gives rise to a coherent labelling.\n \n\\begin{cor}\nLet $\\rho:H{\\curvearrowright} G(\\Gamma)$ be an action by flat-preserving bijections. Suppose: \n\\begin{enumerate}\n\\item The induced action $H{\\curvearrowright}{\\mathcal P}({\\Gamma})$ preserves the vertex labelling of ${\\mathcal P}({\\Gamma})$ as above.\n\\item For each vertex $v\\in\\mathcal{P}(\\Gamma)$, the action $\\rho_{v}:H_{v}{\\curvearrowright} {\\mathbb Z}$ is conjugate to an action by translations.\n\\end{enumerate}\nThen $\\rho$ is conjugate to an action $H{\\curvearrowright} G(\\Gamma)$ by left translations.\n\\end{cor}\nNote that condition (2) is equivalent to the existence of an $H$-invariant coherent ordering.\n\n\n\n\n\n\n\\section{Actions by quasi-isometries on $\\Bbb Z$}\n\\label{sec_quasi action on Z}\nIn this section we prove Proposition \\ref{key lemma}.\n\n\n\n\\subsection{Tracks}\n\\label{subsec_track}\nTracks were introduced in \\cite{dunwoody1985accessibility}. They are hypersurface-like objects in 2-dimensional simplicial complexes.\n\n\n\\begin{definition}[Tracks]\nLet $K$ be 2-dimensional simplicial complex. A \\textit{track} $\\tau\\subset K$ is a connected embedded finite simplicial graph such that:\n\\begin{enumerate}\n\\item For each 2-simplex $\\Delta\\subset K$, $\\tau\\cap\\Delta$ is a finite disjoint union of curves such that the end points of each curve are in the interior of edges of $\\Delta$.\n\\item For each edge $e\\in K$, $\\tau\\cap e$ is a discrete set in the interior of $e$. Let $\\{\\Delta_{\\lambda}\\}_{\\lambda\\in\\Lambda}$ be the collection of 2-simplices that contains $e$. If $v\\in \\tau\\cap e$, then for each $\\lambda$, $\\tau\\cap\\Delta_{\\lambda}$ contains a curve that contains $v$.\n\\end{enumerate}\n\\end{definition}\n\nGiven a track $\\tau\\subset K$, we defined the \\textit{support} of $\\tau$, denoted Spt$(\\tau)$, to be the minimal subcomplex of $K$ which contains $\\tau$.\n\nWe can view hyperplanes defined in Section \\ref{subsec_cube complex} as analogue of tracks in the cubical setting. Each track $\\tau\\subset K$ has a regular neighbourhood which fibres over $\\tau$. When $K$ is simply-connected, $K\\setminus\\tau$ has two connected components, moreover, the regular neighbourhood of $\\tau$ is homeomorphic to $\\tau\\times(-\\epsilon,\\epsilon)$. \n\nTwo tracks $\\tau_{1}$ and $\\tau_{2}$ are \\textit{parallel} if $\\textmd{Spt}(\\tau_{1})=\\textmd{Spt}(\\tau_{2})$ and there is a region homeomorphic to $\\tau_{1}\\times(0,\\epsilon)$ bounded by $\\tau_{1}$ and $\\tau_{2}$. A track $\\tau\\subset K$ is \\textit{essential} if the components of $K\\setminus\\tau$ are unbounded. The following result follows from \\cite[Proposition 3.1]{dunwoody1985accessibility}:\n\\begin{lem}\nIf $K$ is simply-connected and has more than one end, then there exists an essential track $\\tau\\subset K$.\n\\end{lem}\n\nNext we look at essential tracks which are \\textquotedblleft minimal\\textquotedblright;\nthese turn out to behave like minimal surfaces. First we metrize $K$ as in \\cite{scott1996algebraic}.\n\nLet $\\Delta=\\Delta(\\xi_{1}\\xi_{2}\\xi_{3})$ be an ideal triangle in the hyperbolic plane. We mark a point in each side of the triangle as follows. Let $\\phi$ be the unique isometry which fixes $\\xi_{3}$ and flips $\\xi_{1}$ and $\\xi_{2}$, we mark the unique point in $\\overline{\\xi_{1}\\xi_{2}}$ which is fixed by $\\phi$. Other sides of $\\Delta$ are marked similarly. This is called a \\textit{marked ideal triangle}.\n\nWe identify each 2-simplex of $K$ with a marked ideal triangle in the hyperbolic plane and glue these triangles by isometries which identify the marked points. This gives a collection of complete metrics on each connected component of $K-K^{(0)}$ which is not an interval. We denote this collection of metrics by $d_{{\\mathbb H}}$. If a group $G$ acts on $K$ by simplicial isomorphisms, then $G$ also acts by isometries on $(K,d_{{\\mathbb H}})$. The original definition in \\cite{scott1996algebraic} does not required these marked points, see Remark \\ref{why marked} for why we add them.\n\nEach track $\\tau$ has a well-defined length under $d_{{\\mathbb H}}$, which we denote by $l(\\tau)$. We also define the \\textit{weight} of $\\tau$, denoted by $w(\\tau)$, to be cardinality of $\\tau\\cap K^{(1)}$. The \\textit{complexity} $c(\\tau)$ is defined to be the ordered pair $(w(\\tau),l(\\tau))$. We order the complexity lexicographically, namely $c(\\tau_{1})<c(\\tau_{2})$ if and only if $w(\\tau_{1})<w(\\tau_{2})$ or $w(\\tau_{1})=w(\\tau_{2})$ and $l(\\tau_{1})<l(\\tau_{2})$. \n\nThe following result follows from \\cite[Lemma 2.11 and Lemma 2.14]{scott1996algebraic}:\n\\begin{lem}\n\\label{cocompact minimal}\nSuppose $K$ is a uniformly locally finite and simply-connected simplicial 2-complex with at least two ends. Suppose $K$ does not contain separating vertices. Then there exists an essential track $\\tau\\subset K$ which has the least complexity with respect to $d_{{\\mathbb H}}$ among all essential tracks in $K$.\n\\end{lem}\n\n\\begin{remark}\n\\label{why marked}\nLet $\\{\\tau_{i}\\}_{i=1}^{\\infty}$ be a minimizing sequence. Since $K$ is uniformly locally finite, there are only finitely many combinatorial possibilities for $\\{\\tau_{i}\\}_{i=1}^{\\infty}$. Thus we can assume all the $\\tau_{i}$'s are inside a finite subcomplex $L$. Moreover, we can construct a hyperbolic metric $d_{{\\mathbb H}}$ on $L$ as above and it suffices to work in the space $(L,d_{{\\mathbb H}})$. However, if we do not use marked points in the construction of the hyperbolic metric on $K$, then each $\\tau_{i}$ may sit inside a copy of $L$ with different shears along the edges of $L$.\n\nIn \\cite{scott1996algebraic}, $K$ is assumed to be cocompact, so one does not need to worry about the above issue.\n\\end{remark}\n\n\\begin{remark}\nIf we metrize each simplex in $K$ with the Euclidean metric, then Lemma \\ref{cocompact minimal} and Lemma \\ref{subcomplex minimal} may not be true.  For example,\none can take the following picture, where the dotted line is part of some track $\\tau$. Once we shorten $\\tau$, it may hit the central vertex of the hexagon. However, this cannot happen if we have hyperbolic metrics on each simplex. Once $\\tau$ gets too close to some vertex, then it takes a large amount of length for $\\tau$ to escape that vertex since $d_{{\\mathbb H}}$ is complete (actually it does not matter if $d_{{\\mathbb H}}$ is not complete, since we also have a upper bound on the weight of $\\tau$).\n\\begin{center}\n\\includegraphics[scale=0.5]{3.png}\n\\end{center}\n\\end{remark}\n\nThe next result can be proved in a similar fashion:\n\n\\begin{lem}\n\\label{subcomplex minimal}\nLet $K$ be a simply-connected simplicial 2-complex. Let $A\\subset K$ be a uniformly locally finite subcomplex such that \n\\begin{enumerate}\n\\item $A$ contains an essential track of $K$.\n\\item $A$ does not contain any separating vertex of $K$.\n\\end{enumerate}\nThen there exists an essential track $\\tau$ of $K$ which has the least complexity among all essential tracks of $K$ with support in $A$.\n\\end{lem}\n\n\n\n\\begin{lem} \\cite[Lemma 2.7]{scott1996algebraic}\n\\label{disjoint}\nLet $\\tau_{1}$ and $\\tau_{2}$ be two essential tracks of $K$ which are minimal in the sense of Lemma \\ref{cocompact minimal} or Lemma \\ref{subcomplex minimal}, then either $\\tau_{1}=\\tau_{2}$, or $\\tau_{1}\\cap\\tau_{2}=\\emptyset$.\n\\end{lem}\n\n\\subsection{The proof of Proposition \\ref{key lemma}} First we briefly recall the notion of Rips complex. See \\cite[Chapter III.$\\Gamma$.3]{bridson_haefliger} for more detail. Let $(X,d)$ be a metric space and pick $R>0$. The \\textit{Rips complex} $P_{R}(X,d)$ is the geometric realization of the simplicial complex with vertex set $X$ whose $n$-simplices are the $(n+1)$-element subsets $\\{x_{0},\\cdots,x_{n}\\}\\subset X$ of diameter at most $R$.\n\nLet $d$ be the usual metric on $\\Bbb Z$. Define a new metric $\\bar{d}$ on $\\Bbb Z$ by \n\n", "index": 21, "text": "\\begin{equation*}\n\\bar{d}(x,y)=\\sup_{g\\in G}d(g(x),g(y))\n\\end{equation*}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex8.m1\" class=\"ltx_Math\" alttext=\"\\bar{d}(x,y)=\\sup_{g\\in G}d(g(x),g(y))\" display=\"block\"><mrow><mrow><mover accent=\"true\"><mi>d</mi><mo stretchy=\"false\">\u00af</mo></mover><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mrow><munder><mo movablelimits=\"false\">sup</mo><mrow><mi>g</mi><mo>\u2208</mo><mi>G</mi></mrow></munder><mo>\u2061</mo><mrow><mi>d</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mrow><mi>g</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>,</mo><mrow><mi>g</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>y</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo stretchy=\"false\">)</mo></mrow></mrow></mrow></mrow></math>", "type": "latex"}, {"file": "1601.00946.tex", "nexttext": "\nfor any $x,y\\in \\pi^{-1}(V_0)$. \n\nTo see the second inequality, pick a geodesic line $\\ell\\in \\Pi_H$ connecting $x$ and $y$. Since each standard product in $\\Pi_H$ is convex (Corollary~\\ref{isometric embedding}), the intersection of $\\ell$ with each standard product is a (possibly empty) segment. Thus we can assume $\\ell$ is an concatenation of geodesic segments $\\{\\ell_i\\}_{i=1}^{k}$ such that each $\\ell_i$ is contained in a standard product $P_i$. Recall that each $P_i$ is a product of mapping cylinders. For each $i$, we construct another piecewise geodesic $\\bar{\\ell}_{i}$ such that:\n\\begin{enumerate}\n\\item $\\bar{\\ell}_i$ and $\\ell_i$ have the same endpoints.\n\\item $\\bar{\\ell}_i$ is a concatenation of geodesic segments $\\{\\bar{\\ell}_{ij}\\}_{j=1}^{k_i}$ such that the projection of $\\bar{\\ell}_{ij}$ to all but one of the product factors of $P_i$ are trivial.\n\\item There exists $D$ which is independent of $x,y$ and $\\ell_i$ such that length$(\\bar{\\ell}_i)\\le D$ length$(\\ell_i)$.\n\\end{enumerate}\nIt follows from the construction of residue projection that for each $\\lambda$, $\\xi_{\\lambda}(\\bar{\\ell}_{ij})$ is either a point, or a segment which has the same length as $\\bar{\\ell}_{ij}$, and there is exactly one $\\lambda$ such that $\\xi_{\\lambda}(\\bar{\\ell}_{ij})$ is non-trivial. Thus the second inequality follows.\n\nTo see the first inequality, let $c_x$ and $c_y$ be chambers in ${\\mathcal{B}}$ that correspond to $x$ and $y$ respectively. Let ${\\mathcal G}\\subset {\\mathcal{B}}$ be a shortest gallery connecting $c_x$ and $c_y$. Every two adjacent elements in the gallery are contained in a rank 1 residue, and different pairs of adjacent elements give rise to rank 1 residues in different parallel class (otherwise we can shorten the gallery). Note that ${\\mathcal G}$ corresponds to a chain of points in $\\pi^{-1}(V_0)$. Connecting adjacent points in this chain by geodesics induces a piecewise geodesic $\\ell\\subset \\Pi_H$ connecting $x$ and $y$, moreover, the length of $\\ell$ is equal to $\\Sigma_{\\lambda\\in \\Lambda_H} d(\\xi_\\lambda(x),\\xi_\\lambda(y))$, thus the first inequality holds.\n\nGiven $x\\in \\pi^{-1}(V_0)$, any other point $y\\in \\pi^{-1}(V_0)$ in the $R$-ball can be connected to $x$ via a chain of points in $\\pi^{-1}(V_0)$ which is induced by a shortest gallery as above. The above claim implies that the size of the chain is bounded above in terms of $R$. Two adjacent points have distance in $\\Pi_H$ bounded above in terms of $R$, and they correspond to chambers in the same rank 1 residue. There are only finite many such chains since our assumption implies there are only finitely many choices for each successive point of such a chain. Thus the intersection of $\\pi^{-1}(V_0)$ with any bounded metric ball in $\\Pi_H$ is finite.\n\\end{proof}\n\n\\begin{remark}\nSuppose we use $l^1$-product instead of Cartesian product in step 2 of Section~\\ref{construction}. Let $d_{l^1}$ be the resulting metric on $\\Pi_H$. Then $d_{l^1}(x,y)=\\Sigma_{\\lambda\\in \\Lambda_H} d(\\xi_\\lambda(x),\\xi_\\lambda(y))$ for any $x,y\\in \\pi^{-1}(V_0)$. \n\\end{remark}\n\nThe construction in this section unifies several other constructions as follows:\n\\begin{enumerate}\n\\item The Davis realization of right-angled building (Proposition \\ref{Davis}).\n\\item If ${\\mathcal{B}}$ is the right-angled building associated with a graph product of ${\\mathbb Z}$'s, each space is ${\\mathbb R}$ and each map is a bijection between chambers and integer points in ${\\mathbb R}$, then the blow-up of ${\\mathcal{B}}$ is the universal covering of the exploded Salvetti complex with the correct group action. \n\\item The corresponding reduced blow-up in (2) is the universal covering of Salvetti complex.\n\\item Let ${\\mathcal{B}}$ be as in (2). If each space is ${\\mathbb R}$, and each map arises from Proposition~\\ref{key lemma}, then the blow-up of ${\\mathcal{B}}$ is the geometric model we construct for group quasi-isometric to RAAG's in Section~\\ref{section_quasi-action on RAAGs}.\n\\item Suppose $H$ is a graph product of a collection of groups $\\{H_{i}\\}_{i\\in I}$ and ${\\mathcal{B}}$ is the associated building. Suppose each $H_{i}$ acts on a $CAT(0)$ cube complex $Z_{i}$ with a free orbit. And we pick a $H_i$-equivariant map from $H_i$ to the free orbit. Then the action of the $H$ on the associated reduced blow-up of ${\\mathcal{B}}$ is equivariantly isomorphic to the graph product of group actions defined on \\cite[Section 4.2]{haglund2008finite}\n\\end{enumerate}\n\n\n\\section*{Part III: A wallspace approach to cubulating RAAG's}\nIn the remainder of the paper, we use wallspaces to give a different approach to cubulating quasi-actions on RAAG's.  This gives a shorter path to the cubulation,\nbut gives less precise information about its structure.\n\n\n\nWe assume $G(\\Gamma)\\neq{\\mathbb Z}$ in Section \\ref{sec_construction of wallspace} and Section \\ref{sec_property of wallspace}.\n\n\\section{Construction of the wallspace}\n\\label{sec_construction of wallspace}\n\n\\subsection{Background on wallspaces}\n\\label{subsec_wallspaces}\nWe will be following \\cite{hruska2014finiteness} in this section.\n\n\\begin{definition}(Wallspaces)\nLet $Z$ be a nonempty set. A \\textit{wall} of Z is a partition of $Z$ into two subsets $\\{U,V\\}$, each of which is called a \\textit{halfspace}. Two points $x,y\\in Z$ are \\textit{separated} by a wall if $x$ and $y$ are in different halfspaces. $(Z,\\mathcal{W})$ is a \\textit{wallspace} if $Z$ is endowed with a collection of walls $\\mathcal{W}$ such that every two distinct points $x,y\\in Z$ are separated by finitely many walls. Here we allow the situation that two points are not separated by any wall.\n\\end{definition}\n\n\nTwo distinct walls $W=\\{U_{1},U_{2}\\}$ and $W'=\\{V_{1},V_{2}\\}$ are \\textit{transverse} if $U_{i}\\cap V_{j}\\neq\\emptyset$ for all $1\\le i,j\\le 2$. \n\nAn \\textit{orientation} of a wall is a choice of one of its halfspaces. An orientation $\\sigma$ of the wallspace $(Z,\\mathcal{W})$ is a choice of orientation $\\sigma(W)$ for each $W\\in\\mathcal{W}$. \n\n\\begin{definition}\n\\label{0-cube}\nA \\textit{0-cube} of $(Z,\\mathcal{W})$ is an orientation $\\sigma$ such that\n\\begin{enumerate}\n\\item $\\sigma(W)\\cap \\sigma(W')\\neq\\emptyset$ for all $W,W'\\in\\mathcal{W}$.\n\\item For each $x\\in Z$, we have $x\\in\\sigma(W)$ for all but finitely many $W\\in\\mathcal{W}$.\n\\end{enumerate}\n\\end{definition}\n\nEach ${\\operatorname{CAT}}(0)$ cube complex $C$ gives rise to a wallspace $(Z,\\mathcal{W})$ where $Z$ is the vertex set of $C$ and the walls are induced by hyperplanes of $C$. Conversely, each wallspace $(Z,\\mathcal{W})$ naturally give rises to a dual ${\\operatorname{CAT}}(0)$ cube complex $C(Z,\\mathcal{W})$. The vertices of $C(Z,\\mathcal{W})$ are in 1-1 correspondence with $0$-cubes of $(Z,\\mathcal{W})$. Two $0$-cubes are joined by an edge if and only if their orientations are different on exactly one wall. \n\n\\begin{lem}\n\\label{dimension}\n$($\\cite[Corollary 3.13]{hruska2014finiteness}$)$ $C(Z,\\mathcal{W})$ is finite dimensional if and only if there is a finite upper bound on the size of collections of pairwise transverse walls. In this case, $\\dim(C(Z,\\mathcal{W}))$ is equal to the largest possible number of pairwise transverse walls.\n\\end{lem}\n\nThere is a 1-1 correspondence between walls in $(Z,\\mathcal{W})$ and hyperplanes in $C(Z,\\mathcal{W})$. We can define a map which associates each finite dimensional cube in $C(Z,\\mathcal{W})$ a collection of pairwise transverse walls in $(Z,\\mathcal{W})$ by considering the hyperplanes which have non-trivial intersection with the cube.  \n \n\\begin{lem}\n\\label{maximal cube}\n$($\\cite[Proposistion 3.14]{hruska2014finiteness}$)$ The above map induces a 1-1 correspondence between finite dimensional maximal cubes in $C(Z,\\mathcal{W})$ and finite maximal collections of pairwise transverse walls in $(Z,\\mathcal{W})$. \n\\end{lem}\n\nTwo $0$-cubes $\\sigma_{x}$ and $\\sigma_{y}$ of $(Z,\\mathcal{W})$ are \\textit{separated} by a wall $W\\in\\mathcal{W}$ if and only if $\\sigma_{x}(W)$ and $\\sigma_{y}(W)$ are different halfspaces of $W$. In this case, the hyperplane in $C(Z,\\mathcal{W})$ corresponding to $W$ separates the vertices associated with $\\sigma_{x}$ and $\\sigma_{y}$.\n\n\\subsection{Preservation of levels}\n\\label{subsec_flat-preserving}\nIn the rest of this section, we assume ${\\operatorname{Out}}(G(\\Gamma))$ is finite and $\\rho:H{\\curvearrowright} G(\\Gamma)$ is an $(L,A)$-quasi-action. We refer to Definition \\ref{def_flat_preserving} for flat preserving bijections.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nBy Theorem \\ref{thm_intro_vertex_rigidity}, we can assume $\\rho$ is an action by flat-preserving bijections which are also $(L,A)$-quasi-isometries.\n\nLet ${\\mathcal P}({\\Gamma})$ be the extension complex, and for every standard flat $F\\subset X({\\Gamma})$, let ${\\Delta}(F)\\in{\\mathcal P}({\\Gamma})$ be the parallel class;  see Section~\\ref{subsec_raag}. Note that every flat preserving bijection $h:G({\\Gamma})\\to G({\\Gamma})$ induces a simplicial isomorphism $\\partial h:{\\mathcal P}({\\Gamma})\\to{\\mathcal P}({\\Gamma})$. Thus $\\rho$ induces an action $H{\\curvearrowright} {\\mathcal P}({\\Gamma})$ by simplicial isomorphisms.\n\\label{subsec_level}\n\\begin{definition}[Levels]\nPick a vertex $v\\in\\mathcal{P}(\\Gamma)$ and let $l\\subset X(\\Gamma)$ be a standard geodesics such that $\\Delta(l)=v$. For every vertex $x\\in l$, a \\textit{$v$-level} (\\textit{of height $x$}) is defined to be $\\{z\\in G(\\Gamma)\\mid \\pi_{l}(z)=x\\}$, here $\\pi_{l}$ is the ${\\operatorname{CAT}}(0)$ projection onto $l_{v}$. Note that $\\pi^{-1}_{l}(x)$ is a convex subcomplex of $X(\\Gamma)$ and the $v$-level of height $x$ is exactly the vertex set of this convex subcomplex. The definition of $v$-level does not depend on the choice of the standard geodesic $l$ in the parallel class.\n\\end{definition}\n\n\\begin{lem}\n\\label{level}\nLet $h: G(\\Gamma)\\to G(\\Gamma)$ be a flat-preserving projection. Then for any $v\\in\\mathcal{P}(\\Gamma)$, $h$ sends  $v$-levels to  $\\partial h(v)$-levels.\n\\end{lem}\n\n\\begin{proof}\nPick standard geodesic $l$ such that $\\Delta(l)=v$ and pick vertex $x\\in l$. Suppose $l'$ is the standard geodesic such that $\\alpha(v(l))=v(l')$. Let $y\\in G(\\Gamma)$ be such that $\\pi_{l}(y)=x$. It suffices to show $\\pi_{l'}(h(y))=h(x)$.\n\nLet $\\omega$ be a combinatorial geodesic joining $y$ and $x$ and let $\\{x_{i}\\}_{i=0}^{n}$ be vertices in $\\omega$ such that (1) $x_{0}=y$ and $x_{n}=x$; (2) for $1\\le i\\le n$, there exists a standard geodesic  $l_{i}$ such that $x_{i}\\in l_{i}$ and $x_{i-1}\\in l_{i}$. Note that $\\omega\\subset \\pi^{-1}_{l}(x)$ since $\\pi^{-1}_{l}(x)$ is a convex subcomplex. Thus $l_{i}\\subset \\pi^{-1}_{l}(x)$ for all $i$, hence $\\Delta(l_{i})\\neq v$ for all $i$. Suppose $x'_{i}=h(x_{i})$ and let $l'_{i}$ be the standard geodesic which contains $x'_{i}$ and $x'_{i-1}$. Then $\\partial h(\\Delta(l_{i}))=\\Delta(l'_{i})$, thus $\\Delta(l'_{i})\\neq\\Delta(l')$. It follows that $\\pi_{l'}(l'_{i})$ is a point, and hence $\\pi_{l'}(x'_{i})=\\pi_{l'}(x'_{i-1})$ for all $i$.\n\\end{proof}\n\n\\begin{lem}\n\\label{in one level}\nLet $K\\subset X(\\Gamma)$ be a standard subcomplex and define $\\Delta(K)$ to be the union of all $\\Delta(F)$ with $F$ ranging over all standard flats in $K$. Pick vertex $v\\in\\mathcal{P}(\\Gamma)$. If $v\\notin \\Delta(K)$, then $K^{(0)}$ is contained in a $v$-level.\n\\end{lem}\n\n\\begin{proof}\nLet $l\\in X(\\Gamma)$ be a standard geodesic such that $\\Delta(l)=v$. It suffices to prove for each edge $e\\in K$, $\\pi_{l}(e)$ is a point. Suppose the contrary is true. Then $\\pi_{l}(e)$ is an edge of $l$ by Lemma \\ref{project onto line}, and hence the standard geodesic  $l_{e}$ that contains $e$ is parallel to $l$. However, $l_{e}\\subset K$ since $K$ is standard, which implies $v\\in\\Delta(K)$.\n\\end{proof}\n\n\n\\subsection{A key observation}\n\\label{subsec_key}\nThe flat-preserving action $H\\curvearrowright G(\\Gamma)$ induces an action $H\\curvearrowright \\mathcal{P}(\\Gamma)$. For each vertex $v\\in\\mathcal{P}(\\Gamma)$, let $H_{v}\\subset H$ be the subgroup which stabilizes $v$. In other words, if $l$ is a standard geodesic such that $\\Delta(l)=v$, then $H_{v}$ is the stabilizer of the parallel set of $l$. \n\nBy Lemma \\ref{level}, $H_{v}$ permutes $v$-levels. Recall that the ${\\operatorname{CAT}}(0)$ projection $\\pi_{l}$ induces a 1-1 correspondence between $v$-levels and vertices of $l$; moreover, for any two $v$-levels $L_{1}$ and $L_{2}$, $d(L_{1},L_{2})=d(\\pi_{l}(L_{1}),\\pi_{l}(L_{2}))$ ($d$ is the word metric). Thus the collections of $v$-levels can be identified with $\\Bbb Z$ (endowed with the standard metric), and we have an induced action $\\rho_{v}:H_{v}\\curvearrowright \\Bbb Z$ by $(L',A')$-quasi-isometries; here $L',A'$ can be chosen to be independent of $v$. \n\nWe recall the following result which is proved in Section~\\ref{sec_quasi action on Z}.\n\\begin{proposition}\n\\label{key lemma1}\nIf a group $G$ has an action on $\\Bbb Z$ by $(L,A)$-quasi-isometries, then there exists another action $G\\curvearrowright\\Bbb Z$ by isometries which is related to the original action by a surjective equivariant $(L',A')$-quasi-isometry $f: \\Bbb Z\\to \\Bbb Z$ with $L',A'$ depending on $L$ and $A$.\n\\end{proposition}\n\n\\begin{definition}[Branched lines and flats]\nA \\textit{branched line} is constructed from a copy of $\\Bbb R$ by attaching finitely many edges of length 1 to each integer point. We also require the valence of each vertex in a branched line is bounded above by a uniform constant. This space has a natural simplicial structure and is endowed with the path metric. A \\textit{branched flat} is a product of finitely many branched lines.\n\\end{definition}\n\n\\begin{definition}[Branching number]\nLet $\\beta$ be a branched line. We define the\\textit{ branching number} of $\\beta$, denoted by $b(\\beta)$, to be the maximum valence of vertices in $\\beta$.\n\\end{definition}\nThe following picture is a branched line with branching number $=5$:\n\n\\includegraphics[scale=0.5]{1.png}\n\n\\begin{remark}\nA branched line can be roughly thought as a \\textquotedblleft mapping cylinder\\textquotedblright\\ of the map $f$ in Proposition \\ref{key lemma1}.\n\\end{remark}\n\n\n\\begin{definition}[Tips and wall structure on tips]\n\\label{wall on tips}\nLet $\\beta$ be a branched line. We call the vertices of valence $\\le 2$ in $\\beta$ the \\textit{tips} of $\\beta$, and the collection of all tips is denoted by $t(\\beta)$. The set of hyperplanes in $\\beta$ (namely the midpoints of edges) induces a natural wall structure on $t(\\beta)$.\n\nFor a branched flat $F$, we define $t(F)$ to be the product of the tips of its branched line factors.\n\\end{definition}\n\n\n\\begin{cor}\n\\label{bijective}\nIf a group $G$ has an action on $\\Bbb Z$ by $(L,A)$-quasi-isometries, then there exist a branched line $\\beta$ and an isometric action $G\\curvearrowright \\beta$ which is related to the original action by a bijective equivariant map $q: \\Bbb Z\\to t(\\beta)$. Moreover, there exists a constant $M$ depending only on $L$ and $A$ such that $q$ is an $M$-bi-Lipschitz map and each vertex in $\\beta$ has valance $\\le M$.\n\\end{cor}\n\n\\begin{proof}\nLet $f:\\Bbb Z\\to\\Bbb Z$ be the map in Proposition \\ref{key lemma1}. We identify the range of $f$ as integer points of $\\Bbb R$. Pick $x\\in\\Bbb Z$, if the cardinality $|f^{-1}(x)|\\ge 2$, we attach $|f^{-1}(x)|$ many edges of length 1 to $\\Bbb R$ along $x$. When $|f^{-1}(x)|=1$, no edge will be attached. Let $\\beta$ be the resulting branched line. Then there is a natural bijective equivariant map $q: \\Bbb Z\\to t(\\beta)$ and the corollary follows from Proposition \\ref{key lemma1}.\n\\end{proof}\n\nIn the proof of Corollary \\ref{bijective}, the ${\\operatorname{CAT}}(0)$ cube complex dual to $t(\\beta)$ with the wall structure described in Definition \\ref{wall on tips} is isomorphic to $\\beta$. Note that this is not true for general branched lines.\n\n\\subsection{An invariant wallspace}\n\\label{subsec_invariant wallspace}\n$G(\\Gamma)$ has a natural wallspace structure which is induced from $X(\\Gamma)$; however, $H$ may not act on this wallspace. We want to find an alternative wallspace structure on $G(\\Gamma)$ which is consistent with the action of $H$.\n\n\\begin{definition}[$v$-walls and $v$-halfspaces]\nPick a vertex $v\\in\\mathcal{P}(\\Gamma)$. It follows from Corollary \\ref{bijective} that there exist a branched line $\\beta_{v}$,  an isometric action $H\\curvearrowright \\beta_{v}$, and an $H_{v}$-equivariant surjective map $\\eta_{v}: G(\\Gamma)\\to t(\\beta_{v})$ such that the inverse image of each point in $t(\\beta_{v})$ is a $v$-level. A \\textit{$v$-wall} (or a \\textit{$v$-halfspace}) of $G(\\Gamma)$ is the pullback of some wall (or halfspace) of $t(\\beta_{v})$ (see Definition \\ref{wall on tips}) under the map $\\eta_{v}$. The collection of all $v$-walls is denoted by $\\mathcal{W}_{v}$. \n\nNow for each vertex $v\\in\\mathcal{P}(\\Gamma)$, we want to choose a collection of $v$-walls, $\\beta_{v}$ and $\\eta_{v}$ in an $H$-equivariant way. Recall that $H\\curvearrowright G(\\Gamma)$ induces an action $H\\curvearrowright\\mathcal{P}(\\Gamma)$. We pick one representative from each vertex orbit of $H\\curvearrowright\\mathcal{P}(\\Gamma)$, which gives rise to a collection $\\{v_{i}\\}_{i\\in I}$. We choose $\\mathcal{W}_{v_{i}}$ as above and let $\\mathcal{W}$ be the union of all walls in $\\mathcal{W}_{v_{i}}$ for $i\\in I$, together with the $H$-orbits of these walls. \n\\end{definition}\n\nNow we record several consequences of the above construction.\n\\begin{lem}\\\n\\label{wallspace property}\n\\begin{enumerate}\n\\item Each $v$-halfspace is a union of $v$-levels, thus a $v$-wall and a $v'$-wall do not induce the same partition of $G(\\Gamma)$ if $v\\neq v'$.\n\\item Distinct $v$-walls in $\\mathcal{W}$ are never transverse.\n\\item $C(G(\\Gamma),\\mathcal{W}_{v})$ is isomorphic to $\\beta_{v}$.\n\\item Pick a standard geodesic line $l$ such that $\\Delta(l)=v$, and identify the vertex set $v(l)$ with $\\Bbb Z$. Then there exists $N>0$ independent of $v\\in\\mathcal{P}(\\Gamma)$ such that the map $\\xi_{v}:\\Bbb Z\\cong v(l)\\to C(G(\\Gamma),\\mathcal{W}_{v})\\cong \\beta_{v}$ is an $N$-bi-Lipschitz bijection.\n\\item There exists $M>0$ independent of $v\\in\\mathcal{P}(\\Gamma)$ such that the branching number $b(\\beta_{v})$ is at most $M$.\n\\end{enumerate}\n\\end{lem}\n \n$(4)$ and $(5)$ follow from Corollary \\ref{bijective}.\n\n\\begin{lem}\n\\label{wallspace}\n$(G(\\Gamma),\\mathcal{W})$ is a wallspace.\n\\end{lem}\n\n\\begin{proof}\nFor any pair of  points $x,y\\in G(\\Gamma)$, we need to show there are finitely many walls separating $x$ and $y$. If a $v$-wall separates $x$ from $y$, then $x$ and $y$ are in different $v$-level. There are only finitely many such vertices in $\\mathcal{P}(\\Gamma)$. Given such $v$, there are finitely many $v$-walls separating $x$ and $y$.\n\\end{proof}\n\nBy construction, $H$ acts on the wallspace $(G(\\Gamma),\\mathcal{W})$. Let $C$ be the ${\\operatorname{CAT}}(0)$ cube complex dual to $(G(\\Gamma),\\mathcal{W})$, then there is an induced action $H\\curvearrowright C$. Now we look at several properties of $C$.\n\n\n\\section{Properties of the cubulation}\n\\label{sec_property of wallspace}\n\n\\subsection{Dimension}\n\\label{subsec_structure}\n\nWe need the following lemmas before we compute the dimension of the dual complex $C$.\n\n\\begin{lem}\n\\label{transverse}\nLet $v_{1},v_{2}\\in\\mathcal{P}(\\Gamma)$ be distinct vertices. Then a $v_{1}$-wall and a $v_{2}$-wall are transverse if and only if $v_{1}$ and $v_{2}$ are adjacent.\n\\end{lem}\n\n\\begin{proof}\nThe if direction is clear (one can consider a standard 2-flat corresponding to the vertices $v_{1}$ and $v_{2}$). The other direction follows from Lemma \\ref{level projection} below.\n\\end{proof}\n\n\\begin{lem}\n\\label{level projection}\nLet $v_{1},v_{2}\\in\\mathcal{P}(\\Gamma)$ be non-adjacent vertices. For $i=1,2$, let $l_{i}$ be standard geodesic such that $\\Delta(l_{i})=v_{i}$. Let $x_{2}\\in l_{2}$ be the image $\\pi_{l_{2}}(l_{1})$ of the ${\\operatorname{CAT}}(0)$ projection $\\pi_{l_2}$ and let $x_{1}=\\pi_{l_{1}}(l_{2})$. Then any $v_{2}$-level which is not of height $x_{2}$ is contained in the $v_{1}$-level of height $x_{1}$ $($see the picture below$)$.\n\\end{lem}\n\n\\begin{center} \n\\includegraphics[scale=0.35]{2.png}\n\\end{center}\n\n\\begin{proof}\nSuppose the contrary is true.  Then there exists a vertex $x'_{2}\\in l_{2}$ with $x'_{2}\\neq x_{2}$, a $v_{2}$-level $K$ of height $x'_{2}$ and a vertex $x\\in K$ such that $x$ is not inside the $v_{1}$-level of height $x_{1}$. Let $\\omega\\subset X(\\Gamma)$ be a combinatorial geodesic connecting $x$ and $x'_{2}$. Since $\\pi_{l_{1}}(x'_{2})=x_{1}\\neq \\pi_{l_{1}}(x)$, there exists an edge $e\\subset \\omega$ and edge $e_{1}\\subset l_{1}$ such that $e$ and $e_1$ are parallel. Thus $\\pi_{l_{2}}(e)=\\pi_{l_{2}}(e_{1})=x_{2}$ by Lemma \\ref{projection}. On the other hand, since $\\pi^{-1}_{l_{2}}(x'_{2})$ is convex, $\\pi_{l_{2}}(e)\\subset\\pi_{l_{2}}(\\omega)=x'_{2}$, which is a contradiction.\n\\end{proof} \n\n\\begin{lem}\n$\\dim(C)=\\dim(G(\\Gamma))$.\n\\end{lem}\n\n\\begin{proof}\nLet $\\{W_{i}\\}_{i=1}^{l}\\subset\\mathcal{W}$ be a collection of pairwise intersecting walls and suppose $W_{i}$ is a $u_{i}$-wall. Then $u_{i}\\neq u_{j}$ for $i\\neq j$. Thus $\\{u_{i}\\}_{i=1}^{l}$ are vertices of a simplex in $\\mathcal{P}(\\Gamma)$ by Lemma \\ref{transverse}. It follows from Lemma \\ref{dimension} that $\\dim(C)=\\dim(\\mathcal{P}(\\Gamma))+1=\\dim(G(\\Gamma))$.\n\\end{proof}\n\n\\subsection{Standard branched flats}\nPick a maximal simplex $\\Delta\\in\\mathcal{P}(\\Gamma)$. Let $\\mathcal{W}_{\\Delta}$ be the collection of $u$-walls in $\\mathcal{W}$ with $u$ ranging over all vertices of $\\Delta$. Let $C(G(\\Gamma),\\mathcal{W}_{\\Delta})$ be the ${\\operatorname{CAT}}(0)$ cube complex dual to the wallspace $(G(\\Gamma),\\mathcal{W}_{\\Delta})$. \n\n\\begin{lem}\n\\label{embedding}\nThere exists a natural isometric embedding \n\\begin{center}\n$C(G(\\Gamma),\\mathcal{W}_{\\Delta})\\hookrightarrow C(G(\\Gamma),\\mathcal{W})=C$.\n\\end{center}\n\\end{lem}\n\n\\begin{proof}\nFirst we want to assign an orientation to each wall $W\\in\\mathcal{W}\\setminus\\mathcal{W}_{\\Delta}$. If $W$ is a $u$-wall, then by the maximality of $\\Delta$, there exists vertex $v\\in\\Delta$ which is not adjacent to $u$. Pick standard geodesics $l_{u}$ such that $\\Delta(l_{u})=u$. Let $F$ be the maximal standard flat such that $\\Delta(F)=\\Delta$. Since $u\\notin \\Delta$, $F^{(0)}$ is contained in a $u$-level by Lemma \\ref{in one level}. We orient $W$ such that\n\n", "itemtype": "equation", "pos": 216041, "prevtext": "\nNote that $(\\Bbb Z,\\bar{d})$ is quasi-isometric to $(\\Bbb Z,d)$, and $G$ acts on $(\\Bbb Z,\\bar{d})$ by isometries. Since $(\\Bbb Z,\\bar{d})$ is Gromov-hyperbolic, the Rips complex $P_{R}(\\Bbb Z,\\bar{d})$ is contractible for some $R=R(L,A)$ (see \\cite[Proposition III.$\\Gamma$.3.23]{bridson_haefliger}). Let $K$ be the 2-skeleton of $P_{R}(\\Bbb Z,\\bar{d})$. Then $K$ is simply-connected, uniformly locally finite and 2-ended. \n\nWe make $K$ a piecewise Euclidean complex by identifying each 2-face with an equilateral triangle and identifying each edge with $[0,1]$. Let $d_{\\Bbb E}$ be the resulting length metric. There is an inclusion map $i:(\\Bbb Z,d)\\to (K,d_{\\Bbb E})$ which is a quasi-isometry with  quasi-isometry constants depending only on $L$ and $A$.\n \n\\begin{claim}\n\\label{claim_exist_tracks}\nThere exist $D_{1}=D_{1}(L,A)$ and a collection of disjoint essential tracks $\\{\\tau_{i}\\}_{i\\in I}$ of $K$ such that\n\\begin{enumerate}\n\\item $\\{\\tau_{i}\\}_{i\\in I}$ is $G$-invariant.\n\\item The diameter of each $\\tau_i$  with respect to $d_{{\\mathbb E}}$ is $\\le D_{1}$.\n\\item Each connected component of $K\\setminus(\\cup_{i\\in I}\\tau_{i})$ has diameter $\\le D_{1}$.\n\\end{enumerate}\n\\end{claim}\n\nIn the following proof, we denote the ball of radius $D$ centered at $x$ in $K$ with respect to $d_{{\\mathbb E}}$ by $B_{{\\mathbb E}}(x,D)$. Let ${\\operatorname{diam}}_{{\\mathbb E}}$ be the diameter with respect to $d_{{\\mathbb E}}$.\n\n\\begin{proof}[Proof of Claim \\ref{claim_exist_tracks}]\nFirst we assume $K$ does not have separating vertices. Since $K$ is quasi-isometric to ${\\mathbb Z}$, there exists $D=D(L,A)$ such that $K\\setminus B_{{\\mathbb E}}(x,D)$ has at least two unbounded components for each $x\\in K$. Thus every $(D+1)$-ball contains an essential track with  weight bounded above by $D'=D'(L,A)$. We put a $G$-invariant hyperbolic metric $d_{{\\mathbb H}}$ on $K$ as in Section \\ref{subsec_track}. By Lemma \\ref{cocompact minimal}, there exists an essential track $\\tau\\subset K$ of least complexity. Note that ${\\operatorname{diam}}_{{\\mathbb E}}(\\tau)\\le D'$ since the weight $w(\\tau)\\le D'$. Lemma \\ref{disjoint} implies the $G$-orbits of $\\tau$ give rise to collection of disjoint essential tracks in $K$.\n\n\nA collection of tracks $\\{\\tau_{i}\\}_{i\\in I}$ of $K$ is \\textit{admissible} if\n\\begin{enumerate}\n\\item Each track in $\\{\\tau_{i}\\}_{i\\in I}$ is essential and different tracks have empty intersection.\n\\item No two tracks in $\\{\\tau_{i}\\}_{i\\in I}$ are parallel.\n\\item The collection $\\{\\tau_{i}\\}_{i\\in I}$ is $G$-invariant.\n\\item ${\\operatorname{diam}}_{{\\mathbb E}}(\\tau_{i})\\le D'$ for each $i\\in I$.\n\\end{enumerate} \nThere exists a non-empty admissible collection of tracks by previous discussion.\n\nLet $\\{\\tau_{i}\\}_{i\\in I}$ be a maximal admissible collection of tracks. Then this collection satisfies the above claim with $D_{1}=2D'+5D$. To see this, let $C$ be one connected component of $K\\setminus(\\cup_{i\\in I}\\tau_{i})$. Since each track is essential and $K$ is 2-ended, either ${\\operatorname{diam}}_{{\\mathbb E}}(C)< \\infty$ and $\\bar{C}\\setminus C$ ($\\bar{C}$ is the closure of $C$) is made of two tracks $\\tau_{1}$ and $\\tau_{2}$, or ${\\operatorname{diam}}_{{\\mathbb E}}(C)=\\infty$ and $\\bar{C}\\setminus C$ is made of one track. Let us assume the former case is true. The latter case can be dealt in a similar way. Let $A$ be the maximal subcomplex of $K$ which is contained in $C$. Then $A$ is uniformly locally finite and $C\\setminus A$ is contained in the 1-neighbourhood of $\\tau_{1}\\cup\\tau_{2}$.\n\nSuppose ${\\operatorname{diam}}_{{\\mathbb E}}(C)\\ge 2D'+5D$. Since ${\\operatorname{diam}}_{{\\mathbb E}}(\\tau_{i})\\le D'$ for $i=1,2$, there exists $x\\in A$ such that $B_{{\\mathbb E}}(x,2D)\\subset A$. Thus $A$ contains an essential track of $X$ with its weight bounded above by $D'$. Let $\\eta\\subset A$ be an essential track of $K$ which has the least complexity in the sense of Lemma \\ref{subcomplex minimal}, then $w(\\eta)\\le D'$, hence ${\\operatorname{diam}}_{{\\mathbb E}}(\\eta)\\le D'$. Moreover, by Lemma \\ref{disjoint}, for each $g\\in {\\operatorname{Stab}}(A)={\\operatorname{Stab}}(C)$, either $g\\cdot\\eta=\\eta$ or $g\\cdot\\eta\\cap\\eta=\\emptyset$. Thus we can enlarge the original admissible collection of tracks by adding the $G$-orbits of $\\eta$, which yields a contradiction.\n\nThe case when $K$ has separating vertices is actually easier, since one can find essential tracks on the $\\epsilon$-sphere of each separating vertices. The rest of the proof is identical.\n\\end{proof}\n\nWe now continue with the proof of Proposition \\ref{key lemma}.\n\nPick a regular neighbourhood $N(\\tau_{i})$ for each $\\tau_{i}$ such that collection $\\{N(\\tau_{i})\\}_{i\\in I}$ is disjoint and $G$-invariant. Then we define a map $\\phi$ from $K$ to a tree $T$ by collapsing each component of $Y\\setminus\\cup_{i\\in I}N(\\tau_{i})$ to a vertex and collapsing each $N(\\tau_{i})$, which is homeomorphic to $\\tau_{i}\\times (0,1)$, to the $(0,1)$ factor. It is easy to make $\\phi$ equivariant under $G$, and by the above claim, $\\phi$ is a quasi-isometry with  quasi-isometry constants depending only on $L$ and $A$. Note that $T$ is actually a line since $\\tau$ is essential and $K$ is 2-ended. Then Proposition \\ref{key lemma} follows by considering the $G$-equivariant map $\\phi\\circ i:(\\Bbb Z,d)\\to T$. \n\n\\begin{remark}\nIf the action $G\\curvearrowright\\Bbb Z$ by $(L,A)$-quasi-isometries in Proposition \\ref{key lemma} is not cobounded, then the resulting isometric action $\\Lambda:G{\\curvearrowright}{\\mathbb Z}$ is also not cobounded, hence there are two possibilities:\n\\begin{enumerate}\n\\item if $G$ coarsely preserve the orientation of ${\\mathbb Z}$, then $\\Lambda$ is trivial;\n\\item otherwise $\\Lambda$ factors through a ${\\mathbb Z}/2$-action by reflection.\n\\end{enumerate}\n\\end{remark}\n\\section*{Part II: An alternate blow-up construction for buildings}\n\n\n\\section{Blowing-up buildings by metric spaces}\n\\label{sec_blow-up building more general version}\nIn Section \\ref{sec_blow-up of building}\n we discussed a construction for blowing-up a right-angled building.  Here we give a somewhat different approach, which allows us to deal with more general situations.  It unifies several other objects discussed in this paper and has interesting applications to graph products. \n\\subsection{Construction}\n\\label{construction}\nWe are motivated by the fact that the universal cover of the Salvetti complex can obtained by gluing a collection of standard flats in a way determined by the associated building. Similarly, we can construct the universal cover of exploded Salvetti complex by gluing a collection of branched flats. Here we specify the gluing pattern, and replace standard flats or branched flats by other product structures, which allows us to generalize the construction of these objects.\n\nLet ${\\Gamma}$ be a finite simplicial graph, and let ${\\mathcal{B}}$ be a building modelled on the right-angled Coxeter group $W({\\Gamma})$ with finite defining graph ${\\Gamma}$.\n\n\\textit{Step 1:}\nFor every vertex $v$ of ${\\Gamma}$, and every \n$v$-residue $r_v\\subset {\\mathcal{B}}$, we associate a metric space $Z_{r_v}$, and a map $f_{r_v}$ which maps chambers in $r_v$ to $Z_{r_v}$. If another $v$-residue $r'_v$ is parallel to $r_v$, then we associate $r'_v$ with the same space $Z_{r_v}$, and a map $f_{r'_v}$ which is induced by $f_{r_v}$ and the parallelism between $r_v$ and $r'_v$.\n\nLet $M_{r_v}$ be the mapping cylinder of $f_{r_v}$. $M_{r_v}$ is obtained by attaching edges to $Z_{r_v}$, and the endpoints of these edges which correspond to the domain of $f_{r_v}$ are called \\textit{tips} of $M_{r_v}$. There is a 1-1 correspondence between the tips of $M_{r_v}$ and chambers in $r_v$. Each edge in $M_{r_{v}}$ has length $=1$, and $M_{r_{v}}$ is endowed with the quotient metric (see \\cite[Chapter I.5.19]{bridson_haefliger}).\n\nIn summary, for each parallel class of $v$-residues, we have associated a space $M_{r_v}$, whose tips are in 1-1 correspondence with chambers in any chosen $v$-residue in this parallel class.  The spaces $Z_{r_v}$'s and the maps $f_{r_v}$'s is called the \\textit{blow-up data} on \nbuilding ${\\mathcal{B}}$. \n\n\n\n\\textit{Step 2:}\n\nLet ${\\mathsf{S}^r}$ be the poset of spherical residues in ${\\mathcal{B}}$. We define a functor $\\Phi$ from ${\\mathsf{S}^r}$ to the category of nonempty metric spaces and isometric embeddings as follows. \n\nLet $r_J=\\prod_{j\\in J}r_j$ be the product decomposition of a spherical $J$-residue into its rank 1 residues. Define $\\Phi(r_J)=\\prod_{j\\in J}M_{r_j}$, which is the Cartesian product of the metric spaces $M_{r_j}$'s.  \n\nSuppose $r_{J'}$ is a spherical $J'$-residue such that $r_{J'}\\subset r_J$. In this case $J'\\subset J$. Moreover, $r_{J'}$ can be expressed as a product $\\prod_{j\\notin J'} u_j \\times \\prod_{j\\in J'} r_j$, here $u_j\\in r_{j}$ is a chamber. By step 1, each $u_j$ corresponds to a tip $t_j\\in M_{r_{j}}$. Then we define the morphism $\\Phi(r_{J'})\\to\\Phi(r_{J})$ to be the isometric embedding $\\prod_{j\\notin J'} t_j \\times \\prod_{j\\in J'} M_{r_j}\\to \\prod_{j\\in J}M_{r_j}$.\n\n\\textit{Step 3:}\n\nWe begin with the disjoint union\n$\\bigsqcup_{r_{J}\\in{\\mathsf{S}^r}}\\Phi(r_{J})$, and for every inclusion\n$r_{J'}\\subset r_J$, we glue $\\Phi(r_{J'})$ with a subset of $\\Phi(r_J)$ by using the map $\\Phi(r_{J'})\\to\\Phi(r_{J})$ defined in step 2.\n\n\n\n\n\nWe denote the resulting space with the quotient metric (\\cite[Definition I.5.19]{bridson_haefliger}) by $\\Pi$. $\\Pi$ is called the \\textit{blow-up} of ${\\mathcal{B}}$ with respect to the blow-up data $Z_{r_{v}}$'s and $f_{r_{v}}$'s. \n\nThe following lemma gives an alternative description of our gluing process. \n\n\\begin{lem}\n\\label{gluing criterion}\nTwo points $x_1\\in \\Phi(r_{J_1})$ and $x_2\\in \\Phi(r_{J_2})$ are glued together if and only if $r_{J}=r_{J_1}\\cap r_{J_2}\\neq \\emptyset$ and there exists a point $x\\in \\Phi(r_J)$ such that for $i=1,2$, its image under $\\Phi(r_{J})\\to\\Phi(r_{J_i})$ is $x_i$.\n\\end{lem}\n\n\\begin{proof}\nThe if direction is clear. For the only if direction, define $x_1\\sim x_2$ if the condition in the lemma is satisfied, it suffices to show $\\sim$ is an equivalence relation. However, this follows from our construction.\n\\end{proof}\n\nWe can collapse each mapping cylinder in the construction to its range, namely $M_{r_{v}}\\to Z_{r_{v}}$. This induces a collapsing $\\Pi\\to \\bar{\\Pi}$. $\\bar{\\Pi}$ is called the \\textit{reduced blow-up} of ${\\mathcal{B}}$ with respect to $Z_{r_{v}}$'s and $f_{r_{v}}$'s. \n\n\\begin{remark}\nThere is some flexibility in this construction; for example, we can also collapse certain collections of mapping cylinders and keep other mapping cylinders to obtain a \\textquotedblleft semi-reduced\\textquotedblright\\ blow-up. Also instead of requiring $\\Phi(r_J)$ to be the Cartesian product of the metric spaces $M_{r_j}$'s, we can use $l^{p}$-product for $1\\le p\\le\\infty$. We will see an example later where it is more natural to use $l^{1}$-product.\n\\end{remark}\n\nLet ${\\mathcal{B}}_1\\subset{\\mathcal{B}}$ be a residue. We restrict the blow-up data on ${\\mathcal{B}}$ to ${\\mathcal{B}}_1$ and obtain a blow-up $\\Pi_1$ of ${\\mathcal{B}}_1$. There is a natural map $\\Pi_1\\to \\Pi$, which is injective by Lemma~\\ref{gluing criterion}. If ${\\mathcal{B}}_1$ is a spherical residue, then the image of $\\Pi_1\\to \\Pi$ is a product of mapping cylinders. It is called a \\textit{standard product}, and there is a 1-1 correspondence between spherical residues in ${\\mathcal{B}}$ and standard products in $\\Pi$.\n\n\\subsection{Properties}\n\n\\begin{proposition}\n\\label{Davis}\nIf each $Z_{r_{v}}$ in the above construction is a point, then the resulting blow-up $\\Pi$ is isometric to the Davis realization of ${\\mathcal{B}}$.\n\\end{proposition}\n\n\\begin{proof}\nLet $|{\\mathcal{B}}|$ be the Davis realization of ${\\mathcal{B}}$. Let $r_{J}\\subset{\\mathcal{B}}$ be a spherical residue and let $D(r_{J})$ be the subcomplex of $|{\\mathcal{B}}|$ spanned by those vertices corresponding to residues inside $r_{J}$. Note that $D(r_{J})$ is a convex subcomplex, and there is a naturally defined isomorphism $h_{r_J}:D(r_{J})\\to \\Phi(r_{J})$. One readily verifies the following:\n\\begin{enumerate}\n\\item The collection of all such $D(r_{J})$'s covers $|{\\mathcal{B}}|$.\n\\item There is a 1-1 correspondence between $D(r_{J})$'s and $\\Phi(r_{J})$'s in step 2 of Section~\\ref{construction}.\n\\item The gluing pattern of these $D(r_{J})$'s is compatible with step 3 of Section~\\ref{construction} via the maps $h_{r_J}$'s.\n\\end{enumerate}\nIt follows that $h_{r_J}$'s induce a cubical isomorphism $|{\\mathcal{B}}|\\to \\Pi$.\n\\end{proof}\n\n\\begin{remark}\nIf each $Z_{r_{v}}$ is a point, then the corresponding reduced blow-up is a point. However, later we will see cases where the reduced blow-up is more interesting than the blow-up.\n\\end{remark}\n\nIt follows that for any blow-up $\\Pi$ of ${\\mathcal{B}}$, there is a surjective projection map from $\\Pi$ to the Davis realization of ${\\mathcal{B}}$ which is induced by collapsing each $Z_{r_{v}}$ to a point. This is called the \\textit{canonical projection}. This map is a special case of the following situation.\n\nLet $\\Pi_1$ be the blow-up of ${\\mathcal{B}}_1$ with respect to $Z_{r_{v}}$'s and $f_{r_{v}}$'s, and let $\\Pi_2$ be the blow-up of ${\\mathcal{B}}_2$ with respect to $Y_{r_{v}}$'s and $g_{r_{v}}$'s. Let $\\bar{\\Pi}_{1}$ and $\\bar{\\Pi}_{2}$ be the corresponding reduced blow-ups. Suppose: \n\\begin{enumerate}\n\\item There exists a bijection $\\eta:{\\mathcal{B}}_1\\to{\\mathcal{B}}_2$ such that both $\\eta$ and $\\eta^{-1}$ preserve spherical residues.\n\\item For each $r_{v}$, there exists a map $h_{r_{v}}:Z_{r_{v}}\\to Y_{\\eta(r_{v})}$ such that the following diagram commutes:\n\\begin{center}\n$\\begin{CD}\nr_v               @>>\\eta>       \\eta(r_v) \\\\\n@VVf_{r_v}V                              @VVg_{\\eta(r_v)}V     \\\\\nZ_{r_{v}}       @>>h_{r_{v}}>      Y_{\\eta(r_{v})}\n\\end{CD}$\n\\end{center}\n\\end{enumerate}\nThen there are induced maps $h:\\Pi_1\\to \\Pi_2$ and $\\bar{h}:\\bar{\\Pi}_{1}\\to\\bar{\\Pi}_{2}$. Let $\\eta_\\ast:|{\\mathcal{B}}_1|\\to |{\\mathcal{B}}_2|$ be the map between Davis realizations induced by $\\eta$. Then $h$ fits into the following commuting diagram:\n\\begin{center}\n$\\begin{CD}\n\\Pi_1               @>>h>       \\Pi_2 \\\\\n@VVV                              @VVV     \\\\\n|{\\mathcal{B}}_1|       @>>\\eta_{\\ast}>      |{\\mathcal{B}}_2|\n\\end{CD}$\n\\end{center}\n\nLet ${\\mathcal{B}}'\\subset{\\mathcal{B}}$ be a residue. Let $\\textmd{proj}_{{\\mathcal{B}}'}:{\\mathcal{B}}\\to{\\mathcal{B}}'$ be the projection map defined in Section~\\ref{building}. Pick a spherical residue $r\\in{\\mathcal{B}}$. Suppose $r_0=\\textmd{proj}_{r}({\\mathcal{B}}')$ and ${\\mathcal{B}}'_0=\\textmd{proj}_{{\\mathcal{B}}'}(r)$. Let $r=r_0\\times r^{\\perp}_0$ be the product decomposition of $r$. It follows from \\cite[Lemma 5.36]{abramenko2008buildings} that the map $\\textmd{proj}_{{\\mathcal{B}}'}: r\\to {\\mathcal{B}}'_0$ is a composition of the factor projection $r\\to r_0$ and $\\textmd{proj}_{{\\mathcal{B}}'}:r_0\\to {\\mathcal{B}}'_0$. Recall that $r_0$ and ${\\mathcal{B}}'_0$ are parallel and the second map induces the parallelism map between $r_0$ and ${\\mathcal{B}}'_0$.  \n\nLet $\\Pi$ be a blow-up of ${\\mathcal{B}}$. We restrict the blow-up data on ${\\mathcal{B}}$ to ${\\mathcal{B}}'$, and let $\\Pi'$ be the resulting blow-up of ${\\mathcal{B}}'$. Since there is a 1-1 correspondence between spherical residues in ${\\mathcal{B}}$ or ${\\mathcal{B}}'$ with standard products in $\\Pi$ or $\\Pi'$, then above discussion implies that we can assign to each standard product of $\\Pi$ a standard product in $\\Pi'$, together with a map between them. This assignment is compatible with the gluing pattern of these standard products, thus induces a map $\\rho:\\Pi\\to \\Pi'$. This map $\\rho$ is a 1-Lipschitz retraction map, and is called a \\textit{residue retraction} map. The following is an consequence of the existence of such map. \n\n\\begin{cor}\n\\label{isometric embedding}\nThe inclusion $\\Pi'\\to \\Pi$ is an isometric embedding.\n\\end{cor}\n \n\\begin{theorem}\n\\label{blow-up CAT(0)}\nIf each $Z_{r_{v}}$ is $CAT(0)$, then the blow-up $\\Pi$ of a right-angled building ${\\mathcal{B}}$ with the quotient metric is also $CAT(0)$.\n\\end{theorem}\n\n\\begin{proof}\nWe start with the following observation. If ${\\mathcal R}\\subset {\\mathcal{B}}$ is a residue, then ${\\mathcal R}$ is also a building. We can restrict any blow-up data of ${\\mathcal{B}}$ to a blow-up data of ${\\mathcal R}$. Let $\\Pi_{B}$ and $\\Pi_{{\\mathcal R}}$ be the resulting blow-ups. And let $|{\\mathcal{B}}|$ and $|{\\mathcal R}|$ be the Davis realization of ${\\mathcal{B}}$ and ${\\mathcal R}$. Then the following diagram commutes:\n\\begin{center}\n$\\begin{CD}\n\\Pi_{{\\mathcal R}}              @>>i_{1}>       \\Pi_{B} \\\\\n@VVV                              @VVV     \\\\\n|{\\mathcal R}|       @>>i_{2}>      |{\\mathcal{B}}|\n\\end{CD}$\n\\end{center}\nThe two vertical maps are canonical projections, and $i_{1}$ and $i_2$ are isometric embeddings (Corollary~\\ref{isometric embedding}). Moreover, the image of $i_{1}$ is exactly the inverse image of $|{\\mathcal R}|$ under the canonical projection (here $|{\\mathcal R}|$ is viewed as a subspace of $|{\\mathcal{B}}|$).\n\nWe first show $\\Pi_B$ is locally $CAT(0)$. Define the \\textit{rank} of ${\\mathcal{B}}$ to be the maximum possible number of vertices in a clique of ${\\Gamma}$. We induct on the rank of ${\\mathcal{B}}$. The rank 1 case is clear. Now assume ${\\mathcal{B}}$ is of rank $n$, and all blow-ups of buildings of rank $\\le n-1$ are locally $CAT(0)$.\n\nPick vertex $x\\in |{\\mathcal{B}}|$ and suppose $x$ corresponds to a $J$-residue $r\\subset {\\mathcal{B}}$. Let $\\pi:\\Pi_B\\to |{\\mathcal{B}}|$ be the canonical projection and let ${\\textrm{st}}(x)$ be the open star of $x$ in $|{\\mathcal{B}}|$. It suffices to show $\\pi^{-1}({\\textrm{st}}(x))$ is locally $CAT(0)$.\n\n\\textit{Case 1:} $J\\neq\\emptyset$. Let $J^{\\perp}$ be the vertices in ${\\Gamma}$ which are adjacent to every vertex in $J$. Let ${\\mathcal R}$ be the $J\\cup J^{\\perp}$-residue that contains $r$. We restrict the blow-up data on ${\\mathcal{B}}$ to ${\\mathcal R}$, and let $\\Pi_{{\\mathcal R}}$ be resulting metric space. Let ${\\mathcal R}={\\mathcal R}_{1}\\times{\\mathcal R}_{2}$ be the product decomposition (see Section~\\ref{building}) induced by $J\\cup J^{\\perp}$. Then we also have $|{\\mathcal R}|=|{\\mathcal R}_{1}|\\times |{\\mathcal R}_{2}|$ and $\\Pi_{{\\mathcal R}}=\\Pi_{{\\mathcal R}_1}\\times \\Pi_{{\\mathcal R}_i}$ where $\\Pi_{{\\mathcal R}_i}$ is some blow-up of ${\\mathcal R}_{i}$ for $i=1,2$. By the induction assumption, $\\Pi_{{\\mathcal R}_2}$ is locally $CAT(0)$. Moreover, ${\\mathcal R}_{1}$ can be further decomposed into a product of buildings of rank 1, thus $\\Pi_{{\\mathcal R}_1}$ is locally $CAT(0)$. It follows that $\\Pi_{R}$ is locally $CAT(0)$. Since ${\\operatorname{St}}(x)\\subset |{\\mathcal R}|$, $\\pi^{-1}({\\textrm{st}}(x))\\subset \\Pi_{R}$. Since  $\\Pi_{R} \\to \\Pi_B$ is a local isometry, it follows that $\\pi^{-1}({\\textrm{st}}(x))$ is locally $CAT(0)$.\n\n\\textit{Case 2:} $J=\\emptyset$. In this case, $\\pi$ induces a simplicial isomorphism between $\\pi^{-1}({\\operatorname{St}}(x))$ and ${\\operatorname{St}}(x)$. It follows from the $CAT(0)$ property of $|{\\mathcal{B}}|$ and \\cite[Lemma I.5.27]{bridson_haefliger} that $\\pi^{-1}({\\textrm{st}}(x))$ is locally $CAT(0)$.\n\nIt remains to prove $\\Pi_B$ is simply connected. Actually we show the canonical projection $\\pi:\\Pi_B\\to|{\\mathcal{B}}|$ is a homotopy equivalence. We construct a homotopy inverse $\\phi:|{\\mathcal{B}}|\\to \\Pi_B$ as follows. \n\nRecall that $|{\\mathcal{B}}|$ be also be viewed as a blow-up of ${\\mathcal{B}}$ where the associated metric spaces $Z'_{r_v}$'s are single points. Let $M'_{r_v}$ be the mapping cylinder of the constant map $r_v\\to Z'_{r_v}$. There is a natural map $h_{r_v}:M_{r_v}\\to M'_{r_v}$ induced by collapsing each $Z_{r_v}$ to $Z'_{r_v}$. \n\nFor each $r_v$, we choose a map $h'_{r_v}:Z'_{r_v}\\to Z_{r_v}$ such that if $r_v$ and $r_u$ are parallel residues of rank 1, then $h'_{r_v}$ and $h'_{r_u}$ have the same image. We extend $h'_{r_v}$ to a map $M'_{r_v}\\to M_{r_v}$ as follows. Pick a chamber $c\\in r_v$, and let $e_c$ and $e'_c$ be the edges in $M_{r_v}$ and $M'_{r_v}$ corresponding to the chamber $c$ respectively. We identify these two edges with $[0,1]$ such that the $0$-endpoints are the tips. We map the $[1/2,1]$ half of $e'_{c}$ to the constant speed geodesic joining the midpoint of $e_c$ and the image of $h'_{r_v}$ in $Z_{r_v}$ (such geodesic is unique since $M_{r_v}$ is $CAT(0)$), and map the $[0,1/2]$ half of $e'_c$ identically to the $[0,1/2]$ half of $e_c$.\n\nOne readily verify that one can take suitable products of the maps $h'_{r_v}:M'_{r_v}\\to M_{r_v}$ and glue them together to obtain a map $\\phi:|{\\mathcal{B}}|\\to \\Pi_B$. Moreover, for each $r_v$, there is a geodesic homotopy between $h'_{r_v}\\circ h_{r_v}$ to identity, and these homotopies induces a homotopy between $\\phi\\circ\\pi$ and identity. Similarly we can produce a homotopy between $\\pi\\circ\\phi$ and identity.\n\\end{proof}\n\n\\subsection{An equivariant construction}\nThe construction in this section is similar to Section~\\ref{subsection_an equivariant constuction}.\n\\begin{definition}\nLet ${\\mathcal{B}}$ be a right-angled building. A bijection $f:{\\mathcal{B}}\\to{\\mathcal{B}}$ is \\textit{flat-preserving} if both $f$ and $f^{-1}$ map spherical residues to spherical residues.\n\\end{definition}\nThis definition is motivated by Definition~\\ref{def_flat_preserving}.\n\nSuppose $H$ acts on ${\\mathcal{B}}$ by flat-preserving bijections.  Let $\\Lambda$ be the collection of all parallel classes of rank 1 residues, then there is an induced action $H{\\curvearrowright}\\Lambda$. We pick a representative from each orbit of this action and denote the resulting set by $\\{\\lambda_{u}\\}_{u\\in U}$. \n\nLet $H_u$ be the stabilizer of $\\lambda_u$. Pick rank 1 residue $r_u$ in the parallel class $\\Lambda_u$ and let $\\rho_u:H_u{\\curvearrowright} r_u$ be the induced factor action (see Section~\\ref{subsection_an equivariant constuction}). We pick a metric space $Z_{r_u}$, an isometric action $H_u{\\curvearrowright} Z_{r_u}$ and a $H_u$-equivariant map $f_{r_u}:r_u\\to Z_{r_u}$. And we deal with residues which are parallel to $r_u$ as in step 1 of Section~\\ref{construction}.\n\nWe repeat this process for each element in $\\{\\lambda_u\\}_{u\\in U}$. If $\\lambda\\notin \\{\\lambda_u\\}_{u\\in U}$, then we fix an element $g_{\\lambda}\\in H$ such that $g_{\\lambda}(\\lambda)\\in \\{\\lambda_u\\}_{u\\in U}$. For each rank 1 residue $r_v$ in the parallel class $\\lambda$, we associate the metric space $Z_{g_{\\lambda}(r_v)}$ and the map $f_{r_v}=f_{g_{\\lambda}(r_v)}\\circ g_{\\lambda}$, and we deal with residues which are parallel to $r_v$ as before.\n\nLet $\\Pi$ be the blow-up of ${\\mathcal{B}}$ with respect to the above choice of spaces and maps and let $\\bar{{\\mathcal{B}}}$ be the corresponding reduced blow-up.  Then there are induced actions $H{\\curvearrowright} \\Pi$ and $H{\\curvearrowright}\\bar{\\Pi}$ by isometries. Moreover, the canonical projection $\\Pi\\to |{\\mathcal{B}}|$ is $H$-equivariant.\n\nNext we apply this construction to graph products of groups. Pick a finite simplicial graph ${\\Gamma}$ with its vertex set denoted by $I$, and pick a collection of groups $\\{H_i\\}_{i\\in I}$, one for each vertex of ${\\Gamma}$. Let $H$ be the graph product of the $H_i$'s with respect to ${\\Gamma}$ and let ${\\mathcal{B}}={\\mathcal{B}}({\\Gamma})$ be the right-angled building associated with this graph product (see \\cite[Section 5]{davis_buildings_are_cat0}). We can identify $H$ with the set of chambers in ${\\mathcal{B}}$. Under this identification, the rank 1 residues in ${\\mathcal{B}}$ correspond to left cosets of $H_i$'s and spherical residues in ${\\mathcal{B}}$ correspond to left cosets of $\\prod_{j\\in J} H_j$'s where $J$ is the vertex set of some clique in ${\\Gamma}$. \n\nIn the following discussion, we will slightly abuse notation. When we say a residue in $H$, we actually mean the corresponding object in ${\\mathcal{B}}$ under the above identification.\n\nLet $\\Lambda_H$ be the collection of all parallel classes of rank 1 residues in $H$, and let $\\lambda_i\\in\\Lambda_H$ be the parallel class represented by $H_i$. Then there is a 1-1 correspondence between $\\lambda_i$'s and $H$-orbits of the induced action $H{\\curvearrowright} \\Lambda_H$. Thus we take $\\{\\lambda_{u}\\}_{u\\in U}$ in the above construction to be $\\{\\lambda_i\\}_{i\\in I}$. For each $H_i$, pick a metric space $Z_i$, an isometric action $H_i{\\curvearrowright} Z_i$, and a $H_i$-equivariant map $f_i:H_i\\to Z_i$. Given such data, we can produce a blow-up $\\Pi_{H}$ of the building ${\\mathcal{B}}$.\n\n\\begin{thm}\n\\label{geometric action}\nLet $H$ be the graph product of $\\{H_i\\}_{i\\in I}$ with respect to a finite simplicial graph ${\\Gamma}$.  Suppose one of the following properties  is satisfied by all of $H_i$'s:\n\\begin{enumerate}\n\\item It acts geometrically on a $CAT(0)$ space;\n\\item It acts properly on a $CAT(0)$ space;\n\\item It acts geometrically on a $CAT(0)$ cube complex;\n\\item It acts properly on a $CAT(0)$ cube complex.\n\\end{enumerate}\nThen $H$ also has the same property.\n\\end{thm}\n\n\\begin{proof}\nWe prove (1). The other assertions are similar. Suppose each $H_i$ acts geometrically on a $CAT(0)$ space $Z_i$. By Theorem~\\ref{blow-up CAT(0)}, it suffices to show the action $H{\\curvearrowright} \\Pi_H$ is geometric.\n\nWe first show that $H{\\curvearrowright} \\Pi_H$ is cocompact. Note that $\\Pi_H$ is locally compact, since each mapping cylinder in the construction of $\\Pi_H$ is locally compact. We deduce that $\\Pi_H$ is proper since $\\Pi_H$ is $CAT(0)$. Thus it suffices to show $H{\\curvearrowright} \\Pi_H$ is cobounded. Let $|H|$ be the Davis realization of ${\\mathcal{B}}$ and let $\\pi:\\Pi_H\\to |H|$ be the $H$-equivariant canonical projection. Let $V_0\\subset |H|$ be the collection of rank 0 vertices in $|H|$. Note that $\\pi^{-1}(v)$ is exactly one point for any $v\\in V_0$. The $H$-action on $V_0$, hence on $\\pi^{-1}(V_0)$ is transitive. Since each action $H_i{\\curvearrowright} Z_i$ is cobounded, the set of tips in the mapping cylinder of $f_i:H_{i}\\to Z_i$ is cobounded. Thus $\\pi^{-1}(V_0)$ is cobounded in $\\Pi_H$ since it arises from tips of mapping cylinders in the construction of $\\Pi_H$. It follows that $H{\\curvearrowright} \\Pi_H$ is cobounded, hence cocompact.\n\nNow we prove $H{\\curvearrowright} \\Pi_H$ is proper. It suffices to show the intersection of $\\pi^{-1}(V_0)$ with any bounded metric ball in $\\Pi_H$ is finite. For each $\\lambda\\in\\Lambda_H$, pick a residue $r_v$ in the parallel class $\\lambda$. Let $\\xi_{\\lambda}:\\Pi_H\\to M_{r_v}$ be the residue projection. Note that $\\xi_{\\lambda}$ does not depend on the choice of $r_v$ in the parallel class. We claim there exists constant $L>0$ such that \n\n", "index": 23, "text": "$$\nL^{-1}d(x,y)\\le \\Sigma_{\\lambda\\in \\Lambda_H} d(\\xi_\\lambda(x),\\xi_\\lambda(y))\\le Ld(x,y)\n$$\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex9.m1\" class=\"ltx_Math\" alttext=\"L^{-1}d(x,y)\\leq\\Sigma_{\\lambda\\in\\Lambda_{H}}d(\\xi_{\\lambda}(x),\\xi_{\\lambda}%&#10;(y))\\leq Ld(x,y)\" display=\"block\"><mrow><mrow><msup><mi>L</mi><mrow><mo>-</mo><mn>1</mn></mrow></msup><mo>\u2062</mo><mi>d</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2264</mo><mrow><msub><mi mathvariant=\"normal\">\u03a3</mi><mrow><mi>\u03bb</mi><mo>\u2208</mo><msub><mi mathvariant=\"normal\">\u039b</mi><mi>H</mi></msub></mrow></msub><mo>\u2062</mo><mi>d</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mrow><msub><mi>\u03be</mi><mi>\u03bb</mi></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>,</mo><mrow><msub><mi>\u03be</mi><mi>\u03bb</mi></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>y</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2264</mo><mrow><mi>L</mi><mo>\u2062</mo><mi>d</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy=\"false\">)</mo></mrow></mrow></mrow></math>", "type": "latex"}, {"file": "1601.00946.tex", "nexttext": "\n\nPick a $0$-cube $\\sigma$ of $(G(\\Gamma),\\mathcal{W}_{\\Delta})$.  We claim one can obtain a $0$-cube of $(G(\\Gamma),\\mathcal{W})$ by adding the orientations of walls in $\\mathcal{W}\\setminus\\mathcal{W}_{\\Delta}$ defined as above. Condition $(1)$ of Definition \\ref{0-cube} follows from (\\ref{contain}). To see $(2)$, suppose $W\\in \\mathcal{W}\\setminus\\mathcal{W}_{\\Delta}$ such that $z\\notin\\sigma(W)$;  then $W$ separates $z$ from $v(F)$ by (\\ref{contain}) and there are only finitely many such $W$ by Lemma \\ref{wallspace}. Now we have a map from $0$-cubes of $(G(\\Gamma),\\mathcal{W}_{\\Delta})$ to $0$-cubes of $(G(\\Gamma),\\mathcal{W})$, which  extends to higher dimensional cells. \n\nThis embedding is isometric since two walls are transverse in the wallspace $(G(\\Gamma),\\mathcal{W}_{\\Delta})$ if and only if they are transverse in $(G(\\Gamma),\\mathcal{W})$.\n\\end{proof}\n\nThe image of $C(G(\\Gamma),\\mathcal{W}_{\\Delta})$ under the above embedding is called a \\textit{maximal standard branched flat}. The following properties are immediate:\n\\begin{enumerate}\n\\item Each maximal standard branched flat is a convex subcomplex of $C$, since embedding in Lemma \\ref{embedding} is isometric.\n\\item Each maximal standard branched flat splits as a product of branched lines $C(G(\\Gamma),\\mathcal{W}_{\\Delta})\\cong\\Pi_{v\\in\\Delta} C(G(\\Gamma),\\mathcal{W}_{v})$ by Lemma \\ref{transverse}.\n\\end{enumerate}\n\n\\begin{lem}\n\\label{branched flat covers}\nEvery maximal cube of $C$ is contained in a maximal standard branched flat, and hence every point of $C$ is contained in a maximal standard branched flat.\n\\end{lem} \n\n\\begin{proof}\nBy Lemma \\ref{maximal cube}, every maximal cube is determined by a maximal collection of pairwise transverse walls. By Lemma \\ref{transverse}, these walls correspond to a maximal simplex in $\\Delta\\subset\\mathcal{P}(\\Gamma)$.  Thus the lemma follows from Lemma \\ref{embedding} since the image of the embedding $C(G(\\Gamma),\\mathcal{W}_{\\Delta})\\to C$ contains a maximal cube whose dual hyperplanes are the required collection.\n\\end{proof}\n\nThere is a bijective map $\\Phi$: $\\{$maximal standard flats in $X(\\Gamma)\\}$ $\\to$ $\\{$maximal standard branched flats in $C\\}$, since both sides of $\\Phi$ are in 1-1 correspondence with maximal simplexes of $\\mathcal{P}(\\Gamma)$.\n\n\\subsection{An equivariant quasi-isometry}\nEvery point $x\\in G(\\Gamma)$ gives rise to a $0$-cube of $(X,\\mathcal{W})$ by considering the halfspaces containing $x$. This induces an $H$-equivariant map $\\phi:G(\\Gamma)\\to C$. Let $F\\subset X(\\Gamma)$ be a maximal standard flat, so $\\phi(v(F))\\subset \\Phi(F)$ by $(\\ref{contain})$. Actually $\\phi(v(F))$ is exactly the collection of tips of $\\Phi(F)$. To see this, note that $\\phi|_{v(F)}$ can be written as a composition: $v(F)\\to C(G(\\Gamma),\\mathcal{W}_{\\Delta{F}})\\to C(G(\\Gamma,\\mathcal{W}))$. Thus there is a natural splitting $\\phi|_{v(F)}=\\Pi_{i=1}^{n}\\xi_{v_{i}}$, here $\\{v_{i}\\}_{i=1}^{n}$ are the vertices of $\\Delta(F)$ and $\\xi_{v_{i}}:\\Bbb Z\\to C(G(\\Gamma),\\mathcal{W}_{v_{i}})$ is the map in Lemma \\ref{wallspace property}.\n\n\\begin{lem}\n\\label{surjective}\nThe map $\\phi$ is coarsely surjective.\n\\end{lem}\n\n\\begin{proof}\nBy Lemma \\ref{branched flat covers}, it suffices show there exists a constant $D$ which does not depend on the maximal flat $F$ such that $\\phi(v(F))$ is $D$-dense in $\\Phi(F)$. This follows from Lemma \\ref{wallspace property}.\n\\end{proof}\n\n\\begin{prop}\n\\label{quasi-isometry}\nThe map $\\phi:G(\\Gamma)\\to C$ is an $H$-equivariant injective quasi-isometry.\n\\end{prop}\n\n\\begin{proof}\nWe prove $\\phi$ is a bi-Lipschitz embedding, then the proposition follows from Lemma \\ref{surjective}. Pick $x,y\\in G(\\Gamma)$ and pick vertex $v\\in\\mathcal{P}(\\Gamma)$. Suppose $l$ is a standard geodesic with $\\Delta(l)=v$. Let $d_{v}(x,y)$ be the number of \\textit{$v$-hyperplanes} in $X(\\Gamma)$ which separate $x$ from $y$ ($h$ is a \\textit{$v$-hyperplane} if and only if $l\\cap h$ is one point), and let $d_{v}(\\phi(x),\\phi(y))$ be the number of walls in $\\mathcal{W}_{v}$ that separate $x$ from $y$. It suffices to show there exists $L>0$ which does not depend on $x,y$ and $v$ such that\n\n", "itemtype": "equation", "pos": 238402, "prevtext": "\nfor any $x,y\\in \\pi^{-1}(V_0)$. \n\nTo see the second inequality, pick a geodesic line $\\ell\\in \\Pi_H$ connecting $x$ and $y$. Since each standard product in $\\Pi_H$ is convex (Corollary~\\ref{isometric embedding}), the intersection of $\\ell$ with each standard product is a (possibly empty) segment. Thus we can assume $\\ell$ is an concatenation of geodesic segments $\\{\\ell_i\\}_{i=1}^{k}$ such that each $\\ell_i$ is contained in a standard product $P_i$. Recall that each $P_i$ is a product of mapping cylinders. For each $i$, we construct another piecewise geodesic $\\bar{\\ell}_{i}$ such that:\n\\begin{enumerate}\n\\item $\\bar{\\ell}_i$ and $\\ell_i$ have the same endpoints.\n\\item $\\bar{\\ell}_i$ is a concatenation of geodesic segments $\\{\\bar{\\ell}_{ij}\\}_{j=1}^{k_i}$ such that the projection of $\\bar{\\ell}_{ij}$ to all but one of the product factors of $P_i$ are trivial.\n\\item There exists $D$ which is independent of $x,y$ and $\\ell_i$ such that length$(\\bar{\\ell}_i)\\le D$ length$(\\ell_i)$.\n\\end{enumerate}\nIt follows from the construction of residue projection that for each $\\lambda$, $\\xi_{\\lambda}(\\bar{\\ell}_{ij})$ is either a point, or a segment which has the same length as $\\bar{\\ell}_{ij}$, and there is exactly one $\\lambda$ such that $\\xi_{\\lambda}(\\bar{\\ell}_{ij})$ is non-trivial. Thus the second inequality follows.\n\nTo see the first inequality, let $c_x$ and $c_y$ be chambers in ${\\mathcal{B}}$ that correspond to $x$ and $y$ respectively. Let ${\\mathcal G}\\subset {\\mathcal{B}}$ be a shortest gallery connecting $c_x$ and $c_y$. Every two adjacent elements in the gallery are contained in a rank 1 residue, and different pairs of adjacent elements give rise to rank 1 residues in different parallel class (otherwise we can shorten the gallery). Note that ${\\mathcal G}$ corresponds to a chain of points in $\\pi^{-1}(V_0)$. Connecting adjacent points in this chain by geodesics induces a piecewise geodesic $\\ell\\subset \\Pi_H$ connecting $x$ and $y$, moreover, the length of $\\ell$ is equal to $\\Sigma_{\\lambda\\in \\Lambda_H} d(\\xi_\\lambda(x),\\xi_\\lambda(y))$, thus the first inequality holds.\n\nGiven $x\\in \\pi^{-1}(V_0)$, any other point $y\\in \\pi^{-1}(V_0)$ in the $R$-ball can be connected to $x$ via a chain of points in $\\pi^{-1}(V_0)$ which is induced by a shortest gallery as above. The above claim implies that the size of the chain is bounded above in terms of $R$. Two adjacent points have distance in $\\Pi_H$ bounded above in terms of $R$, and they correspond to chambers in the same rank 1 residue. There are only finite many such chains since our assumption implies there are only finitely many choices for each successive point of such a chain. Thus the intersection of $\\pi^{-1}(V_0)$ with any bounded metric ball in $\\Pi_H$ is finite.\n\\end{proof}\n\n\\begin{remark}\nSuppose we use $l^1$-product instead of Cartesian product in step 2 of Section~\\ref{construction}. Let $d_{l^1}$ be the resulting metric on $\\Pi_H$. Then $d_{l^1}(x,y)=\\Sigma_{\\lambda\\in \\Lambda_H} d(\\xi_\\lambda(x),\\xi_\\lambda(y))$ for any $x,y\\in \\pi^{-1}(V_0)$. \n\\end{remark}\n\nThe construction in this section unifies several other constructions as follows:\n\\begin{enumerate}\n\\item The Davis realization of right-angled building (Proposition \\ref{Davis}).\n\\item If ${\\mathcal{B}}$ is the right-angled building associated with a graph product of ${\\mathbb Z}$'s, each space is ${\\mathbb R}$ and each map is a bijection between chambers and integer points in ${\\mathbb R}$, then the blow-up of ${\\mathcal{B}}$ is the universal covering of the exploded Salvetti complex with the correct group action. \n\\item The corresponding reduced blow-up in (2) is the universal covering of Salvetti complex.\n\\item Let ${\\mathcal{B}}$ be as in (2). If each space is ${\\mathbb R}$, and each map arises from Proposition~\\ref{key lemma}, then the blow-up of ${\\mathcal{B}}$ is the geometric model we construct for group quasi-isometric to RAAG's in Section~\\ref{section_quasi-action on RAAGs}.\n\\item Suppose $H$ is a graph product of a collection of groups $\\{H_{i}\\}_{i\\in I}$ and ${\\mathcal{B}}$ is the associated building. Suppose each $H_{i}$ acts on a $CAT(0)$ cube complex $Z_{i}$ with a free orbit. And we pick a $H_i$-equivariant map from $H_i$ to the free orbit. Then the action of the $H$ on the associated reduced blow-up of ${\\mathcal{B}}$ is equivariantly isomorphic to the graph product of group actions defined on \\cite[Section 4.2]{haglund2008finite}\n\\end{enumerate}\n\n\n\\section*{Part III: A wallspace approach to cubulating RAAG's}\nIn the remainder of the paper, we use wallspaces to give a different approach to cubulating quasi-actions on RAAG's.  This gives a shorter path to the cubulation,\nbut gives less precise information about its structure.\n\n\n\nWe assume $G(\\Gamma)\\neq{\\mathbb Z}$ in Section \\ref{sec_construction of wallspace} and Section \\ref{sec_property of wallspace}.\n\n\\section{Construction of the wallspace}\n\\label{sec_construction of wallspace}\n\n\\subsection{Background on wallspaces}\n\\label{subsec_wallspaces}\nWe will be following \\cite{hruska2014finiteness} in this section.\n\n\\begin{definition}(Wallspaces)\nLet $Z$ be a nonempty set. A \\textit{wall} of Z is a partition of $Z$ into two subsets $\\{U,V\\}$, each of which is called a \\textit{halfspace}. Two points $x,y\\in Z$ are \\textit{separated} by a wall if $x$ and $y$ are in different halfspaces. $(Z,\\mathcal{W})$ is a \\textit{wallspace} if $Z$ is endowed with a collection of walls $\\mathcal{W}$ such that every two distinct points $x,y\\in Z$ are separated by finitely many walls. Here we allow the situation that two points are not separated by any wall.\n\\end{definition}\n\n\nTwo distinct walls $W=\\{U_{1},U_{2}\\}$ and $W'=\\{V_{1},V_{2}\\}$ are \\textit{transverse} if $U_{i}\\cap V_{j}\\neq\\emptyset$ for all $1\\le i,j\\le 2$. \n\nAn \\textit{orientation} of a wall is a choice of one of its halfspaces. An orientation $\\sigma$ of the wallspace $(Z,\\mathcal{W})$ is a choice of orientation $\\sigma(W)$ for each $W\\in\\mathcal{W}$. \n\n\\begin{definition}\n\\label{0-cube}\nA \\textit{0-cube} of $(Z,\\mathcal{W})$ is an orientation $\\sigma$ such that\n\\begin{enumerate}\n\\item $\\sigma(W)\\cap \\sigma(W')\\neq\\emptyset$ for all $W,W'\\in\\mathcal{W}$.\n\\item For each $x\\in Z$, we have $x\\in\\sigma(W)$ for all but finitely many $W\\in\\mathcal{W}$.\n\\end{enumerate}\n\\end{definition}\n\nEach ${\\operatorname{CAT}}(0)$ cube complex $C$ gives rise to a wallspace $(Z,\\mathcal{W})$ where $Z$ is the vertex set of $C$ and the walls are induced by hyperplanes of $C$. Conversely, each wallspace $(Z,\\mathcal{W})$ naturally give rises to a dual ${\\operatorname{CAT}}(0)$ cube complex $C(Z,\\mathcal{W})$. The vertices of $C(Z,\\mathcal{W})$ are in 1-1 correspondence with $0$-cubes of $(Z,\\mathcal{W})$. Two $0$-cubes are joined by an edge if and only if their orientations are different on exactly one wall. \n\n\\begin{lem}\n\\label{dimension}\n$($\\cite[Corollary 3.13]{hruska2014finiteness}$)$ $C(Z,\\mathcal{W})$ is finite dimensional if and only if there is a finite upper bound on the size of collections of pairwise transverse walls. In this case, $\\dim(C(Z,\\mathcal{W}))$ is equal to the largest possible number of pairwise transverse walls.\n\\end{lem}\n\nThere is a 1-1 correspondence between walls in $(Z,\\mathcal{W})$ and hyperplanes in $C(Z,\\mathcal{W})$. We can define a map which associates each finite dimensional cube in $C(Z,\\mathcal{W})$ a collection of pairwise transverse walls in $(Z,\\mathcal{W})$ by considering the hyperplanes which have non-trivial intersection with the cube.  \n \n\\begin{lem}\n\\label{maximal cube}\n$($\\cite[Proposistion 3.14]{hruska2014finiteness}$)$ The above map induces a 1-1 correspondence between finite dimensional maximal cubes in $C(Z,\\mathcal{W})$ and finite maximal collections of pairwise transverse walls in $(Z,\\mathcal{W})$. \n\\end{lem}\n\nTwo $0$-cubes $\\sigma_{x}$ and $\\sigma_{y}$ of $(Z,\\mathcal{W})$ are \\textit{separated} by a wall $W\\in\\mathcal{W}$ if and only if $\\sigma_{x}(W)$ and $\\sigma_{y}(W)$ are different halfspaces of $W$. In this case, the hyperplane in $C(Z,\\mathcal{W})$ corresponding to $W$ separates the vertices associated with $\\sigma_{x}$ and $\\sigma_{y}$.\n\n\\subsection{Preservation of levels}\n\\label{subsec_flat-preserving}\nIn the rest of this section, we assume ${\\operatorname{Out}}(G(\\Gamma))$ is finite and $\\rho:H{\\curvearrowright} G(\\Gamma)$ is an $(L,A)$-quasi-action. We refer to Definition \\ref{def_flat_preserving} for flat preserving bijections.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nBy Theorem \\ref{thm_intro_vertex_rigidity}, we can assume $\\rho$ is an action by flat-preserving bijections which are also $(L,A)$-quasi-isometries.\n\nLet ${\\mathcal P}({\\Gamma})$ be the extension complex, and for every standard flat $F\\subset X({\\Gamma})$, let ${\\Delta}(F)\\in{\\mathcal P}({\\Gamma})$ be the parallel class;  see Section~\\ref{subsec_raag}. Note that every flat preserving bijection $h:G({\\Gamma})\\to G({\\Gamma})$ induces a simplicial isomorphism $\\partial h:{\\mathcal P}({\\Gamma})\\to{\\mathcal P}({\\Gamma})$. Thus $\\rho$ induces an action $H{\\curvearrowright} {\\mathcal P}({\\Gamma})$ by simplicial isomorphisms.\n\\label{subsec_level}\n\\begin{definition}[Levels]\nPick a vertex $v\\in\\mathcal{P}(\\Gamma)$ and let $l\\subset X(\\Gamma)$ be a standard geodesics such that $\\Delta(l)=v$. For every vertex $x\\in l$, a \\textit{$v$-level} (\\textit{of height $x$}) is defined to be $\\{z\\in G(\\Gamma)\\mid \\pi_{l}(z)=x\\}$, here $\\pi_{l}$ is the ${\\operatorname{CAT}}(0)$ projection onto $l_{v}$. Note that $\\pi^{-1}_{l}(x)$ is a convex subcomplex of $X(\\Gamma)$ and the $v$-level of height $x$ is exactly the vertex set of this convex subcomplex. The definition of $v$-level does not depend on the choice of the standard geodesic $l$ in the parallel class.\n\\end{definition}\n\n\\begin{lem}\n\\label{level}\nLet $h: G(\\Gamma)\\to G(\\Gamma)$ be a flat-preserving projection. Then for any $v\\in\\mathcal{P}(\\Gamma)$, $h$ sends  $v$-levels to  $\\partial h(v)$-levels.\n\\end{lem}\n\n\\begin{proof}\nPick standard geodesic $l$ such that $\\Delta(l)=v$ and pick vertex $x\\in l$. Suppose $l'$ is the standard geodesic such that $\\alpha(v(l))=v(l')$. Let $y\\in G(\\Gamma)$ be such that $\\pi_{l}(y)=x$. It suffices to show $\\pi_{l'}(h(y))=h(x)$.\n\nLet $\\omega$ be a combinatorial geodesic joining $y$ and $x$ and let $\\{x_{i}\\}_{i=0}^{n}$ be vertices in $\\omega$ such that (1) $x_{0}=y$ and $x_{n}=x$; (2) for $1\\le i\\le n$, there exists a standard geodesic  $l_{i}$ such that $x_{i}\\in l_{i}$ and $x_{i-1}\\in l_{i}$. Note that $\\omega\\subset \\pi^{-1}_{l}(x)$ since $\\pi^{-1}_{l}(x)$ is a convex subcomplex. Thus $l_{i}\\subset \\pi^{-1}_{l}(x)$ for all $i$, hence $\\Delta(l_{i})\\neq v$ for all $i$. Suppose $x'_{i}=h(x_{i})$ and let $l'_{i}$ be the standard geodesic which contains $x'_{i}$ and $x'_{i-1}$. Then $\\partial h(\\Delta(l_{i}))=\\Delta(l'_{i})$, thus $\\Delta(l'_{i})\\neq\\Delta(l')$. It follows that $\\pi_{l'}(l'_{i})$ is a point, and hence $\\pi_{l'}(x'_{i})=\\pi_{l'}(x'_{i-1})$ for all $i$.\n\\end{proof}\n\n\\begin{lem}\n\\label{in one level}\nLet $K\\subset X(\\Gamma)$ be a standard subcomplex and define $\\Delta(K)$ to be the union of all $\\Delta(F)$ with $F$ ranging over all standard flats in $K$. Pick vertex $v\\in\\mathcal{P}(\\Gamma)$. If $v\\notin \\Delta(K)$, then $K^{(0)}$ is contained in a $v$-level.\n\\end{lem}\n\n\\begin{proof}\nLet $l\\in X(\\Gamma)$ be a standard geodesic such that $\\Delta(l)=v$. It suffices to prove for each edge $e\\in K$, $\\pi_{l}(e)$ is a point. Suppose the contrary is true. Then $\\pi_{l}(e)$ is an edge of $l$ by Lemma \\ref{project onto line}, and hence the standard geodesic  $l_{e}$ that contains $e$ is parallel to $l$. However, $l_{e}\\subset K$ since $K$ is standard, which implies $v\\in\\Delta(K)$.\n\\end{proof}\n\n\n\\subsection{A key observation}\n\\label{subsec_key}\nThe flat-preserving action $H\\curvearrowright G(\\Gamma)$ induces an action $H\\curvearrowright \\mathcal{P}(\\Gamma)$. For each vertex $v\\in\\mathcal{P}(\\Gamma)$, let $H_{v}\\subset H$ be the subgroup which stabilizes $v$. In other words, if $l$ is a standard geodesic such that $\\Delta(l)=v$, then $H_{v}$ is the stabilizer of the parallel set of $l$. \n\nBy Lemma \\ref{level}, $H_{v}$ permutes $v$-levels. Recall that the ${\\operatorname{CAT}}(0)$ projection $\\pi_{l}$ induces a 1-1 correspondence between $v$-levels and vertices of $l$; moreover, for any two $v$-levels $L_{1}$ and $L_{2}$, $d(L_{1},L_{2})=d(\\pi_{l}(L_{1}),\\pi_{l}(L_{2}))$ ($d$ is the word metric). Thus the collections of $v$-levels can be identified with $\\Bbb Z$ (endowed with the standard metric), and we have an induced action $\\rho_{v}:H_{v}\\curvearrowright \\Bbb Z$ by $(L',A')$-quasi-isometries; here $L',A'$ can be chosen to be independent of $v$. \n\nWe recall the following result which is proved in Section~\\ref{sec_quasi action on Z}.\n\\begin{proposition}\n\\label{key lemma1}\nIf a group $G$ has an action on $\\Bbb Z$ by $(L,A)$-quasi-isometries, then there exists another action $G\\curvearrowright\\Bbb Z$ by isometries which is related to the original action by a surjective equivariant $(L',A')$-quasi-isometry $f: \\Bbb Z\\to \\Bbb Z$ with $L',A'$ depending on $L$ and $A$.\n\\end{proposition}\n\n\\begin{definition}[Branched lines and flats]\nA \\textit{branched line} is constructed from a copy of $\\Bbb R$ by attaching finitely many edges of length 1 to each integer point. We also require the valence of each vertex in a branched line is bounded above by a uniform constant. This space has a natural simplicial structure and is endowed with the path metric. A \\textit{branched flat} is a product of finitely many branched lines.\n\\end{definition}\n\n\\begin{definition}[Branching number]\nLet $\\beta$ be a branched line. We define the\\textit{ branching number} of $\\beta$, denoted by $b(\\beta)$, to be the maximum valence of vertices in $\\beta$.\n\\end{definition}\nThe following picture is a branched line with branching number $=5$:\n\n\\includegraphics[scale=0.5]{1.png}\n\n\\begin{remark}\nA branched line can be roughly thought as a \\textquotedblleft mapping cylinder\\textquotedblright\\ of the map $f$ in Proposition \\ref{key lemma1}.\n\\end{remark}\n\n\n\\begin{definition}[Tips and wall structure on tips]\n\\label{wall on tips}\nLet $\\beta$ be a branched line. We call the vertices of valence $\\le 2$ in $\\beta$ the \\textit{tips} of $\\beta$, and the collection of all tips is denoted by $t(\\beta)$. The set of hyperplanes in $\\beta$ (namely the midpoints of edges) induces a natural wall structure on $t(\\beta)$.\n\nFor a branched flat $F$, we define $t(F)$ to be the product of the tips of its branched line factors.\n\\end{definition}\n\n\n\\begin{cor}\n\\label{bijective}\nIf a group $G$ has an action on $\\Bbb Z$ by $(L,A)$-quasi-isometries, then there exist a branched line $\\beta$ and an isometric action $G\\curvearrowright \\beta$ which is related to the original action by a bijective equivariant map $q: \\Bbb Z\\to t(\\beta)$. Moreover, there exists a constant $M$ depending only on $L$ and $A$ such that $q$ is an $M$-bi-Lipschitz map and each vertex in $\\beta$ has valance $\\le M$.\n\\end{cor}\n\n\\begin{proof}\nLet $f:\\Bbb Z\\to\\Bbb Z$ be the map in Proposition \\ref{key lemma1}. We identify the range of $f$ as integer points of $\\Bbb R$. Pick $x\\in\\Bbb Z$, if the cardinality $|f^{-1}(x)|\\ge 2$, we attach $|f^{-1}(x)|$ many edges of length 1 to $\\Bbb R$ along $x$. When $|f^{-1}(x)|=1$, no edge will be attached. Let $\\beta$ be the resulting branched line. Then there is a natural bijective equivariant map $q: \\Bbb Z\\to t(\\beta)$ and the corollary follows from Proposition \\ref{key lemma1}.\n\\end{proof}\n\nIn the proof of Corollary \\ref{bijective}, the ${\\operatorname{CAT}}(0)$ cube complex dual to $t(\\beta)$ with the wall structure described in Definition \\ref{wall on tips} is isomorphic to $\\beta$. Note that this is not true for general branched lines.\n\n\\subsection{An invariant wallspace}\n\\label{subsec_invariant wallspace}\n$G(\\Gamma)$ has a natural wallspace structure which is induced from $X(\\Gamma)$; however, $H$ may not act on this wallspace. We want to find an alternative wallspace structure on $G(\\Gamma)$ which is consistent with the action of $H$.\n\n\\begin{definition}[$v$-walls and $v$-halfspaces]\nPick a vertex $v\\in\\mathcal{P}(\\Gamma)$. It follows from Corollary \\ref{bijective} that there exist a branched line $\\beta_{v}$,  an isometric action $H\\curvearrowright \\beta_{v}$, and an $H_{v}$-equivariant surjective map $\\eta_{v}: G(\\Gamma)\\to t(\\beta_{v})$ such that the inverse image of each point in $t(\\beta_{v})$ is a $v$-level. A \\textit{$v$-wall} (or a \\textit{$v$-halfspace}) of $G(\\Gamma)$ is the pullback of some wall (or halfspace) of $t(\\beta_{v})$ (see Definition \\ref{wall on tips}) under the map $\\eta_{v}$. The collection of all $v$-walls is denoted by $\\mathcal{W}_{v}$. \n\nNow for each vertex $v\\in\\mathcal{P}(\\Gamma)$, we want to choose a collection of $v$-walls, $\\beta_{v}$ and $\\eta_{v}$ in an $H$-equivariant way. Recall that $H\\curvearrowright G(\\Gamma)$ induces an action $H\\curvearrowright\\mathcal{P}(\\Gamma)$. We pick one representative from each vertex orbit of $H\\curvearrowright\\mathcal{P}(\\Gamma)$, which gives rise to a collection $\\{v_{i}\\}_{i\\in I}$. We choose $\\mathcal{W}_{v_{i}}$ as above and let $\\mathcal{W}$ be the union of all walls in $\\mathcal{W}_{v_{i}}$ for $i\\in I$, together with the $H$-orbits of these walls. \n\\end{definition}\n\nNow we record several consequences of the above construction.\n\\begin{lem}\\\n\\label{wallspace property}\n\\begin{enumerate}\n\\item Each $v$-halfspace is a union of $v$-levels, thus a $v$-wall and a $v'$-wall do not induce the same partition of $G(\\Gamma)$ if $v\\neq v'$.\n\\item Distinct $v$-walls in $\\mathcal{W}$ are never transverse.\n\\item $C(G(\\Gamma),\\mathcal{W}_{v})$ is isomorphic to $\\beta_{v}$.\n\\item Pick a standard geodesic line $l$ such that $\\Delta(l)=v$, and identify the vertex set $v(l)$ with $\\Bbb Z$. Then there exists $N>0$ independent of $v\\in\\mathcal{P}(\\Gamma)$ such that the map $\\xi_{v}:\\Bbb Z\\cong v(l)\\to C(G(\\Gamma),\\mathcal{W}_{v})\\cong \\beta_{v}$ is an $N$-bi-Lipschitz bijection.\n\\item There exists $M>0$ independent of $v\\in\\mathcal{P}(\\Gamma)$ such that the branching number $b(\\beta_{v})$ is at most $M$.\n\\end{enumerate}\n\\end{lem}\n \n$(4)$ and $(5)$ follow from Corollary \\ref{bijective}.\n\n\\begin{lem}\n\\label{wallspace}\n$(G(\\Gamma),\\mathcal{W})$ is a wallspace.\n\\end{lem}\n\n\\begin{proof}\nFor any pair of  points $x,y\\in G(\\Gamma)$, we need to show there are finitely many walls separating $x$ and $y$. If a $v$-wall separates $x$ from $y$, then $x$ and $y$ are in different $v$-level. There are only finitely many such vertices in $\\mathcal{P}(\\Gamma)$. Given such $v$, there are finitely many $v$-walls separating $x$ and $y$.\n\\end{proof}\n\nBy construction, $H$ acts on the wallspace $(G(\\Gamma),\\mathcal{W})$. Let $C$ be the ${\\operatorname{CAT}}(0)$ cube complex dual to $(G(\\Gamma),\\mathcal{W})$, then there is an induced action $H\\curvearrowright C$. Now we look at several properties of $C$.\n\n\n\\section{Properties of the cubulation}\n\\label{sec_property of wallspace}\n\n\\subsection{Dimension}\n\\label{subsec_structure}\n\nWe need the following lemmas before we compute the dimension of the dual complex $C$.\n\n\\begin{lem}\n\\label{transverse}\nLet $v_{1},v_{2}\\in\\mathcal{P}(\\Gamma)$ be distinct vertices. Then a $v_{1}$-wall and a $v_{2}$-wall are transverse if and only if $v_{1}$ and $v_{2}$ are adjacent.\n\\end{lem}\n\n\\begin{proof}\nThe if direction is clear (one can consider a standard 2-flat corresponding to the vertices $v_{1}$ and $v_{2}$). The other direction follows from Lemma \\ref{level projection} below.\n\\end{proof}\n\n\\begin{lem}\n\\label{level projection}\nLet $v_{1},v_{2}\\in\\mathcal{P}(\\Gamma)$ be non-adjacent vertices. For $i=1,2$, let $l_{i}$ be standard geodesic such that $\\Delta(l_{i})=v_{i}$. Let $x_{2}\\in l_{2}$ be the image $\\pi_{l_{2}}(l_{1})$ of the ${\\operatorname{CAT}}(0)$ projection $\\pi_{l_2}$ and let $x_{1}=\\pi_{l_{1}}(l_{2})$. Then any $v_{2}$-level which is not of height $x_{2}$ is contained in the $v_{1}$-level of height $x_{1}$ $($see the picture below$)$.\n\\end{lem}\n\n\\begin{center} \n\\includegraphics[scale=0.35]{2.png}\n\\end{center}\n\n\\begin{proof}\nSuppose the contrary is true.  Then there exists a vertex $x'_{2}\\in l_{2}$ with $x'_{2}\\neq x_{2}$, a $v_{2}$-level $K$ of height $x'_{2}$ and a vertex $x\\in K$ such that $x$ is not inside the $v_{1}$-level of height $x_{1}$. Let $\\omega\\subset X(\\Gamma)$ be a combinatorial geodesic connecting $x$ and $x'_{2}$. Since $\\pi_{l_{1}}(x'_{2})=x_{1}\\neq \\pi_{l_{1}}(x)$, there exists an edge $e\\subset \\omega$ and edge $e_{1}\\subset l_{1}$ such that $e$ and $e_1$ are parallel. Thus $\\pi_{l_{2}}(e)=\\pi_{l_{2}}(e_{1})=x_{2}$ by Lemma \\ref{projection}. On the other hand, since $\\pi^{-1}_{l_{2}}(x'_{2})$ is convex, $\\pi_{l_{2}}(e)\\subset\\pi_{l_{2}}(\\omega)=x'_{2}$, which is a contradiction.\n\\end{proof} \n\n\\begin{lem}\n$\\dim(C)=\\dim(G(\\Gamma))$.\n\\end{lem}\n\n\\begin{proof}\nLet $\\{W_{i}\\}_{i=1}^{l}\\subset\\mathcal{W}$ be a collection of pairwise intersecting walls and suppose $W_{i}$ is a $u_{i}$-wall. Then $u_{i}\\neq u_{j}$ for $i\\neq j$. Thus $\\{u_{i}\\}_{i=1}^{l}$ are vertices of a simplex in $\\mathcal{P}(\\Gamma)$ by Lemma \\ref{transverse}. It follows from Lemma \\ref{dimension} that $\\dim(C)=\\dim(\\mathcal{P}(\\Gamma))+1=\\dim(G(\\Gamma))$.\n\\end{proof}\n\n\\subsection{Standard branched flats}\nPick a maximal simplex $\\Delta\\in\\mathcal{P}(\\Gamma)$. Let $\\mathcal{W}_{\\Delta}$ be the collection of $u$-walls in $\\mathcal{W}$ with $u$ ranging over all vertices of $\\Delta$. Let $C(G(\\Gamma),\\mathcal{W}_{\\Delta})$ be the ${\\operatorname{CAT}}(0)$ cube complex dual to the wallspace $(G(\\Gamma),\\mathcal{W}_{\\Delta})$. \n\n\\begin{lem}\n\\label{embedding}\nThere exists a natural isometric embedding \n\\begin{center}\n$C(G(\\Gamma),\\mathcal{W}_{\\Delta})\\hookrightarrow C(G(\\Gamma),\\mathcal{W})=C$.\n\\end{center}\n\\end{lem}\n\n\\begin{proof}\nFirst we want to assign an orientation to each wall $W\\in\\mathcal{W}\\setminus\\mathcal{W}_{\\Delta}$. If $W$ is a $u$-wall, then by the maximality of $\\Delta$, there exists vertex $v\\in\\Delta$ which is not adjacent to $u$. Pick standard geodesics $l_{u}$ such that $\\Delta(l_{u})=u$. Let $F$ be the maximal standard flat such that $\\Delta(F)=\\Delta$. Since $u\\notin \\Delta$, $F^{(0)}$ is contained in a $u$-level by Lemma \\ref{in one level}. We orient $W$ such that\n\n", "index": 25, "text": "\\begin{equation}\n\\label{contain}\nv(F)\\subset \\sigma(W).\n\\end{equation}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E4.m1\" class=\"ltx_Math\" alttext=\"v(F)\\subset\\sigma(W).\" display=\"block\"><mrow><mrow><mrow><mi>v</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>F</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2282</mo><mrow><mi>\u03c3</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>W</mi><mo stretchy=\"false\">)</mo></mrow></mrow></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.00946.tex", "nexttext": "\n\nLet $x_{0}=\\pi_{l}(x)$ and $y_{0}=\\pi_{l}(y)$. Then $d_{v}(x,y)=d(x_{0},y_{0})$. Recall that in Lemma \\ref{wallspace property} we define a map $\\xi_{v}:v(l)\\to C(G(\\Gamma),\\mathcal{W}_{v})\\cong\\beta_{v}$, which is $L$-bi-Lipschitz with $L$ independent of $v$. Moreover, $d_{v}(\\phi(x),\\phi(y))=d(\\xi(x_{0}),\\xi(y_{0}))$. Hence (\\ref{bilip}) follows from Lemma \\ref{wallspace property}.\n\\end{proof}\n\n\\begin{lem}\n\\label{intersect}\nFor any two maximal standard flats $F_{1},F_{2}\\subset X(\\Gamma)$, $F_{1}\\cap F_{2}\\neq\\emptyset$ if and only if $\\Phi(F_{1})\\cap\\Phi(F_{2})\\neq\\emptyset$.\n\\end{lem}\n\n\\begin{proof}\nThe only if direction follows from the previous discussion. If $F_{1}\\cap F_{2}=\\emptyset$, then there is a hyperplane $h$ separating $F_{1}$ from $F_{2}$. Let $l$ be a standard geodesic dual to $h$ and let $v=\\Delta(l)$. By the maximality of $\\Delta(F_{1})$, there exists a vertex $v_{1}\\in\\Delta(F_{1})$ which is not adjacent to $v$, and thus $v(F_{1})$ is contained is some $v$-level $V_{1}$ by Lemma \\ref{projection}. Similarly, $v(F_{2})\\subset V_{2}$ for some $v$-level $V_{2}\\neq V_{1}$. If $W\\in \\mathcal{W}_{v}$  separates $V_{1}$ from $V_{2}$, then $W$ also separates $\\Phi(F_{1})$ from $\\Phi(F_{2})$ by (\\ref{contain}).\n\\end{proof}\n\nIf   $x\\in C$ is a vertex, since each edge that contains $x$ is inside a maximal standard branched flat (Lemma \\ref{surjective}), and these maximal standard flats intersect each other,  Lemma \\ref{intersect} and (5) of Lemma \\ref{wallspace property} imply:\n\\begin{cor}\n$C$ is uniformly locally finite.\n\\end{cor}\n\nWe have actually proved the following result since the condition on ${\\operatorname{Out}}(G(\\Gamma))$ has not been used after Section \\ref{subsec_flat-preserving}.\n\n\\begin{thm}\nLet $H\\curvearrowright G(\\Gamma)$ be an $H$-action by flat-preserving bijections which are also $(L,A)$-quasi-isometries. Then there exists a uniformly locally finite ${\\operatorname{CAT}}(0)$ cube complex $C$ with $\\dim(G(\\Gamma))=\\dim(C)$ such that the above $H$-action is conjugate to an isometric action $H\\curvearrowright C$. If the $H$-action is proper or cobounded, then the resulting isometric action is proper or cocompact respectively. \n\\end{thm}\n\n\\begin{cor}\n\\label{cubulation 1}\nSuppose ${\\operatorname{Out}}(G(\\Gamma))$ is finite and let $H\\curvearrowright G(\\Gamma)$ be a quasi-action. Then there exists a uniformly locally finite ${\\operatorname{CAT}}(0)$ cube complex $C$ with $\\dim(G(\\Gamma))=\\dim(C)$ such that the above quasi-action is quasiconjugate to an isometric action $H\\curvearrowright C$. If the quasi-action is proper or cobounded, then the resulting isometric action is proper or cocompact respectively. \n\\end{cor}\n\nRoughly speaking, the cube complex $C$ is obtained by replacing each standard geodesic  in $X(\\Gamma)$ by a suitable branched line. \n\n\\begin{remark}\nThe cubulation in Corollary~\\ref{cubulation 1} is slightly different from the one in Theorem~\\ref{thm_quasi_action1}. However, if we modify Definition~\\ref{wall on tips} such that tips are the vertices of valence 1 and repeat the whole construction, then cubulation in Corollary~\\ref{cubulation 1} coincides with the one in Theorem~\\ref{thm_quasi_action1}.\n\nSince we will not be using it, we will not give the argument. However, it is instructive to think about the following example. Given an isometric action $H{\\curvearrowright} X({\\Gamma})$, the output cube complex is $X({\\Gamma})$ in Corollary~\\ref{cubulation 1} and is $X_e({\\Gamma})$ in Theorem~\\ref{thm_quasi_action1}. Here $X_e({\\Gamma})$ is the universal cover of exploded Salvetti complex defined in Section~\\ref{subsection_canonical restriction quotient}. \n\\end{remark}\n\n\\begin{cor}\n\\label{cor_cubulation_corollary}\nSuppose ${\\operatorname{Out}}(G(\\Gamma))$ is finite. If $G$ is a finitely generated group quasi-isometric to $G(\\Gamma)$, then $G$ acts geometrically on a ${\\operatorname{CAT}}(0)$ cube complex.\n\\end{cor}\n\n\\subsection{Preservation of standard subcomplex} \n\\label{subsec_preservation of std subcomplex}\nWe look at how standard subcomplexes behave under the map $\\phi:G(\\Gamma)\\to C$ in Proposition \\ref{quasi-isometry}.\n\nLet $K\\subset X(\\Gamma)$ be a standard subcomplex and let $\\mathcal{W}_{K}$ be the collection of walls in $\\mathcal{W}$ that separate two vertices of $K$. Let $\\Delta(K)$ be the same as in Lemma \\ref{in one level}.\n\n\\begin{lem}\n\\label{K-walls}\nLet $v\\in\\mathcal{P}(\\Gamma)$ be a vertex. \n\\begin{enumerate}\n\\item If $v\\in \\Delta(K)$, then $\\mathcal{W}_{v}\\subset \\mathcal{W}_{K}$.\n\\item If $v\\notin \\Delta(K)$, then $\\mathcal{W}_{v}\\cap \\mathcal{W}_{K}=\\emptyset$.\n\\item There is a natural isometric embedding $C(G(\\Gamma),\\mathcal{W}_{K})\\hookrightarrow C$.\n\\end{enumerate}\n\\end{lem}\n\n\\begin{proof}\nIf $v\\in \\Delta(K)$, then there exists a standard geodesic $l\\subset K$ with $\\Delta(l)=v$. Thus $\\mathcal{W}_{v}\\subset \\mathcal{W}_{K}$. If $v\\notin \\Delta(K)$, it follows from Lemma \\ref{in one level} that $K^{(0)}$ is contained in a $v$-level, thus (2) is true. It follows from (1) and (2) that for each wall $W\\in \\mathcal{W}\\setminus\\mathcal{W}_{K}$, we can orient $W$ such that $K^{(0)}\\subset\\sigma(W)$. The rest of the proof for (3) is identical to Lemma \\ref{embedding}.\n\\end{proof}\n\n\\begin{thm}\nLet $\\phi:G(\\Gamma)\\to C$ be as in Proposition \\ref{quasi-isometry}. Then there exists $D>0$ which only depends on the constants of the quasi-action such that for any standard subcomplex $K\\subset X(\\Gamma)$, there exists a convex subcomplex $K'\\subset C$ such that $\\phi(K^{(0)})$ is a $D$-dense subset of $K'$.\n\\end{thm}\n\n\\begin{proof}\nBy construction, the isometric embedding $C(G(\\Gamma),\\mathcal{W}_{K})\\hookrightarrow C$ fits into the following commuting diagram:\n\\begin{center}\n$\\begin{CD}\nK^{(0)}                          @>>>        G(\\Gamma)\\\\\n@VV\\phi'V                                   @VV\\phi V\\\\\nC(G(\\Gamma),\\mathcal{W}_{K})         @>>>        C\n\\end{CD}$\n\\end{center}\nHere $\\phi'$ sends a vertex of $K$ to the 0-cube of $(G(\\Gamma),\\mathcal{W}_{K})$ which is consist of halfspaces containing this vertex. It suffices to show the image of $\\phi'$ is $D$-dense.\n\nThis can be proved by the same arguments in Section \\ref{subsec_structure}. Namely, for each simplex $\\Delta$ which is maximal in $\\Delta(K)$, there is a natural isometric embedding $C(G(\\Gamma),\\mathcal{W}_{\\Delta})\\to C(G(\\Gamma),\\mathcal{W}_{K})$, which gives rise to standard branched flats which are maximal in $C(G(\\Gamma),\\mathcal{W}_{K})$. These branched flats cover $C(G(\\Gamma),\\mathcal{W}_{K})$ and they are in 1-1 correspondence with standard flats which are maximal in $K$. Moreover, given a standard flat $F$ which is maximal in $K$, $\\phi'(F^{(0)})$ is exactly the set of tips of the corresponding branched flat in $C(G(\\Gamma),\\mathcal{W}_{K})$. Now we can conclude in the same way as Lemma \\ref{surjective}.\n\\end{proof}\n\n\\bibliography{cubulation}\n\n\\bibliographystyle{alpha}\n\n\n\n\n\n", "itemtype": "equation", "pos": 242624, "prevtext": "\n\nPick a $0$-cube $\\sigma$ of $(G(\\Gamma),\\mathcal{W}_{\\Delta})$.  We claim one can obtain a $0$-cube of $(G(\\Gamma),\\mathcal{W})$ by adding the orientations of walls in $\\mathcal{W}\\setminus\\mathcal{W}_{\\Delta}$ defined as above. Condition $(1)$ of Definition \\ref{0-cube} follows from (\\ref{contain}). To see $(2)$, suppose $W\\in \\mathcal{W}\\setminus\\mathcal{W}_{\\Delta}$ such that $z\\notin\\sigma(W)$;  then $W$ separates $z$ from $v(F)$ by (\\ref{contain}) and there are only finitely many such $W$ by Lemma \\ref{wallspace}. Now we have a map from $0$-cubes of $(G(\\Gamma),\\mathcal{W}_{\\Delta})$ to $0$-cubes of $(G(\\Gamma),\\mathcal{W})$, which  extends to higher dimensional cells. \n\nThis embedding is isometric since two walls are transverse in the wallspace $(G(\\Gamma),\\mathcal{W}_{\\Delta})$ if and only if they are transverse in $(G(\\Gamma),\\mathcal{W})$.\n\\end{proof}\n\nThe image of $C(G(\\Gamma),\\mathcal{W}_{\\Delta})$ under the above embedding is called a \\textit{maximal standard branched flat}. The following properties are immediate:\n\\begin{enumerate}\n\\item Each maximal standard branched flat is a convex subcomplex of $C$, since embedding in Lemma \\ref{embedding} is isometric.\n\\item Each maximal standard branched flat splits as a product of branched lines $C(G(\\Gamma),\\mathcal{W}_{\\Delta})\\cong\\Pi_{v\\in\\Delta} C(G(\\Gamma),\\mathcal{W}_{v})$ by Lemma \\ref{transverse}.\n\\end{enumerate}\n\n\\begin{lem}\n\\label{branched flat covers}\nEvery maximal cube of $C$ is contained in a maximal standard branched flat, and hence every point of $C$ is contained in a maximal standard branched flat.\n\\end{lem} \n\n\\begin{proof}\nBy Lemma \\ref{maximal cube}, every maximal cube is determined by a maximal collection of pairwise transverse walls. By Lemma \\ref{transverse}, these walls correspond to a maximal simplex in $\\Delta\\subset\\mathcal{P}(\\Gamma)$.  Thus the lemma follows from Lemma \\ref{embedding} since the image of the embedding $C(G(\\Gamma),\\mathcal{W}_{\\Delta})\\to C$ contains a maximal cube whose dual hyperplanes are the required collection.\n\\end{proof}\n\nThere is a bijective map $\\Phi$: $\\{$maximal standard flats in $X(\\Gamma)\\}$ $\\to$ $\\{$maximal standard branched flats in $C\\}$, since both sides of $\\Phi$ are in 1-1 correspondence with maximal simplexes of $\\mathcal{P}(\\Gamma)$.\n\n\\subsection{An equivariant quasi-isometry}\nEvery point $x\\in G(\\Gamma)$ gives rise to a $0$-cube of $(X,\\mathcal{W})$ by considering the halfspaces containing $x$. This induces an $H$-equivariant map $\\phi:G(\\Gamma)\\to C$. Let $F\\subset X(\\Gamma)$ be a maximal standard flat, so $\\phi(v(F))\\subset \\Phi(F)$ by $(\\ref{contain})$. Actually $\\phi(v(F))$ is exactly the collection of tips of $\\Phi(F)$. To see this, note that $\\phi|_{v(F)}$ can be written as a composition: $v(F)\\to C(G(\\Gamma),\\mathcal{W}_{\\Delta{F}})\\to C(G(\\Gamma,\\mathcal{W}))$. Thus there is a natural splitting $\\phi|_{v(F)}=\\Pi_{i=1}^{n}\\xi_{v_{i}}$, here $\\{v_{i}\\}_{i=1}^{n}$ are the vertices of $\\Delta(F)$ and $\\xi_{v_{i}}:\\Bbb Z\\to C(G(\\Gamma),\\mathcal{W}_{v_{i}})$ is the map in Lemma \\ref{wallspace property}.\n\n\\begin{lem}\n\\label{surjective}\nThe map $\\phi$ is coarsely surjective.\n\\end{lem}\n\n\\begin{proof}\nBy Lemma \\ref{branched flat covers}, it suffices show there exists a constant $D$ which does not depend on the maximal flat $F$ such that $\\phi(v(F))$ is $D$-dense in $\\Phi(F)$. This follows from Lemma \\ref{wallspace property}.\n\\end{proof}\n\n\\begin{prop}\n\\label{quasi-isometry}\nThe map $\\phi:G(\\Gamma)\\to C$ is an $H$-equivariant injective quasi-isometry.\n\\end{prop}\n\n\\begin{proof}\nWe prove $\\phi$ is a bi-Lipschitz embedding, then the proposition follows from Lemma \\ref{surjective}. Pick $x,y\\in G(\\Gamma)$ and pick vertex $v\\in\\mathcal{P}(\\Gamma)$. Suppose $l$ is a standard geodesic with $\\Delta(l)=v$. Let $d_{v}(x,y)$ be the number of \\textit{$v$-hyperplanes} in $X(\\Gamma)$ which separate $x$ from $y$ ($h$ is a \\textit{$v$-hyperplane} if and only if $l\\cap h$ is one point), and let $d_{v}(\\phi(x),\\phi(y))$ be the number of walls in $\\mathcal{W}_{v}$ that separate $x$ from $y$. It suffices to show there exists $L>0$ which does not depend on $x,y$ and $v$ such that\n\n", "index": 27, "text": "\\begin{equation}\n\\label{bilip}\nL^{-1}d_{v}(x,y)\\le d_{v}(\\phi(x),\\phi(y))\\le Ld_{v}(x,y).\n\\end{equation}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E5.m1\" class=\"ltx_Math\" alttext=\"L^{-1}d_{v}(x,y)\\leq d_{v}(\\phi(x),\\phi(y))\\leq Ld_{v}(x,y).\" display=\"block\"><mrow><mrow><mrow><msup><mi>L</mi><mrow><mo>-</mo><mn>1</mn></mrow></msup><mo>\u2062</mo><msub><mi>d</mi><mi>v</mi></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2264</mo><mrow><msub><mi>d</mi><mi>v</mi></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mrow><mi>\u03d5</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>,</mo><mrow><mi>\u03d5</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>y</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2264</mo><mrow><mi>L</mi><mo>\u2062</mo><msub><mi>d</mi><mi>v</mi></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy=\"false\">)</mo></mrow></mrow></mrow><mo>.</mo></mrow></math>", "type": "latex"}]