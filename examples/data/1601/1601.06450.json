[{"file": "1601.06450.tex", "nexttext": "\nfor every position of $A$. We also say that $B$ absorbs ${\\mathbf{{A}}}$, that $t$ witnesses the absorption $B {\\operatorname{\\trianglelefteq}} {\\mathbf{{A}}}$, etc.\n\nA subuniverse $B$ is called \\emph{J\\'onsson absorbing}, written $B {\\operatorname{\\trianglelefteq_J}} {\\mathbf{{A}}}$, if ${\\mathbf{{A}}}$ has a sequence of (necessarily idempotent) terms $d_0$, $d_1$, \\dots, $d_n$ (a \\emph{J\\'onsson absorption chain}) such that\n\n", "itemtype": "equation", "pos": 2003, "prevtext": "\n\n\n\n{\\gdef\\titrun{{Deciding absorption in relational structures}}}\n\n\\title{Deciding absorption in relational structures}\n\n\n\\author{Libor Barto  \\and Jakub Bul\\'in}\n\n\n\n\n\n\n\n\n\n\n\\date{}\n\n\\maketitle\n\n\\address{Department of Algebra, Faculty of Mathematics and Physics, Charles University in Prague, Sokolovsk\\'a 83, 18675 Prague 8, Czech Republic;{e-mail: {libor.barto@gmail.com}}}\n\\address{Department of Mathematics, University of Colorado Boulder, Boulder, Colorado 80309-0395, USA; {e-mail: {jakub.bulin@gmail.com}}}\n\\thanks{Both authors were supported by the Grant Agency of the Czech Republic, grant 13-01832S.  The second author was also supported by the Polish National Science Centre (NCN) grant 2011/01/B/ST6/01006.\n}\n\n\n\n\\begin{abstract}\nWe prove that for finite, finitely related algebras the concepts of an absorbing subuniverse and a J\\'onsson absorbing subuniverse coincide. Consequently, it is decidable whether a given subset is an absorbing subuniverse of the polymorphism algebra of a given  relational structure.\n\\end{abstract}\n\n\n\\section{Introduction}\n\nA finite algebra ${\\mathbf{{A}}}$  is called \\emph{finitely related} if its clone of term operations is equal to the polymorphism clone of some relational structure with finite signature.\nIn~\\cite{Bar13} it was proved that every finite, finitely related algebra with J\\'onsson terms has a near unanimity term; consequently, it is decidable whether a given relational structure has a near unanimity polymorphism. \nIn the present paper, we generalize this result and its consequence. A partial result in the same direction already appeared in~\\cite{Bulin14}.\n\nAbsorption (J\\'onsson absorption, respectively) generalizes near unanimity operations (J\\'onsson operations) in the following way.\nA subuniverse $B$ or a subalgebra ${\\mathbf{{B}}}$ of an algebra ${\\mathbf{{A}}}$ is \\emph{absorbing}, written $B {\\operatorname{\\trianglelefteq}} {\\mathbf{{A}}}$, if ${\\mathbf{{A}}}$ has an idempotent term $t$ (an \\emph{absorption term}) such that\n", "index": 1, "text": "\n\\[\nt(B,B,\\dots, B, A, B, \\dots, B) \\subseteq B\n\\]\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex1.m1\" class=\"ltx_Math\" alttext=\"t(B,B,\\dots,B,A,B,\\dots,B)\\subseteq B\" display=\"block\"><mrow><mrow><mi>t</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>B</mi><mo>,</mo><mi>B</mi><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><mi>B</mi><mo>,</mo><mi>A</mi><mo>,</mo><mi>B</mi><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><mi>B</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2286</mo><mi>B</mi></mrow></math>", "type": "latex"}, {"file": "1601.06450.tex", "nexttext": "\n\nNote that these terms do not correspond to the standard J\\'onsson terms, but to\ndirected J\\'onsson terms introduced in~\\cite{KKMM}. However, the definition\nvia the original J\\'onsson terms gives an equivalent concept of J\\'onsson absorption~\\cite{KKMM}.\n\n\nThe relation of absorption to near unanimity terms and J\\'onsson terms is as follows.\nClearly, every singleton subuniverse $\\{a\\}$ of ${\\mathbf{{A}}}$ is absorbing (J\\'onsson absorbing, respectively) whenever ${\\mathbf{{A}}}$ has a near unanimity term (J\\'onsson terms, respectively). A short argument (see eg. \\cite{BKazda,Bulin14}) shows that the converse is also true, that is, a finite algebra ${\\mathbf{{A}}}$ has a near unanimity term (J\\'onsson terms, respectively) if and only if every singleton is an absorbing subuniverse (J\\'onsson absorbing subuniverse) of the full idempotent reduct of ${\\mathbf{{A}}}$. \n\nAbsorption and J\\'onsson absorption played a key role in the proofs of several results concerning\nMaltsev conditions and the complexity of the constraint satisfaction problem~(eg.~\\cite{BK09a,B11,BK12,BK14,BKS15,BKW12}).\nAbsorption is stronger than J\\'onsson absorption (see Section~\\ref{sec:proof}) and is sometimes easier to work with.\nOur main theorem shows that, in fact, these concepts coincide for finitely related algebras. A special case, for congruence meet-semidistributive algebras, was proved in \\cite{Bulin14}.\n\n\\begin{theorem} \\label{thm:main}\nLet $B$ be a subuniverse of a finite, finitely related algebra ${\\mathbf{{A}}}$. Then $B {\\operatorname{\\trianglelefteq}} {\\mathbf{{A}}}$ if and only if $B {\\operatorname{\\trianglelefteq_J}} {\\mathbf{{A}}}$. \n\\end{theorem}\n\nSince it is decidable whether $B$ is a J\\'onsson absorbing subuniverse of the polymorphism algebra of a given relational structure ${\\mathbb{{A}}}$, we immediately get the decidability of the corresponding problem for absorption. In fact, if we are guaranteed that the input subset $B$ is a subuniverse, then we can place this problem to the class {NP}:\n\n\\begin{theorem} \\label{thm:complexity}\nThe problem of deciding whether a given subuniverse of the polymorphism algebra of a given relational structure is (J\\'onsson) absorbing, is in {NP}.\n\\end{theorem}\n\nIn~\\cite{BKazda}, absorption in general finite algebras (not necessarily finitely related) is characterized by means of J\\'onsson absorption and cube term blockers. This result is then used to devise an algorithm for the algebraic version of the absorption problem, in which the algebra is given by the tables of the basic operations. However, we are not able to use the results in~\\cite{BKazda} to simplify our proof of Theorem~\\ref{thm:main}. \n\n\\section{Preliminaries}\n\nWe use rather standard universal algebraic terminology~\\cite{BS81,Berg11}. Algebras are denoted by capital letters ${\\mathbf{{A}}}$, ${\\mathbf{{B}}}$, \\dots in boldface and relational structures by capitals in blackboard bold ${\\mathbb{{A}}}, {\\mathbb{{B}}}, \\dots$. The same letters  $A$, $B$, \\dots in the plain font are used to denote their universes. A subuniverse or a subalgebra of a power is called a \\emph{subpower}. We mostly work with finite algebras that are idempotent, that is, each  basic operation $f$ satisfies the identity $f(x, x, \\dots, x) \\approx x$. \n\nThe algebra of polymorphisms of a relational structure ${\\mathbb{{A}}}$ is denoted ${\\mathop{\\mathrm{Pol}}} {\\mathbb{{A}}}$. We assume that the reader is familiar with the Pol--Inv Galois correspondence~\\cite{G68,BKKR69}. Recall, in particular, that $R$ is a subpower of ${\\mathop{\\mathrm{Pol}}} {\\mathbb{{A}}}$\n(where $A$ is finite) if and only if $R$ can be pp-defined from ${\\mathbb{{A}}}$, i.e., defined by a formula of the form\n", "itemtype": "equation", "pos": 2484, "prevtext": "\nfor every position of $A$. We also say that $B$ absorbs ${\\mathbf{{A}}}$, that $t$ witnesses the absorption $B {\\operatorname{\\trianglelefteq}} {\\mathbf{{A}}}$, etc.\n\nA subuniverse $B$ is called \\emph{J\\'onsson absorbing}, written $B {\\operatorname{\\trianglelefteq_J}} {\\mathbf{{A}}}$, if ${\\mathbf{{A}}}$ has a sequence of (necessarily idempotent) terms $d_0$, $d_1$, \\dots, $d_n$ (a \\emph{J\\'onsson absorption chain}) such that\n\n", "index": 3, "text": "\\begin{align*}\n  &d_i(B,A,B)\\subseteq B\\text{ for all }i\\leq n,\\\\\n  &d_i(x,y,y)\\approx d_{i+1}(x,x,y)\\text{ for all }i<n,\\\\\n  &d_0(x,y,z)\\approx x,\\text{ and } d_n(x,y,z)\\approx z.\n\\end{align*}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex2.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle d_{i}(B,A,B)\\subseteq B\\text{ for all }i\\leq n,\" display=\"inline\"><mrow><mrow><mrow><msub><mi>d</mi><mi>i</mi></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>B</mi><mo>,</mo><mi>A</mi><mo>,</mo><mi>B</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2286</mo><mrow><mi>B</mi><mo>\u2062</mo><mtext>\u00a0for all\u00a0</mtext><mo>\u2062</mo><mi>i</mi></mrow><mo>\u2264</mo><mi>n</mi></mrow><mo>,</mo></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex3.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle d_{i}(x,y,y)\\approx d_{i+1}(x,x,y)\\text{ for all }i&lt;n,\" display=\"inline\"><mrow><mrow><mrow><msub><mi>d</mi><mi>i</mi></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>y</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2248</mo><mrow><msub><mi>d</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo>,</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy=\"false\">)</mo></mrow><mo>\u2062</mo><mtext>\u00a0for all\u00a0</mtext><mo>\u2062</mo><mi>i</mi></mrow><mo>&lt;</mo><mi>n</mi></mrow><mo>,</mo></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex4.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle d_{0}(x,y,z)\\approx x,\\text{ and }d_{n}(x,y,z)\\approx z.\" display=\"inline\"><mrow><mrow><mrow><mrow><msub><mi>d</mi><mn>0</mn></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>z</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2248</mo><mi>x</mi></mrow><mo>,</mo><mrow><mrow><mtext>\u00a0and\u00a0</mtext><mo>\u2062</mo><msub><mi>d</mi><mi>n</mi></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>z</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2248</mo><mi>z</mi></mrow></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.06450.tex", "nexttext": "\nwhere $S_1, S_2, \\dots$ are relations in ${\\mathbb{{A}}}$ regarded as predicates in the formula. The clauses in pp-formulas will also be called \\emph{constraints} and the tuple of variables in a constraint will be called the \\emph{scope} of the constraint. \n\nThe \\emph{incidence multigraph} of a $\\tau$-structure $\\mathbb A$ is defined as a bipartite multigraph with parts $A$ and $\\{(R,\\bar a)\\mid R\\in\\tau,\\bar a\\in R\\}$ and edge relations $E_1,E_2,\\dots$ defined by $(b,(R,\\bar a))\\in E_i$ if and only if $b=a_i$. \n\nBy the \\emph{degree} of $a\\in A$ we mean its degree in the incidence multigraph. The \\emph{leaves} of $\\mathbb A$ are vertices $a\\in A$ of degree at most one.  The \\emph{neighborhood} of $a$, denoted ${\\operatorname{N}}(a)$, is the set of all vertices $b\\in A$, $b\\neq a$ which appear in some hyperedge containing $a$ (in other words, it is the set of vertices whose distance from $a$ in the incidence multigraph is two). \n\nThe structure $\\mathbb A$ is a \\emph{relational tree} if its incidence multigraph is a tree (in particular, it has no multiple edges). For a pair of vertices $a\\neq b\\in A$ we define the \\emph{branch} rooted at $a$ containing $b$, denoted ${\\operatorname{Br}}(a;b)$, to be the connected component which contains $b$ and is obtained from $\\mathbb A$ by removing all but one hyperedges containing $a$.\n\nA pp-formula $\\Phi$ in the language $\\tau$ can be naturally regarded as a $\\tau$-structure (together with a labeling of free variables): its vertices are variables (both free and bound), and the relation corresponding to $R \\in \\tau$ consists of all tuples $\\bar x$ which appear in $\\Phi$ as a scope of some constraint of the form $R(\\bar x)$. We call $\\Phi$ a \\emph{tree formula} if the corresponding relational structure is a relational tree, $\\Phi$ is \\emph{connected} if the structure is connected, etc.\n\nA binary relation $E \\subseteq A^2$ is often regarded as a digraph. A sequence $(a_0,a_1, \\dots, a_n) \\in A^{n+1}$ is called an \\emph{$E$-walk} (of length $n$) if $(a_{i-1},a_i) \\in E$ for each $i\\in[n]$. Such a walk is \\emph{closed} if $a_0=a_n$.\n\n\n\\section{Absorption}\n\nIn this section we introduce several facts about absorbing and J{\\' o}nsson absorbing subuniverses which will be needed later in the proof.\n\n\\subsection{Absorption and pp-definitions}\n\nThe set of subuniverses of an algebra is closed under pp-definitions. The following simple lemma (see~\\cite[Lemma 11]{BKazda}) is a version of this fact for absorption. \n\n\\begin{lemma}\\label{lem:abspp}\n  Assume that a subpower $R$ of ${\\mathbf{{A}}}$ is defined by \n \n", "itemtype": "equation", "pos": 6372, "prevtext": "\n\nNote that these terms do not correspond to the standard J\\'onsson terms, but to\ndirected J\\'onsson terms introduced in~\\cite{KKMM}. However, the definition\nvia the original J\\'onsson terms gives an equivalent concept of J\\'onsson absorption~\\cite{KKMM}.\n\n\nThe relation of absorption to near unanimity terms and J\\'onsson terms is as follows.\nClearly, every singleton subuniverse $\\{a\\}$ of ${\\mathbf{{A}}}$ is absorbing (J\\'onsson absorbing, respectively) whenever ${\\mathbf{{A}}}$ has a near unanimity term (J\\'onsson terms, respectively). A short argument (see eg. \\cite{BKazda,Bulin14}) shows that the converse is also true, that is, a finite algebra ${\\mathbf{{A}}}$ has a near unanimity term (J\\'onsson terms, respectively) if and only if every singleton is an absorbing subuniverse (J\\'onsson absorbing subuniverse) of the full idempotent reduct of ${\\mathbf{{A}}}$. \n\nAbsorption and J\\'onsson absorption played a key role in the proofs of several results concerning\nMaltsev conditions and the complexity of the constraint satisfaction problem~(eg.~\\cite{BK09a,B11,BK12,BK14,BKS15,BKW12}).\nAbsorption is stronger than J\\'onsson absorption (see Section~\\ref{sec:proof}) and is sometimes easier to work with.\nOur main theorem shows that, in fact, these concepts coincide for finitely related algebras. A special case, for congruence meet-semidistributive algebras, was proved in \\cite{Bulin14}.\n\n\\begin{theorem} \\label{thm:main}\nLet $B$ be a subuniverse of a finite, finitely related algebra ${\\mathbf{{A}}}$. Then $B {\\operatorname{\\trianglelefteq}} {\\mathbf{{A}}}$ if and only if $B {\\operatorname{\\trianglelefteq_J}} {\\mathbf{{A}}}$. \n\\end{theorem}\n\nSince it is decidable whether $B$ is a J\\'onsson absorbing subuniverse of the polymorphism algebra of a given relational structure ${\\mathbb{{A}}}$, we immediately get the decidability of the corresponding problem for absorption. In fact, if we are guaranteed that the input subset $B$ is a subuniverse, then we can place this problem to the class {NP}:\n\n\\begin{theorem} \\label{thm:complexity}\nThe problem of deciding whether a given subuniverse of the polymorphism algebra of a given relational structure is (J\\'onsson) absorbing, is in {NP}.\n\\end{theorem}\n\nIn~\\cite{BKazda}, absorption in general finite algebras (not necessarily finitely related) is characterized by means of J\\'onsson absorption and cube term blockers. This result is then used to devise an algorithm for the algebraic version of the absorption problem, in which the algebra is given by the tables of the basic operations. However, we are not able to use the results in~\\cite{BKazda} to simplify our proof of Theorem~\\ref{thm:main}. \n\n\\section{Preliminaries}\n\nWe use rather standard universal algebraic terminology~\\cite{BS81,Berg11}. Algebras are denoted by capital letters ${\\mathbf{{A}}}$, ${\\mathbf{{B}}}$, \\dots in boldface and relational structures by capitals in blackboard bold ${\\mathbb{{A}}}, {\\mathbb{{B}}}, \\dots$. The same letters  $A$, $B$, \\dots in the plain font are used to denote their universes. A subuniverse or a subalgebra of a power is called a \\emph{subpower}. We mostly work with finite algebras that are idempotent, that is, each  basic operation $f$ satisfies the identity $f(x, x, \\dots, x) \\approx x$. \n\nThe algebra of polymorphisms of a relational structure ${\\mathbb{{A}}}$ is denoted ${\\mathop{\\mathrm{Pol}}} {\\mathbb{{A}}}$. We assume that the reader is familiar with the Pol--Inv Galois correspondence~\\cite{G68,BKKR69}. Recall, in particular, that $R$ is a subpower of ${\\mathop{\\mathrm{Pol}}} {\\mathbb{{A}}}$\n(where $A$ is finite) if and only if $R$ can be pp-defined from ${\\mathbb{{A}}}$, i.e., defined by a formula of the form\n", "index": 5, "text": "\n\\[\n(\\exists x_1) (\\exists x_2)\\dots S_1(x_{i_1}, x_{i_2}, \\dots) \\wedge S_2(x_{j_1}, \\dots) \\wedge \\dots,\n\\]\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex5.m1\" class=\"ltx_Math\" alttext=\"(\\exists x_{1})(\\exists x_{2})\\dots S_{1}(x_{i_{1}},x_{i_{2}},\\dots)\\wedge S_{%&#10;2}(x_{j_{1}},\\dots)\\wedge\\dots,\" display=\"block\"><mrow><mrow><mrow><mrow><mo stretchy=\"false\">(</mo><mrow><mo>\u2203</mo><msub><mi>x</mi><mn>1</mn></msub></mrow><mo stretchy=\"false\">)</mo></mrow><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mrow><mo>\u2203</mo><msub><mi>x</mi><mn>2</mn></msub></mrow><mo stretchy=\"false\">)</mo></mrow><mo>\u2062</mo><mi mathvariant=\"normal\">\u2026</mi><mo>\u2062</mo><msub><mi>S</mi><mn>1</mn></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>x</mi><msub><mi>i</mi><mn>1</mn></msub></msub><mo>,</mo><msub><mi>x</mi><msub><mi>i</mi><mn>2</mn></msub></msub><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2227</mo><mrow><msub><mi>S</mi><mn>2</mn></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>x</mi><msub><mi>j</mi><mn>1</mn></msub></msub><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2227</mo><mi mathvariant=\"normal\">\u2026</mi></mrow><mo>,</mo></mrow></math>", "type": "latex"}, {"file": "1601.06450.tex", "nexttext": "\n  where $R_1,\\dots,R_k$ are subpowers of ${\\mathbf{{A}}}$\n   and $\\sigma_1$,\\dots,$\\sigma_k$ stand for sequences of (free or bound) variables. \n  Let $S_1,\\dots,S_k$ be subpowers of ${\\mathbf{{A}}}$ such that $S_i{\\operatorname{\\trianglelefteq}} {\\mathbf{{R}}}_i$ (resp.\n  $S_i{\\operatorname{\\trianglelefteq_J}} {\\mathbf{{R}}}_i$) for all $i$. Then the subpower\n \n", "itemtype": "equation", "pos": 9060, "prevtext": "\nwhere $S_1, S_2, \\dots$ are relations in ${\\mathbb{{A}}}$ regarded as predicates in the formula. The clauses in pp-formulas will also be called \\emph{constraints} and the tuple of variables in a constraint will be called the \\emph{scope} of the constraint. \n\nThe \\emph{incidence multigraph} of a $\\tau$-structure $\\mathbb A$ is defined as a bipartite multigraph with parts $A$ and $\\{(R,\\bar a)\\mid R\\in\\tau,\\bar a\\in R\\}$ and edge relations $E_1,E_2,\\dots$ defined by $(b,(R,\\bar a))\\in E_i$ if and only if $b=a_i$. \n\nBy the \\emph{degree} of $a\\in A$ we mean its degree in the incidence multigraph. The \\emph{leaves} of $\\mathbb A$ are vertices $a\\in A$ of degree at most one.  The \\emph{neighborhood} of $a$, denoted ${\\operatorname{N}}(a)$, is the set of all vertices $b\\in A$, $b\\neq a$ which appear in some hyperedge containing $a$ (in other words, it is the set of vertices whose distance from $a$ in the incidence multigraph is two). \n\nThe structure $\\mathbb A$ is a \\emph{relational tree} if its incidence multigraph is a tree (in particular, it has no multiple edges). For a pair of vertices $a\\neq b\\in A$ we define the \\emph{branch} rooted at $a$ containing $b$, denoted ${\\operatorname{Br}}(a;b)$, to be the connected component which contains $b$ and is obtained from $\\mathbb A$ by removing all but one hyperedges containing $a$.\n\nA pp-formula $\\Phi$ in the language $\\tau$ can be naturally regarded as a $\\tau$-structure (together with a labeling of free variables): its vertices are variables (both free and bound), and the relation corresponding to $R \\in \\tau$ consists of all tuples $\\bar x$ which appear in $\\Phi$ as a scope of some constraint of the form $R(\\bar x)$. We call $\\Phi$ a \\emph{tree formula} if the corresponding relational structure is a relational tree, $\\Phi$ is \\emph{connected} if the structure is connected, etc.\n\nA binary relation $E \\subseteq A^2$ is often regarded as a digraph. A sequence $(a_0,a_1, \\dots, a_n) \\in A^{n+1}$ is called an \\emph{$E$-walk} (of length $n$) if $(a_{i-1},a_i) \\in E$ for each $i\\in[n]$. Such a walk is \\emph{closed} if $a_0=a_n$.\n\n\n\\section{Absorption}\n\nIn this section we introduce several facts about absorbing and J{\\' o}nsson absorbing subuniverses which will be needed later in the proof.\n\n\\subsection{Absorption and pp-definitions}\n\nThe set of subuniverses of an algebra is closed under pp-definitions. The following simple lemma (see~\\cite[Lemma 11]{BKazda}) is a version of this fact for absorption. \n\n\\begin{lemma}\\label{lem:abspp}\n  Assume that a subpower $R$ of ${\\mathbf{{A}}}$ is defined by \n \n", "index": 7, "text": "\\[\n    R=\\{(x_1,\\dots,x_n) \\mid (\\exists y_1\\dots\\exists y_m)\\, R_1(\\sigma_1){\\wedge}\n    R_2(\\sigma_2){\\wedge}\\dots{\\wedge} R_k(\\sigma_k)\\},\n  \\]\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex6.m1\" class=\"ltx_Math\" alttext=\"R=\\{(x_{1},\\dots,x_{n})\\mid(\\exists y_{1}\\dots\\exists y_{m})\\,R_{1}(\\sigma_{1}%&#10;){\\wedge}R_{2}(\\sigma_{2}){\\wedge}\\dots{\\wedge}R_{k}(\\sigma_{k})\\},\" display=\"block\"><mrow><mrow><mi>R</mi><mo>=</mo><mrow><mo stretchy=\"false\">{</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy=\"false\">)</mo></mrow><mo>\u2223</mo><mrow><mrow><mrow><mo stretchy=\"false\">(</mo><mrow><mo>\u2203</mo><mrow><msub><mi>y</mi><mn>1</mn></msub><mo>\u2062</mo><mi mathvariant=\"normal\">\u2026</mi><mo>\u2062</mo><mrow><mo>\u2203</mo><msub><mi>y</mi><mi>m</mi></msub></mrow></mrow></mrow><mo rspace=\"4.2pt\" stretchy=\"false\">)</mo></mrow><mo>\u2062</mo><msub><mi>R</mi><mn>1</mn></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>\u03c3</mi><mn>1</mn></msub><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2227</mo><mrow><msub><mi>R</mi><mn>2</mn></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>\u03c3</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2227</mo><mi mathvariant=\"normal\">\u2026</mi><mo>\u2227</mo><mrow><msub><mi>R</mi><mi>k</mi></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>\u03c3</mi><mi>k</mi></msub><mo stretchy=\"false\">)</mo></mrow></mrow></mrow><mo stretchy=\"false\">}</mo></mrow></mrow><mo>,</mo></mrow></math>", "type": "latex"}, {"file": "1601.06450.tex", "nexttext": "\n  absorbs (resp. J{\\' o}nsson absorbs) ${\\mathbf{{R}}}$.\n\\end{lemma}\n\n\n\\subsection{Essential relations}\n\nAn alternative characterization of absorption by means of $B$-essential relations, which is given in this subsection, will be essential in the proof of the main theorem.\n\n\nWhen $R \\subseteq A^n$ and $i \\in \\{1, \\dots, n\\}$, we denote by $\\pi_{\\widehat i}(R)$ the projection of $R$ onto the coordinates $\\{1, \\dots, n\\} \\setminus \\{i\\}$. \n\n\\begin{definition}\nA relation $R \\subseteq A^n$ is called \\emph{$B$-essential} if $R\\cap B^n=\\emptyset$ and, for every $i=1,2,\\dots n$, \nwe have $\\pi_{\\widehat i} (R)\\cap B^{n-1}\\neq \\emptyset$.\n\\end{definition}\n\nObserve that if $R \\leq {\\mathbf{{A}}}^n$ is $B$-essential, then by fixing the first coordinate to $B$, that is, by defining\n", "itemtype": "equation", "pos": 9571, "prevtext": "\n  where $R_1,\\dots,R_k$ are subpowers of ${\\mathbf{{A}}}$\n   and $\\sigma_1$,\\dots,$\\sigma_k$ stand for sequences of (free or bound) variables. \n  Let $S_1,\\dots,S_k$ be subpowers of ${\\mathbf{{A}}}$ such that $S_i{\\operatorname{\\trianglelefteq}} {\\mathbf{{R}}}_i$ (resp.\n  $S_i{\\operatorname{\\trianglelefteq_J}} {\\mathbf{{R}}}_i$) for all $i$. Then the subpower\n \n", "index": 9, "text": "\\[\n    S=\\{(x_1,\\dots,x_n)\\mid (\\exists y_1\\dots\\exists y_m)\\, S_1(\\sigma_1){\\wedge}\n    S_2(\\sigma_2){\\wedge}\\dots{\\wedge} S_k(\\sigma_k)\\},\n  \\]\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex7.m1\" class=\"ltx_Math\" alttext=\"S=\\{(x_{1},\\dots,x_{n})\\mid(\\exists y_{1}\\dots\\exists y_{m})\\,S_{1}(\\sigma_{1}%&#10;){\\wedge}S_{2}(\\sigma_{2}){\\wedge}\\dots{\\wedge}S_{k}(\\sigma_{k})\\},\" display=\"block\"><mrow><mrow><mi>S</mi><mo>=</mo><mrow><mo stretchy=\"false\">{</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy=\"false\">)</mo></mrow><mo>\u2223</mo><mrow><mrow><mrow><mo stretchy=\"false\">(</mo><mrow><mo>\u2203</mo><mrow><msub><mi>y</mi><mn>1</mn></msub><mo>\u2062</mo><mi mathvariant=\"normal\">\u2026</mi><mo>\u2062</mo><mrow><mo>\u2203</mo><msub><mi>y</mi><mi>m</mi></msub></mrow></mrow></mrow><mo rspace=\"4.2pt\" stretchy=\"false\">)</mo></mrow><mo>\u2062</mo><msub><mi>S</mi><mn>1</mn></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>\u03c3</mi><mn>1</mn></msub><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2227</mo><mrow><msub><mi>S</mi><mn>2</mn></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>\u03c3</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2227</mo><mi mathvariant=\"normal\">\u2026</mi><mo>\u2227</mo><mrow><msub><mi>S</mi><mi>k</mi></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>\u03c3</mi><mi>k</mi></msub><mo stretchy=\"false\">)</mo></mrow></mrow></mrow><mo stretchy=\"false\">}</mo></mrow></mrow><mo>,</mo></mrow></math>", "type": "latex"}, {"file": "1601.06450.tex", "nexttext": "\nwe get a $B$-essential subuniverse of ${\\mathbf{{A}}}^{n-1}$.  \nTherefore, the set of arities of $B$-essential subpowers of an algebra is a downset in $(\\mathbb{N},\\leq)$.\n\n\\begin{proposition}[{\\cite[Proposition 16]{BKazda}}] \\label{prop:essential}\nLet ${\\mathbf{{A}}}$ be a finite idempotent algebra and $B \\leq {\\mathbf{{A}}}$. Then $B {\\operatorname{\\trianglelefteq}} {\\mathbf{{A}}}$ by an $n$-ary term if and only if ${\\mathbf{{A}}}$ has no $n$-ary $B$-essential subpower. \n\\end{proposition}\n\nNote that using Proposition~\\ref{prop:essential} we can define an absorbing subuniverse of ${\\mathop{\\mathrm{Pol}}}{\\mathbb{{A}}}$ in a purely relational way: a set $B \\subseteq A$ is an absorbing subuniverse of ${\\mathop{\\mathrm{Pol}}}{\\mathbb{{A}}}$ if and only if $B$ is pp-definable from ${\\mathbb{{A}}}$ and no $B$-essential relation is pp-definable from ${\\mathbb{{A}}}$. A relational description of J\\'onsson absorption can be obtained from Theorem~\\ref{thm:jabs_local}.\n\n\n\\subsection{A connectivity lemma}\n\nAbsorption is used to absorb connectivity properties of subpowers. A technical lemma of this sort will be used in the final stage of the proof of Theorem~\\ref{thm:main}.\n\n\\begin{lemma} \\label{lem:walk}\nLet ${\\mathbf{{A}}}$ be a finite algebra, $G$, $H$ subsets of $A$, and $P$, $Q$ subuniverses of ${\\mathbf{{A}}}^2$ such that\n\\begin{itemize}\n\\item[(i)] $P {\\operatorname{\\trianglelefteq_J}} {\\mathbf{{Q}}}$,\n\\item[(ii)] $(a,c) \\in Q$ for some $a \\in G$ and $c \\in H$,\n\\item[(iii)] for every $c \\in G$ there exists $a \\in G$ such that $(a,c) \\in P$, and\n\\item[(iv)] for every $a \\in H$ there exists $c \\in H$ such that $(a,c) \\in P$.\n\\end{itemize}\nThen there exists a directed $P$-walk from an element in $G$ to an element in $H$.\n\\end{lemma}\n\n\\begin{proof}\nLet $d_0, \\dots, d_n$ be a J\\'onsson absorption chain witnessing $P {\\operatorname{\\trianglelefteq_J}} {\\mathbf{{Q}}}$.\nLet $a \\in G$, $c \\in H$ be such that $(a,c) \\in Q$. By (iii), there exists a directed $P$-walk to $a$ consisting of elements in $G$ of arbitrary length. Since $A$ is finite, it follows that there exists a $P$-walk to $a$ from an element in a closed $P$-walk and both walks lie entirely in $G$. Similarly, from (iv) it follows that there exists a directed $P$-walk from $c$ to an element in a closed $P$-walk, both walks being in $H$. Choosing appropriate elements in the two closed $P$-walks and large enough $k$ divisible by the lengths of the closed $P$-walks, we get closed $P$-walks\n$(e_0, e_1, \\dots, e_k=e_0) \\in G^{k+1}$, $(f_0, f_1, \\dots, f_k=f_0)\\in G^{k+1}$ and a $Q$-walk $(e_0=g_0,g_1, \\dots, g_k = f_0)\\in A^{k+1}$.\n\nNow for each $i\\leq n$ we apply the $i$-th term $d_i$ to the columns of the following matrix.\n", "itemtype": "equation", "pos": 10498, "prevtext": "\n  absorbs (resp. J{\\' o}nsson absorbs) ${\\mathbf{{R}}}$.\n\\end{lemma}\n\n\n\\subsection{Essential relations}\n\nAn alternative characterization of absorption by means of $B$-essential relations, which is given in this subsection, will be essential in the proof of the main theorem.\n\n\nWhen $R \\subseteq A^n$ and $i \\in \\{1, \\dots, n\\}$, we denote by $\\pi_{\\widehat i}(R)$ the projection of $R$ onto the coordinates $\\{1, \\dots, n\\} \\setminus \\{i\\}$. \n\n\\begin{definition}\nA relation $R \\subseteq A^n$ is called \\emph{$B$-essential} if $R\\cap B^n=\\emptyset$ and, for every $i=1,2,\\dots n$, \nwe have $\\pi_{\\widehat i} (R)\\cap B^{n-1}\\neq \\emptyset$.\n\\end{definition}\n\nObserve that if $R \\leq {\\mathbf{{A}}}^n$ is $B$-essential, then by fixing the first coordinate to $B$, that is, by defining\n", "index": 11, "text": "\n\\[\n\\{(a_2, \\dots, a_n) \\mid \\exists b \\in B,\\, (b,a_2, \\dots, a_n) \\in R\\},\n\\]\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex8.m1\" class=\"ltx_Math\" alttext=\"\\{(a_{2},\\dots,a_{n})\\mid\\exists b\\in B,\\,(b,a_{2},\\dots,a_{n})\\in R\\},\" display=\"block\"><mrow><mrow><mo stretchy=\"false\">{</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>a</mi><mn>2</mn></msub><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msub><mi>a</mi><mi>n</mi></msub><mo stretchy=\"false\">)</mo></mrow><mo>\u2223</mo><mrow><mrow><mrow><mo>\u2203</mo><mi>b</mi></mrow><mo>\u2208</mo><mi>B</mi></mrow><mo rspace=\"4.2pt\">,</mo><mrow><mrow><mo stretchy=\"false\">(</mo><mi>b</mi><mo>,</mo><msub><mi>a</mi><mn>2</mn></msub><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msub><mi>a</mi><mi>n</mi></msub><mo stretchy=\"false\">)</mo></mrow><mo>\u2208</mo><mi>R</mi></mrow></mrow><mo stretchy=\"false\">}</mo></mrow><mo>,</mo></mrow></math>", "type": "latex"}, {"file": "1601.06450.tex", "nexttext": "\nSince consecutive elements in the first and third row are in $P$, consecutive elements in the second row are in $Q$, and $d_i(P,Q,P) \\subseteq P$, then the obtained sequence is a $P$-walk from $d_i(e_0,e_0,f_0)$ to $d_i(e_0,f_0,f_0) = d_{i+1}(e_0,e_0,f_0)$.\nBy concatenating these walks we obtain a $P$-walk from $d_0(e_0,e_0,f_0) = e_0 \\in G$ to $d_n(e_0,f_0,f_0) = f_0 \\in H$, as required.\n\\end{proof}\n\n\\subsection{A loop lemma}\n\nThe Loop Lemma (originally from~\\cite{BKN08b}, a simpler proof in~\\cite{BK12}) says that a subuniverse $E \\leq {\\mathbf{{C}}}^2$ intersects the diagonal under some structural assumptions on $E$ and algebraic assumptions on ${\\mathbf{{C}}}$. We will need the following variant. \n\n\n\\begin{lemma} \\label{lem:loop}\nLet ${\\mathbf{{C}}}$ be a finite idempotent algebra, ${\\mathbf{{P}}}, {\\mathbf{{Q}}} \\leq {\\mathbf{{C}}}^2$, $P {\\operatorname{\\trianglelefteq_J}} {\\mathbf{{Q}}}$, $\\Delta_C = \\{(c,c)\\mid c \\in C\\} \\subseteq Q$, and assume that there exists a closed $P$-walk. Then $P$ intersects $\\Delta_C$.  \n\\end{lemma}\n\n\\begin{proof}\nWe proceed by induction on $|C|$. The case $|C|=1$ is trivial. Assume that $|C|>1$. It suffices to find a proper subuniverse $B\\lneqq \\mathbf C$ which contains a closed $P$-walk.\n\nFix some element $p\\in C$ lying in a closed $P$-walk. Let $B_0=\\{p\\}$ and for $j>0$ define inductively $B_j=\\{c\\in C\\mid (\\exists b\\in B_{j-1})\\,(b,c)\\in P\\}$. Note that all the sets $B_j$ are nonempty subuniverses of $\\mathbf C$. The proof splits into two cases:\n\nFirst, suppose that there exists $k>0$ such that $B_k=C$. Choose minimal such $k$ and set $B=B_{k-1}$. Since $B=B_{k-1}$ is contained in $B_k$, it follows that for every $b\\in B$ there exists $c\\in B$ such that $(c,b)\\in P$. Consequently, by finiteness of $B$, $B$ must contain a closed $P$-walk. Note that $B\\neq C$ follows from the minimality of $k$.\n\nSecond, assume that $B_j\\neq C$ for all $j\\geq 0$. Since there are only finitely many subsets of $C$, there must exist $k<l$ such that $B_k=B_l$. Fix such $k<l$ and define $B=B_k=B_l$. For every $c\\in B$ there exists $b\\in B$ and a closed $P$-walk of length $(l-k)$ from $b$ to $c$. Since $B$ is finite, it follows that there exist $b_0\\in B$ and a closed $P$-walk $(b_0,b_1,\\dots,b_{m-1},b_0)\\in C^{m+1}$ whose length $m$ is a multiple of $(l-k)$. \n\nWe will show that, in fact, all elements of this walk lie in $B$. Choose $j\\in\\{1,\\dots,m-1\\}$. Similarly as in the proof of Lemma \\ref{lem:walk}, we apply a J\\'onsson absorption chain $d_0, \\dots, d_n$ witnessing $P {\\operatorname{\\trianglelefteq_J}} {\\mathbf{{Q}}}$ to all columns of the following matrix:\n\n", "itemtype": "equation", "pos": 13293, "prevtext": "\nwe get a $B$-essential subuniverse of ${\\mathbf{{A}}}^{n-1}$.  \nTherefore, the set of arities of $B$-essential subpowers of an algebra is a downset in $(\\mathbb{N},\\leq)$.\n\n\\begin{proposition}[{\\cite[Proposition 16]{BKazda}}] \\label{prop:essential}\nLet ${\\mathbf{{A}}}$ be a finite idempotent algebra and $B \\leq {\\mathbf{{A}}}$. Then $B {\\operatorname{\\trianglelefteq}} {\\mathbf{{A}}}$ by an $n$-ary term if and only if ${\\mathbf{{A}}}$ has no $n$-ary $B$-essential subpower. \n\\end{proposition}\n\nNote that using Proposition~\\ref{prop:essential} we can define an absorbing subuniverse of ${\\mathop{\\mathrm{Pol}}}{\\mathbb{{A}}}$ in a purely relational way: a set $B \\subseteq A$ is an absorbing subuniverse of ${\\mathop{\\mathrm{Pol}}}{\\mathbb{{A}}}$ if and only if $B$ is pp-definable from ${\\mathbb{{A}}}$ and no $B$-essential relation is pp-definable from ${\\mathbb{{A}}}$. A relational description of J\\'onsson absorption can be obtained from Theorem~\\ref{thm:jabs_local}.\n\n\n\\subsection{A connectivity lemma}\n\nAbsorption is used to absorb connectivity properties of subpowers. A technical lemma of this sort will be used in the final stage of the proof of Theorem~\\ref{thm:main}.\n\n\\begin{lemma} \\label{lem:walk}\nLet ${\\mathbf{{A}}}$ be a finite algebra, $G$, $H$ subsets of $A$, and $P$, $Q$ subuniverses of ${\\mathbf{{A}}}^2$ such that\n\\begin{itemize}\n\\item[(i)] $P {\\operatorname{\\trianglelefteq_J}} {\\mathbf{{Q}}}$,\n\\item[(ii)] $(a,c) \\in Q$ for some $a \\in G$ and $c \\in H$,\n\\item[(iii)] for every $c \\in G$ there exists $a \\in G$ such that $(a,c) \\in P$, and\n\\item[(iv)] for every $a \\in H$ there exists $c \\in H$ such that $(a,c) \\in P$.\n\\end{itemize}\nThen there exists a directed $P$-walk from an element in $G$ to an element in $H$.\n\\end{lemma}\n\n\\begin{proof}\nLet $d_0, \\dots, d_n$ be a J\\'onsson absorption chain witnessing $P {\\operatorname{\\trianglelefteq_J}} {\\mathbf{{Q}}}$.\nLet $a \\in G$, $c \\in H$ be such that $(a,c) \\in Q$. By (iii), there exists a directed $P$-walk to $a$ consisting of elements in $G$ of arbitrary length. Since $A$ is finite, it follows that there exists a $P$-walk to $a$ from an element in a closed $P$-walk and both walks lie entirely in $G$. Similarly, from (iv) it follows that there exists a directed $P$-walk from $c$ to an element in a closed $P$-walk, both walks being in $H$. Choosing appropriate elements in the two closed $P$-walks and large enough $k$ divisible by the lengths of the closed $P$-walks, we get closed $P$-walks\n$(e_0, e_1, \\dots, e_k=e_0) \\in G^{k+1}$, $(f_0, f_1, \\dots, f_k=f_0)\\in G^{k+1}$ and a $Q$-walk $(e_0=g_0,g_1, \\dots, g_k = f_0)\\in A^{k+1}$.\n\nNow for each $i\\leq n$ we apply the $i$-th term $d_i$ to the columns of the following matrix.\n", "index": 13, "text": "\n\\[\n\\begin{array}{llll}\ne_0 \t\t\t& e_1 & \\dots & e_k = e_0 \\\\\ne_0 = g_0 & g_1 & \\dots & g_k = f_0 \\\\\nf_0 \t\t\t& f_1 & \\dots & f_k = f_0\n\\end{array}\n\\]\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex9.m1\" class=\"ltx_Math\" alttext=\"\\begin{array}[]{llll}e_{0}&amp;e_{1}&amp;\\dots&amp;e_{k}=e_{0}\\\\&#10;e_{0}=g_{0}&amp;g_{1}&amp;\\dots&amp;g_{k}=f_{0}\\\\&#10;f_{0}&amp;f_{1}&amp;\\dots&amp;f_{k}=f_{0}\\end{array}\" display=\"block\"><mtable columnspacing=\"5pt\" displaystyle=\"true\" rowspacing=\"0pt\"><mtr><mtd columnalign=\"left\"><msub><mi>e</mi><mn>0</mn></msub></mtd><mtd columnalign=\"left\"><msub><mi>e</mi><mn>1</mn></msub></mtd><mtd columnalign=\"left\"><mi mathvariant=\"normal\">\u2026</mi></mtd><mtd columnalign=\"left\"><mrow><msub><mi>e</mi><mi>k</mi></msub><mo>=</mo><msub><mi>e</mi><mn>0</mn></msub></mrow></mtd></mtr><mtr><mtd columnalign=\"left\"><mrow><msub><mi>e</mi><mn>0</mn></msub><mo>=</mo><msub><mi>g</mi><mn>0</mn></msub></mrow></mtd><mtd columnalign=\"left\"><msub><mi>g</mi><mn>1</mn></msub></mtd><mtd columnalign=\"left\"><mi mathvariant=\"normal\">\u2026</mi></mtd><mtd columnalign=\"left\"><mrow><msub><mi>g</mi><mi>k</mi></msub><mo>=</mo><msub><mi>f</mi><mn>0</mn></msub></mrow></mtd></mtr><mtr><mtd columnalign=\"left\"><msub><mi>f</mi><mn>0</mn></msub></mtd><mtd columnalign=\"left\"><msub><mi>f</mi><mn>1</mn></msub></mtd><mtd columnalign=\"left\"><mi mathvariant=\"normal\">\u2026</mi></mtd><mtd columnalign=\"left\"><mrow><msub><mi>f</mi><mi>k</mi></msub><mo>=</mo><msub><mi>f</mi><mn>0</mn></msub></mrow></mtd></mtr></mtable></math>", "type": "latex"}, {"file": "1601.06450.tex", "nexttext": "\nThe first and third rows are $P$-walks while the second row is a $Q$-walk (here we use that both $P\\subseteq Q$ and $\\Delta_C\\subseteq Q$). The obtained sequence is a $P$-walk from $d_i(b_0,b_0,b_j)$ to $d_i(b_0,b_j,b_j) = d_{i+1}(b_0,b_0,b_j)$. By concatenating these walks we obtain a $P$-walk from $b_0=d_0(b_0,b_0,b_j)$ to $b_j=d_n(b_0,b_j,b_j)$ whose length is a multiple of $(l-k)$. As $b_0\\in B=B_k$, this shows that $b_j\\in B_l=B$ which concludes the proof.\n\\end{proof}\n\n\n\\section{Proof of the main result} \\label{sec:proof}\n\nIn this section we prove the main result, Theorem~\\ref{thm:main}.\n\nLet ${\\mathbb{{A}}}$ be a finite relational structure with finite signature, ${\\mathbf{{A}}} = {\\mathop{\\mathrm{Pol}}} {\\mathbb{{A}}}$, and let $B$ be a subuniverse of ${\\mathbf{{A}}}$. \nWe aim to show that $B {\\operatorname{\\trianglelefteq}} {\\mathbf{{A}}}$ if and only if $B {\\operatorname{\\trianglelefteq_J}} {\\mathbf{{A}}}$. \n\nThe left-to-right implication is simple: if $t$ is an $n$-ary absorption term witnessing $B {\\operatorname{\\trianglelefteq}} {\\mathbf{{A}}}$ then the sequence\n$d_0, \\dots, d_n$ defined by\n", "itemtype": "equation", "pos": 16062, "prevtext": "\nSince consecutive elements in the first and third row are in $P$, consecutive elements in the second row are in $Q$, and $d_i(P,Q,P) \\subseteq P$, then the obtained sequence is a $P$-walk from $d_i(e_0,e_0,f_0)$ to $d_i(e_0,f_0,f_0) = d_{i+1}(e_0,e_0,f_0)$.\nBy concatenating these walks we obtain a $P$-walk from $d_0(e_0,e_0,f_0) = e_0 \\in G$ to $d_n(e_0,f_0,f_0) = f_0 \\in H$, as required.\n\\end{proof}\n\n\\subsection{A loop lemma}\n\nThe Loop Lemma (originally from~\\cite{BKN08b}, a simpler proof in~\\cite{BK12}) says that a subuniverse $E \\leq {\\mathbf{{C}}}^2$ intersects the diagonal under some structural assumptions on $E$ and algebraic assumptions on ${\\mathbf{{C}}}$. We will need the following variant. \n\n\n\\begin{lemma} \\label{lem:loop}\nLet ${\\mathbf{{C}}}$ be a finite idempotent algebra, ${\\mathbf{{P}}}, {\\mathbf{{Q}}} \\leq {\\mathbf{{C}}}^2$, $P {\\operatorname{\\trianglelefteq_J}} {\\mathbf{{Q}}}$, $\\Delta_C = \\{(c,c)\\mid c \\in C\\} \\subseteq Q$, and assume that there exists a closed $P$-walk. Then $P$ intersects $\\Delta_C$.  \n\\end{lemma}\n\n\\begin{proof}\nWe proceed by induction on $|C|$. The case $|C|=1$ is trivial. Assume that $|C|>1$. It suffices to find a proper subuniverse $B\\lneqq \\mathbf C$ which contains a closed $P$-walk.\n\nFix some element $p\\in C$ lying in a closed $P$-walk. Let $B_0=\\{p\\}$ and for $j>0$ define inductively $B_j=\\{c\\in C\\mid (\\exists b\\in B_{j-1})\\,(b,c)\\in P\\}$. Note that all the sets $B_j$ are nonempty subuniverses of $\\mathbf C$. The proof splits into two cases:\n\nFirst, suppose that there exists $k>0$ such that $B_k=C$. Choose minimal such $k$ and set $B=B_{k-1}$. Since $B=B_{k-1}$ is contained in $B_k$, it follows that for every $b\\in B$ there exists $c\\in B$ such that $(c,b)\\in P$. Consequently, by finiteness of $B$, $B$ must contain a closed $P$-walk. Note that $B\\neq C$ follows from the minimality of $k$.\n\nSecond, assume that $B_j\\neq C$ for all $j\\geq 0$. Since there are only finitely many subsets of $C$, there must exist $k<l$ such that $B_k=B_l$. Fix such $k<l$ and define $B=B_k=B_l$. For every $c\\in B$ there exists $b\\in B$ and a closed $P$-walk of length $(l-k)$ from $b$ to $c$. Since $B$ is finite, it follows that there exist $b_0\\in B$ and a closed $P$-walk $(b_0,b_1,\\dots,b_{m-1},b_0)\\in C^{m+1}$ whose length $m$ is a multiple of $(l-k)$. \n\nWe will show that, in fact, all elements of this walk lie in $B$. Choose $j\\in\\{1,\\dots,m-1\\}$. Similarly as in the proof of Lemma \\ref{lem:walk}, we apply a J\\'onsson absorption chain $d_0, \\dots, d_n$ witnessing $P {\\operatorname{\\trianglelefteq_J}} {\\mathbf{{Q}}}$ to all columns of the following matrix:\n\n", "index": 15, "text": "\n\\[\n\\begin{array}{lllllllll}\nb_0 & b_1 & \\dots & b_{j-1} & b_j & b_{j+1} & \\dots & b_{m-1} & b_0\\\\\nb_0 & b_1 & \\dots & b_{j-1} & b_j & b_j & \\dots & b_j & b_j\\\\\nb_j & b_{j+1} & \\dots & \\dots & \\dots & \\dots & \\dots & b_{j-1} & b_j\n\\end{array}\n\\]\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex10.m1\" class=\"ltx_Math\" alttext=\"\\begin{array}[]{lllllllll}b_{0}&amp;b_{1}&amp;\\dots&amp;b_{j-1}&amp;b_{j}&amp;b_{j+1}&amp;\\dots&amp;b_{m-1%&#10;}&amp;b_{0}\\\\&#10;b_{0}&amp;b_{1}&amp;\\dots&amp;b_{j-1}&amp;b_{j}&amp;b_{j}&amp;\\dots&amp;b_{j}&amp;b_{j}\\\\&#10;b_{j}&amp;b_{j+1}&amp;\\dots&amp;\\dots&amp;\\dots&amp;\\dots&amp;\\dots&amp;b_{j-1}&amp;b_{j}\\end{array}\" display=\"block\"><mtable columnspacing=\"5pt\" displaystyle=\"true\" rowspacing=\"0pt\"><mtr><mtd columnalign=\"left\"><msub><mi>b</mi><mn>0</mn></msub></mtd><mtd columnalign=\"left\"><msub><mi>b</mi><mn>1</mn></msub></mtd><mtd columnalign=\"left\"><mi mathvariant=\"normal\">\u2026</mi></mtd><mtd columnalign=\"left\"><msub><mi>b</mi><mrow><mi>j</mi><mo>-</mo><mn>1</mn></mrow></msub></mtd><mtd columnalign=\"left\"><msub><mi>b</mi><mi>j</mi></msub></mtd><mtd columnalign=\"left\"><msub><mi>b</mi><mrow><mi>j</mi><mo>+</mo><mn>1</mn></mrow></msub></mtd><mtd columnalign=\"left\"><mi mathvariant=\"normal\">\u2026</mi></mtd><mtd columnalign=\"left\"><msub><mi>b</mi><mrow><mi>m</mi><mo>-</mo><mn>1</mn></mrow></msub></mtd><mtd columnalign=\"left\"><msub><mi>b</mi><mn>0</mn></msub></mtd></mtr><mtr><mtd columnalign=\"left\"><msub><mi>b</mi><mn>0</mn></msub></mtd><mtd columnalign=\"left\"><msub><mi>b</mi><mn>1</mn></msub></mtd><mtd columnalign=\"left\"><mi mathvariant=\"normal\">\u2026</mi></mtd><mtd columnalign=\"left\"><msub><mi>b</mi><mrow><mi>j</mi><mo>-</mo><mn>1</mn></mrow></msub></mtd><mtd columnalign=\"left\"><msub><mi>b</mi><mi>j</mi></msub></mtd><mtd columnalign=\"left\"><msub><mi>b</mi><mi>j</mi></msub></mtd><mtd columnalign=\"left\"><mi mathvariant=\"normal\">\u2026</mi></mtd><mtd columnalign=\"left\"><msub><mi>b</mi><mi>j</mi></msub></mtd><mtd columnalign=\"left\"><msub><mi>b</mi><mi>j</mi></msub></mtd></mtr><mtr><mtd columnalign=\"left\"><msub><mi>b</mi><mi>j</mi></msub></mtd><mtd columnalign=\"left\"><msub><mi>b</mi><mrow><mi>j</mi><mo>+</mo><mn>1</mn></mrow></msub></mtd><mtd columnalign=\"left\"><mi mathvariant=\"normal\">\u2026</mi></mtd><mtd columnalign=\"left\"><mi mathvariant=\"normal\">\u2026</mi></mtd><mtd columnalign=\"left\"><mi mathvariant=\"normal\">\u2026</mi></mtd><mtd columnalign=\"left\"><mi mathvariant=\"normal\">\u2026</mi></mtd><mtd columnalign=\"left\"><mi mathvariant=\"normal\">\u2026</mi></mtd><mtd columnalign=\"left\"><msub><mi>b</mi><mrow><mi>j</mi><mo>-</mo><mn>1</mn></mrow></msub></mtd><mtd columnalign=\"left\"><msub><mi>b</mi><mi>j</mi></msub></mtd></mtr></mtable></math>", "type": "latex"}, {"file": "1601.06450.tex", "nexttext": "\nis a J\\'onsson absorption chain witnessing $B {\\operatorname{\\trianglelefteq_J}} {\\mathbf{{A}}}$. \n\nAssume now that $B {\\operatorname{\\trianglelefteq_J}} {\\mathbf{{A}}}$. Since J\\'onsson absorption terms are idempotent, we can assume that ${\\mathbb{{A}}}$ contains all the singleton unary relations and ${\\mathbf{{A}}}$ is thus an idempotent algebra.\n We aim to show that $B {\\operatorname{\\trianglelefteq}} {\\mathbf{{A}}}$. In fact, we will prove the following refinement.\n\n\\begin{theorem} \\label{thm:core}\nLet ${\\mathbb{{A}}}$ be a finite relational structure which contains all the singleton unary relations and whose relations all have arity at most $\\theta$ (where $\\theta\\geq 2$). Assume that $B$ is a J\\'onsson absorbing subuniverse of ${\\mathbf{{A}}} = {\\mathop{\\mathrm{Pol}}} {\\mathbb{{A}}}$. Then $B {\\operatorname{\\trianglelefteq}} {\\mathbf{{A}}}$ via a term of arity at most $\\kappa=\\frac{1}{2}(2\\theta-2)^{3^{|A|}}+1$.\n\\end{theorem}\n\nAssume the contrary. By Proposition~\\ref{prop:essential}, ${\\mathbf{{A}}}$ has a $B$-essential subpower $U$ of arity $\\kappa$. Since $U$ is a subpower of ${\\mathbf{{A}}}$, it can be pp-defined from ${\\mathbb{{A}}}$. The overall structure of the proof is as follows.\n\n\\begin{itemize}\n\\item We introduce some simplifying assumptions on $\\mathbb A$ and the structure of the pp-formula defining $U$ (Subsection \\ref{subsec:preproc}). These assumptions will be applied throughout our proof.\n\\item Then we use Zhuk's technique from~\\cite{Zhuk14}. By a repeated application of the construction described in Subsection \\ref{subsec:surgery} we modify the formula  to obtain a tree formula defining a (possibly different) $B$-essential subpower of the same arity $\\kappa$.\n\\item In Subsection \\ref{subsec:comb} we use the tree formula to obtain a structurally very simple pp-definition (a ``comb'' formula) of a $B$-essential subpower of a smaller, but still large arity $\\lambda$ (where $\\lambda$ corresponds to the length of a maximal path in the tree formula; roughly a logarithm of $\\kappa$).\n\\item This simple pp-definition is then used to obtain a pair of subalgebras ${\\mathbf{{P}}} {\\operatorname{\\trianglelefteq_J}} {\\mathbf{{Q}}}$ of ${\\mathbf{{A}}}^2$ that will contradict Lemma~\\ref{lem:loop} (Subsection \\ref{subsec:contradiction}).\n\n\\end{itemize}\n\n\n\\subsection{Preprocessing}\\label{subsec:preproc}\nDuring the construction, some relations in pp-formulas are replaced by subpowers of ${\\mathbf{{A}}}$ (of arity at most $\\theta$) which are not necessarily in ${\\mathbb{{A}}}$. For this technical reason, we assume that each relation of arity at most $\\theta$ which is pp-definable from ${\\mathbb{{A}}}$ is already in ${\\mathbb{{A}}}$. Note that we can safely make this assumption since adding pp-definable relations does not change the algebra of polymorphisms ${\\mathbf{{A}}}$.\n\nUsing the above assumption we can modify the formula defining $U$ so that it satisfies the following properties. \nThe resulting formula will be called a \\emph{simplified form} of the original formula.\n\\begin{enumerate}[(1)]\n\\item The formula is connected.\n\\item The set of free variables is equal to the set of leaves.\n\\item All bound variables have degree 2 or 3.\n\\item All scopes of constraints are non-repeating sequences of variables.\n\\item There are no unary constraints.\n\\end{enumerate}\nFor item (1) note that if there were two free variables in different connected components, then the resulting relation $U$ would be a product of two relations of smaller arities. This cannot be the case for a $B$-essential relation. Components containing only bound variables are trivial and can be omitted. Items (2)-(5) can be achieved by a combination of introducing new variables and replacing relations by other, pp-definable relations. See \\cite{Bvaleriote} for a detailed description of a similar simplification process in the case $\\theta=2$. \n \nLet us remark here that with some weakening of the upper bound on $\\kappa$ one could make a further simplifying assumption: namely that $\\theta=2$ (this is done in \\cite{Bar13,Bvaleriote,Bulin14} as well as in our illustrative figures) and even that ${\\mathbb{{A}}}$ contains a single binary relation (see \\cite[Section 7]{Bulin14} for details). However, here we choose to present the proof without these reductions.\n\n\n\n\n\\subsection{Zhuk's surgery}\\label{subsec:surgery}\n\nRecall that $U \\leq {\\mathbf{{A}}}^{\\kappa}$ is a $B$-essential relation. \nWe take a simplified form of a pp-formula defining $U$ from ${\\mathbb{{A}}}$. We denote by $\\Phi$ the quantifier-free part of this formula, and denote $x_1, \\dots, x_{\\kappa}$ the free variables. For an arbitrary sequence $y_1, \\dots, y_m$ of variables in $\\Phi$, we denote $\\Phi(y_1,\\dots,y_m)$ both the formula obtained by existentially quantifying over the remaining variables, and the $m$-ary relation defined by this formula. In particular, we have $U = \\Phi(x_1, \\dots, x_\\kappa)$.\n\n\nWe describe a construction which transforms $\\Phi$ into a new quantifier-free pp-formula $\\Phi'$ such that $\\Phi'(x_1, \\dots, x_{\\kappa})$ is still a $B$-essential relation of arity $\\kappa$, possibly different from $U = \\Phi(x_1, \\dots, x_{\\kappa})$. \n\nThe construction depends on a variable $y \\not\\in \\{x_1, \\dots, x_{\\kappa}\\}$ and a constraint in $\\Phi$ whose scope contains $y$, say $T(\\dots, y, \\dots)$. \n \nThe construction is divided into three steps.\nIn the first step, we build from $\\Phi$ a new formula $\\Psi$ by \nadding a new variable $y_*$, removing the \nconstraint $T(\\dots, y, \\dots)$, adding the constraint $T(\\dots, y_*, \\dots)$, and adding the unary constraints $C(y)$ and $C(y_*)$, where $C = \\Phi(y)$. Figure~\\ref{fig:first_step} depicts this modification in the case that our constraint is binary, of the form $T(y,z)$.  \n\n\n\\begin{figure}[ht]{   \\centering   \\begin{subfigure}{.5\\textwidth}   \\centering   \\begin{tikzpicture}      \\filldraw[fill=gray!20,draw=black] (1.6,4) -- (1.6,1) -- (4.4,1) -- (4.4,2.5) .. controls (2.8, 2.4) .. (1.6,4); \t\t \\draw (4.4,2.5) node[krouzek] {$z$} -- (1.6,4) node[krouzek] {$y$} node[midway, above=0pt] {$T$}; \t\t \\draw (2,1) -- (2,0) node[krouzek] {$x_1$}; \t\t \\draw (3,1) -- (3,0) node[krouzek] {$x_2$}; \t\t \\draw (4,1) -- (4,0) node[krouzek] {$x_3$};   \\end{tikzpicture} \t\\caption{Original formula $\\Phi$.} \t\\end{subfigure} \t\\begin{subfigure}{.5\\textwidth} \t\\centering   \\begin{tikzpicture}      \\filldraw[fill=gray!20,draw=black] (1.6,4) -- (1.6,1) -- (4.4,1) -- (4.4,2.5) .. controls (2.8, 2.4) .. (1.6,4) node[krouzek] {$y$} node[right=6pt] {$C$}; \t\t \\draw (4.4,2.5) node[krouzek] {$z$} -- (5.5,4) node[krouzek] {$y_{*}$} node[midway, above left=-3pt] {$T$} node[right=8pt] {$C$}; \t\t \\draw (2,1) -- (2,0) node[krouzek] {$x_1$} node[above left=3pt] {};  \t\t \\draw (3,1) -- (3,0) node[krouzek] {$x_2$} node[above left=3pt] {};  \t\t \\draw (4,1) -- (4,0) node[krouzek] {$x_3$} node[above left=3pt] {};    \\end{tikzpicture} \t\\caption{Resulting formula $\\Psi$.} \t\\end{subfigure}   \\caption{The first step for $\\kappa=3$.}   \\label{fig:first_step} }\\end{figure}\n\nIn the second step, we define a new formula $\\Theta$ as follows. For each $i \\in [l]$, where $l = |A|$, we take a copy $\\Psi^i$ of the formula $\\Psi$ by renaming each variable $w$ in $\\Psi$ to $w^i$. Then we take the conjunction of $\\Psi^1$, \\dots, $\\Psi^l$ and identify variables $y^i_*$ and $y^{i+1}$ for each $i<l$.\n\nThe resulting formula is shown in Figure~\\ref{fig:second_step}.\n\n\\begin{figure}[ht]{      \\begin{center}     \\begin{tikzpicture}      \\filldraw[fill=gray!20,draw=black] (1.6,4) -- (1.6,1) -- (4.4,1) -- (4.4,2.5) .. controls (2.8, 2.4) .. (1.6,4) node[krouzek] {$y^1$} node[right=8pt] {$C$}; \t\t \\draw (4.4,2.5) node[krouzek] {$z^1$} -- (5.5,4) node[midway, left=1pt] {$T$}; \t\t \\draw (2,1) -- (2,0) node[krouzek] {$x_1^1$} node[above left=4pt] {};  \t\t \\draw (3,1) -- (3,0) node[krouzek] {$x_2^1$} node[above left=4pt] {};  \t\t \\draw (4,1) -- (4,0) node[krouzek] {$x_3^1$} node[above left=4pt] {};       \\filldraw[fill=gray!20,draw=black] (1.6+3.9,4)  -- (1.6+3.9,1) -- (4.4+3.9,1) -- (4.4+3.9,2.5) .. controls (2.8+3.9, 2.4) .. (1.6+3.9,4) node[krouzek] {$y^1_*=y^2$} node[right=22pt] {$C$}; \t\t \\draw (4.4+3.9,2.5) node[krouzek] {$z^2$} -- (5.5+3.9,4)  node[midway, left=1pt] {$T$}; \t\t \\draw (2+3.9,1) -- (2+3.9,0) node[krouzek] {$x_1^2$} node[above left=4pt] {};  \t\t \\draw (3+3.9,1) -- (3+3.9,0) node[krouzek] {$x_2^2$} node[above left=4pt] {};  \t\t \\draw (4+3.9,1) -- (4+3.9,0) node[krouzek] {$x_3^2$} node[above left=4pt] {};  \t\t\\filldraw[fill=gray!20,draw=black] (1.6+7.8,4)  -- (1.6+7.8,1) -- (4.4+7.8,1) -- (4.4+7.8,2.5) .. controls (2.8+7.8, 2.4) .. (1.6+7.8,4) node[krouzek] {$y^2_*=y^3$} node[right=22pt] {$C$}; \t\t \\draw (4.4+7.8,2.5) node[krouzek] {$z^3$} -- (5.5+7.8,4) node[krouzek] {$y_{*}^3$} node[midway, left=1pt] {$T$} node[left=7pt] {$C$}; \t\t \\draw (2+7.8,1) -- (2+7.8,0) node[krouzek] {$x_1^3$} node[above left=4pt] {};  \t\t \\draw (3+7.8,1) -- (3+7.8,0) node[krouzek] {$x_2^3$} node[above left=4pt] {};  \t\t \\draw (4+7.8,1) -- (4+7.8,0) node[krouzek] {$x_3^3$} node[above left=4pt] {};    \\end{tikzpicture}   \\end{center}   \\caption{The second step: formula $\\Theta$ for $l=\\kappa=3$}   \\label{fig:second_step} }\\end{figure}\n\nBefore describing the third step, \nwe show that the relation\n\n", "itemtype": "equation", "pos": 17427, "prevtext": "\nThe first and third rows are $P$-walks while the second row is a $Q$-walk (here we use that both $P\\subseteq Q$ and $\\Delta_C\\subseteq Q$). The obtained sequence is a $P$-walk from $d_i(b_0,b_0,b_j)$ to $d_i(b_0,b_j,b_j) = d_{i+1}(b_0,b_0,b_j)$. By concatenating these walks we obtain a $P$-walk from $b_0=d_0(b_0,b_0,b_j)$ to $b_j=d_n(b_0,b_j,b_j)$ whose length is a multiple of $(l-k)$. As $b_0\\in B=B_k$, this shows that $b_j\\in B_l=B$ which concludes the proof.\n\\end{proof}\n\n\n\\section{Proof of the main result} \\label{sec:proof}\n\nIn this section we prove the main result, Theorem~\\ref{thm:main}.\n\nLet ${\\mathbb{{A}}}$ be a finite relational structure with finite signature, ${\\mathbf{{A}}} = {\\mathop{\\mathrm{Pol}}} {\\mathbb{{A}}}$, and let $B$ be a subuniverse of ${\\mathbf{{A}}}$. \nWe aim to show that $B {\\operatorname{\\trianglelefteq}} {\\mathbf{{A}}}$ if and only if $B {\\operatorname{\\trianglelefteq_J}} {\\mathbf{{A}}}$. \n\nThe left-to-right implication is simple: if $t$ is an $n$-ary absorption term witnessing $B {\\operatorname{\\trianglelefteq}} {\\mathbf{{A}}}$ then the sequence\n$d_0, \\dots, d_n$ defined by\n", "index": 17, "text": "\n\\[\nd_i(x,y,z) = t(\\underbrace{z, \\dots, z}_{i \\times}, y, x, \\dots, x)\n\\]\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex11.m1\" class=\"ltx_Math\" alttext=\"d_{i}(x,y,z)=t(\\underbrace{z,\\dots,z}_{i\\times},y,x,\\dots,x)\" display=\"block\"><mrow><mrow><msub><mi>d</mi><mi>i</mi></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>z</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mrow><mi>t</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><munder><munder accentunder=\"true\"><mrow><mi>z</mi><mo movablelimits=\"false\">,</mo><mi mathvariant=\"normal\">\u2026</mi><mo movablelimits=\"false\">,</mo><mi>z</mi></mrow><mo movablelimits=\"false\">\u23df</mo></munder><mrow><mi>i</mi><mo>\u2063</mo><mo>\u00d7</mo></mrow></munder><mo>,</mo><mi>y</mi><mo>,</mo><mi>x</mi><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow></mrow></mrow></math>", "type": "latex"}, {"file": "1601.06450.tex", "nexttext": "\nis ``block-wise $B$-essential'':\n\n\\begin{lemma} \\label{lem:step_two}\nThe relation $V$ does not intersect $B^{l\\kappa}$ but, for every $i \\in [\\kappa]$, $V \\cap (B^{l(i-1)} \\times A^{l} \\times B^{l(\\kappa-i)}) \\neq \\emptyset$.\n\\end{lemma}\n\n\n\n\n\n\n\\begin{proof}\nBy construction, the tuple \n", "itemtype": "equation", "pos": 26747, "prevtext": "\nis a J\\'onsson absorption chain witnessing $B {\\operatorname{\\trianglelefteq_J}} {\\mathbf{{A}}}$. \n\nAssume now that $B {\\operatorname{\\trianglelefteq_J}} {\\mathbf{{A}}}$. Since J\\'onsson absorption terms are idempotent, we can assume that ${\\mathbb{{A}}}$ contains all the singleton unary relations and ${\\mathbf{{A}}}$ is thus an idempotent algebra.\n We aim to show that $B {\\operatorname{\\trianglelefteq}} {\\mathbf{{A}}}$. In fact, we will prove the following refinement.\n\n\\begin{theorem} \\label{thm:core}\nLet ${\\mathbb{{A}}}$ be a finite relational structure which contains all the singleton unary relations and whose relations all have arity at most $\\theta$ (where $\\theta\\geq 2$). Assume that $B$ is a J\\'onsson absorbing subuniverse of ${\\mathbf{{A}}} = {\\mathop{\\mathrm{Pol}}} {\\mathbb{{A}}}$. Then $B {\\operatorname{\\trianglelefteq}} {\\mathbf{{A}}}$ via a term of arity at most $\\kappa=\\frac{1}{2}(2\\theta-2)^{3^{|A|}}+1$.\n\\end{theorem}\n\nAssume the contrary. By Proposition~\\ref{prop:essential}, ${\\mathbf{{A}}}$ has a $B$-essential subpower $U$ of arity $\\kappa$. Since $U$ is a subpower of ${\\mathbf{{A}}}$, it can be pp-defined from ${\\mathbb{{A}}}$. The overall structure of the proof is as follows.\n\n\\begin{itemize}\n\\item We introduce some simplifying assumptions on $\\mathbb A$ and the structure of the pp-formula defining $U$ (Subsection \\ref{subsec:preproc}). These assumptions will be applied throughout our proof.\n\\item Then we use Zhuk's technique from~\\cite{Zhuk14}. By a repeated application of the construction described in Subsection \\ref{subsec:surgery} we modify the formula  to obtain a tree formula defining a (possibly different) $B$-essential subpower of the same arity $\\kappa$.\n\\item In Subsection \\ref{subsec:comb} we use the tree formula to obtain a structurally very simple pp-definition (a ``comb'' formula) of a $B$-essential subpower of a smaller, but still large arity $\\lambda$ (where $\\lambda$ corresponds to the length of a maximal path in the tree formula; roughly a logarithm of $\\kappa$).\n\\item This simple pp-definition is then used to obtain a pair of subalgebras ${\\mathbf{{P}}} {\\operatorname{\\trianglelefteq_J}} {\\mathbf{{Q}}}$ of ${\\mathbf{{A}}}^2$ that will contradict Lemma~\\ref{lem:loop} (Subsection \\ref{subsec:contradiction}).\n\n\\end{itemize}\n\n\n\\subsection{Preprocessing}\\label{subsec:preproc}\nDuring the construction, some relations in pp-formulas are replaced by subpowers of ${\\mathbf{{A}}}$ (of arity at most $\\theta$) which are not necessarily in ${\\mathbb{{A}}}$. For this technical reason, we assume that each relation of arity at most $\\theta$ which is pp-definable from ${\\mathbb{{A}}}$ is already in ${\\mathbb{{A}}}$. Note that we can safely make this assumption since adding pp-definable relations does not change the algebra of polymorphisms ${\\mathbf{{A}}}$.\n\nUsing the above assumption we can modify the formula defining $U$ so that it satisfies the following properties. \nThe resulting formula will be called a \\emph{simplified form} of the original formula.\n\\begin{enumerate}[(1)]\n\\item The formula is connected.\n\\item The set of free variables is equal to the set of leaves.\n\\item All bound variables have degree 2 or 3.\n\\item All scopes of constraints are non-repeating sequences of variables.\n\\item There are no unary constraints.\n\\end{enumerate}\nFor item (1) note that if there were two free variables in different connected components, then the resulting relation $U$ would be a product of two relations of smaller arities. This cannot be the case for a $B$-essential relation. Components containing only bound variables are trivial and can be omitted. Items (2)-(5) can be achieved by a combination of introducing new variables and replacing relations by other, pp-definable relations. See \\cite{Bvaleriote} for a detailed description of a similar simplification process in the case $\\theta=2$. \n \nLet us remark here that with some weakening of the upper bound on $\\kappa$ one could make a further simplifying assumption: namely that $\\theta=2$ (this is done in \\cite{Bar13,Bvaleriote,Bulin14} as well as in our illustrative figures) and even that ${\\mathbb{{A}}}$ contains a single binary relation (see \\cite[Section 7]{Bulin14} for details). However, here we choose to present the proof without these reductions.\n\n\n\n\n\\subsection{Zhuk's surgery}\\label{subsec:surgery}\n\nRecall that $U \\leq {\\mathbf{{A}}}^{\\kappa}$ is a $B$-essential relation. \nWe take a simplified form of a pp-formula defining $U$ from ${\\mathbb{{A}}}$. We denote by $\\Phi$ the quantifier-free part of this formula, and denote $x_1, \\dots, x_{\\kappa}$ the free variables. For an arbitrary sequence $y_1, \\dots, y_m$ of variables in $\\Phi$, we denote $\\Phi(y_1,\\dots,y_m)$ both the formula obtained by existentially quantifying over the remaining variables, and the $m$-ary relation defined by this formula. In particular, we have $U = \\Phi(x_1, \\dots, x_\\kappa)$.\n\n\nWe describe a construction which transforms $\\Phi$ into a new quantifier-free pp-formula $\\Phi'$ such that $\\Phi'(x_1, \\dots, x_{\\kappa})$ is still a $B$-essential relation of arity $\\kappa$, possibly different from $U = \\Phi(x_1, \\dots, x_{\\kappa})$. \n\nThe construction depends on a variable $y \\not\\in \\{x_1, \\dots, x_{\\kappa}\\}$ and a constraint in $\\Phi$ whose scope contains $y$, say $T(\\dots, y, \\dots)$. \n \nThe construction is divided into three steps.\nIn the first step, we build from $\\Phi$ a new formula $\\Psi$ by \nadding a new variable $y_*$, removing the \nconstraint $T(\\dots, y, \\dots)$, adding the constraint $T(\\dots, y_*, \\dots)$, and adding the unary constraints $C(y)$ and $C(y_*)$, where $C = \\Phi(y)$. Figure~\\ref{fig:first_step} depicts this modification in the case that our constraint is binary, of the form $T(y,z)$.  \n\n\n\\begin{figure}[ht]{   \\centering   \\begin{subfigure}{.5\\textwidth}   \\centering   \\begin{tikzpicture}      \\filldraw[fill=gray!20,draw=black] (1.6,4) -- (1.6,1) -- (4.4,1) -- (4.4,2.5) .. controls (2.8, 2.4) .. (1.6,4); \t\t \\draw (4.4,2.5) node[krouzek] {$z$} -- (1.6,4) node[krouzek] {$y$} node[midway, above=0pt] {$T$}; \t\t \\draw (2,1) -- (2,0) node[krouzek] {$x_1$}; \t\t \\draw (3,1) -- (3,0) node[krouzek] {$x_2$}; \t\t \\draw (4,1) -- (4,0) node[krouzek] {$x_3$};   \\end{tikzpicture} \t\\caption{Original formula $\\Phi$.} \t\\end{subfigure} \t\\begin{subfigure}{.5\\textwidth} \t\\centering   \\begin{tikzpicture}      \\filldraw[fill=gray!20,draw=black] (1.6,4) -- (1.6,1) -- (4.4,1) -- (4.4,2.5) .. controls (2.8, 2.4) .. (1.6,4) node[krouzek] {$y$} node[right=6pt] {$C$}; \t\t \\draw (4.4,2.5) node[krouzek] {$z$} -- (5.5,4) node[krouzek] {$y_{*}$} node[midway, above left=-3pt] {$T$} node[right=8pt] {$C$}; \t\t \\draw (2,1) -- (2,0) node[krouzek] {$x_1$} node[above left=3pt] {};  \t\t \\draw (3,1) -- (3,0) node[krouzek] {$x_2$} node[above left=3pt] {};  \t\t \\draw (4,1) -- (4,0) node[krouzek] {$x_3$} node[above left=3pt] {};    \\end{tikzpicture} \t\\caption{Resulting formula $\\Psi$.} \t\\end{subfigure}   \\caption{The first step for $\\kappa=3$.}   \\label{fig:first_step} }\\end{figure}\n\nIn the second step, we define a new formula $\\Theta$ as follows. For each $i \\in [l]$, where $l = |A|$, we take a copy $\\Psi^i$ of the formula $\\Psi$ by renaming each variable $w$ in $\\Psi$ to $w^i$. Then we take the conjunction of $\\Psi^1$, \\dots, $\\Psi^l$ and identify variables $y^i_*$ and $y^{i+1}$ for each $i<l$.\n\nThe resulting formula is shown in Figure~\\ref{fig:second_step}.\n\n\\begin{figure}[ht]{      \\begin{center}     \\begin{tikzpicture}      \\filldraw[fill=gray!20,draw=black] (1.6,4) -- (1.6,1) -- (4.4,1) -- (4.4,2.5) .. controls (2.8, 2.4) .. (1.6,4) node[krouzek] {$y^1$} node[right=8pt] {$C$}; \t\t \\draw (4.4,2.5) node[krouzek] {$z^1$} -- (5.5,4) node[midway, left=1pt] {$T$}; \t\t \\draw (2,1) -- (2,0) node[krouzek] {$x_1^1$} node[above left=4pt] {};  \t\t \\draw (3,1) -- (3,0) node[krouzek] {$x_2^1$} node[above left=4pt] {};  \t\t \\draw (4,1) -- (4,0) node[krouzek] {$x_3^1$} node[above left=4pt] {};       \\filldraw[fill=gray!20,draw=black] (1.6+3.9,4)  -- (1.6+3.9,1) -- (4.4+3.9,1) -- (4.4+3.9,2.5) .. controls (2.8+3.9, 2.4) .. (1.6+3.9,4) node[krouzek] {$y^1_*=y^2$} node[right=22pt] {$C$}; \t\t \\draw (4.4+3.9,2.5) node[krouzek] {$z^2$} -- (5.5+3.9,4)  node[midway, left=1pt] {$T$}; \t\t \\draw (2+3.9,1) -- (2+3.9,0) node[krouzek] {$x_1^2$} node[above left=4pt] {};  \t\t \\draw (3+3.9,1) -- (3+3.9,0) node[krouzek] {$x_2^2$} node[above left=4pt] {};  \t\t \\draw (4+3.9,1) -- (4+3.9,0) node[krouzek] {$x_3^2$} node[above left=4pt] {};  \t\t\\filldraw[fill=gray!20,draw=black] (1.6+7.8,4)  -- (1.6+7.8,1) -- (4.4+7.8,1) -- (4.4+7.8,2.5) .. controls (2.8+7.8, 2.4) .. (1.6+7.8,4) node[krouzek] {$y^2_*=y^3$} node[right=22pt] {$C$}; \t\t \\draw (4.4+7.8,2.5) node[krouzek] {$z^3$} -- (5.5+7.8,4) node[krouzek] {$y_{*}^3$} node[midway, left=1pt] {$T$} node[left=7pt] {$C$}; \t\t \\draw (2+7.8,1) -- (2+7.8,0) node[krouzek] {$x_1^3$} node[above left=4pt] {};  \t\t \\draw (3+7.8,1) -- (3+7.8,0) node[krouzek] {$x_2^3$} node[above left=4pt] {};  \t\t \\draw (4+7.8,1) -- (4+7.8,0) node[krouzek] {$x_3^3$} node[above left=4pt] {};    \\end{tikzpicture}   \\end{center}   \\caption{The second step: formula $\\Theta$ for $l=\\kappa=3$}   \\label{fig:second_step} }\\end{figure}\n\nBefore describing the third step, \nwe show that the relation\n\n", "index": 19, "text": "$$\nV = \\Theta(x^1_1, x^2_1, \\dots, x^l_1,x^1_2, \\dots, x^l_2,\\dots,x^1_\\kappa,\\dots, x^l_{\\kappa})\n$$\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex12.m1\" class=\"ltx_Math\" alttext=\"V=\\Theta(x^{1}_{1},x^{2}_{1},\\dots,x^{l}_{1},x^{1}_{2},\\dots,x^{l}_{2},\\dots,x%&#10;^{1}_{\\kappa},\\dots,x^{l}_{\\kappa})\" display=\"block\"><mrow><mi>V</mi><mo>=</mo><mrow><mi mathvariant=\"normal\">\u0398</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msubsup><mi>x</mi><mn>1</mn><mn>1</mn></msubsup><mo>,</mo><msubsup><mi>x</mi><mn>1</mn><mn>2</mn></msubsup><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msubsup><mi>x</mi><mn>1</mn><mi>l</mi></msubsup><mo>,</mo><msubsup><mi>x</mi><mn>2</mn><mn>1</mn></msubsup><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msubsup><mi>x</mi><mn>2</mn><mi>l</mi></msubsup><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msubsup><mi>x</mi><mi>\u03ba</mi><mn>1</mn></msubsup><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msubsup><mi>x</mi><mi>\u03ba</mi><mi>l</mi></msubsup><mo stretchy=\"false\">)</mo></mrow></mrow></mrow></math>", "type": "latex"}, {"file": "1601.06450.tex", "nexttext": "\nis in $V$ whenever $(a_1, \\dots, a_{\\kappa})$ is in $U$. Therefore, the second claim is true and it is enough to check that $V \\cap B^{l\\kappa}$ is empty. Suppose otherwise, that is, there exists $(b_1, \\dots, b_{l\\kappa}) \\in V \\cap B^{l\\kappa}$. \n\nLet $S = \\Psi(y,y_*,x_1, \\dots, x_{\\kappa})$ and let $Q$ and $P$ be the projections of $S$ and $S \\cap (C^2 \\times B^{\\kappa})$ onto the first two coordinates, respectively. By Lemma~\\ref{lem:abspp}, $P {\\operatorname{\\trianglelefteq_J}} {\\mathbf{{Q}}}$. By construction of $\\Psi$, we have that $\\Delta_C \\subseteq Q$ and that the projection of $S\\cap (\\Delta_C \\times A^{\\kappa})$ onto the coordinates $3,4, \\dots, \\kappa+2$ is equal to $U=\\Phi(x_1, \\dots, x_\\kappa)$. By construction of $\\Theta$ from $\\Psi$, the tuple $(b_1, \\dots, b_{l\\kappa}) \\in V \\cap B^{l\\kappa}$ implies the existence of a $P$-walk of length $l$. Since $l=|A|$ this walk must contain a closed $P$-walk.\n\nThe assumptions of Lemma~\\ref{lem:loop} are satisfied, and therefore $P$ contains a loop $(c,c)$. But this gives us a tuple $(c,c,b_1,\\dots,b_\\kappa)\\in S\\cap(\\Delta_C\\times B^\\kappa)$ which means that $(b_1,\\dots,b_\\kappa)\\in U\\cap B^\\kappa$. This contradicts the $B$-essentiality of $U$.\n\\end{proof}\n\n\nIn the third step, we modify $\\Theta$ using the data provided by the following lemma. \n\n\\begin{lemma} \\label{lem:step_three}\nLet $l_1, \\dots, l_{\\kappa}$ be positive integers, $s=l_1+\\dots+l_\\kappa$, and let $W \\leq {\\mathbf{{A}}}^s$ be such that $W$ does not intersect $B^s$ but, for each $i \\in [\\kappa]$, intersects $B^{l_1+\\dots+l_{i-1}} \\times A^{l_i} \\times B^{l_{i+1} + \\dots + l_\\kappa}$.\n\nThen there exist $m_i \\in [l_i]$ for each $i \\in [\\kappa]$ and $C_{i}^j \\leq {\\mathbf{{A}}}$ for each $i \\in [\\kappa], j \\in ([l_i] \\setminus \\{m_i\\})$ such that\n\n", "itemtype": "equation", "pos": 27134, "prevtext": "\nis ``block-wise $B$-essential'':\n\n\\begin{lemma} \\label{lem:step_two}\nThe relation $V$ does not intersect $B^{l\\kappa}$ but, for every $i \\in [\\kappa]$, $V \\cap (B^{l(i-1)} \\times A^{l} \\times B^{l(\\kappa-i)}) \\neq \\emptyset$.\n\\end{lemma}\n\n\n\n\n\n\n\\begin{proof}\nBy construction, the tuple \n", "index": 21, "text": "\n\\[\n(\\underbrace{a_1, \\dots, a_1}_{l \\times}, \\underbrace{a_2, \\dots, a_2}_{l \\times}, \\dots, \\underbrace{a_{\\kappa}, \\dots a_{\\kappa}}_{l \\times})\\]\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex13.m1\" class=\"ltx_Math\" alttext=\"(\\underbrace{a_{1},\\dots,a_{1}}_{l\\times},\\underbrace{a_{2},\\dots,a_{2}}_{l%&#10;\\times},\\dots,\\underbrace{a_{\\kappa},\\dots a_{\\kappa}}_{l\\times})\" display=\"block\"><mrow><mo stretchy=\"false\">(</mo><munder><munder accentunder=\"true\"><mrow><msub><mi>a</mi><mn>1</mn></msub><mo movablelimits=\"false\">,</mo><mi mathvariant=\"normal\">\u2026</mi><mo movablelimits=\"false\">,</mo><msub><mi>a</mi><mn>1</mn></msub></mrow><mo movablelimits=\"false\">\u23df</mo></munder><mrow><mi>l</mi><mo>\u2063</mo><mo>\u00d7</mo></mrow></munder><mo>,</mo><munder><munder accentunder=\"true\"><mrow><msub><mi>a</mi><mn>2</mn></msub><mo movablelimits=\"false\">,</mo><mi mathvariant=\"normal\">\u2026</mi><mo movablelimits=\"false\">,</mo><msub><mi>a</mi><mn>2</mn></msub></mrow><mo movablelimits=\"false\">\u23df</mo></munder><mrow><mi>l</mi><mo>\u2063</mo><mo>\u00d7</mo></mrow></munder><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><munder><munder accentunder=\"true\"><mrow><msub><mi>a</mi><mi>\u03ba</mi></msub><mo movablelimits=\"false\">,</mo><mrow><mi mathvariant=\"normal\">\u2026</mi><mo movablelimits=\"false\">\u2062</mo><msub><mi>a</mi><mi>\u03ba</mi></msub></mrow></mrow><mo movablelimits=\"false\">\u23df</mo></munder><mrow><mi>l</mi><mo>\u2063</mo><mo>\u00d7</mo></mrow></munder><mo stretchy=\"false\">)</mo></mrow></math>", "type": "latex"}, {"file": "1601.06450.tex", "nexttext": "\nis a $B$-essential relation.\n\\end{lemma}\n\n\\begin{proof}\nWe prove the claim by induction on $s$. The base case $l_1=l_2=\\dots=l_{\\kappa}=1$ is trivially true as $U'=W$ is already $B$-essential. \n\nFor the induction step assume without loss of generality that $l_\\kappa>1$. There are two cases:\n\\begin{itemize}\n\\item If $W\\cap (B^{s-1}\\times A)=\\emptyset$, then we can apply the induction hypothesis to $l_1,\\dots,l_{\\kappa-1},l_\\kappa-1$ and the projection of $W$ onto the first $s-1$ coordinates. Let $m_i$, $C^i_j$ \n be the data provided and, in addition, set $C_\\kappa^\\kappa=A$.\n\\item If $W\\cap (B^{s-1}\\times A)\\neq\\emptyset$, then we set $m_\\kappa=l_\\kappa$, $C^\\kappa_1=\\dots=C^\\kappa_{l_\\kappa-1}=B$. For $i<\\kappa$ we use the data from applying the claim to $l_1,\\dots,l_{\\kappa-1},1$ and the projection of $W$ onto the first $l_1+\\dots+l_{\\kappa-1}$ coordinates and the last coordinate.\n\\end{itemize}\nIt is easy to verify that in both cases the resulting relation $U'$ is indeed $B$-essential.\n\\end{proof}\n\nWe apply this lemma for $W=V$, $l_1 = \\dots = l_{\\kappa}=l$. Note that the assumptions are satisfied by Lemma~\\ref{lem:step_two}.\n\nThe formula $\\Phi'$ is obtained from $\\Theta$ as follows. For each $i \\in [\\kappa]$, we rename the variable $x_i^{m_i}$ to $x_i$ and, for each $i \\in [\\kappa]$, $j \\in [l]$, $j \\neq m_i$, we add\nthe constraint $C_i^j(x_i^j)$. It follows from Lemma~\\ref{lem:step_three} that $U' =  \\Phi'(x_1, \\dots, x_\\kappa)$ is a $B$-essential relation. \n\n\nZhuk's proof~\\cite{Zhuk14} (see also~\\cite{Bvaleriote} for an alternative presentation in a slightly simplified situation that $\\theta=2$) now shows that by a repeated application of this construction with suitable choices of variables and constraints (plus the simplifications from Subsection \\ref{subsec:preproc}) we can obtain a tree formula $\\Phi$ such that \n$\\Phi(x_1, \\dots, x_\\kappa)$ is simplified and defines a $B$-essential relation. \n\n\\subsection{A comb formula}\\label{subsec:comb}\n\n\nRecall that by fixing some coordinates of a $B$-essential relation to $B$ we get a $B$-essential relation. It follows that if we select $i_1, \\dots, i_\\lambda \\in [\\kappa]$ arbitrarily and form $\\Phi'$ by adding to $\\Phi$ the unary constraints $B(x_{j})$, $j \\in [\\kappa] \\setminus \\{i_1, \\dots, i_{\\lambda}\\}$, then $\\Phi'(x_{i_1}, \\dots, x_{i_{\\lambda}})$ will be $B$-essential. \n\nThe following lemma shows that these variables can be selected so that $\\lambda$ is roughly a logarithm of $\\kappa$ and $\\Phi'$ can be simplified to an especially nice form (see also the proof of~\\cite[Theorem~6.1]{Zhuk14}, or section ``Comb definition'' of~\\cite{Bvaleriote} for a proof in the case $\\theta=2$).\n\n\\begin{lemma} \\label{lem:comb}\n\tThere exists a pp-formula over ${\\mathbb{{A}}}$ of the form\n\n", "itemtype": "equation", "pos": 29078, "prevtext": "\nis in $V$ whenever $(a_1, \\dots, a_{\\kappa})$ is in $U$. Therefore, the second claim is true and it is enough to check that $V \\cap B^{l\\kappa}$ is empty. Suppose otherwise, that is, there exists $(b_1, \\dots, b_{l\\kappa}) \\in V \\cap B^{l\\kappa}$. \n\nLet $S = \\Psi(y,y_*,x_1, \\dots, x_{\\kappa})$ and let $Q$ and $P$ be the projections of $S$ and $S \\cap (C^2 \\times B^{\\kappa})$ onto the first two coordinates, respectively. By Lemma~\\ref{lem:abspp}, $P {\\operatorname{\\trianglelefteq_J}} {\\mathbf{{Q}}}$. By construction of $\\Psi$, we have that $\\Delta_C \\subseteq Q$ and that the projection of $S\\cap (\\Delta_C \\times A^{\\kappa})$ onto the coordinates $3,4, \\dots, \\kappa+2$ is equal to $U=\\Phi(x_1, \\dots, x_\\kappa)$. By construction of $\\Theta$ from $\\Psi$, the tuple $(b_1, \\dots, b_{l\\kappa}) \\in V \\cap B^{l\\kappa}$ implies the existence of a $P$-walk of length $l$. Since $l=|A|$ this walk must contain a closed $P$-walk.\n\nThe assumptions of Lemma~\\ref{lem:loop} are satisfied, and therefore $P$ contains a loop $(c,c)$. But this gives us a tuple $(c,c,b_1,\\dots,b_\\kappa)\\in S\\cap(\\Delta_C\\times B^\\kappa)$ which means that $(b_1,\\dots,b_\\kappa)\\in U\\cap B^\\kappa$. This contradicts the $B$-essentiality of $U$.\n\\end{proof}\n\n\nIn the third step, we modify $\\Theta$ using the data provided by the following lemma. \n\n\\begin{lemma} \\label{lem:step_three}\nLet $l_1, \\dots, l_{\\kappa}$ be positive integers, $s=l_1+\\dots+l_\\kappa$, and let $W \\leq {\\mathbf{{A}}}^s$ be such that $W$ does not intersect $B^s$ but, for each $i \\in [\\kappa]$, intersects $B^{l_1+\\dots+l_{i-1}} \\times A^{l_i} \\times B^{l_{i+1} + \\dots + l_\\kappa}$.\n\nThen there exist $m_i \\in [l_i]$ for each $i \\in [\\kappa]$ and $C_{i}^j \\leq {\\mathbf{{A}}}$ for each $i \\in [\\kappa], j \\in ([l_i] \\setminus \\{m_i\\})$ such that\n\n", "index": 23, "text": "\\begin{align*}\nU' = \n\\{(a_1^{m_1}, \\dots, a_\\kappa^{m_\\kappa})\\mid &(a^1_1, \\dots, a^{l_1}_1, a^1_2, \\dots, a^{l_2}_2, \\dots, a^1_\\kappa, \\dots, a^{l_\\kappa}_\\kappa) \\in V,  \\\\\n&(\\forall i \\in [\\kappa]) (\\forall j \\in [l_i], j \\neq m_i) \\  a_i^j \\in C_i^j\\}\n\\end{align*}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex14.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle U^{\\prime}=\\{(a_{1}^{m_{1}},\\dots,a_{\\kappa}^{m_{\\kappa}})\\mid\" display=\"inline\"><mrow><msup><mi>U</mi><mo>\u2032</mo></msup><mo>=</mo><mrow><mo stretchy=\"false\">{</mo><mrow><mo stretchy=\"false\">(</mo><msubsup><mi>a</mi><mn>1</mn><msub><mi>m</mi><mn>1</mn></msub></msubsup><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msubsup><mi>a</mi><mi>\u03ba</mi><msub><mi>m</mi><mi>\u03ba</mi></msub></msubsup><mo stretchy=\"false\">)</mo></mrow><mo>\u2223</mo></mrow></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex14.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle(a^{1}_{1},\\dots,a^{l_{1}}_{1},a^{1}_{2},\\dots,a^{l_{2}}_{2},%&#10;\\dots,a^{1}_{\\kappa},\\dots,a^{l_{\\kappa}}_{\\kappa})\\in V,\" display=\"inline\"><mrow><mrow><mrow><mo stretchy=\"false\">(</mo><msubsup><mi>a</mi><mn>1</mn><mn>1</mn></msubsup><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msubsup><mi>a</mi><mn>1</mn><msub><mi>l</mi><mn>1</mn></msub></msubsup><mo>,</mo><msubsup><mi>a</mi><mn>2</mn><mn>1</mn></msubsup><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msubsup><mi>a</mi><mn>2</mn><msub><mi>l</mi><mn>2</mn></msub></msubsup><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msubsup><mi>a</mi><mi>\u03ba</mi><mn>1</mn></msubsup><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msubsup><mi>a</mi><mi>\u03ba</mi><msub><mi>l</mi><mi>\u03ba</mi></msub></msubsup><mo stretchy=\"false\">)</mo></mrow><mo>\u2208</mo><mi>V</mi></mrow><mo>,</mo></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex15.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle(\\forall i\\in[\\kappa])(\\forall j\\in[l_{i}],j\\neq m_{i})\\ a_{i}^{j%&#10;}\\in C_{i}^{j}\\}\" display=\"inline\"><mrow><mrow><mo stretchy=\"false\">(</mo><mo>\u2200</mo><mi>i</mi><mo>\u2208</mo><mrow><mo stretchy=\"false\">[</mo><mi>\u03ba</mi><mo stretchy=\"false\">]</mo></mrow><mo stretchy=\"false\">)</mo></mrow><mrow><mo stretchy=\"false\">(</mo><mo>\u2200</mo><mi>j</mi><mo>\u2208</mo><mrow><mo stretchy=\"false\">[</mo><msub><mi>l</mi><mi>i</mi></msub><mo stretchy=\"false\">]</mo></mrow><mo>,</mo><mi>j</mi><mo>\u2260</mo><msub><mi>m</mi><mi>i</mi></msub><mo rspace=\"7.5pt\" stretchy=\"false\">)</mo></mrow><msubsup><mi>a</mi><mi>i</mi><mi>j</mi></msubsup><mo>\u2208</mo><msubsup><mi>C</mi><mi>i</mi><mi>j</mi></msubsup><mo stretchy=\"false\">}</mo></mrow></math>", "type": "latex"}, {"file": "1601.06450.tex", "nexttext": "\n\tthat defines a $B$-essential relation $R$ of arity $\\lambda \\geq 3^{|A|}$  (see Figure~\\ref{fig:comb}).\n\\end{lemma}\n\n\\begin{figure}[ht]{   \\begin{center}     \\begin{tikzpicture} \t     \\draw[rounded corners=5mm,fill=gray!20] (-0.5,0)--(-0.5,2.5)--(2.5,2.5)--(2.5,1.5)--(0.5,1.5)--(0.5,0)--cycle node[above = 80pt,right = 30pt] {$S_1$}; \t     \\draw[rounded corners=5mm,fill=gray!10] (1.5,0)--(1.5,2.5)--(4.5,2.5)--(4.5,1.5)--(2.5,1.5)--(2.5,0)--cycle node[above = 80pt,right = 30pt] {$S_2$}; \t     \\draw[rounded corners=5mm,fill=gray!20] (3.5,0)--(3.5,2.5)--(6.5,2.5)--(6.5,1.5)--(4.5,1.5)--(4.5,0)--cycle node[above = 80pt,right = 30pt] {$S_3$}; \t     \\draw[rounded corners=5mm,fill=gray!10] (5.5,0)--(5.5,2.5)--(8.5,2.5)--(8.5,1.5)--(6.5,1.5)--(6.5,0)--cycle node[above = 80pt,right = 30pt] {$S_4$}; \t     \\draw[rounded corners=5mm,fill=gray!20] (7.5,0)--(7.5,2.5)--(10.5,2.5)--(10.5,1.5)--(8.5,1.5)--(8.5,0)--cycle node[above = 80pt,right = 30pt] {$S_5$}; \t\t \\draw(0,2)  (0,0.5) node[krouzek] {$z_1$}; \t\t \\draw(2,2)  (2,0.5) node[krouzek] {$z_2$}; \t\t \\draw(4,2)  (4,0.5) node[krouzek] {$z_3$}; \t\t \\draw(6,2)  (6,0.5) node[krouzek] {$z_4$}; \t\t \\draw(8,2)  (8,0.5) node[krouzek] {$z_5$}; \t\t \\draw(0,2) node[krouzek] {$w_1$}  (2,2) node[krouzek] {$w_2$}  (4,2) node[krouzek] {$w_3$}  (6,2) node[krouzek] {$w_4$}  (8,2) node[krouzek] {$w_5$}  (10,2) node[krouzek] {$w_6$}; \t\t    \\end{tikzpicture}   \\end{center}   \\caption{A comb definition of the relation $R$.}   \\label{fig:comb} }\\end{figure}\nWe remark that a similar formula from~\\cite[Theorem~6.1]{Zhuk14} has two additional binary constraints. The difference is negligible.\n\n\\begin{proof}\nLet $\\Phi(x_1, \\dots, x_{\\kappa})$ be a simplified tree formula defining a $B$-essential relation.\nWe start by fixing an arbitrary leaf $z_1\\in\\{x_1,\\dots,x_\\kappa\\}$. For every variable $u\\neq z_1$ we define $L(u)$ to be the number of leaves (that is, free variables) lying outside of ${\\operatorname{Br}}(u; z_1)$.  \n\nIn the first step of our construction we introduce a new variable $w_1$, add the constraint $w_1=z_1$, and choose $w_2\\in{\\operatorname{N}}(z_1)$ so that $L(w_2)$ is maximal. Let $i>1$ and assume that $z_{i-1}$, $w_{i-1}$ and $w_i$ are already defined. The construction splits into several cases:\n\n\\begin{enumerate}[(1)]\n\\item If $w_i$ is a leaf, then we set $\\lambda = i-1$ and stop the construction process.\n\\item Else, if ${\\operatorname{N}}(w_i)\\setminus{\\operatorname{Br}}(w_i;w_{i-1})$ contains a single element $v$, then we redefine $w_i=v$ and repeat this construction step.\n\n\\item Else, we choose $w_{i+1}\\in{\\operatorname{N}}(w_i)\\setminus{\\operatorname{Br}}(w_i;w_{i-1})$ so that $L(w_{i+1})$ is maximal, pick any leaf $z_i\\in{\\operatorname{Br}}(w_{i+1};w_i)\\setminus{\\operatorname{Br}}(w_i;w_{i-1})$, $z_i\\neq w_{i+1}$, and increment $i$.\n\\end{enumerate}\nLet $\\Phi'$ be the formula obtained from $\\Phi\\wedge(w_1=z_1)$ by fixing to $B$ all the free variables of $\\Phi$ that have not been selected, that is, by adding the unary constraints $B(x_j)$ whenever $x_j\\notin\\{z_1,\\dots,z_\\lambda\\}$.\n\nThe relations $S_i(z_i,w_i,w_{i+1})$ for $1<i<\\lambda$ are obtained by taking the induced substructure of $\\Phi'$ on the set of variables $({\\operatorname{Br}}(w_{i+1}; w_i)\\setminus{\\operatorname{Br}}(w_i;w_{i-1}))\\cup\\{w_i\\}$ and existentially quantifying over all variables except for $z_i$, $w_i$ and $w_{i+1}$. The relation $S_1$ is obtained similarly using the set of variables ${\\operatorname{Br}}(w_2;w_1)$.\n\nIt is easy to see that the resulting ``comb'' formula pp-defines the same relation as $\\Phi'$ which is $B$-essential by the argument from the beginning of this subsection. \n\nIt remains to verify that $\\lambda\\geq 3^{|A|}$. In the first step, as $z_1$ is a leaf, we have that $|{\\operatorname{N}}(z_1)|\\leq \\theta-1$ and  $\\sum_{u\\in{\\operatorname{N}}(z_1)}L(u)=\\kappa-1$. Note that redefining of $w_i$ in case (2) does not change the value of $L(w_i)$. It follows that $L(w_2)\\geq\\frac{\\kappa-1}{\\theta-1}$. In the consequent steps, the degree of $w_i$ is at most 3. Thus there are at most $2(\\theta-1)$ neighbors to choose from and $L(w_{i+1})\\geq\\frac{L(w_i)}{2(\\theta-1)}$. This gives us a lower bound \n\n", "itemtype": "equation", "pos": 32122, "prevtext": "\nis a $B$-essential relation.\n\\end{lemma}\n\n\\begin{proof}\nWe prove the claim by induction on $s$. The base case $l_1=l_2=\\dots=l_{\\kappa}=1$ is trivially true as $U'=W$ is already $B$-essential. \n\nFor the induction step assume without loss of generality that $l_\\kappa>1$. There are two cases:\n\\begin{itemize}\n\\item If $W\\cap (B^{s-1}\\times A)=\\emptyset$, then we can apply the induction hypothesis to $l_1,\\dots,l_{\\kappa-1},l_\\kappa-1$ and the projection of $W$ onto the first $s-1$ coordinates. Let $m_i$, $C^i_j$ \n be the data provided and, in addition, set $C_\\kappa^\\kappa=A$.\n\\item If $W\\cap (B^{s-1}\\times A)\\neq\\emptyset$, then we set $m_\\kappa=l_\\kappa$, $C^\\kappa_1=\\dots=C^\\kappa_{l_\\kappa-1}=B$. For $i<\\kappa$ we use the data from applying the claim to $l_1,\\dots,l_{\\kappa-1},1$ and the projection of $W$ onto the first $l_1+\\dots+l_{\\kappa-1}$ coordinates and the last coordinate.\n\\end{itemize}\nIt is easy to verify that in both cases the resulting relation $U'$ is indeed $B$-essential.\n\\end{proof}\n\nWe apply this lemma for $W=V$, $l_1 = \\dots = l_{\\kappa}=l$. Note that the assumptions are satisfied by Lemma~\\ref{lem:step_two}.\n\nThe formula $\\Phi'$ is obtained from $\\Theta$ as follows. For each $i \\in [\\kappa]$, we rename the variable $x_i^{m_i}$ to $x_i$ and, for each $i \\in [\\kappa]$, $j \\in [l]$, $j \\neq m_i$, we add\nthe constraint $C_i^j(x_i^j)$. It follows from Lemma~\\ref{lem:step_three} that $U' =  \\Phi'(x_1, \\dots, x_\\kappa)$ is a $B$-essential relation. \n\n\nZhuk's proof~\\cite{Zhuk14} (see also~\\cite{Bvaleriote} for an alternative presentation in a slightly simplified situation that $\\theta=2$) now shows that by a repeated application of this construction with suitable choices of variables and constraints (plus the simplifications from Subsection \\ref{subsec:preproc}) we can obtain a tree formula $\\Phi$ such that \n$\\Phi(x_1, \\dots, x_\\kappa)$ is simplified and defines a $B$-essential relation. \n\n\\subsection{A comb formula}\\label{subsec:comb}\n\n\nRecall that by fixing some coordinates of a $B$-essential relation to $B$ we get a $B$-essential relation. It follows that if we select $i_1, \\dots, i_\\lambda \\in [\\kappa]$ arbitrarily and form $\\Phi'$ by adding to $\\Phi$ the unary constraints $B(x_{j})$, $j \\in [\\kappa] \\setminus \\{i_1, \\dots, i_{\\lambda}\\}$, then $\\Phi'(x_{i_1}, \\dots, x_{i_{\\lambda}})$ will be $B$-essential. \n\nThe following lemma shows that these variables can be selected so that $\\lambda$ is roughly a logarithm of $\\kappa$ and $\\Phi'$ can be simplified to an especially nice form (see also the proof of~\\cite[Theorem~6.1]{Zhuk14}, or section ``Comb definition'' of~\\cite{Bvaleriote} for a proof in the case $\\theta=2$).\n\n\\begin{lemma} \\label{lem:comb}\n\tThere exists a pp-formula over ${\\mathbb{{A}}}$ of the form\n\n", "index": 25, "text": "\\[\n\t(\\exists w_1 \\,\\dots\\,\\exists w_{\\lambda+1}) \\,S_1(z_1,w_1,w_2) \\wedge S_2(z_2,w_2, w_3) \\wedge \\dots \\wedge S_{\\lambda}(z_{\\lambda}, w_{\\lambda}, w_{\\lambda+1})\n\t\\]\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex16.m1\" class=\"ltx_Math\" alttext=\"(\\exists w_{1}\\,\\dots\\,\\exists w_{\\lambda+1})\\,S_{1}(z_{1},w_{1},w_{2})\\wedge S%&#10;_{2}(z_{2},w_{2},w_{3})\\wedge\\dots\\wedge S_{\\lambda}(z_{\\lambda},w_{\\lambda},w%&#10;_{\\lambda+1})\" display=\"block\"><mrow><mrow><mrow><mo stretchy=\"false\">(</mo><mrow><mo>\u2203</mo><mrow><mpadded width=\"+1.7pt\"><msub><mi>w</mi><mn>1</mn></msub></mpadded><mo>\u2062</mo><mpadded width=\"+1.7pt\"><mi mathvariant=\"normal\">\u2026</mi></mpadded><mo>\u2062</mo><mrow><mo>\u2203</mo><msub><mi>w</mi><mrow><mi>\u03bb</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow></mrow></mrow><mo rspace=\"4.2pt\" stretchy=\"false\">)</mo></mrow><mo>\u2062</mo><msub><mi>S</mi><mn>1</mn></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>z</mi><mn>1</mn></msub><mo>,</mo><msub><mi>w</mi><mn>1</mn></msub><mo>,</mo><msub><mi>w</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2227</mo><mrow><msub><mi>S</mi><mn>2</mn></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>z</mi><mn>2</mn></msub><mo>,</mo><msub><mi>w</mi><mn>2</mn></msub><mo>,</mo><msub><mi>w</mi><mn>3</mn></msub><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2227</mo><mi mathvariant=\"normal\">\u2026</mi><mo>\u2227</mo><mrow><msub><mi>S</mi><mi>\u03bb</mi></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>z</mi><mi>\u03bb</mi></msub><mo>,</mo><msub><mi>w</mi><mi>\u03bb</mi></msub><mo>,</mo><msub><mi>w</mi><mrow><mi>\u03bb</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy=\"false\">)</mo></mrow></mrow></mrow></math>", "type": "latex"}, {"file": "1601.06450.tex", "nexttext": "\nThe fact that the construction stopped at $\\lambda$ means that $L(w_\\lambda)\\leq 2(\\theta-1)$. Comparing these bounds gives us\n\n", "itemtype": "equation", "pos": 36483, "prevtext": "\n\tthat defines a $B$-essential relation $R$ of arity $\\lambda \\geq 3^{|A|}$  (see Figure~\\ref{fig:comb}).\n\\end{lemma}\n\n\\begin{figure}[ht]{   \\begin{center}     \\begin{tikzpicture} \t     \\draw[rounded corners=5mm,fill=gray!20] (-0.5,0)--(-0.5,2.5)--(2.5,2.5)--(2.5,1.5)--(0.5,1.5)--(0.5,0)--cycle node[above = 80pt,right = 30pt] {$S_1$}; \t     \\draw[rounded corners=5mm,fill=gray!10] (1.5,0)--(1.5,2.5)--(4.5,2.5)--(4.5,1.5)--(2.5,1.5)--(2.5,0)--cycle node[above = 80pt,right = 30pt] {$S_2$}; \t     \\draw[rounded corners=5mm,fill=gray!20] (3.5,0)--(3.5,2.5)--(6.5,2.5)--(6.5,1.5)--(4.5,1.5)--(4.5,0)--cycle node[above = 80pt,right = 30pt] {$S_3$}; \t     \\draw[rounded corners=5mm,fill=gray!10] (5.5,0)--(5.5,2.5)--(8.5,2.5)--(8.5,1.5)--(6.5,1.5)--(6.5,0)--cycle node[above = 80pt,right = 30pt] {$S_4$}; \t     \\draw[rounded corners=5mm,fill=gray!20] (7.5,0)--(7.5,2.5)--(10.5,2.5)--(10.5,1.5)--(8.5,1.5)--(8.5,0)--cycle node[above = 80pt,right = 30pt] {$S_5$}; \t\t \\draw(0,2)  (0,0.5) node[krouzek] {$z_1$}; \t\t \\draw(2,2)  (2,0.5) node[krouzek] {$z_2$}; \t\t \\draw(4,2)  (4,0.5) node[krouzek] {$z_3$}; \t\t \\draw(6,2)  (6,0.5) node[krouzek] {$z_4$}; \t\t \\draw(8,2)  (8,0.5) node[krouzek] {$z_5$}; \t\t \\draw(0,2) node[krouzek] {$w_1$}  (2,2) node[krouzek] {$w_2$}  (4,2) node[krouzek] {$w_3$}  (6,2) node[krouzek] {$w_4$}  (8,2) node[krouzek] {$w_5$}  (10,2) node[krouzek] {$w_6$}; \t\t    \\end{tikzpicture}   \\end{center}   \\caption{A comb definition of the relation $R$.}   \\label{fig:comb} }\\end{figure}\nWe remark that a similar formula from~\\cite[Theorem~6.1]{Zhuk14} has two additional binary constraints. The difference is negligible.\n\n\\begin{proof}\nLet $\\Phi(x_1, \\dots, x_{\\kappa})$ be a simplified tree formula defining a $B$-essential relation.\nWe start by fixing an arbitrary leaf $z_1\\in\\{x_1,\\dots,x_\\kappa\\}$. For every variable $u\\neq z_1$ we define $L(u)$ to be the number of leaves (that is, free variables) lying outside of ${\\operatorname{Br}}(u; z_1)$.  \n\nIn the first step of our construction we introduce a new variable $w_1$, add the constraint $w_1=z_1$, and choose $w_2\\in{\\operatorname{N}}(z_1)$ so that $L(w_2)$ is maximal. Let $i>1$ and assume that $z_{i-1}$, $w_{i-1}$ and $w_i$ are already defined. The construction splits into several cases:\n\n\\begin{enumerate}[(1)]\n\\item If $w_i$ is a leaf, then we set $\\lambda = i-1$ and stop the construction process.\n\\item Else, if ${\\operatorname{N}}(w_i)\\setminus{\\operatorname{Br}}(w_i;w_{i-1})$ contains a single element $v$, then we redefine $w_i=v$ and repeat this construction step.\n\n\\item Else, we choose $w_{i+1}\\in{\\operatorname{N}}(w_i)\\setminus{\\operatorname{Br}}(w_i;w_{i-1})$ so that $L(w_{i+1})$ is maximal, pick any leaf $z_i\\in{\\operatorname{Br}}(w_{i+1};w_i)\\setminus{\\operatorname{Br}}(w_i;w_{i-1})$, $z_i\\neq w_{i+1}$, and increment $i$.\n\\end{enumerate}\nLet $\\Phi'$ be the formula obtained from $\\Phi\\wedge(w_1=z_1)$ by fixing to $B$ all the free variables of $\\Phi$ that have not been selected, that is, by adding the unary constraints $B(x_j)$ whenever $x_j\\notin\\{z_1,\\dots,z_\\lambda\\}$.\n\nThe relations $S_i(z_i,w_i,w_{i+1})$ for $1<i<\\lambda$ are obtained by taking the induced substructure of $\\Phi'$ on the set of variables $({\\operatorname{Br}}(w_{i+1}; w_i)\\setminus{\\operatorname{Br}}(w_i;w_{i-1}))\\cup\\{w_i\\}$ and existentially quantifying over all variables except for $z_i$, $w_i$ and $w_{i+1}$. The relation $S_1$ is obtained similarly using the set of variables ${\\operatorname{Br}}(w_2;w_1)$.\n\nIt is easy to see that the resulting ``comb'' formula pp-defines the same relation as $\\Phi'$ which is $B$-essential by the argument from the beginning of this subsection. \n\nIt remains to verify that $\\lambda\\geq 3^{|A|}$. In the first step, as $z_1$ is a leaf, we have that $|{\\operatorname{N}}(z_1)|\\leq \\theta-1$ and  $\\sum_{u\\in{\\operatorname{N}}(z_1)}L(u)=\\kappa-1$. Note that redefining of $w_i$ in case (2) does not change the value of $L(w_i)$. It follows that $L(w_2)\\geq\\frac{\\kappa-1}{\\theta-1}$. In the consequent steps, the degree of $w_i$ is at most 3. Thus there are at most $2(\\theta-1)$ neighbors to choose from and $L(w_{i+1})\\geq\\frac{L(w_i)}{2(\\theta-1)}$. This gives us a lower bound \n\n", "index": 27, "text": "$$\nL(w_\\lambda)\\geq\\frac{\\kappa-1}{2^{\\lambda-2}(\\theta-1)^{\\lambda-1}}.\n$$\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex17.m1\" class=\"ltx_Math\" alttext=\"L(w_{\\lambda})\\geq\\frac{\\kappa-1}{2^{\\lambda-2}(\\theta-1)^{\\lambda-1}}.\" display=\"block\"><mrow><mrow><mrow><mi>L</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>w</mi><mi>\u03bb</mi></msub><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2265</mo><mfrac><mrow><mi>\u03ba</mi><mo>-</mo><mn>1</mn></mrow><mrow><msup><mn>2</mn><mrow><mi>\u03bb</mi><mo>-</mo><mn>2</mn></mrow></msup><mo>\u2062</mo><msup><mrow><mo stretchy=\"false\">(</mo><mrow><mi>\u03b8</mi><mo>-</mo><mn>1</mn></mrow><mo stretchy=\"false\">)</mo></mrow><mrow><mi>\u03bb</mi><mo>-</mo><mn>1</mn></mrow></msup></mrow></mfrac></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.06450.tex", "nexttext": "\nwhich implies that $\\lambda\\geq 3^{|A|}$. \n\\end{proof}\n\n\n\\subsection{Contradiction} \\label{subsec:contradiction}\nTake a pp-definition of a $B$-essential relation $R \\leq {\\mathbf{{A}}}^{\\lambda}$ as in Lemma~\\ref{lem:comb}.\n\n\nThe following terminology will be useful. An \\emph{$(i,j)$-path from $a$ to $a'$ supported by $(c_{i}, \\dots, c_{j-1})$}, where $1\\leq i<j\\leq \\lambda+1$ and $a,a',c_{i}, \\dots, c_{j-1} \\in A$, is a tuple $(a = a_i,a_{i+1}, \\dots, a_j = a')$ of elements of $A$ such that $(c_{l},a_{l},a_{l+1}) \\in S_{l}$ for every $l \\in \\{i, \\dots, j-1\\}$. Let $\\Pi_{i,j}(u,v,\\bar z)$ be the pp-formula describing the existence of an $(i,j)$-path from $u$ to $v$ supported by $\\bar z$. Observe that a tuple $(c_1, \\dots, c_\\lambda)$ is in $R$ if and only if there exists some $(1,\\lambda+1)$-path supported by $(c_1, \\dots, c_\\lambda)$, that is, \n\n", "itemtype": "equation", "pos": 36686, "prevtext": "\nThe fact that the construction stopped at $\\lambda$ means that $L(w_\\lambda)\\leq 2(\\theta-1)$. Comparing these bounds gives us\n\n", "index": 29, "text": "$$\n\\kappa\\leq \\frac{1}{2}(2\\theta-2)^\\lambda+1\n$$\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex18.m1\" class=\"ltx_Math\" alttext=\"\\kappa\\leq\\frac{1}{2}(2\\theta-2)^{\\lambda}+1\" display=\"block\"><mrow><mi>\u03ba</mi><mo>\u2264</mo><mrow><mrow><mfrac><mn>1</mn><mn>2</mn></mfrac><mo>\u2062</mo><msup><mrow><mo stretchy=\"false\">(</mo><mrow><mrow><mn>2</mn><mo>\u2062</mo><mi>\u03b8</mi></mrow><mo>-</mo><mn>2</mn></mrow><mo stretchy=\"false\">)</mo></mrow><mi>\u03bb</mi></msup></mrow><mo>+</mo><mn>1</mn></mrow></mrow></math>", "type": "latex"}, {"file": "1601.06450.tex", "nexttext": "\n\nFor each $i \\in \\{2,\\dots,\\lambda\\}$ we define two subuniverses $G_i, H_i$ of ${\\mathbf{{A}}}$: $a \\in G_i$ if and only if there exists a $(1,i)$-path to $a$ supported by a tuple from $B^{i-1}$, and $a \\in H_i$ if and only if there exists an $(i,\\lambda+1)$-path from $a$ supported by a tuple from $B^{\\lambda-i+1}$. The sets $G_i$ and $H_i$ are indeed subuniverses of ${\\mathbf{{A}}}$, their pp-definitions are the following:\n\n", "itemtype": "equation", "pos": 37594, "prevtext": "\nwhich implies that $\\lambda\\geq 3^{|A|}$. \n\\end{proof}\n\n\n\\subsection{Contradiction} \\label{subsec:contradiction}\nTake a pp-definition of a $B$-essential relation $R \\leq {\\mathbf{{A}}}^{\\lambda}$ as in Lemma~\\ref{lem:comb}.\n\n\nThe following terminology will be useful. An \\emph{$(i,j)$-path from $a$ to $a'$ supported by $(c_{i}, \\dots, c_{j-1})$}, where $1\\leq i<j\\leq \\lambda+1$ and $a,a',c_{i}, \\dots, c_{j-1} \\in A$, is a tuple $(a = a_i,a_{i+1}, \\dots, a_j = a')$ of elements of $A$ such that $(c_{l},a_{l},a_{l+1}) \\in S_{l}$ for every $l \\in \\{i, \\dots, j-1\\}$. Let $\\Pi_{i,j}(u,v,\\bar z)$ be the pp-formula describing the existence of an $(i,j)$-path from $u$ to $v$ supported by $\\bar z$. Observe that a tuple $(c_1, \\dots, c_\\lambda)$ is in $R$ if and only if there exists some $(1,\\lambda+1)$-path supported by $(c_1, \\dots, c_\\lambda)$, that is, \n\n", "index": 31, "text": "$$\n\\bar c\\in R\\ \\text{ if and only if }\\ (\\exists u\\,\\exists v)\\,\\Pi_{1,\\lambda+1}(u,v,\\bar c).\n$$\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex19.m1\" class=\"ltx_Math\" alttext=\"\\bar{c}\\in R\\ \\text{ if and only if }\\ (\\exists u\\,\\exists v)\\,\\Pi_{1,\\lambda+%&#10;1}(u,v,\\bar{c}).\" display=\"block\"><mrow><mrow><mover accent=\"true\"><mi>c</mi><mo stretchy=\"false\">\u00af</mo></mover><mo>\u2208</mo><mrow><mpadded width=\"+5pt\"><mi>R</mi></mpadded><mo>\u2062</mo><mpadded width=\"+5pt\"><mtext>\u00a0if and only if\u00a0</mtext></mpadded><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mrow><mo>\u2203</mo><mrow><mpadded width=\"+1.7pt\"><mi>u</mi></mpadded><mo>\u2062</mo><mrow><mo>\u2203</mo><mi>v</mi></mrow></mrow></mrow><mo rspace=\"4.2pt\" stretchy=\"false\">)</mo></mrow><mo>\u2062</mo><msub><mi mathvariant=\"normal\">\u03a0</mi><mrow><mn>1</mn><mo>,</mo><mrow><mi>\u03bb</mi><mo>+</mo><mn>1</mn></mrow></mrow></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>u</mi><mo>,</mo><mi>v</mi><mo>,</mo><mover accent=\"true\"><mi>c</mi><mo stretchy=\"false\">\u00af</mo></mover><mo stretchy=\"false\">)</mo></mrow></mrow></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.06450.tex", "nexttext": "\nFor every $i \\in \\{2,\\dots,\\lambda\\}$, the subuniverses $G_i$ and $H_i$ are nonempty (since $B^{i-1} \\times A^{\\lambda-i+1} \\cap R \\neq \\emptyset$ and $A^{i-1} \\times B^{\\lambda-i+1} \\cap R \\neq \\emptyset$) and disjoint (since $B^\\lambda \\cap R = \\emptyset$).\n\nNow we use the fact that the arity $\\lambda$ of $R$ is large. There are $(3^{|A|}-2^{|A|+1}+1)$ ordered pairs of disjoint nonempty subsets of $A$ and $\\lambda-1$ choices for $i$, so, since $\\lambda-1 \\geq 3^{|A|}-1 > (3^{|A|}-2^{|A|+1}+1)$, there must be two different $k < l$ such that $(G_k,H_k) =(G_l,H_l)$.  We fix such $k,l$ and denote \n", "itemtype": "equation", "pos": 38121, "prevtext": "\n\nFor each $i \\in \\{2,\\dots,\\lambda\\}$ we define two subuniverses $G_i, H_i$ of ${\\mathbf{{A}}}$: $a \\in G_i$ if and only if there exists a $(1,i)$-path to $a$ supported by a tuple from $B^{i-1}$, and $a \\in H_i$ if and only if there exists an $(i,\\lambda+1)$-path from $a$ supported by a tuple from $B^{\\lambda-i+1}$. The sets $G_i$ and $H_i$ are indeed subuniverses of ${\\mathbf{{A}}}$, their pp-definitions are the following:\n\n", "index": 33, "text": "\\begin{align*}\n&a\\in G_i\\ \\text{ if and only if }\\ (\\exists u\\,\\exists\\bar z)\\,\\Pi_{1,i}(u,a,\\bar z)\\wedge B^{i-1}(\\bar z)\\\\\n&a\\in H_i\\ \\text{ if and only if }\\ (\\exists v\\,\\exists\\bar z)\\,\\Pi_{i,\\lambda+1}(a,v,\\bar z)\\wedge B^{\\lambda-i+1}(\\bar z).\n\\end{align*}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex20.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle a\\in G_{i}\\ \\text{ if and only if }\\ (\\exists u\\,\\exists\\bar{z})%&#10;\\,\\Pi_{1,i}(u,a,\\bar{z})\\wedge B^{i-1}(\\bar{z})\" display=\"inline\"><mrow><mi>a</mi><mo>\u2208</mo><mrow><mrow><mpadded width=\"+5pt\"><msub><mi>G</mi><mi>i</mi></msub></mpadded><mo>\u2062</mo><mpadded width=\"+5pt\"><mtext>\u00a0if and only if\u00a0</mtext></mpadded><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mrow><mo>\u2203</mo><mrow><mpadded width=\"+1.7pt\"><mi>u</mi></mpadded><mo>\u2062</mo><mrow><mo>\u2203</mo><mover accent=\"true\"><mi>z</mi><mo stretchy=\"false\">\u00af</mo></mover></mrow></mrow></mrow><mo rspace=\"4.2pt\" stretchy=\"false\">)</mo></mrow><mo>\u2062</mo><msub><mi mathvariant=\"normal\">\u03a0</mi><mrow><mn>1</mn><mo>,</mo><mi>i</mi></mrow></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>u</mi><mo>,</mo><mi>a</mi><mo>,</mo><mover accent=\"true\"><mi>z</mi><mo stretchy=\"false\">\u00af</mo></mover><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2227</mo><mrow><msup><mi>B</mi><mrow><mi>i</mi><mo>-</mo><mn>1</mn></mrow></msup><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mover accent=\"true\"><mi>z</mi><mo stretchy=\"false\">\u00af</mo></mover><mo stretchy=\"false\">)</mo></mrow></mrow></mrow></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex21.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle a\\in H_{i}\\ \\text{ if and only if }\\ (\\exists v\\,\\exists\\bar{z})%&#10;\\,\\Pi_{i,\\lambda+1}(a,v,\\bar{z})\\wedge B^{\\lambda-i+1}(\\bar{z}).\" display=\"inline\"><mrow><mrow><mi>a</mi><mo>\u2208</mo><mrow><mrow><mpadded width=\"+5pt\"><msub><mi>H</mi><mi>i</mi></msub></mpadded><mo>\u2062</mo><mpadded width=\"+5pt\"><mtext>\u00a0if and only if\u00a0</mtext></mpadded><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mrow><mo>\u2203</mo><mrow><mpadded width=\"+1.7pt\"><mi>v</mi></mpadded><mo>\u2062</mo><mrow><mo>\u2203</mo><mover accent=\"true\"><mi>z</mi><mo stretchy=\"false\">\u00af</mo></mover></mrow></mrow></mrow><mo rspace=\"4.2pt\" stretchy=\"false\">)</mo></mrow><mo>\u2062</mo><msub><mi mathvariant=\"normal\">\u03a0</mi><mrow><mi>i</mi><mo>,</mo><mrow><mi>\u03bb</mi><mo>+</mo><mn>1</mn></mrow></mrow></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>a</mi><mo>,</mo><mi>v</mi><mo>,</mo><mover accent=\"true\"><mi>z</mi><mo stretchy=\"false\">\u00af</mo></mover><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2227</mo><mrow><msup><mi>B</mi><mrow><mrow><mi>\u03bb</mi><mo>-</mo><mi>i</mi></mrow><mo>+</mo><mn>1</mn></mrow></msup><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mover accent=\"true\"><mi>z</mi><mo stretchy=\"false\">\u00af</mo></mover><mo stretchy=\"false\">)</mo></mrow></mrow></mrow></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.06450.tex", "nexttext": " \nFinally, we define a subuniverse $Q\\leq\\mathbf A^2$ so that $(a,c) \\in Q$ if and only if there exists a $(k,l)$-path from $a$ to $c$,\nand a subuniverse $P\\leq{\\mathbf{{A}}}^2$ if and only if there exists a $(k,l)$-path from $a$ to $c$ supported by a tuple from $B^{l-k}$. \n\nWe verify the assumptions of Lemma~\\ref{lem:walk}.\n\\begin{itemize}\n\\item $P$ and $Q$ are subuniverses of ${\\mathbf{{A}}}^2$ and $P {\\operatorname{\\trianglelefteq_J}} Q$: This follows from Lemma~\\ref{lem:abspp} since $B {\\operatorname{\\trianglelefteq_J}} {\\mathbf{{A}}}$ and these sets can be defined by the pp-formulas\n\n", "itemtype": "equation", "pos": -1, "prevtext": "\nFor every $i \\in \\{2,\\dots,\\lambda\\}$, the subuniverses $G_i$ and $H_i$ are nonempty (since $B^{i-1} \\times A^{\\lambda-i+1} \\cap R \\neq \\emptyset$ and $A^{i-1} \\times B^{\\lambda-i+1} \\cap R \\neq \\emptyset$) and disjoint (since $B^\\lambda \\cap R = \\emptyset$).\n\nNow we use the fact that the arity $\\lambda$ of $R$ is large. There are $(3^{|A|}-2^{|A|+1}+1)$ ordered pairs of disjoint nonempty subsets of $A$ and $\\lambda-1$ choices for $i$, so, since $\\lambda-1 \\geq 3^{|A|}-1 > (3^{|A|}-2^{|A|+1}+1)$, there must be two different $k < l$ such that $(G_k,H_k) =(G_l,H_l)$.  We fix such $k,l$ and denote \n", "index": 35, "text": "\n\\[\nG = G_k = G_l, \\quad H = H_k = H_l\\enspace.\n\\]\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex22.m1\" class=\"ltx_Math\" alttext=\"G=G_{k}=G_{l},\\quad H=H_{k}=H_{l}\\@math@espace.\" display=\"block\"><mrow><mrow><mrow><mi>G</mi><mo>=</mo><msub><mi>G</mi><mi>k</mi></msub><mo>=</mo><msub><mi>G</mi><mi>l</mi></msub></mrow><mo rspace=\"12.5pt\">,</mo><mrow><mi>H</mi><mo>=</mo><msub><mi>H</mi><mi>k</mi></msub><mo>=</mo><mrow><msub><mi>H</mi><mi>l</mi></msub><mo>\u2062</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\@math@espace</mtext></merror></mrow></mrow></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.06450.tex", "nexttext": "\n\\item \n$(a,c) \\in Q$ for some $a \\in G$ and $c \\in H$: As $R$ is $B$-essential, there exists a $(1,\\lambda+1)$-path $(a_1, \\dots, a_{\\lambda+1})$ supported by a tuple from $B^{k-1}\\times A^{l-k} \\times B^{\\lambda-l+1}$.\nThen $a_k \\in G_k=G$, $a_l \\in H_l=H$, and $(a_k,a_l) \\in Q$ by definitions, so we can set $a=a_k$ and $c=a_l$ to satisfy the claim.\n\\item \nFor every $c \\in G$ there exists $a \\in G$ such that $(a,c) \\in P$: Consider a vertex $c \\in G = G_l$. By the definition of $G_l$, there exists a $(1,l)$-path $(a_1,\\dots, a_{l-1},a_l=c)$ supported by a tuple from $B^{l-1}$, thus $a_k \\in G_k = G$ and $(a_k,c) \\in P$. This shows that $a=a_k$ satisfies the claim. \n\\item \nFor every $a \\in H$ there exists $c \\in H$ such that $(a,c) \\in P$: The proof is similar to the previous item.\n\\end{itemize}\nBy Lemma~\\ref{lem:walk} there exists a directed $P$-walk from $G$ to $H$. Since $G$ and $H$ are disjoint, the following item contradicts the conclusion of Lemma~\\ref{lem:walk} and finishes the proof of Theorem~\\ref{thm:core} and Theorem~\\ref{thm:main}.\n\n\\begin{itemize}\n\\item \nIf $a \\in G$ and $(a,c) \\in P$, then $c \\in G$:\nIf $a \\in G = G_k$ and $(a,c) \\in P$, then there exists a $(1,k)$-path $(a_1, \\dots, a_k=a)$ supported by $(b_1, \\dots, b_{k-1}) \\in B^{k-1}$ and a $(k,l)$-path $(a=a_k,a_{k+1}, \\dots, a_l=c)$ supported by $(b_k, \\dots, b_{l-1})$. Then $(a_1, \\dots, a_l)$ is a $(1,l)$-path supported by $(b_1,\\dots, b_{l-1})$, hence $a_l=c \\in G_l = G$. This proves the claim. \n\\end{itemize}\n\n\n\n\n\n\\subsection{Remarks on the proof} \\label{subsec:barto_vs_zhuk}\n\nZhuk's approach used in this paper is different from the proof of the special (congruence meet-semidistributive) case~\\cite{Bulin14} generalizing the proof in~\\cite{Bar13} that a finite, finitely related algebra with J\\'onsson terms has a near unanimity term. In~\\cite{Bar13, Bulin14}, a tree definition of a suitable relation was easily derived from existing results on the constraint satisfaction problem~\\cite{BK09a,BK14}.\n\nUsing Marcin Kozik's improvement of the algebraic machinery from~\\cite{BKW12}, it is possible to prove the main result in a cleaner way, similar to~\\cite{Bar13}. We have chosen the presented approach since the required results of Kozik are not yet written up and our proof is also a bit more elementary. \n\nOur upper bound on $\\kappa$ slightly improves upon the related results in \\cite{Zhuk14,Bar13}. In Zhuk's original paper \\cite{Zhuk14} the upper bound on the arity of a near-unanimity operation is $((|A|-1)(\\theta-1))^{3^{|A|}}+2$. In \\cite{Bar13,Bvaleriote} and the present paper the factor $(|A|-1)$ is reduced to 2 by a simple trick of limiting the maximum degree of the tree formula to 3 (see Subsection \\ref{subsec:preproc}). In \\cite{Bar13,Bulin14} the upper bound (for $\\theta=2$) is $4^{8^{|A|}}+1$. The factor $8^{|A|}$ comes from a pigeonhole argument counting all triples of subsets of $A$. This is suboptimal (as already discussed in \\cite[Lemma 6.5]{Bar13}) and can in fact be readily improved to $3^{|A|}$.\n\nOn the other hand, Zhuk's paper \\cite{Zhuk14} provides the following lower bounds (which can be used in our case too): $\\kappa\\geq(\\theta-1)^{2^{|A|-2}}$ for $\\theta\\geq 3$ and $|A|\\geq 3$, and $\\kappa\\geq2^{2^{|A|-3}}$ for $\\theta=2$ and $|A|\\geq 4$.\n\n\\section{The complexity of deciding absorption}\n\nWe now discuss the computational complexity of the absorption problem whose input is a relational structure ${\\mathbb{{A}}}$ (relations are given by lists of tuples) and a subuniverse $B$ of ${\\mathbf{{A}}} = {\\mathop{\\mathrm{Pol}}} {\\mathbb{{A}}}$; the problem is to decide whether $B {\\operatorname{\\trianglelefteq}} {\\mathbf{{A}}}$. (Recall that we can without loss of generality assume that ${\\mathbb{{A}}}$ contains all the singletons. Also, the assumption that $B$ is a subuniverse is not limiting for the decidability question: a naive algorithm puts testing whether $B$ is a subuniverse in co-NEXPTIME \\cite{Willard10}.)\n\n\nAn ineffective approach, still good enough to show that the absorption problem is decidable, is based on Theorem~\\ref{thm:core} which implies that it is enough to check operations of arity $\\kappa = \\frac{1}{2}(2\\theta-2)^{3^{|A|}}+1$.\n\nA better strategy is to directly use the main theorem, Theorem~\\ref{thm:main}, which shows that it is enough to verify $B {\\operatorname{\\trianglelefteq_J}} {\\mathbf{{A}}}$. A straightforward approach would be to find all ternary idempotent polymorphisms of ${\\mathbb{{A}}}$ and look for a J\\'onsson absorbing chain among them. A better way to test whether $B {\\operatorname{\\trianglelefteq_J}} {\\mathbf{{A}}}$ is to use the following local characterization of J\\'onsson absorption from \\cite{BKazda}.\n\n\\begin{theorem}\\label{thm:jabs_local}\n  Let ${\\mathbf{{A}}}$ be a finite idempotent algebra and $B\\leq {\\mathbf{{A}}}$. Then $B{\\operatorname{\\trianglelefteq_J}}\n  {\\mathbf{{A}}}$ if and only if \n  for every $a,c,d\\in A$ and every $b_1,b_2\\in B$, the digraph ${\\mathbb{{G}}}=(A,E)$ with the\n  edge set\n \n", "itemtype": "equation", "pos": 39631, "prevtext": " \nFinally, we define a subuniverse $Q\\leq\\mathbf A^2$ so that $(a,c) \\in Q$ if and only if there exists a $(k,l)$-path from $a$ to $c$,\nand a subuniverse $P\\leq{\\mathbf{{A}}}^2$ if and only if there exists a $(k,l)$-path from $a$ to $c$ supported by a tuple from $B^{l-k}$. \n\nWe verify the assumptions of Lemma~\\ref{lem:walk}.\n\\begin{itemize}\n\\item $P$ and $Q$ are subuniverses of ${\\mathbf{{A}}}^2$ and $P {\\operatorname{\\trianglelefteq_J}} Q$: This follows from Lemma~\\ref{lem:abspp} since $B {\\operatorname{\\trianglelefteq_J}} {\\mathbf{{A}}}$ and these sets can be defined by the pp-formulas\n\n", "index": 37, "text": "\\begin{align*}\n&(u,v)\\in Q\\ \\text{ if and only if }\\ (\\exists\\bar z)\\,\\Pi_{k,l}(u,v,\\bar z)\\\\\n&(u,v)\\in P\\ \\text{ if and only if }\\ (\\exists\\bar z)\\,\\Pi_{k,l}(u,v,\\bar z)\\wedge B^{k-l}(\\bar z)\\\\\n\\end{align*}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex23.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle(u,v)\\in Q\\ \\text{ if and only if }\\ (\\exists\\bar{z})\\,\\Pi_{k,l}(%&#10;u,v,\\bar{z})\" display=\"inline\"><mrow><mrow><mo stretchy=\"false\">(</mo><mi>u</mi><mo>,</mo><mi>v</mi><mo stretchy=\"false\">)</mo></mrow><mo>\u2208</mo><mrow><mpadded width=\"+5pt\"><mi>Q</mi></mpadded><mo>\u2062</mo><mpadded width=\"+5pt\"><mtext>\u00a0if and only if\u00a0</mtext></mpadded><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mrow><mo>\u2203</mo><mover accent=\"true\"><mi>z</mi><mo stretchy=\"false\">\u00af</mo></mover></mrow><mo rspace=\"4.2pt\" stretchy=\"false\">)</mo></mrow><mo>\u2062</mo><msub><mi mathvariant=\"normal\">\u03a0</mi><mrow><mi>k</mi><mo>,</mo><mi>l</mi></mrow></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>u</mi><mo>,</mo><mi>v</mi><mo>,</mo><mover accent=\"true\"><mi>z</mi><mo stretchy=\"false\">\u00af</mo></mover><mo stretchy=\"false\">)</mo></mrow></mrow></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex24.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle(u,v)\\in P\\ \\text{ if and only if }\\ (\\exists\\bar{z})\\,\\Pi_{k,l}(%&#10;u,v,\\bar{z})\\wedge B^{k-l}(\\bar{z})\" display=\"inline\"><mrow><mrow><mo stretchy=\"false\">(</mo><mi>u</mi><mo>,</mo><mi>v</mi><mo stretchy=\"false\">)</mo></mrow><mo>\u2208</mo><mrow><mrow><mpadded width=\"+5pt\"><mi>P</mi></mpadded><mo>\u2062</mo><mpadded width=\"+5pt\"><mtext>\u00a0if and only if\u00a0</mtext></mpadded><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mrow><mo>\u2203</mo><mover accent=\"true\"><mi>z</mi><mo stretchy=\"false\">\u00af</mo></mover></mrow><mo rspace=\"4.2pt\" stretchy=\"false\">)</mo></mrow><mo>\u2062</mo><msub><mi mathvariant=\"normal\">\u03a0</mi><mrow><mi>k</mi><mo>,</mo><mi>l</mi></mrow></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>u</mi><mo>,</mo><mi>v</mi><mo>,</mo><mover accent=\"true\"><mi>z</mi><mo stretchy=\"false\">\u00af</mo></mover><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2227</mo><mrow><msup><mi>B</mi><mrow><mi>k</mi><mo>-</mo><mi>l</mi></mrow></msup><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mover accent=\"true\"><mi>z</mi><mo stretchy=\"false\">\u00af</mo></mover><mo stretchy=\"false\">)</mo></mrow></mrow></mrow></mrow></math>", "type": "latex"}, {"file": "1601.06450.tex", "nexttext": "\ncontains a directed path from $a$ to $c$.\n\\end{theorem} \n\nThe subuniverse $R=\\langle(b_1,a,a)$, $(b_2,c,c)$, $(d,a,c)\\rangle \\leq {\\mathbf{{A}}}^3$ \ncan be visualised as a colored digraph: an element $(b,u,v)$ is regarded as the edge $(u,v)$ colored by $b$. \nThe theorem asks for a $B$-colored directed path from $a$ to $c$.\n\nTheorem~\\ref{thm:jabs_local} gives us a straightforward NP algorithm to test whether a given subuniverse $B$ is J{\\' o}nsson absorbing as claimed in Theorem~\\ref{thm:complexity}: We try all possible $a,c,d\\in A$,\n$b_1,b_2\\in B$ (there are polynomially many such choices).  For each choice we need a polynomial witness for existence of a $B$-colored path from $a$ to $c$. Note that such a path, if it exists, can be given by polynomially many (at most $|A|$) triples from $R$. The fact that a certain triple $(b,u,v)$ lies in $R$ can be witnessed by giving a table of some ternary polymorphism $\\varphi$ that generates $(b,u,v)$ from the tuples $(b_1,a,a), (b_2,c,c), (d,a,c)$; it can be verified in polynomial time that $\\varphi$ is a polymorphism of ${\\mathbb{A}}$.\n\n\n\n\n\n\n\\section{Conclusion}\n\nOur main result, that a subuniverse of a finitely related finite algebra is absorbing if and only if it is J\\'onsson absorbing, can be thought of as a ``decomposed version'' of the main result of~\\cite{Bar13} which says that all the singletons of a finitely related finite algebra are absorbing if and only if they are J\\'onsson absorbing.\nIn~\\cite{Bvaleriote} it was shown that a finitely related finite algebra has Gumm terms if and only if it has cube terms. Is there a decomposed version of this result, that is, a useful notion of ``cube absorption'' which coincides with Gumm absorption for finitely related algebras?\n\n\n\n\n\n\n\n\\bibliographystyle{plain}\n\n\\normalsize\n\\baselineskip=17pt\n\n\\bibliography{absrelstr}\n\n\n\n\n", "itemtype": "equation", "pos": 44847, "prevtext": "\n\\item \n$(a,c) \\in Q$ for some $a \\in G$ and $c \\in H$: As $R$ is $B$-essential, there exists a $(1,\\lambda+1)$-path $(a_1, \\dots, a_{\\lambda+1})$ supported by a tuple from $B^{k-1}\\times A^{l-k} \\times B^{\\lambda-l+1}$.\nThen $a_k \\in G_k=G$, $a_l \\in H_l=H$, and $(a_k,a_l) \\in Q$ by definitions, so we can set $a=a_k$ and $c=a_l$ to satisfy the claim.\n\\item \nFor every $c \\in G$ there exists $a \\in G$ such that $(a,c) \\in P$: Consider a vertex $c \\in G = G_l$. By the definition of $G_l$, there exists a $(1,l)$-path $(a_1,\\dots, a_{l-1},a_l=c)$ supported by a tuple from $B^{l-1}$, thus $a_k \\in G_k = G$ and $(a_k,c) \\in P$. This shows that $a=a_k$ satisfies the claim. \n\\item \nFor every $a \\in H$ there exists $c \\in H$ such that $(a,c) \\in P$: The proof is similar to the previous item.\n\\end{itemize}\nBy Lemma~\\ref{lem:walk} there exists a directed $P$-walk from $G$ to $H$. Since $G$ and $H$ are disjoint, the following item contradicts the conclusion of Lemma~\\ref{lem:walk} and finishes the proof of Theorem~\\ref{thm:core} and Theorem~\\ref{thm:main}.\n\n\\begin{itemize}\n\\item \nIf $a \\in G$ and $(a,c) \\in P$, then $c \\in G$:\nIf $a \\in G = G_k$ and $(a,c) \\in P$, then there exists a $(1,k)$-path $(a_1, \\dots, a_k=a)$ supported by $(b_1, \\dots, b_{k-1}) \\in B^{k-1}$ and a $(k,l)$-path $(a=a_k,a_{k+1}, \\dots, a_l=c)$ supported by $(b_k, \\dots, b_{l-1})$. Then $(a_1, \\dots, a_l)$ is a $(1,l)$-path supported by $(b_1,\\dots, b_{l-1})$, hence $a_l=c \\in G_l = G$. This proves the claim. \n\\end{itemize}\n\n\n\n\n\n\\subsection{Remarks on the proof} \\label{subsec:barto_vs_zhuk}\n\nZhuk's approach used in this paper is different from the proof of the special (congruence meet-semidistributive) case~\\cite{Bulin14} generalizing the proof in~\\cite{Bar13} that a finite, finitely related algebra with J\\'onsson terms has a near unanimity term. In~\\cite{Bar13, Bulin14}, a tree definition of a suitable relation was easily derived from existing results on the constraint satisfaction problem~\\cite{BK09a,BK14}.\n\nUsing Marcin Kozik's improvement of the algebraic machinery from~\\cite{BKW12}, it is possible to prove the main result in a cleaner way, similar to~\\cite{Bar13}. We have chosen the presented approach since the required results of Kozik are not yet written up and our proof is also a bit more elementary. \n\nOur upper bound on $\\kappa$ slightly improves upon the related results in \\cite{Zhuk14,Bar13}. In Zhuk's original paper \\cite{Zhuk14} the upper bound on the arity of a near-unanimity operation is $((|A|-1)(\\theta-1))^{3^{|A|}}+2$. In \\cite{Bar13,Bvaleriote} and the present paper the factor $(|A|-1)$ is reduced to 2 by a simple trick of limiting the maximum degree of the tree formula to 3 (see Subsection \\ref{subsec:preproc}). In \\cite{Bar13,Bulin14} the upper bound (for $\\theta=2$) is $4^{8^{|A|}}+1$. The factor $8^{|A|}$ comes from a pigeonhole argument counting all triples of subsets of $A$. This is suboptimal (as already discussed in \\cite[Lemma 6.5]{Bar13}) and can in fact be readily improved to $3^{|A|}$.\n\nOn the other hand, Zhuk's paper \\cite{Zhuk14} provides the following lower bounds (which can be used in our case too): $\\kappa\\geq(\\theta-1)^{2^{|A|-2}}$ for $\\theta\\geq 3$ and $|A|\\geq 3$, and $\\kappa\\geq2^{2^{|A|-3}}$ for $\\theta=2$ and $|A|\\geq 4$.\n\n\\section{The complexity of deciding absorption}\n\nWe now discuss the computational complexity of the absorption problem whose input is a relational structure ${\\mathbb{{A}}}$ (relations are given by lists of tuples) and a subuniverse $B$ of ${\\mathbf{{A}}} = {\\mathop{\\mathrm{Pol}}} {\\mathbb{{A}}}$; the problem is to decide whether $B {\\operatorname{\\trianglelefteq}} {\\mathbf{{A}}}$. (Recall that we can without loss of generality assume that ${\\mathbb{{A}}}$ contains all the singletons. Also, the assumption that $B$ is a subuniverse is not limiting for the decidability question: a naive algorithm puts testing whether $B$ is a subuniverse in co-NEXPTIME \\cite{Willard10}.)\n\n\nAn ineffective approach, still good enough to show that the absorption problem is decidable, is based on Theorem~\\ref{thm:core} which implies that it is enough to check operations of arity $\\kappa = \\frac{1}{2}(2\\theta-2)^{3^{|A|}}+1$.\n\nA better strategy is to directly use the main theorem, Theorem~\\ref{thm:main}, which shows that it is enough to verify $B {\\operatorname{\\trianglelefteq_J}} {\\mathbf{{A}}}$. A straightforward approach would be to find all ternary idempotent polymorphisms of ${\\mathbb{{A}}}$ and look for a J\\'onsson absorbing chain among them. A better way to test whether $B {\\operatorname{\\trianglelefteq_J}} {\\mathbf{{A}}}$ is to use the following local characterization of J\\'onsson absorption from \\cite{BKazda}.\n\n\\begin{theorem}\\label{thm:jabs_local}\n  Let ${\\mathbf{{A}}}$ be a finite idempotent algebra and $B\\leq {\\mathbf{{A}}}$. Then $B{\\operatorname{\\trianglelefteq_J}}\n  {\\mathbf{{A}}}$ if and only if \n  for every $a,c,d\\in A$ and every $b_1,b_2\\in B$, the digraph ${\\mathbb{{G}}}=(A,E)$ with the\n  edge set\n \n", "index": 39, "text": "\\[\n    E=\\{(u,v)\\mid \\exists b\\in B, (b,u,v)\\in \\langle(b_1,a,a), (b_2,c,c),\n    (d,a,c)\\rangle\\}\n  \\]\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex26.m1\" class=\"ltx_Math\" alttext=\"E=\\{(u,v)\\mid\\exists b\\in B,(b,u,v)\\in\\langle(b_{1},a,a),(b_{2},c,c),(d,a,c)\\rangle\\}\" display=\"block\"><mrow><mi>E</mi><mo>=</mo><mrow><mo stretchy=\"false\">{</mo><mrow><mo stretchy=\"false\">(</mo><mi>u</mi><mo>,</mo><mi>v</mi><mo stretchy=\"false\">)</mo></mrow><mo>\u2223</mo><mrow><mrow><mrow><mo>\u2203</mo><mi>b</mi></mrow><mo>\u2208</mo><mi>B</mi></mrow><mo>,</mo><mrow><mrow><mo stretchy=\"false\">(</mo><mi>b</mi><mo>,</mo><mi>u</mi><mo>,</mo><mi>v</mi><mo stretchy=\"false\">)</mo></mrow><mo>\u2208</mo><mrow><mo stretchy=\"false\">\u27e8</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>b</mi><mn>1</mn></msub><mo>,</mo><mi>a</mi><mo>,</mo><mi>a</mi><mo stretchy=\"false\">)</mo></mrow><mo>,</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>b</mi><mn>2</mn></msub><mo>,</mo><mi>c</mi><mo>,</mo><mi>c</mi><mo stretchy=\"false\">)</mo></mrow><mo>,</mo><mrow><mo stretchy=\"false\">(</mo><mi>d</mi><mo>,</mo><mi>a</mi><mo>,</mo><mi>c</mi><mo stretchy=\"false\">)</mo></mrow><mo stretchy=\"false\">\u27e9</mo></mrow></mrow></mrow><mo stretchy=\"false\">}</mo></mrow></mrow></math>", "type": "latex"}]