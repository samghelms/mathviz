[{"file": "1601.07931.tex", "nexttext": "\n\nIn the example in Section~\\ref{sec:applications}, each trait is a word in one of 210 meaning categories and each taxon is an Eastern Polynesian language. For example, the Maori and Hawaiian words for \\emph{woman} and \\emph{wife}, both \\emph{wahine}, are derived from a common ancestor \\emph{h}, say, so $ d_{\\mathrm{Maori}}^h = d_{\\mathrm{Hawaiian}}^h = 1 $. On the other hand, the Maori word for \\emph{mother}, \\emph{whaea}, is not related to its Hawaiian counterpart, \\emph{makuahine}, so they correspond to separate columns in the data.\n\nWe denote by \\textbf{D} the array recording the status of each trait across the observed taxa. A column $ \\bd^h $ of $ \\bD $ is a \\emph{site-pattern} displaying the status of trait \\emph{h} across the taxa. These patterns shall form the basis of our inference method.\n\n\n\n\\section{Stochastic Dollo with Lateral Transfer model}\n\\label{sec:model}\n\nA branching process on sets of traits determines the phylogeny of the observed taxa. Each set represents an evolving species. A branching event on the tree corresponds to a speciation event whereby a set is replaced by two identical offspring, and a leaf represents an observed taxon. The set contents diversify according to a trait process, and finally the status of each trait is recorded in the taxa. Figure~\\ref{fig:phyTree} depicts a realisation of the model and the history of a single trait which, due to two lateral transfer events, bears little resemblance to the underlying phylogeny.\n\n\n\\begin{figure}[p!ht]\n\\centering\n\\includegraphics[width=\\textwidth]{PhytreePattern.pdf}\n\\caption{Description of the Stochastic Dollo with Lateral Transfer model. Catastrophes, missing data and offset leaves are introduced in Section~\\ref{sec:modExt}.}\n\\label{fig:phyTree}\n\\end{figure}\n\nWe first define our model and inference method in terms of binary patterns of trait presence or absence in taxa which are observed simultaneously. It is then straightforward to extend the model to more complex scenarios.\n\n\n\n\\subsection{Rooted phylogenetic trees}\n\\label{sec:trees}\n\nA rooted phylogenetic tree $ g = (V, E, T) $ on \\emph{L} leaves is a connected acyclic graph with node set $ V = \\{0, 1, \\dotsc, 2L - 1\\} $, directed edge set $ E \\subset V \\times V $ and node times $ T \\in \\{-\\infty\\} \\times \\R_{\\leq 0}^{2L - 1} $. The node set \\emph{V} comprises one \\emph{Adam} node labelled 0 of degree 1, the internal nodes $ V_A = \\{1, 2, \\dotsc, L - 1\\} $ of degree 3 and the leaf nodes $ V_L = \\{L, L + 1, \\dotsc, 2L - 1\\} $ of degree 1. Each node $ i \\in V $ is assigned a time $ t_i \\in T $ denoting when the corresponding event occurred relative to the current time, 0. For convenience, we label the internal nodes in such a way that $ t_1, \\dotsc, t_{L - 1} $ is a strictly increasing sequence of node times.\n\nEdges represent evolving species and are directed forwards in time. We label each edge by its offspring node so if $ \\pa(i) $ denotes the parent of node $ i \\in V \\setminus \\{0\\} $, edge \\emph{i} runs from node $ \\pa(i) $ at time $ t_{\\pa(i)} $ to \\emph{i} at time $ t_i $. We assume the Adam node arose at time $ t_0 = -\\infty $ so a branch of infinite length connects it to the \\emph{root} node 1 at time $ t_1 $. The leaves are observed at time 0. At time \\emph{t}, there are $ \\Lt $ species labelled $ \\kt = (i \\in E : t_{\\pa(i)} \\leq t < t_i) $. For example, after the speciation event at time $ t_2 $ in Figure~\\ref{fig:phyTree}, there are $ L^{(t_2)} = 3 $ species labelled $ \\bk^{(t_2)} = (8, 4, 3) $.\n\n\n\n\\subsection{Trait evolution}\n\\label{sec:trait}\n\nLetting $ H_i(t) \\subset \\Z $ denote the set of traits possessed by species $ i \\in \\kt $ at time \\emph{t}, we now define four properties of the set-valued evolutionary process $ H(t) = \\{H_i(t) : i \\in \\kt\\} $.\n\n\\begin{myprop}[Set branching event]\n\\label{tp:branch}\nAt a speciation event, the traits present in the parent are copied into the offspring. Species $ i \\in \\bk^{(t_i^-)} $ branches at time $ t_i $ and is replaced by two identical offspring, \\emph{j} and $ k \\in \\bk^{(t_i)} $, and\n\n", "itemtype": "equation", "pos": 6936, "prevtext": "\n\n\\maketitle\n\n\n\\begin{abstract}\n\nLateral transfer, a process whereby species exchange evolutionary traits through non-ancestral relationships, is a frequent source of model misspecification when inferring ancestral trees. Lateral transfer obscures the phylogenetic signal in the data as individual trait histories are a mosaic of the species phylogeny. We control for the effect of lateral transfer in a Stochastic Dollo model and a Bayesian setting. Our likelihood is highly intractable as parameters are given by the solution of a sequence of large systems of differential equations. We illustrate our method on a data set of lexical traits in Eastern Polynesian languages and obtain an improved fit over the corresponding model without lateral transfer.\n\n\\end{abstract}\n\n\n\n\\section{Introduction}\n\\label{sec:intro}\n\nComplex evolutionary traits provide a basis for inferring the ancestry of a set of taxa. These traits may derive from sequences such as DNA or an unordered set of morphological characters, for example. When species evolve in isolation, it is reasonable to assume that traits are passed vertically from one generation to the next through ancestral relationships. The shared ancestry of the taxa may be described by a phylogenetic tree where branches represent evolving species and nodes speciation events. We are concerned with inferring the phylogeny of taxa which also evolve through \\emph{lateral transfer}. Lateral transfer, such as \\emph{horizontal gene transfer} or \\emph{borrowing}, is one of the processes driving the evolution of populations whereby traits are passed through non-vertical relationships between contemporary species, and is of scientific interest in fields ranging from anthropology and linguistics to public health.\n\nIn the absence of lateral transfer, individual trait histories are compatible with the species phylogeny and there are many statistical methods to infer phylogenies in this setting, generally using a model-based approach to comparing traits across species. When lateral transfer occurs, individual trait histories are a mosaic of the species phylogeny and while each one is tree-like, they are in conflict with the phylogeny. This obscures the phylogenetic signal of the branching events and models based solely on vertical inheritance are misspecified in this setting. In our experience, this model error can lead to overly high levels of confidence in poorly fitting trees.   Despite its importance, the problem of lateral transfer has received little attention in the statistics literature. This article develops a Bayesian method which explicitly accounts for lateral transfer in phylogeny reconstruction.\n\nIn this paper, we apply our method to a data set of lexical traits in Eastern Polynesian languages. There have been many phylogenetic studies of language families, some tracing the phylogenies of the languages themselves \\citep{gray03, nicholls08, ryder11, chang15} and others the movements of the peoples who spoke them \\citep{gray09, bouckaert12}. Lateral transfer is a frequent occurrence in language diversification \\citep{greenhill09}, yet there has not been a satisfactory statistical analysis controlling for its effect. Researchers typically discard known-transferred traits and fit a vertical model to the remainder [\\citeauthor{gray03, bouckaert12}; and many others]. This is problematic as recently transferred traits are more readily identified and removed, so the discarded traits may not be a random thinning of the data.\n\nFor a simple lateral transfer model, \\citet{roch13} show that distance-based methods can recover the true phylogeny up to relatively high transfer rates. \\citet{szollosi12} discretise time on a tree and limit the number of lateral transfer events which may occur in each interval. Systems of differential equations are used to compute the likelihood of a gene tree given the underlying species phylogeny and the model returns a time-ordering of the internal nodes.\n\nPhylogenetic networks offer an alternative approach to modelling lateral transfer. Internal nodes in \\emph{implicit} network models accommodate incompatibilities in the data but, in contrast to \\emph{explicit} models, do not necessarily represent the evolutionary history of the taxa \\citep{huson06}. The ancestral recombination graph \\citep{hudson83}, often treated as a nuisance parameter in the population genetics literature, provides an explicit framework for modelling lateral transfer whereby each trait history is derived from the graph \\citep{bloomquist10}.\n\nOf particular interest to us is the \\emph{Stochastic Dollo} (SD) model for unordered sets of traits proposed by \\citeauthor{nicholls08} and extended by \\citet{alekseyenko08} for multiple character states and \\citeauthor{ryder11} for missing data and rate heterogeneity. The SD model posits a birth-death process of traits along branches of the tree and traits are copied into the offspring lineages at a speciation event. The basic process respects \\emph{Dollo parsimony}: each trait is born exactly once, and once extinct, remains so. Simulation studies of the SD model have shown that topology estimates are robust to \\emph{moderate} levels of lateral transfer when the underlying topology is balanced but the root time tends to be biased towards the present {(\\citeauthor{{nicholls08, greenhill09, ryder11}})}.\n\n\\citeauthor{nicholls08} describe how to simulate lateral transfer in the basic Stochastic Dollo model. We perform full likelihood-based inference with this model. Traits may transfer randomly between evolving species in a similar manner to the model considered by \\citeauthor{roch13}. There are also similarities between our method and the time-discretised model proposed by \\citet{szollosi12} in that we integrate over all possible trait birth, death and lateral transfer events on the phylogeny using systems of differential equations. However, by working in a continuous-time setting, we are able to infer the timing of speciation events rather than their chronology. The rest of this article is arranged as follows: in Section~\\ref{sec:data}, we describe the format of the data which motivates the model introduced in Section~\\ref{sec:model}; we discuss our inference method in Section~\\ref{sec:inference} and tests to validate our implementation of it in Section~\\ref{sec:testing}; finally, in Section~\\ref{sec:applications}, we illustrate our model on a data set of lexical traits in Eastern Polynesian languages.\n\n\n\n\\section{Homologous trait data}\n\\label{sec:data}\n\nThe observed taxa are the end result of a diversification process on sets of traits. \\emph{Homologous} traits are derived from a common ancestral trait through a combination of vertical inheritance and lateral transfer events. Pairwise homologous traits are distinguishable and assigned a unique common label from the set of trait labels, $ \\Z $. We record the status of trait \\emph{h} in taxon \\emph{i} as\n", "index": 1, "text": "\n\\[\nd_i^h =\n\\left\\{\n\\begin{array}{ll}\n0, \\quad & \\text{trait \\emph{h} is absent in taxon \\emph{i},} \\vspace{1pt}\\\\\n1, \\quad & \\text{trait \\emph{h} is present in taxon \\emph{i},} \\vspace{1pt}\\\\\n?, \\quad & \\text{the status of trait \\emph{h} in taxon \\emph{i} is unknown.} \\\\\n\\end{array}\n\\right.\n\\]\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex1.m1\" class=\"ltx_Math\" alttext=\"d_{i}^{h}=\\left\\{\\begin{array}[]{ll}0,&amp;\\text{trait \\emph{h} is absent in taxon%&#10; \\emph{i},}\\\\&#10;1,&amp;\\text{trait \\emph{h} is present in taxon \\emph{i},}\\\\&#10;?,&amp;\\text{the status of trait \\emph{h} in taxon \\emph{i} is unknown.}\\\\&#10;\\end{array}\\right.\" display=\"block\"><mrow><msubsup><mi>d</mi><mi>i</mi><mi>h</mi></msubsup><mo>=</mo><mrow><mo>{</mo><mtable columnspacing=\"5pt\" displaystyle=\"true\" rowspacing=\"0pt\"><mtr><mtd columnalign=\"left\"><mrow><mn>0</mn><mo>,</mo></mrow></mtd><mtd columnalign=\"left\"><mrow><mtext>trait\u00a0</mtext><mtext><em xmlns=\"http://www.w3.org/1999/xhtml\" class=\"ltx_emph\">h</em></mtext><mtext>\u00a0is absent in taxon\u00a0</mtext><mtext><em xmlns=\"http://www.w3.org/1999/xhtml\" class=\"ltx_emph\">i</em></mtext><mtext>,</mtext></mrow></mtd></mtr><mtr><mtd columnalign=\"left\"><mrow><mn>1</mn><mo>,</mo></mrow></mtd><mtd columnalign=\"left\"><mrow><mtext>trait\u00a0</mtext><mtext><em xmlns=\"http://www.w3.org/1999/xhtml\" class=\"ltx_emph\">h</em></mtext><mtext>\u00a0is present in taxon\u00a0</mtext><mtext><em xmlns=\"http://www.w3.org/1999/xhtml\" class=\"ltx_emph\">i</em></mtext><mtext>,</mtext></mrow></mtd></mtr><mtr><mtd columnalign=\"left\"><mrow><mi mathvariant=\"normal\">?</mi><mo>,</mo></mrow></mtd><mtd columnalign=\"left\"><mrow><mtext>the status of trait\u00a0</mtext><mtext><em xmlns=\"http://www.w3.org/1999/xhtml\" class=\"ltx_emph\">h</em></mtext><mtext>\u00a0in taxon\u00a0</mtext><mtext><em xmlns=\"http://www.w3.org/1999/xhtml\" class=\"ltx_emph\">i</em></mtext><mtext>\u00a0is unknown.</mtext></mrow></mtd></mtr></mtable><mi/></mrow></mrow></math>", "type": "latex"}, {"file": "1601.07931.tex", "nexttext": "\nwhere $ t_i^- $ denotes the time just before the branching event.\n\\end{myprop}\n\n\\begin{myprop}[Trait birth]\n\\label{tp:birth}\nNew traits are born at rate $ \\lambda $ in each extant species. If trait $ h \\in \\Z $ is born in species $ i $ at time \\emph{t},\n", "itemtype": "equation", "pos": 11278, "prevtext": "\n\nIn the example in Section~\\ref{sec:applications}, each trait is a word in one of 210 meaning categories and each taxon is an Eastern Polynesian language. For example, the Maori and Hawaiian words for \\emph{woman} and \\emph{wife}, both \\emph{wahine}, are derived from a common ancestor \\emph{h}, say, so $ d_{\\mathrm{Maori}}^h = d_{\\mathrm{Hawaiian}}^h = 1 $. On the other hand, the Maori word for \\emph{mother}, \\emph{whaea}, is not related to its Hawaiian counterpart, \\emph{makuahine}, so they correspond to separate columns in the data.\n\nWe denote by \\textbf{D} the array recording the status of each trait across the observed taxa. A column $ \\bd^h $ of $ \\bD $ is a \\emph{site-pattern} displaying the status of trait \\emph{h} across the taxa. These patterns shall form the basis of our inference method.\n\n\n\n\\section{Stochastic Dollo with Lateral Transfer model}\n\\label{sec:model}\n\nA branching process on sets of traits determines the phylogeny of the observed taxa. Each set represents an evolving species. A branching event on the tree corresponds to a speciation event whereby a set is replaced by two identical offspring, and a leaf represents an observed taxon. The set contents diversify according to a trait process, and finally the status of each trait is recorded in the taxa. Figure~\\ref{fig:phyTree} depicts a realisation of the model and the history of a single trait which, due to two lateral transfer events, bears little resemblance to the underlying phylogeny.\n\n\n\\begin{figure}[p!ht]\n\\centering\n\\includegraphics[width=\\textwidth]{PhytreePattern.pdf}\n\\caption{Description of the Stochastic Dollo with Lateral Transfer model. Catastrophes, missing data and offset leaves are introduced in Section~\\ref{sec:modExt}.}\n\\label{fig:phyTree}\n\\end{figure}\n\nWe first define our model and inference method in terms of binary patterns of trait presence or absence in taxa which are observed simultaneously. It is then straightforward to extend the model to more complex scenarios.\n\n\n\n\\subsection{Rooted phylogenetic trees}\n\\label{sec:trees}\n\nA rooted phylogenetic tree $ g = (V, E, T) $ on \\emph{L} leaves is a connected acyclic graph with node set $ V = \\{0, 1, \\dotsc, 2L - 1\\} $, directed edge set $ E \\subset V \\times V $ and node times $ T \\in \\{-\\infty\\} \\times \\R_{\\leq 0}^{2L - 1} $. The node set \\emph{V} comprises one \\emph{Adam} node labelled 0 of degree 1, the internal nodes $ V_A = \\{1, 2, \\dotsc, L - 1\\} $ of degree 3 and the leaf nodes $ V_L = \\{L, L + 1, \\dotsc, 2L - 1\\} $ of degree 1. Each node $ i \\in V $ is assigned a time $ t_i \\in T $ denoting when the corresponding event occurred relative to the current time, 0. For convenience, we label the internal nodes in such a way that $ t_1, \\dotsc, t_{L - 1} $ is a strictly increasing sequence of node times.\n\nEdges represent evolving species and are directed forwards in time. We label each edge by its offspring node so if $ \\pa(i) $ denotes the parent of node $ i \\in V \\setminus \\{0\\} $, edge \\emph{i} runs from node $ \\pa(i) $ at time $ t_{\\pa(i)} $ to \\emph{i} at time $ t_i $. We assume the Adam node arose at time $ t_0 = -\\infty $ so a branch of infinite length connects it to the \\emph{root} node 1 at time $ t_1 $. The leaves are observed at time 0. At time \\emph{t}, there are $ \\Lt $ species labelled $ \\kt = (i \\in E : t_{\\pa(i)} \\leq t < t_i) $. For example, after the speciation event at time $ t_2 $ in Figure~\\ref{fig:phyTree}, there are $ L^{(t_2)} = 3 $ species labelled $ \\bk^{(t_2)} = (8, 4, 3) $.\n\n\n\n\\subsection{Trait evolution}\n\\label{sec:trait}\n\nLetting $ H_i(t) \\subset \\Z $ denote the set of traits possessed by species $ i \\in \\kt $ at time \\emph{t}, we now define four properties of the set-valued evolutionary process $ H(t) = \\{H_i(t) : i \\in \\kt\\} $.\n\n\\begin{myprop}[Set branching event]\n\\label{tp:branch}\nAt a speciation event, the traits present in the parent are copied into the offspring. Species $ i \\in \\bk^{(t_i^-)} $ branches at time $ t_i $ and is replaced by two identical offspring, \\emph{j} and $ k \\in \\bk^{(t_i)} $, and\n\n", "index": 3, "text": "\\begin{align*}\nH_j(t_i) &\\leftarrow H_i(t_i^-), \\\\\nH_k(t_i) &\\leftarrow H_i(t_i^-),\n\\end{align*}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex2.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle H_{j}(t_{i})\" display=\"inline\"><mrow><msub><mi>H</mi><mi>j</mi></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>t</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo></mrow></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex2.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle\\leftarrow H_{i}(t_{i}^{-}),\" display=\"inline\"><mrow><mrow><mi/><mo>\u2190</mo><mrow><msub><mi>H</mi><mi>i</mi></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msubsup><mi>t</mi><mi>i</mi><mo>-</mo></msubsup><mo stretchy=\"false\">)</mo></mrow></mrow></mrow><mo>,</mo></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex3.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle H_{k}(t_{i})\" display=\"inline\"><mrow><msub><mi>H</mi><mi>k</mi></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>t</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo></mrow></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex3.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle\\leftarrow H_{i}(t_{i}^{-}),\" display=\"inline\"><mrow><mrow><mi/><mo>\u2190</mo><mrow><msub><mi>H</mi><mi>i</mi></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msubsup><mi>t</mi><mi>i</mi><mo>-</mo></msubsup><mo stretchy=\"false\">)</mo></mrow></mrow></mrow><mo>,</mo></mrow></math>", "type": "latex"}, {"file": "1601.07931.tex", "nexttext": "\n\\end{myprop}\n\n\\begin{myprop}[Trait death]\n\\label{tp:death}\nA species kills off each trait it possesses independently at rate $ \\mu $. If trait $ h \\in H_i(t^-) $ in species $ i $ dies at time \\emph{t},\n", "itemtype": "equation", "pos": 11628, "prevtext": "\nwhere $ t_i^- $ denotes the time just before the branching event.\n\\end{myprop}\n\n\\begin{myprop}[Trait birth]\n\\label{tp:birth}\nNew traits are born at rate $ \\lambda $ in each extant species. If trait $ h \\in \\Z $ is born in species $ i $ at time \\emph{t},\n", "index": 5, "text": "\n\\[\nH_i(t) \\leftarrow H_i(t^-) \\cup \\{h\\}.\n\\]\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex4.m1\" class=\"ltx_Math\" alttext=\"H_{i}(t)\\leftarrow H_{i}(t^{-})\\cup\\{h\\}.\" display=\"block\"><mrow><mrow><mrow><msub><mi>H</mi><mi>i</mi></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2190</mo><mrow><mrow><msub><mi>H</mi><mi>i</mi></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msup><mi>t</mi><mo>-</mo></msup><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u222a</mo><mrow><mo stretchy=\"false\">{</mo><mi>h</mi><mo stretchy=\"false\">}</mo></mrow></mrow></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.07931.tex", "nexttext": "\n\\end{myprop}\n\n\\begin{myprop}[Lateral trait transfer]\n\\label{tp:transfer}\nA species acquires a copy of a trait by lateral transfer at rate $ \\beta $ scaled by the fraction of species which already possess it. If species \\emph{i} acquires a copy of trait $ h \\in \\cHtm = \\bigcup_{i \\in \\ktm} H_i(t^-) $ at time \\emph{t},\n", "itemtype": "equation", "pos": 11875, "prevtext": "\n\\end{myprop}\n\n\\begin{myprop}[Trait death]\n\\label{tp:death}\nA species kills off each trait it possesses independently at rate $ \\mu $. If trait $ h \\in H_i(t^-) $ in species $ i $ dies at time \\emph{t},\n", "index": 7, "text": "\n\\[\nH_i(t) \\leftarrow H_i(t^-) \\setminus \\{h\\}.\n\\]\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex5.m1\" class=\"ltx_Math\" alttext=\"H_{i}(t)\\leftarrow H_{i}(t^{-})\\setminus\\{h\\}.\" display=\"block\"><mrow><mrow><mrow><msub><mi>H</mi><mi>i</mi></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2190</mo><mrow><mrow><msub><mi>H</mi><mi>i</mi></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msup><mi>t</mi><mo>-</mo></msup><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2216</mo><mrow><mo stretchy=\"false\">{</mo><mi>h</mi><mo stretchy=\"false\">}</mo></mrow></mrow></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.07931.tex", "nexttext": "\n\\end{myprop}\n\n\\begin{myprop}[Trait death]\n\\label{tp:death}\nA species kills off each trait it possesses independently at rate $ \\mu $. If trait $ h \\in H_i(t^-) $ in species $ i $ dies at time \\emph{t},\n", "itemtype": "equation", "pos": 11628, "prevtext": "\nwhere $ t_i^- $ denotes the time just before the branching event.\n\\end{myprop}\n\n\\begin{myprop}[Trait birth]\n\\label{tp:birth}\nNew traits are born at rate $ \\lambda $ in each extant species. If trait $ h \\in \\Z $ is born in species $ i $ at time \\emph{t},\n", "index": 5, "text": "\n\\[\nH_i(t) \\leftarrow H_i(t^-) \\cup \\{h\\}.\n\\]\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex6.m1\" class=\"ltx_Math\" alttext=\"H_{i}(t)\\leftarrow H_{i}(t^{-})\\cup\\{h\\}.\" display=\"block\"><mrow><mrow><mrow><msub><mi>H</mi><mi>i</mi></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u2190</mo><mrow><mrow><msub><mi>H</mi><mi>i</mi></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msup><mi>t</mi><mo>-</mo></msup><mo stretchy=\"false\">)</mo></mrow></mrow><mo>\u222a</mo><mrow><mo stretchy=\"false\">{</mo><mi>h</mi><mo stretchy=\"false\">}</mo></mrow></mrow></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.07931.tex", "nexttext": "\nindicates the presence or absence of trait \\emph{h} on lineage $ \\kit $ at time \\emph{t}.\n\nThe space of binary patterns of trait presence or absence across $ \\Lt $ lineages is $ \\cPt = \\{0, 1\\}^{\\Lt} \\setminus \\{\\zeros\\} $, where $ \\zeros $ is an $ \\Lt $-tuple of zeros notionally representing patterns displayed by traits in $ \\Z \\setminus \\cHt $. There are $ \\Npt = \\left|\\left\\{h \\in \\cHt : \\pht = \\bp\\right\\}\\right| $ traits displaying pattern $ \\bp \\in \\cPt $ at time \\emph{t}. The dynamics of the pattern frequency process $ \\bNt = (\\Npt : \\bp \\in \\cPt) $ follow directly from Properties~T\\ref{tp:branch}--\\ref{tp:transfer} of the trait process with the additional structure of $ \\kt $.\n\n\n\\subsubsection{Patterns at branching events}\n\\label{sec:patternsAtBranching}\n\nAt a branching event, patterns increase in length and the space of patterns expands to accommodate the new patterns which traits may display. The tuple $ \\kt $ of branch labels is consistent across speciation events in the sense that when lineage $ j = k_i^{(t_j^-)} $ branches at time $ t_j $, the branch labels are\n", "itemtype": "equation", "pos": 14000, "prevtext": "\nClearly if $ h \\in H_i(t^-) $ already then the transfer event has no effect.\n\\end{myprop}\n\nStarting from a single set $ H(-\\infty) = \\{\\emptyset\\} $, the process $ H(t) $ evolves through a combination of branching~(T\\ref{tp:branch}) and trait~(T\\ref{tp:birth}--\\ref{tp:transfer}) events to yield the diverse set of taxa $ H(0) = \\{ H_i(0) : i \\in V_L \\} $ observed at time 0. When the lateral transfer rate $ \\beta = 0 $, we recover the binary Stochastic Dollo process of \\citeauthor{nicholls08} and there exist efficient recursions to compute the probability of a trait born on a given branch appearing in any collection of leaves. Furthermore, one may integrate the birth location out of the calculation. Traits displaying the same pattern of presence or absence across the leaves are exchangeable and their number is a Poisson random variable. This is also the case for the lateral transfer model described above with the key difference that through a combination of death and lateral transfer events, a trait may be present in any of the leaves regardless of where on the tree it was born. We cannot compute the likelihood in closed form but we now describe a representation of the process which allows us to evaluate it numerically.\n\n\n\n\\subsection{Pattern evolution}\n\\label{sec:pattern}\n\nIf we cut through the tree at time \\emph{t}, each trait in $ \\cHt $ displays a \\emph{pattern} of presence or absence across the $ \\Lt $ extant species $ \\kt = (\\kit : i \\in [\\Lt]) $, where $ [\\Lt] = (1, \\dotsc, \\Lt) $. These patterns evolve over time as new branches arise and instances of \\emph{h} die and transfer. The pattern displayed by trait \\emph{h} at time \\emph{t} is $ \\pht = (\\phit : i \\in [\\Lt]) $, where \n", "index": 11, "text": "\n\\[\n\\phit = \n\\left\\{\n\\begin{array}{ll}\n1, \\quad & h \\in H_{\\kit}(t), \\\\\n0, \\quad & \\text{otherwise},\n\\end{array}\n\\right.\n\\]\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex7.m1\" class=\"ltx_Math\" alttext=\"\\phit=\\left\\{\\begin{array}[]{ll}1,&amp;h\\in H_{\\kit}(t),\\\\&#10;0,&amp;\\text{otherwise},\\end{array}\\right.\" display=\"block\"><mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\phit</mtext></merror><mo>=</mo><mrow><mo>{</mo><mtable columnspacing=\"5pt\" displaystyle=\"true\" rowspacing=\"0pt\"><mtr><mtd columnalign=\"left\"><mrow><mn>1</mn><mo>,</mo></mrow></mtd><mtd columnalign=\"left\"><mrow><mrow><mi>h</mi><mo>\u2208</mo><mrow><msub><mi>H</mi><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\kit</mtext></merror></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow></mrow></mrow><mo>,</mo></mrow></mtd></mtr><mtr><mtd columnalign=\"left\"><mrow><mn>0</mn><mo>,</mo></mrow></mtd><mtd columnalign=\"left\"><mrow><mtext>otherwise</mtext><mo>,</mo></mrow></mtd></mtr></mtable><mi/></mrow></mrow></math>", "type": "latex"}, {"file": "1601.07931.tex", "nexttext": "\nwhere species $ k_i^{(t_j)} $ and $ k_{i + 1}^{(t_j)} $ are the offspring of species $ j = k_i^{(t_j^-)} $ (T{\\ref{tp:branch}). It follows that each trait $ h \\in \\cH^{(t_j)} $ displays a pattern $ \\ph(t_j) $ with entries $ p^h_i(t_j) = p^h_{i + 1}(t_j) \\leftarrow p^h_i(t_j^-) $.\nFor example, in Figure~\\ref{fig:phyTree}, at time $ t_4 $\n\n", "itemtype": "equation", "pos": 15213, "prevtext": "\nindicates the presence or absence of trait \\emph{h} on lineage $ \\kit $ at time \\emph{t}.\n\nThe space of binary patterns of trait presence or absence across $ \\Lt $ lineages is $ \\cPt = \\{0, 1\\}^{\\Lt} \\setminus \\{\\zeros\\} $, where $ \\zeros $ is an $ \\Lt $-tuple of zeros notionally representing patterns displayed by traits in $ \\Z \\setminus \\cHt $. There are $ \\Npt = \\left|\\left\\{h \\in \\cHt : \\pht = \\bp\\right\\}\\right| $ traits displaying pattern $ \\bp \\in \\cPt $ at time \\emph{t}. The dynamics of the pattern frequency process $ \\bNt = (\\Npt : \\bp \\in \\cPt) $ follow directly from Properties~T\\ref{tp:branch}--\\ref{tp:transfer} of the trait process with the additional structure of $ \\kt $.\n\n\n\\subsubsection{Patterns at branching events}\n\\label{sec:patternsAtBranching}\n\nAt a branching event, patterns increase in length and the space of patterns expands to accommodate the new patterns which traits may display. The tuple $ \\kt $ of branch labels is consistent across speciation events in the sense that when lineage $ j = k_i^{(t_j^-)} $ branches at time $ t_j $, the branch labels are\n", "index": 13, "text": "\n\\[\n\\bk^{(t_j)} = \\left(k_1^{(t_j^-)}, \\dotsc, k_{i - 1}^{(t_j^-)}, k_i^{(t_j)}, k_{i + 1}^{(t_j)}, k_{i + 1}^{(t_j^-)}, \\dotsc, k_{L^{(t_j^-)}}^{(t_j^-)}\\right),\n\\]\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex8.m1\" class=\"ltx_Math\" alttext=\"\\bk^{(t_{j})}=\\left(k_{1}^{(t_{j}^{-})},\\ldots,k_{i-1}^{(t_{j}^{-})},k_{i}^{(t%&#10;_{j})},k_{i+1}^{(t_{j})},k_{i+1}^{(t_{j}^{-})},\\ldots,k_{L^{(t_{j}^{-})}}^{(t_%&#10;{j}^{-})}\\right),\" display=\"block\"><mrow><mrow><msup><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bk</mtext></merror><mrow><mo stretchy=\"false\">(</mo><msub><mi>t</mi><mi>j</mi></msub><mo stretchy=\"false\">)</mo></mrow></msup><mo>=</mo><mrow><mo>(</mo><msubsup><mi>k</mi><mn>1</mn><mrow><mo stretchy=\"false\">(</mo><msubsup><mi>t</mi><mi>j</mi><mo>-</mo></msubsup><mo stretchy=\"false\">)</mo></mrow></msubsup><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msubsup><mi>k</mi><mrow><mi>i</mi><mo>-</mo><mn>1</mn></mrow><mrow><mo stretchy=\"false\">(</mo><msubsup><mi>t</mi><mi>j</mi><mo>-</mo></msubsup><mo stretchy=\"false\">)</mo></mrow></msubsup><mo>,</mo><msubsup><mi>k</mi><mi>i</mi><mrow><mo stretchy=\"false\">(</mo><msub><mi>t</mi><mi>j</mi></msub><mo stretchy=\"false\">)</mo></mrow></msubsup><mo>,</mo><msubsup><mi>k</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow><mrow><mo stretchy=\"false\">(</mo><msub><mi>t</mi><mi>j</mi></msub><mo stretchy=\"false\">)</mo></mrow></msubsup><mo>,</mo><msubsup><mi>k</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow><mrow><mo stretchy=\"false\">(</mo><msubsup><mi>t</mi><mi>j</mi><mo>-</mo></msubsup><mo stretchy=\"false\">)</mo></mrow></msubsup><mo>,</mo><mi mathvariant=\"normal\">\u2026</mi><mo>,</mo><msubsup><mi>k</mi><msup><mi>L</mi><mrow><mo stretchy=\"false\">(</mo><msubsup><mi>t</mi><mi>j</mi><mo>-</mo></msubsup><mo stretchy=\"false\">)</mo></mrow></msup><mrow><mo stretchy=\"false\">(</mo><msubsup><mi>t</mi><mi>j</mi><mo>-</mo></msubsup><mo stretchy=\"false\">)</mo></mrow></msubsup><mo>)</mo></mrow></mrow><mo>,</mo></mrow></math>", "type": "latex"}, {"file": "1601.07931.tex", "nexttext": "\n\nPatterns $ \\bp \\in \\cP^{(t_j)} $ with entries $ p_i = p_{i + 1} $ are consistent with the branching event as they are formed by duplicating the \\emph{i}th entries of patterns in $ \\cP^{(t_j^-)} $. On the other hand, traits cannot display patterns with $ p_i \\neq p_{i + 1} $ at time $ t_j $ by definition~(T\\ref{tp:branch}). We denote by $ \\bT^{(j)} $ the operation which initialises the pattern frequencies $ \\bN(t_j) $ with entries of $ \\bN(t_j^-) $ for patterns consistent with the branching event and zeros otherwise. We return to this initialisation operation when computing expected pattern frequencies in Section~\\ref{sec:epm}.\n\n\n\\subsubsection{Patterns between branching events}\n\\label{sec:patternsBetweenBranching}\n\nIn order to formally describe the evolution of the pattern frequencies $ \\bNt $ between branching events, we first define how patterns are related. The Hamming distance between patterns $ \\bp $ and $ \\bq \\in \\cPt $ is $ d(\\bp, \\bq) = |\\{i \\in [\\Lt] : p_i \\neq q_i\\}| $ and $ s(\\bp) = d(\\bp, \\zeros) $ is the Hamming weight of $ \\bp $. The pattern $ \\pht = \\bp $ displayed by trait \\emph{h} \\emph{communicates} with patterns in the sets\n\n", "itemtype": "equation", "pos": 15718, "prevtext": "\nwhere species $ k_i^{(t_j)} $ and $ k_{i + 1}^{(t_j)} $ are the offspring of species $ j = k_i^{(t_j^-)} $ (T{\\ref{tp:branch}). It follows that each trait $ h \\in \\cH^{(t_j)} $ displays a pattern $ \\ph(t_j) $ with entries $ p^h_i(t_j) = p^h_{i + 1}(t_j) \\leftarrow p^h_i(t_j^-) $.\nFor example, in Figure~\\ref{fig:phyTree}, at time $ t_4 $\n\n", "index": 15, "text": "\\begin{align*}\n\\bk^{(t_4^-)} &= (8, 4, 7, 15), &\\quad \\bk^{(t_4)} &= (8, 6, 5, 7, 15), \\\\\n\\bp^h(t_4^-) &= (1, 0, 0, 0), &\\quad \\bp^h(t_4) &= (1, 0, 0, 0, 0).\n\\end{align*}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex9.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle\\bk^{(t_{4}^{-})}\" display=\"inline\"><msup><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bk</mtext></merror><mrow><mo stretchy=\"false\">(</mo><msubsup><mi>t</mi><mn>4</mn><mo>-</mo></msubsup><mo stretchy=\"false\">)</mo></mrow></msup></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex9.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle=(8,4,7,15),\" display=\"inline\"><mrow><mrow><mi/><mo>=</mo><mrow><mo stretchy=\"false\">(</mo><mn>8</mn><mo>,</mo><mn>4</mn><mo>,</mo><mn>7</mn><mo>,</mo><mn>15</mn><mo stretchy=\"false\">)</mo></mrow></mrow><mo>,</mo></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex9.m3\" class=\"ltx_Math\" alttext=\"\\displaystyle\\quad\\bk^{(t_{4})}\" display=\"inline\"><mrow><mi mathvariant=\"normal\">\u2003</mi><mo>\u2062</mo><msup><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bk</mtext></merror><mrow><mo stretchy=\"false\">(</mo><msub><mi>t</mi><mn>4</mn></msub><mo stretchy=\"false\">)</mo></mrow></msup></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex9.m4\" class=\"ltx_Math\" alttext=\"\\displaystyle=(8,6,5,7,15),\" display=\"inline\"><mrow><mrow><mi/><mo>=</mo><mrow><mo stretchy=\"false\">(</mo><mn>8</mn><mo>,</mo><mn>6</mn><mo>,</mo><mn>5</mn><mo>,</mo><mn>7</mn><mo>,</mo><mn>15</mn><mo stretchy=\"false\">)</mo></mrow></mrow><mo>,</mo></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex10.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle\\bp^{h}(t_{4}^{-})\" display=\"inline\"><mrow><msup><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bp</mtext></merror><mi>h</mi></msup><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msubsup><mi>t</mi><mn>4</mn><mo>-</mo></msubsup><mo stretchy=\"false\">)</mo></mrow></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex10.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle=(1,0,0,0),\" display=\"inline\"><mrow><mrow><mi/><mo>=</mo><mrow><mo stretchy=\"false\">(</mo><mn>1</mn><mo>,</mo><mn>0</mn><mo>,</mo><mn>0</mn><mo>,</mo><mn>0</mn><mo stretchy=\"false\">)</mo></mrow></mrow><mo>,</mo></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex10.m3\" class=\"ltx_Math\" alttext=\"\\displaystyle\\quad\\bp^{h}(t_{4})\" display=\"inline\"><mrow><mi mathvariant=\"normal\">\u2003</mi><mo>\u2062</mo><msup><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bp</mtext></merror><mi>h</mi></msup><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>t</mi><mn>4</mn></msub><mo stretchy=\"false\">)</mo></mrow></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex10.m4\" class=\"ltx_Math\" alttext=\"\\displaystyle=(1,0,0,0,0).\" display=\"inline\"><mrow><mrow><mi/><mo>=</mo><mrow><mo stretchy=\"false\">(</mo><mn>1</mn><mo>,</mo><mn>0</mn><mo>,</mo><mn>0</mn><mo>,</mo><mn>0</mn><mo>,</mo><mn>0</mn><mo stretchy=\"false\">)</mo></mrow></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.07931.tex", "nexttext": "\nwhich may be formed from $ \\pht $ through a single trait death~(T\\ref{tp:death}) or transfer~(T\\ref{tp:transfer}) event respectively. Trait \\emph{h} transitions from displaying pattern $ \\pht  = \\bp $ to $ \\bq \\in \\Spm \\cup \\Spp $ at the rates described in Figure~\\ref{fig:patternTransitions}.\n\n\n\\begin{figure}[ht]\n\\centering\n\\includegraphics[width=\\textwidth]{PatternProcessRelations.pdf}\n\\caption{Traits of type \\emph{h} displaying pattern $ \\pht = \\bp $ at time \\emph{t} communicate with patterns in $ \\Spm $ (or $ \\zeros $ if $ s(\\bp) = 1 $) and $ \\Spp $. The top diagram describes the rate that $ \\pht $ transitions from state $ \\bp $ to $ \\bq \\in \\Spm \\cup \\Spp $. Summing these rates for the $ s(\\bp) - \\ind{s(\\bp) = 1} $ patterns in $ \\Spm $ and $ \\Lt - s(\\bp) $ in $ \\Spp $, we obtain the total rates of exiting state $ \\bp $ in the bottom diagram.}\n\\label{fig:patternTransitions}\n\\end{figure}\n\nFor example, in Figure~\\ref{fig:phyTree}, trait \\emph{h} transfers to branch 11 at time \\emph{t}, say, so\n\n", "itemtype": "equation", "pos": 17051, "prevtext": "\n\nPatterns $ \\bp \\in \\cP^{(t_j)} $ with entries $ p_i = p_{i + 1} $ are consistent with the branching event as they are formed by duplicating the \\emph{i}th entries of patterns in $ \\cP^{(t_j^-)} $. On the other hand, traits cannot display patterns with $ p_i \\neq p_{i + 1} $ at time $ t_j $ by definition~(T\\ref{tp:branch}). We denote by $ \\bT^{(j)} $ the operation which initialises the pattern frequencies $ \\bN(t_j) $ with entries of $ \\bN(t_j^-) $ for patterns consistent with the branching event and zeros otherwise. We return to this initialisation operation when computing expected pattern frequencies in Section~\\ref{sec:epm}.\n\n\n\\subsubsection{Patterns between branching events}\n\\label{sec:patternsBetweenBranching}\n\nIn order to formally describe the evolution of the pattern frequencies $ \\bNt $ between branching events, we first define how patterns are related. The Hamming distance between patterns $ \\bp $ and $ \\bq \\in \\cPt $ is $ d(\\bp, \\bq) = |\\{i \\in [\\Lt] : p_i \\neq q_i\\}| $ and $ s(\\bp) = d(\\bp, \\zeros) $ is the Hamming weight of $ \\bp $. The pattern $ \\pht = \\bp $ displayed by trait \\emph{h} \\emph{communicates} with patterns in the sets\n\n", "index": 17, "text": "\\begin{align*}\n\\Spm &= \\{\\bq \\in \\cPt : s(\\bq) = s(\\bp) - 1,\\, d(\\bp, \\bq) = 1\\}, \\\\\n\\Spp &= \\{\\bq \\in \\cPt : s(\\bq) = s(\\bp) + 1,\\, d(\\bp, \\bq) = 1\\},\n\\end{align*}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex11.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle\\Spm\" display=\"inline\"><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\Spm</mtext></merror></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex11.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle=\\{\\bq\\in\\cPt:s(\\bq)=s(\\bp)-1,\\,d(\\bp,\\bq)=1\\},\" display=\"inline\"><mrow><mrow><mi/><mo>=</mo><mrow><mo stretchy=\"false\">{</mo><mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bq</mtext></merror><mo>\u2208</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\cPt</mtext></merror></mrow><mo>:</mo><mrow><mrow><mrow><mi>s</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bq</mtext></merror><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mrow><mrow><mi>s</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bp</mtext></merror><mo stretchy=\"false\">)</mo></mrow></mrow><mo>-</mo><mn>1</mn></mrow></mrow><mo rspace=\"4.2pt\">,</mo><mrow><mrow><mi>d</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bp</mtext></merror><mo>,</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bq</mtext></merror><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mn>1</mn></mrow></mrow><mo stretchy=\"false\">}</mo></mrow></mrow><mo>,</mo></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex12.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle\\Spp\" display=\"inline\"><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\Spp</mtext></merror></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex12.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle=\\{\\bq\\in\\cPt:s(\\bq)=s(\\bp)+1,\\,d(\\bp,\\bq)=1\\},\" display=\"inline\"><mrow><mrow><mi/><mo>=</mo><mrow><mo stretchy=\"false\">{</mo><mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bq</mtext></merror><mo>\u2208</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\cPt</mtext></merror></mrow><mo>:</mo><mrow><mrow><mrow><mi>s</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bq</mtext></merror><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mrow><mrow><mi>s</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bp</mtext></merror><mo stretchy=\"false\">)</mo></mrow></mrow><mo>+</mo><mn>1</mn></mrow></mrow><mo rspace=\"4.2pt\">,</mo><mrow><mrow><mi>d</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bp</mtext></merror><mo>,</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bq</mtext></merror><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mn>1</mn></mrow></mrow><mo stretchy=\"false\">}</mo></mrow></mrow><mo>,</mo></mrow></math>", "type": "latex"}, {"file": "1601.07931.tex", "nexttext": "\n\n\\subsection{Expected pattern frequencies}\n\\label{sec:epm}\n\nTraits displaying a pattern $ \\bp \\in \\cPt $ evolve independently of each other. It follows from Figure~\\ref{fig:patternTransitions} that on a short interval of length $ \\dt $ between branching events,\n\n", "itemtype": "equation", "pos": 18226, "prevtext": "\nwhich may be formed from $ \\pht $ through a single trait death~(T\\ref{tp:death}) or transfer~(T\\ref{tp:transfer}) event respectively. Trait \\emph{h} transitions from displaying pattern $ \\pht  = \\bp $ to $ \\bq \\in \\Spm \\cup \\Spp $ at the rates described in Figure~\\ref{fig:patternTransitions}.\n\n\n\\begin{figure}[ht]\n\\centering\n\\includegraphics[width=\\textwidth]{PatternProcessRelations.pdf}\n\\caption{Traits of type \\emph{h} displaying pattern $ \\pht = \\bp $ at time \\emph{t} communicate with patterns in $ \\Spm $ (or $ \\zeros $ if $ s(\\bp) = 1 $) and $ \\Spp $. The top diagram describes the rate that $ \\pht $ transitions from state $ \\bp $ to $ \\bq \\in \\Spm \\cup \\Spp $. Summing these rates for the $ s(\\bp) - \\ind{s(\\bp) = 1} $ patterns in $ \\Spm $ and $ \\Lt - s(\\bp) $ in $ \\Spp $, we obtain the total rates of exiting state $ \\bp $ in the bottom diagram.}\n\\label{fig:patternTransitions}\n\\end{figure}\n\nFor example, in Figure~\\ref{fig:phyTree}, trait \\emph{h} transfers to branch 11 at time \\emph{t}, say, so\n\n", "index": 19, "text": "\\begin{align*}\n\\bp^h(t^-) &= (1, 0, 0, 0, 0, 0), &\\quad \\bp^h(t) &= (1, 0, 1, 0, 0, 0) \\in S_{100000}^+, \\\\\nN_{100000}(t) &= N_{100000}(t^-) - 1, &\\quad N_{101000}(t) &= N_{101000}(t^-) + 1.\n\\end{align*}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex13.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle\\bp^{h}(t^{-})\" display=\"inline\"><mrow><msup><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bp</mtext></merror><mi>h</mi></msup><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msup><mi>t</mi><mo>-</mo></msup><mo stretchy=\"false\">)</mo></mrow></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex13.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle=(1,0,0,0,0,0),\" display=\"inline\"><mrow><mrow><mi/><mo>=</mo><mrow><mo stretchy=\"false\">(</mo><mn>1</mn><mo>,</mo><mn>0</mn><mo>,</mo><mn>0</mn><mo>,</mo><mn>0</mn><mo>,</mo><mn>0</mn><mo>,</mo><mn>0</mn><mo stretchy=\"false\">)</mo></mrow></mrow><mo>,</mo></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex13.m3\" class=\"ltx_Math\" alttext=\"\\displaystyle\\quad\\bp^{h}(t)\" display=\"inline\"><mrow><mi mathvariant=\"normal\">\u2003</mi><mo>\u2062</mo><msup><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bp</mtext></merror><mi>h</mi></msup><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex13.m4\" class=\"ltx_Math\" alttext=\"\\displaystyle=(1,0,1,0,0,0)\\in S_{100000}^{+},\" display=\"inline\"><mrow><mrow><mi/><mo>=</mo><mrow><mo stretchy=\"false\">(</mo><mn>1</mn><mo>,</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo>,</mo><mn>0</mn><mo>,</mo><mn>0</mn><mo>,</mo><mn>0</mn><mo stretchy=\"false\">)</mo></mrow><mo>\u2208</mo><msubsup><mi>S</mi><mn>100000</mn><mo>+</mo></msubsup></mrow><mo>,</mo></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex14.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle N_{100000}(t)\" display=\"inline\"><mrow><msub><mi>N</mi><mn>100000</mn></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex14.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle=N_{100000}(t^{-})-1,\" display=\"inline\"><mrow><mrow><mi/><mo>=</mo><mrow><mrow><msub><mi>N</mi><mn>100000</mn></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msup><mi>t</mi><mo>-</mo></msup><mo stretchy=\"false\">)</mo></mrow></mrow><mo>-</mo><mn>1</mn></mrow></mrow><mo>,</mo></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex14.m3\" class=\"ltx_Math\" alttext=\"\\displaystyle\\quad N_{101000}(t)\" display=\"inline\"><mrow><mi mathvariant=\"normal\">\u2003</mi><mo>\u2062</mo><msub><mi>N</mi><mn>101000</mn></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex14.m4\" class=\"ltx_Math\" alttext=\"\\displaystyle=N_{101000}(t^{-})+1.\" display=\"inline\"><mrow><mrow><mi/><mo>=</mo><mrow><mrow><msub><mi>N</mi><mn>101000</mn></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msup><mi>t</mi><mo>-</mo></msup><mo stretchy=\"false\">)</mo></mrow></mrow><mo>+</mo><mn>1</mn></mrow></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.07931.tex", "nexttext": "\nWe cannot compute these transition probabilities in practice as we only observe the terminal pattern frequencies, $ \\bN(0) $. However, we can use Equation~\\ref{eq:transProb} to derive that the expected number of traits in $ \\cHt $ displaying pattern $ \\bp \\in \\cPt $ at time \\emph{t}, $ \\xp(t; g, \\lambda, \\mu, \\beta) = \\EE[\\Npt | g, \\lambda, \\mu, \\beta] $, evolves across the interval as\n\n", "itemtype": "equation", "pos": 18692, "prevtext": "\n\n\\subsection{Expected pattern frequencies}\n\\label{sec:epm}\n\nTraits displaying a pattern $ \\bp \\in \\cPt $ evolve independently of each other. It follows from Figure~\\ref{fig:patternTransitions} that on a short interval of length $ \\dt $ between branching events,\n\n", "index": 21, "text": "\\begin{equation}\n\\label{eq:transProb}\n\\begin{split}\n&\\PP[N_{\\bp}(t + \\dt) - \\Npt = k | g, \\lambda, \\mu, \\beta] \\\\\n&\\quad =\n\\left\\{\n\\begin{array}{ll}\ns(\\bp)  \\Npt \\left[ \\mu + \\beta \\left(1 - \\tfrac{s(\\bp)}{\\Lt}\\right) \\right] \\dt + o(\\dt), \\quad &\tk = -1, \\vspace{4pt} \\\\\n\\left[\\lambda  \\ind{s(\\bp) = 1} + \\beta \\sum_{\\bq \\in \\Spm} \\tfrac{s(\\bq)}{\\Lt} N_{\\bq}(t) \\right. \\\\\n\t\\qquad \\left. + \\mu \\sum_{\\bq \\in \\Spp} N_{\\bq}(t) \\right] \\dt + o(\\dt), \\quad & k = 1.\n\\end{array}\n\\right.\n\\end{split}\n\\end{equation}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E1.m1\" class=\"ltx_Math\" alttext=\"\\begin{split}&amp;\\displaystyle\\PP[N_{\\bp}(t+\\dt)-\\Npt=k|g,\\lambda,\\mu,\\beta]\\\\&#10;&amp;\\displaystyle\\quad=\\left\\{\\begin{array}[]{ll}s(\\bp)\\Npt\\left[\\mu+\\beta\\left(1%&#10;-\\tfrac{s(\\bp)}{\\Lt}\\right)\\right]\\dt+o(\\dt),&amp;k=-1,\\\\&#10;\\left[\\lambda\\ind{s(\\bp)=1}+\\beta\\sum_{\\bq\\in\\Spm}\\tfrac{s(\\bq)}{\\Lt}N_{\\bq}(t%&#10;)\\right.\\\\&#10;\\qquad\\left.+\\mu\\sum_{\\bq\\in\\Spp}N_{\\bq}(t)\\right]\\dt+o(\\dt),&amp;k=1.\\end{array}%&#10;\\right.\\end{split}\" display=\"block\"><mtable columnspacing=\"0pt\" displaystyle=\"true\" rowspacing=\"0pt\"><mtr><mtd/><mtd columnalign=\"left\"><mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\PP</mtext></merror><mrow><mo stretchy=\"false\">[</mo><msub><mi>N</mi><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bp</mtext></merror></msub><mrow><mo stretchy=\"false\">(</mo><mi>t</mi><mo>+</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\dt</mtext></merror><mo stretchy=\"false\">)</mo></mrow><mo>-</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\Npt</mtext></merror><mo>=</mo><mi>k</mi><mo stretchy=\"false\">|</mo><mi>g</mi><mo>,</mo><mi>\u03bb</mi><mo>,</mo><mi>\u03bc</mi><mo>,</mo><mi>\u03b2</mi><mo stretchy=\"false\">]</mo></mrow></mrow></mtd></mtr><mtr><mtd/><mtd columnalign=\"left\"><mrow><mi/><mo lspace=\"12.5pt\">=</mo><mrow><mo>{</mo><mtable columnspacing=\"5pt\" displaystyle=\"true\" rowspacing=\"0pt\"><mtr><mtd columnalign=\"left\"><mrow><mrow><mrow><mi>s</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bp</mtext></merror><mo stretchy=\"false\">)</mo></mrow><mo>\u2062</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\Npt</mtext></merror><mo>\u2062</mo><mrow><mo>[</mo><mrow><mi>\u03bc</mi><mo>+</mo><mrow><mi>\u03b2</mi><mo>\u2062</mo><mrow><mo>(</mo><mrow><mn>1</mn><mo>-</mo><mstyle displaystyle=\"false\"><mfrac><mrow><mi>s</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bp</mtext></merror><mo stretchy=\"false\">)</mo></mrow></mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\Lt</mtext></merror></mfrac></mstyle></mrow><mo>)</mo></mrow></mrow></mrow><mo>]</mo></mrow><mo>\u2062</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\dt</mtext></merror></mrow><mo>+</mo><mrow><mi>o</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\dt</mtext></merror><mo stretchy=\"false\">)</mo></mrow></mrow></mrow><mo>,</mo></mrow></mtd><mtd columnalign=\"left\"><mrow><mrow><mi>k</mi><mo>=</mo><mrow><mo>-</mo><mn>1</mn></mrow></mrow><mo>,</mo></mrow></mtd></mtr><mtr><mtd columnalign=\"left\"><mrow><mo>[</mo><mi>\u03bb</mi><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\ind</mtext></merror><mi>s</mi><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bp</mtext></merror><mo stretchy=\"false\">)</mo></mrow><mo>=</mo><mn>1</mn><mo>+</mo><mi>\u03b2</mi><munder><mo largeop=\"true\" movablelimits=\"false\" symmetric=\"true\">\u2211</mo><mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bq</mtext></merror><mo>\u2208</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\Spm</mtext></merror></mrow></munder><mstyle displaystyle=\"false\"><mfrac><mrow><mi>s</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bq</mtext></merror><mo stretchy=\"false\">)</mo></mrow></mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\Lt</mtext></merror></mfrac></mstyle><msub><mi>N</mi><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bq</mtext></merror></msub><mrow><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow></mrow></mtd><mtd/></mtr><mtr><mtd columnalign=\"left\"><mrow><mo lspace=\"22.5pt\">+</mo><mi>\u03bc</mi><munder><mo largeop=\"true\" movablelimits=\"false\" symmetric=\"true\">\u2211</mo><mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bq</mtext></merror><mo>\u2208</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\Spp</mtext></merror></mrow></munder><msub><mi>N</mi><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bq</mtext></merror></msub><mrow><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><mo>]</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\dt</mtext></merror><mo>+</mo><mi>o</mi><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\dt</mtext></merror><mo stretchy=\"false\">)</mo><mo>,</mo></mrow></mtd><mtd columnalign=\"left\"><mrow><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mo>.</mo></mrow></mtd></mtr></mtable><mi/></mrow></mrow></mtd></mtr></mtable></math>", "type": "latex"}, {"file": "1601.07931.tex", "nexttext": "\nThere are $ |\\cPt| = 2^{\\Lt} - 1 $ coupled differential equations describing the expected evolution of pattern frequencies~\\eqref{eq:dxp}. We may write them as $ \\dot{\\bx}(t) = \\bAt \\bxt + \\bbt $ where $ \\bxt = \\left(\\xpt : \\bp \\in \\cPt\\right) $ is the vector of expected pattern frequencies and the sparse, piecewise-constant matrix $ \\bAt $ and vector $ \\bbt $ respectively describe the flow between patterns from trait death and transfer events and into patterns from trait births.\n\nThe process $ \\bNt $ is in equilibrium just before the first branching event by construction so $ \\bx(t_1^-) = x_1(t_1^-) = \\lambda / \\mu $. With this initial condition at the root, we can write the expected pattern frequencies at the leaves $ \\bx(0) $ recursively as a sequence of initial value problems between branching events\n\n", "itemtype": "equation", "pos": 19591, "prevtext": "\nWe cannot compute these transition probabilities in practice as we only observe the terminal pattern frequencies, $ \\bN(0) $. However, we can use Equation~\\ref{eq:transProb} to derive that the expected number of traits in $ \\cHt $ displaying pattern $ \\bp \\in \\cPt $ at time \\emph{t}, $ \\xp(t; g, \\lambda, \\mu, \\beta) = \\EE[\\Npt | g, \\lambda, \\mu, \\beta] $, evolves across the interval as\n\n", "index": 23, "text": "\\begin{equation}\n\\label{eq:dxp}\n\\begin{split}\n\\dot{x}_{\\bp}(t)\n\t=& \\lim_{\\dt \\rightarrow 0} \\frac{ \\EE\\left[N_{\\bp}(t + \\dt) - \\Npt | g, \\lambda, \\mu, \\beta\\right] }{\\dt} \\\\\n\t=& - s(\\bp)  \\xpt \\left[ \\mu + \\beta \\left(1 - \\tfrac{s(\\bp)}{\\Lt}\\right) \\right] + \\lambda  \\ind{s(\\bp) = 1} \\\\\n\t\t &\\qquad + \\beta \\sum_{\\bq \\in \\Spm} \\tfrac{s(\\bq)}{\\Lt} \\xqt + \\mu \\sum_{\\bq \\in \\Spp} \\xqt.\n\\end{split}\n\\end{equation}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E2.m1\" class=\"ltx_Math\" alttext=\"\\begin{split}\\displaystyle\\dot{x}_{\\bp}(t)=&amp;\\displaystyle\\lim_{\\dt\\rightarrow 0%&#10;}\\frac{\\EE\\left[N_{\\bp}(t+\\dt)-\\Npt|g,\\lambda,\\mu,\\beta\\right]}{\\dt}\\\\&#10;\\displaystyle=&amp;\\displaystyle-s(\\bp)\\xpt\\left[\\mu+\\beta\\left(1-\\tfrac{s(\\bp)}{%&#10;\\Lt}\\right)\\right]+\\lambda\\ind{s(\\bp)=1}\\\\&#10;&amp;\\displaystyle\\qquad+\\beta\\sum_{\\bq\\in\\Spm}\\tfrac{s(\\bq)}{\\Lt}\\xqt+\\mu\\sum_{%&#10;\\bq\\in\\Spp}\\xqt.\\end{split}\" display=\"block\"><mtable columnspacing=\"0pt\" displaystyle=\"true\" rowspacing=\"0pt\"><mtr><mtd columnalign=\"right\"><mrow><mrow><msub><mover accent=\"true\"><mi>x</mi><mo>\u02d9</mo></mover><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bp</mtext></merror></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mi/></mrow></mtd><mtd columnalign=\"left\"><mrow><munder><mo movablelimits=\"false\">lim</mo><mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\dt</mtext></merror><mo>\u2192</mo><mn>0</mn></mrow></munder><mo>\u2061</mo><mfrac><mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\EE</mtext></merror><mrow><mo>[</mo><msub><mi>N</mi><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bp</mtext></merror></msub><mrow><mo stretchy=\"false\">(</mo><mi>t</mi><mo>+</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\dt</mtext></merror><mo stretchy=\"false\">)</mo></mrow><mo>-</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\Npt</mtext></merror><mo stretchy=\"false\">|</mo><mi>g</mi><mo>,</mo><mi>\u03bb</mi><mo>,</mo><mi>\u03bc</mi><mo>,</mo><mi>\u03b2</mi><mo>]</mo></mrow></mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\dt</mtext></merror></mfrac></mrow></mtd></mtr><mtr><mtd columnalign=\"right\"><mo>=</mo></mtd><mtd columnalign=\"left\"><mrow><mrow><mrow><mo>-</mo><mrow><mi>s</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bp</mtext></merror><mo stretchy=\"false\">)</mo></mrow><mo>\u2062</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\xpt</mtext></merror><mo>\u2062</mo><mrow><mo>[</mo><mrow><mi>\u03bc</mi><mo>+</mo><mrow><mi>\u03b2</mi><mo>\u2062</mo><mrow><mo>(</mo><mrow><mn>1</mn><mo>-</mo><mstyle displaystyle=\"false\"><mfrac><mrow><mi>s</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bp</mtext></merror><mo stretchy=\"false\">)</mo></mrow></mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\Lt</mtext></merror></mfrac></mstyle></mrow><mo>)</mo></mrow></mrow></mrow><mo>]</mo></mrow></mrow></mrow><mo>+</mo><mrow><mi>\u03bb</mi><mo>\u2062</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\ind</mtext></merror><mo>\u2062</mo><mi>s</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bp</mtext></merror><mo stretchy=\"false\">)</mo></mrow></mrow></mrow><mo>=</mo><mn>1</mn></mrow></mtd></mtr><mtr><mtd/><mtd columnalign=\"left\"><mrow><mrow><mrow><mo lspace=\"22.5pt\">+</mo><mrow><mi>\u03b2</mi><mo>\u2062</mo><mrow><munder><mo largeop=\"true\" movablelimits=\"false\" symmetric=\"true\">\u2211</mo><mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bq</mtext></merror><mo>\u2208</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\Spm</mtext></merror></mrow></munder><mrow><mstyle displaystyle=\"false\"><mfrac><mrow><mi>s</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bq</mtext></merror><mo stretchy=\"false\">)</mo></mrow></mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\Lt</mtext></merror></mfrac></mstyle><mo>\u2062</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\xqt</mtext></merror></mrow></mrow></mrow></mrow><mo>+</mo><mrow><mi>\u03bc</mi><mo>\u2062</mo><mrow><munder><mo largeop=\"true\" movablelimits=\"false\" symmetric=\"true\">\u2211</mo><mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bq</mtext></merror><mo>\u2208</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\Spp</mtext></merror></mrow></munder><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\xqt</mtext></merror></mrow></mrow></mrow><mo>.</mo></mrow></mtd></mtr></mtable></math>", "type": "latex"}, {"file": "1601.07931.tex", "nexttext": "\nwhere we recall the pattern frequency initialisation operator $ \\bT^{(i)} $ defined in Section~\\ref{sec:patternsAtBranching} that propagates $ \\bNt $ and $ \\bxt $ across the \\emph{i}th branching event. We illustrate this procedure graphically in Figure~\\ref{fig:patternMeanTransfer}.\n\n\n\\begin{figure}[ht]\n\\centering\n\\includegraphics[width=\\textwidth]{PatternMeanTransfer.pdf}\n\\caption{Computing the expected pattern frequencies $ \\bxt $ as a sequence of initial value problems~\\eqref{eq:ivp} on the tree. The initialisation operation $ \\bT^{(i)} \\bx(t_i^-) = \\bx(t_i) $ from Section~\\ref{sec:patternsAtBranching} provides the initial condition at the start of the \\emph{i}th interval between branching events.}\n\\label{fig:patternMeanTransfer}\n\\end{figure}\n\n\n\\subsection{Distribution of pattern frequencies}\n\\label{sec:like}\n\nTheorem~\\ref{thm:bdl} provides a formal description of the distribution of pattern frequencies. A proof is contained in the online supplement \\citep{kelly16supp}.\n\n\\begin{mytheorem}[Binary data distribution]\n\\label{thm:bdl}\nFor any time $ t \\in (-\\infty, 0] $, the pattern frequencies $ \\bNt $ is a vector of independent Poisson variables with the corresponding rate parameters $ \\bx(t; g, \\lambda, \\mu, \\beta) $ given by the solution of the initial value problems in Equation~\\ref{eq:ivp}.\n\\end{mytheorem}\n\n\n\n\\subsection{Model extensions}\n\\label{sec:modExt}\n\nIt is straightforward to extend the model and likelihood calculation to allow for rate variation, missing data, offset leaves and the systematic removal of patterns from the data.\n\n\n\\subsubsection{Rate heterogeneity}\n\\label{sec:cat}\n\nRather than allow rates to vary across lineages or time, we introduce bursts of activity in the form of \\emph{catastrophes} {(\\citeauthor{{ryder11}})} which we illustrate graphically in Figure~\\ref{fig:phyTree}. Catastrophes occur at rate $ \\rho $ along each branch of the tree, and a catastrophe advances the trait process along a branch by $ \\gamma $ units of time relative to its contemporaries. During a catastrophe, a branch may acquire traits through birth and transfer events, and lose traits due to deaths. This definition is consistent with \\citeauthor{ryder11} when the lateral transfer rate $ \\beta = 0 $.\n\nWe account for a catastrophe at time \\emph{t} on branch $ \\kit $ in the expected pattern frequency calculation~\\eqref{eq:ivp} with the update\n\n", "itemtype": "equation", "pos": 20818, "prevtext": "\nThere are $ |\\cPt| = 2^{\\Lt} - 1 $ coupled differential equations describing the expected evolution of pattern frequencies~\\eqref{eq:dxp}. We may write them as $ \\dot{\\bx}(t) = \\bAt \\bxt + \\bbt $ where $ \\bxt = \\left(\\xpt : \\bp \\in \\cPt\\right) $ is the vector of expected pattern frequencies and the sparse, piecewise-constant matrix $ \\bAt $ and vector $ \\bbt $ respectively describe the flow between patterns from trait death and transfer events and into patterns from trait births.\n\nThe process $ \\bNt $ is in equilibrium just before the first branching event by construction so $ \\bx(t_1^-) = x_1(t_1^-) = \\lambda / \\mu $. With this initial condition at the root, we can write the expected pattern frequencies at the leaves $ \\bx(0) $ recursively as a sequence of initial value problems between branching events\n\n", "index": 25, "text": "\\begin{equation}\n\\label{eq:ivp}\n\\dot{\\bx}(t) = \\bAt \\bxt + \\bbt \\quad \\text{on} \\quad [t_i, t_{i + 1}) \\quad \\text{where} \\quad \\bx(t_i) = \\bT^{(i)} \\bx(t_i^-),\n\\end{equation}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E3.m1\" class=\"ltx_Math\" alttext=\"\\dot{\\bx}(t)=\\bAt\\bxt+\\bbt\\quad\\text{on}\\quad[t_{i},t_{i+1})\\quad\\text{where}%&#10;\\quad\\bx(t_{i})=\\bT^{(i)}\\bx(t_{i}^{-}),\" display=\"block\"><mrow><mrow><mrow><mrow><mover accent=\"true\"><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bx</mtext></merror><mo>\u02d9</mo></mover><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mrow><mrow><mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bAt</mtext></merror><mo>\u2062</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bxt</mtext></merror></mrow><mo>+</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bbt</mtext></merror></mrow><mo mathvariant=\"italic\" separator=\"true\">\u2003</mo><mtext>on</mtext><mo mathvariant=\"italic\" separator=\"true\">\u2003</mo><mrow><mo stretchy=\"false\">[</mo><msub><mi>t</mi><mi>i</mi></msub><mo>,</mo><msub><mi>t</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy=\"false\">)</mo></mrow><mo mathvariant=\"italic\" separator=\"true\">\u2003</mo><mtext>where</mtext></mrow></mrow><mo mathvariant=\"italic\" separator=\"true\">\u2003</mo><mrow><mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bx</mtext></merror><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>t</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mrow><msup><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bT</mtext></merror><mrow><mo stretchy=\"false\">(</mo><mi>i</mi><mo stretchy=\"false\">)</mo></mrow></msup><mo>\u2062</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bx</mtext></merror><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msubsup><mi>t</mi><mi>i</mi><mo>-</mo></msubsup><mo stretchy=\"false\">)</mo></mrow></mrow></mrow></mrow><mo>,</mo></mrow></math>", "type": "latex"}, {"file": "1601.07931.tex", "nexttext": "\nwhich exploits the property that each pattern communicates with at most one other during a catastrophe. It is straightforward to adapt the proof of Theorem~\\ref{thm:bdl} to show that this update step correctly describes the effect of catastrophes on the pattern process.\n\n\n\\subsubsection{Missing data}\n\\label{sec:md}\n\nFollowing \\citeauthor{ryder11}, the true binary state of trait \\emph{h} at taxon $ i \\in V_L $ is recorded with probability $ \\PP(d_i^h \\in \\{0, 1\\}) = \\xi_i $, independently of the other taxa. The space of observable site-patterns across the $ L = L^{(0)} $ taxa at time 0 is $ \\cQ = \\{0, 1, ?\\}^{L} \\setminus \\zeros $ and the distribution of the data, stated in Theorem~\\ref{thm:mdl} and proved in the online supplement, follows from the restriction and superposition properties of Poisson processes \\citep{kingman92}.\n\n\\begin{mytheorem}[Missing data distribution]\n\\label{thm:mdl}\nThe number of traits displaying pattern $ \\bq \\in \\cQ $ at time 0, $ \\Nq(0) $ is an independent Poisson random variable with rate parameter\n", "itemtype": "equation", "pos": 23373, "prevtext": "\nwhere we recall the pattern frequency initialisation operator $ \\bT^{(i)} $ defined in Section~\\ref{sec:patternsAtBranching} that propagates $ \\bNt $ and $ \\bxt $ across the \\emph{i}th branching event. We illustrate this procedure graphically in Figure~\\ref{fig:patternMeanTransfer}.\n\n\n\\begin{figure}[ht]\n\\centering\n\\includegraphics[width=\\textwidth]{PatternMeanTransfer.pdf}\n\\caption{Computing the expected pattern frequencies $ \\bxt $ as a sequence of initial value problems~\\eqref{eq:ivp} on the tree. The initialisation operation $ \\bT^{(i)} \\bx(t_i^-) = \\bx(t_i) $ from Section~\\ref{sec:patternsAtBranching} provides the initial condition at the start of the \\emph{i}th interval between branching events.}\n\\label{fig:patternMeanTransfer}\n\\end{figure}\n\n\n\\subsection{Distribution of pattern frequencies}\n\\label{sec:like}\n\nTheorem~\\ref{thm:bdl} provides a formal description of the distribution of pattern frequencies. A proof is contained in the online supplement \\citep{kelly16supp}.\n\n\\begin{mytheorem}[Binary data distribution]\n\\label{thm:bdl}\nFor any time $ t \\in (-\\infty, 0] $, the pattern frequencies $ \\bNt $ is a vector of independent Poisson variables with the corresponding rate parameters $ \\bx(t; g, \\lambda, \\mu, \\beta) $ given by the solution of the initial value problems in Equation~\\ref{eq:ivp}.\n\\end{mytheorem}\n\n\n\n\\subsection{Model extensions}\n\\label{sec:modExt}\n\nIt is straightforward to extend the model and likelihood calculation to allow for rate variation, missing data, offset leaves and the systematic removal of patterns from the data.\n\n\n\\subsubsection{Rate heterogeneity}\n\\label{sec:cat}\n\nRather than allow rates to vary across lineages or time, we introduce bursts of activity in the form of \\emph{catastrophes} {(\\citeauthor{{ryder11}})} which we illustrate graphically in Figure~\\ref{fig:phyTree}. Catastrophes occur at rate $ \\rho $ along each branch of the tree, and a catastrophe advances the trait process along a branch by $ \\gamma $ units of time relative to its contemporaries. During a catastrophe, a branch may acquire traits through birth and transfer events, and lose traits due to deaths. This definition is consistent with \\citeauthor{ryder11} when the lateral transfer rate $ \\beta = 0 $.\n\nWe account for a catastrophe at time \\emph{t} on branch $ \\kit $ in the expected pattern frequency calculation~\\eqref{eq:ivp} with the update\n\n", "index": 27, "text": "\\begin{align*}\n\\xpt &\\leftarrow e^{-\\mu  \\gamma} \\xptm + (1 - e^{-\\mu  \\gamma}) \\frac{\\lambda}{\\mu}\n\t&\\quad &\\begin{array}{l} \\bp \\in \\cPt \\\\ s(\\bp) = 1, p_i = 1, \\end{array} \\\\\n\n\\begin{pmatrix} \\xqt \\\\ \\xrt \\end{pmatrix}\n&\\leftarrow\n\\exp\\left[ \\begin{pmatrix} -\\beta  \\frac{ s(\\bq)}{\\Lt} & \\mu \\\\ \\beta  \\frac{s(\\bq)}{\\Lt} & -\\mu \\end{pmatrix} \\gamma \\right]\n\\begin{pmatrix} \\xqtm \\\\ \\xrtm \\end{pmatrix}\n\t&\\quad &\\begin{array}{l} \\bq, \\br \\in \\cPt, d(\\bq, \\br) = 1 \\\\ q_i = 0, r_i = 1, \\end{array}\n\\end{align*}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex15.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle\\xpt\" display=\"inline\"><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\xpt</mtext></merror></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex15.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle\\leftarrow e^{-\\mu\\gamma}\\xptm+(1-e^{-\\mu\\gamma})\\frac{\\lambda}{\\mu}\" display=\"inline\"><mrow><mi/><mo>\u2190</mo><mrow><mrow><msup><mi>e</mi><mrow><mo>-</mo><mrow><mi>\u03bc</mi><mo>\u2062</mo><mi>\u03b3</mi></mrow></mrow></msup><mo>\u2062</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\xptm</mtext></merror></mrow><mo>+</mo><mrow><mrow><mo stretchy=\"false\">(</mo><mrow><mn>1</mn><mo>-</mo><msup><mi>e</mi><mrow><mo>-</mo><mrow><mi>\u03bc</mi><mo>\u2062</mo><mi>\u03b3</mi></mrow></mrow></msup></mrow><mo stretchy=\"false\">)</mo></mrow><mo>\u2062</mo><mstyle displaystyle=\"true\"><mfrac><mi>\u03bb</mi><mi>\u03bc</mi></mfrac></mstyle></mrow></mrow></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex15.m4\" class=\"ltx_Math\" alttext=\"\\displaystyle\\begin{array}[]{l}\\bp\\in\\cPt\\\\&#10;s(\\bp)=1,p_{i}=1,\\end{array}\" display=\"inline\"><mtable rowspacing=\"0pt\"><mtr><mtd columnalign=\"left\"><mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bp</mtext></merror><mo>\u2208</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\cPt</mtext></merror></mrow></mtd></mtr><mtr><mtd columnalign=\"left\"><mrow><mrow><mrow><mrow><mi>s</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bp</mtext></merror><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mn>1</mn></mrow><mo>,</mo><mrow><msub><mi>p</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn></mrow></mrow><mo>,</mo></mrow></mtd></mtr></mtable></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex16.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle\\par&#10;\\begin{pmatrix}\\xqt\\\\&#10;\\xrt\\end{pmatrix}\" display=\"inline\"><mrow><mo>(</mo><mtable rowspacing=\"0pt\"><mtr><mtd columnalign=\"center\"><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\xqt</mtext></merror></mtd></mtr><mtr><mtd columnalign=\"center\"><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\xrt</mtext></merror></mtd></mtr></mtable><mo>)</mo></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex16.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle\\leftarrow\\exp\\left[\\begin{pmatrix}-\\beta\\frac{s(\\bq)}{\\Lt}&amp;\\mu\\\\&#10;\\beta\\frac{s(\\bq)}{\\Lt}&amp;-\\mu\\end{pmatrix}\\gamma\\right]\\begin{pmatrix}\\xqtm\\\\&#10;\\xrtm\\end{pmatrix}\" display=\"inline\"><mrow><mi/><mo>\u2190</mo><mrow><mrow><mi>exp</mi><mo>\u2061</mo><mrow><mo>[</mo><mrow><mrow><mo>(</mo><mtable columnspacing=\"5pt\" rowspacing=\"0pt\"><mtr><mtd columnalign=\"center\"><mrow><mo>-</mo><mrow><mi>\u03b2</mi><mo>\u2062</mo><mfrac><mrow><mi>s</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bq</mtext></merror><mo stretchy=\"false\">)</mo></mrow></mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\Lt</mtext></merror></mfrac></mrow></mrow></mtd><mtd columnalign=\"center\"><mi>\u03bc</mi></mtd></mtr><mtr><mtd columnalign=\"center\"><mrow><mi>\u03b2</mi><mo>\u2062</mo><mfrac><mrow><mi>s</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bq</mtext></merror><mo stretchy=\"false\">)</mo></mrow></mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\Lt</mtext></merror></mfrac></mrow></mtd><mtd columnalign=\"center\"><mrow><mo>-</mo><mi>\u03bc</mi></mrow></mtd></mtr></mtable><mo>)</mo></mrow><mo>\u2062</mo><mi>\u03b3</mi></mrow><mo>]</mo></mrow></mrow><mo>\u2062</mo><mrow><mo>(</mo><mtable rowspacing=\"0pt\"><mtr><mtd columnalign=\"center\"><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\xqtm</mtext></merror></mtd></mtr><mtr><mtd columnalign=\"center\"><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\xrtm</mtext></merror></mtd></mtr></mtable><mo>)</mo></mrow></mrow></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex16.m4\" class=\"ltx_Math\" alttext=\"\\displaystyle\\begin{array}[]{l}\\bq,\\br\\in\\cPt,d(\\bq,\\br)=1\\\\&#10;q_{i}=0,r_{i}=1,\\end{array}\" display=\"inline\"><mtable rowspacing=\"0pt\"><mtr><mtd columnalign=\"left\"><mrow><mrow><mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bq</mtext></merror><mo>,</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\br</mtext></merror></mrow><mo>\u2208</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\cPt</mtext></merror></mrow><mo>,</mo><mrow><mrow><mi>d</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bq</mtext></merror><mo>,</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\br</mtext></merror><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mn>1</mn></mrow></mrow></mtd></mtr><mtr><mtd columnalign=\"left\"><mrow><mrow><mrow><msub><mi>q</mi><mi>i</mi></msub><mo>=</mo><mn>0</mn></mrow><mo>,</mo><mrow><msub><mi>r</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn></mrow></mrow><mo>,</mo></mrow></mtd></mtr></mtable></math>", "type": "latex"}, {"file": "1601.07931.tex", "nexttext": "\nwhere $ u(\\bq) = \\{ \\bp \\in \\cP^{(0)} : p_i = q_i \\text{ \\emph{if} } q_i \\neq\\ ?,\\, i \\in [L]\\} $ is the set of binary patterns consistent with $ \\bq $ and $ \\Xi = (\\xi_i : i \\in V_L) $.\n\\end{mytheorem}\n\nThe first term on the right-hand side in Theorem~\\ref{thm:mdl} is the expected number of binary patterns consistent with $ \\bq $ before masking, and the second term is the probability of having their entries obscured to form $ \\bq $.\n\n\n\\subsubsection{Non-isochronous data}\n\\label{sec:nonIso}\n\nData are isochronous when the taxa are sampled simultaneously. When this is not the case, there are \\emph{offset} leaves in the phylogeny; nodes 12 and 15 in Figure~\\ref{fig:phyTree}, for example. Similar to catastrophes, the trait process is frozen on offset leaves, which remain in $ H(t) = \\{H_i(t) : i \\in E, t_{\\pa(i)} < t < t_i \\, \\ind{i \\in V_L}\\} $. A pattern may now only communicate with those patterns which are identical to it on the extinct lineages and differ by one entry on the evolving lineages, with rates depending on the number of extant traits in a pattern. In Appendix~\\ref{app:nonIso}, we describe how to generalise the expected pattern frequencies calculation~\\eqref{eq:ivp} to account for offset leaves.\n\n\n\\subsubsection{Data registration}\n\\label{sec:reg}\n\nPatterns which are uninformative or unreliable are typically removed from the data. For example, we discard all traits which are not marked present in at least one taxon. Given a registration rule \\emph{R}, which may be a composition of other simpler rules such as those in Table~\\ref{tab:reg}, we discard the columns in the data array \\textbf{D} not satisfying \\emph{R}, leaving $ R(\\bD) $, and restrict our analysis to patterns in $ R(\\cP^{(0)}) $ or $ R(\\cQ) $ where necessary. \n\n\\begin{table}[ht]\n\\centering\n\\begin{tabular}{ll}\nUnregistrable traits & Unregistrable patterns $ \\cQ \\setminus R(\\cQ) $ \\\\ \\hline\nTraits observed in $ j $ leaves or fewer\n\t& $ \\{\\bq \\in \\cQ : |\\{i \\in [L] : q_i = 1\\}| \\leq j\\} $ \\\\\nTraits observed in $ j $ or more leaves\n\t& $ \\{\\bq \\in \\cQ : |\\{i \\in [L] : q_i = 1\\}| \\geq j\\} $ \\\\\nTraits potentially present in $ j $ leaves or greater\n\t& $ \\{\\bq \\in \\cQ : |\\{i \\in [L] : q_i \\neq 0\\}| \\geq j\\} $ \\\\\nTraits absent on lineage $ k_i^{(0)} $\n\t& $ \\{\\bq \\in \\cQ : q_i = 0\\} $\n\\end{tabular}\n\\caption{Registration rules of \\citeauthor{alekseyenko08} and \\citeauthor{ryder11}.}\n\\label{tab:reg}\n\\end{table}\n\n\n\n\\section{Bayesian inference}\n\\label{sec:inference}\n\nIn order to estimate both node times and rate parameters, we calibrate the space $ \\Gamma $ of rooted phylogenetic trees on \\emph{L} taxa with \\emph{clade constraints}. The constraint $ \\Gamma^{(0)} = (g \\in \\Gamma : \\ubar{t}_1 \\leq t_1 < 0) $ restricts the earliest admissible root time $ t_1 $ to $ \\ubar{t}_1 $. Each additional constraint $ \\Gamma^{(c)} $ places either time or ancestry constraints on the remaining nodes. We denote by $ \\Gamma^C = \\bigcap_c \\Gamma^{(c)} $ the calibrated space of phylogenies satisfying the clade constraints.\n\n\\citet{nicholls11} describe a prior on trees with the property that the root time $ t_ 1 $ is marginally approximately uniform across a specified interval $ [\\ubar{t}_1, \\bar{t}_1] \\subset \\R_{\\leq 0} $. For a given tree $ g = (V, E, T, C) $, there are $ Z(g) $ possible time orderings of the nodes amongst the admissible node times $ T(g) = \\{T' : (V, E, T', C) \\in \\Gamma^C\\} $. For each node $ i \\in V $, $ \\ubar{t}_i = \\inf_{T \\in T(g)} t_i $ and $ \\bar{t}_i = \\sup_{T \\in T(g)} t_i $ are the earliest and most recent times that \\emph{i} may achieve in an admissible tree with topology $ (V, E) $. If $ S(g) = \\{i \\in V_A : \\ubar{t}_i = \\ubar{t}_1\\} $ denotes the set of \\emph{free} internal nodes with times bounded below by $ \\ubar{t}_1 $, the prior with density\n", "itemtype": "equation", "pos": 24925, "prevtext": "\nwhich exploits the property that each pattern communicates with at most one other during a catastrophe. It is straightforward to adapt the proof of Theorem~\\ref{thm:bdl} to show that this update step correctly describes the effect of catastrophes on the pattern process.\n\n\n\\subsubsection{Missing data}\n\\label{sec:md}\n\nFollowing \\citeauthor{ryder11}, the true binary state of trait \\emph{h} at taxon $ i \\in V_L $ is recorded with probability $ \\PP(d_i^h \\in \\{0, 1\\}) = \\xi_i $, independently of the other taxa. The space of observable site-patterns across the $ L = L^{(0)} $ taxa at time 0 is $ \\cQ = \\{0, 1, ?\\}^{L} \\setminus \\zeros $ and the distribution of the data, stated in Theorem~\\ref{thm:mdl} and proved in the online supplement, follows from the restriction and superposition properties of Poisson processes \\citep{kingman92}.\n\n\\begin{mytheorem}[Missing data distribution]\n\\label{thm:mdl}\nThe number of traits displaying pattern $ \\bq \\in \\cQ $ at time 0, $ \\Nq(0) $ is an independent Poisson random variable with rate parameter\n", "index": 29, "text": "\n\\[\n\\EE[\\Nq(0) | g, \\lambda, \\mu, \\beta, \\Xi]\n\t= \\sum_{\\mathclap{\\bp \\in u(\\bq)}} \\xp(0; g, \\lambda, \\mu, \\beta) \\prod_{i = 1}^{L} \\xi_{k_i^{(0)}}^{\\ind{q_i \\in \\{0, 1\\}}} \\left(1 - \\xi_{k_i^{(0)}}\\right)^{\\ind{q_i = ?}},\n\\]\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex17.m1\" class=\"ltx_Math\" alttext=\"\\EE[\\Nq(0)|g,\\lambda,\\mu,\\beta,\\Xi]=\\sum_{\\mathclap{\\bp\\in u(\\bq)}}\\xp(0;g,%&#10;\\lambda,\\mu,\\beta)\\prod_{i=1}^{L}\\xi_{k_{i}^{(0)}}^{\\ind{q_{i}\\in\\{0,1\\}}}%&#10;\\left(1-\\xi_{k_{i}^{(0)}}\\right)^{\\ind{q_{i}=?}},\" display=\"block\"><mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\EE</mtext></merror><mrow><mo stretchy=\"false\">[</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\Nq</mtext></merror><mrow><mo stretchy=\"false\">(</mo><mn>0</mn><mo stretchy=\"false\">)</mo></mrow><mo stretchy=\"false\">|</mo><mi>g</mi><mo>,</mo><mi>\u03bb</mi><mo>,</mo><mi>\u03bc</mi><mo>,</mo><mi>\u03b2</mi><mo>,</mo><mi mathvariant=\"normal\">\u039e</mi><mo stretchy=\"false\">]</mo></mrow><mo>=</mo><munder><mo largeop=\"true\" movablelimits=\"false\" symmetric=\"true\">\u2211</mo><mpadded lspace=\"-10.5pt\" width=\"0pt\"><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bp</mtext></merror><mo>\u2208</mo><mrow><mi>u</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bq</mtext></merror><mo stretchy=\"false\">)</mo></mrow></mrow></mpadded></munder><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\xp</mtext></merror><mrow><mo stretchy=\"false\">(</mo><mn>0</mn><mo>;</mo><mi>g</mi><mo>,</mo><mi>\u03bb</mi><mo>,</mo><mi>\u03bc</mi><mo>,</mo><mi>\u03b2</mi><mo stretchy=\"false\">)</mo></mrow><munderover><mo largeop=\"true\" movablelimits=\"false\" symmetric=\"true\">\u220f</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>L</mi></munderover><msubsup><mi>\u03be</mi><msubsup><mi>k</mi><mi>i</mi><mrow><mo stretchy=\"false\">(</mo><mn>0</mn><mo stretchy=\"false\">)</mo></mrow></msubsup><mrow><mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\ind</mtext></merror><mo>\u2062</mo><msub><mi>q</mi><mi>i</mi></msub></mrow><mo>\u2208</mo><mrow><mo stretchy=\"false\">{</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy=\"false\">}</mo></mrow></mrow></msubsup><msup><mrow><mo>(</mo><mn>1</mn><mo>-</mo><msub><mi>\u03be</mi><msubsup><mi>k</mi><mi>i</mi><mrow><mo stretchy=\"false\">(</mo><mn>0</mn><mo stretchy=\"false\">)</mo></mrow></msubsup></msub><mo>)</mo></mrow><mrow><mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\ind</mtext></merror><mo>\u2062</mo><msub><mi>q</mi><mi>i</mi></msub></mrow><mo>=</mo><mi mathvariant=\"normal\">?</mi></mrow></msup><mo>,</mo></mrow></math>", "type": "latex"}, {"file": "1601.07931.tex", "nexttext": "\nis approximately marginally uniform across topologies and root times provided $ \\ubar{t}_1 \\ll \\min_{i \\in V \\setminus S} \\ubar{t}_i $ {(\\citeauthor{{ryder11}})}. Uniform priors on offset leaf times completes our prior specification on \\emph{g}. \\citet{heled12} describe an exact method for computing uniform calibrated tree priors but we do not pursue that approach here. Table~\\ref{tab:priors} lists the priors on the remaining parameters.\n\n\\begin{table}[ht]\n\\centering\n\\begin{tabular}{lll}\nParameter\t&\tPrior\t&\tReasoning \\\\ \\hline\nBirth rate\t&\t$ \\lambda \\sim 1 / \\lambda $\t&\tImproper, scale invariant \\\\\nDeath rate\t&\t$ \\mu \\sim \\Gamma(10^{-3}, 10^{-3}) $\t&\tApproximately $ 1 / \\mu $ \\\\\nLateral transfer rate\t&\t$ \\beta \\sim \\Gamma(10^{-3}, 10^{-3}) $\t&\tApproximately $ 1 / \\beta $ \\\\\nCatastrophe rate\t&\t$ \\rho \\sim \\Gamma(1.5, 5 \\times 10^3) $\t&\t$ \\EE[\\rho^{-1}] = 10^4 $ years \\\\\nCatastrophe duration\t&\t$ \\delta | \\mu \\sim \\Exp{\\mu} $\t&\t$ \\EE[\\delta|\\mu] = \\mu^{-1} $ years \\\\\nObservation probabilities\t&\t$ \\Xi \\sim \\mathrm{U}[0, 1]^{L} $\t&\tIndependent, uniform\n\\end{tabular}\n\\caption{Prior distributions on parameters in the Stochastic Dollo and Stochastic Dollo with Lateral Transfer models.}\n\\label{tab:priors}\n\\end{table}\n\nInspecting the solution of the expected pattern frequency calculation~\\eqref{eq:ivp} with initial condition $ \\mathbf{x}(t_1^-) = \\lambda / \\mu $ at the root, we see that $ \\bx(t; g, \\lambda, \\ldots) = \\tfrac{\\lambda}{\\lambda'}  \\bx(t; g, \\lambda', \\ldots) $ for all trait birth rates $ \\lambda $ and times \\emph{t}. We can integrate $ \\lambda $ out of the Poisson likelihood with respect to its prior in Table~\\ref{tab:priors} to obtain a multinomial likelihood whereby a pattern $ \\bp \\in R(\\cQ) $ is observed with probability proportional to its expected frequency. Further details of this step are contained in the online supplement. Putting everything together, the posterior distribution is \n\n", "itemtype": "equation", "pos": 28933, "prevtext": "\nwhere $ u(\\bq) = \\{ \\bp \\in \\cP^{(0)} : p_i = q_i \\text{ \\emph{if} } q_i \\neq\\ ?,\\, i \\in [L]\\} $ is the set of binary patterns consistent with $ \\bq $ and $ \\Xi = (\\xi_i : i \\in V_L) $.\n\\end{mytheorem}\n\nThe first term on the right-hand side in Theorem~\\ref{thm:mdl} is the expected number of binary patterns consistent with $ \\bq $ before masking, and the second term is the probability of having their entries obscured to form $ \\bq $.\n\n\n\\subsubsection{Non-isochronous data}\n\\label{sec:nonIso}\n\nData are isochronous when the taxa are sampled simultaneously. When this is not the case, there are \\emph{offset} leaves in the phylogeny; nodes 12 and 15 in Figure~\\ref{fig:phyTree}, for example. Similar to catastrophes, the trait process is frozen on offset leaves, which remain in $ H(t) = \\{H_i(t) : i \\in E, t_{\\pa(i)} < t < t_i \\, \\ind{i \\in V_L}\\} $. A pattern may now only communicate with those patterns which are identical to it on the extinct lineages and differ by one entry on the evolving lineages, with rates depending on the number of extant traits in a pattern. In Appendix~\\ref{app:nonIso}, we describe how to generalise the expected pattern frequencies calculation~\\eqref{eq:ivp} to account for offset leaves.\n\n\n\\subsubsection{Data registration}\n\\label{sec:reg}\n\nPatterns which are uninformative or unreliable are typically removed from the data. For example, we discard all traits which are not marked present in at least one taxon. Given a registration rule \\emph{R}, which may be a composition of other simpler rules such as those in Table~\\ref{tab:reg}, we discard the columns in the data array \\textbf{D} not satisfying \\emph{R}, leaving $ R(\\bD) $, and restrict our analysis to patterns in $ R(\\cP^{(0)}) $ or $ R(\\cQ) $ where necessary. \n\n\\begin{table}[ht]\n\\centering\n\\begin{tabular}{ll}\nUnregistrable traits & Unregistrable patterns $ \\cQ \\setminus R(\\cQ) $ \\\\ \\hline\nTraits observed in $ j $ leaves or fewer\n\t& $ \\{\\bq \\in \\cQ : |\\{i \\in [L] : q_i = 1\\}| \\leq j\\} $ \\\\\nTraits observed in $ j $ or more leaves\n\t& $ \\{\\bq \\in \\cQ : |\\{i \\in [L] : q_i = 1\\}| \\geq j\\} $ \\\\\nTraits potentially present in $ j $ leaves or greater\n\t& $ \\{\\bq \\in \\cQ : |\\{i \\in [L] : q_i \\neq 0\\}| \\geq j\\} $ \\\\\nTraits absent on lineage $ k_i^{(0)} $\n\t& $ \\{\\bq \\in \\cQ : q_i = 0\\} $\n\\end{tabular}\n\\caption{Registration rules of \\citeauthor{alekseyenko08} and \\citeauthor{ryder11}.}\n\\label{tab:reg}\n\\end{table}\n\n\n\n\\section{Bayesian inference}\n\\label{sec:inference}\n\nIn order to estimate both node times and rate parameters, we calibrate the space $ \\Gamma $ of rooted phylogenetic trees on \\emph{L} taxa with \\emph{clade constraints}. The constraint $ \\Gamma^{(0)} = (g \\in \\Gamma : \\ubar{t}_1 \\leq t_1 < 0) $ restricts the earliest admissible root time $ t_1 $ to $ \\ubar{t}_1 $. Each additional constraint $ \\Gamma^{(c)} $ places either time or ancestry constraints on the remaining nodes. We denote by $ \\Gamma^C = \\bigcap_c \\Gamma^{(c)} $ the calibrated space of phylogenies satisfying the clade constraints.\n\n\\citet{nicholls11} describe a prior on trees with the property that the root time $ t_ 1 $ is marginally approximately uniform across a specified interval $ [\\ubar{t}_1, \\bar{t}_1] \\subset \\R_{\\leq 0} $. For a given tree $ g = (V, E, T, C) $, there are $ Z(g) $ possible time orderings of the nodes amongst the admissible node times $ T(g) = \\{T' : (V, E, T', C) \\in \\Gamma^C\\} $. For each node $ i \\in V $, $ \\ubar{t}_i = \\inf_{T \\in T(g)} t_i $ and $ \\bar{t}_i = \\sup_{T \\in T(g)} t_i $ are the earliest and most recent times that \\emph{i} may achieve in an admissible tree with topology $ (V, E) $. If $ S(g) = \\{i \\in V_A : \\ubar{t}_i = \\ubar{t}_1\\} $ denotes the set of \\emph{free} internal nodes with times bounded below by $ \\ubar{t}_1 $, the prior with density\n", "index": 31, "text": "\n\\[\nf_G(g) \\prop \\frac{\\ind{g \\in \\Gamma^C}}{Z(g)} \\prod_{i \\in S(g)}  \\frac{\\ubar{t}_1 - \\bar{t}_i}{t_1 - \\bar{t}_i},\n\\]\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex18.m1\" class=\"ltx_Math\" alttext=\"f_{G}(g)\\prop\\frac{\\ind{g\\in\\Gamma^{C}}}{Z(g)}\\prod_{i\\in S(g)}\\frac{\\ubar{t}_%&#10;{1}-\\bar{t}_{i}}{t_{1}-\\bar{t}_{i}},\" display=\"block\"><mrow><mrow><msub><mi>f</mi><mi>G</mi></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>g</mi><mo stretchy=\"false\">)</mo></mrow><mo>\u2062</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\prop</mtext></merror><mo>\u2062</mo><mfrac><mrow><mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\ind</mtext></merror><mo>\u2062</mo><mi>g</mi></mrow><mo>\u2208</mo><msup><mi mathvariant=\"normal\">\u0393</mi><mi>C</mi></msup></mrow><mrow><mi>Z</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>g</mi><mo stretchy=\"false\">)</mo></mrow></mrow></mfrac><mo>\u2062</mo><mrow><munder><mo largeop=\"true\" movablelimits=\"false\" symmetric=\"true\">\u220f</mo><mrow><mi>i</mi><mo>\u2208</mo><mrow><mi>S</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>g</mi><mo stretchy=\"false\">)</mo></mrow></mrow></mrow></munder><mfrac><mrow><mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\ubar</mtext></merror><mo>\u2062</mo><msub><mi>t</mi><mn>1</mn></msub></mrow><mo>-</mo><msub><mover accent=\"true\"><mi>t</mi><mo stretchy=\"false\">\u00af</mo></mover><mi>i</mi></msub></mrow><mrow><msub><mi>t</mi><mn>1</mn></msub><mo>-</mo><msub><mover accent=\"true\"><mi>t</mi><mo stretchy=\"false\">\u00af</mo></mover><mi>i</mi></msub></mrow></mfrac></mrow></mrow><mo>,</mo></mrow></math>", "type": "latex"}, {"file": "1601.07931.tex", "nexttext": "\nwhere $ n_{\\bp} = |\\{h \\in \\cH(0) : \\bp = \\bd^h \\in R(\\bD)\\}| $ is the frequency of traits displaying pattern $ \\bp \\in R(\\cQ) $ in the registered data $ R(\\bD) $ and the expected pattern frequencies $ \\bx(0) \\equiv \\bx(0; g, \\lambda, \\mu, \\beta, \\rho, \\delta, \\Xi) $~\\eqref{eq:ivp} account for catastrophes, missing data and offset leaves where necessary. This completes the specification of the Stochastic Dollo with Lateral Transfer (SDLT) model.\n\nThe posterior~\\eqref{eq:intPost} is intractable but may be explored using standard Markov chain Monte Carlo (MCMC) sampling schemes for phylogenetic trees and Stochastic Dollo models {(\\citeauthor{{nicholls08, ryder11}})}. We describe the MCMC transition kernels for moves particular to the SDLT model in Appendix~\\ref{app:MCMC}. To assess convergence of the Markov chains, we monitor the sample autocorrelation functions of the parameters and log-likelihoods \\citep{geyer92}.\n\n\\subsubsection*{Implementation}\n\nCode to implement the SDLT model in the software package \\texttt{TraitLab} \\citep{nicholls13} is available from the authors.\n\n\n\n\\section{Method testing}\n\\label{sec:testing}\n\n\\citeauthor{nicholls08} describe a number of tests to validate their inference procedure. We compare the exact and empirical distributions of synthetic data to validate our implementation of the expected pattern frequency calculation~\\eqref{eq:ivp}. In addition, we test the identifiability of the SDLT model, its consistency with the SD model when the lateral transfer rate $ \\beta = 0 $ and its robustness to a common form of model misspecification whereby recently transferred traits are discarded. In each case, we obtain a satisfactory fit to the data and recover the true parameters. Full details of these analyses are contained in the online supplement.\n\n\n\n\\section{Applications}\n\\label{sec:applications}\n\nThe order and timing of human settlement in Eastern Polynesia is a matter of debate. In the standard subgrouping of the Eastern Polynesian languages, Rapanui diverges first, followed by the split leading to the Tahitic and Marquesic languages \\citep{marck00}. This theory has recently been challenged in light of new linguistic and archaeological evidence. In an implicit phylogenetic network study of lexical traits, \\citet{gray10} detect non-tree-like signals in the data and the Tahitic and Marquesic languages do not form clean clusters. From a meta-analysis of radiocarbon dates, \\citet{wilmshurst11} claim that the islands of Eastern Polynesia were settled in two distinct phases: the Society Islands between 900 and 1000 years before the present (BP) and the remainder between 700 and 900 years BP. These dates are much later than previously thought \\citep{spriggs93} and do not allow much time for the development of the Eastern Polynesian language subgroups. On this basis and further evidence of lateral transfer in primary source material, \\citet{walworth14} disputes Marquesic and Tahitic as distinct subgroups. Furthermore, \\citet{conte14} present evidence of human settlement in the Marquesas Islands approximately 1100 years BP.\n\nTo add to this debate, we illustrate the SDLT model on lexical traits in eleven Eastern Polynesian languages drawn from the approximately 1200 languages in the Austronesian Basic Vocabulary Database \\citep{greenhill08}. The data is a subset of the Polynesian language data set analysed by \\citeauthor{gray10} and known-transferred traits remain in the data. We analyse the 968 traits marked present in at least one of the eleven languages, hereafter referred to as \\texttt{POLY-0}. The data are assumed isochronous and consistent with \\citeauthor{gray09}, the only clade constraint limits the root of the tree to lie on an interval between 1150 and 1800 years BP.\n\nIn agreement with \\citeauthor{gray10} and \\citeauthor{walworth14}, we detect clear evidence of lateral transfer. First of all, there is significant discord between the marginal tree posteriors in Figure~\\ref{tree:poly}: the SD model places 64\\% support on a single topology, which is a spurious level of confidence, and the 95\\% highest posterior probability set obtained using \\texttt{BEAST} \\citep{drummond12} consists of just 8 topologies, compared to 120 under the SDLT model. Secondly, the SD model assumption that traits are born on lineages ancestral to the leaves in which they appear is forcing the model to explain more variation through deaths, leading to the inflated death rate $ \\mu $ visible in Figure~\\ref{pars:polyMu}. The relative transfer rate $ \\beta / \\mu $ is the expected number of times an instance of a trait transfers before dying. From the marginal priors in Table~\\ref{tab:priors}, we may derive that the prior on $ \\beta / \\mu $ is a Beta distribution of the second kind with infinite mean and variance. The posterior distribution in Figure~\\ref{pars:polyBM} is well-informed and centred on 1.36. In comparison, \\citeauthor{nicholls08} and \\citeauthor{greenhill09} considered a relative transfer rate of 0.5 high. Histograms for the remaining parameters as well as the trace and autocorrelation plots used to diagnose convergence are contained in the online supplement.\n\n\\begin{figure}[t]\n\\centering\n\\subfloat[]{\\includegraphics[width=0.49\\textwidth, trim = 0cm 0cm 0cm 0cm, clip]{densB.pdf} \\label{tree:polySDLT}}\n\\subfloat[]{\\includegraphics[width=0.49\\textwidth, trim = 0cm 0cm 0cm 0cm, clip]{densN.pdf} \\label{tree:polySD}}\n\\caption{Marginal tree posteriors under the \\protect\\subref{tree:polySDLT} SDLT and \\protect\\subref{tree:polySD} SD models fitted to \\texttt{POLY-0}. Figures were created using \\texttt{DensiTree} \\citep{bouckaert14}. The most frequent topology is coloured blue, followed by red then green, with the remainder in dark green.}\n\\label{tree:poly}\n\\end{figure}\n\n\\begin{figure}[t]\n\\centering\n\\begin{tabular}{@{}c@{}@{}c@{}@{}c@{}}\n\\subfloat[]{\\includegraphics[width=0.325\\textwidth, trim = 0.05cm 0cm 0.6cm 0.25cm, clip]{histRoot.pdf} \\label{pars:polyRoot}} &\n\\subfloat[]{\\includegraphics[width=0.325\\textwidth, trim = 0.05cm 0cm 0.6cm 0.25cm, clip]{histMu.pdf} \\label{pars:polyMu}} &\n\\subfloat[]{\\includegraphics[width=0.325\\textwidth, trim = 0.05cm 0cm 0.6cm 0.25cm, clip]{histBM.pdf} \\label{pars:polyBM}}\n\\end{tabular}\n\\caption{Marginal posterior distributions of the \\protect\\subref{pars:polyRoot} root age $ -t_1 $, \\protect\\subref{pars:polyMu} death rate $ \\mu $ and \\protect\\subref{pars:polyBM} relative transfer rate $ \\beta / \\mu $ under the SDLT and SD models fitted to the Eastern Polynesian data set \\texttt{POLY-0}. Effective sample sizes are in parentheses.}\n\\label{pars:poly}\n\\end{figure}\n\nThere is insufficient evidence in our results to support the claims made by \\citeauthor{wilmshurst11} as the posterior distribution of the root age $ -t_1 $ is approximately uniform across its predefined range. The Marquesic languages, Marquesan and Mangareva, are siblings under the SDLT model. But in agreement with \\citeauthor{gray10} and \\citeauthor{walworth14}, the Marquesic and Tahitic languages do not form disjoint subtrees under either model, although nor does Rapanui form an outgroup. With this in mind, we now assess the validity of our analyses.\n\nWe performed two sets of tests for goodness-of-fit. We relax each of the leaf constraints in turn and compute a Bayes factor comparing the relaxed and constrained models. A large Bayes factor here indicates a lack of support for the leaf constraint and is an indicator of model misspecification. If the constraint $ \\Gamma^{(i)} = \\{g \\in \\Gamma : t_i = 0\\} $ fixes leaf $ i \\in V_L $ at time 0, let $ \\Gamma^{(i')} = (g \\in \\Gamma : -10^3 \\leq 0 \\leq 10^3) $ denote its relaxation and $ \\Gamma^{C'} $ the calibrated space of phylogenies with $ \\Gamma^{(i)} $ replaced by $ \\Gamma^{(i')} $. Following \\citeauthor{ryder11}, $ \\Gamma^C $ is nested within $ \\Gamma^{C'} $ so the Bayes factor\n\n", "itemtype": "equation", "pos": 30982, "prevtext": "\nis approximately marginally uniform across topologies and root times provided $ \\ubar{t}_1 \\ll \\min_{i \\in V \\setminus S} \\ubar{t}_i $ {(\\citeauthor{{ryder11}})}. Uniform priors on offset leaf times completes our prior specification on \\emph{g}. \\citet{heled12} describe an exact method for computing uniform calibrated tree priors but we do not pursue that approach here. Table~\\ref{tab:priors} lists the priors on the remaining parameters.\n\n\\begin{table}[ht]\n\\centering\n\\begin{tabular}{lll}\nParameter\t&\tPrior\t&\tReasoning \\\\ \\hline\nBirth rate\t&\t$ \\lambda \\sim 1 / \\lambda $\t&\tImproper, scale invariant \\\\\nDeath rate\t&\t$ \\mu \\sim \\Gamma(10^{-3}, 10^{-3}) $\t&\tApproximately $ 1 / \\mu $ \\\\\nLateral transfer rate\t&\t$ \\beta \\sim \\Gamma(10^{-3}, 10^{-3}) $\t&\tApproximately $ 1 / \\beta $ \\\\\nCatastrophe rate\t&\t$ \\rho \\sim \\Gamma(1.5, 5 \\times 10^3) $\t&\t$ \\EE[\\rho^{-1}] = 10^4 $ years \\\\\nCatastrophe duration\t&\t$ \\delta | \\mu \\sim \\Exp{\\mu} $\t&\t$ \\EE[\\delta|\\mu] = \\mu^{-1} $ years \\\\\nObservation probabilities\t&\t$ \\Xi \\sim \\mathrm{U}[0, 1]^{L} $\t&\tIndependent, uniform\n\\end{tabular}\n\\caption{Prior distributions on parameters in the Stochastic Dollo and Stochastic Dollo with Lateral Transfer models.}\n\\label{tab:priors}\n\\end{table}\n\nInspecting the solution of the expected pattern frequency calculation~\\eqref{eq:ivp} with initial condition $ \\mathbf{x}(t_1^-) = \\lambda / \\mu $ at the root, we see that $ \\bx(t; g, \\lambda, \\ldots) = \\tfrac{\\lambda}{\\lambda'}  \\bx(t; g, \\lambda', \\ldots) $ for all trait birth rates $ \\lambda $ and times \\emph{t}. We can integrate $ \\lambda $ out of the Poisson likelihood with respect to its prior in Table~\\ref{tab:priors} to obtain a multinomial likelihood whereby a pattern $ \\bp \\in R(\\cQ) $ is observed with probability proportional to its expected frequency. Further details of this step are contained in the online supplement. Putting everything together, the posterior distribution is \n\n", "index": 33, "text": "\\begin{equation}\n\\label{eq:intPost}\n\\begin{split}\n&\\pi(g, \\mu, \\beta, \\rho, \\delta, \\Xi | R(\\bD)) \\\\\n\t&\\quad\\propto f_G(g) f_M(\\mu) f_B(\\beta) f_R(\\rho) f_{D|M}(\\delta|\\mu) \\prod_{\\bp \\in R(\\cQ)} \\left[\\frac{\\xp(0)}{\\sum_{\\bq \\in R(\\cQ)} \\xq(0)}\\right]^{\\np},\n\\end{split}\n\\end{equation}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E4.m1\" class=\"ltx_Math\" alttext=\"\\begin{split}&amp;\\displaystyle\\pi(g,\\mu,\\beta,\\rho,\\delta,\\Xi|R(\\bD))\\\\&#10;&amp;\\displaystyle\\quad\\propto f_{G}(g)f_{M}(\\mu)f_{B}(\\beta)f_{R}(\\rho)f_{D|M}(%&#10;\\delta|\\mu)\\prod_{\\bp\\in R(\\cQ)}\\left[\\frac{\\xp(0)}{\\sum_{\\bq\\in R(\\cQ)}\\xq(0)%&#10;}\\right]^{\\np},\\end{split}\" display=\"block\"><mtable columnspacing=\"0pt\" displaystyle=\"true\" rowspacing=\"0pt\"><mtr><mtd/><mtd columnalign=\"left\"><mrow><mi>\u03c0</mi><mrow><mo stretchy=\"false\">(</mo><mi>g</mi><mo>,</mo><mi>\u03bc</mi><mo>,</mo><mi>\u03b2</mi><mo>,</mo><mi>\u03c1</mi><mo>,</mo><mi>\u03b4</mi><mo>,</mo><mi mathvariant=\"normal\">\u039e</mi><mo stretchy=\"false\">|</mo><mi>R</mi><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bD</mtext></merror><mo stretchy=\"false\">)</mo></mrow><mo stretchy=\"false\">)</mo></mrow></mrow></mtd></mtr><mtr><mtd/><mtd columnalign=\"left\"><mrow><mo lspace=\"12.5pt\">\u221d</mo><msub><mi>f</mi><mi>G</mi></msub><mrow><mo stretchy=\"false\">(</mo><mi>g</mi><mo stretchy=\"false\">)</mo></mrow><msub><mi>f</mi><mi>M</mi></msub><mrow><mo stretchy=\"false\">(</mo><mi>\u03bc</mi><mo stretchy=\"false\">)</mo></mrow><msub><mi>f</mi><mi>B</mi></msub><mrow><mo stretchy=\"false\">(</mo><mi>\u03b2</mi><mo stretchy=\"false\">)</mo></mrow><msub><mi>f</mi><mi>R</mi></msub><mrow><mo stretchy=\"false\">(</mo><mi>\u03c1</mi><mo stretchy=\"false\">)</mo></mrow><msub><mi>f</mi><mrow><mi>D</mi><mo stretchy=\"false\">|</mo><mi>M</mi></mrow></msub><mrow><mo stretchy=\"false\">(</mo><mi>\u03b4</mi><mo stretchy=\"false\">|</mo><mi>\u03bc</mi><mo stretchy=\"false\">)</mo></mrow><munder><mo largeop=\"true\" movablelimits=\"false\" symmetric=\"true\">\u220f</mo><mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bp</mtext></merror><mo>\u2208</mo><mrow><mi>R</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\cQ</mtext></merror><mo stretchy=\"false\">)</mo></mrow></mrow></mrow></munder><msup><mrow><mo>[</mo><mfrac><mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\xp</mtext></merror><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mn>0</mn><mo stretchy=\"false\">)</mo></mrow></mrow><mrow><msub><mo largeop=\"true\" symmetric=\"true\">\u2211</mo><mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bq</mtext></merror><mo>\u2208</mo><mrow><mi>R</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\cQ</mtext></merror><mo stretchy=\"false\">)</mo></mrow></mrow></mrow></msub><mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\xq</mtext></merror><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mn>0</mn><mo stretchy=\"false\">)</mo></mrow></mrow></mrow></mfrac><mo>]</mo></mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\np</mtext></merror></msup><mo>,</mo></mrow></mtd></mtr></mtable></math>", "type": "latex"}, {"file": "1601.07931.tex", "nexttext": "\nreduces to a Savage-Dickey ratio of the marginal prior and posterior densities that the constraint is satisfied in the relaxed model. We cannot compute the Savage-Dickey ratio~\\eqref{eq:SDR} in closed form so we replace the densities with kernel estimates based on marginal samples from the posterior~\\eqref{eq:intPost}. The results, displayed in Figure~\\ref{fig:polyBF}, indicate a satisfactory fit for the SDLT model with log-Bayes factors close to zero in each case. There is little to no support for the constraints on Mangareva, Marquesan and Rapanui under the SD model, thereby highlighting its misspecification on the data. Histograms of the marginal leaf ages are contained in the online supplement.\n\n\\begin{figure}[t]\n\\centering\n\\includegraphics[width=\\textwidth, trim = 0.5cm 0cm 1.25cm 0.25cm, clip]{logBFLeaves.pdf}\n\\caption{Bayes factors describing the lack of support for the leaf constraints used to fit the SDLT and SD models to \\texttt{POLY-0}. In the case of Rapanui, there is no posterior support for the leaf constraint so the Bayes factor is infinite.}\n\\label{fig:polyBF}\n\\end{figure}\n\nWe assess the predictive performance of each model on a random splitting of the registered data $ R(\\bD) $ into evenly sized training $ \\bDtr $ and test $ \\bDte $ portions. Following \\citet{madigan94}, we score each model by its log-posterior predictive probability, $ \\log \\pi(\\bDte | \\bDtr) $, where $ \\pi(\\bDte | \\bDtr) = \\int \\pi(\\bDte | x) \\pi(x | \\bDtr) \\mathrm{d}x $ and $ x = (g, \\mu, \\beta, \\rho, \\delta, \\Xi) $. The difference in predictive scores may be interpreted as a log-Bayes factor measuring the relative success of models at predicting the withheld data $ \\bDte $ \\citep{kass95}. In Table~\\ref{tab:ppp}, we observe superior predictive performance from the SDLT model on \\texttt{POLY-0}.\n\n\\begin{table}[t]\n\\centering\n\\begin{tabular}{lllll}\nTraining set\t\t\t&\tTest set\t\t\t\t&\tSDLT score\t&\tSD score \t&\tLog-Bayes factor \\\\ \\hline\n\\texttt{POLY-0/train}\t&\t\\texttt{POLY-0/test}\t&\t-3093.4\t\t&\t-3174.7\t\t&\t81.3\t\\\\\n\\texttt{POLY-1/train}\t&\t\\texttt{POLY-1/test}\t&\t-1421.5\t\t&\t-1535.5 \t&\t114.0 \\\\\n\\end{tabular}\n\\caption{Posterior predictive model assessment.}\n\\label{tab:ppp}\n\\end{table}\n\nTraits marked present in a single language are often deemed unreliable and removed in the registration process. To address this concern, we repeated our analyses on the data set \\texttt{POLY-1} formed by discarding the \\emph{singleton} patterns from \\texttt{POLY-0}, with the details contained in the online supplement. Singleton patterns play an important role in SDLT model inference as although the outcome of the predictive assessment was unchanged, credible intervals for some parameters were affected.\n\n\n\n\\section{Concluding remarks}\n\\label{sec:conclusions}\n\nLateral transfer is an important problem but practitioners generally lack statistical tools to make likelihood-based inference for phylogenetic trees in this setting. We address this issue with a novel model of species diversification which extends the Stochastic Dollo model for lateral transfer. To our knowledge, our method is the first fully likelihood-based approach to control for lateral transfer in reconstructing a rooted phylogenetic tree. The second major contribution of this paper is the inference procedure whereby we integrate out the locations of the trait birth, death and transfer events using systems of differential equations, thereby summing over all possible trait histories on a given tree. This marginal algorithm is more efficient than also inferring the locations of trait events {(\\citeauthor{{bloomquist10}})}.\n\nIn the example we considered, accounting for lateral transfer results in an improved fit over the regular Stochastic Dollo model, but at a significant computational cost. The sequence of initial value problems to compute the likelihood parameters in the lateral transfer model is easy to state but difficult to solve. On a tree with \\emph{L} leaves, we may exploit symmetry in the differential systems to compute the expected pattern frequencies exactly in $ \\cO(2^{2L}) $ operations. In practice, we use an ordinary differential equation solver to approximate their values within an error tolerance dominated by the Monte Carlo error. This approach requires $ \\cO(L 2^L C(L)) $ operations, where the number of steps $ C(L) $ required grows roughly linearly in \\texttt{MatLab} for the range of \\emph{L} we consider. This approach is feasible for up to approximately $ L = 20 $ leaves on readily available hardware. As we must evaluate the likelihood many times over the course of an MCMC analysis, this is a major stumbling block towards applying our model to data sets with more taxa or multiple character states, and is the focus of our current research.\n\nThe model as described is not \\emph{projective} in the sense that we cannot marginalise out the effect of unobserved lineages. Consequently, as the number of unobserved lineages increases, the probability of a trait transferring to a sampled lineage decreases; and a trait which previously died out on the sampled lineages may transfer back into the system from an unobserved lineage. It would not be difficult to introduce \\emph{ghost} lineages in the style of \\citet{szollosi13} to our model to allow for lateral transfer between sampled and unsampled taxa. There are many other avenues for future work on the model. For example, one could partition the data across a mixture of models and trees; relax the global regime of lateral transfer; allow rates to vary more freely across lineages or time; model correlated evolution of traits in the style of \\citet{cybis15}, for example, and allow for other types of missing data.\n\nThere are many open problems which have been ignored due to the expense of fitting models that account for lateral transfer. One such example occurs with the ancestry-constrained model proposed by \\citeauthor{chang15} whereby ancestral nodes may have data. Stochastic Dollo without lateral transfer cannot be used in this setting whenever there are traits which are absent in an ancestral state but present in both descendent and non-descendent leaves. Our approach addresses this issue.\n\n\n\\appendix\n\n\n\\section{Non-isochronous data}\n\\label{app:nonIso}\n\nThe $ \\Lt = |H(t)| $ extinct and evolving lineages at time \\emph{t} are labelled\n", "itemtype": "equation", "pos": 39134, "prevtext": "\nwhere $ n_{\\bp} = |\\{h \\in \\cH(0) : \\bp = \\bd^h \\in R(\\bD)\\}| $ is the frequency of traits displaying pattern $ \\bp \\in R(\\cQ) $ in the registered data $ R(\\bD) $ and the expected pattern frequencies $ \\bx(0) \\equiv \\bx(0; g, \\lambda, \\mu, \\beta, \\rho, \\delta, \\Xi) $~\\eqref{eq:ivp} account for catastrophes, missing data and offset leaves where necessary. This completes the specification of the Stochastic Dollo with Lateral Transfer (SDLT) model.\n\nThe posterior~\\eqref{eq:intPost} is intractable but may be explored using standard Markov chain Monte Carlo (MCMC) sampling schemes for phylogenetic trees and Stochastic Dollo models {(\\citeauthor{{nicholls08, ryder11}})}. We describe the MCMC transition kernels for moves particular to the SDLT model in Appendix~\\ref{app:MCMC}. To assess convergence of the Markov chains, we monitor the sample autocorrelation functions of the parameters and log-likelihoods \\citep{geyer92}.\n\n\\subsubsection*{Implementation}\n\nCode to implement the SDLT model in the software package \\texttt{TraitLab} \\citep{nicholls13} is available from the authors.\n\n\n\n\\section{Method testing}\n\\label{sec:testing}\n\n\\citeauthor{nicholls08} describe a number of tests to validate their inference procedure. We compare the exact and empirical distributions of synthetic data to validate our implementation of the expected pattern frequency calculation~\\eqref{eq:ivp}. In addition, we test the identifiability of the SDLT model, its consistency with the SD model when the lateral transfer rate $ \\beta = 0 $ and its robustness to a common form of model misspecification whereby recently transferred traits are discarded. In each case, we obtain a satisfactory fit to the data and recover the true parameters. Full details of these analyses are contained in the online supplement.\n\n\n\n\\section{Applications}\n\\label{sec:applications}\n\nThe order and timing of human settlement in Eastern Polynesia is a matter of debate. In the standard subgrouping of the Eastern Polynesian languages, Rapanui diverges first, followed by the split leading to the Tahitic and Marquesic languages \\citep{marck00}. This theory has recently been challenged in light of new linguistic and archaeological evidence. In an implicit phylogenetic network study of lexical traits, \\citet{gray10} detect non-tree-like signals in the data and the Tahitic and Marquesic languages do not form clean clusters. From a meta-analysis of radiocarbon dates, \\citet{wilmshurst11} claim that the islands of Eastern Polynesia were settled in two distinct phases: the Society Islands between 900 and 1000 years before the present (BP) and the remainder between 700 and 900 years BP. These dates are much later than previously thought \\citep{spriggs93} and do not allow much time for the development of the Eastern Polynesian language subgroups. On this basis and further evidence of lateral transfer in primary source material, \\citet{walworth14} disputes Marquesic and Tahitic as distinct subgroups. Furthermore, \\citet{conte14} present evidence of human settlement in the Marquesas Islands approximately 1100 years BP.\n\nTo add to this debate, we illustrate the SDLT model on lexical traits in eleven Eastern Polynesian languages drawn from the approximately 1200 languages in the Austronesian Basic Vocabulary Database \\citep{greenhill08}. The data is a subset of the Polynesian language data set analysed by \\citeauthor{gray10} and known-transferred traits remain in the data. We analyse the 968 traits marked present in at least one of the eleven languages, hereafter referred to as \\texttt{POLY-0}. The data are assumed isochronous and consistent with \\citeauthor{gray09}, the only clade constraint limits the root of the tree to lie on an interval between 1150 and 1800 years BP.\n\nIn agreement with \\citeauthor{gray10} and \\citeauthor{walworth14}, we detect clear evidence of lateral transfer. First of all, there is significant discord between the marginal tree posteriors in Figure~\\ref{tree:poly}: the SD model places 64\\% support on a single topology, which is a spurious level of confidence, and the 95\\% highest posterior probability set obtained using \\texttt{BEAST} \\citep{drummond12} consists of just 8 topologies, compared to 120 under the SDLT model. Secondly, the SD model assumption that traits are born on lineages ancestral to the leaves in which they appear is forcing the model to explain more variation through deaths, leading to the inflated death rate $ \\mu $ visible in Figure~\\ref{pars:polyMu}. The relative transfer rate $ \\beta / \\mu $ is the expected number of times an instance of a trait transfers before dying. From the marginal priors in Table~\\ref{tab:priors}, we may derive that the prior on $ \\beta / \\mu $ is a Beta distribution of the second kind with infinite mean and variance. The posterior distribution in Figure~\\ref{pars:polyBM} is well-informed and centred on 1.36. In comparison, \\citeauthor{nicholls08} and \\citeauthor{greenhill09} considered a relative transfer rate of 0.5 high. Histograms for the remaining parameters as well as the trace and autocorrelation plots used to diagnose convergence are contained in the online supplement.\n\n\\begin{figure}[t]\n\\centering\n\\subfloat[]{\\includegraphics[width=0.49\\textwidth, trim = 0cm 0cm 0cm 0cm, clip]{densB.pdf} \\label{tree:polySDLT}}\n\\subfloat[]{\\includegraphics[width=0.49\\textwidth, trim = 0cm 0cm 0cm 0cm, clip]{densN.pdf} \\label{tree:polySD}}\n\\caption{Marginal tree posteriors under the \\protect\\subref{tree:polySDLT} SDLT and \\protect\\subref{tree:polySD} SD models fitted to \\texttt{POLY-0}. Figures were created using \\texttt{DensiTree} \\citep{bouckaert14}. The most frequent topology is coloured blue, followed by red then green, with the remainder in dark green.}\n\\label{tree:poly}\n\\end{figure}\n\n\\begin{figure}[t]\n\\centering\n\\begin{tabular}{@{}c@{}@{}c@{}@{}c@{}}\n\\subfloat[]{\\includegraphics[width=0.325\\textwidth, trim = 0.05cm 0cm 0.6cm 0.25cm, clip]{histRoot.pdf} \\label{pars:polyRoot}} &\n\\subfloat[]{\\includegraphics[width=0.325\\textwidth, trim = 0.05cm 0cm 0.6cm 0.25cm, clip]{histMu.pdf} \\label{pars:polyMu}} &\n\\subfloat[]{\\includegraphics[width=0.325\\textwidth, trim = 0.05cm 0cm 0.6cm 0.25cm, clip]{histBM.pdf} \\label{pars:polyBM}}\n\\end{tabular}\n\\caption{Marginal posterior distributions of the \\protect\\subref{pars:polyRoot} root age $ -t_1 $, \\protect\\subref{pars:polyMu} death rate $ \\mu $ and \\protect\\subref{pars:polyBM} relative transfer rate $ \\beta / \\mu $ under the SDLT and SD models fitted to the Eastern Polynesian data set \\texttt{POLY-0}. Effective sample sizes are in parentheses.}\n\\label{pars:poly}\n\\end{figure}\n\nThere is insufficient evidence in our results to support the claims made by \\citeauthor{wilmshurst11} as the posterior distribution of the root age $ -t_1 $ is approximately uniform across its predefined range. The Marquesic languages, Marquesan and Mangareva, are siblings under the SDLT model. But in agreement with \\citeauthor{gray10} and \\citeauthor{walworth14}, the Marquesic and Tahitic languages do not form disjoint subtrees under either model, although nor does Rapanui form an outgroup. With this in mind, we now assess the validity of our analyses.\n\nWe performed two sets of tests for goodness-of-fit. We relax each of the leaf constraints in turn and compute a Bayes factor comparing the relaxed and constrained models. A large Bayes factor here indicates a lack of support for the leaf constraint and is an indicator of model misspecification. If the constraint $ \\Gamma^{(i)} = \\{g \\in \\Gamma : t_i = 0\\} $ fixes leaf $ i \\in V_L $ at time 0, let $ \\Gamma^{(i')} = (g \\in \\Gamma : -10^3 \\leq 0 \\leq 10^3) $ denote its relaxation and $ \\Gamma^{C'} $ the calibrated space of phylogenies with $ \\Gamma^{(i)} $ replaced by $ \\Gamma^{(i')} $. Following \\citeauthor{ryder11}, $ \\Gamma^C $ is nested within $ \\Gamma^{C'} $ so the Bayes factor\n\n", "index": 35, "text": "\\begin{align}\n\\label{eq:SDR}\nB_{i', i}\n\t&= \\frac{\\pi(R(\\bD) | g \\in \\Gamma^{C'})}{\\pi(R(\\bD) | g \\in \\Gamma^C)} \\nonumber \\\\\n\t&= \\frac{\\pi(R(\\bD) | g \\in \\Gamma^{C'})}{\\pi(R(\\bD) | g \\in \\Gamma^C \\cap \\Gamma^{C'})} \\nonumber \\\\\n\t&= \\frac{\\pi(g \\in \\Gamma^C | g \\in \\Gamma^{C'})}{\\pi(g \\in \\Gamma^C | R(\\bD), g \\in \\Gamma^{C'})},\n\\end{align}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex19.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle B_{i^{\\prime},i}\" display=\"inline\"><msub><mi>B</mi><mrow><msup><mi>i</mi><mo>\u2032</mo></msup><mo>,</mo><mi>i</mi></mrow></msub></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex19.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle=\\frac{\\pi(R(\\bD)|g\\in\\Gamma^{C^{\\prime}})}{\\pi(R(\\bD)|g\\in\\Gamma%&#10;^{C})}\" display=\"inline\"><mrow><mi/><mo>=</mo><mstyle displaystyle=\"true\"><mfrac><mrow><mi>\u03c0</mi><mrow><mo stretchy=\"false\">(</mo><mi>R</mi><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bD</mtext></merror><mo stretchy=\"false\">)</mo></mrow><mo stretchy=\"false\">|</mo><mi>g</mi><mo>\u2208</mo><msup><mi mathvariant=\"normal\">\u0393</mi><msup><mi>C</mi><mo>\u2032</mo></msup></msup><mo stretchy=\"false\">)</mo></mrow></mrow><mrow><mi>\u03c0</mi><mrow><mo stretchy=\"false\">(</mo><mi>R</mi><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bD</mtext></merror><mo stretchy=\"false\">)</mo></mrow><mo stretchy=\"false\">|</mo><mi>g</mi><mo>\u2208</mo><msup><mi mathvariant=\"normal\">\u0393</mi><mi>C</mi></msup><mo stretchy=\"false\">)</mo></mrow></mrow></mfrac></mstyle></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex20.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle=\\frac{\\pi(R(\\bD)|g\\in\\Gamma^{C^{\\prime}})}{\\pi(R(\\bD)|g\\in\\Gamma%&#10;^{C}\\cap\\Gamma^{C^{\\prime}})}\" display=\"inline\"><mrow><mi/><mo>=</mo><mstyle displaystyle=\"true\"><mfrac><mrow><mi>\u03c0</mi><mrow><mo stretchy=\"false\">(</mo><mi>R</mi><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bD</mtext></merror><mo stretchy=\"false\">)</mo></mrow><mo stretchy=\"false\">|</mo><mi>g</mi><mo>\u2208</mo><msup><mi mathvariant=\"normal\">\u0393</mi><msup><mi>C</mi><mo>\u2032</mo></msup></msup><mo stretchy=\"false\">)</mo></mrow></mrow><mrow><mi>\u03c0</mi><mrow><mo stretchy=\"false\">(</mo><mi>R</mi><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bD</mtext></merror><mo stretchy=\"false\">)</mo></mrow><mo stretchy=\"false\">|</mo><mi>g</mi><mo>\u2208</mo><msup><mi mathvariant=\"normal\">\u0393</mi><mi>C</mi></msup><mo>\u2229</mo><msup><mi mathvariant=\"normal\">\u0393</mi><msup><mi>C</mi><mo>\u2032</mo></msup></msup><mo stretchy=\"false\">)</mo></mrow></mrow></mfrac></mstyle></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.E5.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle=\\frac{\\pi(g\\in\\Gamma^{C}|g\\in\\Gamma^{C^{\\prime}})}{\\pi(g\\in%&#10;\\Gamma^{C}|R(\\bD),g\\in\\Gamma^{C^{\\prime}})},\" display=\"inline\"><mrow><mrow><mi/><mo>=</mo><mstyle displaystyle=\"true\"><mfrac><mrow><mi>\u03c0</mi><mrow><mo stretchy=\"false\">(</mo><mi>g</mi><mo>\u2208</mo><msup><mi mathvariant=\"normal\">\u0393</mi><mi>C</mi></msup><mo stretchy=\"false\">|</mo><mi>g</mi><mo>\u2208</mo><msup><mi mathvariant=\"normal\">\u0393</mi><msup><mi>C</mi><mo>\u2032</mo></msup></msup><mo stretchy=\"false\">)</mo></mrow></mrow><mrow><mi>\u03c0</mi><mrow><mo stretchy=\"false\">(</mo><mi>g</mi><mo>\u2208</mo><msup><mi mathvariant=\"normal\">\u0393</mi><mi>C</mi></msup><mo stretchy=\"false\">|</mo><mi>R</mi><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bD</mtext></merror><mo stretchy=\"false\">)</mo></mrow><mo>,</mo><mi>g</mi><mo>\u2208</mo><msup><mi mathvariant=\"normal\">\u0393</mi><msup><mi>C</mi><mo>\u2032</mo></msup></msup><mo stretchy=\"false\">)</mo></mrow></mrow></mfrac></mstyle></mrow><mo>,</mo></mrow></math>", "type": "latex"}, {"file": "1601.07931.tex", "nexttext": "\nThe Hamming distance between patterns $ \\bp $ and $ \\bq \\in \\cPt $ across extant lineages only is $ \\hat{d}(\\bp, \\bq) = |\\{i \\in [\\Lt] : p_i \\neq q_i, t < t_{\\kit}\\}| $ and the Hamming weight of $ \\bp $ is $ \\hat{s}(\\bp) = \\hat{d}(\\bp, \\zeros) $. Recalling $ \\Spm $ and $ \\Spp $ from Section~\\ref{sec:patternsBetweenBranching}, pattern $ \\bp \\in \\cPt $ communicates with patterns in the sets\n\n", "itemtype": "equation", "pos": 45793, "prevtext": "\nreduces to a Savage-Dickey ratio of the marginal prior and posterior densities that the constraint is satisfied in the relaxed model. We cannot compute the Savage-Dickey ratio~\\eqref{eq:SDR} in closed form so we replace the densities with kernel estimates based on marginal samples from the posterior~\\eqref{eq:intPost}. The results, displayed in Figure~\\ref{fig:polyBF}, indicate a satisfactory fit for the SDLT model with log-Bayes factors close to zero in each case. There is little to no support for the constraints on Mangareva, Marquesan and Rapanui under the SD model, thereby highlighting its misspecification on the data. Histograms of the marginal leaf ages are contained in the online supplement.\n\n\\begin{figure}[t]\n\\centering\n\\includegraphics[width=\\textwidth, trim = 0.5cm 0cm 1.25cm 0.25cm, clip]{logBFLeaves.pdf}\n\\caption{Bayes factors describing the lack of support for the leaf constraints used to fit the SDLT and SD models to \\texttt{POLY-0}. In the case of Rapanui, there is no posterior support for the leaf constraint so the Bayes factor is infinite.}\n\\label{fig:polyBF}\n\\end{figure}\n\nWe assess the predictive performance of each model on a random splitting of the registered data $ R(\\bD) $ into evenly sized training $ \\bDtr $ and test $ \\bDte $ portions. Following \\citet{madigan94}, we score each model by its log-posterior predictive probability, $ \\log \\pi(\\bDte | \\bDtr) $, where $ \\pi(\\bDte | \\bDtr) = \\int \\pi(\\bDte | x) \\pi(x | \\bDtr) \\mathrm{d}x $ and $ x = (g, \\mu, \\beta, \\rho, \\delta, \\Xi) $. The difference in predictive scores may be interpreted as a log-Bayes factor measuring the relative success of models at predicting the withheld data $ \\bDte $ \\citep{kass95}. In Table~\\ref{tab:ppp}, we observe superior predictive performance from the SDLT model on \\texttt{POLY-0}.\n\n\\begin{table}[t]\n\\centering\n\\begin{tabular}{lllll}\nTraining set\t\t\t&\tTest set\t\t\t\t&\tSDLT score\t&\tSD score \t&\tLog-Bayes factor \\\\ \\hline\n\\texttt{POLY-0/train}\t&\t\\texttt{POLY-0/test}\t&\t-3093.4\t\t&\t-3174.7\t\t&\t81.3\t\\\\\n\\texttt{POLY-1/train}\t&\t\\texttt{POLY-1/test}\t&\t-1421.5\t\t&\t-1535.5 \t&\t114.0 \\\\\n\\end{tabular}\n\\caption{Posterior predictive model assessment.}\n\\label{tab:ppp}\n\\end{table}\n\nTraits marked present in a single language are often deemed unreliable and removed in the registration process. To address this concern, we repeated our analyses on the data set \\texttt{POLY-1} formed by discarding the \\emph{singleton} patterns from \\texttt{POLY-0}, with the details contained in the online supplement. Singleton patterns play an important role in SDLT model inference as although the outcome of the predictive assessment was unchanged, credible intervals for some parameters were affected.\n\n\n\n\\section{Concluding remarks}\n\\label{sec:conclusions}\n\nLateral transfer is an important problem but practitioners generally lack statistical tools to make likelihood-based inference for phylogenetic trees in this setting. We address this issue with a novel model of species diversification which extends the Stochastic Dollo model for lateral transfer. To our knowledge, our method is the first fully likelihood-based approach to control for lateral transfer in reconstructing a rooted phylogenetic tree. The second major contribution of this paper is the inference procedure whereby we integrate out the locations of the trait birth, death and transfer events using systems of differential equations, thereby summing over all possible trait histories on a given tree. This marginal algorithm is more efficient than also inferring the locations of trait events {(\\citeauthor{{bloomquist10}})}.\n\nIn the example we considered, accounting for lateral transfer results in an improved fit over the regular Stochastic Dollo model, but at a significant computational cost. The sequence of initial value problems to compute the likelihood parameters in the lateral transfer model is easy to state but difficult to solve. On a tree with \\emph{L} leaves, we may exploit symmetry in the differential systems to compute the expected pattern frequencies exactly in $ \\cO(2^{2L}) $ operations. In practice, we use an ordinary differential equation solver to approximate their values within an error tolerance dominated by the Monte Carlo error. This approach requires $ \\cO(L 2^L C(L)) $ operations, where the number of steps $ C(L) $ required grows roughly linearly in \\texttt{MatLab} for the range of \\emph{L} we consider. This approach is feasible for up to approximately $ L = 20 $ leaves on readily available hardware. As we must evaluate the likelihood many times over the course of an MCMC analysis, this is a major stumbling block towards applying our model to data sets with more taxa or multiple character states, and is the focus of our current research.\n\nThe model as described is not \\emph{projective} in the sense that we cannot marginalise out the effect of unobserved lineages. Consequently, as the number of unobserved lineages increases, the probability of a trait transferring to a sampled lineage decreases; and a trait which previously died out on the sampled lineages may transfer back into the system from an unobserved lineage. It would not be difficult to introduce \\emph{ghost} lineages in the style of \\citet{szollosi13} to our model to allow for lateral transfer between sampled and unsampled taxa. There are many other avenues for future work on the model. For example, one could partition the data across a mixture of models and trees; relax the global regime of lateral transfer; allow rates to vary more freely across lineages or time; model correlated evolution of traits in the style of \\citet{cybis15}, for example, and allow for other types of missing data.\n\nThere are many open problems which have been ignored due to the expense of fitting models that account for lateral transfer. One such example occurs with the ancestry-constrained model proposed by \\citeauthor{chang15} whereby ancestral nodes may have data. Stochastic Dollo without lateral transfer cannot be used in this setting whenever there are traits which are absent in an ancestral state but present in both descendent and non-descendent leaves. Our approach addresses this issue.\n\n\n\\appendix\n\n\n\\section{Non-isochronous data}\n\\label{app:nonIso}\n\nThe $ \\Lt = |H(t)| $ extinct and evolving lineages at time \\emph{t} are labelled\n", "index": 37, "text": "\n\\[\n\\kt = \\left(i \\in E : t_{\\pa(i)} \\leq t < t_i \\, \\ind{i \\in V_L}\\right).\n\\]\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex21.m1\" class=\"ltx_Math\" alttext=\"\\kt=\\left(i\\in E:t_{\\pa(i)}\\leq t&lt;t_{i}\\,\\ind{i\\in V_{L}}\\right).\" display=\"block\"><mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\kt</mtext></merror><mo>=</mo><mrow><mo>(</mo><mi>i</mi><mo>\u2208</mo><mi>E</mi><mo>:</mo><msub><mi>t</mi><mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\pa</mtext></merror><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>i</mi><mo stretchy=\"false\">)</mo></mrow></mrow></msub><mo>\u2264</mo><mi>t</mi><mo>&lt;</mo><mpadded width=\"+1.7pt\"><msub><mi>t</mi><mi>i</mi></msub></mpadded><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\ind</mtext></merror><mi>i</mi><mo>\u2208</mo><msub><mi>V</mi><mi>L</mi></msub><mo>)</mo></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.07931.tex", "nexttext": "\nand its expected frequency evolves across the interval as\n\n", "itemtype": "equation", "pos": 46265, "prevtext": "\nThe Hamming distance between patterns $ \\bp $ and $ \\bq \\in \\cPt $ across extant lineages only is $ \\hat{d}(\\bp, \\bq) = |\\{i \\in [\\Lt] : p_i \\neq q_i, t < t_{\\kit}\\}| $ and the Hamming weight of $ \\bp $ is $ \\hat{s}(\\bp) = \\hat{d}(\\bp, \\zeros) $. Recalling $ \\Spm $ and $ \\Spp $ from Section~\\ref{sec:patternsBetweenBranching}, pattern $ \\bp \\in \\cPt $ communicates with patterns in the sets\n\n", "index": 39, "text": "\\begin{align*}\n\\hat{S}_{\\bp}^- &= \\{\\bq \\in \\Spm : \\hat{s}(\\bq) = \\hat{s}(\\bp) - 1, \\hat{d}(\\bp, \\bq) = 1\\}, \\\\\n\\hat{S}_{\\bp}^+ &= \\{\\bq \\in \\Spp : \\hat{s}(\\bq) = \\hat{s}(\\bp) + 1, \\hat{d}(\\bp, \\bq) = 1\\},\n\\end{align*}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex22.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle\\hat{S}_{\\bp}^{-}\" display=\"inline\"><msubsup><mover accent=\"true\"><mi>S</mi><mo stretchy=\"false\">^</mo></mover><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bp</mtext></merror><mo>-</mo></msubsup></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex22.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle=\\{\\bq\\in\\Spm:\\hat{s}(\\bq)=\\hat{s}(\\bp)-1,\\hat{d}(\\bp,\\bq)=1\\},\" display=\"inline\"><mrow><mrow><mi/><mo>=</mo><mrow><mo stretchy=\"false\">{</mo><mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bq</mtext></merror><mo>\u2208</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\Spm</mtext></merror></mrow><mo>:</mo><mrow><mrow><mrow><mover accent=\"true\"><mi>s</mi><mo stretchy=\"false\">^</mo></mover><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bq</mtext></merror><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mrow><mrow><mover accent=\"true\"><mi>s</mi><mo stretchy=\"false\">^</mo></mover><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bp</mtext></merror><mo stretchy=\"false\">)</mo></mrow></mrow><mo>-</mo><mn>1</mn></mrow></mrow><mo>,</mo><mrow><mrow><mover accent=\"true\"><mi>d</mi><mo stretchy=\"false\">^</mo></mover><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bp</mtext></merror><mo>,</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bq</mtext></merror><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mn>1</mn></mrow></mrow><mo stretchy=\"false\">}</mo></mrow></mrow><mo>,</mo></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex23.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle\\hat{S}_{\\bp}^{+}\" display=\"inline\"><msubsup><mover accent=\"true\"><mi>S</mi><mo stretchy=\"false\">^</mo></mover><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bp</mtext></merror><mo>+</mo></msubsup></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex23.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle=\\{\\bq\\in\\Spp:\\hat{s}(\\bq)=\\hat{s}(\\bp)+1,\\hat{d}(\\bp,\\bq)=1\\},\" display=\"inline\"><mrow><mrow><mi/><mo>=</mo><mrow><mo stretchy=\"false\">{</mo><mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bq</mtext></merror><mo>\u2208</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\Spp</mtext></merror></mrow><mo>:</mo><mrow><mrow><mrow><mover accent=\"true\"><mi>s</mi><mo stretchy=\"false\">^</mo></mover><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bq</mtext></merror><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mrow><mrow><mover accent=\"true\"><mi>s</mi><mo stretchy=\"false\">^</mo></mover><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bp</mtext></merror><mo stretchy=\"false\">)</mo></mrow></mrow><mo>+</mo><mn>1</mn></mrow></mrow><mo>,</mo><mrow><mrow><mover accent=\"true\"><mi>d</mi><mo stretchy=\"false\">^</mo></mover><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bp</mtext></merror><mo>,</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bq</mtext></merror><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mn>1</mn></mrow></mrow><mo stretchy=\"false\">}</mo></mrow></mrow><mo>,</mo></mrow></math>", "type": "latex"}, {"file": "1601.07931.tex", "nexttext": "\nin the expected pattern frequencies calculation~\\eqref{eq:ivp}. As with rate heterogeneity in Section~\\ref{sec:cat}, we can prove this method is correct using the techniques in the proof of Theorem~\\ref{thm:bdl}.\n\n\n\n\\section{MCMC transition kernels}\n\\label{app:MCMC}\n\nWe extend the sampling algorithms described by \\citeauthor{nicholls08} and \\citeauthor{ryder11} for the Stochastic Dollo model to construct a Markov chain $ X_t, X_{t + 1}, \\dots $ targeting the posterior distribution $ \\pi(g, \\mu, \\beta, \\rho, \\delta, \\Xi | \\bD) $ in Equation~\\ref{eq:intPost}. In the following, $ x = [(V, E, T, C), \\mu, \\beta, \\rho, \\delta, \\Xi] $ is the current state of the chain and a move to a new state $ \\xs $ drawn from the proposal distribution $ \\Qxxs $ is accepted with probability $ \\min(1, r(x, \\xs)) $, where\n", "itemtype": "equation", "pos": 46542, "prevtext": "\nand its expected frequency evolves across the interval as\n\n", "index": 41, "text": "\\begin{align*}\n\\dot{x}_{\\bp}(t)\n\t=& -\\hat{s}(\\bp)  \\xpt \\left[ \\mu + \\beta \\left(1 - \\tfrac{\\hat{s}(\\bp)}{\\Lt}\\right) \\right] + \\lambda  \\ind{s(\\bp)=\\hat{s}(\\bp) = 1} \\\\\n\t\t &\\qquad + \\beta \\sum_{\\bq \\in \\hat{S}_{\\bp}^-} \\tfrac{\\hat{s}(\\bq)}{\\Lt} \\xqt + \\mu \\sum_{\\bq \\in \\hat{S}_{\\bp}^+} \\xqt,\n\\end{align*}\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex24.m1\" class=\"ltx_Math\" alttext=\"\\displaystyle\\dot{x}_{\\bp}(t)=\" display=\"inline\"><mrow><mrow><msub><mover accent=\"true\"><mi>x</mi><mo>\u02d9</mo></mover><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bp</mtext></merror></msub><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mi/></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex24.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle-\\hat{s}(\\bp)\\xpt\\left[\\mu+\\beta\\left(1-\\tfrac{\\hat{s}(\\bp)}{\\Lt}%&#10;\\right)\\right]+\\lambda\\ind{s(\\bp)=\\hat{s}(\\bp)=1}\" display=\"inline\"><mrow><mrow><mrow><mo>-</mo><mrow><mover accent=\"true\"><mi>s</mi><mo stretchy=\"false\">^</mo></mover><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bp</mtext></merror><mo stretchy=\"false\">)</mo></mrow><mo>\u2062</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\xpt</mtext></merror><mo>\u2062</mo><mrow><mo>[</mo><mrow><mi>\u03bc</mi><mo>+</mo><mrow><mi>\u03b2</mi><mo>\u2062</mo><mrow><mo>(</mo><mrow><mn>1</mn><mo>-</mo><mfrac><mrow><mover accent=\"true\"><mi>s</mi><mo stretchy=\"false\">^</mo></mover><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bp</mtext></merror><mo stretchy=\"false\">)</mo></mrow></mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\Lt</mtext></merror></mfrac></mrow><mo>)</mo></mrow></mrow></mrow><mo>]</mo></mrow></mrow></mrow><mo>+</mo><mrow><mi>\u03bb</mi><mo>\u2062</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\ind</mtext></merror><mo>\u2062</mo><mi>s</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bp</mtext></merror><mo stretchy=\"false\">)</mo></mrow></mrow></mrow><mo>=</mo><mrow><mover accent=\"true\"><mi>s</mi><mo stretchy=\"false\">^</mo></mover><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bp</mtext></merror><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mn>1</mn></mrow></math>\n<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex25.m2\" class=\"ltx_Math\" alttext=\"\\displaystyle\\qquad+\\beta\\sum_{\\bq\\in\\hat{S}_{\\bp}^{-}}\\tfrac{\\hat{s}(\\bq)}{%&#10;\\Lt}\\xqt+\\mu\\sum_{\\bq\\in\\hat{S}_{\\bp}^{+}}\\xqt,\" display=\"inline\"><mrow><mrow><mi>\u2003\u2003</mi><mo>+</mo><mrow><mi>\u03b2</mi><mo>\u2062</mo><mrow><mstyle displaystyle=\"true\"><munder><mo largeop=\"true\" movablelimits=\"false\" symmetric=\"true\">\u2211</mo><mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bq</mtext></merror><mo>\u2208</mo><msubsup><mover accent=\"true\"><mi>S</mi><mo stretchy=\"false\">^</mo></mover><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bp</mtext></merror><mo>-</mo></msubsup></mrow></munder></mstyle><mrow><mfrac><mrow><mover accent=\"true\"><mi>s</mi><mo stretchy=\"false\">^</mo></mover><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bq</mtext></merror><mo stretchy=\"false\">)</mo></mrow></mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\Lt</mtext></merror></mfrac><mo>\u2062</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\xqt</mtext></merror></mrow></mrow></mrow><mo>+</mo><mrow><mi>\u03bc</mi><mo>\u2062</mo><mrow><mstyle displaystyle=\"true\"><munder><mo largeop=\"true\" movablelimits=\"false\" symmetric=\"true\">\u2211</mo><mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bq</mtext></merror><mo>\u2208</mo><msubsup><mover accent=\"true\"><mi>S</mi><mo stretchy=\"false\">^</mo></mover><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\bp</mtext></merror><mo>+</mo></msubsup></mrow></munder></mstyle><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\xqt</mtext></merror></mrow></mrow></mrow><mo>,</mo></mrow></math>", "type": "latex"}, {"file": "1601.07931.tex", "nexttext": "\n\nWe apply the same scaling update to the lateral transfer rate $ \\beta $ as the death rate $ \\mu $ and catastrophe rate $ \\rho $. If $ \\xs = [(V, E, T, C), \\mu, \\beta^*, \\rho, \\delta, \\Xi] $ where $ \\beta^* \\sim \\Unif{c^{-1} \\beta}{c \\beta} $ for some constant $ c > 1 $,\n", "itemtype": "equation", "pos": 47658, "prevtext": "\nin the expected pattern frequencies calculation~\\eqref{eq:ivp}. As with rate heterogeneity in Section~\\ref{sec:cat}, we can prove this method is correct using the techniques in the proof of Theorem~\\ref{thm:bdl}.\n\n\n\n\\section{MCMC transition kernels}\n\\label{app:MCMC}\n\nWe extend the sampling algorithms described by \\citeauthor{nicholls08} and \\citeauthor{ryder11} for the Stochastic Dollo model to construct a Markov chain $ X_t, X_{t + 1}, \\dots $ targeting the posterior distribution $ \\pi(g, \\mu, \\beta, \\rho, \\delta, \\Xi | \\bD) $ in Equation~\\ref{eq:intPost}. In the following, $ x = [(V, E, T, C), \\mu, \\beta, \\rho, \\delta, \\Xi] $ is the current state of the chain and a move to a new state $ \\xs $ drawn from the proposal distribution $ \\Qxxs $ is accepted with probability $ \\min(1, r(x, \\xs)) $, where\n", "index": 43, "text": "\n\\[\nr(x, \\xs) = \\frac{\\pixs \\Qxsx}{\\pix \\Qxxs}.\n\\]\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex26.m1\" class=\"ltx_Math\" alttext=\"r(x,\\xs)=\\frac{\\pixs\\Qxsx}{\\pix\\Qxxs}.\" display=\"block\"><mrow><mrow><mrow><mi>r</mi><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo>,</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\xs</mtext></merror><mo stretchy=\"false\">)</mo></mrow></mrow><mo>=</mo><mfrac><mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\pixs</mtext></merror><mo>\u2062</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\Qxsx</mtext></merror></mrow><mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\pix</mtext></merror><mo>\u2062</mo><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\Qxxs</mtext></merror></mrow></mfrac></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.07931.tex", "nexttext": "\n\nA catastrophe $ c = (b, u) \\in E \\times (0, 1) $ in state \\emph{x} occurs on branch $ b $ at time $ t_{b} + u (t_{\\pa(b)} - t_{b}) $. This definition of catastrophes is scale preserving. We chose catastrophe $ c_i $ uniformly from the catastrophe set \\emph{C} to move to branch $ b_i^* $ chosen uniformly from the $ \\deg(b_i) + \\deg(\\pa(b_i)) - 2 $ branches neighbouring $ b_i $. If $ c_i^* = (b_i^*, u_i) $ replaces $ c_i $ as the \\emph{i}th catastrophe in the proposed state $ \\xs $,\n", "itemtype": "equation", "pos": 47980, "prevtext": "\n\nWe apply the same scaling update to the lateral transfer rate $ \\beta $ as the death rate $ \\mu $ and catastrophe rate $ \\rho $. If $ \\xs = [(V, E, T, C), \\mu, \\beta^*, \\rho, \\delta, \\Xi] $ where $ \\beta^* \\sim \\Unif{c^{-1} \\beta}{c \\beta} $ for some constant $ c > 1 $,\n", "index": 45, "text": "\n\\[\n\\frac{\\Qxsx}{\\Qxxs} = \\frac{\\beta}{\\beta^*}.\n\\]\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex27.m1\" class=\"ltx_Math\" alttext=\"\\frac{\\Qxsx}{\\Qxxs}=\\frac{\\beta}{\\beta^{*}}.\" display=\"block\"><mrow><mrow><mfrac><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\Qxsx</mtext></merror><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\Qxxs</mtext></merror></mfrac><mo>=</mo><mfrac><mi>\u03b2</mi><msup><mi>\u03b2</mi><mo>*</mo></msup></mfrac></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.07931.tex", "nexttext": "\nThe location for a new catastrophe $ c^* = (b^*, u^*) $ is chosen uniformly at random across the branches of the tree to form the proposed state $ \\xs = [(V, E, T, C \\cup \\{c^*\\}), \\mu, \\beta, \\rho, \\delta, \\Xi] $. Catastrophes are chosen uniformly at random for deletion so\n", "itemtype": "equation", "pos": 48518, "prevtext": "\n\nA catastrophe $ c = (b, u) \\in E \\times (0, 1) $ in state \\emph{x} occurs on branch $ b $ at time $ t_{b} + u (t_{\\pa(b)} - t_{b}) $. This definition of catastrophes is scale preserving. We chose catastrophe $ c_i $ uniformly from the catastrophe set \\emph{C} to move to branch $ b_i^* $ chosen uniformly from the $ \\deg(b_i) + \\deg(\\pa(b_i)) - 2 $ branches neighbouring $ b_i $. If $ c_i^* = (b_i^*, u_i) $ replaces $ c_i $ as the \\emph{i}th catastrophe in the proposed state $ \\xs $,\n", "index": 47, "text": "\n\\[\n\\frac{\\Qxsx}{\\Qxxs} = \\frac{\\deg(b_i) + \\deg(\\pa(b_i)) - 2}{\\deg(b_i^*) + \\deg(\\pa(b_i^*)) - 2}.\n\\]\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex28.m1\" class=\"ltx_Math\" alttext=\"\\frac{\\Qxsx}{\\Qxxs}=\\frac{\\deg(b_{i})+\\deg(\\pa(b_{i}))-2}{\\deg(b_{i}^{*})+\\deg%&#10;(\\pa(b_{i}^{*}))-2}.\" display=\"block\"><mrow><mrow><mfrac><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\Qxsx</mtext></merror><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\Qxxs</mtext></merror></mfrac><mo>=</mo><mfrac><mrow><mrow><mrow><mi>deg</mi><mo>\u2061</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>b</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo></mrow></mrow><mo>+</mo><mrow><mi>deg</mi><mo>\u2061</mo><mrow><mo stretchy=\"false\">(</mo><mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\pa</mtext></merror><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msub><mi>b</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo></mrow></mrow><mo stretchy=\"false\">)</mo></mrow></mrow></mrow><mo>-</mo><mn>2</mn></mrow><mrow><mrow><mrow><mi>deg</mi><mo>\u2061</mo><mrow><mo stretchy=\"false\">(</mo><msubsup><mi>b</mi><mi>i</mi><mo>*</mo></msubsup><mo stretchy=\"false\">)</mo></mrow></mrow><mo>+</mo><mrow><mi>deg</mi><mo>\u2061</mo><mrow><mo stretchy=\"false\">(</mo><mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\pa</mtext></merror><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><msubsup><mi>b</mi><mi>i</mi><mo>*</mo></msubsup><mo stretchy=\"false\">)</mo></mrow></mrow><mo stretchy=\"false\">)</mo></mrow></mrow></mrow><mo>-</mo><mn>2</mn></mrow></mfrac></mrow><mo>.</mo></mrow></math>", "type": "latex"}, {"file": "1601.07931.tex", "nexttext": "\nwhere $ p_{AC} $ and $ p_{DC} $ denote the probabilities of proposing to add and delete a catastrophe respectively.\n\nSubtree prune and regraft moves on the tree are designed in such a way that the total number of catastrophes on the tree remains constant and the ratio of proposal densities is unaffected.\n\n\n\n\n\n\\section*{Acknowledgements}\n\nThe authors wish to thank Robin Ryder for assistance with the implementation and Simon Greenhill for providing the Eastern Polynesian data set and feedback on the manuscript.\n\n\n\n\\bibliographystyle{plainnat}\n\\bibliography{SDLT}\n\n\n", "itemtype": "equation", "pos": 48896, "prevtext": "\nThe location for a new catastrophe $ c^* = (b^*, u^*) $ is chosen uniformly at random across the branches of the tree to form the proposed state $ \\xs = [(V, E, T, C \\cup \\{c^*\\}), \\mu, \\beta, \\rho, \\delta, \\Xi] $. Catastrophes are chosen uniformly at random for deletion so\n", "index": 49, "text": "\n\\[\n\\frac{\\Qxsx}{\\Qxxs} = \\frac{p_{DC}}{p_{AC}} \\frac{1}{|C| + 1} \\sum_{i \\in V \\setminus \\{0, 1\\}} (t_{\\pa(i)} - t_i),\n\\]\n", "mathml": "<math xmlns=\"http://www.w3.org/1998/Math/MathML\" id=\"S0.Ex29.m1\" class=\"ltx_Math\" alttext=\"\\frac{\\Qxsx}{\\Qxxs}=\\frac{p_{DC}}{p_{AC}}\\frac{1}{|C|+1}\\sum_{i\\in V\\setminus%&#10;\\{0,1\\}}(t_{\\pa(i)}-t_{i}),\" display=\"block\"><mrow><mrow><mfrac><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\Qxsx</mtext></merror><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\Qxxs</mtext></merror></mfrac><mo>=</mo><mrow><mfrac><msub><mi>p</mi><mrow><mi>D</mi><mo>\u2062</mo><mi>C</mi></mrow></msub><msub><mi>p</mi><mrow><mi>A</mi><mo>\u2062</mo><mi>C</mi></mrow></msub></mfrac><mo>\u2062</mo><mfrac><mn>1</mn><mrow><mrow><mo stretchy=\"false\">|</mo><mi>C</mi><mo stretchy=\"false\">|</mo></mrow><mo>+</mo><mn>1</mn></mrow></mfrac><mo>\u2062</mo><mrow><munder><mo largeop=\"true\" movablelimits=\"false\" symmetric=\"true\">\u2211</mo><mrow><mi>i</mi><mo>\u2208</mo><mrow><mi>V</mi><mo>\u2216</mo><mrow><mo stretchy=\"false\">{</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy=\"false\">}</mo></mrow></mrow></mrow></munder><mrow><mo stretchy=\"false\">(</mo><mrow><msub><mi>t</mi><mrow><merror class=\"ltx_ERROR undefined undefined\"><mtext>\\pa</mtext></merror><mo>\u2062</mo><mrow><mo stretchy=\"false\">(</mo><mi>i</mi><mo stretchy=\"false\">)</mo></mrow></mrow></msub><mo>-</mo><msub><mi>t</mi><mi>i</mi></msub></mrow><mo stretchy=\"false\">)</mo></mrow></mrow></mrow></mrow><mo>,</mo></mrow></math>", "type": "latex"}]